// CrowdStrike YARA Rules
// Copyright: (c) 2021 CrowdStrike Inc.
// Generated: 2021-06-25T10:59:25+00:00 - Last change: 2021-06-25T10:58:48+00:00 - Exported: 2737 rules

// ==================================== 
// Section: Dependencies of other rules
// ==================================== 

rule CrowdStrike_CSIT_17176_01 : azorult stealer 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Generic rule to detect Azorult samples"
        reports = "CSIT-17176"
        version = "202002251654"
        last_modified = "2020-02-25"
        malware_family = "Azorult"
    strings:
        $ = "IS_G_PWDS" wide
        $ = "IS_G_BROWSERS" wide
        $ = "IS_G_COINS" wide
        $ = "IS_G_SKYPE" wide
        $ = "IS_G_STEAM" wide
        $ = "IS_G_DESKTOP" wide
        $ = "G_DESKTOP_EXTS" wide
        $ = "G_DESKTOP_MAXSIZE" wide
        $ = "SELECT origin_url, username_value, password_value FROM logins"
        $ = "SELECT host, path, isSecure, expiry, name, value FROM moz_cookies"
        $ = "SELECT host_key, name, encrypted_value, value, path, secure, expires_utc FROM cookies"
        $ = "NSSBase64_DecodeBuffer"
        $ = "TSwdPwd"
        $ = "TPwdArray"
    condition:
        10 of them
}

rule CrowdStrike_CSA_18117_01 : dropper olympicdestroyer wiper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "OlympicDestroyer dropper/orchestrator"
        reports = "CSA-18117,CSA-18121,CSA-18192,CSA-18197"
        version = "202012141606"
        last_modified = "2020-12-14"
        malware_family = "OlympicDestroyer"
    strings:
        // Strings used in propagation routines
        $evtchk = "%programdata%\\evtchk.txt" wide
        $ping = "(ping 0.0.0.0 > nul)" wide
        $wmi_pstop = "Select * From Win32_ProcessStopTrace"
        $wmi_ds = "SELECT ds_cn FROM ds_computer" wide
    condition:
        all of them
}

rule CrowdStrike_CSA_18117_02 : artifact olympicdestroyer wiper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Encrypted PE header observed in OlympicDestroyer dropper and loader components"
        reports = "CSA-18117,CSA-18121,CSA-18192,CSA-18197"
        version = "202012141609"
        last_modified = "2020-12-14"
        malware_family = "OlympicDestroyer"
    strings:
        // Encrypted MZ/PE header start
        $pe_hdr = { c1 7e 20 a2 da f9 56 45 61 39 eb db 51 9d a7 4f }
    condition:
        $pe_hdr
}

rule CrowdStrike_CSIT_18063_01 : lockpos pos_scraper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects LockPOS Point-of-Sale malware"
        reports = "CSIT-18063"
        version = "201807300917"
        last_modified = "2018-07-30"
        malware_family = "LockPOS"
    strings:
        $code_xor1 = { 8b 55 fc 8b 45 0c 0f b7 0c 50 33 4d 14 8b 55 fc 8b 45 08 }
        $code_xor2 = { 66 8b 1c 02 66 83 f3 41 66 89 18 83 c0 02 49 75 ef 5b }
        $code_int2e = { 8d 24 24 8d 24 24 8d 54 24 08 cd 2e }
        $code_heavensGate = { 57 56 89 65 fc 83 e4 f0 6a 33 e8 00 00 00 00 83 04 24 05 }
        $rsrc_section = ".rsrc" ascii
        $s1 = "1$/(2" ascii // encrypted string
        // Encrypted string (HARDWARE\\DESCRIPTION\\System\\CentralProcessor\\0)
        $s2 = { 09 00 00 00 13 00 05 00 16 00 00 00 13 00 04 00 1d 00 1d 00 05
        00 04 00 12 00 02 00 13 00 08 00 11 00 15 00 08 00 0e 00 0f 00
        1d 00 1d 00 12 00 38 00 32 00 35 00 24 00 2c 00 1d 00 1d 00 02
        00 24 00 2f 00 35 00 33 00 20 00 2d 00 11 00 33 00 2e 00 22 00
        24 00 32 00 32 00 2e 00 33 00 1d 00 1d 00 71 00 00 00 }
        // Encrypted string (HARDWARE\DESCRIPTION\System\CentralProcessor\0)
        $s3 = { 09 00 00 00 13 00 05 00 16 00 00 00 13 00 04 00 1d 00 05 00 04
        00 12 00 02 00 13 00 08 00 11 00 15 00 08 00 0e 00 0f 00 1d 00
        12 00 38 00 32 00 35 00 24 00 2c 00 1d 00 02 00 24 00 2f 00 35
        00 33 00 20 00 2d 00 11 00 33 00 2e 00 22 00 24 00 32 00 32 00
        2e 00 33 00 1d 00 71 00 00 00 }
    condition:
        uint16(0) == 0x5A4D and filesize < 4096KB and $rsrc_section and 2 of ($s*) and 1 of ($code*)
}

rule CrowdStrike_CSIT_18159_03 : ammyadmin post_exploitation rat unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects Ammyy Admin, a legitimate remote administration tool which is often abused for malicious purposes."
        reports = "CSIT-18159"
        version = "201904181108"
        last_modified = "2019-04-18"
        malware_family = "AmmyyAdmin"
    strings:
        $name = "Ammyy Admin" wide ascii fullword
        $pipe = "\\\\.\\Pipe\\TerminalServer\\SystemExecSrvr\\%d" wide ascii
        $svc1 = "The Ammyy service is already registered"
        $svc2 = "The Ammyy service could not be stopped"
        $svc3 = "The Ammyy service is already marked for removing"
        $svc4 = "The Ammyy service could not be removed, error=%d"
        $svc5 = "The Ammyy service could not be found"
        $svc6 = "The remote pc uses Ammyy Admin v%s"
        $msg1 = "keyboard key: keysym %d(0x%x) vkCode 0x%x ext %d down %d"
        $msg2 = "latin-1 key: keysym %d(0x%x) vkCode 0x%x down %d"
        $msg3 = "Desktop changed to '%s', from='%s'"
        $msg4 = "sessionId=%d, activeSessionId=%d, processId=%u"
    condition:
        $name and $pipe and (2 of ($msg*) or any of ($svc*))
}

rule CrowdStrike_Floxif : floxif virus 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects files which are infected with the Floxif Virus."
        version = "202010021206"
        last_modified = "2020-10-02"
        malware_family = "Floxif"
    strings:
        $jmp4 = { 50 8B 44 24 04 83 C0 04 50 C2 08 00 }
        $jmp2 = { 50 60 E8 ?? ?? ?? ?? C2 04 00 ?? 61 83 EC F8 8B 44 24 FC 83 C0 02 89 44 24 FC 8B 44 24 F8 83 EC 04 C3 }
    condition:
        all of them and
        int32(@jmp2+3) + @jmp2 + 7 == @jmp4
}


// ======================== 
// Section: Requested rules
// ========================

rule CrowdStrike_CSIR_13003_01 : comment_panda miniasp rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "MiniAsp RAT"
        reports = "CSIR-13003"
        version = "201211270000"
        last_modified = "2012-11-27"
        actor = "COMMENT PANDA"
    strings:
        $key1 = "q0nc9w8edaoiuk2mzrfy3xt1p5ls67g4bvhj" ascii wide
        $key2 = { 71 30 6E 63 39 77 38 65 64 61 6F 69 75 6B 32 6D 7A 72 66 79 33 78 74 31 70 35 6C 73 36 37 67 34 62 76 68 6A }
        $url = "device_t=" ascii wide
        $ma = "MiniAsp" ascii wide
    condition:
        2 of them
}

rule CrowdStrike_CSIR_12033_01 : ardamax dropper keylogger king_khan 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Ardamax keylogger installation package"
        reports = "CSIR-12033"
        version = "201904241622"
        last_modified = "2019-04-24"
        malware_family = "Ardamax"
    strings:
        $rdata = { F8 CC E2 99 E8 66 5C 06 95 0C 48 21 35 30 06 1A 25 00 73 00 25 00 73 00 00 00 00 00 51 00 48 00 49 00 00 00 00 00 00 00 41 00 4B 00 4C 00 4D 00 57 00 00 00 }
    condition:
        $rdata
}

rule CrowdStrike_CSIR_12037_01 : vixen_panda rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "VIXEN PANDA malware family 2 strings"
        reports = "CSIR-12037"
        version = "201301040000"
        last_modified = "2013-01-04"
        actor = "VIXEN PANDA"
    strings:
        $cookie = "Cookie: /search?hl=en=q="
        $winsend = "%s\\Winsend.d2"
    condition:
        any of them
}

rule CrowdStrike_CSIR_12037_02 : vixen_panda rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "VIXEN PANDA malware family 2 XOR config deobfuscator"
        reports = "CSIR-12037"
        version = "201301040000"
        last_modified = "2013-01-04"
        actor = "VIXEN PANDA"
    strings:
        $deob_xor_b = { 8a 4c ?8 ff 30 0c ?8 48 85 c0 7f f4 } // xor decoder loop (bytes)
        $deob_xor_dw = { 8b 4? 0c 03 4? ec [4-14] 0f b6 4? f? [0-6] 33 c? 88 4? f7 } // dword version
    condition:
        any of them
}

rule CrowdStrike_CSIR_12037_03 : vixen_panda rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "VIXEN PANDA malware family 2 ADD config deobfuscator"
        reports = "CSIR-12037"
        version = "201301040000"
        last_modified = "2013-01-04"
        actor = "VIXEN PANDA"
    strings:
        $deob_add_1 = { 8b 4d 10 03 c8 00 01 40 3b c6 72 f4 } // add decoder loop
        $deob_add_2 = { 00 04 18 40 3b c6 72 f8  } //variant
        $deob_add_3 = { 8a 0c 30 02 c8 88 0c 30 40 3d 9c 01 00 00 72 f0 } // variant 2
    condition:
        any of them
}

rule CrowdStrike_CSIR_12022_01 : poisonivy dropper installer 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Installer used to deploy PoisonIvy"
        reports = "CSIR-12022"
        version = "201301090000"
        last_modified = "2013-01-09"
        malware_family = "Poison Ivy"
    strings:
        /*
        xor byte ptr [eax], 6Eh
        add eax, 18h
        xor byte ptr [eax], 6Eh
        add eax, 0Ch
        xor byte ptr [eax], 6Eh
        add eax, 0Ch
        xor byte ptr [eax], 6Eh
        */
        $xor_imports = { 80 30 6E 83 C0 18 80 30 6E 83 C0 0C 80 30 6E 83 C0 0C 80 30 6E }
    condition:
        any of them
}

rule CrowdStrike_CSIR_12022_02 : poisonivy rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects PoisonIvy imports in shellcode"
        reports = "CSIR-12022"
        version = "201301090000"
        last_modified = "2013-01-09"
        malware_family = "PoisonIvy"
    strings:
        /*
        call sub_20
        dd 0CB9BD550h ; WideCharToMultiByte
        dd 130F36B2h ; ReadFile
        dd 1A22F51h ; WinExec
        dd 0C917432h ; LoadLibraryA
        */
        $shellcode_imports = {E8 60 FC FF FF 50 D5 9B CB B2 36 0F 13 51 2F A2 01 32 74 91 0C }
    condition:
        $shellcode_imports
}

rule CrowdStrike_CSIR_18014_01 : artifact poison_ivy rat stone_panda 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Identifies distinctive MFC class names seen in STONE PANDA Poison Ivy loaders"
        reports = "CSIR-18014"
        version = "201811300923"
        last_modified = "2018-11-30"
        actor = "STONE PANDA"
        malware_family = "Poison Ivy"
    strings:
        $ = "CBricksDoc"
        $ = "CMy20130401Doc"
        $ = "CPiShellPutDoc"
        $ = "CCrocodileDoc"
        $ = "CStatePattern_GameDoc"
        $ = "CShellCodeDoc"
        $ = "CPIVCDoc"
    condition:
        any of them
}

rule CrowdStrike_CSIT_13023_01 : carberp trojan unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Strings used in Carberp, present in unpacked memory"
        reports = "CSIT-13023"
        version = "201904261309"
        last_modified = "2019-04-26"
        malware_family = "Carberp"
    strings:
        $b64_1 = "K8DFaGYUs83KF05T"
        $key = "GDlet64E"
    condition:
        all of them
}

rule CrowdStrike_CSIR_13002_01 : vixen_panda rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "RAT family 3 add/XOR obfuscation encoder"
        reports = "CSIR-13002"
        version = "201301230000"
        last_modified = "2013-01-23"
        actor = "VIXEN PANDA"
    strings:
        $deob_add_xor = { 8a 88 ?? ?? ?? ?? 02 c8 80 c1 5a 32 c8 88 88 ?? ?? ?? ?? 83 c0 01 eb e1 }
    condition:
        any of them
}

rule CrowdStrike_CSIR_13013_01 : silent_chollima key 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "RSA key used by SILENT CHOLLIMA malware"
        reports = "CSIT-13032,CSIR-13013"
        version = "201301230000"
        last_modified = "2013-01-23"
        actor = "SILENT CHOLLIMA"
    strings:
        $rsa_1_1 = { 06 02 00 00 00 a4 00 00 52 53 41 31 00 04 00 00 01 00 01 00 35 dd 6b a2 9e a7 a1 04 71 f1 34 7b e6 de 74 59 a5 bd 08 33 df 42 11 11 5c a2 c2 8d 7e fe 56 55 e7 fd 56 4c 0b c6 ac ea 1d 04 cb 27 42 40 d7 14 ad 1c ed 29 3f c9 ba 54 ee 1b f4 03 82 e6 77 5e a9 5e eb 69 c3 33 48 60 3e 7d 30 4e 81 49 8f e1 a5 71 6c 98 03 d8 96 21 b8 7f ad 18 ed 23 98 35 27 15 a8 47 1f f0 82 93 ad 5d f0 39 c7 6f 45 5a bc be d9 df 1f 43 ee 3d 35 a9 cf 01 ea e5 db e2 }
        $rsa_1_2 = { 06 02 00 00 00 A4 00 00 52 53 41 31 00 04 00 00 01 00 01 00 FB A3 C6 07 61 F7 10 AD 56 17 29 F2 8B C5 54 96 CC BF C5 32 ED EA CE 9B 4D 15 4F 29 6D B7 6F 27 99 1D 16 92 54 C3 6C B0 50 71 4D 80 B8 1B 55 9D B2 99 41 74 C9 66 F1 15 59 5D 94 73 D0 E9 31 CF BD 4C 4D A5 09 85 74 FC 23 AA 53 91 3F 00 EA F4 2C 08 0D C9 83 C8 DD 1A CD 72 FF B6 23 F5 60 F1 AA 5D 31 86 9F 29 C2 EA CB FC E2 5A 18 EE 73 1E C8 8C E5 85 B6 2C 89 73 0A E1 A3 E3 1B A1 CA BA }
        $rsa_1_3 = { 06 02 00 00 00 a4 00 00 52 53 41 31 00 04 00 00 01 00 01 00 51 b8 4d f6 b1 6e 5b 05 47 10 1e c0 cd 9d 00 1b bd d6 75 90 bf 47 e7 ce ef 15 98 24 8b 16 12 2a 3e d8 f5 9e bc 11 3b 4d 72 18 d7 71 1e 61 c0 2a e0 d0 8e 16 6e 48 9d c0 2a 4b f1 a2 40 c8 5f 45 f0 6d 4f 04 b4 1d 3b 3f 0c 55 a0 e9 ee c2 9f 08 a1 5f 04 e9 e0 3b 5a d3 13 8b 3a 99 7a aa 8e f8 c2 9f c7 e3 b6 e9 b0 b5 94 fc c7 ca b7 32 96 36 ba e2 ba 06 79 d6 51 38 57 55 d0 4f c5 2d 60 84 }
    condition:
        any of them
}

rule CrowdStrike_CSIR_13013_02 : silent_chollima key 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "RSA key used by SILENT CHOLLIMA malware"
        reports = "CSIT-13032,CSIR-13013"
        version = "201301230000"
        last_modified = "2013-01-23"
        actor = "SILENT CHOLLIMA"
    strings:
        $rsa_2_1 = { 07 02 00 00 00 a4 00 00 52 53 41 32 00 04 00 00 01 00 01 00 ed 64 e3 72 3f 89 09 a4 34 c2 b1 db 23 cb 67 69 81 ae 94 c9 8e e5 69 32 d7 23 4f 51 7e dd 61 99 34 2c 38 20 1b c7 54 32 4b b4 16 98 e8 e8 d8 b1 e8 16 38 86 42 38 70 b2 81 26 17 e8 26 c6 22 90 39 44 e0 51 6d 78 eb c7 ee 91 8f f2 50 c6 a1 ed b4 e4 f2 2e 64 43 1c 77 fd b6 25 c0 5d 2a 7a 22 a5 84 1e 35 a5 e1 ac 48 5e 41 05 39 33 3e 47 b6 cb 89 b0 b7 ab eb ea 7d 5d 75 d2 8a 43 3e 64 b5 65 8c 5e 2f 50 93 ab ef 37 88 67 c5 7d ee 7b 4b 4d 69 4f 70 13 d0 d2 eb e1 f9 00 d4 6e d7 20 71 26 7c 6a 6e 92 70 7f db d2 25 73 e8 12 65 ee 63 49 1d f1 5c 44 60 aa 53 4f 90 ba 0b be f0 4e da e9 d9 44 ee f2 82 93 df e2 7e 8a 84 36 9a 76 3a 5d 29 ba c3 31 41 88 cc 89 ac b0 ec c0 4f 79 55 16 dd f7 90 43 c8 aa 09 fc 21 fc 41 13 05 41 42 97 5e da 0d a2 c3 78 c5 0a 9a ed 3b 10 9c b5 d4 91 54 a9 f8 c2 b7 77 3f ef 58 8d 28 0b 1b 3e 15 24 03 4a c3 43 6e 06 6a f3 6f e3 05 6f 5e b0 1e 89 a3 6b b4 14 38 33 c0 d1 81 f4 8d 06 a3 7f 42 86 0e 6d e4 b5 f5 05 63 21 e0 20 cc 1d bb 0e 21 19 a1 c5 7e 9f 4d bd cc 5e 4c 91 cc cb 08 1b f2 19 15 3d 38 f8 0f fa 53 7d 2b 98 cf 3d bf e6 79 a4 3e 2d e3 6a 51 14 2d 96 eb 8c 1c fb 7e de 5c d1 c0 42 80 ab 76 53 f9 04 07 6f 88 a1 af 53 87 4d 77 89 a2 57 7b f4 82 32 3e ba 83 6f 5a ff 99 7e a8 77 34 5e 74 36 71 b8 37 26 34 ef d4 8f f5 08 7e f0 a5 68 9f 69 ad 70 34 97 f6 ef cc 2e 4c b0 50 23 f9 ad 2d 4f e2 03 61 66 4c 1d 51 1b 64 c1 98 56 68 3a 6b ac b8 ae ca 61 e1 0a 92 6f 3f fb 96 80 31 b8 b9 42 18 6b fe bd 97 aa e9 69 8e bc 2e dc fc 06 88 37 ad f3 98 7b 65 66 69 50 16 95 66 ce e9 db ff c3 1a f6 eb 17 bf 4d 88 98 9c 4e 2e 2d a4 71 58 c0 80 cf 1f 6b 71 e6 a4 99 ac 39 f5 97 d9 4c 27 b8 dc d1 84 da 2a 99 af 63 28 3c 8a ff c8 27 65 ad d1 44 93 c4 f9 8e db e5 79 e4 4f 9a 2e db 39 97 a9 37 d7 d3 e0 a2 cb cc 35 }
        $rsa_2_2 = { 07 02 00 00 00 A4 00 00 52 53 41 32 00 04 00 00 01 00 01 00 E9 0E C0 7E 04 AC CE 83 F2 6C 7A C2 53 23 E7 83 A8 55 3C 52 75 37 2E 47 5E C4 A0 C0 DA BB CD 36 90 46 EF D2 F0 3C 5A 3E 39 2E D3 D6 60 CA 87 64 D7 E2 30 7F 33 ED 08 11 C4 FF 02 7C 8B 57 E6 57 44 78 13 28 8B EA 3D AA DE 4E 7E 2A 09 20 D1 FC F2 FA 41 00 74 09 A3 80 9A E2 09 84 A0 8A 49 CA 39 56 E5 2D 3A 3F E4 2F 34 A7 DB E5 0A 35 59 21 E7 83 01 83 E8 BE 7A 05 4D 8A 4C FE 06 4A 36 BB 5F 8C D5 32 25 00 C3 3B 48 11 DB EB 4B 65 7F 01 8D 7F 68 CE 18 8E AB 2E 44 42 CC B8 8D 27 81 AE 68 78 63 82 ED 1E 4F 6B F8 05 AD 22 64 E8 A4 3A 31 8D 42 17 3E CB B2 DB D5 45 95 D5 BE 0C 68 DD B7 A9 52 C8 53 DE E7 60 91 BD 6C A8 22 28 20 BE 27 74 33 37 12 D9 8A 86 E8 EE 43 AC E1 14 70 B9 78 AC BA F1 C2 6D 64 64 11 BB C9 D7 28 D8 C5 E3 6E 0A 30 67 99 C3 E7 86 A3 41 E9 75 04 83 76 D8 AF 9A C4 BC 13 85 D4 5C 34 5C 86 A3 0D 30 C5 5B 6D B2 0C 1C A3 C4 92 27 C6 6A 44 34 19 D2 DB 40 8C CC 92 A1 5F 9A 6A D3 33 4C A3 9B 66 CE 64 0F C4 AD 3A A9 9E BF 1D 03 BB 2D FF 46 0B FD 22 AE 5F E8 14 9D D0 37 57 DF A9 DC ED E9 DB AE 0E 45 A0 49 58 E8 9B 2D 5F 38 45 55 A0 76 56 9B 45 68 3D C1 A0 C4 38 31 53 73 81 B3 DC FD 8A 71 A0 66 E4 C6 7F 99 67 38 40 D3 4B AD D8 BD 99 BA 83 CE CD B2 CB F5 ED BD 64 85 29 93 C8 3E A0 32 C2 66 49 DD 50 55 6C 74 F3 E8 AB 43 32 AE D1 B3 76 D0 67 C5 13 13 FA FF 50 1C 2A BC F9 60 A2 FD 87 3B D5 C4 09 97 A0 E3 40 7F FA 59 D0 79 60 F4 AC BF D1 B0 8B 75 97 F1 CB 9E FA A0 EF 2A AB 15 33 1E AF 9A 5E A0 F0 D3 DA 77 B5 4A 9F 5C 31 30 24 A0 49 F0 AD 62 E9 2F 78 48 F1 9C 29 A8 F9 8A 23 3D 18 C9 31 05 72 A1 AE 9F 0A D1 2E 1A C9 49 38 58 A9 7D E4 87 C5 5C 2C 8C 67 50 56 70 D4 B8 94 50 D5 EF 2C 68 61 37 B9 D5 FA 6E 26 78 1C 1B E4 49 03 E9 69 DD 9B 37 32 4F 5E BC AA C3 6D BC F4 F1 49 1E 3C FC 2C EE DD 80 E3 2D 7A 5C 26 27 E4 B0 }
        $rsa_2_3 = { 07 02 00 00 00 a4 00 00 52 53 41 32 00 04 00 00 01 00 01 00 b3 34 01 e0 60 37 9b 84 65 6d da 5d ac f6 27 bb 6e d3 a5 9b 46 5a 6d bd e5 54 69 4f b5 6a 6a 11 fa 4b 2f 5b cd d8 6f e8 f4 a4 94 ca a5 99 44 1a 8b 15 05 3d 5e 9a ac 6f 31 da 33 1c fb 65 4b af 0f 15 e2 d1 14 21 f2 ab bd e6 8c 68 07 23 c2 5d 64 ca 74 44 db b0 6b dd 0a 19 c1 eb 3e 52 d7 d4 12 4a 5b 24 b1 af 44 ca c3 ac e2 77 6a 92 9c 4e 04 8d f6 44 4f ba 38 a2 a0 2e a2 dc 39 29 b0 8b cf 85 20 3e 70 0e ff 2f 4d af c4 18 3f 63 30 8e 36 01 57 f5 da 21 1f 40 9a 97 10 d4 31 83 06 27 d4 2d 67 9d 38 2f ba d8 ba ac ba af ea a3 2a 30 0c 6c 35 52 e7 18 17 d0 8a 1a f1 96 66 94 ee c1 dd 7f b4 1a 8c 98 45 7a 28 7b d8 5e 6b e1 90 b6 e4 b1 cb 91 7e 9b b5 94 1f 99 1c 13 7b cc 05 81 f2 fb 2b 6b 46 56 16 b6 80 ae 6e 1d 85 21 f5 c2 b6 f9 2d 1d 0a 0d e6 32 46 aa 98 67 56 39 65 b8 4b b6 ee a6 7d c9 6e 51 8b 14 f7 06 b7 e6 f2 16 f9 6c 12 ed 03 a5 b1 31 d0 c5 d9 00 91 de 76 2e 2f fb ab ad c5 3f eb 04 ed 4d 98 28 f1 ae 9e 8b 9d 60 af 99 4d 4b 79 56 9f de 20 1e 99 96 fd 5d 95 d7 84 cd d5 36 79 49 6b 44 a0 d4 43 b7 53 23 e5 2c 8f 38 bb 74 30 bb 48 45 9a db c7 09 0e 10 e4 84 36 34 7f f5 86 71 79 ac 8b e9 00 00 46 2e ab 4e 3b b4 d9 79 2b 7c d2 a3 42 14 46 5e bc 12 f3 6e 75 f9 20 4e c4 06 b5 4d f5 b8 16 1d fd 48 58 e9 98 a6 52 fa 95 34 92 9f db d9 18 c6 dc 13 35 17 5e 6d 43 19 4f 34 fe 08 fd b0 73 b2 97 92 5e 8d d5 9c ee fe f8 0a 62 11 10 ff 02 c3 31 17 19 80 38 1d 6b 7b f1 6f cd b9 56 fe 49 1b a2 e0 44 0c e8 f5 65 29 d4 21 9c 03 ab 3b cd cd 8a 6f 4f ee c7 b2 5d 87 91 ee 9f a9 d2 95 57 55 d2 42 93 a1 ae 42 f2 03 38 87 3e c5 b9 a5 fe 79 da 6c d0 26 99 25 d4 78 c6 cf c1 5f f5 9f 55 d7 00 56 12 95 7e 72 c2 8d 54 96 e8 4f 65 16 7e 80 64 cb 3a 5b 43 53 62 40 d9 94 2f 3f 33 a4 95 ae 31 b1 ac b3 50 b1 22 ff 85 68 52 4b 5c ba 87 a3 f8 5c }
    condition:
        any of them
}

rule CrowdStrike_CSIR_13013_03 : silent_chollima rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "HTTP delimiters used in SILENT CHOLLIMA malware"
        reports = "CSIR-13013,CSIR-13014"
        version = "201301230000"
        last_modified = "2013-01-23"
        actor = "SILENT CHOLLIMA"
    strings:
        $delim1 = "-----------------------------7d414e351603fa"
        $delim2 = "-----------------------------6e8fad908fe13c"
    condition:
        any of them
}

rule CrowdStrike_CSIT_13003_01 : rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Strings from RAT disguised as Outlook Add In"
        reports = "CSIT-13003"
        version = "201301230000"
        last_modified = "2013-01-23"
    strings:
        $vista = "VST%d.%d.%d.%s"
        $w7 = "W7%d.%d.%d.%s"
        $shell = "cmdshell closed"
        $mput = "mput over&bingle"
        $wpipe = "Create wpipe fail"
        $err = "ErrCom0"
        $keys = "\\/*<>|"
    condition:
        2 of them
}

rule CrowdStrike_CSIT_13023_02 : carberp trojan unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Strings used in Carberp, present in unpacked memory"
        reports = "CSIT-13023"
        version = "201301230000"
        last_modified = "2013-01-23"
        malware_family = "Carberp"
    strings:
        $driver = "system32\\drivers\\A-PI.sys"
        $screen = "===> <Screen%d>"
        $nod = "NOD32 ignore file" wide
        $version = "_BT_VER:1.3.0"
    condition:
        3 of them
}

rule CrowdStrike_CSIT_13032_03 : silent_chollima hastiti wiper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "SILENT CHOLLIMA Hastiti wiper"
        reports = "CSIT-13032"
        version = "201301230000"
        last_modified = "2013-01-23"
        actor = "SILENT CHOLLIMA"
        malware_family = "Hastiti"
    strings:
        $job_generic_plain = { 30 31 31 32 2d 43 52 41 53 38 34 36 38 2d ?? ?? ?? ?? 30 39 32 33 2D 50 43 49 38 32 37 33 56 }
        $prin1 = "PRINCPES"
        $prin2 = "PR!NCPES"
        $has = "HASTATI."
        $fn = "\\Temp\\~v3.log"
    condition:
        2 of them
}

rule CrowdStrike_CSIT_13032_07 : silent_chollima dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "SILENT CHOLLIMA tool - RAT Dropper"
        reports = "CSIT-13032"
        version = "201301230000"
        last_modified = "2013-01-23"
        actor = "SILENT CHOLLIMA"
    strings:
        $temp = "%sw7e89.tmp"
        $svc = "%sSVCHOST.exe"
        $stringdecloop = { a3 ?? ?? ?? ?? 58 48 f6 90 ?? ?? ?? ?? 75 f7 }
    condition:
        all of them
}

rule CrowdStrike_CSIT_13032_10 : silent_chollima loader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "SILENT CHOLLIMA - 3RAT client loader (RC4-encrypted loader)"
        reports = "CSIT-13032"
        version = "201301230000"
        last_modified = "2013-01-23"
        actor = "SILENT CHOLLIMA"
    strings:
        $rc4_imp_crypt1 = { ab 95 df 41 53 57 8f df 61 4b dd 61 53 e3 55 dd 41 4b 57 41 53 df 41 43 65 41 5a 14 6e 18 45 20 8a }
        $rc4_imp_crypt2 = { 0a 4a 7f 9f f2 88 2f 01 c0 94 7d bf f2 3c f5 03 e0 94 f7 9f f2 00 e1 9d c4 9e fa ca a4 01 b0 7b 77 4a e5 b0 fc d2 80 53 }
        $rc4_imp_crypt3 = { b0 42 0e a1 48 80 5e 3f 7a 9c 0c 81 48 34 84 3d 5a 9c 86 a1 48 08 90 a3 7e 96 8b f4 }
        $rc4_unxor = { 58 33 ?? 83 ?? 00 74 0b 40 31 ?c ?8 83 c? 04 3b ?? 7c f6 }
        $rc4_imp_plain1 = { fe c0 8a 14 06 02 da 8a 34 1e 88 34 06 b6 00 88 14 1e 02 14 06 8a 14 16 30 14 0f 41 3b 4d 10 75 df }
        $rc4_img_plain2 = { fe c0 8a 14 06 02 da 8a 34 1e 88 34 06 b6 00 88 14 1e 02 14 06 8a 14 16 30 14 0f 41 50 8b 45 f0 83 c0 10 3b 08 58 75 d8 }
    condition:
        any of them
}

rule CrowdStrike_CSIT_13032_11 : silent_chollima jokra packer 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Jokra Packer artifacts seen in SILENT CHOLLIMA tooling"
        reports = "CSIT-13032"
        version = "201301230000"
        last_modified = "2013-01-23"
        actor = "SILENT CHOLLIMA"
    strings:
        $outermain1 = { 8b 44 24 04 50 ff 90 58 02 00 00 59 33 c0 }
        $outermain2 = { 8b 44 24 04 6a 01 ff 50 48 c3 }
        $outermain3 = { 8b 44 24 04 50 ff 90 5c 02 00 00 59 33 c0 }
        $hash_filemap = { 9e 4c d4 8e }
        $hash_closehandle = { fb 97 fd 0f }
    condition:
        any of ($outermain*) and all of ($hash*)
}

rule CrowdStrike_CSIT_13006_01 : violin_panda downloader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Downloader used by VIOLIN PANDA"
        reports = "CSIT-13006"
        version = "201807271434"
        last_modified = "2018-07-27"
        actor = "VIOLIN PANDA"
    strings:
        $marker1 = "TOYOT"
        $marker2 = "pipe"
        $xorkey1 = { 04 12 2b 34 37 55 47 4a 28 6b 43 23 32 4c }
        $xorkey2 = { 23 12 02 11 10 12 21 25 53 4a 61 25 47 31 }
    condition:
        uint16(0) == 0x5A4D and uint32(uint32(0x3C)) == 0x00004550 and 1 of ($marker*) and 1 of ($xorkey*)
}

rule CrowdStrike_CSIT_13005_01 : exforel rootkit 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Exforel Driver"
        reports = "CSIT-13005"
        version = "201301280000"
        last_modified = "2013-01-28"
        malware_family = "Exforel"
    strings:
        $stdin1 = "\\\\.\\Pipe\\x141_stdin"
        $stdout1 = "\\\\.\\Pipe\\x141_stdout"
        $stdin2 = "\\??\\pipe\\x141_stdin" wide
        $stdout2 = "\\??\\pipe\\x141_stdout" wide
    condition:
        all of them
}

rule CrowdStrike_CSIT_13007_01 : anchor_panda dropper tornrat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Anchor Panda TornRAT Dropper"
        reports = "CSIT-13007"
        version = "202005141323"
        last_modified = "2020-05-14"
        actor = "ANCHOR PANDA"
        malware_family = "TornRAT"
    strings:
        $key = "abcdefghijkTorNewForU"
    condition:
        $key
}

rule CrowdStrike_CSIT_13007_02 : anchor_panda rat tornrat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Anchor Panda TornRAT"
        reports = "CSIT-13007"
        version = "202005141323"
        last_modified = "2020-05-14"
        actor = "ANCHOR PANDA"
        malware_family = "TornRAT"
    strings:
        $errorstring = "Something illeagal"
        $uninstcmd = "Rundll32 %s,RundllUninstall"
    condition:
        all of them
}

rule CrowdStrike_CSIT_13010_01 : recyclerrat rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Recycler RAT"
        reports = "CSIT-13010"
        version = "201301300000"
        last_modified = "2013-01-30"
        malware_family = "RecyclerRAT"
    strings:
        $xordecoder = { 8b c6 bf c4 00 00 00 99 f7 ff 30 11 41 46 3b 74 24 10 7c ec }
    condition:
        // 0x4DA7BB3D is a fixed build timestamp of Fri Apr 15 05:27:57 2011
        uint16(0) == 0x5A4D and uint32(uint32(0x3C)) == 0x00004550 and uint32(uint32(0x3c) + 8) == 0x4DA7BB3D and $xordecoder
}

rule CrowdStrike_CSIT_13015_01 : stabuniq rat key 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Stabuniq RAT"
        reports = "CSIT-13015"
        version = "201301300000"
        last_modified = "2013-01-30"
    strings:
        $rc4key = "*&^%$)*^Asd8623jDs"
    condition:
        all of them
}

rule CrowdStrike_CSIT_13010_02 : dropper recyclerrat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Recycler RAT Dropper or encoded RAT resource"
        reports = "CSIT-13010"
        version = "201905200802"
        last_modified = "2019-05-20"
    strings:
        $encrsrc = { 4d 5b 92 03 07 05 06 07 0c 09 0a 0b f3 f2 0e 0f a8 11 12 13 14 15 16 17 58 19 1a 1b 1c 1d 1e 1f 20 21 22 23 24 25 26 27 28 29 2a 2b 2c 2d 2e 2f 30 31 32 33 34 35 36 37 38 39 3a 3b }
    condition:
        $encrsrc
}

rule CrowdStrike_CSIT_13011_01 : comment_panda rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects RAT"
        reports = "CSIT-13011"
        version = "201301310000"
        last_modified = "2013-01-31"
        actor = "COMMENT PANDA"
    strings:
        $req = "Reqfile not exist!"
        $up = "upfile over!"
    condition:
        any of them
}

rule CrowdStrike_CSIT_13012_01 : heartbeat rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Heartbeat RAT"
        reports = "CSIT-13012"
        version = "201301310000"
        last_modified = "2013-01-31"
        malware_family = "HeartBeat"
    strings:
        $xorloop = { 8a 5c 04 1c 80 f3 02 88 5c 04 1c 40 3d 00 08 00 00 7c ed }
    condition:
        $xorloop
}

rule CrowdStrike_CSIT_13012_02 : heartbeat rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Heartbeat RAT"
        reports = "CSIT-13012"
        version = "201301310000"
        last_modified = "2013-01-31"
        malware_family = "HeartBeat"
    strings:
        $xorloop = { 80 74 04 14 02 40 3d 00 08 00 00 7c f3 }
        $strdecloop = { 8a d0 02 d1 30 10 40 4e 75 f6 }
    condition:
        all of them
}

rule CrowdStrike_CSIT_13012_03 : heartbeat rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Heartbeat RAT"
        reports = "CSIT-13012"
        version = "201301310000"
        last_modified = "2013-01-31"
        malware_family = "HeartBeat"
    strings:
        $logmsg = "HeartBeat Fail ReConnect.. OK!"
    condition:
        $logmsg
}

rule CrowdStrike_CSIT_13013_01 : magicfire rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "MagicFire RAT"
        reports = "CSIT-13013"
        version = "201301310000"
        last_modified = "2013-01-31"
        actor = "VIXEN PANDA"
        malware_family = "MagicFire RAT"
    strings:
        $cfg_decode = { 33 c0 00 80 68 a9 40 00 40 3d e4 01 00 00 72 f2 c3 }
        $snapshot = "CreateToolhelp32Snapshot Fail = %d"
    condition:
        any of them
}

rule CrowdStrike_CSIT_13014_01 : silent_chollima 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "SILENT CHOLLIMA Service DLL"
        reports = "CSIT-13014"
        version = "201301310000"
        last_modified = "2013-01-31"
        actor = "SILENT CHOLLIMA"
    strings:
        $xorloop = { a8 01 75 05 80 f1 34 eb 03 80 f1 25 }
    condition:
        $xorloop
}

rule CrowdStrike_CSIT_13014_02 : silent_chollima dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "SILENT CHOLLIMA dropper"
        reports = "CSIT-13014"
        version = "201301310000"
        last_modified = "2013-01-31"
        actor = "SILENT CHOLLIMA"
    strings:
        $rsrcpattern = { 28 00 00 00 03 00 00 00 03 00 00 00 01 00 04 00 00 00 00 00 0c 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 80 00 00 80 00 00 00 80 80 00 80 00 00 00 80 00 80 00 80 80 00 00 c0 c0 c0 00 80 80 80 00 00 00 ff 00 00 ff 00 00 00 ff ff 00 ff 00 00 00 ff 00 ff 00 ff ff 00 00 ff ff ff 00 ff f0 00 00 ff f0 00 00 ff f0 00 00 }
    condition:
        $rsrcpattern
}

rule CrowdStrike_CSIT_13020_01 : back_orifice rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects variant of Back Orifice, based off the BOXP RAT open source fork"
        reports = "CSIT-13020"
        version = "201301310000"
        last_modified = "2013-01-31"
    strings:
        $error1 = "query cookie failed..."
        $error2 = "query content-length failed..."
        $error3 = "query content-type failed..."
        $pid = "Current Process id is %d"
    condition:
        all of them
}

rule CrowdStrike_CSIT_13004_01 : rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "RAT with proxying features"
        reports = "CSIT-13004"
        version = "201302010000"
        last_modified = "2013-02-01"
    strings:
        $error = "Timeout & QUIT!!!"
        $cmdline = "ewr:m:s:h:p:t:b:d:n:w:x:g:k:"
        $import_mask = { b1 65 b2 72 88 4c 24 ?e 88 4c 24 ?1 88 4c 24 ?6 b1 73 88 4c 24 ?7 88 4c 24 ?8 b1 57 88 54 24 ?d 88 4c 24 ?9 88 4c 24 }
    condition:
        2 of them
}

rule CrowdStrike_CSIT_13004_02 : rootkit 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Possible rootkit component"
        reports = "CSIT-13004"
        version = "201302010000"
        last_modified = "2013-02-01"
    strings:
        $mod_ssdt = { 0f b7 03 8b 0d a4 29 01 00 8b 09 8b 55 18 8d 0c 81 8b 01 89 43 04 89 02 8b 55 10 89 53 08 66 c7 43 02 01 00 fa 0f 20 c0 25 ff ff fe ff 0f 22 c0 }
    condition:
        $mod_ssdt
}

rule CrowdStrike_CSIT_13016_01 : downloader pickaxe_panda 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "PICKAXE PANDA downloader"
        reports = "CSIT-13016"
        version = "202103092123"
        last_modified = "2021-03-09"
        actor = "PICKAXE PANDA"
    strings:
        $certserial = { 20 ca a2 06 47 7f 02 44 cd 56 99 82 ee 90 1e 21 }
        $beaconhdr = { c7 70 1d 29 99 5f ae 42 81 b6 91 bb 1d 87 2e 3b 88 77 e6 41 20 f8 7b 4c 84 81 97 57 14 7d 76 0c }
        $logmsg = "%s can't be openedn"
    condition:
        filesize < 1MB and
        (uint16(0) == 0x5A4D and uint32(uint32(0x3C)) == 0x00004550) and (any of them)
}

rule CrowdStrike_CSIT_13018_01 : comment_panda rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects RAT used by COMMENT PANDA"
        reports = "CSIT-13018"
        version = "201302020000"
        last_modified = "2013-02-02"
        actor = "COMMENT PANDA"
    strings:
        $key = "1234567890123456\x00"
        $b64 = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\x00"
        $you = "you specify service name not in Svchost"
    condition:
        all of them
}

rule CrowdStrike_CSIT_14004_01 : deep_panda webshell 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "DEEP PANDA ASP.NET webshell"
        reports = "CSIT-14004"
        version = "201302030000"
        last_modified = "2013-02-03"
        actor = "DEEP PANDA"
    strings:
        $cookie  = "Cookies[\"zWiz\"]"
        $cp = "IndexOf(\"es-DN\")"
        $keep_alive = "[\"Keep-Alive\"] == \"320\""
    condition:
        any of them
}

rule CrowdStrike_CSIT_14005_01 : certificate keylogger revealer_keylogger 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Logixoft certificate serial number, used to sign Revealer keylogger"
        reports = "CSIT-14005"
        version = "201910101656"
        last_modified = "2019-10-10"
    strings:
        $cn = "Logixoft"
        $serial = { 5b 18 b5 68 17 4d c2 d6 47 ec 70 ed 13 cc bb 8d }
    condition:
        uint16(0) == 0x5a4d and
        $cn and $serial
}

rule CrowdStrike_CSIT_14005_02 : keylogger revealer_keylogger 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Revealer Keylogger default secondary XOR key"
        reports = "CSIT-14005"
        version = "202101201535"
        last_modified = "2021-01-20"
        malware_family = "Revealer Keylogger"
    strings:
        $key = "cd46a1a84ba06cea35d5e0219062162f227fdb26"
    condition:
        $key
}

rule CrowdStrike_CSIT_13102_01 : adwind rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Adwind Java RAT"
        reports = "CSIT-13102"
        version = "201302120000"
        last_modified = "2013-02-12"
        malware_family = "Adwind"
    strings:
        $magic = { 50 4b 03 04 } // PK header
        $metainf = "META-INF"
        $class = ".class" nocase
        $adwind_2 = "stub.adwind" nocase
        $adwind_3 = "AdwindServer.class" nocase
        $adwind_4 = "UnrecomServer.class" nocase
    condition:
        $magic at 0 and
        1 of ($metainf, $class) and
        1 of ($adwind_*)
}

rule CrowdStrike_CSIR_13007_02 : aurora certificate artifact 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Executables signed by AURORA PANDA using a Bit9 code signing certificate"
        reports = "CSIR-13007"
        version = "201302180000"
        last_modified = "2013-02-18"
        actor = "AURORA PANDA"
    strings:
        $serial = { 4f 2e f2 9c a5 f9 6e 57 77 b8 2c 62 f3 4f d3 a6 }
    condition:
        uint16(0) == 0x5A4D and uint32(uint32(0x3C)) == 0x00004550 and $serial
}

rule CrowdStrike_CSIR_13004_01 : vixen_panda dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "VIXEN PANDA family 3 dropper config encoder"
        reports = "CSIT-13004"
        version = "201302210000"
        last_modified = "2013-02-21"
        actor = "VIXEN PANDA"
    strings:
        $encprog = { B2 5E 43 4F 9E 4E 74 4B 41 74 4B 79 8E 43 4B 78 78 77 4E BA 7C 41 BA 54 53 48 8A 45 58 8E 66 7B 75 86 47 4B 42 41 }
    condition:
        all of them
}

rule CrowdStrike_CSIR_13004_02 : artifact rat vixen_panda 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "VIXEN PANDA family 3 C2 delimiting string"
        reports = "CSIT-13004"
        version = "201908200846"
        last_modified = "2019-08-20"
        actor = "VIXEN PANDA"
    strings:
        $d1 = { 00 28 28 28 28 28 28 00 }
        $d2 = { 00 29 29 29 29 29 29 29 00 }
        $d3 = { 00 5e 5e 5e 5e 5e 00 }
        $d4 = { 00 3e 3e 3e 3e 3e 3e 3e 00 }
        $d5 = { 00 3c 3c 3c 3c 3c 3c 00 }
        $d6 = { 00 5e 5e 5e 5e 5e 00 }
        $cmd = "cmd.exe" ascii wide
    condition:
        uint16(0) == 0x5a4d and
        (($d1 and $d2 and $d3) or ($d4 and $d5 and $d6)) and
        $cmd
}

rule CrowdStrike_CSIR_13004_03 : vixen_panda dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "VIXEN PANDA family 3 PDB names"
        reports = "CSIT-13004"
        version = "201302210000"
        last_modified = "2013-02-21"
        actor = "VIXEN PANDA"
    strings:
        $pdb1 = "e:\\DebugBmw1.0\\BMW\\release\\Large.pdb"
        $pdb2 = "c:\\bao\\bmw\\release\\bmw.pdb"
        $pdb3 = ":\\Bmw(AES)\\BMW\\release\\Large.pdb"
    condition:
        any of them
}

rule CrowdStrike_CSIR_13004_05 : vixen_panda iexiaoma rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "VIXEN PANDA IExiaomaRAT RAT"
        reports = "CSIT-13004"
        version = "201302210000"
        last_modified = "2013-02-21"
        actor = "VIXEN PANDA"
        malware_family = "IExiaomaRAT"
    strings:
        $configdecoder = { 40 83 f8 68 72 f? }
        $syslog = "\\sys_log.log"
        $pipe = "pipe\\hE110"
        $delim = "^^^^^\x00"
        $fn = "wuacult.txt"
    condition:
        2 of them
}

rule CrowdStrike_CSIR_13004_06 : vixen_panda bs2005 rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "VIXEN PANDA BS2005 variant RAT"
        reports = "CSIT-13004"
        version = "201302210000"
        last_modified = "2013-02-21"
        actor = "VIXEN PANDA"
        malware_family = "BS2005"
    strings:
        $encprog = { 02 d0 80 c2 7c 32 d0 }
    condition:
        all of them
}

rule CrowdStrike_CSIT_13030_01 : silent_chollima hastiti wiper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "SILENT CHOLLIMA Hastiti wiper"
        reports = "CSIT-13030"
        version = "201302220000"
        last_modified = "2013-02-22"
        actor = "SILENT CHOLLIMA"
        malware_family = "Hastiti"
    strings:
        $princpes1 = { ff 50 52 49 4e ?? ?? 03 43 49 50 45 ?? ?? 07 53 }
        $princpes2 = { ff 50 52 21 4e ?? ?? 03 43 50 45 53 }
        $hastati = { ff 48 41 53 54 ?? ?? 03 41 54 49 2e }
    condition:
        any of them
}

rule CrowdStrike_CSIT_13030_02 : silent_chollima hastiti wiper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "SILENT CHOLLIMA Hastiti wiper"
        reports = "CSIT-13030"
        version = "201302220000"
        last_modified = "2013-02-22"
        actor = "SILENT CHOLLIMA"
        malware_family = "Hastiti"
    strings:
        $job = "JO840112-CRAS8468-11150923-PCI8273V"
        $prin1 = "PRINCPES"
        $prin2 = "PR!NCPES"
        $has = "HASTATI"
        $fn = "\\Temp\\~v3.log"
    condition:
        2 of them
}

rule CrowdStrike_CSIT_13026_01 : downloader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detection for CSIT-13026 and CSIR-13009 Trojan Downloader (Generic)"
        reports = "CSIT-13026,CSIR-13009"
        version = "201807251355"
        last_modified = "2018-07-25"
    strings:
        $GetCommandLine = "GetCommandLine"
        $GetModuleFileNameA = "GetModuleFileNameA"
        $CreateToolhelp32Snapshot = "CreateToolhelp32Snapshot"
        $Process32First = "Process32First"
        $OpenProcess = "OpenProcess"
        $TerminateProcess = "TerminateProcess"
        $CloseHandle = "CloseHandle"
        $Process32Next = "Process32Next"
        $Sleep = "Sleep"
        $SetFileAttributesA = "SetFileAttributesA"
        $CopyFileA = "CopyFileA"
        $CreateProcessA = "CreateProcessA"
        $GetEnvironmentVariableA = "GetEnvironmentVariableA"
        $CreateDirectoryA = "CreateDirectoryA"
        $RegOpenKeyA = "RegOpenKeyA"
        $RegSetValueExA = "RegSetValueExA"
        $RegCloseKey = "RegCloseKey"
        $MessageBoxA = "MessageBoxA"
        $GetTempPathA = "GetTempPathA"
        $GetTickCount = "GetTickCount"
        $push400 = { 68 00 04 00 00 }
        $push200 = { 68 00 02 00 00 }
        $cmpBackslash = { 83 F? 5C }
        $708 = { 08 07 00 00 }
        $add78 = { 83 C? 78 }
        $push7D0 = { 68 D0 07 00 00 }
        $push80 = { 68 80 00 00 00 }
        $push2 = { 6A 02 }
        $push3E8 = { 68 E8 03 00 00 }
        $push80000001 = { 68 01 00 00 80 }
        $push1010 = { 68 10 10 00 00 }
        $shr9 = { C1 E? 09 }
        $add55 = { 83 C? 55 }
        $cmpSlash = { 83 F? 2F }
        $push202 = { 68 02 02 00 00 }
        $pushForSocket = { 6A 06 6A 01 6A 02 }
        $push15F90 = { 68 90 5F 01 00 }
        $peHeader = { 50 45 00 00 4C 01 03 00 ?? ?? ?? ?? 00 00 00 00 00 00 00 00 E0 00 03 01 0B 01 09 00 00 F4 02 00 00 E4 00 00 00 00 00 00 ?? ?? ?? ?? 00 10 00 00 00 10 03 00 00 00 40 00 00 10 00 00 00 02 00 00 05 00 00 00 00 00 00 00 05 00 00 00 00 00 00 00 00 10 04 00 00 04 00 00 00 00 00 00 02 00 00 80 00 00 10 00 00 10 00 00 00 00 10 00 00 10 00 00 00 00 00 00 10 00 00 00 00 00 00 00 00 00 00 00 ?? ???? ?? B4 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 18 45 03 00 40 00 00 00 00 00 00 00 00 00 00 00 00 10 03 00 EC 03 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 2E 74 65 78 74 00 00 00 ?? ?? ?? ?? 00 10 00 00 00 F4 02 00 00 04 00 00 00 00 00 00 00 00 00 00 00 00 00 00 20 00 00 60 2E 72 64 61 74 61 00 00 ?? ?? ?? ?? 00 10 03 00 00 72 00 00 00 F8 02 00 00 00 00 00 00 00 00 00 00 00 00 00 40 00 00 40 2E 64 61 74 61 00 00 00 ?? ?? ?? ?? 00 90 03 00 00 38 00 00 00 6A 03 00 00 00 00 00 00 00 00 00 00 00 00 00 40 00 00 C0 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 }
    condition:
        $peHeader at uint32(0x3C) and 35 of ($*)
}

rule CrowdStrike_CSIR_13007_01 : aurora rat9002 rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "9002 RAT used by AURORA PANDA"
        reports = "CSIR-13007"
        version = "201303110000"
        last_modified = "2013-03-11"
        actor = "AURORA PANDA"
        malware_family = 9002
    strings:
        $mutexname = "rat_UnInstall" wide
        $targetprocess = "McpRoXy.exe" wide
        $cmdline = "rundll32.exe \"%s\", Launch" wide
    condition:
        all of them
}

rule CrowdStrike_CSIR_12010_01 : karma_panda certificate 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Certificate used to sign a binary related to KARMA PANDA malware"
        reports = "CSIR-12010"
        version = "201303140000"
        last_modified = "2013-03-14"
        actor = "KARMA PANDA"
    strings:
        $pubkey = { 30 82 01 0a 02 82 01 01 00 eb ff 9a 43 d0 1e 4c b9 20 1f 57 c0 40 6b cb 29 2a f7 00 c5 aa 92 58 21 ee 1a e0 eb 55 7a 63 ad 45 3a 69 5c b3 cc 55 be fe d6 4b ef 6a 4a c1 f3 c3 8b 19 ba d3 c1 19 58 95 43 43 99 78 fc ff f4 91 a6 76 f8 04 88 da 49 a9 a3 92 cd 82 60 21 35 ae fc 37 25 ce 3a cc 13 f9 cf b2 b6 3a 6d c2 42 9f 1c 4e f9 6f fa 0d 93 6f 03 bb 2d 55 3f 25 1a 3c 1b 95 2e 69 89 a7 a4 ed 25 79 37 22 4e 1a f8 ff df 3a 01 f0 ee a5 cd e6 9c 19 77 c2 d7 15 57 ba c9 54 db b0 ea 1c 5d 0e 2f c5 e1 f3 5d 8c 8c c5 fd 28 58 06 ae 13 79 01 5a be 1f a1 59 3b a5 ea 28 c8 ea 62 5b d3 87 65 53 23 0a 4b d2 7b 42 47 5e a1 32 29 5c 4c 71 c9 19 f5 49 04 d4 2e 41 63 bd bf 17 06 73 7e ec 9c fe 6f 4e e1 a6 0f c8 55 0e c1 33 ba cb 48 22 f9 fc 35 cc fc b7 2b 78 fa 85 88 2a ab e0 d0 22 3c 49 6c 16 ef f5 57 b5 02 03 01 00 01 }
    condition:
        all of them
}

rule CrowdStrike_CSIR_13010_01 : samurai_panda rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "SAMURAI PANDA RAT"
        reports = "CSIR-13010"
        version = "201303280000"
        last_modified = "2013-03-28"
        actor = "SAMURAI PANDA"
    strings:
        $dllname = "Nfcore.dll"
        $export = "ProcGo"
        $eventname = "nfcoreok" nocase ascii wide
        $useragent = "Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.0; .NET CLR 1.1.4322)" wide
    condition:
        all of them
}

rule CrowdStrike_CSIR_13010_02 : samurai_panda config 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Identifies configuration data used by SAMURAI PANDA malware"
        reports = "CSIR-13010"
        version = "201807300859"
        last_modified = "2018-07-30"
        actor = "SAMURAI PANDA"
    strings:
        $confstart = { 13 2b 38 29 3a 15 45 42 25 17 01 0c 75 03 00 }
    condition:
        $confstart
}

rule CrowdStrike_CSIR_13010_03 : samurai_panda config 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Identifies configuration data used by SAMURAI PANDA malware, embedded in DLL"
        reports = "CSIR-13010"
        version = "201303280000"
        last_modified = "2013-03-28"
        actor = "SAMURAI PANDA"
    strings:
        $confstart = { 9a 19 28 39 08 fa ff 8f f9 da bb 6b fc 9b ab }
    condition:
        any of them
}

rule CrowdStrike_CSIR_13010_04 : samurai_panda config 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Identifies configuration data used by SAMURAI PANDA malware, embedded in dropper"
        reports = "CSIR-13010"
        version = "201303280000"
        last_modified = "2013-03-28"
        actor = "SAMURAI PANDA"
    strings:
        $confstart = { 97 00 67 22 86 b9 b7 44 97 00 67 22 86 b9 b7 }
    condition:
        any of them
}

rule CrowdStrike_CSIR_13010_05 : samurai_panda dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "SAMURAI PANDA dropper"
        reports = "CSIR-13010"
        version = "201303280000"
        last_modified = "2013-03-28"
        actor = "SAMURAI PANDA"
    strings:
        $helloworld = "Hello World!" wide
        $shellstr1 = "comspec" nocase
        $shellstr2 = " /a /c" nocase
        $shellstr3 = "cmd.exe" nocase
        $wtemplet = "wtemplet" wide nocase
    condition:
        all of them
}

rule CrowdStrike_CSIR_13010_06 : samuraipanda downloader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Downloader used by SAMURAI PANDA"
        reports = "CSIR-13010"
        version = "201303280000"
        last_modified = "2013-03-28"
        actor = "SAMURAI PANDA"
    strings:
        $dllname = "Nfclient.dll"
        $export1 = "RundllInstallA"
        $export2 = "RundllUninstallA"
        $ua1 = "/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1)"
        $ua2 = "/5.0 (compatible; MSIE 7.0;Windows NT 5.1)"
    condition:
        $dllname and $export1 and $export2 and ($ua1 or $ua2)
}

rule CrowdStrike_CSIT_13031_01 : credential_dumper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detection for Browser Password Decryptor identified in incident described in CSIT-13031."
        reports = "CSIT-13031"
        version = "201303290000"
        last_modified = "2013-03-29"
    strings:
        $s1 = "Browser Password Recovery Report"
        $s2 = "BrowserPasswordDecryptor"
        $s3 = "www.SecurityXploded.com"
    condition:
        all of them
}

rule CrowdStrike_CSIT_13031_02
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detection for Chunked File Uploader identified in incident described in CSIT-13031."
        reports = "CSIT-13031"
        version = "201303290000"
        last_modified = "2013-03-29"
    strings:
        $s1 = "C:\\Users\\BERNARDINO\\AppData\\Roaming\\berna@consultoreslegales.com.mx (1).pst"
    condition:
        all of them
}

rule CrowdStrike_CSIT_13031_03 : credential_dumper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detection for Mail Password Decryptor identified in incident described in CSIT-13031."
        reports = "CSIT-13031"
        version = "201303290000"
        last_modified = "2013-03-29"
    strings:
        $s1 = "Mail Password Recovery Report"
        $s2 = "MailPasswordDecryptor"
        $s3 = "www.SecurityXploded.com"
    condition:
        all of them
}

rule CrowdStrike_CSIT_13031_04
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detection for File Splitter identified in incident described in CSIT-13031."
        reports = "CSIT-13031"
        version = "201303290000"
        last_modified = "2013-03-29"
    strings:
        $s1 = "C:\\Users\\apant\\Documents\\Programdata\\abacus.ost"
    condition:
        all of them
}

rule CrowdStrike_CSIT_13031_05
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detection for Process Killer identified in incident described in CSIT-13031."
        reports = "CSIT-13031"
        version = "201303290000"
        last_modified = "2013-03-29"
    strings:
        $s1 = "cmd.exe /c taskkill /f /t /im hkcrn.exe" wide
        $s2 = "C:\\Users\\SymphonyPD\\AppData\\Local\\Temp\\programs\\hkcrn.exe" wide
    condition:
        all of them
}

rule CrowdStrike_CSIT_13031_06
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detection for Screenshot Uploader identified in incident described in CSIT-13031."
        reports = "CSIT-13031"
        version = "201303290000"
        last_modified = "2013-03-29"
    strings:
        $s1 = "http://researcherzone.net/yash/photox/upload.php" wide
    condition:
        all of them
}

rule CrowdStrike_CSIR_12017_01 : audinet rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Audinet RAT"
        reports = "CSIR-12017"
        version = "201304040000"
        last_modified = "2013-04-04"
        malware_family = "Audinet"
    strings:
        $widget_add = {8a 1? 80 c? ?? 88 1? 0f b6 1? 81 e? 01 00 00 80 79 05 }
        $widget_sub = {8a 1? 80 e? ?? 88 1? 0f b6 1? 81 e? 01 00 00 80 79 05 }
    condition:
        $widget_add or $widget_sub
}

rule CrowdStrike_CSIR_12024_01 : deep_panda derusbi rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Strings located in Derusbi malware"
        reports = "CSIR-12024"
        version = "201304040000"
        last_modified = "2013-04-04"
        actor = "DEEP PANDA"
        malware_family = "Derusbi"
    strings:
        $isapi = "ISAPI_CONNECT"
        $bdsock = "BD_SOCK"
        $bddns = "BD_DNS"
        $pcsock = "PCC_SOCK"
        $pcc = "PCC_PROXY"
        $webprox= "PCC_WEBPROXY"
    condition:
        2 of them
}

rule CrowdStrike_CSIR_12026_01 : vixen_panda rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Rule for VIXEN PANDA RAT"
        reports = "CSIR-12026"
        version = "201304040000"
        last_modified = "2013-04-04"
        actor = "VIXEN PANDA"
    strings:
        $query1 = "?hl=en&q=%s&meta="
        $query2 = "?hl=en&meta="
        $pdb1  = "MirageFox_Server.pdb"
    condition:
        any of them
}

rule CrowdStrike_CSIR_12029_01 : temper_panda poisonivy dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Identifies PoisonIvy dropper file used by TEMPER PANDA. Triggers on a Portable Executable resource in Latin-1 encoding called BINDATA that starts with an x64 function prologue to set up a stack frame."
        reports = "CSIR-12029"
        version = "201304040000"
        last_modified = "2013-04-04"
        actor = "TEMPER PANDA"
        malware_family = "PoisonIvy"
    strings:
        // dword 1: codepage (1252 = LATIN-1)
        // dword 2: reserved
        // byte: length of resource type name (7)
        // resource type name as unicode string ("BINDATA")
        // 3 bytes: encoded version of PUSH EBP, MOV EBP, ESP
        // (the poison ivy section starts with a function prolog)
        $temper_panda_pivy_resource= { e4 04 00 00 00 00 00 00 07 00 42 00 49 00 4e 00 44 00 41 00 54 00 41 00 e0 16 2d }
    condition:
        $temper_panda_pivy_resource
}

rule CrowdStrike_CSIR_12032_01 : vixen_panda mirage rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Looks for strings in primary Mirage RAT component"
        reports = "CSIR-12032"
        version = "201304040000"
        last_modified = "2013-04-04"
        actor = "VIXEN PANDA"
        malware_family = "Mirage"
    strings:
        $write = "writedroo"
        $file = "filedroo"
        $cmd = "cmddroo"
        $hupd = "HideUpdatePzfile"
        $hupf = "HideSysUpfile"
        $hcmd = "HideSysCmd"
        $desnation = "Desnation %s is small than finished!"
    condition:
        uint16(0) == 0x5A4D and uint32(uint32(0x3C)) == 0x00004550 and any of them
}

rule CrowdStrike_CSIR_12032_03 : keyhole_panda archy rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Archy malware encoder routine"
        reports = "CSIR-12032"
        version = "201304040000"
        last_modified = "2013-04-04"
        actor = "KEYHOLE PANDA"
        malware_family = "Archy"
    strings:
        $any_rol_xor = { 34 ?? c0 c8 03 34 ?? c0 c8 03 34 ?? c0 c8 03 34 ?? c0 c8 03 34 ?? c0 c8 03 }
    condition:
        any of them
}

rule CrowdStrike_CSIR_12032_04 : keyhole_panda archy dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Archy malware, misspelling of ACCELORATOR"
        reports = "CSIR-12032"
        version = "201304040000"
        last_modified = "2013-04-04"
        actor = "KEYHOLE PANDA"
        malware_family = "Archy"
    strings:
        $accel = { 41 00 43 00 43 00 45 00 4C 00 4F 00 52 00 41 00 54 00 4F 00 52 00 }
    condition:
        uint16(0) == 0x5A4D and uint32(uint32(0x3C)) == 0x00004550 and $accel
}

rule CrowdStrike_CSIR_12032_05 : keyhole_panda rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Looks for strings in MySuperNewGame malware"
        reports = "CSIR-12032"
        version = "201304040000"
        last_modified = "2013-04-04"
        actor = "KEYHOLE PANDA"
    strings:
        $pass = "T1Y943jIhk"
        $confpass = "09lkjds"
        $game = "MYGAMEHAVE"
        $game2 = "THISISASUPERNEWGAMENOWBEGIN"
        $game3 = "THIS324NEWGAME"
    condition:
        uint16(0) == 0x5A4D and uint32(uint32(0x3C)) == 0x00004550 and any of them
}

rule CrowdStrike_CSIT_13001_01 : wet_panda dropper exploit cve_2012_4792 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Targeted attack dropper exploiting CVE-2012-4792, distributed via Strategic Web Compromise attack"
        reports = "CSIT-13001"
        version = "201304040000"
        last_modified = "2013-04-04"
        actor = "WET PANDA"
    strings:
        $gaga = "AVCtest_gagaApp"
        $gaga_enc = { c2 d5 c0 f7 e6 f0 f7 dc e4 e2 e4 e2 c2 f3 f3 }
        $dosstub_enc = { d7 eb ea f0 a3 f3 f1 ec e4 f1 e2 ee a3 e0 e2 ed ed ec f7 a3 e1 e6 a3 f1 f6 ed a3 ea ed a3 c7 cc d0 a3 ee ec e7 e6 }
    condition:
        ($gaga or $gaga_enc) or ($dosstub_enc and #dosstub_enc < 20)
}

rule CrowdStrike_CSIR_12003_01 : impersonating_panda rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "IMPERSONATING PANDA strings"
        reports = "CSIR-12003"
        version = "201304080000"
        last_modified = "2013-04-08"
        actor = "IMPERSONATING PANDA"
    strings:
        $JDK = "JDK541"
        $Bind = "Please input file to bind and destination file name!"
    condition:
        any of them
}

rule CrowdStrike_CSIR_12004_01 : anchor_panda rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "ANCHOR PANDA Strings"
        reports = "CSIR-12004"
        version = "202005141323"
        last_modified = "2020-05-14"
        actor = "ANCHOR PANDA"
    strings:
        $ua = "Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; sv1)"
        $c2str = "!his=9!wn="
        $c2str1 = "!flof="
        $c2str2 = "!fil="
        $c2str3 = "!ps="
    condition:
        all of them
}

rule CrowdStrike_CSIR_12004_02 : anchor_panda rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "ANCHOR PANDA Strings"
        reports = "CSIR-12004"
        version = "201304080000"
        last_modified = "2013-04-08"
        actor = "ANCHOR PANDA"
    strings:
        $sosad = "I am so sad!"
        $sohappy = "I am so happy!"
    condition:
        $sosad and $sohappy
}

rule CrowdStrike_CSIR_12008_01 : toxic_panda artifact 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "TOXIC PANDA Strings"
        reports = "CSIR-12008"
        version = "201304080000"
        last_modified = "2013-04-08"
        actor = "TOXIC PANDA"
    strings:
        $file = "copy_file_to_system.exe"
    condition:
        any of them
}

rule CrowdStrike_CSIR_12008_02 : toxic_panda config 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "TOXIC PANDA config File"
        reports = "CSIR-12008"
        version = "201304080000"
        last_modified = "2013-04-08"
        actor = "TOXIC PANDA"
    strings:
        $header = "[ini]"
        $addr = "addr="
        $port = /port=\d{1,5}/
    condition:
        all of them
}

rule CrowdStrike_CSIR_12011_01 : energetic_bear key 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Energetic Bear RSA Keys, base64 encoded"
        reports = "CSIR-12011"
        version = "202012141557"
        last_modified = "2020-12-14"
        actor = "ENERGETIC BEAR"
    strings:
        $rsakey_prv = "AATnkDHDlO+cOi/6zqUVoaA2DfbTyIoP8y1+Q5MxLfimzeQFgJvk/mdHDjghFl5p2naTmm9y6IAQ2JZpTFhW1WVqC6a8sipU62zO94YwwqtThm+0citlfP4NyEm79c9Qok0S4wG9+87/9FPLbZG9h0DNBTjWDqyoyQP6Hy7r0ty/nwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABpCpH/X6TONDPvyHNS76gFHJl8NMVfiVKtV829QDAbZE9/OCmpPvvQCLGjD6NhMIKmq48INzQHiFO0Sv83OLA18pc18oIfDBtkyBnZRoaIrw3+tnsLwpEtYRtJ3axE4lT8ZBZ6Zu0EPXjqPkqbxH1RqF4pjBx1Rj15Ky/h1J+CwH0FtmugRGp/CISiQDvB3kDRFjp42s0xOyce8jhmSNH5+E2PM3cXqCknRdIf6ZDRO2alMddsTJhPV0S7hl+LNbB8tzetjZ6zRsZL46NGcj2p6bfQ1jMrgwPWI1Run8uin/YjnTyHpecKai3AWGFHo8SR5dJkFpHb07R1wmlMZqOXyVqc0fapRiHe7mXorsBTD2B9pczszVNkm+SUgKy9MOK+ezUeUH0h290XSNR3eyl3j453C2ygeSCAYhrUyESQoGQgF57KDs04pS/uR+3Yd1wr1dUKPfP7xkKZTtlrdqxSZQ+XtLY5PhjySDqT233WsVTl26L10t9rPYp7nE97Godz8DXn8HfCsqRvYwdwfrOD3cpAnBL2u6gU/G5Cvw47QyiCF96iMMPuWVq25/xLj9Zc+aWMtS9+jVKxnlnvdaxIQ=="
        $rsakey_pubm = "AAStvhUWRdUCbz2jXG52xG6OXgtHxG9Qd/ckNJ2tQHZAfxDI/H3lmxy2JXILgri/hpf0taVjAbfsohMc+aBndaYkQa73k/WPXvi8lFFCbKBBGVfj7xo4CmiEC5blZCHDNtE6poNeUFKddcXXQAeGOwcvQmVHSxQn+uHIS+VqetyEaQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAB"
        $rsakey_pub = "AATnkDHDlO+cOi/6zqUVoaA2DfbTyIoP8y1+Q5MxLfimzeQFgJvk/mdHDjghFl5p2naTmm9y6IAQ2JZpTFhW1WVqC6a8sipU62zO94YwwqtThm+0citlfP4NyEm79c9Qok0S4wG9+87/9FPLbZG9h0DNBTjWDqyoyQP6Hy7r0ty/nwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAB"
        $rsakey_config = "GQUFBWkFZAVrBW4FZAV3BWQFawVjBWYFKwVmBWoFaAUzBQUFKgU2BTMFNQUqBXcFYAV2BWoFcAV3BWYFYAV2BSoFaQVkBWsFbgVgBXcFZAVrBSsFdQVtBXUFGwUFBWQFbAVuBWwFYQVqBWIFdwVqBXAFdQUrBWYFagVoBTkFBQUqBWQFawVvBWoFaAVkBWsFKgVsBWsFZgUqBXUFaQVwBWIFbAVrBXYFKgV2BWYFagVpBWkFKwV1BW0FdQUfBQUFdgVsBWYFagUrBXAFYAVwBWoFKwVmBWoFaAUrBQUFKgVgBWsFYgVsBWsFYAUqBWgFagVhBXAFaQVgBXYFKgV2BXcFZgUrBXUFbQV1BSEFBQVkBWkFcgVkBXwFdgUrBWMFdwV"
    condition:
        any of them
}

rule CrowdStrike_CSIR_12011_02 : certificate energetic_bear 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Fake code signing certificate in use by Energetic Bear"
        reports = "CSIR-12011"
        version = "202012141557"
        last_modified = "2020-12-14"
        actor = "ENERGETIC BEAR"
    strings:
        $serial = { 85 48 ac 88 4d 09 ea 93 41 a9 53 69 32 ca ec f3 }
        $emailaddr = "info@ibm.com" nocase
    condition:
        all of them
}

rule CrowdStrike_CSIR_12027_01 : wet_panda plugx dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "PlugX dropper component"
        reports = "CSIR-12027"
        version = "201304080000"
        last_modified = "2013-04-08"
        actor = "WET PANDA"
        malware_family = "PlugX"
    strings:
        $pdb = "C:\\Users\\7\\Desktop\\dll - bak\\Release\\dll.pdb"
    condition:
        any of them
}

rule CrowdStrike_CSIR_12027_04 : wet_panda plugx rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Strings found in PlugX RAT"
        reports = "CSIR-12027"
        version = "201304080000"
        last_modified = "2013-04-08"
        actor = "WET PANDA"
        malware_family = "PlugX"
    strings:
        $demo = "TVT DEMO"
        $destory = "CONFIG-DESTORY"
        $pipe = "\\\\.\\PIPE\\RUN_AT_SESSION (%d)"
    condition:
        any of them
}

rule CrowdStrike_CSIR_12027_05 : plugx rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "PlugX RAT code instructions used to denote version types"
        reports = "CSIR-12027,CSIR-18014,CSIT-13097"
        version = "201810250931"
        last_modified = "2018-10-25"
        malware_family = "PlugX"
    strings:
        $header_plug = { c7 06 47 55 4c 50 }    // mov dword ptr [esi], 'PLUG'
        $header_2012 = { c7 0? 23 01 12 20 }    // mov dword ptr [esi], 20120123h
        $header_2011_2 = { c7 0? 03 04 11 20 }  // mov dword ptr [esi], 20110403h
        $header_2011 = { c7 0? 11 10 11 20 }    // mov dword ptr [esi], 20111011h
        $header_2010_2 = { c7 0? 21 09 10 20 }  // mov dword ptr [esi], 20100921h
        $header_2010 = { c7 0? 08 04 10 20 }    // mov dword ptr [esi], 201000408h
        $header_2009 = { c7 0? 08 02 09 20 }    // mov dword ptr [esi], 20090208h
    condition:
        uint16(0) == 0x5A4D and uint32(uint32(0x3C)) == 0x00004550 and 1 of ($header*)
}

rule CrowdStrike_CSIR_12029_02 : anchor_panda temper_panda samurai_panda shellcode 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "PdPD Shellcode marker"
        reports = "CSIR-12029"
        version = "201304080000"
        last_modified = "2013-04-08"
        actor = "ANCHOR PANDA, TEMPER PANDA, SAMURAI PANDA"
    strings:
        $shellcode_marker = { 50 64 50 44 ef fe ea ae }
    condition:
        $shellcode_marker
}

rule CrowdStrike_CSIR_12035_01 : radio_panda rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Strings found in malware used by RADIO PANDA"
        reports = "CSIR-12035"
        version = "201304080000"
        last_modified = "2013-04-08"
        actor = "RADIO PANDA"
    strings:
        $str1 = "%[^:]:%d,%d,%d"
        $str2 = "run ok!"
        $str3 = "InstallLocation"
        $str4 = "DisplayVersion"
        $str5 = "DisplayName"
        $str6 = " not exist!"
        $wininet  = "Wininet.dll InternetOpenA InternetConnectA HttpOpenRequestA HttpSendRequestA HttpQueryInfoA InternetReadFile InternetCloseHandle"
        $decrypt = { 8b f0 c1 ee 1b c1 e0 05 0b f0 0f be c1 8a 4a 01 03 c6 42 84 c9 75 e9 }
    condition:
        6 of ($str*) or $wininet or $decrypt
}

rule CrowdStrike_CSIR_13001_01 : xtremerat rat installer 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "XtremeRAT installer used in Extreme Gazer campaign"
        reports = "CSIR-13001"
        version = "201304080000"
        last_modified = "2013-04-08"
        malware_family = "XtremeRAT"
    strings:
        $fileHeadBlock = { F0 9E 0C 00 02 7D 5D 2D 2D 58 5B 58 41 1D 33 08 00 20 00 00 00 57 6F 72 64 2E 65 78 65 }
    condition:
        $fileHeadBlock
}

rule CrowdStrike_CSIT_13002_01 : rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "RAT registering as a service using the name 'seclogon'"
        reports = "CSIT-13002"
        version = "201304080000"
        last_modified = "2013-04-08"
    strings:
        $bat = "@net stop seclogon"
        $mutex = "Microsofts&&BillsGods" wide
        $serv_reg = "rundll32.exe %s, OurMain" wide
        $url = "http://sweet" wide
    condition:
        3 of them
}

rule CrowdStrike_CSIT_13009_01 : gh0st rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Gh0st RAT with marker string KrisR"
        reports = "CSIT-13009"
        version = "201304080000"
        last_modified = "2013-04-08"
        malware_family = "Gh0st"
    strings:
        $ep = { 33 c0 74 03 e7 e8 e9 58 b0 73 b1 }
    condition:
        any of them
}

rule CrowdStrike_CSIT_13024_01 : numbered_panda rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Artifact present in RAT used by NUMBERED PANDA"
        reports = "CSIT-13024"
        version = "201304080000"
        last_modified = "2013-04-08"
        actor = "NUMBERED PANDA"
    strings:
        $portalgo = { 8b d1 5e c1 e8 18 c1 ea 10 66 0f b6 c0 66 0f b6 d2 0f af c2 c1 e9 08 66 0f b6 c9 03 c1 5d c3 }
    condition:
        $portalgo
}

rule CrowdStrike_CSIT_13025_01 : numbered_panda ixeshe rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Identifies Ixeshe RAT used by NUMBERED PANDA"
        reports = "CSIT-13025"
        version = "201304080000"
        last_modified = "2013-04-08"
        actor = "NUMBERED PANDA"
        malware_family = "Ixeshe"
    strings:
        $pespin = { EB 01 68 60 E8 00 00 00 00 8B 1C 24 83 C3 12 81 2B E8 B1 06 00 FE }
        $office = "2007 Microsoft Office System" wide
    condition:
        all of them
}

rule CrowdStrike_CSIT_13027_01 : dagger_panda sunnyrat rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "SunnyRAT strings"
        reports = "CSIT-13027"
        version = "201304080000"
        last_modified = "2013-04-08"
        actor = "DAGGER PANDA"
        malware_family = "SunnyRAT"
    strings:
        $error_read = "ReadFile failed on buffer %lu."
        $error_open = "Failed to open local file %s."
        $agent1 = "mydownload"
        $agent2 = "MyAgent"
        $url_path = /\/jd.{0,20}\/upload\.aspx/
        $url_query = "%s?filepath=%s&filename=%s"
    condition:
        2 of them
}

rule CrowdStrike_CSIT_13032_12 : silent_chollima packer 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Packer artifacts seen in SILENT CHOLLIMA tooling"
        reports = "CSIT-13032"
        version = "201304080000"
        last_modified = "2013-04-08"
        actor = "SILENT CHOLLIMA"
    strings:
        $xorroutine = { 68 ?? ?? 00 00 6a 00 56 e8 c4 43 00 00 83 c4 0c 33 c0 b1 55 30 88 40 ac 40 00 40 3d ?? ?? 00 00 72 f2 68 ?? ?? 00 00 68 40 ac 40 00 56 e8 df 2f 00 00 83 c4 0c 6a 00 6a 00 6a 00 56 6a }
        $xor2 = { 33 c0 b1 55 30 88 ?? ?? ?? ?? 40 3d ?? ?? ?? ?? 72 ?? }
        $pdb = "z:\\Work\\Make Troy\\"
    condition:
        any of them
}

rule CrowdStrike_CSIT_13036_01 : macos delivery_document cve_2009_0563 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects document file exploiting CVE-2009-0563 to deploy a MacOS backdoor"
        reports = "CSIT-13036"
        version = "201304120000"
        last_modified = "2013-04-12"
    strings:
        $challenge = { 58 90 ae 86 f1 b9 1c f6 29 83 95 71 1d de 58 0d }
        $str1 = "/tmp/tmpAddressbook.vcf"
        $dochdr = { d0 cf 11 e0 a1 b1 1a e1 }
    condition:
        2 of them
}

rule CrowdStrike_Vernot_01 : vernot rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Identifies Vernot RAT"
        version = "201304180000"
        last_modified = "2013-04-18"
        malware_family = "Vernot"
    strings:
        $decryptconfig = { 80 c2 21 80 e2 7f 32 da }
        $droppedfile = "NETUT2.dll"
    condition:
        any of them
}

rule CrowdStrike_CSIT_13040_02 : cozy_bear miniduke loader exploit cve_2013_0640 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Sandbox escape exploit used to deploy MiniDuke RAT"
        reports = "CSIT-13040"
        version = "201305010000"
        last_modified = "2013-05-01"
        actor = "COZY BEAR"
    strings:
        $modulename = "escapedll.dll"
        $reader_process = "AcroRd32.exe"
        $api_1 = "Cre'ateToo'lhelp"
        $decryptor = { 8a 58 0e 30 19 8a 48 0f }
    condition:
        all of them
}

rule CrowdStrike_CSIT_13040_03 : cozy_bear miniduke dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Dropper used to deploy MiniDuke RAT"
        reports = "CSIT-13040"
        version = "201305010000"
        last_modified = "2013-05-01"
        actor = "COZY BEAR"
        malware_family = "MiniDuke"
    strings:
        $taskkill = "TASKKILL /F /IM acro*"
        $uplast_modified = "update.cmd"
        $getfolderpath = "SHGetFolderPath"
        $appdata = { 6a 1c 6a 00 ff d6 } // SHGetFolderPathA( 0, CSIDL_LOCAL_APPDATA, ...
        $internet_cache = { 6a 20 6a 00 ff d6 } // SHGetFolderPathA( 0, CSIDL_INTERNET_CACHE, ...
    condition:
        all of them
}

rule CrowdStrike_CSIT_13045_01 : poisonivy rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Modified PoisonIvy, additional init message"
        reports = "CSIT-13045"
        version = "201305060000"
        last_modified = "2013-05-06"
        malware_family = "PoisonIvy"
    strings:
        // Junk code, used in several places
        $junkcode = { 50 9c b8 0a 00 00 00 51 b9 14 00 00 00 e2 fe 59 9d 58 }
        // Strings used when installing the IAT hook
        $apiname = "NtDeviceIoControlFile"
        $modulename1 = "ntdll.dll"
        $modulename2 = "mswsock.dll"
    condition:
        uint16(0) == 0x5A4D and all of them
}

rule CrowdStrike_CSIT_13047_01 : vixen_panda key 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Known AES key used in VIXEN PANDA malware"
        reports = "CSIT-13047"
        version = "201305070000"
        last_modified = "2013-05-07"
        actor = "VIXEN PANDA"
    strings:
        $key1a = "WhatTheFuckin"
        $key1b = "WhatTheFuc"
        $key2a = "gIsGoingOnHiMan!"
        $key2b = "kingIsGoingOnHiMan!"
    condition:
        2 of them
}

rule CrowdStrike_CSIT_13042_01 : andromeda dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Dropper for the Andromeda malware"
        reports = "CSIT-13042"
        version = "201904291013"
        last_modified = "2019-04-29"
        malware_family = "Andromeda"
    strings:
        // hash for "kernel32.dll"
        $push_kernel32_hash = { 68 02 9F E6 6A }
        // characteristic byte sequences in exception filter
        $exception_check = { 8b 00 81 38 05 00 00 C0 75 }
        $get_stack_push_64 = { 8B 93 C4 00 00 00 C7 02 40 00 00 00 }
    condition:
        all of them
}

rule CrowdStrike_CSIT_13046_01 : maverick_panda sykipot dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Sykipot dropper"
        reports = "CSIT-13046"
        version = "201305080000"
        last_modified = "2013-05-08"
        actor = "MAVERICK PANDA"
        malware_family = "Sykipot"
    strings:
        $cmd1 = "-installkys"
        $cmd2 = "-removekys"
        $cmd3 = "-startup"
        $cmd4 = "-remove"
        $del = "/c del"
        $msg1 = "Select Files!"
        $msg2 = "Bind Success!"
        $datfile = "\\111.dat"
        $pattern1 = "(*.jpg)|*.jpg|(*.*)|*.*||"
        $pattern2 = "(*.exe)|*.exe|(*.*)|*.*||"
        $pattern3 = "(*.exe)|*.exe|"
    condition:
        (($cmd1 and $cmd2) or ($cmd3 and $cmd2) or ($cmd4 and $del) or ($msg1 and $msg2) or $datfile) and 1 of ($pattern*)
}

rule CrowdStrike_CSIT_13046_02 : maverick_panda sykipot injector 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Sykipot injector"
        reports = "CSIT-13046"
        version = "201305080000"
        last_modified = "2013-05-08"
        actor = "MAVERICK PANDA"
        malware_family = "Sykipot"
    strings:
        $cmd = "-remove"
        $exename = "chksrv.exe"
        $del = "/c del"
        $privname = "SeDebugPrivilege"
        $apiname = "NtQueryInformationProcess"
    condition:
        all of them
}

rule CrowdStrike_CSIT_13046_03 : sykipot_installer 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Sykipot installer"
        reports = "CSIT-13046"
        version = "201305080000"
        last_modified = "2013-05-08"
        actor = "MAVERICK PANDA"
        malware_family = "Sykipot"
    strings:
        $cmd1 = "-installkys"
        $cmd2 = "-removekys"
        $cmd3 = "-startup"
        $cmd4 = "-remove"
        $del = "/c del"
        $msg1 = "Select Files!"
        $msg2 = "Bind Success!"
        $rsrcname = "DLL" wide
    condition:
        $rsrcname and (($cmd1 and $cmd2) or ($cmd3 and $cmd2) or ($cmd4 and $del) or ($msg1 and $msg2))
}

rule CrowdStrike_CSIT_13046_04 : maverick_panda sykipot rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Sykipot RAT"
        reports = "CSIT-13046"
        version = "201305080000"
        last_modified = "2013-05-08"
        actor = "MAVERICK PANDA"
        malware_family = "Sykipot"
    strings:
        $url1 = "/kys_allow_put.asp?type=" nocase
        $url2 = "/kys_allow_get.asp?name=" nocase
    condition:
        any of them
}

rule CrowdStrike_CSIT_13046_05 : maverick_panda sykipot rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Sykipot RAT"
        reports = "CSIT-13046"
        version = "201305080000"
        last_modified = "2013-05-08"
        actor = "MAVERICK PANDA"
        malware_family = "Sykipot"
    strings:
        $logmsg1 = "unsuccessfully!"
        $logmsg2 = "successfully!"
        $logmsg3 = "waiting......"
        $logmsg4 = "reboot false!"
        $cmd1 = "shell"
        $cmd2 = "run"
        $cmd3 = "reboot"
        $cmd4 = "kill"
        $cmd5 = "process"
    condition:
        all of them
}

rule CrowdStrike_CSIT_13045_02 : poisonivy rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Debug path for a modified version of PoisonIvy"
        reports = "CSIT-13045"
        version = "201305100000"
        last_modified = "2013-05-10"
        malware_family = "PoisonIvy"
    strings:
        $debugpath = "C:\\pj\\testing\\testing\\Release\\"
    condition:
        uint16(0) == 0x5A4D and $debugpath
}

rule CrowdStrike_CSIT_13044_1 : encrypted_resource poison_ivy 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Encrypted Poison Ivy Resource"
        reports = "CSIT-13044"
        version = "202101291827"
        last_modified = "2021-01-29"
        malware_family = "Poison Ivy"
        in_the_wild = "yes"
    strings:
        // first 16 bytes of encrypted resource
        $enc_pivy_resource= { d1 c4 75 57 72 23 7c d3 e1 1a 9f 46 e3 20 f4 bc }
    condition:
        $enc_pivy_resource
}

rule CrowdStrike_CSIT_13052_01 : comment_panda rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "COMMENT PANDA RAT"
        reports = "CSIT-13052"
        version = "201305120000"
        last_modified = "2013-05-12"
        actor = "COMMENT PANDA"
    strings:
        $decrypt = {d0 f8 24 7f ?? ?? ?? 88 01}
        $shell= "Shell started,wait to terminate it....."
    condition:
        any of them
}

rule CrowdStrike_CSIT_13049_01 : pitty_panda pittytiger dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "PittyTiger dropper"
        reports = "CSIT-13049"
        version = "201807271514"
        last_modified = "2018-07-27"
        actor = "PITTY PANDA"
        malware_family = "PittyTiger"
    strings:
        // String present in both the Dropper and the RAT used for dynamically
        // modifying the configuration
        $locate_symbol = "LOCATESYMBOL"
        // The name of the resource that contains the RAT
        $resource_name = "MMRECS"
        // Match on the 5 MOV instructions that setup the [0x39, 0x53, 0x63, 0x78, 0x81] decryption key.
        $decrypt_driver_key = { C6 [5] 39 C6 [5] 53 C6 [5] 63 C6 [5] 78 C6 [5] 81 }
    condition:
        ($locate_symbol and $resource_name) or
        $decrypt_driver_key
}

rule CrowdStrike_CSIT_13049_03 : pitty_panda pittytiger delivery_document shellcode 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "PittyTiger Word/RTF document shellcode"
        reports = "CSIT-13049"
        version = "201305130000"
        last_modified = "2013-05-13"
        actor = "PITTY PANDA"
        malware_family = "PittyTiger"
    strings:
        // Word Document header
        $word_hdr = { d0 cf 11 e0 a1 b1 1a e1 }
        // Loose match on RTF documents
        $rtf_hdr = "{\\"
        // Shellcode that decrypts itself in raw bytes
        $bytes = { 80 34 0a e9 e2 fa 4b 33 db eb 07 }
        // And hex string for RTF documents
        $hexbytes = "80340ae9e2fa4b33dbeb07"
    condition:
        (($word_hdr at 0) or ($rtf_hdr at 0)) and
        1 of ($bytes, $hexbytes)
}

rule CrowdStrike_CSIT_13050_01 : dragon_eye rat viceroy_tiger 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "DragonEye RAT observed being deployed by VICEROY TIGER"
        reports = "CSIT-13050"
        version = "201910082330"
        last_modified = "2019-10-08"
        actor = "VICEROY TIGER"
        malware_family = "Dragon Eye"
    strings:
        $c2_cmd1 = "Kils" wide
        $c2_cmd2 = "SheA" wide
        $c2_cmd3 = "SheD" wide
        $c2_cmd4 = "SheC" wide
        $c2_cmd5 = "Fols" wide
        $c2_cmd6 = "Fils" wide
        $c2_cmd7 = "Dein" wide
        $msg1 = "Dragon Eye - Mini - Listening on Port:" wide
        $msg2 = "Status: File can't be downloaded !" wide
        $msg3 = "Download link must be start from http://" wide
        $msg4 = "Space not allowed in URL" wide
        $msg5 = "Select Directory in which you want to Download URL file" wide
        $msg6 = "Status:Http URL download started !" wide
        $msg7 = "Please select a valid File" wide
        $msg8 = "Status: Waiting on Socket..." wide
        $msg9 = "Please wait Previous File transfer is on Progress" wide
    condition:
        4 of ($c2*) and 5 of ($msg*)
}

rule CrowdStrike_CSIT_13051_01 : wet_panda backshell rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "BackShell RAT encoder strings"
        reports = "CSIT-13051"
        version = "201305140000"
        last_modified = "2013-05-14"
        actor = "WET PANDA"
        malware_family = "BackShell"
    strings:
        $enc_1 = { 8b ca 83 e1 1f 8b f2 33 f7 d3 c6 83 c0 30 03 70 c8 33 d6 8b ce 83 e1 1f d3 c2 03 50 cc 8b ca 83 e1 1f 8b fa 33 fe d3 c7 03 78 d0 33 d7 8b cf 83 e1 1f d3 c2 03 50 d4 8b ca 83 e1 1f 8b f2 33 f7 d3 c6 03 70 d8 33 d6 8b ce 83 e1 1f d3 c2 03 50 dc 8b ca 83 e1 1f 8b fa 33 fe d3 c7 03 78 e0 33 d7 8b cf 83 e1 1f d3 c2 03 50 e4 8b ca 83 e1 1f 8b f2 33 f7 d3 c6 03 70 e8 33 d6 8b ce 83 e1 1f d3 c2 03 50 ec 8b ca 8b fa 83 e1 1f 33 fe d3 c7 03 78 f0 8b cf 33 d7 83 e1 1f d3 c2 03 50 f4 83 eb 01 0f 85 58 ff ff ff }
        $enc_2 = { 8b df 83 e3 1f 8b f7 33 f2 8b d6 b9 20 00 00 00 2b cb d3 ea 8b cb d3 e6 8b 58 f8 b9 20 00 00 00 0b d6 03 d3 33 fa 8b da 83 e3 1f 2b cb 8b f7 d3 ee 8b cb 8b 58 fc d3 e7 b9 20 00 00 00 0b f7 03 f3 8b de 83 e3 1f 2b cb 8b fe 33 fa 8b d7 d3 ea 8b cb 8b 18 d3 e7 b9 20 00 00 00 0b d7 03 d3 33 f2 8b da 83 e3 1f 2b cb 8b fe d3 ef 8b cb 8b 58 04 d3 e6 b9 20 00 00 00 0b fe 03 fb 8b df 83 e3 1f 2b cb 8b f7 33 f2 8b d6 d3 ea 8b cb 8b 58 08 d3 e6 b9 20 00 00 00 0b d6 03 d3 33 fa 8b da 83 e3 1f 2b cb 8b f7 d3 ee 8b cb 8b 58 0c d3 e7 b9 20 00 00 00 0b f7 03 f3 8b de 8b fe 83 e3 1f 33 fa 2b cb 8b d7 d3 ea 8b cb d3 e7 8b 58 10 b9 20 00 00 00 83 c0 30 0b d7 03 d3 33 f2 8b da 83 e3 1f 2b cb 8b fe d3 ef 8b cb 8b 58 e4 d3 e6 b9 20 00 00 00 0b fe 03 fb 8b df 83 e3 1f 2b cb 8b f7 33 f2 8b d6 d3 ea 8b cb 8b 58 e8 d3 e6 b9 20 00 00 00 0b d6 03 d3 33 fa 8b da 83 e3 1f 2b cb 8b f7 d3 ee 8b cb 8b 58 ec d3 e7 b9 20 00 00 00 0b f7 03 f3 8b de 83 e3 1f 2b cb 8b fe 33 fa 8b d7 d3 ea 8b cb d3 e7 8b 48 f0 0b d7 03 d1 8b fa 83 e7 1f 33 f2 b9 20 00 00 00 2b cf 8b de d3 eb 8b cf 8b 78 f4 d3 e6 0b de 03 fb 4d 0f 85 8f fe ff ff }
    condition:
        any of them
}

rule CrowdStrike_CSIT_14062_01 : naikon_rat rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Naikon RAT"
        reports = "CSIT-14062"
        version = "202005131421"
        last_modified = "2020-05-13"
        actor = "OVERRIDE PANDA"
        malware_family = "Naikon RAT"
    strings:
        // XOR key used to decrypt code and config
        $key = "skg(3)=&3.2d_u1"
        // unxor code
        $code = { 8b 45 14 03 45 f8 0f be 08 8b 55 0c 03 55 fc 0f b6 02 33 c1 8b 4d 0c 03 4d fc 88 01 }
        // User agent
        $useragent = "NOKIAN95/WEB"
    condition:
        any of them
}

rule CrowdStrike_CSIR_13012_03 : pirate_panda delivery_document 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Delivery document used in PIRATE PANDA campaigns"
        reports = "CSIT-13033,CSIT-13037,CSIR-13012"
        version = "201305200000"
        last_modified = "2013-05-20"
        actor = "PIRATE PANDA"
    strings:
        // decryption key as seen in malicious docs
        $keystring = "95000000990000009d000000c3000000c7000000cb000000d7000000e5000000"
    condition:
        any of them
}

rule CrowdStrike_CSIR_13015_01 : magic_kitten rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "RAT used by MAGIC KITTEN"
        reports = "CSIR-13015"
        version = "201305200000"
        last_modified = "2013-05-20"
        actor = "MAGIC KITTEN"
    strings:
        // char maps
        $charmap1 = "_ghiHIABcdkJYlCnefZajoKLRST9-UV5EFGbm67rP123tusNOwxyz0pDWM48QXqv"
        $charmap2 = "ghiHIABcdkJYlCnefZajoKLRST9-UV5EFGbm67rP123tusNOwxyz0_pDWM48QXqv"
        $xordecode = { 8b 4c 24 04 03 ca 30 01 42 3b 54 24 08 72 f1 c3}
        $addnonjoiner = { eb 02 40 40 66 83 38 00 75 f8 b9 0c 20 00 00 66 89 08 33 c9 66 89 48 02 c3 }
    condition:
        any of them
}

rule CrowdStrike_CSIT_13053_01 : nettraveler rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "NetTraveler RAT"
        reports = "CSIT-13053"
        version = "201305200000"
        last_modified = "2013-05-20"
        malware_family = "NetTraveler"
    strings:
        $nettravler = "NetTravler"
        $travlerbackinfo = "travlerbackinfo"
        $modified_base64_charset = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-*"
        $outlook_pstore_guid = "220d5cc1" nocase
        $ie_pstore_guid = "5e7e8100" nocase
    condition:
        3 of them
}

rule CrowdStrike_CSIT_13053_02 : syndicasec rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Syndicasec RAT"
        reports = "CSIT-13053"
        version = "201305200000"
        last_modified = "2013-05-20"
        malware_family = "Syndicasec"
    strings:
        $js_decryption = { 32 da 32 d9 }
        $IWbemLocator = { 87 a6 12 dc 7f 73 cf 11 88 4d 00 aa 00 4b 2e 24}
        $str = "root\\subscription" wide
    condition:
        all of them
}

rule CrowdStrike_CSIT_13053_03 : bisty rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Bisty RAT"
        reports = "CSIT-13053"
        version = "201305200000"
        last_modified = "2013-05-20"
        malware_family = "Bisty"
    strings:
        $outlook_pstore_guid = "220d5cc1" nocase
        $ie_pstore_guid = "5e7e8100" nocase
        $error1 = "%cget %s 's password error!"
    condition:
        all of them
}

rule CrowdStrike_CSIR_13012_05 : pirate_panda dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "PIRATE PANDA - Dropper Export Table"
        reports = "CSIT-13033,CSIT-13037,CSIR-13012"
        version = "201807300838"
        last_modified = "2018-07-30"
        actor = "PIRATE PANDA"
    strings:
        $exporttable = { 49 6e 73 74 61 6c 6c 5f 45 58 45 2e 65 78 65 00 45 6d 62 65 64 64 69 6e 67 00 53 74 61 72 74 57 6f 72 6b}
    condition:
        all of them
}

rule CrowdStrike_CSIT_13087_01 : sabpab rat macos 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "SabPab MacOS RAT"
        reports = "CSIT-13087"
        version = "201306040000"
        last_modified = "2013-06-04"
    strings:
        $launch_agent = "com.apple.PubSabAgent"
        $screenshot_path = "/tmp/screen.jpeg"
        $passwd = "123456"
    condition:
        2 of them and
        // MACH-O file header
        uint32(0) == 0xfeedface
}

rule CrowdStrike_CSIT_13057_03 : adwind rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Adwind Remote Access Tool"
        reports = "CSIT-13057"
        version = "201807271538"
        last_modified = "2018-07-27"
        malware_family = "njRAT"
    strings:
        // Match on the file entries for this compressed JAR archive
        $adwind = "Adwind.class"
        $constantes = "extra/Constantes.class"
        $made = "desinstalador/MaDe.adwind"
    condition:
        all of them
}

rule CrowdStrike_CSIT_13056_01 : njrat rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "njRAT Remote Access Tool"
        reports = "CSIT-13056"
        version = "201903061056"
        last_modified = "2019-03-06"
        malware_family = "njRAT"
    strings:
        $pingcmd = "cmd.exe /k ping 0 & del \"" wide
        $envvar = "U0VFX01BU0tfTk9aT05FQ0hFQ0tT" nocase wide
        $magic = "|'|'|" wide
    condition:
        any of them and
        // PE binary
        uint16(0) == 0x5A4D and uint32(uint32(0x3c)) == 0x4550 and
        // Mono/.NET 32bit
        ((uint16(uint32(0x3c)+24) == 0x010b and int32(uint32(0x3c)+232) > 0) or
        // Mono/.NET 64bit
        (uint16(uint32(0x3c)+24) == 0x020b and int32(uint32(0x3c)+248) > 0))
}

rule CrowdStrike_CSIT_13057_01 : commodity njrat rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "njRAT Remote Access Tool"
        reports = "CSIT-13057"
        version = "201904251013"
        last_modified = "2019-04-25"
        malware_family = "njRAT"
    strings:
        // Locate the assembly name
        $fname = "w.exe"
        // And the "DRV" and "USB" class names
        $class_DRV = { 00 44 52 56 00 }
        $class_USB = { 00 55 53 42 00 }
        // Make sure it's a VB.NET file.
        $vb = "Microsoft.VisualBasic.ApplicationServices"
    condition:
        all of them
}

rule CrowdStrike_CSIT_13057_02 : dropper njrat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "njRAT dropper"
        reports = "CSIT-13057"
        version = "201903061100"
        last_modified = "2019-03-06"
        malware_family = "njRAT"
    strings:
        // Locate the assembly name
        $fname = "wLoader"
        $fname_resource = "wLoader.g.resources"
        // And some API imports
        $api1 = "ExecuteAssemblyByName"
        $api2 = "GetTypeFromHandle"
        $api3 = "GetManifestResourceNames"
        $api4 = "InitializeArray"
        $api5 = "GetManifestResourceStream"
    condition:
        all of them
}

rule CrowdStrike_CSIT_13058_01 : vixen_panda packer 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Custom packer used by VIXEN PANDA"
        reports = "CSIT-13058"
        version = "201306070000"
        last_modified = "2013-06-07"
        actor = "VIXEN PANDA"
    strings:
        $loader = { 6d 34 cf 4c 4f 41 44 45 52 20 45 52 52 4f 52 00 }
        $crypt = "CryptUnprotectData"
    condition:
        all of them
}

rule CrowdStrike_CSIR_12032_02 : vixen_panda mirage rat artifact 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "CrowdStrike_CSIR_12032_02"
        reports = "CSIR-12032"
        version = "201306120000"
        last_modified = "2013-06-12"
        actor = "VIXEN PANDA"
        malware_family = "Mirage"
        decsription = "Partial deobfuscation routine used by Mirage RAT"
    strings:
        $obwidget1 = { c1 f8 0? 32 c? 88 04 2e 46 }
        $obwidget2 = { e8 ?? 1? 00 00 32 c? 88 04 2e 46 }
    condition:
        uint16(0) == 0x5A4D and uint32(uint32(0x3C)) == 0x00004550 and any of them
}

rule CrowdStrike_CSIT_13061_01 : aurora_panda hikit dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "HIKIT RAT Dropper"
        reports = "CSIT-13061"
        version = "201306180000"
        last_modified = "2013-06-18"
        actor = "AURORA PANDA"
        malware_family = "HiKit"
    strings:
        // Marker in encrypted resource data
        $marker = "zzzzzzzzzz"
        // String decryptor loop
        $decryptstringloop = { 8A 1C 01 32 DA 88 1C 01 74 09 41 81 F9 03 01 00 00 7C ED }
    condition:
        all of them
}

rule CrowdStrike_CSIT_13061_02 : aurora_panda hikit rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "HIKIT RAT"
        reports = "CSIT-13061"
        version = "201306180000"
        last_modified = "2013-06-18"
        actor = "AURORA PANDA"
        malware_family = "HiKit"
    strings:
        // HiKit string
        $hikit = "hikit>" wide
        // Event names
        $eventname1 = "Global\\%s__SHOW__" wide
        $eventname2 = "Global\\%s__HIDE__" wide
        $eventname3 = "Global\\%s__STOP__" wide
    condition:
        $hikit and 1 of ($eventname*)
}

rule CrowdStrike_CSIT_13061_03 : aurora_panda hikit rootkit 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "HIKIT RAT Rootkit"
        reports = "CSIT-13061"
        version = "202004011714"
        last_modified = "2020-04-01"
        actor = "AURORA PANDA"
        malware_family = "HiKit"
    strings:
        $string1 = "---HIDE"
        $string2 = "hide---port = %d"
        $string3 = "imagename found at:%s"
    condition:
        all of them
}

rule CrowdStrike_CSIT_13064_01 : citadel trojan 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Citadel/ZeuS Trojan"
        reports = "CSIT-13064"
        version = "201307010000"
        last_modified = "2013-07-01"
        malware_family = "Citadel"
    strings:
        $modules_1 = "cit_ffcookie.module"
        $modules_2 = "cit_video.module"
        $rc4_code = { 8a 45 fe 88 82 00 01 00 00 8a 45 fd 88 82 01 01 00 00 8a 45 ff 88 82 02 01 00 00 }
        $botnet = "botnet"
    condition:
        $rc4_code and 2 of ($modules_1, $modules_2, $botnet)
}

rule CrowdStrike_CSIT_13064_03 : citadel exploit cve_2012_0507 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Java exploit (CVE-201200507) used for Citadel deployments"
        reports = "CSIT-13064"
        version = "201307010000"
        last_modified = "2013-07-01"
        malware_family = "Citadel"
    strings:
        $pk_header = { 50 4b }
        $pink = "Pink.class"
        $poper = "popers.class"
    condition:
        $pk_header at 0 and all of ($pink, $poper)
}

rule CrowdStrike_CSIT_13065_01 : rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "RAT covered in CSIT-13065"
        reports = "CSIT-13065"
        version = "201307030000"
        last_modified = "2013-07-03"
    strings:
        // Code of WinMain
        $winmain = { 6a 00 e8 ?? ?? ?? ?? f7 d8 1b c0 f7 d8 c2 10 00 }
        // Code that assembles the string "success"
        $build_str_success =  { 66 c7 85 4c f1 ff ff 73 00 66 c7 85 4e f1 ff ff 75 00 66 c7 85 50 f1 ff ff 63 00 66 c7 85 52 f1 ff ff 63 00 66 c7 85 54 f1 ff ff 65 00 66 c7 85 56 f1 ff ff 73 00 66 c7 85 58 f1 ff ff 73 00 66 89 9d 5a f1 ff ff }
    condition:
        all of them
}

rule CrowdStrike_CSIR_13017_01 : wet_panda rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "RAT used by WET PANDA"
        reports = "CSIR-13017"
        version = "201307090000"
        last_modified = "2013-07-09"
        actor = "WET PANDA"
    strings:
        $hello = "c:\\Users\\helloworld\\"
    condition:
        all of them
}

rule CrowdStrike_CSIR_13017_02 : wet_panda dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Dropper used by WET PANDA"
        reports = "CSIR-13017"
        version = "201307090000"
        last_modified = "2013-07-09"
        actor = "WET PANDA"
    strings:
        $closehandle = "EorvhJdqgoh"
        $sprintf = "vsulqwi"
        $memset = "phpvhw"
        $memcpy = "phpfsb"
    condition:
        3 of them
}

rule CrowdStrike_CSIR_13017_03 : wet_panda dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Dropper used by WET PANDA"
        reports = "CSIR-13017"
        version = "201307090000"
        last_modified = "2013-07-09"
        actor = "WET PANDA"
    strings:
        $str_1 = "TactXCIHlp"
        $str_2 = "THXAudioEntry"
    condition:
        any of them
}

rule CrowdStrike_CSIR_13017_04 : wet_panda rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "RAT used by WET PANDA"
        reports = "CSIR-13017"
        version = "201307090000"
        last_modified = "2013-07-09"
        actor = "WET PANDA"
    strings:
        $tell = "cannot judge proxy is availabel or not!"
        $fails = "open reg for proxyinfo fails!"
        $someprot = "inhp://"
    condition:
        2 of them
}

rule CrowdStrike_CSIR_13017_05 : certificate wet_panda 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Serial for certificate in use by WET PANDA"
        reports = "CSIR-13017"
        version = "201910101602"
        last_modified = "2019-10-10"
        actor = "WET PANDA"
    strings:
        // HANCOM certificate compromised by WET PANDA
        $cn = "HANCOM. INC,"
        $serial = { 64 3d 10 7d 23 55 d8 35 5a da e1 15 b8 73 15 bf }
    condition:
        filesize < 1MB and
        $cn and
        $serial
}

rule CrowdStrike_CSIR_13017_06 : wet_panda backshell rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "BackShell RAT encodings, modified to broaden detection in CSIR-13017"
        reports = "CSIT-13051,CSIR-13017"
        version = "201307090000"
        last_modified = "2013-07-09"
        actor = "WET PANDA"
        malware_family = "Backshall"
    strings:
        $enc_1 = { 8b ca 83 e1 1f 8b f2 33 f7 d3 c6 83 c0 30 03 70 c8 33 d6 8b ce 83 e1 1f d3 c2 03 50 cc 8b ca 83 e1 1f 8b fa 33 fe d3 c7 03 78 d0 33 d7 8b cf 83 e1 1f d3 c2 03 50 d4 8b ca 83 e1 1f 8b f2 33 f7 d3 c6 03 70 d8 33 d6 8b ce 83 e1 1f d3 c2 03 50 dc 8b ca 83 e1 1f 8b fa 33 fe d3 c7 03 78 e0 33 d7 8b cf 83 e1 1f d3 c2 03 50 e4 8b ca 83 e1 1f 8b f2 33 f7 d3 c6 03 70 e8 33 d6 8b ce 83 e1 1f d3 c2 03 50 ec 8b ca 8b fa 83 e1 1f 33 fe d3 c7 03 78 f0 8b cf 33 d7 83 e1 1f d3 c2 03 50 f4 83 eb 01 0f 85 58 ff ff ff }
        $enc_2 = { 8b df 83 e3 1f 8b f7 33 f2 8b d6 b9 20 00 00 00 2b cb d3 ea 8b cb d3 e6 8b 58 f8 b9 20 00 00 00 0b d6 03 d3 33 fa 8b da 83 e3 1f 2b cb 8b f7 d3 ee 8b cb 8b 58 fc d3 e7 b9 20 00 00 00 0b f7 03 f3 8b de 83 e3 1f 2b cb 8b fe 33 fa 8b d7 d3 ea 8b cb 8b 18 d3 e7 b9 20 00 00 00 0b d7 03 d3 33 f2 8b da 83 e3 1f 2b cb 8b fe d3 ef 8b cb 8b 58 04 d3 e6 b9 20 00 00 00 0b fe 03 fb 8b df 83 e3 1f 2b cb 8b f7 33 f2 8b d6 d3 ea 8b cb 8b 58 08 d3 e6 b9 20 00 00 00 0b d6 03 d3 33 fa 8b da 83 e3 1f 2b cb 8b f7 d3 ee 8b cb 8b 58 0c d3 e7 b9 20 00 00 00 0b f7 03 f3 8b de 8b fe 83 e3 1f 33 fa 2b cb 8b d7 d3 ea 8b cb d3 e7 8b 58 10 b9 20 00 00 00 83 c0 30 0b d7 03 d3 33 f2 8b da 83 e3 1f 2b cb 8b fe d3 ef 8b cb 8b 58 e4 d3 e6 b9 20 00 00 00 0b fe 03 fb 8b df 83 e3 1f 2b cb 8b f7 33 f2 8b d6 d3 ea 8b cb 8b 58 e8 d3 e6 b9 20 00 00 00 0b d6 03 d3 33 fa 8b da 83 e3 1f 2b cb 8b f7 d3 ee 8b cb 8b 58 ec d3 e7 b9 20 00 00 00 0b f7 03 f3 8b de 83 e3 1f 2b cb 8b fe 33 fa 8b d7 d3 ea 8b cb d3 e7 8b 48 f0 0b d7 03 d1 8b fa 83 e7 1f 33 f2 b9 20 00 00 00 2b cf 8b de d3 eb 8b cf 8b 78 f4 d3 e6 0b de 03 fb 4d 0f 85 8f fe ff ff }
        $enc_3 = { 8b ca 83 e1 1f 8b f2 33 f7 d3 c6 83 c0 30 03 70 c8 33 d6 8b ce 83 e1 1f d3 c2 03 50 cc 8b ca 83 e1 1f 8b fa 33 fe d3 c7 03 78 d0 33 d7 8b cf 83 e1 1f d3 c2 03 50 d4 8b ca 83 e1 1f 8b f2 33 f7 d3 c6 03 70 d8 33 d6 8b ce 83 e1 1f d3 c2 03 50 dc 8b ca 83 e1 1f 8b fa 33 fe d3 c7 03 78 e0 33 d7 8b cf 83 e1 1f d3 c2 03 50 e4 8b ca 83 e1 1f 8b f2 33 f7 d3 c6 03 70 e8 33 d6 8b ce 83 e1 1f d3 c2 03 50 ec 8b ca 8b fa 83 e1 1f 33 fe d3 c7 03 78 f0 8b cf 33 d7 83 e1 1f d3 c2 03 50 f4 4b }
        $enc_4 = { 8b c6 83 e3 1f 33 c2 b9 20 00 00 00 8b d0 2b cb 83 c7 08 d3 ea 8b cb d3 e0 8b 4f f8 0b d0 8b c6 03 d1 b9 20 00 00 00 8b da 33 c2 83 e3 1f 8b f0 2b cb d3 ee 8b cb 8b 5f fc d3 e0 0b f0 03 f3 81 ff d8 42 00 10 7e b7 }
    condition:
        any of them
}

rule CrowdStrike_CSIR_12012_01 : comment_panda rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Looks for encoding string used in COMMENT PANDA RAT"
        reports = "CSIR-12012"
        version = "202012141556"
        last_modified = "2020-12-14"
        actor = "COMMENT PANDA"
    strings:
        $foxy = "thequickbrownfxjmpsvalzydg\x00"
    condition:
        $foxy
}

rule CrowdStrike_CSIT_13066_01 : viceroy_tiger strangelove downloader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Decoder routines related to StrangeLove (AKA Banechant) downloader"
        reports = "CSIT-13066"
        version = "201307110000"
        last_modified = "2013-07-11"
        actor = "VICEROY TIGER"
        malware_family = "StrangeLove"
    strings:
        $decoder1 = { 8a 04 37 88 06 [0-6] 8a c3 04 ?? 30 06 43 46 81 fb ?? ?? 00 00  }
        $decoder2 = { 8a c8 80 c1 ?? 30 0c 38 40 3b c6 72 f3 }
    condition:
        any of them
}

rule CrowdStrike_CSIT_13066_02 : viceroy_tiger strangelove downloader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "PSH JMP instructions related to Viceroy Tiger Strangelove (AKA Banechant) downloader"
        reports = "CSIT-13066"
        version = "201307110000"
        last_modified = "2013-07-11"
        actor = "VICEROY TIGER"
        malware_family = "StrangeLove"
    strings:
        $pushjmp = { 68 7c b1 1d ac [0-9] ff d0 }
    condition:
        any of them
}

rule CrowdStrike_CSIT_13066_03 : viceroy_tiger strangelove rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Strings found in VICEROY TIGER StrangeLove (AKA Banechant) RAT"
        reports = "CSIT-13066"
        version = "201307110000"
        last_modified = "2013-07-11"
        actor = "VICEROY TIGER"
        malware_family = "StrangeLove"
    strings:
        $cmd_1 = "cmd.exe /q /c tasklist" wide
        $cmd_2 = "cmd.exe /q /c " wide
        $cmd_21= "ipconfig /all" wide
        $cmd_3 = "cmd.exe /q /c dir C:\\" wide
        $cmd_4 = "cmd.exe /q /c dir D:\\" wide
        $cmd_5 = "cmd.exe /q /c dir E:\\" wide
        $cmd_6 = "cmd.exe /q /c dir F:\\" wide
        $cmd_7 = "cmd.exe /q /c dir G:\\" wide
        $cmd_8 = "cmd.exe /q /c dir H:\\" wide
    condition:
        all of them
}

rule CrowdStrike_CSIT_13067_04 : dagger_panda rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "DAGGER PANDA RAT"
        reports = "CSIT-13067"
        version = "201901221556"
        last_modified = "2019-01-22"
        actor = "DAGGER PANDA"
    strings:
        $xorkey1 = "*&~^%@0hh8979"
        $xorkey2 = "&*^*@~^%9?i0h"
        $formatstr1 = "HostName: %s\x0d\x0aIP: %s\x0d\x0aProxy: %s\x0d\x0aUser: %s\x0d\x0aSystemDir: %s\x0d\x0aOS Language Version: %d\x0d\x0aSystem Version: %d.%d %s (Build %d)\x0d\x0a\x0d\x0a"
        $formatstr2 = "HostNrme: %s\x0d\x0aIP: %s\x0d\x0aProxy: %s\x0d\x0aUser: %s\x0d\x0aSystemDir: %s\x0d\x0aOS Latguage Version: %d\x0d\x0aSystem Version: %d.%d %s (Build %d)\x0d\x0a\x0d\x0a"
    condition:
        1 of ($xorkey*) and 1 of ($formatstr*)
}

rule CrowdStrike_CSIT_13068_01 : cutting_kitten havij 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Signature for Havij SQL Scanner by CUTTING KITTEN (ITSecTeam)"
        reports = "CSIT-13068"
        version = "201307130000"
        last_modified = "2013-07-13"
        actor = "CUTTING KITTEN"
        malware_family = "HavijSQLScanner"
    strings:
        $useragent = ".NET CLR 2.0.50727) Havij" // Part of User Agent containing Havij Name
        $copyright = "ITSecTeam.com" // copyright from ITSecTeam
    condition:
        uint16(0) == 0x5A4D and uint32(uint32(0x3c)) == 0x4550 and
        $useragent and $copyright
}

rule CrowdStrike_CSIT_13068_02 : cutting_kitten havij 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Signature for Havij SQL Scanner by CUTTING KITTEN (Cracked version from R3dm0v3)"
        reports = "CSIT-13068"
        version = "201307130000"
        last_modified = "2013-07-13"
        actor = "CUTTING KITTEN"
        malware_family = "HavijSQLScanner"
    strings:
        $useragent = ".NET CLR 2.0.50727) Havij" // Part of User Agent containing Havij Name
        $copyright = "ITSecTeam.com" // Copyright from ITSecTeam
        $reguser = "r3dm0v3" // Embedded string of Registered User
    condition:
        uint16(0) == 0x5A4D and uint32(uint32(0x3c)) == 0x4550 and
        $useragent and $copyright and $reguser
}

rule CrowdStrike_CSIT_13067_03 : dagger_panda delivery_document key 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Malicious document DAGGER PANDA RAT"
        reports = "CSIT-13067"
        version = "201901221555"
        last_modified = "2019-01-22"
        actor = "DAGGER PANDA"
    strings:
        // XOR keys, xor-encrypted with 1-byte keys, as found in malicious dropper docs
        $xorkey1_0x12 = { 38 34 6c 4c 37 52 22 7a 7a 2a 2b 25 2b }
        $xorkey2_0x12 = { 34 38 4c 38 52 6c 4c 37 2b 2d 7b 22 7a }
        $xorkey1_0x85 = { af a3 fb db a0 c5 b5 ed ed bd bc b2 bc }
        $xorkey2_0x85 = { a3 af db af c5 fb db a0 bc ba ec b5 ed }
    condition:
        1 of ($xorkey*)
}

rule CrowdStrike_CSIT_13017_01 : makadocs rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Makadocs RAT (2007 version)"
        reports = "CSIT-13017"
        version = "202101291829"
        last_modified = "2021-01-29"
        in_the_wild = true
        date = "01 Feb 2013"
    strings:
        $boundary = "----------------This_is_a_boundary$"
        $opentag = "[##]"
        $closetag = "[/##]"
        $answer = "Answer for command ["
        $path1 = "c:\\windows\\command.com"
        $path2 = "c:\\winnt\\system32\\cmd.exe"
        $path3 = "c:\\windows\\system32\\cmd.exe"
        $key = "FATeamPrtsKey#$%!@1"
    condition:
        all of them
}

rule CrowdStrike_CSIT_13017_02 : makadocs malicious_document 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "RTF Document Containing Makadocs RAT (2007 version)"
        reports = "CSIT-13017"
        version = "202101291828"
        last_modified = "2021-01-29"
        in_the_wild = true
        date = "01 Feb 2013"
    strings:
        $rtf = "\\rtf1"
        $hexpattern1 = "2d2d2d2d2d2d2d2d2d2d2d2d2d2d2d2d546869735f69735f615f626f756e6461727924"
        $hexpattern2 = "5b23235d"
        $hexpattern3 = "5b2f23235d"
        $hexpattern4 = "416e7377657220666f7220636f6d6d616e64205b" nocase
        $hexpattern5 = "633a5c77696e646f77735c636f6d6d616e642e636f6d"
        $hexpattern6 = "633a5c77696e6e745c73797374656d33325c636d642e657865"
        $hexpattern7 = "633a5c77696e646f77735c73797374656d33325c636d642e657865"
        $key1 = "46415465616d507274734b"
        $key2 = "74734b6579232425214031"
    condition:
        $rtf and 1 of ($hexpattern*) and 1 of ($key*)
}

rule CrowdStrike_CSIT_13017_03 : makadocs rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Makadocs RAT (2012 version)"
        reports = "CSIT-13017"
        version = "202101291828"
        last_modified = "2021-01-29"
        in_the_wild = true
        date = "01 Feb 2013"
    strings:
        $boundary = "----------------This_is_a_boundary$"
        $opentag = "[##]"
        $closetag = "[/##]"
        $answer = "Answer for command ["
        $path1 = "c:\\windows\\command.com"
        $path2 = "c:\\winnt\\system32\\cmd.exe"
        $path3 = "c:\\windows\\system32\\cmd.exe"
        $googledoc = "https://docs.google.com/viewer?url=%s&embedded=true"
    condition:
        all of them
}

rule CrowdStrike_CSIT_13017_04 : makadocs malicious_document 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "RTF Document Containing Makadocs RAT (2012 version)"
        reports = "CSIT-13017"
        version = "202101291828"
        last_modified = "2021-01-29"
        in_the_wild = true
        date = "01 Feb 2013"
    strings:
        $rtf = "\\rtf1"
        $hexpattern1 = "2d2d2d2d2d2d2d2d2d2d2d2d2d2d2d2d546869735f69735f615f626f756e6461727924"
        $hexpattern2 = "5b23235d"
        $hexpattern3 = "5b2f23235d"
        $hexpattern4 = "416e7377657220666f7220636f6d6d616e64205b" nocase
        $hexpattern5 = "633a5c77696e646f77735c636f6d6d616e642e636f6d"
        $hexpattern6 = "633a5c77696e6e745c73797374656d33325c636d642e657865"
        $hexpattern7 = "633a5c77696e646f77735c73797374656d33325c636d642e657865"
        $googlecode1 = "68747470733a2f2f646f63732e676f6f"
        $googlecode2 = "676c652e636f6d2f7669657765723f75"
    condition:
        $rtf and 1 of ($hexpattern*) and 1 of ($googlecode*)
}

rule CrowdStrike_CSIT_13069_01 : dropper unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects decrypted dropper file documented in CSIT-13069"
        reports = "CSIT-13069"
        version = "201307180000"
        last_modified = "2013-07-18"
    strings:
        // The following strings are present as separators for the
        // data to be unpacked by the obfuscated code.
        $pe_marker_1 = "goingbacksoon"
        $pe_marker_2 = "goingbacksoon1goingbacksoon"
    condition:
        all of them
}

rule CrowdStrike_CSIT_13080_01 : numbered_panda ixeshe rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "String present in 'QRTF' Ixeshe variant"
        reports = "CSIT-13080,CSIT-13024"
        version = "201307250000"
        last_modified = "2013-07-25"
        actor = "NUMBERED PANDA"
        malware_family = "Ixeshe"
    strings:
        $killproc = "Process Do not exit in 10 second, so i Kill it!"
    condition:
        $killproc
}

rule CrowdStrike_CSIT_13080_02 : numbered_panda ixeshe rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "MOV instruction for NUMBERED PANDA's Base64 alphabet"
        reports = "CSIT-13080,CSIT-13024"
        version = "201307250000"
        last_modified = "2013-07-25"
        actor = "NUMBERED PANDA"
        malware_family = "Ixeshe"
    strings:
        $mov = { c6 45 ?? 2b c6 45 ?? 4e c6 45 ?? 4f c6 45 ?? 35 c6 45 ?? 52 c6 45 ?? 5a c6 45 ?? 61 c6 45 ?? 47 c6 45 ?? 48 c6 45 ?? 76 c6 45 ?? 69 c6 45 ?? 49 c6 45 ?? 6a c6 45 ?? 68 c6 45 ?? 59 c6 45 ?? 71 c6 45 ?? 38 c6 45 ?? 62 c6 45 ?? 34 c6 45 ?? 6e c6 45 ?? 64 c6 45 ?? 51 c6 45 ?? 3d c6 45 ?? 50 c6 45 ?? 30 c6 45 ?? 31 c6 45 ?? 32 c6 45 ?? 79 c6 45 ?? 53 c6 45 ?? 54 c6 45 ?? 63 c6 45 ?? 43 c6 45 ?? 44 c6 45 ?? 72 c6 45 ?? 73 c6 45 ?? 2f c6 45 ?? 78 c6 45 ?? 50 c6 45 ?? 67 c6 45 ?? 55 c6 45 ?? 7a c6 45 ?? 36 c6 45 ?? 37 c6 45 ?? 46 c6 45 ?? 4d c6 45 ?? 33 c6 45 ?? 77 c6 45 ?? 65 c6 45 ?? 6d c6 45 ?? 4b c6 45 ?? 66 c6 45 ?? 6b c6 45 ?? 4a c6 45 ?? 4c c6 45 ?? 42 c6 45 ?? 6f c6 45 ?? 39 c6 45 ?? 56 c6 45 ?? 74 c6 45 ?? 57 c6 45 ?? 58 c6 45 ?? 6c c6 45 ?? 45 c6 45 ?? 75 c6 45 ?? 41 }
    condition:
        $mov
}

rule CrowdStrike_CSIT_13080_03 : numbered_panda ixeshe dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "MOV instructions for NUMBERED PANDA dropper"
        reports = "CSIT-13080,CSIT-13024"
        version = "201307250000"
        last_modified = "2013-07-25"
        actor = "NUMBERED PANDA"
        malware_family = "Ixeshe"
    strings:
        $regedit = { c6 85 ?? ?? ff ff 52 c6 85 ?? ?? ff ff 45 c6 85 ?? ?? ff ff 47 c6 85 ?? ?? ff ff 45 c6 85 ?? ?? ff ff 44 c6 85 ?? ?? ff ff 49 c6 85 ?? ?? ff ff 54 }
        $regeditexe = { c6 45 ?? 72 c6 45 ?? 65 c6 45 ?? 67 c6 45 ?? 65 c6 45 ?? 64 c6 45 ?? 69 c6 45 ?? 74 c6 45 ?? 2e c6 45 ?? 65 c6 45 ?? 78 c6 45 ?? 65 }
    condition:
        any of them
}

rule CrowdStrike_CSIT_13071_01 : rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects RAT documented in CSIT-13071"
        reports = "CSIT-13071"
        version = "201308010000"
        last_modified = "2013-08-01"
    strings:
        $beacon_packet = "this is UP007"
        $dll_import_1 = "GetAllBaseInfo"
        $dll_import_2 = "Start"
        $dll_import_3 = "MessageLoop"
    condition:
        all of them
}

rule CrowdStrike_CSIT_13071_02 : dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects stage 1 dropper used to deploy RAT documented in CSIT-13071"
        reports = "CSIT-13071"
        version = "201308010000"
        last_modified = "2013-08-01"
    strings:
        $pdf_marker_1 = "ZXCVFDSA#$%@"
        $pdf_marker_2 = "MNBKJHUY@#$%wert"
        $decryption_loop = { 80 31 34 41 4a 75 }
    condition:
        all of them
}

rule CrowdStrike_CSIT_13071_03 : dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects stage 2 dropper used to deploy RAT documented in CSIT-13071"
        reports = "CSIT-13071"
        version = "201308010000"
        last_modified = "2013-08-01"
    strings:
        $mutex = "h31415926"
        $hooked_api = "ExitProcess"
        $decryption_loop = { 30 10 41 3b 4c 24 08 7c }
    condition:
        all of them
}

rule CrowdStrike_CSIT_13071_04 : dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects modified Sandboxie SbieDll.dll used to deploy RAT documented in CSIT-13071"
        reports = "CSIT-13071"
        version = "201308010000"
        last_modified = "2013-08-01"
    strings:
        $name = "SBieDll.dll"
        $exports_1 = "SbieApi_Log"
        $exports_2 = "SbieDll_Hook"
        $maindll = "maindll.dll" wide
    condition:
        all of them
}

rule CrowdStrike_CSIT_13074_01 : bitterbug dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects SFX Dropper documented in CSIT-13074"
        reports = "CSIT-13074"
        version = "201308070000"
        last_modified = "2013-08-07"
        malware_family = "BitterBug"
    strings:
        $rarhdr = "Rar!"
        $curl = /libcurld?.dll/
        $runtime = /msvcr90d?.dll/
        $file_1 = "Start.exe"
        $file_2 = "ExtractPDF.exe"
        $file_3 = "winsocks.exe"
        $file_4 = "winupdate.exe"
    condition:
        ($rarhdr and $curl and $runtime) and 1 of ($file_1, $file_2, $file_3, $file_4)
}

rule CrowdStrike_CSIT_13077_02 : deep_panda madhatter rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detection of .NET MadHatter RAT used by DEEP PANDA"
        reports = "CSIT-13077"
        version = "201308150000"
        last_modified = "2013-08-15"
        actor = "DEEP PANDA"
        malware_family = "MadHatter"
    strings:
        $xor_decode = {06 08 8F 3C 00 00 01 25 71 3C 00 00 01 1F ?? 61 D2 81 3C 00 00 01 08 17 58 0C 08 06 8E 69 32 E0}
    condition:
        $xor_decode
}

rule CrowdStrike_CSIT_13077_03 : deep_panda madhatter rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detection of .NET MadHatter RAT used by DEEP PANDA"
        reports = "CSIT-13077"
        version = "201308150000"
        last_modified = "2013-08-15"
        actor = "DEEP PANDA"
        malware_family = "MadHatter"
    strings:
        $marker = "BinBuck"
        $marker_set1 = "set_Account"
        $marker_set2 = "set_Password"
        $marker_set3 = "set_Username"
        $marker_set4 = "set_Description"
        $marker_set5 = "set_DisplayName"
        $marker_set6 = "set_ServiceName"
    condition:
        $marker and 2 of ($marker_set*)
}

rule CrowdStrike_CSIT_13081_04 : certificate 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Code signing cert seen used with Bisty malware. It is a good indicator to use to detect possibly malicious files, but is not be strong enough by itself to use for attribution."
        reports = "CSIT-13081"
        version = "201308150000"
        last_modified = "2013-08-15"
    strings:
        $pubkey =  { 30 81 89 02 81 81 00 c7 27 ff ae 44 8a 63 ba a6 b7 9d 4c 6c 84 b0 fb 4d d6 e3 96 b2 11 cb 13 89 61 75 0f a2 cd 67 4e 3d 9a 25 7a 8e e4 b3 38 40 8e 17 bc d8 5f 74 2c 72 a7 ed 2c 49 f5 1d d0 4d 44 14 e8 3c 21 ab 5a 79 58 01 b1 e3 ef fd fa 2a b3 55 2a d8 ba ef 24 c4 4a b4 f0 d2 0c 8e 5d 33 b4 8c 6a 9b ac ef a3 be 3f 4a 70 b4 93 4d fc a2 f7 dc 19 e0 a0 2b d9 27 78 d8 95 bb 78 15 d7 2b 60 5c 67 1b 64 e0 01 02 03 01 00 01 }
        $serial = { e9 87 1a 29 17 c9 48 a7 4c 25 cc d1 16 bd 95 c6 }
    condition:
        all of them
}

rule CrowdStrike_CSIR_13013_04 : silent_chollima rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Victim id hash generator used in SILENT CHOLLIMA malware"
        reports = "CSIR-13013,CSIR-13014"
        version = "201308230000"
        last_modified = "2013-08-23"
        actor = "SILENT CHOLLIMA"
    strings:
        $hasher_gen_1 = { 0d 00 00 00 8b ?? [0-2] d1 e? c1 e? 1f 03 ?? 4? 75 f? }
        $hasher_gen_2 = { 6a 0d [2-16] d1 e? c1 e? 1f 03 ?? 4? [2-8] 75 }
        $hasher_gen_xored = { 8b 4d 0c 8b 55 0c 83 ea 01 89 55 0c 85 c9 74 19 8b 45 08 03 45 0c 0f be 08 81 f1 ff 00 00 00 8b 55 08 03 55 0c 88 0a eb d7 }
    condition:
        any of them
}

rule CrowdStrike_CSIR_13014_01 : silent_chollima delivery_document key 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "PDF RSA key used in SILENT CHOLLIMA campaigns"
        reports = "CSIR-13014"
        version = "201308230000"
        last_modified = "2013-08-23"
        actor = "SILENT CHOLLIMA"
    strings:
        $rsa_2_A = { 07 02 00 00 00 a4 00 00 52 53 41 32 00 04 00 00 01 00 01 00 a7 2b e0 23 bd b9 1f 22 41 f6 d0 21 dd a0 97 9d ad 3a b7 27 24 91 eb 55 f5 d9 7c a7 de 40 c4 fc 11 79 a6 22 2e f7 db ca 09 85 ed 90 6b aa 3d 99 ef b3 40 af 95 2f 94 75 58 ba f6 37 6e 9f 74 47 79 72 57 dc ae b0 06 ef 72 dd af 68 8c ef 5b 16 9e f6 a6 87 bd ba 43 b3 98 20 84 e5 04 9e 53 07 83 53 5d 19 ef f0 cc 06 dd af 75 6d 8e 18 73 de ea 9a 39 69 8e e4 dd 48 45 93 46 5f 19 48 d3 d5 d7 fc 6d f2 3a c6 f8 5c 06 fb 59 2a 28 85 44 61 14 be ac cc 99 2b 3b 6f b5 0f 66 2e ed b7 bc ce 73 2d 89 ff 15 0f 90 1d 74 9a bc da d3 16 c9 0d 70 1d 43 2c 6f 3a 77 17 fd ee 52 d8 c6 98 23 ed b1 1d 50 bb 93 6c b3 5c d5 fb 38 8c 1b 24 0b 2d 25 08 88 cd 5d ea e5 55 5b a3 7b aa bc da 33 26 20 7d 3f 69 4e 3b 3d 8f e6 12 9b 17 56 c2 43 31 c4 be b7 71 ca 48 e8 12 22 a9 32 63 14 fe d4 e6 21 a3 36 16 8f 90 f3 28 3f fe 09 cc 03 9e cc 80 1f d3 41 0c 97 78 6d 87 41 ad 33 94 35 58 bb 6d 7a 0e 80 38 4a f6 97 e7 7b bd 31 33 ac c3 fb 3e f6 87 56 23 e8 f0 0f e3 cd 53 fc 00 34 f3 13 ab 71 f9 7b d5 d8 b0 89 bb c0 23 f5 5d 20 7a ae db 3e 10 6b 82 06 e5 26 5e 1c d0 2b d7 e2 af 88 79 4d c9 51 38 56 84 b4 c6 6f f5 52 fc bc 07 81 51 7b 59 7c 27 a6 58 79 fa 7d 2a 40 46 52 9a c1 d4 13 1f 95 fd 1b 86 a3 29 88 3a 63 58 f7 74 32 c2 6e 1d 12 c8 92 85 a1 15 4f 82 7d 43 6b e2 17 79 a1 af 84 cd 94 f0 6a d2 f4 24 56 49 95 b8 59 61 69 23 1c c3 16 ce cd 25 20 40 1c 49 03 21 6d 33 41 a3 94 6b a6 f3 6a a1 e9 25 cc 06 8b ae 52 65 91 d7 da 2b 7f 82 18 22 98 04 5a f2 24 df 72 e5 b7 da 16 eb b3 8d f2 43 ae cd 89 6c 5f 81 e5 a1 4a ba d1 2e d5 d3 a6 d3 b3 18 77 6d 47 70 92 ce d4 0a f7 38 9d fb 16 f3 b2 be 0e 00 21 d5 b1 c5 d1 c8 a9 4c 0c f1 50 0e 7f c0 17 49 90 1a 5a bf 95 b3 16 c2 64 7a 14 23 b0 78 50 d0 1f 14 3b 76 6e 6e e1 9f 12 3b 79 68 87 e2 5b d4 c8 e1 fe 4a }
    condition:
        any of them
}

rule CrowdStrike_CSIR_13014_02 : silent_chollima key 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "SILENT CHOLLIMA - XTEA Encode Strings"
        reports = "CSIR-13014,CSIT-18103"
        version = "201807060940"
        last_modified = "2018-07-06"
        actor = "SILENT CHOLLIMA"
    strings:
        $base64alphabet = "3bcd1fghijklmABCDEFGH-J+LMnopq4stuvwxyzNOPQ7STUVWXYZ0e2ar56R89K/"
        // Key="system32"
        $encstring_system32 = "7E27B224EA15B787A428DCFE47A7216B3DA9C447AC522DEB"
        // key = "hongkong"
        $downexec = "9C886AAD51AC7356"
    condition:
        any of them
}

rule CrowdStrike_CSIR_13014_03 : silent_chollima rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Mapping string used in SILENT CHOLLIMA malware"
        reports = "CSIR-13014"
        version = "201308230000"
        last_modified = "2013-08-23"
        actor = "SILENT CHOLLIMA"
    strings:
        $w = "w8rT$3%cnpost^~Q"
    condition:
        all of them
}

rule CrowdStrike_CSIR_13014_04 : silent_chollima password 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Password used in zip files generated by SILENT CHOLLIMA malware"
        reports = "CSIR-13014"
        version = "201308230000"
        last_modified = "2013-08-23"
        actor = "SILENT CHOLLIMA"
    strings:
        $pw_plain  = "dkwero38oerA^t@#"
        $pw_xor = { 9b 94 88 9a 8d 90 cc c7 90 9a 8d be a1 8b bf dc }
    condition:
        any of them
}

rule CrowdStrike_CSIR_13014_06 : silent_chollima key 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Concealment Troy RC4 Key"
        reports = "CSIR-13014"
        version = "201308230000"
        last_modified = "2013-08-23"
        actor = "SILENT CHOLLIMA"
        malware_family = "Concealment Troy"
    strings:
        $enc = "xt6<m%g7k^D4.7xD"
        $dec = "tp28i!c3gZ@0*3t@"
    condition:
        any of them
}

rule CrowdStrike_CSIR_13014_07 : silent_chollima lsg_rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "LSG RAT payload boundary"
        reports = "CSIR-13014"
        version = "201308230000"
        last_modified = "2013-08-23"
        actor = "SILENT CHOLLIMA"
        malware_family = "LSG RAT"
    strings:
        $enc = { d2d2d2d2d2d2d2d2d2d2d2d2d2d2d2d2d2d2d2d2d2d2d2d2d2d2d2d2d2c89b9dcd9b9acdcecdcfce9d9e }
        $dec = "-----------------------------7db2de21201ba"
    condition:
        any of them
}

rule CrowdStrike_CSIR_13014_08 : silent_chollima lsg_rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "LSG RAT mutex (XORed)"
        reports = "CSIR-13014"
        version = "201308230000"
        last_modified = "2013-08-23"
        actor = "SILENT CHOLLIMA"
        malware_family = "LSG RAT"
    strings:
        $enc_mutex = { bcabb9d1bc90928fababbc9e9c979ad1adb2acbb9a999e8a938b }
        $enc_xteakey = { 979e9a8d9d9691cecdcccbcac9 }
    condition:
        any of them
}

rule CrowdStrike_CSIT_13032_08 : silent_chollima rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "SILENT CHOLLIMA - IRC Bot"
        reports = "CSIT-13032,CSIR-13014"
        version = "201308230000"
        last_modified = "2013-08-23"
        actor = "SILENT CHOLLIMA"
    strings:
        $plgnls = "%s\\plg%d.nls"
        $owner = "RegisteredOwner"
        $org = "RegisteredOrganization"
        $last_modified = "InstallDate"
        $sleep = "I 'll sleep until to restart ..."
    condition:
        all of them
}

rule CrowdStrike_CSIR_13014_05 : silent_chollima tdrop rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Base64 alphabet used in TDrop malware"
        reports = "CSIR-13014,CSIT-18103"
        version = "201807300959"
        last_modified = "2018-07-30"
        actor = "SILENT CHOLLIMA"
        malware_family = "TDrop"
    strings:
        $alphabet = "3bcd1fghijklmABCDEFGH-J+LMnopq4stuvwxyzNOPQ7STUVWXYZ0e2ar56R89K/"
    condition:
        all of them
}

rule CrowdStrike_CSIT_13078_01 : numbered_panda shownews rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "ShowNews RAT used by NUMBERED PANDA"
        reports = "CSIT-13078"
        version = "201308280000"
        last_modified = "2013-08-28"
        actor = "NUMBERED PANDA"
        malware_family = "ShowNews"
    strings:
        $nid = "ShowNewsID"
        $tvt = "tvtsvc is running"
    condition:
        any of them
}

rule CrowdStrike_CSIT_13078_02 : numbered_panda rat_3001 rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "3001 RAT used by NUMBERED PANDA"
        reports = "CSIT-13078"
        version = "201308280000"
        last_modified = "2013-08-28"
        actor = "NUMBERED PANDA"
        malware_family = 3001
    strings:
        $upload = "#============Upload Ok !==============#"
        $upexec = "#=========Upload Execute Ok !=========#"
        $uplast_modified = "#========Update Execute Ok !==========#"
    condition:
        all of them
}

rule CrowdStrike_CSIT_13081_03 : bisty rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Bisty RAT"
        reports = "CSIT-13117"
        version = "201807300936"
        last_modified = "2018-07-30"
        malware_family = "Bisty"
    strings:
        $passerror = "%cget %s 's password error!"
        $inst_comp = "SOFTWARE\\Microsoft\\Active Setup\\Installed Components\\{e3df6b419d1f}"
        $key_name1 = "<Start Application 2 key>"
        $key_name2 = "<Start Application 1 key>"
        $key_name3 = "<Select Media key>"
        $key_name4 = "<Start Mail key>"
        $key_name5 = "<Play/Pause Media key>"
    condition:
        ($passerror and $inst_comp) or 3 of ($key_name*)
}

rule CrowdStrike_CSIT_13081_05 : credential_theft 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "MSGINA-hoking password stealer"
        reports = "CSIT-13081"
        version = "201309010000"
        last_modified = "2013-09-01"
    strings:
        $func = "WlxLoggedOutSAS"
        $dll = "msgina.dll"
        $name = "\\Br0WMinUSerS.DLL"
    condition:
        $func and $dll and $name
}

rule CrowdStrike_CSIT_13081_06 : bot uniquebot unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Memory detection for UniqueBot bot"
        reports = "CSIT-13081"
        version = "201908060729"
        last_modified = "2019-08-06"
        malware_family = "UniqueBot"
    strings:
        $beacon1 = "program=bot&country=" wide
        $beacon2 = "&name=" wide
        $beacon3 = "&opsys=" wide
        $beacon4 = "&version=" wide
        $beacon5 = "&hwid=" wide
        $cmd1 = "httpflood"
        $cmd2 = "synflood"
        $cmd3 = "udpflood"
        $cmd4 = "tcpflood"
        $cmd5 = "downandexe"
        //$cmd6 = "visit"
        //$cmd7 = "update"
        $cmd8 = "socks"
    condition:
        3 of ($cmd*) and 2 of ($beacon*)
}

rule CrowdStrike_CSIT_13117_01 : bisty dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Bisty RAT dropper"
        reports = "CSIT-13117"
        version = "201309010000"
        last_modified = "2013-09-01"
        malware_family = "Bisty"
    strings:
        $mutexname = "Rsing"
        $cmd1 = "DELETE-TCB"
        $cmd2 = "TIME-WAIT"
        $cmd3 = "1LAST-A"
        $cmd4 = "CLOSING"
        $cmd5 = "!FIN!"
        $cmd6 = "SYN-RECEIV"
    condition:
        $mutexname and 3 of ($cmd*)
}

rule CrowdStrike_CSIT_13082_01 : chopper webshell 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Malicious command execution code included in the China Chopper webshell"
        reports = "CSIT-13082"
        version = "202010081907"
        last_modified = "2020-10-08"
        malware_family = "Chopper"
    strings:
        $php = /<?php @eval\(\$_POST\[\'[a-zA-Z0-9_]+\'\]\);\?>/
        $asp = /<%eval request\(\"[a-zA-Z0-9_]+\"\)%>/
        $aspx = /<%@ Page Language=\s?\"Jscript\"\s?%><%eval\(Request.Item\[\"[A-Za-z0-9_]+\"\],\"unsafe\"\);%>/
    condition:
        any of them and filesize < 200
}

rule CrowdStrike_CSIT_13082_02 : chopper webshell 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Rule fires on the Chopper webshell victim database"
        reports = "CSIT-13082"
        version = "201309040000"
        last_modified = "2013-09-04"
        malware_family = "Chopper"
    strings:
        $myinput = "MYINPUT" wide nocase
        $config = "CONFIG" wide nocase
        $qlink = "QLink" wide nocase
        $event = "EVENT" wide nocase
        $site = "SITE" wide nocase
        $type = "TYPE" wide nocase
    condition:
        all of them
}

rule CrowdStrike_CSIT_13082_03 : chopper webshell 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Cold Fusion script used with the Chopper webshell"
        reports = "CSIT-13082"
        version = "201309040000"
        last_modified = "2013-09-04"
        malware_family = "Chopper"
    strings:
        $z1 = "Form.z1"
        $z2 = "Form.z2"
        $c2_delimiter = "ToBinary(ToBase64(\"->\"&\"|\")"
    condition:
        all of them
}

rule CrowdStrike_CSIT_13082_04 : chopper webshell 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Rule detects a possible Chopper webshell variant compiled in .NET"
        reports = "CSIT-13082"
        version = "201309040000"
        last_modified = "2013-09-04"
        malware_family = "Chopper"
    strings:
        $unsafe = "\"unsafe\")" ascii wide
        $eval = "eval(Request[/*-/*-*/" ascii wide
    condition:
        all of them
}

rule CrowdStrike_CSIT_13082_05 : chopper webshell 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Alternative form of Chopper webshell"
        reports = "CSIT-13082"
        version = "201309040000"
        last_modified = "2013-09-04"
        malware_family = "Chopper"
    strings:
        $ev = "\"e\"+\"v\"+"
        $request = "(\"+\"R\"+\"e\"+/*-/*-*/\"q\"+\"u\"+\"e\"/*-/*-*/+\"s\"+\"t\"+"
    condition:
        all of them
}

rule CrowdStrike_CSIT_13082_08 : chopper webshell 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Malicious JSP script used by China Chopper webshell"
        reports = "CSIT-13082"
        version = "202004271728"
        last_modified = "2020-04-27"
        malware_family = "Chopper"
    strings:
        $z1 = "String z1"
        $z2 = "String z2"
        $response_delimiter1 = "os.write((\"->\"+\"|\")"
        $response_delimiter2 = "os.write((\"|\"+\"<-\")"
    condition:
        all of them
}

rule CrowdStrike_CSIT_13083_01 : spicy_panda taidoor dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Taidoor dropper"
        reports = "CSIT-13083"
        version = "201309070000"
        last_modified = "2013-09-07"
        actor = "SPICY PANDA"
        malware_family = "Taidoor"
    strings:
        // Resource type
        $rsrctype = "MOD" wide
        // Encrypted PE header
        $encpe = { 78 6f a5 00 36 00 00 00 31 00 00 00 ff ff 00 00 8d 00 00 00 00 00 00 00 75 00 00 00 00 00 00 00 }
    condition:
        all of them
}

rule CrowdStrike_CSIT_13083_02 : spicy_panda taidoor loader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Taidoor loader"
        reports = "CSIT-13083"
        version = "201309070000"
        last_modified = "2013-09-07"
        actor = "SPICY PANDA"
        malware_family = "Taidoor"
    strings:
        // Encrypted PE header
        $encpe = { 6f 60 c8 00 7a 00 00 00 8d 00 00 00 c8 6f 00 00 9a 00 00 00 00 00 00 00 c9 00 00 00 00 00 00 00 }
    condition:
        all of them
}

rule CrowdStrike_CSIT_13083_03 : spicy_panda taidoor downloader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Taidoor downloader"
        reports = "CSIT-13083"
        version = "201309070000"
        last_modified = "2013-09-07"
        actor = "SPICY PANDA"
        malware_family = "Taidoor"
    strings:
        // Config decryption routine
        $code =  { 33 d2 39 54 24 08 7e 1d 8b 44 24 04 8d 0c 02 8a 04 02 3c 23 74 08 84 c0 74 04 34 23 88 01 42 3b 54 24 08 7c e3 c3 33 d2 39 54 24 08 7e 19 8b 44 24 04 8d 0c 02 8a 04 02 3c 07 74 04 34 07 88 01 }
    condition:
        all of them
}

rule CrowdStrike_CSIT_13085_01 : goblin_panda httptunnel dropper delivery_document 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Binhex-encoded HttpTunnel RAT dropper, likely embedded in a malicious document"
        reports = "CSIT-13085"
        version = "201309090000"
        last_modified = "2013-09-09"
        actor = "GOBLIN PANDA"
        malware_family = "HttpTunnel"
    strings:
        $encstr = "dcd2db91dac7da9f90dc9fcfd6d1d89f8e8d88918f918f918e9f92d19f8a99dcd2db91dac7da9f90dc9fdecbcbcdd6dd9f92d79f9d9acc9d99dcd2db91dac7da9f"
    condition:
        all of them
}

rule CrowdStrike_CSIT_13085_02 : goblin_panda httptunnel dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "HttpTunnel RAT dropper"
        reports = "CSIT-13085"
        version = "201309090000"
        last_modified = "2013-09-09"
        actor = "GOBLIN PANDA"
        malware_family = "HttpTunnel"
    strings:
        $cmd1 = "cmd.exe /c ping 127.0.0.1 -n 5&cmd.exe /c attrib -h \"%s\"&cmd.exe "
        $cmd2 = "cmd.exe /c move %s %s"
        $cmd3 = "cmd.exe /c copy %s %s"
        $cmd4 = "cmd.exe /c %s %s RundllInstallA"
    condition:
        all of them
}

rule CrowdStrike_CSIT_13085_03 : goblin_panda httptunnel installer 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "HttpTunnel RAT installer"
        reports = "CSIT-13085"
        version = "201309090000"
        last_modified = "2013-09-09"
        actor = "GOBLIN PANDA"
        malware_family = "HttpTunnel"
    strings:
        // Start of function that parses the embedded DLL's optional header
        $parseopthdr = { 8b 44 24 0c 56 57 33 d2 8b 70 3c 8b 78 20 8b c6 f7 f7 85 d2 74 }
        $exportname = "RundllInstallA"
    condition:
        all of them
}

rule CrowdStrike_CSIT_13085_04 : goblin_panda httptunnel rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "HttpTunnel RAT"
        reports = "CSIT-13085"
        version = "201309090000"
        last_modified = "2013-09-09"
        actor = "GOBLIN PANDA"
        malware_family = "HttpTunnel"
    strings:
        // Log messages
        $logmsg1 = "[1][not httptunnel]"
        $logmsg2 = "[1][httptunnel]"
        // Commands
        $cmd1 = "upfile"
        $cmd2 = "downfile"
    condition:
        all of them
}

rule CrowdStrike_CSIT_13085_05 : goblin_panda httptunnel rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "HttpTunnel RAT"
        reports = "CSIT-13085"
        version = "201309090000"
        last_modified = "2013-09-09"
        actor = "GOBLIN PANDA"
        malware_family = "HttpTunnel"
    strings:
        $movecmd = "cmd /k move \"%s\" \"%s\""
        $ipconfig = "ipconfig.exe"
    condition:
        all of them
}

rule CrowdStrike_CSIR_13023_01 : stabuniq rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Stabuniq RAT"
        reports = "CSIR-13023"
        version = "201809251137"
        last_modified = "2018-09-25"
        malware_family = "Stabuniq"
    strings:
        $StartDocA = "StartDocA"
        $ZwUnmapViewOfSection = "ZwUnmapViewOfSection"
        $NtUnmapViewOfSection = "NtUnmapViewOfSection"
        $StartDocLoop = {6A 00 6A 00 FF [1-5] 4? 75 [1-8] C3}
        $SboxInit = {33 ?? B? [4] 89 ?? 83 C? 04 4? [5-6] 7C}
        // E8 ?? ?? ?? ??     call    _rand
        // 25 01 00 00 80     and     eax, 80000001h
        // 79 ??              jns     short loc_402119
        // 48                 dec     eax
        // 83 C8 FE           or      eax, 0FFFFFFFEh
        // 40                 inc     eax
        //
        // loc_402119:        ; CODE XREF: WinMain(x,x,x,x)+3D
        // 85 C0              test    eax, eax
        // 74 ??              jz      short loc_402169
        // 6A 00              push    0               ; dwFlags
        // 6A 00              push    0               ; dwTime
        // 6A 00              push    0               ; hWnd
        // FF 15 ?? ?? ?? ??  call    AnimateWindow
        // 6A 00              push    0               ; dwCopyFlags
        // 6A 00              push    0               ; pbCancel
        // 6A 00              push    0               ; lpData
        // 6A 00              push    0               ; lpProgressRoutine
        // 6A 00              push    0               ; lpNewFileName
        // 6A 00              push    0               ; lpExistingFileName
        // FF 15 ?? ?? ?? ??  call    CopyFileExW
        // 6A 00              push    0               ; uExitCode
        // 6A 00              push    0               ; hJob
        // FF 15 ?? ?? ?? ??  call    TerminateJobObject
        // 6A 00              push    0               ; dwCopyFlags
        // 6A 00              push    0               ; pbCancel
        // 6A 00              push    0               ; lpData
        // 6A 00              push    0               ; lpProgressRoutine
        // 6A 00              push    0               ; lpNewFileName
        // 6A 00              push    0               ; lpExistingFileName
        // FF 15 ?? ?? ?? ??  call    CopyFileExW
        // 6A 00              push    0               ; uExitCode
        // 6A 00              push    0               ; hJob
        // FF 15 ?? ?? ?? ??  call    TerminateJobObject
        // FF 15 ?? ?? ?? ??  call    GetACP
        // EB ??              jmp     short loc_402108
        $RandLoopWithJunkApiCalls = {E8 [4] 25 01 00 00 80 79 ?? 48 83 C8 FE 40 85 C0 74 ?? 6A 00 6A 00 6A 00 FF 15 [4] 6A 00 6A 00 6A 00 6A 00 6A 00 6A 00 FF 15 [4] 6A 00 6A 00 FF 15 [4] 6A 00 6A 00 6A 00 6A 00 6A 00 6A 00 FF 15 [4] 6A 00 6A 00 FF 15 [4] FF 15 [4] EB}
    condition:
        ($StartDocA and ($ZwUnmapViewOfSection or $NtUnmapViewOfSection) and $StartDocLoop and $SboxInit) or $RandLoopWithJunkApiCalls
}

rule CrowdStrike_CSIR_13024_02 : certificate wicked_spider 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Signatures for stolen certificates used by WICKED SPIDER"
        reports = "CSIR-13024"
        version = "201910140813"
        last_modified = "2019-10-14"
        actor = "WICKED SPIDER"
    strings:
        $liveplex_cn = "LivePlex Corp"
        $liveplex_serial = { 1c aa 0d 0d ad f3 2a 24 04 a7 51 95 ae 47 82 0a }
        $estsoft_cn = "ESTsoft Corp."
        $estsoft_serial = { 30 d3 fe 26 59 1d 8e ac 8c 30 66 7a c4 99 9b d7 }
        $mgame_cn = "MGAME Corp."
        $mgame_serial = { 4e eb 08 05 55 f1 ab f7 09 bb a9 ca e3 2f 13 cd }
        $ynk_cn = "YNK JAPAN Inc"
        $ynk_serial = { 67 24 34 0d db c7 25 2f 7f b7 14 b8 12 a5 c0 4d }
        $guangzhou_cn = "Guangzhou YuanLuo Technology Co.,Ltd"
        $guangzhou_serial = { 0b 72 79 06 8b eb 15 ff e8 06 0d 2c 56 15 3c 35 }
        $fantasy_tech_cn = "Fantasy Technology Corp."
        $fantasy_tech_serial = { 75 82 f3 34 85 aa 26 4d e0 3b 2b df 74 e0 bf 32 }
        $neowiz_cn = "Neowiz CORPORATION"
        $neowiz_serial = { 5c 2f 97 a3 1a bc 32 b0 8c ac 01 00 59 8f 32 f6 }
        $kog_cn = "KOG Co., Ltd."
        $kog_serial = { 66 e3 f0 b4 45 9f 15 ac 7f 2a 2b 44 99 0d d7 09 }
        $rosso_cn = "ROSSO INDEX K.K."
        $rosso_serial = { 01 00 00 00 00 01 29 7d ba 69 dd }
        $wemade_cn = "Wemade Entertainment"
        $wemade_serial = { 61 00 39 d6 34 9e e5 31 e4 ca a3 a6 5d 10 0c 7d }
        $gameforge_cn = "Gameforge Productions GmbH"
        $gameforge_serial = { 56 62 58 22 4b e2 96 6e 32 66 0b fa 22 f6 a4 bc }
        $sesisoft_cn = "Sesisoft"
        $sesisoft_serial = { 61 3e 2f a1 4e 32 3c 69 ee 3e 72 0c 27 af e4 ce }
    condition:
        filesize < 1MB and
        (($liveplex_cn and $liveplex_serial) or
        ($estsoft_cn and $estsoft_serial) or
        ($mgame_cn and $mgame_serial) or
        ($ynk_cn and $ynk_serial) or
        ($guangzhou_cn and $guangzhou_serial) or
        ($fantasy_tech_cn and $fantasy_tech_serial) or
        ($neowiz_cn and $neowiz_serial) or
        ($kog_cn and $kog_serial) or
        ($rosso_cn and $rosso_serial) or
        ($wemade_cn and $wemade_serial) or
        ($gameforge_cn and $gameforge_serial) or
        ($sesisoft_cn and $sesisoft_serial))
}

rule CrowdStrike_CSIR_13015_05 : magic_kitten rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "RAT used by MAGIC KITTEN"
        reports = "CSIR-13015"
        version = "201309230000"
        last_modified = "2013-09-23"
        actor = "MAGIC KITTEN"
    strings:
        $proto = "HTTP/1.0"
        $useragent = "Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.8.0.6) Gecko/20060728 Firefox/1.5.0.6"
    condition:
        all of them
}

rule CrowdStrike_CSIR_13015_04 : magic_kitten rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "RAT used by MAGIC KITTEN"
        reports = "CSIR-13015"
        version = "201309250000"
        last_modified = "2013-09-25"
        actor = "MAGIC KITTEN"
    strings:
        // Embedded encrypted and compressed module
        $bytes = { 01 00 00 00 bb 45 00 00 b2 b5 }
    condition:
        all of them
}

rule CrowdStrike_CSIR_13021_01 : pale_panda dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Dropper used by PALE PANDA"
        reports = "CSIR-13021"
        version = "201309250000"
        last_modified = "2013-09-25"
        actor = "PALE PANDA"
    strings:
        $c21 = "CALLBACK[0]"
        $c22 = "CALLBACK[1]"
        $c23 = "CALLBACK[2]"
        $c24 = "CALLBACK[3]"
        $c25 = "CALLBACK[4]"
        $lsass = "MTBTR-DWE"
        $fname = "vckpba.dat"
    condition:
        ($lsass or $fname) and 3 of ($c2*)
}

rule CrowdStrike_CSIR_13021_02 : palepanda rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "RAT used by PALE PANDA"
        reports = "CSIR-13021"
        version = "201309250000"
        last_modified = "2013-09-25"
        actor = "PALE PANDA"
    strings:
        $error = "+RRROR oogin as %s"
        $beacon = "ID=%s,OEMCP=%d,ACP=%d"
        $cfg_01 = "002 TERMSRV=%d"
        $cfg_02 = "002 INJECT=%s"
        $cfg_03 = "002 SLEEP=%d"
        $cfg_04 = "002 CBM=%d"
        $cfg_05 = "002 CALLBACK[4]=%s"
        $cfg_06 = "002 CALLBACK[3]=%s"
        $cfg_07 = "002 CALLBACK[2]=%s"
        $cfg_08 = "002 CALLBACK[1]=%s"
        $cfg_09 = "002 CALLBACK[0]=%s"
        $cfg_10 = "002 RAMFree=%dMB"
        $cfg_11 = "002 RAM=%dMB"
        $cfg_12 = "002 CPU=%s"
        $cfg_13 = "002 IpAddress=%s"
        $cfg_14 = "002 Password=%s"
        $cfg_15 = "002 Time=%s"
        $cfg_16 = "002 OEMCP=%d"
        $cfg_17 = "002 OS=%s"
        $cfg_18 = "002 Group=%d"
        $cfg_19 = "002 Image=%d"
        $cfg_20 = "002 Name=%s"
        $cfg_21 = "002 Nick=%s"
        $cfg_22 = "002 Version=%s"
        $cfg_23 = "002 ID=%s"
    condition:
        ($error or $beacon) and 1 of ($cfg*)
}

rule CrowdStrike_CSIR_13015_03 : magic_kitten rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "RAT used by MAGIC KITTEN"
        reports = "CSIR-13015"
        version = "201309270000"
        last_modified = "2013-09-27"
        actor = "MAGIC KITTEN"
    strings:
        // Section starting with "Mehrdad" followed by function prolog
        $magic = { 4d 65 68 72 64 61 64 55 8b ec }
    condition:
        all of them
}

rule CrowdStrike_CSIT_14015_01 : jackpos pos_scraper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "JackPoS POS malware"
        reports = "CSIT-14015"
        version = "201310070000"
        last_modified = "2013-10-07"
        malware_family = "JackPoS"
    strings:
        $string1 = "/post/download"
        $string2 = "/post/echo"
        $string3 = "Java SE Platform Updater" wide
        $string4 = "00-00-00-00-00-00"
    condition:
        uint16(0) == 0x5A4D and uint32(uint32(0x3c)) == 0x4550 and all of them
}

rule CrowdStrike_CSIT_13091_02 : deep_panda downloader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "DEEP PANDA RAT downloader"
        reports = "CSIT-13091"
        version = "201310080000"
        last_modified = "2013-10-08"
        actor = "DEEP PANDA"
    strings:
        $cookie = "Cookie: pgv_pvid=%016I64d"
        $driver_guid = "{E190BC79-02DC-0166-4CF1-BD8F8CB2FF21}"
        $url_part = "index.htm?%016I64d"
    condition:
        any of them
}

rule CrowdStrike_CSIT_13091_03 : deep_panda rat unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "DEEP PANDA memory-resident RAT"
        reports = "CSIT-13091"
        version = "201310080000"
        last_modified = "2013-10-08"
        actor = "DEEP PANDA"
    strings:
        $message1 = "akasha_path: %s"
        $message2 = "cycle: %d, sleep time: %d"
        $message3 = "InstallDriver: %d %s(%s)"
        $message4 = "Succeed to drop, please wait for the next payload being loaded."
        $message5 = "!module mimi"
        $message6 = "!axel url path"
    condition:
        1 of ($message*)
}

rule CrowdStrike_CSIT_13094_01 : mongal dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Mongal dropper documented in CSIT-13094"
        reports = "CSIT-13094"
        version = "201310160000"
        last_modified = "2013-10-16"
        malware_family = "Mongal"
    strings:
        $decrypt_string = { 8a 17 8a 5c 07 01 80 ca f0 32 da 88 }
        $samlib = "samlib"
        $api = "SHCreateItemFromParsingName"
    condition:
        all of them
}

rule CrowdStrike_CSIT_13094_02 : mongal rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Sbox used by Mongal RAT"
        reports = "CSIT-13094"
        version = "201310160000"
        last_modified = "2013-10-16"
        malware_family = "Mongal"
    strings:
        // Encryption SBox used for decrypting the C2 configuration
        $crypt_sbox = { e0 d7 e0 68 20 e1 dc d1 ec 1e 1c 94 dd 65 c5 d3 59 86 cc f6 d3 bf 44 ee 8d 82 a0 76 7d f8 d1 f7 44 2d 68 2f d5 3e 9a 4a c8 89 64 98 e3 2f 98 7b dd e0 d7 e0 68 20 e1 dc d1 ec 1e 1c 94 dd 65 c5 d3 59 86 cc f6 d3 bf 44 ee 8d 82 a0 76 7d f8 d1 f7 44 2d 68 2f d5 3e 9a 4a c8 89 64 98 e3 2f 98 7b dd e0 d7 e0 68 20 e1 dc d1 ec 1e 1c 94 dd 65 c5 d3 59 86 cc f6 d3 bf 44 ee 8d 82 a0 76 7d f8 d1 f7 44 2d 68 2f d5 3e 9a 4a c8 89 64 98 e3 2f 98 7b dd e0 d7 e0 68 20 e1 dc d1 ec 1e 1c 94 dd 65 c5 d3 59 86 cc f6 d3 bf 44 ee 8d 82 a0 76 7d f8 d1 f7 44 2d 68 2f d5 3e 9a 4a c8 89 64 98 e3 2f 98 7b dd e0 d7 e0 68 20 e1 dc d1 ec 1e 1c 94 dd 65 c5 d3 59 86 cc f6 d3 bf 44 ee 8d 82 a0 76 7d f8 d1 f7 44 2d 68 2f d5 3e 9a 4a c8 89 64 98 e3 2f 98 7b dd e0 d7 e0 68 20 e1 dc d1 ec 1e 1c }
    condition:
        $crypt_sbox
}

rule CrowdStrike_CSIT_13094_03 : mongal delivery_document shellcode 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Word document shellcode used to deliver Mongal RAT"
        reports = "CSIT-13094"
        version = "201310160000"
        last_modified = "2013-10-16"
        malware_family = "Mongal"
    strings:
        // Word Document header
        $word_hdr = { d0 cf 11 e0 a1 b1 1a e1 }
        // Shellcode that decrypts itself (in raw bytes)
        $bytes = { 49 30 04 0a fe c8 85 c9 75 f6 }
        // And hex string for RTF documents
        $hexbytes = "4930040afec885c975f6"
    condition:
        ($word_hdr at 0) and 1 of ($bytes, $hexbytes)
}

rule CrowdStrike_CSIT_13096_01 : deep_panda webshell 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "DEEP PANDA ASP Backdoor Shell"
        reports = "CSIT-13096"
        version = "201310160000"
        last_modified = "2013-10-16"
        actor = "DEEP PANDA"
    strings:
        $exec = "<%execute request"
    condition:
        $exec and filesize < 50
}

rule CrowdStrike_CSIR_13022_01 : sabre_panda cavalry_rat rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "XORed JavaScript header used in Cavalry RAT"
        reports = "CSIR-13022"
        version = "201310210000"
        last_modified = "2013-10-21"
        actor = "SABRE PANDA"
        malware_family = "Cavalry RAT"
    strings:
        $js_1 = { 55 46 51 5c 18 56 45 5e 53 44 59 5f 5e 18 40 1c 51 1c 53 1c 5b 1c 55 1c }
    condition:
        all of them
}

rule CrowdStrike_CSIR_13022_02 : sabre_panda dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Dropper filename used by SABRE PANDA"
        reports = "CSIR-13022"
        version = "201310210000"
        last_modified = "2013-10-21"
        actor = "SABRE PANDA"
    strings:
        $sec = "seccenter.xxx"
    condition:
        $sec
}

rule CrowdStrike_CSIR_13022_03 : certificate sabre_panda 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Stolen code signing certificates used by SABRE PANDA. As these certificates were stolen for use in signing malicious executables, it may also identified legitimate files - alerts should be correlated with other indicators of malicious activity."
        reports = "CSIR-13022"
        version = "201910101640"
        last_modified = "2019-10-10"
        actor = "SABRE PANDA"
    strings:
        $cn_1 = "ShenZhen Thunder Networking Technologies Ltd."
        $serial_1 = { 7d a8 8e b5 3a 85 c7 29 b1 0b 3c 9c fe 8a 90 1f }
        $cn_2 = "MGAME Corp."
        $serial_2 = { 4e eb 08 05 55 f1 ab f7 09 bb a9 ca e3 2f 13 cd }
        $cn_3 = "Huachen Tax Agency Co., Ltd"
        $serial_3 = { 4a 03 ff 9b 73 22 93 0b ba 3b b8 f6 fc 31 16 2d }
    condition:
        filesize < 1MB and
        ($cn_1 and $serial_1) or
        ($cn_2 and $serial_2) or
        ($cn_3 and $serial_3)
}

rule CrowdStrike_CSIR_13022_04 : sabre_panda artifact 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "SABRE PANDA - InstallA,B,C,D exported functions"
        reports = "CSIR-13022"
        version = "201310210000"
        last_modified = "2013-10-21"
        actor = "SABRE PANDA"
    strings:
        $combined =  { 49 6e 73 74 61 6c 6c 41 00 49 6e 73 74 61 6c 6c 42 00 49 6e 73 74 61 6c 6c 43 00 }
    condition:
        all of them
}

rule CrowdStrike_CSIR_13022_05 : sabre_panda artifact 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "SABRE PANDA - byg_protect string"
        reports = "CSIR-13022"
        version = "201310210000"
        last_modified = "2013-10-21"
        actor = "SABRE PANDA"
    strings:
        $by = "byg_protect" ascii wide
    condition:
        $by
}

rule CrowdStrike_CSIR_13022_06 : sabre_panda rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Registry keys used by SABRE PANDA malware"
        reports = "CSIR-13022"
        version = "201310210000"
        last_modified = "2013-10-21"
        actor = "SABRE PANDA"
    strings:
        $nw = "SOFTWARE\\Microsoft\\Network Security Center" ascii wide
        $nsct = "SOFTWARE\\Microsoft\\nsct" ascii wide
    condition:
        any of them
}

rule CrowdStrike_CSIR_13022_07 : sabre_panda artifact 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "C++ class names used by SABRE PANDA malware"
        reports = "CSIR-13022"
        version = "201310210000"
        last_modified = "2013-10-21"
        actor = "SABRE PANDA"
    strings:
        $base = "CBaseShell"
        $tcp = "CTCPShell"
        $pm = "CPortMapShell"
        $serv = "CServerShell"
    condition:
        3 of them
}

rule CrowdStrike_CSIR_13022_08 : sabre_panda rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "CookieIE strings found in SABRE PANDA malware"
        reports = "CSIR-13022"
        version = "201310210000"
        last_modified = "2013-10-21"
        actor = "SABRE PANDA"
    strings:
        $hcom = "CreateHCOM"
        $cie = "CookieIE"
    condition:
        all of them
}

rule CrowdStrike_CSIR_13022_09 : sabre_panda artifact 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Registry value names used by SABRE PANDA malware"
        reports = "CSIR-13022"
        version = "201310210000"
        last_modified = "2013-10-21"
        actor = "SABRE PANDA"
    strings:
        $ownin = "ownin" ascii wide
        $xpchen = "xpchen" ascii wide
    condition:
        all of them
}

rule CrowdStrike_CSIR_13022_10 : sabre_panda rat9002 rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "9002 RAT strings"
        reports = "CSIR-13022"
        version = "201310210000"
        last_modified = "2013-10-21"
        actor = "SABRE PANDA"
        malware_family = "9002 RAT"
    strings:
        $conf = "%s\\config.s"
        $sb = "softbin"
    condition:
        all of them
}

rule CrowdStrike_CSIT_13075_01 : evanescent_bat implant 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Trigger on EVANESCENT BAT in-memory-only implants"
        reports = "CSIT-13075"
        version = "201310220000"
        last_modified = "2013-10-22"
        actor = "EVANESCENT BAT"
    strings:
        // Injected public ssh key's modulus n, encoded per rfc4253
        $pkey = "AAAIEAqKaqwTXENJw7IrZCX5JTYAVGPA4ZV6pVD3xWrzJhDcPqH2C47tKdWmtf8qh24UhSU3Q0BlcMatZxuibpcWTOS9PvT2yq5LZqJP9uUqiAJHCWS4QHaH/UTQ1ugBhaADImDv+pJAmiPcT3fStY1UwxxbWJy1gNfr6zeq+iYRGrRmc"
        // On-stack assembly of ssh implant exfil format string '\n@@=u=@@: %.*s\n@@=%s=@@: %.*s\n@@=a=@@: %s:%d\n\x00' -> 3519, 0x2e bytes long
        $exfil = { c7 45 ?? 0a 40 40 3d c7 45 ?? 75 3d 40 40 c7 45 ?? 3a 20 25 2e c7 45 ?? 2a 73 0a 40 c7 45 ?? 40 3d 25 73 c7 45 ?? 3d 40 40 3a c7 45 ?? 20 25 2e 2a c7 45 ?? 73 0a 40 40 c7 45 ?? 3d 61 3d 40 c7 45 ?? 40 3a 20 25 c7 45 ?? 73 3a 25 64 }
        // Configuration vars used for apache implant
        $cfg1 = "do_sc"
        $cfg2 = "nofork"
        $cfg3 = "defpt"
        $err = { 0A 65 20 25 63 2F 25 64 21 0A 00 }
        // Named export for location PLT hook configuration
        $mcf = "mcf892108549"
    condition:
        $pkey or $exfil or ($cfg1 and $cfg2 and $cfg3 and $err) or $mcf
}

rule CrowdStrike_CSIT_13053_04 : certificate 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Identifies code signing certificate used by Bisty RAT in activity described in CSIT-13053. As this certificate was stolen for use in signing malicious executables, it may also identified legitimate files - alerts should be correlated with other indicators of malicious activity."
        reports = "CSIT-13053"
        version = "201910101656"
        last_modified = "2019-10-10"
    strings:
        $cn = "Qingdao Ruanmei Network Technology Co."
        $serial = { 6e 1c 43 a4 1d 4d dc 80 5a 85 61 c6 9c ed a1 82 }
    condition:
        uint16(0) == 0x5a4d and
        $cn and $serial
}

rule CrowdStrike_CSIT_13053_05 : bisty rat dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Bisty RAT stage 1 dropper"
        reports = "CSIT-13053,CSIT-13081"
        version = "201310240000"
        last_modified = "2013-10-24"
        malware_family = "Bisty"
    strings:
        $kav1 = "SOFTWARE\\KasperskyLab\\protected\\AVP12\\environment"
        $kav2 = "SOFTWARE\\KasperskyLab\\protected\\AVP9\\settings"
        $winlogon = "%SystemRoot%\\System32\\winlogon.exe"
    condition:
        all of them
}

rule CrowdStrike_CSIT_13098_01 : cutting_kitten webshell 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Rule to match on elements of the CUTTING KITTEN webshell"
        reports = "CSIT-13098"
        version = "201310240000"
        last_modified = "2013-10-24"
        actor = "CUTTING KITTEN"
    strings:
        $string1 = "itsecteam.com" // URL of ITSecTeam included in footer
        $string2 = "Q29kZWQgYnkgQW1pbiBTaG9rb2hpIChQZWp2YWsp" // Authors name (Base64-encoded)
        $string3 = "do=filemanager" // URI path to the File Manager Tab
    condition:
        all of them
}

rule CrowdStrike_CSIT_13104_01 : shark_spider shylock trojan installer 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "PDB string in Shylock installer"
        reports = "CSIT-13104"
        version = "201311120000"
        last_modified = "2013-11-12"
        actor = "SHARK SPIDER"
        malware_family = "Shylock"
    strings:
        $pdb = "c:\\Temp\\ljjjklllllllllllllllllll324234444444444444444444444444fwedssssssslllllllllllljiooooooooooooooooooooooooooooohjknnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnn78ghuiuiuiuiuiuiuiuiuiuiuiuiuiuiuiuiuiuijjjjx.pdb"
    condition:
        any of them
}

rule CrowdStrike_CSIT_13104_02 : shark_spider shylock trojan installer 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Resource strings in Shylock installer"
        reports = "CSIT-13104"
        version = "201311120000"
        last_modified = "2013-11-12"
        actor = "SHARK SPIDER"
        malware_family = "Shylock"
    strings:
        // Resource 24:2:0 sometimes contains this leet speak description
        $rsrc24_2_0 = "<description>D3scription</description>"
        // Resource 23:176:1049 sometimes contains this value
        $rsrc = "<STRONG>THIS PAGE IS BIG FIND</STRONG>"
    condition:
        any of them
}

rule CrowdStrike_CSIT_13104_03 : shark_spider shylock trojan unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Shylock Banking Trojan, unpacked payload"
        reports = "CSIT-13104"
        version = "201311120000"
        last_modified = "2013-11-12"
        actor = "SHARK SPIDER"
        malware_family = "Shylock"
    strings:
        // Log message
        $pipesrv = "OnThread_PipeServer"
        // mutex
        $mutex = "6B4E2F40B138C4921F1584CA0EFC19EA6B4E2F6B4E2F40"
    condition:
        any of them
}

rule CrowdStrike_CSIR_13024_01 : wicked_spider rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Signature for WICKED SPIDER malware"
        reports = "CSIR-13024"
        version = "201311140000"
        last_modified = "2013-11-14"
        actor = "WICKED SPIDER"
    strings:
        // References to original DLL
        $DLLRef1 = "apphelp"
        $DLLRef2 = "winmm"
        // Control String header
        $CtrlString1 = "PLUSUN"
        $CtrlString2 = "UUSUN"
    condition:
        ($DLLRef1 or $DLLRef2) and ($CtrlString1 or $CtrlString2)
}

rule CrowdStrike_CSIT_13102_02 : adwind artifact 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "JAR classes related to Adwind/Frutas RAT"
        reports = "CSIT-13102"
        version = "201311180000"
        last_modified = "2013-11-18"
        malware_family = "Adwind"
    strings:
        $info_adwind = "Informacion.adwind"
        $Instalador_adwind = "Instalador.adwind"
        $opcion1_adwind = "Opcion1.adwind"
    condition:
        all of them
}

rule CrowdStrike_CSIT_14034_01 : dropper gameover_zeus unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "GameOver Zeus rule to run against active processes in memory"
        reports = "CSIT-14034"
        version = "201905061047"
        last_modified = "2019-05-06"
        malware_family = "Gameover Zeus"
    strings:
        $rsakey1 = { 15 bd 1d 11 13 9b 1d 11 41 ec 5c 20 13 b7 1d 11 12 bf 1c 11 38 17 ec 6d 6e 77 8d 52 88 40 77 b8 2d 2c 1e 1a 6d b8 f8 a2 23 12 73 98 dc 45 be 26 de a6 de a0 39 4f 45 da fd a6 54 11 9a c9 37 1b 67 81 d5 fb 8a a5 01 dd 2a 6e 80 e1 ec 74 bf 0f 47 38 d9 be 44 7c 65 91 c9 50 72 12 1e 9c 36 40 77 40 31 a2 53 6f 28 48 e7 a0 7c d7 37 e1 9f fe eb 7e 2a 05 f8 16 de f1 40 52 22 e1 79 ff c1 78 14 e3 fa 3f 21 c7 07 56 43 4e 90 49 a4 66 4a fa 3d 09 58 43 35 10 20 00 10 ea 6e a2 df bb a0 85 31 0b 9f 70 eb 0b 3e 40 04 87 33 8c 74 c5 3b f6 ef b2 c8 fa 53 b9 79 d3 ec c7 40 c5 08 ff a5 f5 40 1c 34 34 45 f7 75 03 3e c2 87 41 3d 27 52 04 3e cf f4 e2 10 e2 ae 49 f4 9a 34 bd d5 1c f2 e2 76 33 2c ab 28 e2 8e 68 00 21 92 7f e2 e3 cc 74 53 ce f9 5e f4 4d e3 6f 0e 9b fa d5 90 24 53 a2 ba db 93 8f 92 eb 2a 4d d8 6d 1e e1 cc d8 ef f8 6a 35 4c bc }
        $rsakey2 = { 13 8e b5 77 15 a8 b5 77 47 df f4 46 15 84 b5 77 14 8c b4 77 3e 24 44 0b 68 44 25 34 8e 73 df de 2b 1f b6 7c 6b 8b 50 c4 25 21 db fe da 76 16 40 d8 95 76 c6 3f 7c ed bc fb 95 fc 77 9c fa 9f 7d 61 b2 7d 9d 8c 96 a9 bb 2c 5d 28 87 ea 47 17 69 41 0b 71 d8 42 4f cd f7 cf 63 da 74 18 af 9e 26 71 73 99 c4 55 5c 80 2e e1 93 d4 b1 31 d2 37 98 ed 4d 82 63 fe 25 76 97 46 61 8a 87 7f cc 69 1e 12 d0 52 59 27 f4 af 30 45 7d 38 2f a2 55 e2 9c 3b 3a f0 25 33 23 88 66 16 d9 c6 c4 d9 88 08 e3 37 38 37 16 ed 38 96 26 02 b4 9b ea 72 f6 93 90 e9 81 60 9c 55 8a d1 b5 ea f4 e8 a3 0e cc 0d 93 46 2f 9c 52 43 c4 dd 65 38 f1 2f 27 3b 14 fa 62 38 fc 5c 84 16 d1 06 2f f2 a9 9c db d3 2f 5a 84 70 00 84 cd 2e d1 26 0e 06 12 3a 19 e4 d0 64 12 55 fd 51 38 f2 7e 4b 09 08 a8 52 b3 96 17 fb c4 bc e8 3b e9 94 d8 82 2b de 5e b6 87 ca eb 47 9e 6c 06 e4 da }
        $rsakey3 = { 1d 85 9b 59 1b a3 9b 59 49 d4 da 68 1b 8f 9b 59 1a 87 9a 59 30 2f 6a 25 66 4f 0b 1a 80 78 f1 f0 25 14 98 52 65 80 7e ea 2b 2a f5 d0 d4 7d 38 6e d6 9e 58 e8 31 77 c3 92 f5 9e d2 59 92 f1 b1 53 6f b9 53 b3 82 9d 87 95 22 56 06 a9 e4 4c 39 47 4f 00 5f f6 4c 44 e3 d9 c1 68 f4 5a 16 a4 b0 08 7f 78 b7 ea 5b 57 ae 00 ef 98 fa 9f 3f d9 19 b6 e3 46 ac 4d f0 2e 58 b9 48 6a a4 a9 71 c7 47 30 1c db 7c 77 29 ff 81 1e 4b 76 16 01 ac 5e cc b2 35 31 de 0b 3d 28 a6 48 18 d2 e8 ea d7 83 26 cd 39 33 19 38 e3 33 b8 08 0c bf b5 c4 7c fd bd be e7 8a 4e b2 5b 81 ff 9b e4 ff c6 8d 00 c7 23 bd 48 24 b2 7c 4d cf f3 4b 36 fa 01 09 35 1f d4 4c 36 f7 72 aa 18 da 28 01 fc a2 b2 f5 dd 24 74 aa 7e 0b aa e3 20 da 08 20 08 19 14 37 ea db 4a 3c 5b f6 7f 16 fc 75 65 27 06 a3 7c 9d 98 1c d5 ea b2 e3 15 c7 9a d3 ac 05 d0 55 98 a9 c4 e0 69 b0 62 0d ca f4 }
        $rsakey4 = { 1a 65 1e 3d 1c 43 1e 3d 4e 34 5f 0c 1c 6f 1e 3d 1d 67 1f 3d 37 cf ef 41 61 af 8e 7e 87 98 74 94 22 f4 1d 36 62 60 fb 8e 2c ca 70 b4 d3 9d bd 0a d1 7e dd 8c 36 97 46 f6 f2 7e 57 3d 95 11 34 37 68 59 d6 d7 85 7d 02 f1 25 b6 83 cd e3 ac bc 23 48 e0 da 92 4b a4 66 bd c6 88 71 3e 11 44 35 6c 78 98 32 8e 5c b7 2b 64 e8 78 7f fb 38 39 9c d2 e4 a6 29 29 f7 ce dd dd 4f 8a 21 cd 76 27 c2 54 1b 3b f9 13 2e 1f 04 7a 4c 96 93 65 ab be 49 d6 32 d1 5b 6f 3a c8 23 2c 1f 32 6d 8e d0 63 a3 a9 3e d3 9c 5c e4 d3 3d 6c 0b 5f 30 a0 7b 1d 38 da e0 6a cb d6 5c 61 7a ff e3 1f 43 e9 07 27 a6 d9 4f c4 37 18 4a 2f 76 2f 31 1a 84 6d 32 ff 51 28 31 17 f7 ce 1f 3a ad 65 fb 42 37 91 da c4 f1 ce 79 eb 2f 87 27 3a 8d 44 0f f9 91 53 ed 3b cf 58 5c 16 fa 72 fb 95 e0 43 01 43 f9 f9 9f fc 50 8e b5 03 90 a3 9d 33 29 61 d7 b5 1d cd c3 00 ec d4 65 ed 4f 90 }
        $rsakey5 = { 19 b1 2c 4d 1f 97 2c 4d 4d e0 6d 7c 1f bb 2c 4d 1e b3 2d 4d 34 1b dd 31 62 7b bc 0e 84 4c 46 e4 21 20 2f 46 61 b4 c9 fe 2f 1e 42 c4 d0 49 8f 7a d2 aa ef fc 35 43 74 86 f1 aa 65 4d 96 c5 06 47 6b 8d e4 a7 86 a9 30 81 26 62 b1 bd e0 78 8e 53 4b 34 e8 e2 48 70 54 cd c5 5c 43 4e 12 90 07 1c 7b 4c 00 fe 5f 63 19 14 eb ac 4d 8b 3b ed ae a2 e7 72 1b 59 f4 1a ef ad 4c 5e 13 bd 75 f3 f0 24 18 ef cb 63 2d cb 36 0a 4f 42 a1 15 a8 6a 7b a6 31 05 69 1f 39 1c 11 5c 1c e6 5f fe d3 b7 91 d9 3d 07 ae 2c e7 07 0f 1c 08 8b 02 d0 78 c9 0a aa e3 be f9 a6 5f b5 48 8f e0 cb 71 99 04 f3 94 a9 4c 10 05 68 49 fb 44 5f 32 ce b6 1d 31 2b 63 58 32 c3 c5 be 1c ee 9f 15 f8 96 05 e1 d9 10 c3 be 7a 3f 1d f7 24 ee bf 34 0c 2d a3 23 ee ef fd 28 5f c2 c8 02 f8 41 d2 33 02 97 cb 89 9c 28 62 fe b6 d7 a2 d3 9e e7 1b 11 d4 61 2f bd c0 d4 de a4 66 39 7d e0 }
        $rsakey6 = { 28 0d c2 39 2e 2b c2 39 7c 5c 83 08 2e 07 c2 39 2f 0f c3 39 05 a7 33 45 53 c7 52 7a b5 f0 a8 90 10 9c c1 32 50 08 27 8a 1e a2 ac b0 e1 f5 61 0e e3 16 01 88 04 ff 9a f2 c0 16 8b 39 a7 79 e8 33 5a 31 0a d3 b7 15 de f5 17 de 5f c9 d1 c4 60 27 7a 88 06 96 79 cc ba b9 f4 e0 ad 3a 23 2c e9 68 4a f0 ee 8a 6e df f7 60 da 10 a3 ff 0a 51 40 d6 d6 ce f5 2d c5 a6 01 d9 7d e2 fd c9 44 4f 1e 50 29 53 25 17 1c 77 d8 7e 7e fe 4f 61 99 d6 95 d2 00 b9 87 6b 08 a0 ff 28 2d 5a b1 8a e2 0b 7f ad 0c bb 40 58 d6 bb e1 68 39 37 ec a4 49 75 e4 de d2 02 17 d2 6e 09 a6 fb d1 77 9f ed 35 4f 7a dd 7d ac eb 1c 78 47 aa 2b 03 72 58 69 00 97 8d 2c 03 7f 2b ca 2d 52 71 61 c9 2a eb 95 e8 ac 2d ca 4b 83 f3 83 15 52 51 40 3d 91 4d 57 df 53 13 5c 6e 7e 26 76 c9 fd 3c 47 33 2b 25 fd ad 94 8c 8a 87 6b 4c a7 af 5b f5 65 e5 dd c1 c9 f1 68 30 d0 57 85 93 94 }
        $rsakey7 = { 5a 30 36 7d 5c 16 36 7d 0e 61 77 4c 5c 3a 36 7d 5d 32 37 7d 77 9a c7 01 21 fa a6 3e c7 cd 5c d4 62 a1 35 76 22 35 d3 ce 6c 9f 58 f4 93 c8 95 4a 91 2b f5 cc 76 c2 6e b6 b2 2b 7f 7d d5 44 1c 77 28 0c fe 97 c5 28 2a b1 65 e3 ab 8d a3 f9 94 63 08 b5 f2 d2 0b f1 4e fd 86 dd 59 7e 51 11 1d 2c 38 cd 1a ce 1c e2 03 24 a8 2d 57 bb 78 6c b4 92 a4 f3 01 69 b7 9b f5 9d 0f df 09 8d 36 72 ea 14 5b 6e d1 53 6e 4a 2c 3a 0c c3 bb 25 eb eb 61 96 72 84 73 2f 7a 9d 0b 6c 5f 67 45 ce 90 36 8b e9 7e 86 b4 1c a4 86 15 2c 4b 0a 18 e0 3b 48 10 9a a0 3f e3 96 1c 34 52 bf a3 4a 6b a9 47 72 8e 99 0f 91 1f 58 0a 7a 5e 6f 71 4f ac 2d 72 aa 79 68 71 42 df 8e 5f 6f 85 25 bb 17 1f d1 9a 91 d9 8e 39 be 07 c7 67 6f a5 04 4f ac b9 13 ad 6e e7 18 1c 43 d2 32 bb c0 c8 03 41 16 d1 b9 df a9 78 ce f5 56 b8 e3 dd 66 01 21 97 e0 35 8d 83 55 c4 94 25 b8 67 d0 }
        $rsakey8 = { 95 6e 07 6b 93 48 07 6b c1 3f 46 5a 93 64 07 6b 92 6c 06 6b b8 c4 f6 17 ee a4 97 28 08 93 6d c2 ad ff 04 60 ed 6b e2 d8 a3 c1 69 e2 5c 96 a4 5c 5e 75 c4 da b9 9c 5f a0 7d 75 4e 6b 1a 1a 2d 61 e7 52 cf 81 0a 76 1b a7 aa bd 9a 9b 6c a7 a5 75 c7 eb c3 c4 c4 af 7f eb 49 83 68 68 9e 4f 2c 3a f7 93 2b d8 d3 bc 32 32 67 73 66 ad b7 32 85 84 6b ad 30 7f 78 c5 c4 8b c0 81 38 9b f9 2c db 02 94 30 e0 45 a1 14 1d 2c c3 9d 8a 33 24 b5 50 80 bd da 42 39 b5 c3 3a 7a 90 39 74 d8 5f 68 ba ff b1 d8 85 0a 6b d8 24 3a 84 54 29 f6 f4 16 21 8c 6f 61 d2 80 d3 6a 63 a9 6c 14 5a bf 88 2c bf 8f c0 cf 2e 4e c5 24 6f 79 be 11 9d 3b bd f4 48 7e be 1c ee 98 90 31 b4 33 74 49 2e c7 55 cf e8 98 f6 e0 36 d1 a8 31 94 12 80 f2 88 05 62 30 d6 0e d3 1d e3 24 74 9e f9 15 8e 48 e0 af 10 f7 49 d8 3a 08 89 f5 12 38 30 37 58 be 04 9b 4c 0b f5 82 ea e6 56 c6 }
        $rsakey9 = { 9a e6 7d 48 9c c0 7d 48 ce b7 3c 79 9c ec 7d 48 9d e4 7c 48 b7 4c 8c 34 e1 2c ed 0b 07 1b 17 e1 a2 77 7e 43 e2 e3 98 fb ac 49 13 c1 53 1e de 7f 51 fd be f9 b6 14 25 83 72 fd 34 48 15 92 57 42 e8 da b5 a2 05 fe 61 84 a5 35 e0 b8 63 2f df 56 c8 63 b9 e7 cb 27 05 c8 46 0b 12 4b 91 c7 56 19 f8 1b 51 fb dc 34 48 11 68 fb 1c 8e b8 ba ff a7 64 25 4a 5c 77 4d be a8 cf 09 42 b8 f6 a4 a1 21 9b b8 9a 66 ae 9c 67 0f cc 15 f0 10 2b 3d 2a a3 b2 52 38 1a ba 4b 40 59 9f b1 0e fb 50 e0 c0 dc be 50 ff 29 64 50 5e 19 8b dc 53 d5 fb 9e 5b af 60 e9 a8 a3 dc e2 19 8a 63 9c 20 9c 87 a4 c5 ac cf 47 54 6d ca ac 15 5a b1 99 e7 18 b2 7c 32 5d b1 94 94 bb 9f b9 ce 10 7b c1 54 e4 5a 47 92 bb f9 68 4c f2 a7 b9 ee 31 8f 7a f2 26 6d b8 ac 2d dc 95 99 07 7b 16 83 36 81 c0 9a 8c 1f 7f 33 fb 35 80 f3 d6 1d b0 4a 14 57 36 7e b8 43 83 8f a1 e5 6e 2c e5 }
        $rsakey10 = { cf 6e e9 77 c9 48 e9 77 9b 3f a8 46 c9 64 e9 77 c8 6c e8 77 e2 c4 18 0b b4 a4 79 34 52 93 83 de f7 ff ea 7c b7 6b 0c c4 f9 c1 87 fe 06 96 4a 40 04 75 2a c6 e3 9c b1 bc 27 75 a0 77 40 1a c3 7d bd 52 21 9d 50 76 f5 bb f0 bd 74 87 36 a7 4b 69 9d eb 2d d8 9e af 91 f7 13 83 86 74 c4 4f c2 26 ad 93 c5 c4 89 bc dc 2e 3d 73 88 b1 ed 32 6b 98 31 ad de 63 22 c5 2a 97 9a 81 d6 87 a3 2c 35 1e ce 30 0e 59 fb 14 f3 30 99 9d 64 2f 7e b5 be 9c e7 da ac 25 ef c3 d4 66 ca 39 9a c4 05 68 54 e3 eb d8 6b 16 31 d8 ca 26 de 54 c7 ea ae 16 cf 90 35 61 3c 9c 89 6a 8d b5 36 14 b4 a3 d2 2c 51 93 9a cf c0 52 9f 24 81 65 e4 11 73 27 e7 f4 a6 62 e4 1c 00 84 ca 31 5a 2f 2e 49 c0 db 0f cf 06 84 ac e0 d8 cd f2 31 7a 0e da f2 66 19 38 30 38 12 89 1d 0d 38 2e 9e 17 09 d4 48 0e b3 4a f7 a7 c4 60 08 67 e9 48 38 de 2b 02 be ea 87 16 0b 1b 9e b0 e6 b8 da }
        $rsakey11 = { e3 86 94 62 e5 a0 94 62 b7 d7 d5 53 e5 8c 94 62 e4 84 95 62 ce 2c 65 1e 98 4c 04 21 7e 7b fe cb db 17 97 69 9b 83 71 d1 d5 29 fa eb 2a 7e 37 55 28 9d 57 d3 cf 74 cc a9 0b 9d dd 62 6c f2 be 68 91 ba 5c 88 7c 9e 88 ae dc 55 09 92 1a 4f 36 7c b1 03 50 cd b2 47 ec e2 3f 6b fb 61 e8 a7 bf 33 81 7b b8 d1 a5 54 a1 3b 11 9b f5 a4 c1 da 16 8d 1d 45 a3 76 0e 2d 57 82 b6 69 ab 92 8f c4 48 0b e2 d8 73 4c d7 fc 8e 25 b5 75 19 3a 52 5d c3 89 cb 32 d1 30 c3 2b a9 73 e6 d1 e7 d1 29 80 29 f6 c7 30 16 03 1d 30 b7 33 f2 bc ba ff 82 fe b2 85 19 89 41 89 a5 82 f0 a0 1a fc c9 b6 fe c4 2c 86 b6 27 bd 47 b3 cc fc 70 c8 f9 0e 32 cb 1c db 77 c8 f4 7d 91 e6 d9 27 3a 02 a1 bd ce 23 27 7b 91 80 08 a5 d8 de d9 07 1b f6 1a 1b 0c 14 d8 45 07 a5 f5 70 2d 02 76 6a 1c f8 a0 73 a6 66 1f da d1 4c e0 1a fc 64 d0 a3 3e 2e 56 97 92 3a e3 66 8b 9c 0e c5 cf }
        $rsakey12 = { ec a2 90 70 ea 84 90 70 b8 f3 d1 41 ea a8 90 70 eb a0 91 70 c1 08 61 0c 97 68 00 33 71 5f fa d9 d4 33 93 7b 94 a7 75 c3 da 0d fe f9 25 5a 33 47 27 b9 53 c1 c0 50 c8 bb 04 b9 d9 70 63 d6 ba 7a 9e 9e 58 9a 73 ba 8c bc d3 71 0d 80 15 6b 32 6e be 27 54 df bd 63 e8 f0 30 4f ff 73 e7 83 bb 21 8e 5f bc c3 aa 70 a5 29 1e bf f1 b6 ce fe 12 9f 12 61 a7 64 01 09 53 90 b9 4d af 80 80 e0 4c 19 ed fc 77 5e d8 d8 8a 37 ba 51 1d 28 5d 79 c7 9b c4 16 d5 22 cc 0f ad 61 e9 f5 e3 c3 26 a4 2d e4 c8 14 12 11 12 14 b3 21 fd 98 be ed 8d da b6 97 16 ad 45 9b aa a6 f4 b2 15 d8 cd a4 f1 e0 28 94 b9 03 b9 55 bc e8 f8 62 c7 dd 0a 20 c4 38 df 65 c7 d0 79 83 e9 fd 23 28 0d 85 b9 dc 2c 03 7f 83 8f 2c a1 ca d1 fd 03 09 f9 3e 1f 1e 1b fc 41 15 aa d1 74 3f 0d 52 6e 0e f7 84 77 b4 69 3b de c3 43 c4 1e ee 6b f4 a7 2c 21 72 93 80 35 c7 62 99 93 2a c1 dd }
        $rsakey13 = { ff fb be 68 f9 dd be 68 ab aa ff 59 f9 f1 be 68 f8 f9 bf 68 d2 51 4f 14 84 31 2e 2b 62 06 d4 c1 c7 6a bd 63 87 fe 5b db c9 54 d0 e1 36 03 1d 5f 34 e0 7d d9 d3 09 e6 a3 17 e0 f7 68 70 8f 94 62 8d c7 76 82 60 e3 a2 a4 c0 28 23 98 06 32 1c 76 ad 7e 7a c7 ae 3a c6 e8 23 16 d1 6b f4 da 95 39 9d 06 92 db b9 29 8b 31 0d e6 df ae dd a7 3c 87 01 38 89 7c 12 50 7d 88 aa 14 81 98 93 b9 62 01 fe a5 59 46 cb 81 a4 2f a9 08 33 30 4e 20 e9 83 d7 4f fb 3a df 56 83 79 fa ac cd db 35 fd 03 fc db 4d 3c 09 01 4d 9d 39 ee c1 90 f5 9e 83 98 8f 05 f4 6b 83 b9 ff da aa 06 81 e3 bc e2 b9 06 8c aa 5a 97 4d af b1 d6 7a d4 84 24 38 d7 61 f1 7d d4 89 57 9b fa a4 0d 30 1e dc 97 c4 3f 5a 51 9b 9c 75 8f d2 c2 a4 2d 11 ea 67 31 06 08 a5 6f 0d b9 88 5a 27 1e 0b 40 16 e4 dd 59 ac 7a 62 f0 db 50 9d 30 f6 78 ad 89 34 32 2b bd 98 26 9e 4c 81 80 73 ef c5 }
        $rsakey14 = { 21 ca 84 56 27 ec 84 56 75 9b c5 67 27 c0 84 56 26 c8 85 56 0c 60 75 2a 5a 00 14 15 bc 37 ee ff 19 5b 87 5d 59 cf 61 e5 17 65 ea df e8 32 27 61 ea d1 47 e7 0d 38 dc 9d c9 d1 cd 56 ae be ae 5c 53 f6 4c bc be d2 98 9a 1e 19 19 a6 d8 03 26 48 73 4f 40 f9 70 0b fc d6 fd 27 eb 55 2a eb af 07 43 37 a8 e5 67 18 b1 0f d3 d7 e5 90 03 96 06 b9 df 09 b3 42 cc 61 47 b6 74 25 bb a6 4d 88 58 3f 20 94 63 78 15 b0 9e 11 77 39 09 0e 90 11 d3 bd 09 7e c1 04 01 67 b9 47 24 9d f7 e5 eb cc 39 c2 05 7c 06 37 df 7c a7 07 30 f0 aa cb 40 b2 a2 b1 db c5 51 bd 67 ce e0 94 d8 b0 d9 82 3c 88 3c b2 74 6b ad 73 71 80 ec 44 0a b5 1e 06 09 50 cb 43 0a b8 6d a5 24 95 37 0e c0 ed ad fa e1 6b 6b a5 42 44 b5 ec 1c 95 17 2f 34 56 0b 38 d6 94 55 33 67 b9 60 19 c0 3a 7a 28 3a ec 63 92 a4 53 ca e5 8e ac 0a c8 a6 9c b3 0a ec 1a 87 a6 f8 af 76 bf 5e 42 d5 fb }
        $rsakey15 = { dc f6 7b 06 da d0 7b 06 88 a7 3a 37 da fc 7b 06 db f4 7a 06 f1 5c 8a 7a a7 3c eb 45 41 0b 11 af e4 67 78 0d a4 f3 9e b5 ea 59 15 8f 15 0e d8 31 17 ed b8 b7 f0 04 23 cd 34 ed 32 06 53 82 51 0c ae ca b3 ec 43 ee 67 ca e3 25 e6 f6 25 3f d9 18 8e 73 bf a9 8d 37 03 86 00 1b 14 05 d7 d7 50 57 be 0b 57 b5 9a 24 4e 5f 2e eb 1a c0 fe aa f9 e9 22 35 4c 12 31 5d b8 e6 89 19 44 f6 b0 b4 a7 6f dd a8 9c 28 e8 8c 61 41 8a 05 f6 5e 6d 2d 2c ed f4 42 3e 54 fc 5b 46 17 d9 a1 08 b5 16 f0 c6 92 f8 40 f9 67 22 40 58 57 cd cc 55 9b bd 8e 5d e1 26 f9 ae ed 9a f2 1f c4 25 8c 26 d2 c1 b4 c3 e2 89 57 52 23 8c bc 13 14 f7 89 e1 56 f4 6c 34 13 f7 84 92 f5 d9 a9 c8 5e 3d d1 52 aa 1c 57 94 f5 bf 78 4a bc e1 a9 e8 7f c9 6a f4 68 2b a8 aa 63 9a 85 9f 49 3d 06 85 78 c7 d0 9c c2 59 6f 35 b5 73 90 f5 98 5b a0 4c 5a 11 26 78 f6 05 93 89 ef a3 7e 2a ab }
    condition:
        any of them or
        for any i in (0..filesize) :
        (
        uint32(i) ^ uint32(i+4) == 0x00002606
        and uint32(i) ^ uint32(i+8) == 0x31415154
        and uint32(i) ^ uint32(i+12) == 0x00000a06
        and uint32(i) ^ uint32(i+16) == 0x00010207
        and uint32(i) ^ uint32(i+20) == 0x7cf1aa2d
        and uint32(i) ^ uint32(i+24) == 0x4390ca7b
        and uint32(i) ^ uint32(i+28) == 0xa96afd9d
        and uint32(i) ^ uint32(i+32) == 0x0b039138
        and uint32(i) ^ uint32(i+36) == 0xb3e50578
        and uint32(i) ^ uint32(i+40) == 0x896eaf36
        and uint32(i) ^ uint32(i+44) == 0x37a3f8c9
        and uint32(i) ^ uint32(i+48) == 0xb1c31bcb
        and uint32(i) ^ uint32(i+52) == 0xcb58f22c
        and uint32(i) ^ uint32(i+56) == 0x00491be8
        and uint32(i) ^ uint32(i+60) == 0x0a2a748f
        )
}

rule CrowdStrike_CSIT_13114_01 : anchor_panda rat tornrat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "ANCHOR PANDA TornRAT"
        reports = "CSIT-13114"
        version = "202005141324"
        last_modified = "2020-05-14"
        actor = "ANCHOR PANDA"
        malware_family = "TornRAT"
    strings:
        $timefmtstr = "%4d/%02d/%02d %02d:%02d:%02d" wide
        $tmpsubfolder = "\\WinRAR\\~temp.dat" wide
        $keylogfmtstr = { 0d 00 0a 00 5b 00 97 7a e3 53 5d 00 25 00 73 00 20 00 28 00 25 00 34 00 64 00 2d 00 25 00 30 00 32 00 64 00 2d 00 25 00 30 00 32 00 64 00 20 00 25 00 30 00 32 00 64 00 3a 00 25 00 30 00 32 00 64 00 3a 00 25 00 30 00 32 00 64 00 29 00 0d 00 0a 00 00 00 }
    condition:
        all of them
}

rule CrowdStrike_CSIT_13114_02 : anchor_panda dropper tornrat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "ANCHOR PANDA TornRAT dropper"
        reports = "CSIT-13114"
        version = "202005141324"
        last_modified = "2020-05-14"
        actor = "ANCHOR PANDA"
        malware_family = "TornRAT"
    strings:
        // Encrypted resource: type "BIN", name "DB", starts with "M"
        $bin_db_rsrc = { 03 00 42 00 49 00 4e 00 02 00 44 00 42 00 00 00 4d }
        // Same, but with an additional HLP resource for a decoy file
        $bin_db_hlp_rsrc = { 03 00 42 00 49 00 4e 00 02 00 44 00 42 00 03 00 48 00 4c 00 50 00 00 00 4d }
    condition:
        any of them
}

rule CrowdStrike_CSIT_13112_01 : fallaga_rat rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "FallaGa RAT"
        reports = "CSIT-13112"
        version = "201807300900"
        last_modified = "2018-07-30"
        malware_family = "FallaGa"
    strings:
        // Strings contained in RAT
        $string1 = "Stub.pdb"
        $string2 = "CIE7Passwords"
        $string3 = "njLogger"
        $string4 = "taskmgrkiller"
        // Match only samples with control strings
        $string5 = "abccba"
    condition:
        // PE Binary
        uint16(0) == 0x5A4D and uint32(uint32(0x3c)) == 0x4550 and
        ((uint16(uint32(0x3c)+24) == 0x010b and uint32(uint32(0x3c)+232) > 0) or
        (uint16(uint32(0x3c)+24) == 0x020b and uint32(uint32(0x3c)+248) > 0)) and
        all of them
}

rule CrowdStrike_CSIT_13109_01 : predator_panda rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "PREDATOR PANDA RAT"
        reports = "CSIT-13109"
        version = "201807300858"
        last_modified = "2018-07-30"
        actor = "PREDATOR PANDA"
    strings:
        // Format string used to build the beacon request URI
        $urlbeacon = "%s?i=%s" wide
        // Format string for the encrypted bot info in the beacon
        $botinfopattern = "%s-SN%d-%s" ascii
        // Format strings used in processing file upload/download
        $urlpattern1 = "%s?i=%s&m=%s&f=%d&d=%S" wide
        $urlpattern2 = "%s?i=%s&m=u&f=0&d=%d" wide
        // Debug messages in the RAT
        $dbgmsg1 = "proxy info is %S %S %S %S"
        $dbgmsg2 = "domian: %S, port: %S, test domain: %S"
        $dbgmsg3 = "proxy num: %d, proxy ip: %S, proxy port: %S, proxy user: %S, proxy pass: %S"
        $dbgmsg4 = "encode domain: %s"
        // TEA key used in several RAT samples
        $teakey = { aa 23 45 e1 5e ef 32 cd de 3d f2 ff c2 d1 9e ec }
    condition:
        $teakey or (($urlbeacon or $botinfopattern or $urlpattern1 or $urlpattern2) and any of ($dbgmsg*))
}

rule CrowdStrike_CSIT_13109_02 : predator_panda dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "PREDATOR PANDA dropper"
        reports = "CSIT-13109"
        version = "201807300859"
        last_modified = "2018-07-30"
        actor = "PREDATOR PANDA"
    strings:
        // Mutex names
        $mutex1 = "Global\\m324233333p0"      ascii
        $mutex2 = "Global\\mqe45tex13fw14op0" ascii
        $mutex3 = "Global\\654223411804d"     ascii
        // Subdirectory of %TEMP% which is created and where the egg DLL is stored
        $tmpdir = "WINSUPDATE.TMP"
        $dllname = "winsups.dll"
        // How the DLL is launched
        $runcmd1 = "rundll32.exe \"%s\",UpdatePlatform"
        $runcmd2 = "rundll32.exe \"%s\",Display"
    condition:
        any of ($mutex*) or (($tmpdir or $dllname) and any of ($runcmd*))
}

rule CrowdStrike_CSIT_13106_01 : cybergate_excel 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "CyberGate Excel"
        reports = "CSIT-13106"
        version = "201312050000"
        last_modified = "2013-12-05"
        malware_family = "CyberGate Excel"
    strings:
        // Resource names
        $rsrcname1 = "CYBERGATE" wide
        $rsrcname2 = "FULLSERVER" wide
        $rsrcname3 = "CYBERGATEBINDER" wide
        // RC4 keys
        $rc4key1 = "SETTINGSPASS" wide
        $rc4key2 = "CYBERGATEPASS" wide
    condition:
        all of them
}

rule CrowdStrike_CSIT_13116_01 : gothic_panda pirpi dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Pirpi RAT dropper"
        reports = "CSIT-13116"
        version = "201312060000"
        last_modified = "2013-12-06"
        actor = "GOTHIC PANDA"
        malware_family = "Pirpi"
    strings:
        $resource_xor_key = { f9 e1 90 21 }
        $aaa_gif = "aaa.gif"
        $ias_auth = "rundll32 \"%s\" IasAuth"
    condition:
        all of them
}

rule CrowdStrike_CSIT_13116_02 : gothic_panda pirpi loader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Pirpi RAT loader"
        reports = "CSIT-13116"
        version = "201312060000"
        last_modified = "2013-12-06"
        actor = "GOTHIC PANDA"
        malware_family = "Pirpi"
    strings:
        $ieuishow = "IeUishow"
        $msdmoe = "msdmoe.dll"
        $sophos_av = "SavService.exe"
    condition:
        all of them
}

rule CrowdStrike_CSIT_13116_03 : gothic_panda pirpi rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Pirpi RAT"
        reports = "CSIT-13116"
        version = "201312060000"
        last_modified = "2013-12-06"
        actor = "GOTHIC PANDA"
        malware_family = "Pirpi"
    strings:
        $export_ieuishow = "IeUishow"
        $export_iasauh = "IasAuth"
        $crypt_key = "abcdefhiklmnorstuvwxz1234567890q"
    condition:
        all of them
}

rule CrowdStrike_CSIT_13116_04 : gothic_panda pirpi rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Pirpi RAT backdoor"
        reports = "CSIT-13116"
        version = "201312060000"
        last_modified = "2013-12-06"
        actor = "GOTHIC PANDA"
        malware_family = "Pirpi"
    strings:
        $crypt_loop = { 8a 4c 0d ec 30 0c 10 33 c9 66 8b 0b 40 3b c1 7c e0 }
        $ctfmon = "ctfmon.exe"
        $ieuishow = "IeUishow"
    condition:
        all of them
}

rule CrowdStrike_CSIT_13115_01 : putter_panda threepara_rat rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects strings in the PUTTER PANDA 3PARA RAT"
        version = "201807300824"
        last_modified = "2018-07-30"
        actor = "PUTTER PANDA"
        malware_family = "3PARA RAT"
    strings:
        $parafmt = "%s%dpara1=%dpara2=%dpara3=%d"
        $class_attribe = "CCommandAttribe"
        $class_cd = "CCommandCD"
        $class_cmd = "CCommandCMD"
        $class_nop = "CCommandNop"
    condition:
        $parafmt or all of ($class_*)
}

rule CrowdStrike_CSIR_13025_02 : energetic_bear havex rat certificate 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "HAVEX RAT - Fake Foxconn certificate"
        reports = "CSIR-13025"
        version = "201312200000"
        last_modified = "2013-12-20"
        actor = "ENERGETIC BEAR"
        malware_family = "HAVEX"
    strings:
        $fxc = "foxcon@foxcon.com" ascii wide
    condition:
        all of them
}

rule CrowdStrike_CSIR_13025_03 : energetic_bear havex rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "HAVEX RAT - Common strings found in implant"
        reports = "CSIR-13025"
        version = "201312200000"
        last_modified = "2013-12-20"
        actor = "ENERGETIC BEAR"
        malware_family = "HAVEX"
    strings:
        $_pipe0 = "\\\\.\\pipe\\mypipe-" wide
        $_pipe1 = "\\\\.\\pipe\\mypype-" wide
        $_str0 = "lppe == NULL"
        $_str1 = "fertger" wide
        $c2_delim = "havex"
        $c2_key1 = "1312312"
        $c2_key2 = "MTMxMjMxMg=="
        $ext0 = ".xmd" wide
        $ext1 = ".yls" wide
        $name = /TMPprovider[0-1]?[0-9][0-9A-Za-z]/ wide
    condition:
        $name or all of ($ext*) or all of ($c2_*) or any of ($_*)
}

rule CrowdStrike_CSIR_13025_04 : energetic_bear havex rat tasking installer 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "HAVEX RAT - Tasking binary - installer"
        reports = "CSIR-13025"
        version = "201312200000"
        last_modified = "2013-12-20"
        actor = "ENERGETIC BEAR"
        malware_family = "HAVEX"
    strings:
        $installername = "InstallerFromDll.dll"
        $bzheader = { 42 5A 68 39 31 41 59 26 }
        $oldstrings_sysmain = "sysmain.dll" wide
        $oldstrings_sendthis = "SendThisFile"
        $oldstrings_yls = ".tmp.yls" wide
    condition:
        $installername and $bzheader or all of ($oldstrings*)
}

rule CrowdStrike_CSIR_13025_05 : energetic_bear havex rat tasking 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "HAVEX RAT - Tasking binary - infoharvester"
        reports = "CSIR-13025"
        version = "201312200000"
        last_modified = "2013-12-20"
        actor = "ENERGETIC BEAR"
        malware_family = "HAVEX"
    strings:
        $dllname = "InfoHarvesterCmd.dll"
        $string_havex   = "havex"
        $string_key     = "1312312"
        $string_fertger = "fertger" wide
        $string_lppe    = "lppe == NULL"
    condition:
        $dllname and 2 of ($string_*)
}

rule CrowdStrike_CSIR_13025_06 : energetic_bear havex rat tasking 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "HAVEX RAT - Tasking binary - runexe"
        reports = "CSIR-13025"
        version = "201312200000"
        last_modified = "2013-12-20"
        actor = "ENERGETIC BEAR"
        malware_family = "HAVEX"
    strings:
        $dllname = "RunExeCmd.dll"
        $string_enckey      = "MTMxMjMxMg==" wide
        $string_temp        = "TEMP" wide
        $string_exe         = ".exe" wide
    condition:
        $dllname or ($string_enckey and ($string_temp and $string_exe))
}

rule CrowdStrike_CSIR_13025_07 : energetic_bear havex key 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "HAVEX RAT - encoded RSA public key"
        reports = "CSIR-13025"
        version = "201312200000"
        last_modified = "2013-12-20"
        actor = "ENERGETIC BEAR"
        malware_family = "HAVEX"
    strings:
        $enc = "AATXn+MiwLu+xCoMG7SqY1uQxAk1qLdyoED9LxIVQr2Z/gsrHIsgTvK9AusdFo+9" ascii wide
    condition:
        any of them
}

rule CrowdStrike_CSIR_13025_01 : energetic_bear havex rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "HAVEX RAT - Class names"
        reports = "CSIR-13025"
        version = "201807300927"
        last_modified = "2018-07-30"
        actor = "ENERGETIC BEAR"
        malware_family = "HAVEX"
    strings:
        $meminj = "AVWriteMemInjector" fullword
        $remote = "AVRemoteThread" fullword
        $cc = "AVCommandController" fullword
    condition:
        2 of them
}

rule CrowdStrike_CSIT_13120_02 : backdoor_dll team_bear 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "TEAM BEAR TeamSpy Backdoor Dll"
        reports = "CSIT-13120"
        version = "202101291827"
        last_modified = "2021-01-29"
        actor = "TEAM BEAR"
        malware_family = "TeamSpy"
    strings:
        $dllname = "AVICAP32.dll"
        $export1 = "AppCleanup"
        $export2 = "capCreateCaptureWindowA"
        $export3 = "capCreateCaptureWindowW"
        $export4 = "capGetDriverDescriptionA"
        $export5 = "capGetDriverDescriptionW"
        $export6 = "videoThunk32"
        // CALL ..; tv.cfg
        $u1 = {E8 ?? 00 00 00 74 76 2E 63 66 67 00}
        // CALL ..; szadminhost
        $u2 = {E8 ?? 00 00 00 73 7A 61 64 6D 69 6E 68  6F 73 74 00}
        // CALL ..; http://
        $u3 = {E8 ?? 00 00 00 68 74 74 70 3A 2F 2F 00}
        // CALL ..; %2.2x
        $u4 = {E8 ?? 00 00 00 25 32 2E 32 78 00}
    condition:
        ($dllname and all of ($export*)) or any of ($u*)
}

rule CrowdStrike_CSIT_13120_03 : config team_bear 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "TEAM BAT TeamSpy Backdoor Configuration File"
        reports = "CSIT-13120"
        version = "202101291827"
        last_modified = "2021-01-29"
        actor = "TEAM BEAR"
        malware_family = "TeamSpy"
    strings:
        $header1 = { 01 03 72 fd 3c 79 a9 98 1a a3 36 cf }
    condition:
        any of them
        //$header at 0
        and filesize < 1MB
}

rule CrowdStrike_CSIT_13120_01 : installer team_bear 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "TEAM BEAR TeamSpy Installer"
        reports = "CSIT-13120"
        version = "202101291827"
        last_modified = "2021-01-29"
        actor = "TEAM BEAR"
        malware_family = "TeamSpy"
    strings:
        $magic = { f0 ff ff ff ?? ?? ?? ?? ?? ef be ad de ?? ?? ?? ?? ?? ?? 6e 73 74 75 ?? ?? ?? ?? 73 6f 66 74 ?? ?? ?? ?? ?? 4e 75 6c 6c }
        $size = { 78 f0 23 00 5d 00 00 80 }
    condition:
        $magic and $size
}

rule CrowdStrike_CSIT_13120_04 : module team_bear 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "TEAM BAT Module"
        reports = "CSIT-13120"
        version = "202101291827"
        last_modified = "2021-01-29"
        actor = "TEAM BEAR"
        malware_family = "TeamSpy"
    strings:
        // PE header string "This program cannot ...", XOR-encrypted with 11120e0f10
        $msg = { 45 7a 67 7c 30 61 60 61 68 62 70 7f 2e 6c 71 7f 7c 61 7b 30 73 77 2e 7d 65 7f 32 67 61 30 55 5d 5d 2f 7d 7e 76 6b 21 1d 1c }
    condition:
        $msg
}

rule CrowdStrike_CSIT_13123_01 : comment_panda loader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Loader for COMMENT PANDA-related RAT"
        reports = "CSIT-13123"
        version = "201312300000"
        last_modified = "2013-12-30"
        actor = "COMMENT PANDA"
    strings:
        $ver1_key = /%\$#1234as.{0,500}g@!gy5.{0,500}basdg/
        $decryption_error  = "Mode must be 0(encrypt) or 1(decrypt)"
        $password1 = "asdfqwe123cxz"
        $password2 = "zse45rdcfe3"
        $password3 = "0o98u7ytasdf"
        $password4 = "Wkda0Qd3kv12"
        $dec_var1 = { bb 00 01 00 00 0f b6 00 03 c2 99 f7 fb 0f b6 c2 8a 04 30 30 01 }
    condition:
        (1 of ($password*) and $decryption_error) or $dec_var1 or $ver1_key
}

rule CrowdStrike_CSIT_13123_02 : comment_panda rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "COMMENT PANDA-related RAT"
        reports = "CSIT-13123"
        version = "201312300000"
        last_modified = "2013-12-30"
        actor = "COMMENT PANDA"
    strings:
        $str1 = "do_pivot(): connections[ix].header.id=%d ix=%d"
        $str2 = "Packet to be bounced too "
        $str3 = "do_pivot: [2] requested %d bytes but got %d"
        $str4 = "do_pivot(): inconnsistent seq numbers connections[]..seq=%d header.seq=%d"
        $str5 = "do_pivot(): connections[header.id].header.id=%d header.id=%d!BUG, please report!"
        $str6 = "usage:%s   IP  port [proxip] [port] [key]"
        $file1 = "dw.dat"
        $file2 = "sqlpass.dic"
        $file3 = "sql.dat"
    condition:
        2 of ($str*) or 3 of ($file*)
}

rule CrowdStrike_CSIT_13124_01 : comment_panda rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "COMMENT PANDA Google Appspot Proxy malware"
        reports = "CSIT-13122"
        version = "201312310000"
        last_modified = "2013-12-31"
        actor = "COMMENT PANDA"
    strings:
        $string1 = "fetch.py" // Requested URI for Proxy
        $string2 = "method=POST" // POST data for Proxy
        $string3 = "CmdPath" // Path for cmd.exe
        $string4 = "encoded_path"
    condition:
        all of them
}

rule CrowdStrike_CSTA_14000_01 : ncph_rat rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "NCPH RAT, seen in the wild in 2006"
        reports = "CSTA-14000"
        version = "201401100000"
        last_modified = "2014-01-10"
        malware_family = "NCPH RAT"
    strings:
        $logmsg1 = "%s(error=%d)"
        $capapi = "CAPAPI32"
        $opensvcf = "OpenService fail"
        $crsvcf = "CreateService fail"
    condition:
        all of them
}

rule CrowdStrike_CSTA_14000_02 : ncph_rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "NCPH RAT controller, seen in the wild in 2006"
        reports = "CSTA-14000"
        version = "201401100000"
        last_modified = "2014-01-10"
        malware_family = "NCPH RAT"
    strings:
        $url1 = "http://wpa.qq.com/msgrd?V=1&Uin=312016&Site=WWW.CNASM.COM&Menu=yes"
        $s2 = "explorer.exe"
        $url2 = "http://www.cnasm.com/gui/help.html"
        $url3 = "http://www.cnasm.com/gui/error.html"
    condition:
        all of them
}

rule CrowdStrike_CSIT_14001_01 : blackpos pos_scraper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "BlackPOS Point-of-Sale credit card scraping tool"
        reports = "CSIT-14001"
        version = "201401160000"
        last_modified = "2014-01-16"
        malware_family = "BlackPOS"
    strings:
        $fmt = "data_%d_%d_%d_%d_%d.txt"
        $scramble1 = "\"-BFr423mI_6uaMtg$bxl\\sd1iU/0ok.cpe"
        $scramble2 = "gBb63-t2p_.rkd0uaeU/x1c$s\\o4il"
        $scramble3 = "x\"a-201Mt6b3sI$ /ceBok_i\\m.rdpU4Fulg"
        $scramble4 = "omv3.a 1%tNd\\4ils60n2Te_w"
        $scramble5 = "4mei gd2%rob-"
        $scramble6 = "8pCt1wq_hynlsc0.u9a"
        $pdb1 = "z:\\Projects\\Rescator\\uploader\\Debug\\scheck.pdb"
    condition:
        ($fmt and 1 of ($scramble*)) or $pdb1
}

rule CrowdStrike_CSIT_14001_02 : blackpos pos_scraper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "BlackPOS Point-of-Sale credit card scraping tool - memory scanning component"
        reports = "CSIT-14001"
        version = "201401160000"
        last_modified = "2014-01-16"
        malware_family = "BlackPOS"
    strings:
        $message1 = "S region:"
        $message2 = " found ["
        $message3 = "] bytes of pattern:["
        $message4 = "CC2 region:"
        $message5 = "CC memregion:"
        $message6 = "KAPTOXA"
        $message7 = "=== pid:"
        $message8 = "scan process with pid for kartoxa and string pattern:"
        $message9 = "scan process with pid for kartoxa:"
        $message11 = "scan all processes for string pattern:"
    condition:
        2 of ($message*)
}

rule CrowdStrike_CSIT_14003_02 : flying_kitten rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "FLYING KITTEN RAT"
        reports = "CSIT-14003"
        version = "201401170000"
        last_modified = "2014-01-17"
        actor = "FLYING KITTEN"
    strings:
        $classpath = "Stealer.Properties.Resources.resources"
        $pdbstr = "\\Stealer\\obj\\x86\\Release\\Stealer.pdb"
    condition:
        all of them and
        // Mono/.NET 32bit or 64bit PE file
        uint16(0) == 0x5A4D and uint32(uint32(0x3c)) == 0x4550 and
        uint16(uint32(0x3C) + 0x16) & 0x2000 == 0 and
        ((uint16(uint32(0x3c)+24) == 0x010b and uint32(uint32(0x3c)+232) > 0) or
        (uint16(uint32(0x3c)+24) == 0x020b and uint32(uint32(0x3c)+248) > 0))
}

rule CrowdStrike_CSIT_14003_01 : flying_kitten dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "FLYING KITTEN dropper"
        reports = "CSIT-14003"
        version = "201807301029"
        last_modified = "2018-07-30"
        actor = "FLYING KITTEN"
    strings:
        $conffilename = "RapidStartTech.stl"
        $exename = "IntelRS.exe"
        $rsrreader = "System.Resources.ResourceReader"
    condition:
        all of them and
        // Mono/.NET 32bit or 64bit PE file
        uint16(0) == 0x5A4D and uint32(uint32(0x3c)) == 0x4550 and
        uint16(uint32(0x3C) + 0x16) & 0x2000 == 0 and
        ((uint16(uint32(0x3c)+24) == 0x010b and uint32(uint32(0x3c)+232) > 0) or
        (uint16(uint32(0x3c)+24) == 0x020b and uint32(uint32(0x3c)+248) > 0))
}

rule CrowdStrike_CSIT_14003_03 : flying_kitten installer 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "FLYING KITTEN installer for RAT"
        reports = "CSIT-14003"
        version = "201807301033"
        last_modified = "2018-07-30"
        actor = "FLYING KITTEN"
    strings:
        $exename = "IntelRapidStart.exe"
        $confname = "IntelRapidStart.exe.config"
        $cabhdr = { 4d 53 43 46 00 00 00 00 }
    condition:
        all of them
}

rule CrowdStrike_CSIT_14002_01 : posnet pos_scraper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "POSNET Point-of-Sale credit card scraping tool - memory scanning component"
        reports = "CSIT-14002"
        version = "201401200000"
        last_modified = "2014-01-20"
        malware_family = "POSNET"
    strings:
        $kaptoxa = "KAPTOXA"
        $gotit = "GOTIT"
        $obfuscated_string = "6I2cn3Sep1 Uio$ra0su\\wO4B:_kDltW/.N"
    condition:
        uint16(0) == 0x5A4D and uint32(uint32(0x3C)) == 0x00004550 and
        all of them
}

rule CrowdStrike_CSIT_14008_01 : plugx rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detection for some versions of PlugX set to run on a specific date (2013-08-08)"
        reports = "CSIT-14008"
        version = "201401230000"
        last_modified = "2014-01-23"
    strings:
        $header_20130808 = {6B C? 64 03 C? [1-3] F8 2B 33 01}
    condition:
        any of them
}

rule CrowdStrike_CSIT_14006_01 : elite_keylogger keylogger key 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Elite Keylogger RC4 keys"
        reports = "CSIT-14006"
        version = "201401300000"
        last_modified = "2014-01-30"
        malware_family = "Elite Keylogger"
    strings:
        // Used in the encrypted string length calculation
        $length_str = "ZZZZ" wide
        // RC4 keys used in string decryption
        $key_1 = { 25 d3 d7 3c ab d5 19 42 8d c6 de 9f d7 51 df f2 }
        $key_2 = { 47 6d 44 00 b2 74 5a 4c a6 cf ff 0a bb 50 93 fe }
    condition:
        uint16(0) == 0x5A4D and uint32(uint32(0x3C)) == 0x00004550 and
        $length_str and
        1 of ($key_*)
}

rule CrowdStrike_CSIT_14035_03 : shadow_crane cve_2014_0497 tapaoux certificate 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Certificate used in malware related to CVE-2014-0497."
        reports = "CSIT-14035"
        version = "201805110839"
        last_modified = "2018-05-11"
        actor = "SHADOW CRANE"
    strings:
        $pubkey = { 30 48 02 41 00 9f 83 43 dd 05 b0 8c 48 ad 67 1b 6f 31 69 7a 29 83 a6 7f 4c fe d1 b4 f0 66 44 ce 22 f3 e8 ad 52 f8 75 bc c2 db 8a 3a 7a 7c 04 ee 14 65 33 b8 c9 74 10 ef 8f a4 8b 17 95 df ce b9 1f 33 97 f0 d3 02 03 01 00 01 }
    condition:
        $pubkey
}

rule CrowdStrike_CSIT_14007_01 : softactivity keylogger 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "SoftActivity Keylogger"
        reports = "CSIT-14007"
        version = "201402060000"
        last_modified = "2014-02-06"
    strings:
        $copyright_notice = "2000-2013 Deep Software Inc." wide
    condition:
        uint16(0) == 0x5A4D and uint32(uint32(0x3C)) == 0x00004550 and
        $copyright_notice
}

rule CrowdStrike_CSIT_14019_01 : commodity keylogger webwatcher 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "WebWatcher keylogger by Awareness Technologies"
        reports = "CSIT-14019"
        version = "201904251016"
        last_modified = "2019-04-25"
        malware_family = "WebWatcher"
    strings:
        // PDB paths
        $pdb1 = ":\\BuildSource\\9\\WindowsClient\\WindowsClient.Client.RC\\Binaries\\Win32\\Release DlpHook\\"
        // Config properties
        $config1 = "*/serviceInterval" wide
        $config2 = "*/serviceUrl" wide
        // C2 url
        $c2url1 = "http://data.webwatcherdata.com/v51/ClientService.asmx" wide
        $c2url2 = "https://data.webwatcherdata.com/v51/ClientService.asmx" wide
        $mon1 = "//monitor[@filename=\"%s\"]/keyphrase" wide
        $ffmonitor = "Mozilla FireFox Monitor" wide
    condition:
        any of them
}

rule CrowdStrike_CSIT_14011_01 : refog keylogger unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Refog keylogger - unpacked DLL"
        reports = "CSIT-14011"
        version = "201402070000"
        last_modified = "2014-02-07"
        malware_family = "Refog Keylogger"
    strings:
        $mhook = "..\\..\\SharedSourceCpp\\MHook\\disasm_x86.cpp" wide
        $proto = "wrong protocol type"
    condition:
        all of them
}

rule CrowdStrike_CSIT_14000_01 : cubecrypter dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "CubeCrypter .NET dropper"
        reports = "CSIT-14000"
        version = "201402120000"
        last_modified = "2014-02-12"
    strings:
        // This covered both .NET detection as well as the presence of a resource
        $resource_loader = "System.Resources.ResourceReader, mscorlib, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"
        // Resource names used over multiple revisions
        $resource_getter_1 = "get_rsc"
        $resource_getter_2 = "get_ky"
        $resource_getter_3 = "get_rn"
        // Versions 1 and 2
        $strings_0 = "poney"
        $strings_1 = "horse"
        $strings_2 = "chocolate"
        // Version 3
        $strings_3 = "momo"
        $strings_4 = "quack"
        // All versions
        $strings_5 = "Decrypt"
        // Used in .NET obfuscation
        $dim = "Dim " wide
    condition:
        uint16(0) == 0x5A4D and uint32(uint32(0x3C)) == 0x00004550 and
        4 of ($strings_*) and
        2 of ($resource_*) and
        $dim
}

rule CrowdStrike_CSIT_14010_01 : award_keylogger keylogger 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Award Keylogger"
        reports = "CSIT-14010"
        version = "201402180000"
        last_modified = "2014-02-18"
        malware_family = "Award Keylogger"
    strings:
        // Match on the copyright notice present in the GUI component
        $copyright_notice_1 = "Copyright @ 2007-" wide
        $copyright_notice_2 = "Award Software, Inc" wide
        // Match on strings present in the key logging component
        $keylog_string_1 = "<B>Login Information Captured</B><BR>User: %s"
        $keylog_string_2 = "<B>Clipboard Data Captured</B><BR>User: %s"
    condition:
        uint16(0) == 0x5A4D and uint32(uint32(0x3C)) == 0x00004550 and
        ( (all of ($copyright_notice_*)) or (all of ($keylog_string_*)) )
}

rule CrowdStrike_CSIT_14013_01 : somabix pos_scraper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "VBScript used to infect hosts with Somabix POS malware"
        reports = "CSIT-14013"
        version = "201402200000"
        last_modified = "2014-02-20"
        malware_family = "Somabix"
    strings:
        $s1 = "RemoteExec"
        $s2 = "Win32_Process"
        $s3 = "ConnectServer"
        $s4 = "root\\cimv2"
        $s5 = "ImpersonationLevel"
        $s6 = "varStoreNumberInt"
    condition:
        all of them
}

rule CrowdStrike_CSIT_14013_02 : somabix pos_scraper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Somabix POS malware"
        reports = "CSIT-14013"
        version = "201402200000"
        last_modified = "2014-02-20"
        malware_family = "Somabix"
    strings:
        // XOR key:
        $key = "Microsoft .NET Framework 2.0a: Return type:"
        // imul <reg>, 69069
        $code = {69 ?? CD 0D 01 00}
    condition:
        all of them
}

rule CrowdStrike_CSIT_14012_01 : spyagent keylogger 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "SpyAgent by SpyTech Software and Design, Inc."
        reports = "CSIT-14012"
        version = "201402240000"
        last_modified = "2014-02-24"
        malware_family = "SpyAgent Keylogger"
    strings:
        // Format string for the settings file's path
        $settingspath = "%s\\sa\\saopts.dat"
        // Window name of the main UI application
        $window = "SpyAgent_HWND32"
        $nowin = "%s\\sacache\\nowin.log"
        // Registry path
        $regpath = "SOFTWARE\\Spytech\\SpyAgent Pro"
        // Format string: "Keystrokes Typed %s.. "
        $keystrokesTyped = { 4b 65 79 73 74 72 6f 6b 65 73 20 54 79 70 65 64 8f 20 25 73 20 28 25 73 29 8f 20 25 73 8f 20 25 73 }
    condition:
        all of them
}

rule CrowdStrike_CSIT_14012_02 : spyagent keylogger 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "User Interface binary for SpyAgent by SpyTech Software and Design, Inc."
        reports = "CSIT-14012"
        version = "201402240000"
        last_modified = "2014-02-24"
        malware_family = "SpyAgent Keylogger"
    strings:
        // Format string for the settings file's path
        $settingspath = "%s\\sa\\saopts.dat"
        // Messages/Strings of the UI
        $str1 = "SpyAgent password has been successfully changed."
        $str2 = "error: you need to set your SpyAgent password before proceeding."
        $str3 = "click the \"Set Password\" button in the \"Options\" dialog to set your password!"
        $str4 = "SpyAgent Keystrokes Log Viewer"
        // Registry path
        $regpath = "SOFTWARE\\Spytech\\SpyAgent Pro"
        // PDB path
        $pdb = "c:\\Source\\SpyAgent7\\Release\\autoi.pdb"
    condition:
        any of them
}

rule CrowdStrike_CSIT_14014_01 : adwind rat android 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Adwind/RECOMM Java RAT Android"
        reports = "CSIT-14014"
        version = "201807300905"
        last_modified = "2018-07-30"
        malware_family = "Adwind"
    strings:
        // PK header
        $magic = { 50 4b 03 04 }
        $metainf = "META-INF"
        $class = ".class" nocase
        // Name of UNRECOM configuration path
        $class_name = "com/androi/config.xml"
        // Public key (compressed) of key used to re-sign APK
        $pub_key = { 33 68 62 5b c7 c6 a9 d5 e6 d1 f6 9d 97 91 9d 69 41 13 db 7c 83 26 b6 d9 4c 8c 8c 86 dc 06 9c 6c ac da 7c cc 4c 52 ac 0c 06 dc 08 45 8c 0b 9a 58 d6 18 34 b1 ac 30 68 62 9e b0 80 99 89 91 89 89 93 61 72 de 9a 7d ec 9f 18 ef 1b f0 c2 15 32 b2 02 f5 35 4e 01 9b c3 1c ca c2 26 cc 14 1a 6c 28 6c 20 08 e2 70 08 73 39 27 e6 64 a6 e5 17 e5 65 26 1a 8a 19 88 80 04 d9 85 79 7d f3 4b f3 4a 12 33 f3 14 c2 32 53 cb 0d 05 0c f8 40 e2 5c c2 ec 8e 79 29 45 f9 99 29 30 11 6e 0c 11 66 84 88 92 81 02 dc 0d 9c 8c 62 c2 89 10 71 07 28 ad 97 9c 9f 6b 20 27 ce 6b 60 61 60 64 64 69 60 68 6c 6c 62 16 25 ce 6b 6c 6a 60 6e 68 0e e5 0e 56 67 37 31 2a 20 07 30 23 2b 03 73 13 23 2f 03 50 9c 83 a9 89 91 91 e1 da 64 49 96 7b c7 b8 55 36 be 3d 9e f4 e0 e6 0d 55 3b bb b3 39 af 65 1f fd 67 eb 59 f1 62 cf 8a b3 d9 97 2b f2 96 73 2d cf 79 c6 b7 9b 7f a6 69 e4 ff 9b 76 e5 2b 9d 9f bf b0 f5 4e d9 f1 e4 df a2 cb cf c2 3e 3e 4a 5f 21 bd 7f 93 c1 d6 8a 43 2c ce fb 7c 8a 24 76 b8 7d 55 14 6d fb 60 b1 d0 af f3 d0 3e 8b fa be 7d e7 fb 4f 1d be 25 f7 d8 e0 e4 ab c9 17 96 1f be e3 f5 39 40 89 37 80 83 dd e8 41 c3 74 f1 77 59 ac c6 91 cf 96 4d 79 a3 b3 f9 53 cb 82 25 69 27 aa a6 dc b0 36 e4 b4 4a 37 d7 d3 4f 11 3a 90 97 eb f4 31 42 e2 fe 3f e6 c6 33 3c 57 5c 6e e5 dc 3d bc 43 25 42 d2 83 71 b3 6a 8a b0 ff fe 7b 33 4e 6a 94 7b dc fe 9a 9e 15 c2 db 18 72 62 f7 29 f6 9d 8f dc 43 8d 05 8f 64 cf fa 9e 7f ef cd 99 be cc e7 27 16 5d e8 ab 50 53 98 62 3f b3 a8 d6 86 e5 5f d1 4c d9 99 f7 67 af b3 58 b0 49 bc 7e b1 6c 74 d6 bf 97 f2 4c 8c cc 8b 1b ff 18 34 fe 34 90 05 86 ae 2c 1f 8b 18 8b 88 47 24 43 98 ad ba 8e db 3a c1 36 d6 25 25 92 6b 38 4f f5 08 1a 34 9e 04 c9 2b b3 34 1e 34 68 dc d7 80 55 cd c2 c6 59 4b 1a a7 0f d2 94 d0 84 94 e3 78 40 5e 11 66 61 35 60 66 64 fc 8f 96 ff 98 41 a9 a2 6a fd b4 9e d7 01 47 1c 59 03 25 2e dc 5a bd 9e 31 ba ab 2c 4a 7d b9 e8 a2 43 5b fc 95 44 44 ff df 3a c7 cc 19 b5 7f 89 ee 77 76 8e a2 1c 85 cc a7 87 f3 ee ae 63 61 d8 a7 e9 aa c3 e1 7d a8 6e db c2 ba 35 73 f7 49 e8 28 f8 6d 0c 16 fc 12 7a 43 65 5b d8 ed 27 77 94 1c 26 ea 96 b6 fd eb 98 2a cb b8 e2 df d6 75 51 4e 09 c1 b1 3f 4c 0c 59 55 94 dc 7a cc 1e e9 68 c5 fd 9c 72 4d f6 ba 41 d6 93 93 df a6 4a 2f 3e a8 2f 2b 29 72 f7 98 bc 54 d2 2d dd 1f ea df 98 ff 2d 4d b0 d6 09 e1 dd 5b c3 38 c7 6c d7 a6 59 4e 85 07 c5 ef 07 d9 dc 3e fa b9 b1 ca f3 c1 fb 65 3c 7b eb 4b c4 eb aa fc 25 6d 9d bf 28 b1 17 a5 e5 f9 f8 36 3f dc 1b d5 c6 51 f3 d9 5f f7 8d e2 23 d7 53 39 da 1b c4 9e 35 27 37 04 5c 3a 62 f0 6e f9 a1 2c 19 cf cb 65 5c 11 ab eb a5 9a ce 4c ee f6 30 b4 70 56 d9 cb c2 f8 4b 48 cc 2a 20 9c 2f c3 d7 b0 89 f1 14 30 8b 1c 03 16 6a 06 8d 8b 06 69 8c 22 97 a1 48 e5 2e 6a 6e 67 69 62 64 }
    condition:
        $magic at 0 and
        1 of ($metainf, $class) and
        $class_name and $pub_key
}

rule CrowdStrike_CSIR_13006_02 : amorous_panda rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detection for update.jar (may cause false positives)"
        reports = "CSIR-13006"
        version = "201402250000"
        last_modified = "2014-02-25"
        actor = "AMOROUS PANDA"
    strings:
        $pk = "PK"
        $javaTool = "JavaTool.class"
        $sbtFP = "sbt/compiler/PK"
    condition:
        $pk at 0 and $javaTool and not $sbtFP and filesize <= 11KB
}

rule CrowdStrike_CSIT_14016_01 : keylogger 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "007 Spy Software Keylogger"
        reports = "CSIT-14016"
        version = "201807302222"
        last_modified = "2018-07-30"
        malware_family = "007 Spy Software"
    strings:
        // Characteristic strings and log messages
        $str1 = "(Separate usernames with a comma, or leave blank to monitor all uses.)"
        $str2 = "Input usernames here and separate with a comma. Leave blank to monitor all users."
        $str3 = "Please Enter Access Password:"
        $str4 = "                             Delivery via Email and FTP"
    condition:
        all of them
}

rule CrowdStrike_CSIT_14018_01 : dropper venomous_bear wipbot 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Dropper file used by VENOMOUS BEAR to deploy Wipbot"
        reports = "CSIT-14018"
        version = "202002111157"
        last_modified = "2020-02-11"
        actor = "VENOMOUS BEAR"
        malware_family = "Wipbot"
    strings:
        // Code used in the FNV-1 hash function
        // CALL wcharToLower();
        // MOVZX EAX, AX; XOR ESI, EAX; IMUL ESI, EAX, 0x1000193; DEC EBX; JNZ
        $hashFuncLoop = { e8 ?? ?? ff ff 0f b7 c0 31 f0 69 f0 93 01 00 01 4b 75 ?? }
        // Fowler-Noll-Vo FNV-1 hash function implementation
        // MOV the constant/seed 0x92FA932E into ESI, then later IMUL ESI, EAX, 1000193h
        $fnvSeed1 = { be 2e 93 fa 92 [0-18] 69 f0 93 01 00 01 }
        // MOV the constant/seed 0x35AB3F69 into EAX, then IMUL ESI, EAX, 1000193h
        $fnvSeed2 = { b8 69 3f ab 35 [0-10] 69 f0 93 01 00 01 }
        // This code is used in the bootstrapping phase
        // cmp     word ptr [ebx+2], 0CCCCh
        // jz      short loc_401161
        // mov     word ptr [ebx+2], 0CCCCh
        // mov     eax, 3E8h
        $bootstrap = { 66 81 7b 02 cc cc 74 10 66 c7 43 02 cc cc b8 e8 03 00 00 }
    condition:
        uint16(0) == 0x5A4D and uint32(uint32(0x3C)) == 0x00004550 and
        any of them
}

rule CrowdStrike_CSIT_14018_02 : rat unpacked venomous_bear wipbot 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects VENOMOUS BEAR's Wipbot malware"
        reports = "CSIT-14018"
        version = "202002111203"
        last_modified = "2020-02-11"
        actor = "VENOMOUS BEAR"
        malware_family = "Wipbot"
    strings:
        // Strings from the unpacked payload DLL
        $str1 = "http://%s/%s"
        $str2 = "%u processor:"
        $str3 = "memory (free/total):  %d(Mb)/ %d(Mb)  (use %d"
    condition:
        all of them
}

rule CrowdStrike_CSIT_14015_02 : jackpos pos_scraper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "JackPoS POS malware"
        reports = "CSIT-14015"
        version = "201403030000"
        last_modified = "2014-03-03"
        malware_family = "JackPoS"
    strings:
        $pdb = "C:\\Users\\ziedpirate.ziedpirate-PC\\Desktop\\sop\\sop\\Release\\"
    condition:
        $pdb
}

rule CrowdStrike_CSIT_14017_01 : turbine_panda sakula dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Rule detects deobfuscation routine in the Sakula dropper"
        reports = "CSIT-14017"
        version = "201403030000"
        last_modified = "2014-03-03"
        actor = "TURBINE PANDA"
        malware_family = "Sakula"
    strings:
        $deob_loop = { 33 c0 b2 32 85 f6 74 0d 30 14 38 8d 0c 38 40 fe c2 3b c6 72 f3 81 fb ff ff 01 00 74 0b }
    condition:
        $deob_loop
}

rule CrowdStrike_CSIT_14017_02 : turbine_panda sakula rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Rule detects XOR loop in Sakula RAT"
        reports = "CSIT-14017"
        version = "201807271456"
        last_modified = "2018-07-27"
        actor = "TURBINE PANDA"
        malware_family = "Sakula"
    strings:
        $non_null_xor_loop = { 8a 0c 10 84 c9 74 0b 80 f9 56 74 06 80 f1 56 88 0c 10 }
        $sak = "\x00Sakula\x00"
        $lcg = { 05 cf 0a 32 e5 03 d8 8b c2 c1 e8 05 05 0e 23 50 d3 03 d0 c1 e1 07 b8 93 23 71 34 2b c1 }
    condition:
        any of them
}

rule CrowdStrike_CSIT_14017_03 : certificate 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Certificate used to sign Sakula malware"
        reports = "CSIT-14017"
        version = "201403050000"
        last_modified = "2014-03-05"
    strings:
        $key = { 30 82 01 0a 02 82 01 01 00 92 a7 82 f5 bb 0c 5c 05 2c 76 46 ad d5 08 6e 65 0c f8 79 8b bc ce 31 90 10 80 eb 9d e9 d8 e0 d5 00 e9 4b 89 a2 54 8d 83 90 ec 65 b9 83 4b af ee 71 56 19 09 e9 3f 82 6a 0f cb 42 97 bb 9f cf a3 20 ec 7f 29 af c7 65 88 c5 73 d1 9f cc f5 dd 79 37 c3 7b 98 24 f6 b0 8f 04 ef 92 03 ee 07 b3 94 90 a0 d7 2d b3 f7 6f ab 45 a7 0e 43 79 e0 7b 18 a6 26 90 ef a7 c3 68 ee e0 23 d3 89 05 cb c5 93 82 2e 54 9f 00 2c d1 d0 ef 2c 19 f7 41 73 8c 45 ee 94 26 09 72 1e a8 8a b8 cf ad 77 84 5e 36 b9 c8 03 95 7d c6 cd aa eb fa d5 a1 8d 2f 2f 37 06 fb df 01 2c c4 32 e9 cc f8 38 11 c4 21 4b ec ef 53 df 18 59 db 77 a1 2f b6 54 1f 6d cb 53 48 0f 5d 87 a3 0e 0f 02 a4 35 f5 e9 9c ec 21 a6 88 56 86 f9 65 27 ec 44 22 dd 79 5a ef 1f 05 7f ac 7a 04 bf fa e7 8b a1 54 c7 39 1c 55 30 8c 9b 04 9d 02 03 01 00 01 }
    condition:
        $key
}

rule CrowdStrike_CSIT_14017_04 : certificate 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Certificate used to sign Sakula malware"
        reports = "CSIT-14017"
        version = "201403050000"
        last_modified = "2014-03-05"
    strings:
        $key = { 30 82 01 0a 02 82 01 01 00 c0 82 3c 0a b5 7e 6c 9d d4 b6 dd 1a c8 8e 7b a1 dd 31 dd fb 33 64 47 e8 80 b9 08 e4 f3 14 d9 48 f5 aa 86 26 5d e0 bd 8b 11 96 20 9e 80 ad d0 2f c3 ed 20 a1 06 40 02 41 ef db 5b 5d 69 da 2f 1e 95 53 85 89 fd 60 9c 77 ff 66 07 1c 17 68 0b a1 a3 bc 9a 66 fb 5f 60 84 a1 e4 3c 79 1f 21 01 4e 62 19 89 1d 03 d0 79 65 3b ce ef 79 2a d1 07 94 85 58 09 a7 0f e3 af 6b e8 65 d4 9d 17 72 70 21 38 12 2d 41 9b 93 88 22 d1 38 2e 8f 04 45 a7 2f 1f 88 f8 fe 04 95 f8 12 63 7f c1 2c 72 db a7 cd db d2 89 e5 00 b7 92 9f d7 59 21 c4 28 b6 e4 67 fc 1b 0d ee 19 f7 19 87 7e 40 11 b0 76 56 97 79 6a a0 c5 fa 8b 61 d6 65 53 1c e2 07 e4 43 31 61 d1 0c 60 de dd 80 00 63 31 c5 6d 46 91 c8 2b 0f 96 cf 4f 6e ab 7c 5e 58 aa 85 2a e2 cb 28 01 37 94 c0 36 01 1c 1e cd ef f5 bc 5a 10 46 3c cf d5 02 03 01 00 01 }
    condition:
        $key
}

rule CrowdStrike_CSIT_14023_01 : advanced_keylogger keylogger 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Advanced Keylogger by Eltima"
        reports = "CSIT-14023"
        version = "201403050000"
        last_modified = "2014-03-05"
    strings:
        $str1 = "LastClearingLog"
        $str2 = "LastLogSendTime"
        $str3 = "StealthUninstall"
        $str4 = "EnableKeylogging"
        $str5 = "SnapshootsInterval"
        $str6 = "SendLogPeriod"
        $str7 = "SendLogSMTP"
        $str8 = "SendLogSMTPPort"
        $str9 = "SendLogSize"
        $str10 = "SendLogLoginPass"
        $str11 = "ClearLogsDays"
        $str12 = "ClearLogsMailed"
    condition:
        all of them
}

rule CrowdStrike_CSIT_14020_01 : lockittight keylogger 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Rule to match on LockItTight commercial keylogger"
        reports = "CSIT-14020"
        version = "201403100000"
        last_modified = "2014-03-10"
        malware_family = "LockItTight"
    strings:
        $string1 = "LockItTight Agent Monitor"
        $string2 = "LockItTight Engine"
        $string3 = "LockItTight Monitor"
    condition:
        any of them
}

rule CrowdStrike_CSIR_14003_01 : fraternal_spider script 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Signature for FRATERNAL SPIDER attack script"
        reports = "CSIR-14003"
        version = "201403110000"
        last_modified = "2014-03-11"
        actor = "FRATERNAL SPIDER"
    strings:
        $assassin_echo          =   "###Assassin###"
        $kamikazi_echo          =   "###KamiKaze###"
        $common_random_var      =   "chr(rand(97,122))"
        $common_rand_value      =   "md5(microtime().rand(0,"
        $common_pre_echo        =   "echo \"###"
        $common_echo            =   "uau-repeat"
    condition:
        ($assassin_echo or $kamikazi_echo) and all of ($common_*)
}

rule CrowdStrike_CSIR_14003_02 : fraternal_spider script 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Signature for FRATERNAL SPIDER attack script (Perl)"
        reports = "CSIR-14003"
        version = "201403110000"
        last_modified = "2014-03-11"
        actor = "FRATERNAL SPIDER"
    strings:
        $wget_request = "wget -U 'Mozilla/5.0 (X11; U; Linux i686; pl-PL; rv:1.9.0.2) Gecko/20121223 Ubuntu/9.25 (jaunty) "
    condition:
        all of them
}

rule CrowdStrike_CSIR_14003_03 : fraternal_spider script 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Signature for FRATERNAL SPIDER helper script"
        reports = "CSIR-14003"
        version = "201403110000"
        last_modified = "2014-03-11"
        actor = "FRATERNAL SPIDER"
    strings:
        $eval_command =   "eval(base64_decode($_REQUEST['c_id']))"
    condition:
        all of them
}

rule CrowdStrike_CSIR_14003_04 : fraternal_spider password 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Signature for known FRATERNAL SPIDER password hashes"
        reports = "CSIR-14003"
        version = "201403110000"
        last_modified = "2014-03-11"
        actor = "FRATERNAL SPIDER"
    strings:
        $hashed_password1 = "2bd96b5c52d2efd441b75a2617979bdd"
        $hashed_password2 = "2b7c84233cd47f142573c18a70ff5770"
        $hashed_password3 = "a13756bf1e2bd46921c135232774fc5f"
        $hashed_password4 = "36d540721c055de288072d4e16b196dd"
        $hashed_password5 = "98f66d46fa71a5fa9b9fcd36aababdae"
        $hashed_password6 = "396f72e4974f3e4e2fd7ccffbce9cd7c"
    condition:
        any of them
}

rule CrowdStrike_CSIR_14003_05 : fraternal_spider 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Signature for FRATERNAL SPIDER toolkit"
        reports = "CSIR-14003"
        version = "201403110000"
        last_modified = "2014-03-11"
        actor = "FRATERNAL SPIDER"
    strings:
        $error_message = "Not Foun derror was encountered"
        $stopped_message = "stopcleandos"
        $working_message = "itsoknoproblembro"
    condition:
        all of them
}

rule CrowdStrike_CSIR_14002_01 : dropper rat venomous_bear wipbot 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Wipbot dropper embedded in installer resource section"
        reports = "CSIR-14002"
        version = "202002111458"
        last_modified = "2020-02-11"
        actor = "VENOMOUS BEAR"
        malware_family = "Wipbot"
    strings:
        // Error message box string, disguised as Adobe Reader
        $str1 = "The file is corrupted or has unsupported format!" wide
        $str2 = "AobeRd32 Error!!!" wide
    condition:
        uint16(0) == 0x5a4d and
        uint32(uint32(0x3c)) == 0x00004550 and
        all of them
}

rule CrowdStrike_CSIT_14025_01 : oneshell remote_shell 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Oneshell tool observed during post-exploitation to allow attackers to connect to hosts internally on a compromised network or connects out to a bind shell on a remote host"
        reports = "CSIT-14025"
        version = "201403310000"
        last_modified = "2014-03-31"
        malware_family = "OneShell"
    strings:
        $name = " OneShell "
        $password = "TUHAOISRIGHT" // Command that identifies custom remote shell
    condition:
        any of them
}

rule CrowdStrike_CSIT_14025_04 : htran post_exploitation 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This toolkit has been observed during post-exploitation. It is the common HTran proxy tool combined with additional post-exploitation tools such as pskil"
        reports = "CSIT-14025"
        version = "201906100745"
        last_modified = "2019-06-10"
    strings:
        $usage_string01 = "ConnectPort TransmitPort"
        $usage_string02 = "Usage of Pskill"
        $usage_string03 = "what user are we bruteforcing"
        $usage_string04 = "[SERVER]connection to"
        $usage_string05 = "Usage of Packet Transmit"
    condition:
        filesize < 3MB and
        any of them
}

rule CrowdStrike_CSIT_14026_01 : dynamite_panda mylord dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "MyLord dropper used by DYNAMITE PANDA"
        reports = "CSIT-14026"
        version = "201404010000"
        last_modified = "2014-04-01"
        actor = "DYNAMITE PANDA"
        malware_family = "MyLord"
    strings:
        $a1 = "Sof\x00"
        $a2 = "twar\x00"
        $a3 = "e\\Mi\x00"
        $a4 = "cro\x00"
        $a5 = "soft\\Win\x00"
        $a6 = "dows\\Cur\x00"
        $a7 = "rent\x00"
        $a8 = "Vers\x00"
        $b1 = "un\x00"
        $b2 = "Version\\R\x00"
        $b3 = "dows\\Current\x00"
        $b4 = "soft\\Win\x00"
        $b5 = "Software\\Micro\x00"
    condition:
        all of ($a*) or all of ($b*)
}

rule CrowdStrike_CSIT_14054_01 : mgbot rat shellcode 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Rule to detect MgBot shellcode decryption routine"
        reports = "CSIT-14054"
        version = "201404030000"
        last_modified = "2014-04-03"
        malware_family = "MgBot"
    strings:
        $shellcode_decrypt = { 41 80 31 9e 81 39 fa 64 64 64 75 f4 }
    condition:
        any of them
}

rule CrowdStrike_CSIT_14054_02 : mgbot rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Rule to detect mgbot RAT"
        reports = "CSIT-14054"
        version = "201404030000"
        last_modified = "2014-04-03"
        malware_family = "MgBot"
    strings:
        $import_resolve = { 68 a2 79 54 12 ff 75 c8 ff 95 0c ff ff ff 83 c4 0c 89 85 78 ff ff ff 6a 00 68 a3 79 54 12 ff 75 c8 ff 95 0c ff ff ff }
    condition:
        any of them
}

rule CrowdStrike_CSIT_14054_03 : mgbot dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Rule to detect mgbot RAT dropper"
        reports = "CSIT-14054"
        version = "201404030000"
        last_modified = "2014-04-03"
        malware_family = "MgBot"
    strings:
        $des_key1 = { 5e 97 cc 42 [2-6] 8e cd 00 00 }
        $des_key2 = { 5b 5f cb 8d [2-6] e5 f5 00 00 }
        $des_key3 = { 82 c5 d3 59 [2-6] 2b 38 00 00 }
    condition:
        any of them
}

rule CrowdStrike_CSIT_14026_02 : dynamite_panda msu_rat rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "MSU RAT used by DYNAMITE PANDA"
        reports = "CSIT-14026"
        version = "201404040000"
        last_modified = "2014-04-04"
        actor = "DYNAMITE PANDA"
        malware_family = "MSU RAT"
    strings:
        $s1 = "/%lu.asp"
        $s2 = "/%lu.txt"
        $s3 = "/index.html?id=%ld"
        $s4 = "\\httpclient.txt"
        $s5 = "About hc1"
        $s6 = "cmd.exe"
        $s7 = "host_name"
        $s8 = "host_port"
        $s9 = "Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1)"
        $s10 = "MSU"
    condition:
        7 of them
}

rule CrowdStrike_CSIT_14027_01 : goblin_panda httptunnel dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "HttpTunnel LZMA-based dropper"
        reports = "CSIT-14027"
        version = "201404070000"
        last_modified = "2014-04-07"
        actor = "GOBLIN PANDA"
        malware_family = "HttpTunnel"
    strings:
        $zw = "ZwUnmapViewOfSection"
        $temp_db = "temp.db"
        $temp_dat = "temp.dat"
    condition:
        $zw and (any of ($temp_*))
}

rule CrowdStrike_CSIT_14033_01 : t5_rat dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "T5 RAT dropper"
        reports = "CSIT-14033"
        version = "201404080000"
        last_modified = "2014-04-08"
        malware_family = "T5 RAT"
    strings:
        $error_string_1 = "[LzmaHelper] [UnCompressBuffer] UnCompressBuffer Failed." wide
        $error_string_2 = "[MemLoadLibrary] Code : %I64X"
    condition:
        all of them
}

rule CrowdStrike_CSIT_14033_02 : t5_rat rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "T5 Remote Access Tool"
        reports = "CSIT-14033"
        version = "201404080000"
        last_modified = "2014-04-08"
        malware_family = "T5 RAT"
    strings:
        $get_url = "GET http://%s:%d/images/%d.asmx?%s"
        $post_url = "POST http://%s:%d/Service.asmx/%d"
        $post_headers = "Content-Type: Appplication/octet-stream"
        $config_1 = "glp.uin" wide
        $config_2 = "Dtl.dat" wide
    condition:
        any of ($get_url, $post_*) or all of ($config_1, $config_2)
}

rule CrowdStrike_CSIT_14037_01 : rat webcache_rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "WebCache RAT"
        reports = "CSIT-14037"
        version = "202006021720"
        last_modified = "2020-06-02"
        actor = "DYNAMITE PANDA"
        malware_family = "WebCache RAT"
    strings:
        // XOR encrypted dll name
        $dllname = { 37 33 72 2E 73 72 6E 24 2C 2C 00 }
        // Export name
        $export = "GetMain"
        // XOR (key 0x30) encrypted API functions:
        // WSAStartup
        $encrypted_api_0 = "gcqcDQBDE@"
        // WSAWaitForMultipleEvents
        $encrypted_api_1 = "gcqgQYDv_B}E\\DY@\\UuFU^DC"
        // Socket
        $encrypted_api_2 = "C_S[UD"
    condition:
        $dllname and $export and 2 of ($encrypted_api_*)
}

rule CrowdStrike_CSIT_14038_01 : credential_dumper post_exploitation 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Loader for 64-bit tool to dump LSA and SAM hashes"
        reports = "CSIT-14038"
        version = "201404080000"
        last_modified = "2014-04-08"
    strings:
        $pipename = "pipetemp0"
        $pipename_enc = "oo.oCZCVoCZCVGV"
        $inj_code = { 33 c0 ac 3c 61 7c 02 2c 20 [0-1] c1 c? 0d [2-3] e2 }
    condition:
        ($pipename or $pipename_enc) and $inj_code
}

rule CrowdStrike_CSIR_14002_02 : artifact rat venomous_bear wipbot 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Wipbot ElGamal keys"
        reports = "CSIR-14002"
        version = "202002111506"
        last_modified = "2020-02-11"
        actor = "VENOMOUS BEAR"
        malware_family = "Wipbot"
    strings:
        $k_dec = { 87 52 f1 2b 2c 05 b6 21 04 45 c6 51 bb 4b 26 64 e2 53 7c 4e 03 76 89 54 31 2b a3 3f b5 48 47 2d 4f 30 73 4f e5 51 61 4b 3c 4c 1c 08 3f 6a 8d 41 7d 7e db 1d b6 33 7d 02 fe 06 43 1a 34 13 eb 67 db 4e a4 58 bc 1c fc 30 3f 74 ae 3c d1 0e dd 06 fa 6a 91 3d e4 65 05 39 85 04 5e 08 64 25 64 0b 03 09 c7 5f 8a 79 2d 68 60 23 fb 63 a6 28 a5 14 26 5e 9d 18 e2 34 73 64 b9 5a b5 66 29 5c 00 00 }
        $p_dec = { 43 fd a8 e3 72 8d 38 a3 33 df 3f ff 18 fb 44 de 36 90 82 b4 11 5f c7 36 53 97 d8 85 b9 b3 72 c0 7c 98 8f 7e 24 72 e6 cd bd 7f 92 99 4d 69 de b2 e6 c8 11 72 b0 5d 40 ca 68 be 9e 93 1d 91 10 31 03 85 7c e2 24 1d 11 d4 99 a6 f5 b5 7f 7e d8 2d 04 22 bd 90 0a f5 05 c0 9b db 86 1d e8 bd f9 90 8f 7e f2 5b 38 2d 94 14 b1 b7 c4 4e c2 47 f5 80 2f ed 98 24 dc 2a 3f a0 d5 72 9a 4f 9d e4 ed bd }
        $k_enc = { 5e 42 eb fc d6 05 6b 32 7f a9 68 40 f7 8f 1f 51 84 e3 29 c6 04 74 73 94 3d 30 94 ca e8 aa fe 67 53 73 e7 09 64 51 96 97 de 86 9f 1e 30 78 63 5d ca 19 79 4d 5c d5 8e f6 00 a9 3c 2f 98 b9 87 1c b4 01 6c d6 d1 2e b2 83 84 73 9a 07 71 86 a2 ba 8c f8 69 35 de 7f 8a 33 68 db 7b 29 7a de d8 f6 db b6 ec 4a 40 a9 a7 d6 72 a8 20 ad 37 ce f0 5b db 65 8b 9d fc 6b 48 4d 9b 5e 88 b7 37 81 8c 6e }
        $p_enc = { eb 52 05 b7 8c 4a ee 7f 12 61 2d 53 6c 66 3d e4 9a af c7 ed 12 7e 11 5f 95 eb 35 5e 6b 42 e4 ee 5a f4 55 8f cd 42 a3 41 b3 7a f9 98 78 49 f6 af 37 6f 30 23 8a e8 32 fb 1b 08 1a 25 ed 2f 30 14 7c 9f 87 90 7a 64 eb 74 b6 86 d7 34 a2 2e e4 98 cd ab b9 f7 10 6d 75 39 bc af eb 63 17 fd 14 4e fd 9a 65 3e c3 6f 4a 80 a3 2e 05 68 1a 77 f7 10 aa e1 2f 32 98 94 0f 9a 82 85 70 3e 53 25 f5 cc }
    condition:
        any of them
}

rule CrowdStrike_CSIT_14028_01 : httptunnel webshell 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects a string in the ASP control script for the HttpTunnel malware"
        reports = "CSIT-14028"
        version = "201404090000"
        last_modified = "2014-04-09"
        malware_family = "HttpTunnel"
    strings:
        $online = "Fs.OpenTextFile(Server.MapPath(\"online.txt\"),8,True)"
        $pig = "<%If Session(\"pig\") <> 1 then%>"
    condition:
        any of them
}

rule CrowdStrike_CSIT_14028_02 : exehack webshell 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Strings found in the exehack webshell. This tool appears to be openly available on the Internet so it is likely in use by actors other than GOBLIN PANDA"
        reports = "CSIT-14028"
        version = "201404090000"
        last_modified = "2014-04-09"
        malware_family = "ExeHack"
    strings:
        $pw = "ed132e13d1332bf7e2612a0eb848b30a"
        $title = "<title>CR BY: exeHack</title>"
        $copyright = "Copyright &copy; 2006-2009 CR BY: exeHack All Rights Reserved."
    condition:
        any of them
}

rule CrowdStrike_CSIT_14028_03 : goblin_panda post_exploitation 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Tool used by GOBLIN PANDA to add a user named 'f4ck' to a compromised host"
        reports = "CSIT-14028"
        version = "201404090000"
        last_modified = "2014-04-09"
    strings:
        $user = "net user f4ck" ascii wide nocase
        $group = "net localgroup administrators f4ck" ascii wide nocase
        $f_f4ck = "F4ck"
        $f_team = "F4ckTeam!@#"
    condition:
        ($user and $group) or (all of ($f*))
}

rule CrowdStrike_CSIT_14030_01 : deep_panda downloader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "DEEP PANDA PowerShell downloader script"
        reports = "CSIT-14030"
        version = "201404110000"
        last_modified = "2014-04-11"
        actor = "DEEP PANDA"
    strings:
        $pass = "KLn7m5H8rsAa42Vl"
        $salt = "0T5MrB1L"
        $crypt1 = "$rndn = Get-Random"
        $crypt2 = "$wc.Headers.Add(\"Cookie\", \"p=\" + $rndn)"
    condition:
        $pass or $salt or all of ($crypt*)
}

rule CrowdStrike_CSIT_14032_01 : goblin_panda iis_tunnel post_exploitation 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Configuration header used in tunnelling tool used by GOBLIN PANDA and potentially other actors."
        reports = "CSIT-14032"
        version = "201404150000"
        last_modified = "2014-04-15"
        actor = "GOBLIN PANDA"
        malware_family = "IIS Tunnel"
    strings:
        $header_1 = { 0a 1b 2c 3d de ad 0d 1d 2b 3b }
        $header_2 = { 0a 1a 2a 3e de ae 0e 1e 2b 3b }
    condition:
        1 of them
}

rule CrowdStrike_CSIT_14032_02 : goblin_panda iis_tunnel post_exploitation 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Strings found in tunnelling tool used by GOBLIN PANDA and potentially other actors."
        reports = "CSIT-14032"
        version = "201404150000"
        last_modified = "2014-04-15"
        actor = "GOBLIN PANDA"
        malware_family = "IIS Tunnel"
    strings:
        $kit = "Kit.exe"
        $bat = "self.bat"
        $asm = "\\asm_drivers"
        $iis = "IIS_TUNNEL_INSTALLER"
        $tl = "TunnelListen.dll"
        $tc = "TunnelConnect.dll"
        $dcom = "DcomIISService"
        $driver = "rasacd.sys"
        $driver_obj = "keymmdrv"
        $isn = "ISNCLAS"
    condition:
        3 of them
}

rule CrowdStrike_CSIT_14032_03 : goblin_panda iis_tunnel post_exploitation 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Strings found in tunnelling tool used by GOBLIN PANDA and potentially other actors."
        reports = "CSIT-14032"
        version = "201404150000"
        last_modified = "2014-04-15"
        actor = "GOBLIN PANDA"
        malware_family = "IIS Tunnel"
    strings:
        $data_base = "DATA_IIS"
        $data_error = "DATA_IIS/1/4/ERROR"
        $data_null = "DATA_IIS/1/4/NULL"
        $data_send = "SENDDATATOCONNECT"
        $data_get = "GETDATAFROMCONNECT"
        $data_ok = "DATA_IISOK"
    condition:
        3 of them
}

rule CrowdStrike_CSIT_14035_10 : shadow_crane tapaoux certificate 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Certificate used by Tapaoux malware"
        reports = "CSIT-14035"
        version = "201805110842"
        last_modified = "2018-05-11"
        actor = "SHADOW CRANE"
        malware_family = "Tapaoux"
    strings:
        $pubkey = { 30 48 02 41 00 c7 21 eb 8e 1b 7d 85 30 79 64 1f ff 7b d5 c8 22 5c e2 3d 82 ab c0 e0 a8 50 37 cb 63 04 22 97 7d 16 7f bc c2 c2 aa 4f c7 e6 bc d3 c0 ea ff f8 67 7d 79 a9 2c 75 7c 04 e4 37 f9 08 fb ef a5 16 59 02 03 01 00 01 }
    condition:
        $pubkey
}

rule CrowdStrike_CSIT_14035_11 : shadow_crane tapaoux certificate 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Certificate used by Tapaoux malware"
        reports = "CSIT-14035"
        version = "201805110841"
        last_modified = "2018-05-11"
        actor = "SHADOW CRANE"
        malware_family = "Tapaoux"
    strings:
        $pubkey = { 30 48 02 41 00 d2 80 52 89 4d eb b7 dd 56 41 56 09 71 ce 87 a0 ad 1d 27 c1 a5 e3 94 27 1b 22 f0 d5 6c 3c d5 23 df 0a 22 b9 a0 19 53 5d 85 7e ca 2a 51 4d 7d 24 c3 d0 64 0a 52 eb 84 59 f2 2e 68 c3 d8 bf 13 d1 02 03 01 00 01 }
    condition:
        $pubkey
}

rule CrowdStrike_CSIT_14035_02 : shadow_crane tapaoux rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "String from Tapaoux malware dropped using CVE-2014-0497"
        reports = "CSIT-14035"
        version = "201805110845"
        last_modified = "2018-05-11"
        actor = "SHADOW CRANE"
        malware_family = "Tapaoux"
    strings:
        $header = "[Proto]  [Local Address]  [L Port]  [Remote Address]  [R Port]  [State]"
        $lasterror = "Last-Error Code\x00"
    condition:
        any of them
}

rule CrowdStrike_CSIT_14035_04 : shadow_crane tapaoux certificate 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Certificate used by Tapaoux malware"
        reports = "CSIT-14035"
        version = "201805110844"
        last_modified = "2018-05-11"
        actor = "SHADOW CRANE"
        malware_family = "Tapaoux"
    strings:
        $pubkey = { 30 48 02 41 00 b7 92 e8 ac bd 17 b8 20 35 53 82 2a c4 c9 f8 b5 a5 c0 fc c0 43 f9 c5 79 5c 43 f4 58 22 6f c4 db c1 d2 a9 45 31 33 1e da 73 da 7b 5a ea 2e 80 eb 30 80 fc 58 1e 1e 89 b2 15 1b fc bc f2 45 4d ff 02 03 01 00 01 }
    condition:
        $pubkey
}

rule CrowdStrike_CSIT_14035_05 : shadow_crane tapaoux certificate 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Certificate used by Tapaoux malware"
        reports = "CSIT-14035"
        version = "201805110844"
        last_modified = "2018-05-11"
        actor = "SHADOW CRANE"
        malware_family = "Tapaoux"
    strings:
        $pubkey = {30 48 02 41 00 ef c9 7f d8 43 be ec 0b 05 aa 29 0d 5c 58 be ca 85 dc 1b c6 a3 f2 fc a4 2e 5b 2d 32 81 1a f2 fd 92 bd a8 21 34 31 89 c6 d6 c9 82 b3 9f 8e d2 2e a7 ff cb 71 e5 50 5b 0c 11 14 1c a7 ca 9d 05 15 02 03 01 00 01}
    condition:
        $pubkey
}

rule CrowdStrike_CSIT_14035_06 : shadow_crane tapaoux certificate 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Certificate used by Tapaoux malware"
        reports = "CSIT-14035"
        version = "201805110843"
        last_modified = "2018-05-11"
        actor = "SHADOW CRANE"
        malware_family = "Tapaoux"
    strings:
        $pubkey = { 30 48 02 41 00 ed 61 d7 12 f3 94 1a 5f d1 8b 28 35 b4 18 38 d3 32 7b 7b 79 94 79 64 3d db bd ad f2 ff 6c 61 fd 43 05 c1 f8 41 95 de 01 c2 ca 98 65 d6 9f bc 21 5c 35 76 9f ff 3a 62 88 7b 32 21 94 52 e1 46 ef 02 03 01 00 01 }
    condition:
        $pubkey
}

rule CrowdStrike_CSIT_14035_07 : certificate 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Certificate used to sign possible old version of Tapaoux malware and malicious driver"
        reports = "CSIT-14035"
        version = "201405020000"
        last_modified = "2014-05-02"
    strings:
        $pubkey = { 30 81 89 02 81 81 00 cd 25 d3 98 06 2d 91 f1 ad d7 17 32 66 0a d6 25 a0 7f ff 2e 6c 68 95 f9 92 09 a0 63 a5 80 54 22 e6 92 13 b8 67 05 3f 80 69 34 07 e4 c3 00 bc 86 f3 51 64 22 d7 ab 07 be e5 f7 e7 97 b3 3d 9f fc 10 b0 52 e7 d1 62 40 2a 18 83 b6 4d 62 e6 f5 9f fe 16 5e 41 d7 2b af 54 a7 8e af a9 08 df 39 b2 cb cf bf 52 c3 bf 04 8f a0 c0 16 89 ce 06 df 6e d9 26 8a a7 01 f8 9b 23 35 3b 4c 96 6d 4a 10 41 02 03 01 00 01 }
    condition:
        $pubkey
}

rule CrowdStrike_CSIT_14035_08 : shadow_crane tapaoux certificate 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Certificate used by Tapaoux malware. This certificate was used to sign the downloader."
        reports = "CSIT-14035"
        version = "201805110843"
        last_modified = "2018-05-11"
        actor = "SHADOW CRANE"
        malware_family = "Tapaoux"
    strings:
        $pubkey = { 30 48 02 41 00 d1 e9 78 55 9c 79 70 eb 11 d3 d5 2f c9 b0 3a 1a 81 c9 cc 6a ce f7 5e 36 11 c3 9a bd e0 06 95 6e 98 a3 7e 92 01 1d ca b2 9f 6c a1 e1 ea 50 18 09 a3 35 84 bc df 9b 9c 60 b5 a4 18 6c 0d d9 10 35 02 03 01 00 01 }
    condition:
        $pubkey
}

rule CrowdStrike_CSIT_14035_09 : shadow_crane tapaoux certificate 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Certificate used by the campaign related to Tapaoux malware. This certificate was used to sign the downloader."
        reports = "CSIT-14035"
        version = "201805110843"
        last_modified = "2018-05-11"
        actor = "SHADOW CRANE"
        malware_family = "Tapaoux"
    strings:
        $pubkey = { 30 82 01 0a 02 82 01 01 00 cd 61 4a d3 75 4d 6d 79 6a a1 ce 00 03 1c 15 fc 2d af 78 09 d0 e0 b2 2f 76 dc 25 e9 65 1b 31 6b 03 ad 02 70 dc 3c 03 21 0e a6 2f 7f c6 87 36 ba 94 10 c9 b9 02 1f b6 64 2a c2 9d e3 3d 72 c1 84 a4 06 84 80 9c 79 98 8e b7 34 0d 9d d3 9d fa ec 33 74 a1 25 cb a0 1d fc 14 0c ef 48 88 70 94 fc bd d8 30 c4 fe a6 13 07 23 a7 c0 a6 30 8b 09 b8 71 50 20 5d b1 2d c5 d7 32 68 d6 1f c1 3d 96 8e ab c7 f9 b8 b1 45 ff c1 1c c8 74 4a e5 96 26 cc 68 1d 4e 6a 9c 3e 5c 0b 5e 3b 0d fd bd 2b 46 36 48 d0 c9 b9 4e 02 b0 8d 22 45 40 69 92 95 ed b9 e3 91 0a 4d bb 81 3b 99 49 9b 59 ba 09 47 1f 15 c0 69 6f b9 07 af 55 46 e8 90 14 2f 5b 28 21 ff f8 ec b4 28 dd 36 da 1e 06 70 1a ac 52 71 34 16 4a 8e 8a 28 84 e2 a2 e3 22 64 6d 00 b1 51 b5 4a 77 03 1d fa 5d 3d ac ed ff 87 94 fe e3 c1 f6 9d 02 03 01 00 01 }
    condition:
        $pubkey
}

rule CrowdStrike_CSIT_13056_03 : njrat rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "njRAT Remote Access Tool - 2010 variant"
        reports = "CSIT-13056"
        version = "201903061100"
        last_modified = "2019-03-06"
        malware_family = "njRAT"
    strings:
        $config_start = { 2A 2A 2A 1F 8B 08 }
        $config_end   = { 5E 5E 5E }
    condition:
        // config start and end
        ($config_start and $config_end) and
        (
        for any i in (1..#config_start) : (
        $config_end in (@config_start[i]..@config_start[i]+1000)
        )
        )
        and
        // PE binary
        uint16(0) == 0x5A4D and uint32(uint32(0x3c)) == 0x4550 and
        // Mono/.NET 32bit
        ((uint16(uint32(0x3c)+24) == 0x010b and uint32(uint32(0x3c)+232) > 0) or
        // Mono/.NET 64bit
        (uint16(uint32(0x3c)+24) == 0x020b and uint32(uint32(0x3c)+248) > 0))
}

rule CrowdStrike_CSIT_14041_01 : t17_rat rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Rule to detect T17 RAT"
        reports = "CSIT-14041"
        version = "201405110000"
        last_modified = "2014-05-11"
        malware_family = "T17 RAT"
    strings:
        $query_str = "&errorlevel=information&wait=yes"
        $user_agent = "Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1; .NET CLR 1.0.4344)" wide ascii
    condition:
        all of them
}

rule CrowdStrike_CSIR_15004_01 : spicy_panda taidoor rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Taidoor RAT"
        reports = "CSIR-15004"
        version = "201807271507"
        last_modified = "2018-07-27"
        actor = "SPICY PANDA"
        malware_family = "Taidoor"
    strings:
        $s1 = "process"
        $s2 = "page"
        $s3 = "default"
        $s4 = "index"
        $s5 = "user"
        $s6 = "parse"
        $s7 = "about"
        $s8 = "security"
        $s9 = "query"
        $s10 = "login"
        $s11 = "HttpQueryInfo length failed id=%d"
        $s12 = "Second StatusCode=%d"
    condition:
        all of them
}

rule CrowdStrike_CSIT_14040_01 : putter_panda implant 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "PUTTER PANDA tool used to interact with a user's email data and to exfiltrate victim enumeration data via email"
        reports = "CSIT-14040"
        version = "201807251346"
        last_modified = "2018-07-25"
        actor = "PUTTER PANDA"
    strings:
        $key_combined_1 = { c6 45 40 44 c6 45 41 65 c6 45 42 63 c6 45 43 6f c6 45 44 64 56 c6 45 45 65 c6 45 46 20 c6 45 47 46 c6 45 48 61 c6 45 49 69 c6 45 4a 6c }
        // ebp
        $keyfrag_ebp_01 = { c6 45 ?? 44 }
        $keyfrag_ebp_02 = { c6 45 ?? 65 }
        $keyfrag_ebp_03 = { c6 45 ?? 63 }
        $keyfrag_ebp_04 = { c6 45 ?? 6f }
        $keyfrag_ebp_05 = { c6 45 ?? 64 }
        $keyfrag_ebp_06 = { c6 45 ?? 65 }
        $keyfrag_ebp_07 = { c6 45 ?? 20 }
        $keyfrag_ebp_08 = { c6 45 ?? 46 }
        $keyfrag_ebp_09 = { c6 45 ?? 61 }
        $keyfrag_ebp_10 = { c6 45 ?? 69 }
        $keyfrag_ebp_11 = { c6 45 ?? 6c }
        // Reduce FPs by checking for some common strings
        $check_outlook = "outlook.exe"
    condition:
        any of ($key_combined*) or
        (
        1 of ($check_*) and
        (
        (
        all of ($keyfrag_ebp_*) and  for any i in (1..#keyfrag_ebp_05) :
        (
        for all of ($keyfrag_ebp_*): ($ in (@keyfrag_ebp_05[i]-100..@keyfrag_ebp_05[i]+100))
        )
        )
        )
        )
}

rule CrowdStrike_CSIT_14040_02 : putter_panda implant 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "PUTTER PANDA tool used to interact with a user's email data and to exfiltrate victim enumeration data via email"
        reports = "CSIT-14040"
        version = "201405160000"
        last_modified = "2014-05-16"
        actor = "PUTTER PANDA"
    strings:
        $check_outlook = "outlook.exe"
        $problem = "Problem %s Report %s"
        $ip_note = "IPM.Note"
        $ip_dot = "IP.."
        $ip_tasl = "IP..Task"
        $ip_sticky = "IP..StickyNote"
        $ip_journal = "IP..Journal"
        $ip_contact = "IP..Contact"
        $ip_appt = "IP..Appointment"
        $ip_imap = "IP..Imap"
        $cmd_1 = "systeminfo /fo table"
        $cmd_2 = "tasklist /v"
        $cmd_3 = "ipconfig /all"
    condition:
        $check_outlook and $problem and 2 of ($cmd_*) and all of ($ip_*)
}

rule CrowdStrike_CSIT_14040_03 : putter_panda rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "PUTTER PANDA JPG RAT"
        reports = "CSIT-14040"
        version = "201405160000"
        last_modified = "2014-05-16"
        actor = "PUTTER PANDA"
    strings:
        $jpeg = "Content-type: JPEG"
        $schan = "Microsoft DH SChannel Cryptographic Provider"
        $nod = "NO DATA"
        $set = "%d SETIME SUCCESS."
    condition:
        3 of them
}

rule CrowdStrike_CSIT_14040_04 : putter_panda dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "PUTTER PANDA WinWord dropper"
        reports = "CSIT-14040"
        version = "201405160000"
        last_modified = "2014-05-16"
        actor = "PUTTER PANDA"
    strings:
        $mcupdate = "McUpdate" wide
        $regset = "SHRegSetUSValueW"
        $winword = "winword.exe" wide
        $dat = "DAT" wide
    condition:
        all of them
}

rule CrowdStrike_CSIT_14066_01 : windows_credential_editor post_exploitation credential_theft 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Windows Credential Editor post-exploitation tool"
        reports = "CSIT-14066"
        version = "201405160000"
        last_modified = "2014-05-16"
        malware_family = "Windows Credential Editor"
    strings:
        $help_string = "WCE %s (Windows Credentials Editor)"
        $copyright = "Amplia Security"
        $error = "Error: cannot open wce_krbtkts"
    condition:
        all of them
}

rule CrowdStrike_CSIT_14066_02 : windows_credential_editor post_exploitation credential_theft 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Windows Credential Editor post-exploitation tool - injected DLL"
        reports = "CSIT-14066"
        version = "201405160000"
        last_modified = "2014-05-16"
        malware_family = "Windows Credential Editor"
    strings:
        $name = "wceaux.dll"
        $import = "0212DBDHJKSAHD0183923kljmLKL"
    condition:
        all of them
}

rule CrowdStrike_CSIT_14047_02 : pitty_panda pittytiger installer 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "PittyTiger RAT installer"
        reports = "CSIT-14047"
        version = "201807271513"
        last_modified = "2018-07-27"
        actor = "PITTY PANDA"
        malware_family = "PittyTiger"
    strings:
        // Match the payload DLL decryption loop
        //.text:00401706 80 3D 08 40 40 00 4D cmp gEmbeddedDll, 'M'
        //.text:0040170D B8 08 40 40 00 mov eax, offset gEmbeddedDll
        //.text:00401712 B9 61 00 00 00 mov ecx, 61h
        //.text:00401717 74 1D jz short locret_401736
        //.text:00401719 8D A4 24 00 00 00 00 lea esp, [esp+0]
        //.text:00401720 69 C9 FD 65 02 00 imul ecx, 265FDh
        //.text:00401726 81 C1 27 69 02 00 add ecx, 26927h
        $s1 = { 80 ?? ?? ?? ?? ?? 4d b8 ?? ?? ?? ?? b9 61 00 00 00 74 1d 8d a4 24 00 00 00 00 69 c9 fd 65 02 00 81 c1 27 69 02 00 }
    condition:
        all of them
}

rule CrowdStrike_CSIT_14047_01 : pitty_panda pittytiger rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "PittyTiger RAT"
        reports = "CSIT-14047"
        version = "201807271513"
        last_modified = "2018-07-27"
        actor = "PITTY PANDA"
        malware_family = "PittyTiger"
    strings:
        $s01 = "ocmd" wide
        $s02 = "ccmd" wide
        $s03 = "cfg" wide
        $s14 = "Login" wide
        $s15 = "->C:%s" wide
        $s16 = "->U:%s" wide
        $s17 = "put file ok %u bytes." wide
    condition:
        all of them
}

rule CrowdStrike_CSIT_14047_03 : pitty_panda pittytiger downloader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "PittyTiger RAT downloader"
        reports = "CSIT-14047"
        version = "201807271513"
        last_modified = "2018-07-27"
        actor = "PITTY PANDA"
        malware_family = "PittyTiger"
    strings:
        $srvinfo = "--------------Server Info-------------------"
        $sftinfo = "--------------Soft Info-------------------"
        $ipcfg = "--------------IP Config-------------------"
        $pproc = "------------------------- Ports & Proc -------------------------"
        $s00 = "regrun ok!"
        $s01 = "can't init api"
        $s02 = "\x0d\x0acan't copy file to appdata.%d"
        $s03 = "aleady in appdata path."
        $s04 = "can't get moudule file name"
        $s05 = "can't find EnvironmentVariable"
        $err1 = "can't copy file to appdata.%d"
        $s06 = "CreateProcess Error ( %d:%s )"
        $s07 = "CreateProcess Success!"
        $s08 = "can't open mmfile %s.%d."
        $s10 = "%-20s :%-5s %-16s %5d %-s"
        $s11 = "%-4d UDP %-20s :%-5d"
        $s12 = "%-20s :%-5d %-16s %5d %-s"
        $s13 = "%-4d TCP %-20s :%-5d"
    condition:
        6 of them
}

rule CrowdStrike_CSIT_15052_01 : gh0st rat wiper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Gh0st RAT version that wipes MBR"
        reports = "CSIT-15052"
        version = "201405210000"
        last_modified = "2014-05-21"
        malware_family = "Gh0st"
    strings:
        $kill = "Game Over!Good luck!"
        $rev1 = "noitacilppA"
        $rev2 = "ytiruceS"
        $api1 = "0egCreateKeyA"
        $api2 = "0riteProcessMemory"
    condition:
        3 of them
}

rule CrowdStrike_CSIT_15052_02 : gh0st rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Gh0st RAT generic detection"
        reports = "CSIT-15052"
        version = "201904231249"
        last_modified = "2019-04-23"
        malware_family = "Gh0st"
    strings:
        $reg1 = "%-24s %-15s %s"
        $reg2 = "%-24s %-15s 0x%x(%d)"
        $cmd = "%s\\SHELL\\OPEN\\COMMAND"
        $win = "winsta0"
        $user = "Mozilla/4.0 (compatible)"
        $proc = "HARDWARE\\DESCRIPTION\\System\\CentralProcessor\\"
    condition:
        all of them
}

rule CrowdStrike_CSIT_15052_03 : credential_dumper post_exploitation 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Hash 0.99 password dumper"
        reports = "CSIT-15052"
        version = "201405210000"
        last_modified = "2014-05-21"
    strings:
        $change = "Change Credentials OK!"
        $del = "Delete Credentials OK!"
        $lm = "LM Hash:" wide
        $nt = "NT Hash:" wide
        $sha = "SHA Hash:" wide
        $pass = "Password:" wide
    condition:
        all of them
}

rule CrowdStrike_CSIT_14042_01 : winresdl rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "WinResDL RAT"
        reports = "CSIT-14042"
        version = "201405260000"
        last_modified = "2014-05-26"
    strings:
        // Export names
        $export_0 = "AppMain"
        $export_1 = "ServiceMain"
        // Key transformation algorithm fragment
        $key_transform = { 8B C6 6A 03 99 5F F7 FF 02 91 }
        // Update file prefix
        $update_prefix = "_ISTMP"
    condition:
        all of them
}

rule CrowdStrike_CSIT_14045_02 : charming_kitten parastoo dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Parastoo IRC bot dropper"
        reports = "CSIT-14045"
        version = "201405300000"
        last_modified = "2014-05-30"
        actor = "CHARMING KITTEN"
        malware_family = "Parastoo"
    strings:
        $magic = "SPELL-INCANTATION-MAGIC-CHARM-WIZARDRY" ascii wide
    condition:
        any of them
}

rule CrowdStrike_CSIT_14045_01 : bot charming_kitten parastoo 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Parastoo IRC bot"
        reports = "CSIT-14045"
        version = "201908122145"
        last_modified = "2019-08-12"
        actor = "CHARMING KITTEN"
        malware_family = "Parastoo"
    strings:
        $test = "Gsv ovmtgs lu Xnw ivhfog urov rh aril!"
        $test2 = "%s %s : Hi,my name is %s%s"
        $mutex = "zuLmvXlkbNfgvc"
    condition:
        any of them
}

rule CrowdStrike_CSIR_14010_01 : gothic_panda pirpi rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Pirpi RAT Operating System check"
        reports = "CSIR-14010"
        version = "201406140000"
        last_modified = "2014-06-14"
        actor = "GOTHIC PANDA"
        malware_family = "Pirpi"
    strings:
        $return_nt = { b8 54 4e 00 00 81 c4 94 00 00 00 c3 }
        $return_xp = { b8 50 58 00 00 81 c4 94 00 00 00 c3 }
    condition:
        any of them
}

rule CrowdStrike_CSIR_14006_01 : pitty_panda pitty_enfal enfal rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "PittyEnfal RAT - Enfal variant used by PITTY PANDA"
        reports = "CSIR-14006"
        version = "201807271510"
        last_modified = "2018-07-27"
        actor = "PITTY PANDA"
        malware_family = "Enfal"
    strings:
        $s1 = "CmDsHell.sec"
        $s2 = "LoginedQueryTimer"
        $s3 = "IpAddress=%d.%d.%d.%d"
        $s4 = "%s%s%02X-%02X-%02X-%02X-%02X-%02X"
        $s5 = "Command.com"
        $s6 = "OsVersion=%s"
        $s7 = "Logined=%c"
        $s8 = "Version=%s"
        $s9 = "MainFilename=%s"
    condition:
        all of them
}

rule CrowdStrike_CSIR_14006_02 : pitty_panda pitty_gh0st gh0st rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "PittyGh0st RAT - Gh0st variant used by PITTY PANDA"
        reports = "CSIR-14006"
        version = "201807271509"
        last_modified = "2018-07-27"
        actor = "PITTY PANDA"
        malware_family = "Gh0st"
    strings:
        // Pushes 'Global\\Gh0st %d' on the stack
        $mutexname = {
        C7 85 50 FE FF FF 47 6C 6F 62
        C7 85 54 FE FF FF 61 6C 5C 47
        C7 85 58 FE FF FF 68 30 73 74
        C7 85 5C FE FF FF 20 25 64 00
        }
        // Part of the config decryption loop
        $cfgDecrLoop = { B0 58 33 C9 B2 0D F6 EA 8A 91 2C A2 00 10 04 63 32 D0 88 91 2C A2 00 10 }
    condition:
        any of them
}

rule CrowdStrike_CSIR_14006_03 : pitty_panda pitty_gh0st gh0st dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "PittyGh0st RAT dropper"
        reports = "CSIR-14006"
        version = "201807271510"
        last_modified = "2018-07-27"
        actor = "PITTY PANDA"
        malware_family = "Gh0st"
    strings:
        $s1 = "netsvcs_0x%d"    ascii
        $s2 = "ServiceDll"      ascii
        $s3 = "SYSTEM\\CurrentControlSet\\Services\\"   ascii
        $s4 = "%s\\%sex.dll"    ascii
        $s5 = "system\\CurrentControlSet\\Services\\%s" ascii
        $s6 = "[Unknown Module]"    ascii
    condition:
        all of them
}

rule CrowdStrike_CSIR_14004_05 : lotus_panda elise rat installer 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Elise installer"
        reports = "CSIR-14004,CSIR-14011"
        version = "201406200000"
        last_modified = "2014-06-20"
        actor = "LOTUS PANDA"
        malware_family = "Elise"
    strings:
        $elise = "SetElise.pdb"
        $decryption_code = {25 7F 00 00 80 79 05 48 83 C8 80 40 30 [1-5] 4? }
    condition:
        $elise and $decryption_code
}

rule CrowdStrike_CSIR_14004_06 : lotus_panda elise rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Elise RAT"
        reports = "CSIR-14004,CSIR-14011"
        version = "201807301124"
        last_modified = "2018-07-30"
        actor = "LOTUS PANDA"
        malware_family = "Elise"
    strings:
        $elise = "EliseDLL.dll"
        $export_1 = "ESEntry"
        $export_2 = "ESHandle"
        $url = "/%x/archive/%02d%02d%02d%02d.html" wide
        $log = "0x01, first info."
    condition:
        3 of them
}

rule CrowdStrike_CSIR_14004_04 : lotus_panda elise rat installer 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Elise installer"
        reports = "CSIR-14004,CSIR-14011"
        version = "201807300841"
        last_modified = "2018-07-30"
        actor = "LOTUS PANDA"
        malware_family = "Elise"
    strings:
        $elise = "EliseInstall" wide
        $decryption_code = {25 7F 00 00 80 79 05 48 83 C8 80 40 30 [1-5] 4? }
    condition:
        $elise and $decryption_code
}

rule CrowdStrike_CSIR_14004_01 : lotus_panda elise rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Generic rule over config decryption function used by Elise"
        reports = "CSIR-14004,CSIR-14011"
        version = "201807300838"
        last_modified = "2018-07-30"
        actor = "LOTUS PANDA"
        malware_family = "Elise"
    strings:
        // and eax, 8000007F; jns <Addr>; dec eax; or eax, ffffff80; inc eax; xor [esi], al; inc edi
        $decryption_code = {25 7F 00 00 80 79 05 48 83 C8 80 40 30 [1-5] 4? }
    condition:
        all of them
}

rule CrowdStrike_CSIR_14004_07 : lotus_panda rat artifact 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Artifacts used by LOTUS PANDA malware"
        reports = "CSIR-14004,CSIR-14011"
        version = "201807300839"
        last_modified = "2018-07-30"
        actor = "LOTUS PANDA"
    strings:
        $pdb = "KSSTCreator.pdb"
        $decryption_code = { 25 7f 00 00 80 79 05 48 83 c8 80 40 30 [1-5] 4? }
    condition:
        $pdb and $decryption_code
}

rule CrowdStrike_CSIR_14004_02 : lotus_panda elise rat installer 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Elise Installer/Mounter"
        reports = "CSIR-14004,CSIR-14011"
        version = "201807300840"
        last_modified = "2018-07-30"
        actor = "LOTUS PANDA"
        malware_family = "Elise"
    strings:
        $pdb = "STMounter.pdb"
        $b = "Install finish"
    condition:
        all of them
}

rule CrowdStrike_CSIR_14004_03 : lotus_panda rat artifact 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Artifacts used by LOTUS PANDA malware"
        reports = "CSIR-14004,CSIR-14011"
        version = "201807300840"
        last_modified = "2018-07-30"
        actor = "LOTUS PANDA"
    strings:
        $export_1 = "ServiceMain"
        $export_2 = "ZwFuncEntry"
        $pdb = "ZCSTEntity.pdb"
        $a = "h7834hogus78"
    condition:
        ($export_1 or $export_2) and 1 of ($pdb, $a)
}

rule CrowdStrike_CSIT_14051_01 : hkmjj post_exploitation 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Post-exploitation tool to add user accounts to compromised machines"
        reports = "CSIT-14051"
        version = "201406240000"
        last_modified = "2014-06-24"
        malware_family = "hkmjj"
    strings:
        $hkmujj_co_cc = { 2d 2d 2d 2d 2d 2d 2d 2d 2d 2d 2d 2d 2d be b4 c7 eb c6 da b4 fd d0 c2 b0 e6 b1 be 48 54 54 50 3a 2f 2f 68 6b 6d 75 6a 6a 2e 63 6f 2e 63 63 2d 2d 2d 2d 2d 2d 2d 2d 0a 00 }
        $hkmujj_com = { 2d 2d 2d 2d 2d 2d 2d 2d 2d 2d 2d 2d 2d be b4 c7 eb c6 da b4 fd d0 c2 b0 e6 b1 be 48 54 54 50 3a 2f 2f 77 77 77 2e 68 6b 6d 6a 6a 2e 63 6f 6d 2d 2d 2d 2d 2d 2d 2d 0a 00 }
        $ver_1 = { 2d 2d 2d 2d 2d 2d a1 aa a1 aa a1 aa a1 aa 2d c9 d9 c1 fa cd f8 c2 e7 b8 c4 b0 e6 c8 a8 d6 ae 20 56 31 2e 30 2d 2d 2d 2d 2d 2d 2d 2d 2d 2d 2d 2d 2d 2d 2d 2d 2d 2d 2d 2d 2d 00 }
        $ver_vc6 = { 2d 2d 2d 2d 2d 2d a1 aa a1 aa a1 aa a1 aa 2d c9 b3 c4 ae d6 ae d3 a5 b1 e0 d2 eb 28 56 43 36 2e 30 29 20 56 31 2e 30 2d 2d 2d 2d 2d 2d 2d 2d 2d 2d 2d 2d 2d 2d 2d 2d 2d 2d 00 }
    condition:
        any of them
}

rule CrowdStrike_CSIT_14051_02 : post_exploitation exploit cve_2006_5758 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Post-exploitation used to exploit CVE-2006-5758"
        reports = "CSIT-14051"
        version = "201406240000"
        last_modified = "2014-06-24"
    strings:
        $coded = "Coded by Ivanlef0u, shadow3 modified"
        $cn_os = "windows 2000 sp4 Chinese (before MS07-017)"
        $zwvdm = "ZwVdmControl -> My Shellcode, modifiable KiServiceTable"
        $call = "call shellcode ... "
        $find = "Find GdiTableEntry ... "
        $ok = { 6f 6b 21 21 21 0a 4b 69 53 65 72 76 69 63 65 54 61 62 6c 65 20 3d 3d 20 25 30 38 58 0a 00 }
    condition:
        3 of them
}

rule CrowdStrike_CSIT_14051_03 : post_exploitation exploit cve_2011_1249 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Post-exploitation tool exploiting CVE-2011-1249 to add an administrative account on a compromised machine"
        reports = "CSIT-14051"
        version = "201406240000"
        last_modified = "2014-06-24"
    strings:
        $pdb = "d:\\codespace\\powerock\\exp\\afdpre\\bin\\afdpre.pdb"
        $pass = "GuiWAng!@#9bd*" ascii wide
        $usage = "-a                  add user(admin$/GuiWAng!@#9bd*) to admin"
        $err_gethaltable = "[ERR]  get haltable addresss fail"
        $err_getzw  = "[ERR]  get ZwDeviceIoControlFile fail"
        $err_native = "[ERR]  get native function pointers fail"
    condition:
        all of ($err_*) or $pass or $usage or $pdb
}

rule CrowdStrike_CSIT_14051_04 : post_exploitation exploit cve_2011_1249 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Post-exploitation tool to add a user by exploiting CVE-2011-1249"
        reports = "CSIT-14051"
        version = "201406240000"
        last_modified = "2014-06-24"
    strings:
        $willweiwei_1 = { d5 cb ba c5 77 69 6c 6c 77 65 69 77 65 69 cc ed bc d3 b5 bd 61 64 6d 69 6e 69 73 74 72 61 74 6f 72 b3 c9 b9 a6 a3 a1 0a 00 }
        $willweiwei_2 = { d5 cb ba c5 77 69 6c 6c 77 65 69 77 65 69 20 c3 dc c2 eb 74 30 30 6c 73 20 cc ed bc d3 b3 c9 b9 a6 a3 a1 0a 00 }
    condition:
        any of them
}

rule CrowdStrike_CSIT_14051_05 : post_exploitation credential_dumper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Post-exploitation tool used to dump credentials stored in memory from the LSASS process to retrieve plaintext credentials in a similar manner to Mimikatz"
        reports = "CSIT-14051"
        version = "201406240000"
        last_modified = "2014-06-24"
    strings:
        $viewall = "/ViewAll" wide
        $unable = "* Unable To Get Message *" wide
        $kerb = "No Kerb Function Found" wide
        $tspkg = "No TSPKG Function Found" wide
        $fail = "Fail To Search LSASS Data" wide
    condition:
        2 of them
}

rule CrowdStrike_CSIT_14051_06 : post_exploitation exploit cve_2010_2554 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Post-exploitation tool making use of the Chimichurri token kidnapping exploit patched in MS10-059"
        reports = "CSIT-14051"
        version = "201406240000"
        last_modified = "2014-06-24"
    strings:
        $iis7_01 = "[IIS7Up]-->Could not connect to %s"
        $iis7_02 = "[IIS7Up]-->Couldn't create pipe"
        $iis7_03 = "[IIS7Up]-->Error impersonating pipe"
        $iis7_04 = "[IIS7Up]-->Couldn't get token"
        $iis7_05 = "[IIS7Up]-->Got SYSTEM token..."
        $iis7_06 = "[IIS7Up]-->Command: %s"
        $iis7_07 = "[IIS7Up]-->This exploit gives you a Local System shell "
        $iis7_08 = "[IIS7Up]-->Usage: iis7up.exe \"command\" "
        $iis7_09 = "[IIS7Up]-->No command,use WHOAMI "
        $iis7_10 = "[IIS7Up]-->Changing registry values..."
        $iis7_11 = "[IIS7Up]-->Couldn't set registry values"
        $iis7_12 = "[IIS7Up]-->Restoring default registry values..."
    condition:
        4 of ($iis7_*)
}

rule CrowdStrike_CSIT_14051_07 : post_exploitation exploit cve_2010_2554 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Post-exploitation tool used to exploit the Churraskito token kidnapping flaw, partially addressed in MS10-059"
        reports = "CSIT-14051"
        version = "201406240000"
        last_modified = "2014-06-24"
    strings:
        $pdb = { 64 3a 5c 70 72 6f 6a 65 63 74 5c e6 8f 90 e6 9d 83 e5 a4 a7 e6 9d 80 e5 99 a8 5c e6 ba 90 e7 a0 81 5c 53 6f 75 72 63 65 5c 43 68 75 72 72 61 73 6b 69 74 6f 5c 52 65 6c 65 61 73 65 5c 43 68 75 72 72 61 73 6b 69 74 6f 2e 70 64 62 00 }
        $shell = "/Churraskito/-->This exploit gives you a Local System shell"
    condition:
        all of them
}

rule CrowdStrike_CSIT_14051_08 : post_exploitation exploit cve_2010_1897 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Post-exploitation tool to probably exploit CVE-2010-1897 addressed in MS10-0489"
        reports = "CSIT-14051"
        version = "201406240000"
        last_modified = "2014-06-24"
    strings:
        $exp_string = { 7e 20 4d 53 31 30 5f 30 34 38 20 58 36 34 20 45 58 50 20 20 20 20 20 20 20 20 7e 0a 0a 00 }
        $need_girl =  { 4e 65 65 64 20 61 20 67 69 72 6c 20 74 6f 20 6c 6f 76 65 20 20 20 51 51 20 36 35 36 36 35 36 35 31 20 65 6d 61 69 6c 20 6d 61 73 74 65 72 23 68 34 63 6b 65 72 2e 75 73 20 }
        $half_shell = "[ ] Spawning half a shell..."
    condition:
        all of them
}

rule CrowdStrike_CSIT_14052_01 : webshell 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "DirListing_WebShell_fso"
        reports = "CSIT-14052"
        version = "201406240000"
        last_modified = "2014-06-24"
    strings:
        // Creates a filesystem object
        $fso = "Set Fso=server.createobject(\"scr\"&\"ipt\"&\"ing\"&\".\"&\"fil\"&\"esy\"&\"ste\"&\"mob\"&\"jec\"&\"t\")"
        $func1 = "CheckDirIsOKWrite"
        $func2 = "CheckDirIsOKDel"
        $func3 = "Bianli"
    condition:
        all of them
}

rule CrowdStrike_CSIR_14009_01 : deep_panda madhatter rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detection of .NET MadHatter RAT used by DEEP PANDA"
        reports = "CSIR-14009"
        version = "201407010000"
        last_modified = "2014-07-01"
        actor = "DEEP PANDA"
        malware_family = "MadHatter"
    strings:
        $marker1 = "alice'srabbithole" wide
        $marker2 = "{{\"Version\":{0},\"HostName\":\"{1}\",\"osVersion\":\"{2}\",\"tm\":\"{3}\",\"tz\":{4}}}" wide
        $marker3 = "InstManager.pdb"
        $marker4 = "<osVersion>"
        $tmarker5 = "<tm>"
        $tmarker6 = "<tz>"
        $marker7 = "WMITool" nocase wide ascii
        $marker8 = "binbuck" nocase wide ascii
        $xor_decode = {11 0? 11 0? [8-11] 20 AA 00 00 00 61 [3-8] 11 0? ?? 58 13}
    condition:
        (2 of ($marker*) or $xor_decode or (1 of ($tmarker*) and 1 of ($marker*)))
}

rule CrowdStrike_CSIR_14009_02 : deep_panda webshell 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "China Chopper webshell"
        reports = "CSIR-14009"
        version = "201905281839"
        last_modified = "2019-05-28"
        actor = "DEEP PANDA"
        malware_family = "China Chopper"
    strings:
        $exec_asp = "<%execute request" nocase
        $exec_asp2 = "<%eval request(" nocase
        $exec_aspx = "<%@ Page Language=\"Jscript\"%><%eval(Request.Item[" nocase
        $exec_php = "<?php @eval($_POST[" nocase
    condition:
        any of them and filesize < 150
}

rule CrowdStrike_CSIT_14056_01 : vba office credstealer 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detection for simple malicious VBA scripts similar to those documented in CSIT-14056"
        reports = "CSIT-14056"
        version = "201407140000"
        last_modified = "2014-07-14"
    strings:
        $str1 = "uploadPOST"
        $str2 = "URLDownloadToFile"
        $str3 = "reporter.php?msg="
        $str4 = "&uname="
        $str5 = "&pword="
        $str6 = "Technically could be run against remote computers, if allowed"
    condition:
        2 of them
}

rule CrowdStrike_CSIT_14055_02 : plugx loader shellcode 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detection for some versions of PlugX to detect obfuscated shellcode files loaded by malicious DLLs"
        reports = "CSIT-14055"
        version = "201807301233"
        last_modified = "2018-07-30"
        malware_family = "PlugX"
    strings:
        $jump = { e9 01 00 00 00 }
        $jump_alt_ono   = { 71 03 70 01 }
        $jump_alt_abe   = { 76 03 77 01 }
        $jump_alt_sns   = { 79 03 78 01 }
        $jump_alt_pnp   = { 7a 03 7b 01 }
        $jump_alt_leg   = { 7f 03 7e 01 }
    condition:
        filesize > 50000 and
        for all i in (1,2,3,4,5):(@jump[i] < 0x100) and
        4 of ($jump_alt_*)
}

rule CrowdStrike_CSIT_14063_01 : houdini rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Houdini RAT"
        reports = "CSIT-14063"
        version = "201905152312"
        last_modified = "2019-05-15"
        malware_family = "Houdini"
    strings:
        // Characteristic code fragments
        $copyright = "recoder : houdini (c) skype : houdini-fx" ascii wide
        $comment1 = "'=-=-=-=-= config =-=-=-=-=-=-=-=-=-=-=-=-=-=" ascii wide
        $comment2 = "'=-=-=-=-= privat var =-=-=-=-=-=-=-=-=-=-=-=" ascii wide
        $comment3 = "'=-=-=-=-= code start =-=-=-=-=-=-=-=-=-=-=-=" ascii wide
        $code = "response = post (\"is-ready\",\"\")" ascii wide
    condition:
        any of them
}

rule CrowdStrike_CSIT_14058_01 : dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Dropper for various RATs including 9002, PlugX, and PoisonIvy"
        reports = "CSIT-14058"
        version = "201807300907"
        last_modified = "2018-07-30"
    strings:
        $rsrcname1 = "DVCLAL" wide
        $rsrcname2 = "PACKAGEINFO" wide
        $delphipath = "SOFTWARE\\Borland\\Delphi\\RTL"
        $loadrsrc = { 53 56 57 8b fa 33 f6 6a  0a 50 a1 ?? ?? ?? ?? 50 e8 ?? ?? ?? ?? 8b d8 85  db 74 1c 53 a1 ?? ?? ?? ?? 50 e8 ?? ?? ?? ?? 89 07 53 a1 ?? ?? ?? ?? 50 e8 ?? ?? ?? ?? 8b f0 8b c6 5f 5e 5b c3 }
    condition:
        all of them
}

rule CrowdStrike_CSIT_14058_02 : poisonivy shellcode 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "PoisonIvy Shellcode"
        reports = "CSIT-14058"
        version = "201807251347"
        last_modified = "2018-07-25"
        malware_family = "PoisonIvy"
    strings:
        $call = { e8 bb 1b 00 00 }
        $pop = { 83 c2 01 83 e9 01 83 f9 00 75 f2 ff d0 c2 00 00 }
    condition:
        all of them and
        for any i in (1..#call) :
        ( for 1 j in (1..#pop):
        ( @call[i] + 0x1bcb == @pop[j] )
        )
}

rule CrowdStrike_CSIT_14064_01 : rat smacdown 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "SmacDown RAT"
        reports = "CSIT-14064"
        version = "201911141558"
        last_modified = "2019-11-14"
        malware_family = "SmacDown"
    strings:
        $fail = "Execute failed!"       ascii wide
        $success1 = "Execute success!"  ascii wide
        $success2 = "Execute success]"  ascii wide
        $sres = "sres=%s"               ascii wide
        $mac = "smac="                  ascii wide
        $down = "x-Down("               ascii wide
        $downonly = "x-DownOnly("       ascii wide
        $exec = "x-Exec("               ascii wide
        $delay = "x-Delay("             ascii wide
        $pdb1 = "D:\\P\\win\\Release\\win.pdb"  ascii
        $pdb2 = "D:\\P\\win\\Release\\s4.pdb"  ascii
    condition:
        (uint16(0) == 0x5a4d and uint32(uint32(0x3c)) == 0x00004550) and
        4 of them
}

rule CrowdStrike_CSIR_14005_01 : energetic_bear delivery_document 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Rule detects encoded ENERGETIC BEAR strings using a single-byte xor of 0x04. These strings are likely to be found in malicious ENERGETIC BEAR documents."
        reports = "CSIR-14005"
        version = "201407290000"
        last_modified = "2014-07-29"
        actor = "ENERGETIC BEAR"
    strings:
        $meminj = { 45 52 53 76 6D 70 61 49 61 69 4D 6A 6E 61 67 70 6B 76 }
        $remote = { 45 52 56 61 69 6B 70 61 50 6C 76 61 65 60 }
        $cc = { 45 52 47 6B 69 69 65 6A 60 47 6B 6A 70 76 6B 68 68 61 76 }
    condition:
        2 of them
}

rule CrowdStrike_CSIR_14005_02 : energetic_bear delivery_document 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Rule detects encoded ENERGETIC BEAR strings using a single-byte xor of 0x04. These strings are likely to be found in malicious ENERGETIC BEAR documents."
        reports = "CSIR-14005"
        version = "201407290000"
        last_modified = "2014-07-29"
        actor = "ENERGETIC BEAR"
    strings:
        $_pipe0 = { 58 04 58 04 2A 04 58 04 74 04 6D 04 74 04 61 04 58 04 69 04 7D 04 74 04 6D 04 74 04 61 04 29 }
        $_pipe1 = { 58 04 58 04 2A 04 58 04 74 04 6D 04 74 04 61 04 58 04 69 04 7D 04 74 04 7D 04 74 04 61 04 29 }
    condition:
        any of them
}

rule CrowdStrike_CSIR_14005_03 : energetic_bear delivery_document 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Rule detects encoded ENERGETIC BEAR strings using a single-byte xor of 0x04. These strings are likely to be found in malicious ENERGETIC BEAR documents."
        reports = "CSIR-14005"
        version = "201407290000"
        last_modified = "2014-07-29"
        actor = "ENERGETIC BEAR"
    strings:
        $regpath = { 57 04 6B 04 62 04 70 04 73 04 65 04 76 04 61 04 58 04 49 04 6D 04 67 04 76 04 6B 04 77 04 6B 04 62 04 70 04 58 04 4D 04 6A 04 70 04 61 04 76 04 6A 04 61 04 70 04 24 04 41 04 7C 04 74 04 68 04 6B 04 76 04 61 04 76 04 58 04 4D 04 6A 04 70 04 61 04 76 04 6A 04 61 04 70 04 56 04 61 04 63 04 6D 04 77 04 70 04 76 04 7D 04 58 04 4B 04 74 04 70 04 6D 04 6B 04 6A 04 77 }
    condition:
        $regpath
}

rule CrowdStrike_CSIR_14005_04 : energetic_bear delivery_document 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Rule detects encoded ENERGETIC BEAR strings using a single-byte xor of 0x04. These strings are likely to be found in malicious ENERGETIC BEAR documents."
        reports = "CSIR-14005"
        version = "201407290000"
        last_modified = "2014-07-29"
        actor = "ENERGETIC BEAR"
    strings:
        $key = { 49 04 50 04 49 04 7C 04 49 04 6E 04 49 04 7C 04 49 04 63 04 39 04 39 }
    condition:
        $key
}

rule CrowdStrike_CSIR_14005_05 : energetic_bear xaml_rat rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Rule detects strings present in the ENERGETIC BEAR XAML RAT"
        reports = "CSIR-14005"
        version = "201407290000"
        last_modified = "2014-07-29"
        actor = "ENERGETIC BEAR"
        malware_family = "XAML RAT"
    strings:
        $comms_ua = "User-Agent: Mozilla/5.0 (Windows; U; Windows NT 6.0; en-US) AppleWebKit/534.3 (KHTML, like Gecko) Chrome/6.0.472.59 Safari/534.3" ascii wide
        $comms_accept   = "Accept: text/xml\\r\\nContent-Type: application/x-www-form-urlencoded\\r\\nAccept-Encoding: no\\r\\nConnection: Keep-Alive" ascii wide
        $comms_format   = "%s/?t=%s&o=%s&i=%s&task_id=%s" ascii wide
        $tag_empty      = "<XAML></XAML>"
        $tag_b6         = "<B6>"
        $tag_i6         = "<I6>"
    condition:
        2 of ($comms_*) and 2 of ($tag_*)
}

rule CrowdStrike_CSIR_14005_06 : energeticbear xaml_rat dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Rule detects routines present in a dropper used for the ENERGETIC BEAR XAML RAT"
        reports = "CSIR-14005"
        version = "201407290000"
        last_modified = "2014-07-29"
        actor = "ENERGETIC BEAR"
        malware_family = "XAML RAT"
    strings:
        $ror_api_loop   =   { 50 6B C0 00 C1 CF 13 AC 03 F8 85 C0 58 75 F1 3B FB 75 E4 }
        $xor_loop_1     =   { 8B 4D 08 03 C8 80 31 0D 40 3B 45 0C 72 F2 }
        $xor_loop_2     =   { 80 37 0D FF 45 0C 81 7D 0C FF 03 00 00 77 09 8B 4D 14 49 39 4D 08 75 2C }
    condition:
        2 of them
}

rule CrowdStrike_CSIR_14005_07 : energetic_bear xaml_rat installer 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Rule detects strings present in a loader used for the ENERGETIC BEAR XAML RAT"
        reports = "CSIR-14005"
        version = "201407290000"
        last_modified = "2014-07-29"
        actor = "ENERGETIC BEAR"
        malware_family = "XAML RAT"
    strings:
        $dll_name   = "~tmppnet.dll" wide
        $print      = "print"
        $exe        = "ddex.exe" wide
    condition:
        all of them
}

rule CrowdStrike_CSIR_14005_08 : energetic_bear xaml_rat installer 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Rule detects a PDB string present in a loader used for the ENERGETIC BEAR XAML RAT"
        reports = "CSIR-14005"
        version = "201407290000"
        last_modified = "2014-07-29"
        actor = "ENERGETIC BEAR"
        malware_family = "XAML RAT"
    strings:
        $pdb_base = "E:\\1510prj\\"
    condition:
        any of them
}

rule CrowdStrike_CSIR_14005_09 : energetic_bear memcat rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Rule detects strings present in the ENERGETIC BEAR Memcat RAT"
        reports = "CSIR-14005"
        version = "201407290000"
        last_modified = "2014-07-29"
        actor = "ENERGETIC BEAR"
        malware_family = "Memcat RAT"
    strings:
        $api_hash = { 8A 08 84 C9 74 0D 80 C9 60 01 CB C1 E3 01 03 45 10 EB ED }
        $http_push = "X-mode: push"
        $http_pop  = "X-mode: pop"
    condition:
        any of them
}

rule CrowdStrike_CSIR_14005_10 : energetic_bear installer 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Rule detects strings present in loader in use by ENERGETIC BEAR, used primarily for second-stage tools"
        reports = "CSIR-14005"
        version = "201407290000"
        last_modified = "2014-07-29"
        actor = "ENERGETIC BEAR"
    strings:
        $sleeploop = { 6A 64 FF D6 EB FA }
        $tmpdllname1 = /tmp[0-9]{4,7}\.dll/
        $tmpdllname2 = /tmpBD[0-9]{4,7}\.dll/
    condition:
        2 of them
}

rule CrowdStrike_CSIR_14005_11 : energetic_bear tasking 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Rule detects second stage OPC scanning tool deployed by ENERGETIC BEAR"
        reports = "CSIR-14005"
        version = "201407290000"
        last_modified = "2014-07-29"
        actor = "ENERGETIC BEAR"
    strings:
        $start      = "Programm was started at %02i:%02i:%02i"
        $fing_lan   = "Start finging of LAN hosts" wide
        $unexpect   = "Finding was fault. Unexpective error" wide
        $opc_1      = "Start finging of OPC Servers" wide
        $opc_2      = "Was found %i OPC Servers" wide
        $logfile    = "OPCServer%02i.txt" wide
    condition:
        3 of them
}

rule CrowdStrike_CSIR_14005_12 : energetic_bear tasking installer 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Rule detects second stage tasking tool deployed by ENERGETIC BEAR"
        reports = "CSIR-14005"
        version = "201407290000"
        last_modified = "2014-07-29"
        actor = "ENERGETIC BEAR"
    strings:
        $installername = "InstallerFromDll.dll"
        $bzheader = { 42 5A 68 39 31 41 59 26 }
        $oldstrings_sysmain = "sysmain.dll" wide
        $oldstrings_sendthis = "SendThisFile"
        $oldstrings_yls = ".tmp.yls" wide
    condition:
        $installername and $bzheader or all of ($oldstrings*)
}

rule CrowdStrike_CSIR_14005_13 : energetic_bear tasking 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Rule detects strings present in a HAVEX-related information harvester in use by ENERGETIC BEAR"
        reports = "CSIR-14005"
        version = "201407290000"
        last_modified = "2014-07-29"
        actor = "ENERGETIC BEAR"
        malware_family = "HAVEX"
    strings:
        $dllname = "InfoHarvesterCmd.dll"
        $string_havex = "havex"
        $string_key = "1312312"
        $string_fertger = "fertger" wide
        $string_lppe = "lppe == NULL"
    condition:
        $dllname and 2 of ($string_*)
}

rule CrowdStrike_CSIR_14005_14 : energetic_bear tasking 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Rule detects strings present in executable in use by ENERGETIC BEAR. This is a second-stage tool used to collect additional information on the victim."
        reports = "CSIR-14005"
        version = "201407290000"
        last_modified = "2014-07-29"
        actor = "ENERGETIC BEAR"
    strings:
        $dllname = "RunExeCmd.dll"
        $string_enckey = "MTMxMjMxMg==" wide
        $string_temp = "TEMP" wide
        $string_exe = ".exe" wide
    condition:
        $dllname or ($string_enckey and ($string_temp and $string_exe))
}

rule CrowdStrike_CSIR_14005_15 : energetic_bear tasking 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Rule detects strings present in a second-stage information harvesting tool used by ENERGETIC BEAR"
        reports = "CSIR-14005"
        version = "201407290000"
        last_modified = "2014-07-29"
        actor = "ENERGETIC BEAR"
    strings:
        $dllname = "ShortInfoHarvesterCmd.dll"
        $string_enckey = "MTMxMjMxMg==" wide
        $string_temp = "TEMP" wide
        $string_exe = ".exe" wide
        $string_sysenc = "Win32_SystemEnclosure"
    condition:
        $dllname or ($string_enckey and ($string_temp and $string_exe and $string_sysenc))
}

rule CrowdStrike_CSIR_14005_16 : energetic_bear tasking 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Rule detects strings present in a second-stage tool designed to locate one or more specified files and package them as a .yls file for exfiltration by the Havex implant"
        reports = "CSIR-14005"
        version = "201407290000"
        last_modified = "2014-07-29"
        actor = "ENERGETIC BEAR"
    strings:
        $dllname = "GetFileCmd.dll"
        $string_enckey = "MTMxMjMxMg==" wide
        $tag_x1 = "<x>" wide
        $tag_x2 = "</x>" wide
        $tag_y1 = "<y>" wide
        $tag_y2 = "</y>" wide
        $tag_z1 = "<z>" wide
        $tag_z2 = "</z>" wide
        $tag_q1 = "<q>" wide
        $tag_q2 = "</q>" wide
        $header = "<?xml version=\"1.0\" encoding=\"unicode\"?>" wide
    condition:
        $dllname or ($string_enckey and ($header and all of ($tag_*)))
}

rule CrowdStrike_CSIR_14005_17 : energetic_bear tasking 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Rule detects strings present in a second-stage tool designed to obtain information about a victim's BIOS"
        reports = "CSIR-14005"
        version = "201407290000"
        last_modified = "2014-07-29"
        actor = "ENERGETIC BEAR"
    strings:
        $log = "log.bin" wide
        $key = "zxcvbnm"
        $dump = "dump.bin" wide
    condition:
        2 of them
}

rule CrowdStrike_CSIR_14008_12 : dropper fancy_bear 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "FANCY BEAR dropper"
        reports = "CSIR-14008"
        version = "202012141610"
        last_modified = "2020-12-14"
        actor = "FANCY BEAR"
    strings:
        $s1 = "netui.dll"
        $s2 = "Init1"
        $s3 = "KERNEL32.dll"
        $s4 = "MSVCRT.dll"
        $s5 = "ServiceMain"
        $s6 = "NetUI" wide
        $s7 = "LoadLibraryA"
        $s8 = "GetProcAddress"
        $s9 = "Sleep"
    condition:
        (uint16(0) == 0x5A4D and uint32(uint32(0x3C)) == 0x00004550) and all of them
}

rule CrowdStrike_CSIR_14008_03 : fancy_bear rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Crypt loop observed in FANCY BEAR malware"
        reports = "CSIR-14008"
        version = "201808131446"
        last_modified = "2018-08-13"
        actor = "FANCY BEAR"
    strings:
        $cryptloop1 = { d3 ea 32 c2 8d 56 ff 83 e2 07 8a 1c 3a 8a 14 2e }
        $cryptloop2 = { 32 d8 8a 04 2e 32 c3 41 88 04 2e 46 83 fe ?? 7c }
        $cryptloop3 = { 32 d9 8a 0c 30 32 cb 8b 5c 24 34 88 0c 30 8b }
        $cryptloop4 = { 32 d3 8d 1c 07 22 14 31 8d 4c 3e ff }
        $cryptloop5 = { 32 cb 30 08 8b 4d 14 41 47 83 ff 09 }
        $cryptloop6 = { 32 da 33 d2 f7 f5 8b 44 24 18 32 1c 3a 30 5c }
    condition:
        uint16(0) == 0x5A4D and uint32(uint32(0x3C)) == 0x00004550 and any of them
}

rule CrowdStrike_CSIR_14008_04 : downloader fancy_bear winids 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "WinIDS Downloader"
        reports = "CSIR-14008"
        version = "201911050812"
        last_modified = "2019-11-05"
        actor = "FANCY BEAR"
        malware = "WinIDS"
    strings:
        // service description
        $svc1 = "NetIDS" wide
        $svc2 = "svchost.exe" wide
        $svc3 = "dll.dll"
        $svc4 = "Init1"
        $svc5 = "ServiceMain"
    condition:
        (uint16(0) == 0x5A4D and uint32(uint32(0x3C)) == 0x00004550) and all of them
}

rule CrowdStrike_CSIR_14008_02 : fancy_bear rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Service name used in FANCY BEAR malware"
        reports = "CSIR-14008"
        version = "201808011417"
        last_modified = "2018-08-01"
        actor = "FANCY BEAR"
    strings:
        // Service description
        $svc1 = "Service for network identification control data"
        $svc2 = "ServiceDll"
    condition:
        (uint16(0) == 0x5A4D and uint32(uint32(0x3C)) == 0x00004550) and all of them
}

rule CrowdStrike_CSIR_14008_05 : fancy_bear dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "FANCY BEAR dropper"
        reports = "CSIR-14008"
        version = "201808011420"
        last_modified = "2018-08-01"
        actor = "FANCY BEAR"
    strings:
        $s1 = ".tmp" wide
        $s2 = "\",Start" wide
        $s3 = "rundll32.exe \"" wide
        $s4 = "conhost.dll" wide
    condition:
        (uint16(0) == 0x5A4D and uint32(uint32(0x3C)) == 0x00004550) and all of them
}

rule CrowdStrike_CSIR_14008_06 : fancy_bear dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "FANCY BEAR dropper"
        reports = "CSIR-14008"
        version = "201808011420"
        last_modified = "2018-08-01"
        actor = "FANCY BEAR"
    strings:
        $s1 = "dll.dll"
        $s2 = "Init1"
        $s3 = "KERNEL32.dll"
        $s4 = "MSVCRT.dll"
        $s5 = "LoadLibraryA"
        $s6 = "GetProcAddress"
        $s7 = "Sleep"
        $dexor = { 32 CB }
        $pushkey = { C6 45 ?? ?? C6 45 ?? ?? C6 45 ?? ?? C6 45 ?? ?? C6 45 ?? ?? C6 45 ?? ?? }
        $cryptloop = { C0 E1 06 8A 04 3A 02 C8 8B 44 24 14 32 D9 8A 0C 30 32 CB 8B 5C 24 34 }
    condition:
        (uint16(0) == 0x5A4D and uint32(uint32(0x3C)) == 0x00004550) and all of them
}

rule CrowdStrike_CSIR_14008_01 : fancy_bear key 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Key used in FANCY BEAR malware"
        reports = "CSIR-14008"
        version = "201906130850"
        last_modified = "2019-06-13"
        actor = "FANCY BEAR"
    strings:
        $pushkey1 = { C6 45 ?? D1 C6 45 ?? A6 C6 45 ?? B8 C6 45 ?? 14 C6 45 ?? 36 C6 45 ?? 28 C6 45 ?? 9E C6 45 ?? 8A }
        $pushkey2 = { C6 45 ?? 14 C6 45 ?? B9 C6 45 ?? 43 C6 45 ?? 9A C6 45 ?? F7 C6 45 ?? 62 C6 45 ?? 08 C6 45 ?? 55 }
        $pushkey3 = { C6 45 ?? 6D C6 45 ?? F9 C6 45 ?? 33 C6 45 ?? 4E C6 45 ?? B1 C6 45 ?? 79 C6 45 ?? 54 }
        $pushkey4 = { C6 45 ?? 7A C6 45 ?? 9D C6 45 ?? 36 C6 45 ?? E8 C6 45 ?? D2 C6 45 ?? 66 }
        $pushkey5 = { C6 45 ?? 5A C6 45 ?? 4F C6 45 ?? B8 C6 45 ?? 17 C6 45 ?? 4E C6 45 ?? 68 }
        $pushkey6 = { C6 45 ?? 29 C6 45 ?? 67 C6 45 ?? 7F C6 45 ?? 2D C6 45 ?? 5E C6 45 ?? 41 }
        $pushkey10 = { C6 44 24 ?? E6 C6 44 24 ?? C5 C6 44 24 ?? 01 C6 44 24 ?? 43 C6 44 24 ?? 57 C6 44 24 ?? D8 }
        $pushkey11 = { C6 45 ?? 69 C6 45 ?? 23 C6 45 ?? 5A C6 45 ?? 7B C6 45 ?? E9 C6 45 ?? C4 C6 45 ?? F3 C6 45 ?? 4D }
        $pushkey12 = { C6 44 24 ?? B7 C6 44 24 ?? 4E C6 44 24 ?? 96 C6 44 24 ?? 71 C6 44 24 ?? 2F C6 44 24 ?? 35 }
        $key4 = {35 E4 65 D7 03 7A 94 6F}
        $key1_nonpushed = { D1 A6 B8 14 36 28 9E 8A }
        $key2_nonpushed = { 14 B9 43 9A F7 62 0B 55 }
        $key3_nonpushed = { 6D F9 33 4E B1 79 54 }
        $key4_nonpushed = { 43 7A 9D 36 E8 D2 66 }
        $key7_nonpushed = { 35 E4 65 D7 03 7A 94 6F }
        $key8_nonpushed = { C4 9E 37 21 A6 7F 14 D0 }
        $key9_nonpushed = { 7A F4 21 35 E9 6A 22 0B }
        $key10_nonpushed = { 15 B9 C7 58 4D 33 07 86 58 }
    condition:
        (uint16(0) == 0x5A4D and uint32(uint32(0x3C)) == 0x00004550) and any of them
}

rule CrowdStrike_CSIR_14008_07 : fancy_bear dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "FANCY BEAR dropper"
        reports = "CSIR-14008"
        version = "201808011420"
        last_modified = "2018-08-01"
        actor = "FANCY BEAR"
    strings:
        $s01 = "dll.dll"
        $s02 = "Start"
        $s03 = "KERNEL32.dll"
        $s04 = "MSVCRT.dll"
        $s05 = "LoadLibraryA"
        $s06 = "GetProcAddress"
        $s08 = "StartServiceA"
        $s09 = "CreateToolhelp32Snapshot"
        $s10 = "avgtray.exe"
        $s11 = "Process32First"
        $s12 = "Process32Next"
        // part of the CryptBuf XOR, required to avoid FPs
        $cryptxor = { 32 D8 8A C3 8B 5D ?? 30 04 3B 41 }
    condition:
        (uint16(0) == 0x5A4D and uint32(uint32(0x3C)) == 0x00004550) and all of them
}

rule CrowdStrike_CSIR_14008_08 : fancy_bear dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "FANCY BEAR dropper"
        reports = "CSIR-14008"
        version = "201807301114"
        last_modified = "2018-07-30"
        actor = "FANCY BEAR"
    strings:
        $s01 = { 00 74 00 65 00 6D 00 70 00 00 00 00 00 6F 00 70 00 65 00 6E 00 00 00 }
        $s03 = "KERNEL32.dll"
        $s04 = "SHELL32.dll"
        $s05 = { 52 00 45 00 53 00 00 00 }
        $s06 = "ShellExecuteW"
        $s07 = "GetEnvironmentVariableW"
        $s08 = "SizeofResource"
        $s09 = "LockResource"
        $s10 = "LoadResource"
        $s11 = "FindResourceW"
    condition:
        (uint16(0) == 0x5A4D and uint32(uint32(0x3C)) == 0x00004550) and all of them
}

rule CrowdStrike_CSIR_14008_09 : fancy_bear dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "FANCY BEAR dropper"
        reports = "CSIR-14008"
        version = "201808011421"
        last_modified = "2018-08-01"
        actor = "FANCY BEAR"
    strings:
        $s01 = ".tmp" wide
        $s02 = "rundll32.exe \"%s\",#1" wide
        $s03 = "dwnlink.dll" wide
        $s04 = "KERNEL32.dll"
        $s05 = "SHLWAPI.dll"
        $s06 = "MSVCRT.dll"
        $s07 = "SetFilePointer"
        $s08 = "ReadFile"
    condition:
        (uint16(0) == 0x5A4D and uint32(uint32(0x3C)) == 0x00004550) and all of them
}

rule CrowdStrike_CSIT_14069_01 : stickykeys post_exploitation 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Tool used to launch cmd.exe when sethc.exe is executed. This allows a malicious actor to bypass having to enter credentials while at the Windows login screen locally or remotely."
        reports = "CSIT-14069"
        version = "201408040000"
        last_modified = "2014-08-04"
    strings:
        $cmd = "\x00cmd.exe\x00" ascii wide nocase
        $sethc = "\x00sethc.exe\x00" ascii wide nocase
        $debugger = "\x00debugger\x00" ascii wide nocase
        $imgfileexec = "\x00SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\x00" ascii wide nocase
    condition:
        all of them
}

rule CrowdStrike_CSIT_14069_02 : post_exploitation 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "File used to save a file downloaded from a remote URL"
        reports = "CSIT-14069"
        version = "201408040000"
        last_modified = "2014-08-04"
    strings:
        $xPost = "Set xPost = CreateObject(s1):xPost.Open \"GET\",iRemote,0:xPost.Send()"
        $xGet = "Set sGet = CreateObject(s2):sGet.Mode=3:sGet.Type=1:sGet.Open()"
    condition:
        any of them
}

rule CrowdStrike_CSIT_14069_03 : post_exploitation 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Tool used to execute commands on remote hosts with stolen credentials"
        reports = "CSIT-14069"
        version = "201408040000"
        last_modified = "2014-08-04"
    strings:
        $title = "wsh.echo \"Rcmd v1.01 by NetPatch\""
        $read_vbs_created = "wsh.echo \"read.vbs Created!!!\""
        $usage = "wsh.echo \"cscript \"&wscript.scriptfullname&\" targetIP username password Command"
    condition:
        any of them
}

rule CrowdStrike_CSIT_14069_04 : mimikatz credential_dumper post_exploitation 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Rule detects credential dumping output from Mimikatz post-exploitation tool"
        reports = "CSIT-14069"
        version = "201408040000"
        last_modified = "2014-08-04"
    strings:
        $auth_id = "Authentication Id:"
        $auth_package = "Authentication Package:"
        $auth_domain = "Authentication Domain:"
        $auth_primary_user = "Primary User:"
        $cred_user = "* User: "
        $cred_domain = "* Domain: "
        $cred_password = "* Password: "
    condition:
        all of ($auth_*) or all of ($cred_*)
}

rule CrowdStrike_CSIT_14069_05 : proxy post_exploitation 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Tool used to tunnel or proxy data from or through a compromised host"
        reports = "CSIT-14069"
        version = "201408040000"
        last_modified = "2014-08-04"
    strings:
        $slave = "-slave"
        $listen = "-listen"
        $wating_on_port = "wating on port %d...\x0a"
        $end_waiting2 = "end waiting2\x0a"
    condition:
        all of them
}

rule CrowdStrike_CSIT_14069_06 : remote_shell post_exploitation 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Tool used to create a remote shell"
        reports = "CSIT-14069"
        version = "201807021339"
        last_modified = "2018-07-02"
    strings:
        $cmdexe_mov = { C6 84 05 ?? ?? ?? ?? 5C C6 84 05 ?? ?? ?? ?? 65 C6 84 05 ?? ?? ?? ?? 63 C6 84 05 ?? ?? ?? ?? 78 C6 84 05 ?? ?? ?? ?? 6D C6 84 05 ?? ?? ?? ?? 65 C6 84 05 ?? ?? ?? ?? 64 ?? ?? ?? ?? ?? ?? ?? ?? C6 84 05 ?? ?? ?? ?? 2E }
    condition:
        $cmdexe_mov
}

rule CrowdStrike_CSIT_14069_07 : credential_theft post_exploitation 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Rule detects a VBScript using ADSI to steal credentials from websites"
        reports = "CSIT-14069"
        version = "201910201307"
        last_modified = "2019-10-20"
    strings:
        $header = "*******************GetIISInfo"
        $handle_iisvirtual = "IIsWebVirtualDir"
        $handle_root = "ROOT"
        $out_host = "[Host ] "
        $out_user = "[User ] "
        $out_pass = "[Pass ] "
        $AnonUser = ".AnonymousUserName"
        $AnonPass = ".AnonymousUserPass"
    condition:
        ($header or filesize < 5KB) and all of ($Anon*) and (all of ($out_*) or all of ($handle_*))
}

rule CrowdStrike_CSIT_14068_01 : vixen_panda magicfire rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Rule looks for version 1.0 of the VIXEN PANDA MagicFire RAT"
        reports = "CSIT-14068"
        version = "201408050000"
        last_modified = "2014-08-05"
        actor = "VIXEN PANDA"
        malware_family = "MagicFire"
    strings:
        $deob = { 8d 8a ?? ?? 40 00 8a c2 02 01 88 01 42 81 fa ?? 00 00 00 72 eb }
        $neo = "Neo,welcome to the desert of real." ascii wide
        $in = "sysin.log" ascii wide
        $out = "sysout.log" ascii wide
        $temp = "systemp.log" ascii wide
        $ver = "v1.0" ascii wide
    condition:
        3 of them and $ver
}

rule CrowdStrike_CSIT_14068_02 : vixen_panda magicfire rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Rule looks for version 1.0EX of the VIXEN PANDA MagicFire RAT"
        reports = "CSIT-14068"
        version = "201408050000"
        last_modified = "2014-08-05"
        actor = "VIXEN PANDA"
        malware_family = "MagicFire"
    strings:
        $deob = { 8d 8a ?? ?? 40 00 8a c2 02 01 88 01 42 81 fa ?? 00 00 00 72 eb }
        $neo = "Neo,welcome to the desert of real." ascii wide
        $in = "sysin.log" ascii wide
        $out = "sysout.log" ascii wide
        $temp = "systemp.log" ascii wide
        $ver = "v1.0EX" ascii wide
    condition:
        3 of them and $ver
}

rule CrowdStrike_CSIT_14068_03 : rat vixen_panda 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Rule looks for strings across an evolution of VIXEN PANDA RATs"
        reports = "CSIT-14068"
        version = "201901221006"
        last_modified = "2019-01-22"
        actor = "VIXEN PANDA"
    strings:
        $big = "File too big!" ascii wide
        $osi = "%sOsInfo.dat" ascii wide
        $cmd = "Don't find cmd.exe,please check again or upload the program!" ascii wide
        $delim = "7db30d27130508" ascii wide
        $os32 = "os32__%d.ini" ascii wide
        $usrer32 = "usrer__%d.ini" ascii wide
        $usr32 = "usr32__%d.ini" ascii wide
    condition:
        5 of them
}

rule CrowdStrike_CSIT_14070_01 : wolf webshell 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "WolF ASPX Webshell"
        reports = "CSIT-14070"
        version = "201408050000"
        last_modified = "2014-08-05"
        malware_family = "WolF"
    strings:
        $author_email = "the_white_lf_x@hotmail.com"
        $html_frag1 = "AutoGenerateColumns=\"False\" onitemcommand=\"FileSystem_ItemCommand\""
        $html_frag2 = "<asp:LinkButton ID=\"lnkExec\" runat=\"server\" onclick=\"lnkExec_Click\">[Execute"
        $html_frag3 = "<asp:Label ID=\"uIP\" runat=\"server\" Text=\"Your IP :\" ForeColor=\"#FF8300\"></asp:Label>"
    condition:
        $author_email or 3 of ($html_frag*)
}

rule CrowdStrike_CSIT_13049_02 : pitty_panda pittytiger rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "PittyTiger dropper"
        reports = "CSIT-13049,CSIT-14047,CSIR-14006"
        version = "201807271513"
        last_modified = "2018-07-27"
        actor = "PITTY PANDA"
        malware_family = "PittyTiger"
    strings:
        $s1 = "version"
        $s2 = "ocmd"
        $s3 = "ccmd"
        $s4 = "prtsc"
        //$s5 = "prntsc"
        $s5 = "FC001"
        $o1 = "trj:"
        $o2 = "strp"
        $o3 = "setserv"
        $o4 = "freshserv"
        $o5 = "w7v1.2.10"
        $o6 = "http://%s:%d/PUT[%s]/FC001/%s"
        $o7 = "PittyTiger"
    condition:
        all of ($s*) and 1 of ($o*)
}

rule CrowdStrike_CSIT_14068_04 : vixen_panda rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Rule detects a deobfuscation routine in VIXEN PANDA RATs"
        reports = "CSIT-14068"
        version = "201807301207"
        last_modified = "2018-07-30"
        actor = "VIXEN PANDA"
    strings:
        $deob = { 33 c0 00 80 ?? ?? ?? 00 40 3d 24 02 00 00 72 f2 c3 }
    condition:
        $deob
}

rule CrowdStrike_CSIT_14072_01 : zeprox rat unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detection for Zeprox in memory"
        reports = "CSIT-14072"
        version = "201408120000"
        last_modified = "2014-08-12"
        malware_family = "Zeprox"
    strings:
        // Characteristic strings in the unpacked malware binary
        $s01 = "Not binded"
        $s02 = "Not listened"
        $s03 = "zebro_main"
        $s04 = "FixedID:"
        $s05 = "DinamicID:"
        $s06 = "URL:"
        $s07 = "/vnc"
        // Encrypted strings
        $encs10 = { 6f 6d 6d 71 72 79 2e 25 33 70 7e 7c 24 }
        $encs11 = { 2b 6b 7d 62 2c 23 35 64 61 2b 7a 79 61 73 76 69 }
        $encs12 = { 2b 6b 7d 62 2c 23 35 64 61 2b 74 79 77 6e 78 73 }
    condition:
        all of ($s0*) or any of ($encs*)
}

rule CrowdStrike_CSIT_14074_01 : sakula dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Sakula first stage dropper"
        reports = "CSIT-14074"
        version = "201807300935"
        last_modified = "2018-07-30"
        malware_family = "Sakula"
    strings:
        $decrypt_embedded_payload = { 84 c0 74 06 3c ?? 74 02 34 ?? 83 e9 01 75 f1 }
        $dropper_format_path = "%s\\%s%d.%s"
        $sleep_exit_process = { 68 d0 07 00 00 ff 15 ?? ?? ?? ?? 6a 00 }
    condition:
        2 of them
}

rule CrowdStrike_CSIT_14074_02 : loader sakula 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Sakula second stage loader"
        reports = "CSIT-14074"
        version = "202103091313"
        last_modified = "2021-03-09"
        malware_family = "Sakula"
    strings:
        $xor_decryption = { 3c 00 74 09 38 d0 74 05 30 d0 88 04 0b }
        $custom_pe = "GoLink, GoAsm www.GoDevTool.com"
    condition:
        2 of them
}

rule CrowdStrike_CSIT_14071_02 : csdownusb config 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Strings to detect CSDownUSB configuration file"
        reports = "CSIT-14071"
        version = "201408200000"
        last_modified = "2014-08-20"
        malware_family = "CSDownUSB"
    strings:
        $file_lasttime = "LastTimeKey.ini"
    condition:
        $file_lasttime
}

rule CrowdStrike_CSIT_14071_03 : csdownusb rootkit 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Strings to detect CSDownUSB rootkit component"
        reports = "CSIT-14071"
        version = "201408200000"
        last_modified = "2014-08-20"
        malware_family = "CSDownUSB"
    strings:
        $pdb_1 = { e9 a9 b1 e5 8a a8 e4 bf 9d e6 8a a4 }
        $pdb_2 = { e7 a9 bf e8 bf 98 e5 8e 9f }
        $pdb_3 = "\\FileDisk\\Disk\\Disk\\objfre\\i386\\Disk.pdb"
        $pdb_4 = "IoCreateFileHook.pdb"
    condition:
        any of them
}

rule CrowdStrike_CSIT_14073_01 : owarat rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = ".NET RAT, accessed through OWA"
        reports = "CSIT-14073"
        version = "201812120907"
        last_modified = "2018-12-12"
        malware_family = "OwaRAT"
    strings:
        // Namespace and class names
        $namespace = "Microsoft.Exchange.Clients"
        $class1 = "OwaAuth"
        $class2 = "Security"
        $statusmsg = "Execute Successfully!" wide
        $timestr = "yyyy-MM-dd hh:mm:ss" wide
    condition:
        all of them
        // PE binary
        and uint16(0) == 0x5A4D and uint32(uint32(0x3c)) == 0x4550
        // DLL
        and uint16(uint32(0x3C) + 0x16) & 0x2000 == 0x2000
        and (
        // Mono/.NET 32bit
        (
        uint16(uint32(0x3c)+24) == 0x010b
        and uint32(uint32(0x3c)+232) > 0
        )
        // Mono/.NET 64bit
        or (
        uint16(uint32(0x3c)+24) == 0x020b
        and uint32(uint32(0x3c)+248) > 0
        )
        )
}

rule CrowdStrike_CSIT_14081_01 : tinyshell remote_shell 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "TinySHell Server/Client"
        reports = "CSIT-14081"
        version = "201408200000"
        last_modified = "2014-08-20"
        malware_family = "TinySHell"
    strings:
        $pel_challenge = { 58 90 ae 86 f1 b9 1c f6 29 83 95 71 1d de 58 0d }
    condition:
        all of them
}

rule CrowdStrike_CSIT_14071_01 : csdownusb 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Strings to detect CSDownUSB malware"
        reports = "CSIT-14071"
        version = "201807301108"
        last_modified = "2018-07-30"
        malware_family = "CSDownUSB"
    strings:
        $file_autorun = "AutoRun.inf"
        $file_ravmon = "RavMon.exe"
        $file_lasttime = "LastTimeKey.ini"
        $cs_downu = "CsDownUpdate"
        $cs_downv = "CsDownVersion"
        $cs_downl = "CsDownLoad"
        $cs_exit = "CsExit"
    condition:
        (2 of ($file_*) and 2 of ($cs_*)) or (4 of ($cs_*))
}

rule CrowdStrike_CSIT_14075_01 : post_exploitation 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detection for reverse HTTP upload tool alg.exe"
        reports = "CSIT-14075"
        version = "201408210000"
        last_modified = "2014-08-21"
    strings:
        $example_string1 = "example: ProxySvr.exe szServer wPort."
        $example_string2 = "example: FileSvr.exe szServer wPort."
        $http_header = "Server: FileServer/1"
    condition:
        any of them
}

rule CrowdStrike_CSIT_14075_02 : tsweb post_exploitation 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detection for .ASP Remote Desktop Client web application TSWeb. This is a legitimate tool developed by Microsoft that has been used by an adversary for an illegitimate purpose"
        reports = "CSIT-14075"
        version = "201408210000"
        last_modified = "2014-08-21"
    strings:
        $auth_field1 = "<%Response.Write Request.QueryString(\"Domain\")%>"
        $auth_field2 = "<%Response.Write Request.QueryString(\"UserName\")%>"
    condition:
        all of them
}

rule CrowdStrike_CSIR_14008_19 : downloader fancy_bear foozer 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Foozer downloader decrypted"
        reports = "CSIR-14008"
        version = "201903131214"
        last_modified = "2019-03-13"
        actor = "FANCY BEAR"
        malware_family = "Foozer"
    strings:
        $u0 = "http://%s/~%s/cgi-bin/%s.cgi?%s"
        $u1 = "http://%S/~%S/%S.cgi?%S" wide
        $s2 = "dll:%.8x"
        $s3 = "ins:%.8x"
        $s4 = "%.2x%.2x%.2x%.2x"
        $s5 = "Start"
        $s6 = "OK"
    condition:
        (uint16(0) == 0x5A4D and uint32(uint32(0x3C)) == 0x00004550) and any of ($u*) and all of ($s*)
}

rule CrowdStrike_CSIR_14008_22 : fancy_bear foozer downloader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Foozer downloader decrypted"
        reports = "CSIR-14008"
        version = "201808011425"
        last_modified = "2018-08-01"
        actor = "FANCY BEAR"
        malware_family = "Foozer"
    strings:
        $url1 = "/~%s/cgi-bin/%s.cgi?%s"
        $dll = "dll:%.8x"
        $ins = "ins:%.8x"
        $beacon = "%.2x%.2x%.2x%.2x-%.2d_%.2d"
    condition:
        (uint16(0) == 0x5A4D and uint32(uint32(0x3C)) == 0x00004550) and all of them
}

rule CrowdStrike_CSIR_14008_16 : fancy_bear winids downloader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "CryptBuf in WinIDS downloader"
        reports = "CSIR-14008"
        version = "201808011423"
        last_modified = "2018-08-01"
        actor = "FANCY BEAR"
        malware_family = "WinIDS"
    strings:
        $cryptbuf = { 8B 1E C1 E3 03 8B 45 ?? 03 18 8B 45 ?? 8B 00 0F B6 0C 18 31 D1 }
    condition:
        (uint16(0) == 0x5A4D and uint32(uint32(0x3C)) == 0x00004550) and $cryptbuf
}

rule CrowdStrike_CSIR_14008_15 : fancy_bear winids downloader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Decrypted version of WinIDS downloader"
        reports = "CSIR-14008"
        version = "201808011423"
        last_modified = "2018-08-01"
        actor = "FANCY BEAR"
        malware_family = "WinIDS"
    strings:
        $s1 = "%s ID:%d Path:" wide
        $s2 = "%s: %s err: %.8x" wide
        $comid = "{EF7652A4-98EF-5031-226B-11456C96A7EA}"
    condition:
        (uint16(0) == 0x5A4D and uint32(uint32(0x3C)) == 0x00004550) and all of ($s*) or $comid
}

rule CrowdStrike_CSIR_14008_18 : fancy_bear foozer downloader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "FANCY BEAR Foozer downloader"
        reports = "CSIR-14008"
        version = "201808011424"
        last_modified = "2018-08-01"
        actor = "FANCY BEAR"
        malware_family = "Foozer"
    strings:
        $url0 = { 8A 11 D4 70 38 0F 25 E0 D3 2F 76 33 }
        $url1 = { 82 28 E9 B4 BB 41 B9 29 C6 03 4E 6F }
        $url2 = { E2 CC D9 84 45 1E B6 2C 1F 3C 5F FA }
        $ins0 = { 69 76 75 30 40 0E 38 FA }
        $ins1 = { 7D 6B 17 93 C3 60 C4 75 }
        $ins2 = { 95 63 E7 6A 57 BB 9D E6 }
        $beacon0 = { 25 16 54 72 E0 AE 32 DA E5 EC 17 F8 }
        $beacon1 = { 39 41 86 08 75 61 74 F0 8D 95 9D 0A }
        $beacon2 = { C1 F6 A1 FA 9D B2 55 BB DF AA 27 5C }
    condition:
        (uint16(0) == 0x5A4D and uint32(uint32(0x3C)) == 0x00004550) and any of ($url*) and any of ($ins*) and any of ($beacon*)
}

rule CrowdStrike_CSIR_14008_20 : downloader dropper fancy_bear foozer 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Foozer dropper"
        reports = "CSIR-14008"
        version = "201911050808"
        last_modified = "2019-11-05"
        actor = "FANCY BEAR"
        malware_family = "Foozer"
    strings:
        // beginning of the encrypted payload
        $foozer_url1 = { 3e 3d 32 89 ac e0 d7 e4 3b 17 b5 12 21 7f e1 17 }
        $foozer_url2 = { 2d 11 15 8a 30 ee b3 6e d8 25 4d e5 10 cd 4e 1c }
        $foozer_url3 = { 78 07 22 db 37 a0 98 cd 00 f3 4e c2 00 43 11 27 }
        $foozer_url4 = { 38 26 ae 1e fd 24 7b c6 7f 8a bf d7 1c 4c 2a 27 }
    condition:
        (uint16(0) == 0x5A4D and uint32(uint32(0x3C)) == 0x00004550) and any of them
}

rule CrowdStrike_CSIR_14008_14 : fancy_bear winids downloader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "FANCY BEAR WinIDS downloader"
        reports = "CSIR-14008"
        version = "201808011422"
        last_modified = "2018-08-01"
        actor = "FANCY BEAR"
        malware_family = "WinIDS"
    strings:
        $winids1 = { 25 48 73 6F 1F 30 79 68 34 08 3A EF }
        $winids2 = { 25 48 F3 48 DA 0F FF 50 95 68 83 08 }
    condition:
        (uint16(0) == 0x5A4D and uint32(uint32(0x3C)) == 0x00004550) and all of them
}

rule CrowdStrike_CSIT_14092_01 : nettraveler dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "NetTraveler dropper"
        reports = "CSIT-14092"
        version = "201807300911"
        last_modified = "2018-07-30"
        malware_family = "NetTraveler"
    strings:
        $debug_1 = "CreateFile szConfigPath error"
        $debug_2 = "Decrypt old sname Error"
        $debug_3 = " Is Running!"
        $decrypt_fn = { 80 eb 0a 41 3b ca 88 18 72 }
        $anti_debug_1 = { 0f 3f 07 0b 85 }
        $anti_debug_2 = { b8 68 58 4d 56 bb 00 00 00 00 b9 0a 00 00 00 ba 58 56 00 00 ed }
    condition:
        3 of them
}

rule CrowdStrike_CSIT_14078_01 : frameworkpos pos_scraper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detection FrameworkPoS malware"
        reports = "CSIT-14078"
        version = "201408280000"
        last_modified = "2014-08-28"
        malware_family = "FrameworkPoS"
    strings:
        $sc_command = "\\SYSTEM32\\sc.exe config LanmanWorkstation depend= mcfmisvc"
        $alphabet = "^=/0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghi;jklmnopqrstuvwx.yz"
        $usage = "Usage: -[start|stop|install|uninstall]"
    condition:
        all of them
}

rule CrowdStrike_CSIT_14086_01 : medusa post_exploitation 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Medusa brute-forcing tool"
        reports = "CSIT-14086"
        version = "201408280000"
        last_modified = "2014-08-28"
        malware_family = "Medusa"
    strings:
        $baner_complete = "Medusa has finished"
        $copyright = "JoMo-Kun / Foofus Networks"
        $baner_version = "Medusa v.%s"
    condition:
        all of them
}

rule CrowdStrike_CSIT_14086_02 : post_exploitation 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "PoS terminal start script to execute Medusa brute-forcing tool"
        reports = "CSIT-14086"
        version = "202001151052"
        last_modified = "2020-01-15"
    strings:
        $start_scan_command = "./ss 5631 -a "
        $progress_message = "green Attack PcAnyWhere in 5 seconds"
        $start_brute_command = "medusa -H $1.pc -U users"
    condition:
        all of them
}

rule CrowdStrike_CSIT_14086_03 : port_scanner post_exploitation 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Fast Syn Scanner tool"
        reports = "CSIT-14086"
        version = "201408280000"
        last_modified = "2014-08-28"
    strings:
        $error_message = "requires an A network as argument"
        $error_message2 = "damn dude, port numbers are in 1 .. 65535"
        $pcap_filter = "(tcp[tcpflags]=0x12) and (src port %d) and (dst port %d)"
    condition:
        all of them
}

rule CrowdStrike_CSIT_14079_01 : cobra rat dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Cobra RAT, sniffer, or dropper"
        reports = "CSIT-14079"
        version = "201807300839"
        last_modified = "2018-07-30"
        malware_family = "Cobra"
    strings:
        $s00 = "sniffit"
        $s01 = "myWorkStart"
        $s02 = "%s\\sadeep.dll"
        $s03 = "%s\\cangur.dat"
        $s04 = "http:%s"
        $s05 = "port:%d"
        $s06 = "&VER=Cobra 1.2&MARK="
        $s07 = "&ID=NoID&END=1"
        $s08 = " %d.%d&L_IP="
        $s09 = "DRIVE=%c:&"
        $s10 = "#1A&2B@"
        $s11 = "doublesafe"
        $zmunk = "ZMUNK:"
    condition:
        7 of ($s*) or $zmunk
}

rule CrowdStrike_CSIT_14077_02 : hkdoor rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Hkdoor RAT DLL, identified by IOCTL codes"
        reports = "CSIT-14077"
        version = "201910231925"
        last_modified = "2019-10-23"
        malware_family = "HkDoor"
    strings:
        $c1 = { c0 20 22 43 }
        $c2 = { c4 20 22 43 }
        $c3 = { cc 20 22 43 }
        $c4 = { d4 20 22 43 }
        $c5 = { d8 20 22 43 }
        $c6 = { d0 20 22 43 }
    condition:
        all of them
}

rule CrowdStrike_CSIT_14077_03 : hkdoor rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Hkdoor RAT driver"
        reports = "CSIT-14077"
        version = "201409010000"
        last_modified = "2014-09-01"
        malware_family = "HkDoor"
    strings:
        $devname = "\\Device\\IPFILTERDRIVER" wide
        $pdbpath = "D:\\hkdoor_src\\hkdoor_src\\hkdoor_src\\hkdoor_src_x32\\filterdriver\\Release\\DrvFltIp.pdb"
    condition:
        all of them
}

rule CrowdStrike_CSIT_14077_01 : hkdoor rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Hkdoor RAT DLL, identified by version info resource"
        reports = "CSIT-14077"
        version = "201807301041"
        last_modified = "2018-07-30"
        malware_family = "HkDoor"
    strings:
        $versioninfo = { c0 03 34 00 00 00 56 00 53 00 5f 00 56 00 45 00 52 00 53 00 49 00 4f 00 4e 00 5f 00 49 00 4e 00 46 00 4f 00 00 00 00 00 bd 04 ef fe 00 00 01 00 00 00 01 00 01 00 00 00 00 00 01 00 01 00 00 00 3f 00 00 00 00 00 00 00 04 00 04 00 01 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 20 03 00 00 01 00 53 00 74 00 72 00 69 00 6e 00 67 00 46 00 69 00 6c 00 65 00 49 00 6e 00 66 00 6f 00 00 00 fc 02 00 00 01 00 30 00 34 00 30 00 39 00 30 00 34 00 62 00 30 00 00 00 18 00 00 00 01 00 43 00 6f 00 6d 00 6d 00 65 00 6e 00 74 00 73 00 00 00 4c 00 16 00 01 00 43 00 6f 00 6d 00 70 00 61 00 6e 00 79 00 4e 00 61 00 6d 00 65 00 00 00 00 00 4d 00 69 00 63 00 72 00 6f 00 73 00 6f 00 66 00 74 00 20 00 43 00 6f 00 72 00 70 00 6f 00 72 00 61 00 74 00 69 00 6f 00 6e 00 00 00 36 00 07 00 01 00 46 00 69 00 6c 00 65 00 44 00 65 00 73 00 63 00 72 00 69 00 70 00 74 00 69 00 6f 00 6e 00 00 00 00 00 6b 00 65 00 72 00 6e 00 65 00 6c 00 00 00 00 00 3e 00 0f 00 01 00 46 00 69 00 6c 00 65 00 56 00 65 00 72 00 73 00 69 00 6f 00 6e 00 00 00 00 00 35 00 2e 00 30 00 30 00 2e 00 33 00 37 00 30 00 30 00 2e 00 36 00 36 00 39 00 30 00 00 00 00 00 2e 00 07 00 01 00 49 00 6e 00 74 00 65 00 72 00 6e 00 61 00 6c 00 4e 00 61 00 6d 00 65 00 00 00 6b 00 65 00 72 00 6e 00 65 00 6c 00 00 00 00 00 74 00 28 00 01 00 4c 00 65 00 67 00 61 00 6c 00 43 00 6f 00 70 00 79 00 72 00 69 00 67 00 68 00 74 00 00 00 43 00 6f 00 70 00 79 00 72 00 69 00 67 00 68 00 74 00 20 00 28 00 43 00 29 00 20 00 4d 00 69 00 63 00 72 00 6f 00 73 00 6f 00 66 00 74 00 20 00 43 00 6f 00 72 00 70 00 2e 00 20 00 31 00 39 00 38 00 31 00 2d 00 31 00 39 00 39 00 39 00 00 00 28 00 00 00 01 00 4c 00 65 00 67 00 61 00 6c 00 54 00 72 00 61 00 64 00 65 00 6d 00 61 00 72 00 6b 00 73 00 00 00 00 00 3e 00 0b 00 01 00 4f 00 72 00 69 00 67 00 69 00 6e 00 61 00 6c 00 46 00 69 00 6c 00 65 00 6e 00 61 00 6d 00 65 00 00 00 6b 00 65 00 72 00 6e 00 65 00 6c 00 2e 00 64 00 6c 00 6c 00 00 00 00 00 20 00 00 00 01 00 50 00 72 00 69 00 76 00 61 00 74 00 65 00 42 00 75 00 69 00 6c 00 64 00 00 00 7e 00 2f 00 01 00 50 00 72 00 6f 00 64 00 75 00 63 00 74 00 4e 00 61 00 6d 00 65 00 00 00 00 00 4d 00 69 00 63 00 72 00 6f 00 73 00 6f 00 66 00 74 00 28 00 52 00 29 00 20 00 57 00 69 00 6e 00 64 00 6f 00 77 00 73 00 20 00 28 00 52 00 29 00 20 00 32 00 30 00 30 00 30 00 20 00 4f 00 70 00 65 00 72 00 61 00 74 00 69 00 6e 00 67 00 20 00 53 00 79 00 73 00 74 00 65 00 6d 00 00 00 00 00 3a 00 0b 00 01 00 50 00 72 00 6f 00 64 00 75 00 63 00 74 00 56 00 65 00 72 00 73 00 69 00 6f 00 6e 00 00 00 31 00 2c 00 20 00 30 00 2c 00 20 00 30 00 2c 00 20 00 31 00 00 00 00 00 20 00 00 00 01 00 53 00 70 00 65 00 63 00 69 00 61 00 6c 00 42 00 75 00 69 00 6c 00 64 00 00 00 44 00 00 00 01 00 56 00 61 00 72 00 46 00 69 00 6c 00 65 00 49 00 6e 00 66 00 6f 00 00 00 00 00 24 00 04 00 00 00 54 00 72 00 61 00 6e 00 73 00 6c 00 61 00 74 00 69 00 6f 00 6e 00 00 00 00 00 09 04 b0 04 }
    condition:
        all of them
}

rule CrowdStrike_CSIR_14008_10 : fancy_bear dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "FANCY BEAR dropper"
        reports = "CSIR-14008"
        version = "201808011421"
        last_modified = "2018-08-01"
        actor = "FANCY BEAR"
    strings:
        $s01 = "SystemRoot" wide
        $s02 = "rundll32.exe" wide
        $s03 = "Shared Printer Service" wide
        $s04 = "init"
        $s05 = "%s \"%s\",%s" wide
        $s06 = "\"%s\",%s" wide
        $s07 = "open" wide
        $s08 = "shell32" wide
        $s09 = "ShellExecuteW"
        $s10 = "install" wide
        $s11 = "ALLUSERSPROFILE" wide
        $s12 = "Software\\Microsoft\\Windows\\CurrentVersion\\Run" wide
    condition:
        (uint16(0) == 0x5A4D and uint32(uint32(0x3C)) == 0x00004550) and all of them
}

rule CrowdStrike_CSIR_14008_11 : fancy_bear dropper resource_dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "FANCY BEAR dropper"
        reports = "CSIR-14008"
        version = "201809241055"
        last_modified = "2018-09-24"
        actor = "FANCY BEAR"
    strings:
        $s01 = "temp" wide
        $s02 = "shell32" wide
        $s03 = "open" wide
        $s04 = "shell32" wide
        $s05 = "ShellExecuteW"
        $s06 = "KERNEL32.dll"
        $s07 = "RES" wide
        $dexor = { 3A 30 74 06 30 10 28 10 FE C2 }
    condition:
        (uint16(0) == 0x5A4D and uint32(uint32(0x3C)) == 0x00004550) and all of them
}

rule CrowdStrike_CSIR_14008_13 : fancy_bear dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "FANCY BEAR encrypted MZ header"
        reports = "CSIR-14008"
        version = "201808011422"
        last_modified = "2018-08-01"
        actor = "FANCY BEAR"
    strings:
        $encmz1 = {D5 16 2D CC BA E8 67 76}
        $encmz2 = {82 87 DC CE 96 00 7D 7E}
        $encmz3 = {A3 BB EC 9E 32 5C 8B 05 E9 81 28 ED 1D 44 71 98}
    condition:
        (uint16(0) == 0x5A4D and uint32(uint32(0x3C)) == 0x00004550) and any of them
}

rule CrowdStrike_CSIR_14008_21 : fancy_bear foozer downloader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Foozer downloader"
        reports = "CSIR-14008"
        version = "201808011425"
        last_modified = "2018-08-01"
        actor = "FANCY BEAR"
        malware_family = "Foozer"
    strings:
        $refoozer_url_enc = { A5 B2 88 F7 1E 7D A1 45 08 5E 19 94 22 18 3D 30 }
    condition:
        (uint16(0) == 0x5A4D and uint32(uint32(0x3C)) == 0x00004550) and $refoozer_url_enc
}

rule CrowdStrike_CSIR_14008_23 : fancy_bear foozer downloader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Foozer downloader"
        reports = "CSIR-14008"
        version = "201808011425"
        last_modified = "2018-08-01"
        actor = "FANCY BEAR"
        malware_family = "Foozer"
    strings:
        $refoozer_url1 = { 14 40 a4 61 11 00 fd 83 d9 bc 35 42 25 a1 df e7 }
        $refoozer_url2 = { 62 ab 1a 28 cc 7d 7c 3b b7 2b c9 1c d0 28 e0 0e }
    condition:
        (uint16(0) == 0x5A4D and uint32(uint32(0x3C)) == 0x00004550) and any of them
}

rule CrowdStrike_CSIR_14008_17 : fancy_bear winids downloader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "FANCY BEAR WinIDS dropper"
        reports = "CSIR-14008"
        version = "201808011423"
        last_modified = "2018-08-01"
        actor = "FANCY BEAR"
        malware_family = "WinIDS"
    strings:
        $winidspayload = { a3 b9 01 8b 2d 37 c0 0a }
    condition:
        (uint16(0) == 0x5A4D and uint32(uint32(0x3C)) == 0x00004550) and $winidspayload
}

rule CrowdStrike_CSIT_13091_05 : deep_panda derusbi rootkit 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Strings found in DEEP PANDA Derusbi rootkit variant"
        reports = "CSIT-13091"
        version = "201409080000"
        last_modified = "2014-09-08"
        actor = "DEEP PANDA"
        malware_family = "Derusbi"
    strings:
        $win_vista = "Vista"
        $win2000 = "Win2000"
        $win2003 = "Win2003" fullword
        $win2003r2 = "Win2003R2"
        $win2008 = "Win2008" fullword
        $win2008r2 = "Win2008R2"
        $win2012 = "Win2012"
        $win32s = "Win32S"
        $win7 = "Win7"
        $win8 = "Win8"
        $win95 = "Win95" fullword
        $win95osr2 = "Win95OSR2"
        $win98 = "Win98" fullword
        $win98se = "Win98SE"
        $winme = "WinMe"
        $winxp = "WinXP"
    condition:
        all of them
}

rule CrowdStrike_CSIT_14084_01 : downloader fancy_bear winids 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Sofacy WinIDS Downloader"
        reports = "CSIT-14084"
        version = "202012141610"
        last_modified = "2020-12-14"
        actor = "FANCY BEAR"
        malware_family = "WinIDS"
    strings:
        // Encrypted strings
        $winids1 = { 25 48 73 6f 1f 30 79 68 34 08 3a ef }
        $winids2 = { 25 48 f3 48 da 0f ff 50 95 68 83 08 }
    condition:
        all of them
}

rule CrowdStrike_CSIT_14101_01 : rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Rule to detect unattributed RAT"
        reports = "CSIT-14101"
        version = "201409100000"
        last_modified = "2014-09-10"
    strings:
        $banner_message = "[injectPE] svcName=%s"
        $banner_message2 = "[Green] pid=%d tid=%d modulePath=%s|" wide
        $status_message = "ReConfig success"
        $message = "modulePath=%[^|]" wide
        $help_banner = "green.exe ip port second"
        $config_header = { d1 61 d5 c5 2e 29 b4 22 }
    condition:
        $config_header or (($banner_message or $banner_message2) and ($status_message or $message or $help_banner))
}

rule CrowdStrike_CSIT_14101_02 : post_exploitation 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Rule to detect network mapping tool"
        reports = "CSIT-14101"
        version = "201409100000"
        last_modified = "2014-09-10"
    strings:
        $sam_dump = "\\DUMP-%u.dmp"
        $message1 = "-----Groups/Users Organizational-----[%s]"
        $message2 = "-----Group [%s] Members----- [%s]"
        $message3 = "-----Users currently logged on----- [%s]"
        $message4 = "NetRemoteTOD: 0x%08X"
        $network_packet1 = { 00 00 00 9b ff 53 4d 42 72 }
        $network_packet2 =  { 00 00 00 ac ff 53 4d 42 73 }
    condition:
        2 of them
}

rule CrowdStrike_CSIT_14088_01 : pirate_panda mozirat config 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "PIRATE PANDA MoziRAT - Encrypted Config"
        reports = "CSIT-13033,CSIT-13037,CSIR-13012,CSIT-14088"
        version = "201807300909"
        last_modified = "2018-07-30"
        actor = "PIRATE PANDA"
        malware_family = "MoziRAT"
    strings:
        // RAT version
        $version = "PH5.0 "
        // Encrypted config magic string
        $encconfmagic = { d8 e5 15 56 8b f4 42 ba f0 75 32 02 d7 }
    condition:
        all of them
}

rule CrowdStrike_CSIR_14008_24 : fancy_bear rat xagent 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "FANCY BEAR X-Agent RAT"
        reports = "CSIR-14008"
        version = "201911050805"
        last_modified = "2019-11-05"
        actor = "FANCY BEAR"
        malware_family = "X-Agent"
    strings:
        $u_mutex = "AZZYMutex" ascii wide
        $u_mailslot = "\\\\.\\mailslot\\dns_check_mes_v47313" wide
        $u_extchan = ".?AVIPTExternChannel@@" ascii
        $u_agentkern = "@Udata_channels@?1??getXAgentInfo@AgentKernel@@" ascii
        $u_pdb = "d:\\Shared Data\\Data\\FINAL DATA\\spec_ver\\azzy_dll_sslmail_2008\\Release\\azzy_dll_sslmail_2008.pdb" ascii
        $tmp1 = "%s\\zdg6EF885E2.tmp" wide
        $tmp2 = "%s\\zdg6E85F98675.tmp" wide
        $tmp3 = "edg6E85F98675.tmp" wide
        $tmp4 = "edg6EF885E2.tmp" wide
        $s00 = "# EXC: HttpSender - Cannot create Post Channel!" ascii
        $s01 = "# EXC: HttpSender - Cannot create Get Channel!" ascii
        $s02 = "#EXT_5 Cannot create ExtChannelToProcessThread!" ascii
        $s03 = "#EXT_4 Cannot create ExtChannelToProcessThread!" ascii
        $s04 = "#EXC_2 Cannot create ProcToExt Pipe!" ascii
        $s05 = "#EXC_1 Cannot create ExtToProc Pipe!" ascii
        $s06 = "#EXT_3 Cannot create Process!" ascii
        $s07 = "<tr><td>%d</td><td>%02d/%02d/%d %02d:%02d</td><td>%s\\%s</td></tr>" wide
        $vol = "Currently monitoring all mounted vollumes." wide
        $s08 = " did not start!!!" wide
        $s09 = " did not stopped!!!" wide
        $s10 = "<font size=4 color=red>comm isn't success</font><br>" wide
        $s11 = "<font size=4 color=red>com 6 is success</font>" ascii
        $s12 = "<font size=4 color=red>com 7 is success</font>" ascii
        $s13 = "<font size=4 color=red>com isn't success</font>" ascii
        $s14 = "<font size=4 color=red>process is exist</font>" ascii
        $s15 = "<font size=4 color=red>File don't create</font><br>" wide
    condition:
        any of ($u_*) or 4 of them
}

rule CrowdStrike_CSIT_14093_01 : aspxspy_variant emissary_panda webshell ykcai 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "YKCAI webshell (ASPXSpy variant)"
        reports = "CSIT-14093"
        version = "202106141517"
        last_modified = "2021-06-14"
        actor = "EMISSARY PANDA"
        malware_family = "YKCAI"
    strings:
        $menu1 = "CmdShell" wide ascii
        $menu2 = "SU Exp" wide ascii
        $menu3 = "PortScan" wide ascii
        $title = "YKCAI'S SHELL" wide ascii
    condition:
        2 of ($menu*) or $title
}

rule CrowdStrike_CSIT_14087_01 : andromeda dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Dropper for Andromeda malware"
        reports = "CSIT-14087"
        version = "201409170000"
        last_modified = "2014-09-17"
        malware_family = "Andromeda"
    strings:
        $pdbpath = "I:\\Ference\\addres\\documents2.pdb"
    condition:
        all of them
}

rule CrowdStrike_CSIT_14087_02 : andromeda 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Andromeda C2 beacon format string"
        reports = "CSIT-14087"
        version = "201904171107"
        last_modified = "2019-04-17"
        malware_family = "Andromeda"
    strings:
        // Format strings for the C2 beacon
        $c2format1 = "id:%lu|bid:%lu|os:%lu|la:%lu|rg:%lu"
        $c2format2 = "id:%lu|tid:%lu|err:%lu|w32:%lu"
        $c2format3 = "id:%lu|bid:%lu|bv:%lu|sv:%lu|pa:%lu|la:%lu|ar:%lu"
    condition:
        any of them
}

rule CrowdStrike_CSIT_14089_01 : qaz_rat rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "QAZ RAT, version 1"
        reports = "CSIT-14089"
        version = "201807300910"
        last_modified = "2018-07-30"
        malware_family = "QAZ RAT"
    strings:
        // C2 password
        $c2pass = "2wsx1qaz"
        // Unused password
        $unusedpass = "@WSX1qaz"
        // Function prologue in version with plain c2 hostnames
        $prologue = { 50 64 89 25 00 00 00 00 81 ec 94 01 00 00 53 56 }
    condition:
        all of them
}

rule CrowdStrike_CSIT_14089_02 : qaz_rat rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "QAZ RAT, version 2"
        reports = "CSIT-14089"
        version = "201807300911"
        last_modified = "2018-07-30"
        malware_family = "QAZ RAT"
    strings:
        // C2 password
        $c2pass = "2wsx1qaz"
        // Unused password
        $unusedpass = "@WSX1qaz"
        // Function prologue in version with xored c2 hostnames
        $prologue = { 50 64 89 25 00 00 00 00 81 ec 94 01 00 00 83 c9 ff 33 c0 53 56 }
    condition:
        all of them
}

rule CrowdStrike_CSIT_14091_01 : gh0st loader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Gh0st side loader"
        reports = "CSIT-14091"
        version = "201409300000"
        last_modified = "2014-09-30"
        malware_family = "Gh0st"
    strings:
        $compression_loop = { 8b 4d 08 33 c0 c1 ef 02 8a 01 8b d0 8b c3 c1 e2 02 2b c2 2b c7 }
    condition:
        $compression_loop
}

rule CrowdStrike_CSIT_14097_01 : delivery_document cve_2012_0158 cve_2014_1761 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detection of RTF file exploiting both CVE-2014-1761 and CVE-2012-0158"
        reports = "CSIT-14097"
        version = "201807160831"
        last_modified = "2018-07-16"
    strings:
        $magic = "{\\rt"
        $generator = "Msftedit 5.41.15.1507"
        // otkloadr.WRAssembly.1, CVE-2014-1761
        $progid1 = "6f746b6c6f6164722e5752417373656d626c792e3100"
        // MSComctlLib.Toolbar.2, CVE-2012-0158
        $progid2 = "4d53436f6d63746c4c69622e546f6f6c6261722e32"
    condition:
        ($magic and $generator and (2 of ($progid*)))
}

rule CrowdStrike_CSIT_14097_02 : dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detection of initial Visual Basic dropper file"
        reports = "CSIT-14097"
        version = "201807160831"
        last_modified = "2018-07-16"
    strings:
        $header = { 4f 6e 20 45 72 72 6f 72 20 52 65 73 75 6d 65 20 4e 65 78 74 0a 63 3d }
        $crypt = { 52 65 74 53 74 72 28 78 29 20 3d 20 43 68 72 28 20 41 73 63 28 4d 69 64 28 53 74 72 2c 78 2c 31 29 29 20 2d 20 41 73 63 28 4d 69 64 28 4b 65 79 2c 50 6f 73 2c 31 29 29 20 29 }
        $pathexpand = { 66 73 6f 2e 42 75 69 6c 64 50 61 74 68 28 20 57 73 68 53 68 65 6c 6c 2e 45 78 70 61 6e 64 45 6e 76 69 72 6f 6e 6d 65 6e 74 53 74 72 69 6e 67 73 28 61 29 2c 20 6e 6e 29 }
    condition:
        2 of them
}

rule CrowdStrike_CSIT_14097_03 : loader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detection of polymorphed DLL in first state"
        reports = "CSIT-14097"
        version = "201807251348"
        last_modified = "2018-07-25"
    strings:
        $dllname = /[a-zA-Z0-9]{4,12}\.dll\.polymorphed\.dll/
    condition:
        $dllname
}

rule CrowdStrike_CSIT_14097_04 : loader unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detection of DLL in second state - in-memory only"
        reports = "CSIT-14097"
        version = "201807160832"
        last_modified = "2018-07-16"
    strings:
        $lzma_header = { c6 45 f0 5d c6 45 f1 00 c6 45 f2 00 c6 45 f3 00 c6 45 f4 01 }
        $aes_loop = { 8b 55 d0 0f b6 44 15 d8 8b 4d cc 03 4d d0 0f b6 11 33 d0 8b 45 cc 03 45 d0 88 10 }
        $aes_keysize_check = { 81 7d f0 80 00 00 00 74 14 81 7d f0 c0 00 00 00 74 1a 81 7d f0 00 01 00 00 74 20 }
    condition:
        $lzma_header and (1 of ($aes_*))
}

rule CrowdStrike_CSIT_14097_05 : rat unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detection of DLL in final state - in-memory only."
        reports = "CSIT-14097"
        version = "201807160832"
        last_modified = "2018-07-16"
    strings:
        $fmt = "_%u-%u%1c"
        $sysdrive = "SystemDrive" wide
        $aes_loop = { 8b 55 d0 0f b6 44 15 d8 8b 4d cc 03 4d d0 0f b6 11 33 d0 8b 45 cc 03 45 d0 88 10 }
    condition:
        all of them
}

rule CrowdStrike_CSIT_14090_01 : lurk dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Rule alerts on data pushed on to the stack by the LURK dropper"
        reports = "CSIT-14090"
        version = "201410020000"
        last_modified = "2014-10-02"
        malware = "LURK"
    strings:
        // Key pushed on stack
        $keyfrag_1 = { c6 44 24 0c 61 c6 44 24 0d 71 c6 44 24 0e 70 88 4c 24 0f c6 44 24 11 7a c6 44 24 12 75 c6 44 24 13 69 88 4c 24 14 c6 44 24 16 78 c6 44 24 17 66 c6 44 24 18 67 c6 44 24 19 73 c6 44 24 1a 65 c6 44 24 1b 72 }
        $keyfrag_2 = { c6 44 24 11 65 c6 44 24 12 74 88 5c 24 14 c6 44 24 16 61 c6 44 24 17 71 88 54 24 19 88 4c 24 1a 88 5c 24 1b c6 44 24 1d 69 88 54 24 1e 88 4c 24 1f c6 44 24 20 78 c6 44 24 21 66 c6 44 24 22 67 c6 44 24 23 73 c6 44 24 24 65 c6 44 24 25 72 }
    condition:
        any of them
}

rule CrowdStrike_CSIT_14090_02 : lurk rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Identifies routine used by LURK to perform a transform against a BMP to turn it into a malicious DLL"
        reports = "CSIT-14090"
        version = "201410020000"
        last_modified = "2014-10-02"
        malware = "LURK"
    strings:
        $fp_1 = { d9 5c 24 34 db 44 24 24 89 74 24 24 d9 5c 24 38 db 44 24 24 d9 5c 24 3c }
        $fp_2 = { d9 ee d9 55 d? f7 df d9 e8 89 7d f4 d9 5d }
        $fp_3 = { d9 ee [0-6] d9 55 ?? d9 e8 f7 d? d9 5d }
    condition:
        any of them
}

rule CrowdStrike_CSIT_14090_03 : lurk rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Identifies part of a routine to decode strings used by the LURK trojan"
        reports = "CSIT-14090"
        version = "201410020000"
        last_modified = "2014-10-02"
        malware = "LURK"
    strings:
        // Check for "_ws"
        $check_1 = { 80 38 5f [0-6] 80 78 01 77 ?? ?? 80 78 02 73 }
        // Check for "_as"
        $check_2 = { 80 78 01 61 [0-8] 80 38 5f ?? ?? 80 78 02 73 }
    condition:
        any of them
}

rule CrowdStrike_CSIT_14090_05 : lurk rat key 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Alerts on key data present in the LURK trojan"
        reports = "CSIT-14090"
        version = "201410020000"
        last_modified = "2014-10-02"
        malware = "LURK"
    strings:
        $key1 = { c6 45 f4 68 c6 45 f5 74 c6 45 f6 74 c6 45 f7 70 c6 45 f8 3a c6 45 f9 2f c6 45 fa 2f }
        $key2 = { c7 45 f4 68 74 74 70 66 c7 45 f8 3a 2f c6 45 fa 2f }
    condition:
        any of them
}

rule CrowdStrike_CSIT_14090_04 : lurk rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Alerts on strings present in the decoded dropped file used by the LURK trojan"
        reports = "CSIT-14090"
        version = "201807300848"
        last_modified = "2018-07-30"
        malware = "LURK"
    strings:
        $str_png = "pngfilt.DllGetClassObject" ascii wide
        $fmt_1a = "%s\\%s\\%s\\%s\\%s\\%s\\%s"
        $fmt_1b = "%s\\%s\\%s\\%s\\%s\\%s"
        $fmt_2 = "%u/%u/%u/"
        $str_inet = "xInteretReadFile"
        $str_key_plain_1 = "zslewmxdpqz"
        $str_key_plain_2 = "hzpwgliswit"
    condition:
        (any of ($str_*)) and 2 of them
}

rule CrowdStrike_CSIT_14096_01 : iworm worm macos 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "iWorm, 2014 version"
        reports = "CSIT-14096"
        version = "201410070000"
        last_modified = "2014-10-07"
        malware_family = "iWorm"
    strings:
        // Characteristic strings
        $upxinfo = "$Info: This file is packed with the UPX executable packer http://upx.sf.net $"
        $upxid = "$Id: UPX 3.91 Copyright (C) 1996-2013 the UPX Team. All Rights Reserved. $"
        $upxhdr = { 3c c3 25 ce 55 50 58 21 }
        $packeddata = { 36 4d b7 fc ce fa ed fe 07 00 03 03 02 0f 50 06
        ff 5d d7 5e 85 00 01 00 0b 38 03 5f 5f 50 41 47
        45 5a 45 52 5f 0a 79 d9 4f 00 00 10 00 37 d0 cd
        0e d9 9f 01 54 45 58 54 33 f0 04 0b 6f c1 ba cf
        }
    condition:
        all of them
}

rule CrowdStrike_CSIT_14096_02 : iworm worm macos 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "iWorm, 2014 version"
        reports = "CSIT-14096"
        version = "201410070000"
        last_modified = "2014-10-07"
        malware_family = "iWorm"
    strings:
        // Characteristic strings
        $fmtstr1 = "%2d%2d%2d%2d%2d%2dZ"
        $fmtstr2 = "%4d%2d%2d%2d%2d%2dZ"
        $fmtstr3 = { 47 45 54 20 25 73 20 48 54 54 50 2f 31 2e 30 0d
        0a 48 6f 73 74 3a 20 25 73 0d 0a 41 63 63 65 70
        74 3a 20 74 65 78 74 2f 68 74 6d 6c 0d 0a 0d 0a
        }
        $dir = "/tmp/.JavaW"
        $encstr = { 97 d9 97 97 82 82 99 93 8e 97 82 a7 00 }
    condition:
        all of them
}

rule CrowdStrike_CSIT_14096_03 : iworm dropper macos 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "iWorm, 2014 version"
        reports = "CSIT-14096"
        version = "201410080000"
        last_modified = "2014-10-08"
        malware_family = "iWorm"
    strings:
        // Characteristic strings
        $xml = { 2e 30 22 20 65 6e 63 6f 64 69 6e 67 3d 22 55 54
        46 2d 38 22 3f 3e 0a 3c 21 44 4f 43 54 59 50 45
        20 70 6c 69 73 74 20 50 55 42 4c 49 43 20 22 2d
        2f 2f 41 70 70 6c 65 2f 2f 44 54 44 20 50 4c 49
        53 54 20 31 2e 30 2f 2f 45 4e 22 20 22 68 74 74
        70 3a 2f 2f 77 77 77 2e 61 70 70 6c 65 2e 63 6f
        6d 2f 44 54 44 73 2f 50 72 6f 70 65 72 74 79 4c
        69 73 74 2d 31 2e 30 2e 64 74 64 22 3e 0a 3c 70
        6c 69 73 74 20 76 65 72 73 69 6f 6e 3d 22 31 2e
        30 22 3e 0a 3c 64 69 63 74 3e 0a 3c 6b 65 79 3e
        4c 61 62 65 6c 3c 2f 6b 65 79 3e 0a 3c 73 74 72
        69 6e 67 3e 00 3c 2f 73 74 72 69 6e 67 3e 0a 3c
        6b 65 79 3e 50 72 6f 67 72 61 6d 41 72 67 75 6d
        65 6e 74 73 3c 2f 6b 65 79 3e 0a 3c 61 72 72 61
        79 3e 0a 3c 73 74 72 69 6e 67 3e 00 3c 2f 73 74
        72 69 6e 67 3e 0a 3c 2f 61 72 72 61 79 3e 0a 3c
        6b 65 79 3e 52 75 6e 41 74 4c 6f 61 64 3c 2f 6b
        65 79 3e 0a 3c 74 72 75 65 2f 3e 0a 3c 2f 64 69
        63 74 3e 0a 3c 2f 70 6c 69 73 74 3e 00
        }
        $str1 = "/Library/Application Support/JavaW"
        $str2 = "com.JavaW"
        $str3 = ".plist"
        $str4 = "launchctl load "
        $str5 = "launchctl start "
    condition:
        all of them
}

rule CrowdStrike_CSIT_14095_02 : hurricane_panda cve_2014_4113 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Strings found in executable exploit CVE-2014-4113. It is possible these strings are a remnant of a broader exploit building toolkit."
        reports = "CSIT-14095"
        version = "201410140000"
        last_modified = "2014-10-14"
        actor = "HURRICANE PANDA"
    strings:
        // Error Messages
        $err1 = "[%d] Failed, %08X"
        $err2 = "[%d] Offset can not fetched"
        $mudhorse = "woqunimalegebi"
    condition:
        all of ($err*) or $mudhorse
}

rule CrowdStrike_CSIT_14107_01 : dyre trojan 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Dyre Trojan"
        reports = "CSIT-14107"
        version = "201410220000"
        last_modified = "2014-10-22"
        malware_family = "Dyre"
    strings:
        $config_name = "2ete64.vas" wide
        $useragent = "Wget/1.9+cvs-stable (Red Hat modified)"
        $modules_32 = { 6d 5f 76 6e 63 33 32 00 74 76 33 32 00 }
        $modules_64 = { 6d 5f 76 6e 63 36 34 00 74 76 36 34 00 }
        $error_1 = "send browser snapshot failed"
        $mutex = "Global\\1g2hk1hyj" wide
    condition:
        3 of them
}

rule CrowdStrike_CSIT_14107_02 : dyre trojan dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Dyre Trojan dropper"
        reports = "CSIT-14107"
        version = "201410220000"
        last_modified = "2014-10-22"
        malware_family = "Dyre"
    strings:
        $mutex = "Global\\1g2hk1hyj" wide
        $service = "Google Update Service" wide
        $error_1 = "ZwQueueApcThread: error code = %x" wide
        $error_2 = "NtMapViewOfSection: error code = %x" wide
    condition:
        3 of them
}

rule CrowdStrike_CSIT_14103_01 : pushdo downloader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Pushdo Downloader Variant B"
        reports = "CSIT-14103"
        version = "201410230000"
        last_modified = "2014-10-23"
        malware_family = "Pushdo"
    strings:
        // Byte matches
        $publickey = {
        06 02 00 00 00 a4 00 00 52 53 41 31 00 04 00 00
        01 00 01 00 a1 11 c7 c0 6d 5a 0b fe 35 27 14 cc
        48 fb 1b 11 d3 36 54 bc c6 7e f6 98 24 2c 6a 5a
        c5 38 8b 44 fe 8f 66 ac 7c 94 37 70 a9 d6 fb 80
        2f a6 e5 a3 b3 f9 4c 26 b3 a4 47 ad 8f f1 44 c6
        04 5e 8a 63 f3 be ea 2d a9 dc 32 db 22 a9 ca 40
        48 e6 09 5b 15 92 81 6f a0 40 c2 46 95 dc 27 d8
        7f 7b 01 a1 e8 a8 59 5b 9f b3 56 ea 83 6d a7 3e
        02 ec da 2d 8a 08 2d 56 7a 8b 74 4f 18 c8 d7 ce
        eb f8 04 a5
        }
        $privatekey = {
        07 02 00 00 00 a4 00 00 52 53 41 32 00 04 00 00
        01 00 01 00 b1 4f 1f be ca 45 ad 6f 65 1a 60 56
        10 2e dd 72 33 cf 77 49 5f f0 2d e8 54 d8 3c 33
        78 03 29 c6 ae 4c b0 e1 79 5d 50 1d d6 a4 84 94
        c3 7c 52 ac 5d 9f b1 57 b9 3e 17 14 98 c7 da 8e
        8c b2 79 21 7a 85 8a 3e 62 02 df 9e c8 52 4f cd
        ff 8f 5d ca 3b 64 d7 82 27 f8 77 71 58 a2 a8 82
        e5 dd 94 e7 c6 a2 b8 b2 89 ea 3c 72 be 24 60 2a
        18 18 fa 47 36 fe 74 36 56 62 de 39 33 42 f5 be
        85 52 ba bf fb 9f b2 1b 58 05 17 7f f8 d8 de 71
        85 50 96 de e2 bd aa 7c 77 ff 60 b3 33 3e 79 20
        bd d7 36 66 f0 e3 d4 0a 67 d0 5f c0 09 3a af 6b
        ec b5 01 fe d4 b9 0c bb 30 b4 96 5d 0c 39 a9 8e
        16 c6 7f f6 43 83 e6 21 1c 53 d8 bd 19 67 18 fe
        0f 95 70 56 41 db 38 e1 99 52 24 9e fc d3 eb 43
        bb 13 f7 66 7d 4d 7d c8 78 21 98 e4 01 31 b1 ed
        97 7d b7 3a fc 88 b0 de d3 30 06 cc 90 da 57 dd
        aa 1d 1e c7 9f 95 79 54 61 f5 75 99 36 0c c8 91
        d7 cf 77 bc 97 ee 13 d4 70 0e 36 ba 85 4c 9c 5c
        d8 e3 f5 8d 5f 09 81 8a de bb 15 18 ee fe 0e 0f
        71 69 bd c7 16 ab 9e c9 d9 4c 82 2a fc 30 3e 23
        4a 1b 1a 5e 4d 8f 8d 46 29 d8 a7 49 bb 23 7a 05
        93 f5 a2 8a d4 9e d8 09 20 91 9e a0 ae 7d c3 95
        71 9e 2e b8 ac 9a 7a 28 a8 6c 2a 23 96 33 7e dc
        58 05 58 99 dd dd 73 43 de 17 74 7d b3 fd 58 9d
        33 2d 5e 8a 35 af be c2 8c 1b f9 ab ec ef 31 2c
        de 15 49 7e 8e 2f 5b 79 26 5b ce 5f 6b 02 f2 4e
        07 0e 2f d4 18 fc 13 33 ea e5 a6 2f 12 ce e1 f4
        ce ba 05 b6 63 bb 27 87 ce 9d ac 44 1b b1 13 a2
        b5 de 3d 40 21 51 c2 2b b8 1b 57 09 62 78 75 8a
        b8 4e 5d e3 97 9a 97 34 ac 0a 1c 28 c4 69 49 70
        79 47 04 8e b6 cd 0a a8 ed 21 db 6f 60 27 ef 62
        12 5e dc 8a 63 5f 3f dd b6 15 e2 7b fa c9 d7 82
        f7 38 29 56 53 5f 1b 08 30 3f 4e 51 92 9e e5 74
        9b 02 cf bb 93 e9 10 00 35 5f 3a 24 8a 7e eb 94
        82 2a ce 20 72 05 96 3c 86 e7 28 9e 2c ed fb 3f
        de 8c bb b5 44 93 76 f8 99 4a 11 a3 d9 c2 46 88
        42 32 22 20
        }
        // String matches
        $seed1 = "qkbhctjdwfglmpxzrvsn"
        $seed2 = "ouyaei"
        $seed3 = "ioau"
        $seed4 = "zlbqgtrknxfspcmd"
    condition:
        all of them
}

rule CrowdStrike_CSIT_14103_02 : pushdo downloader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Pushdo Downloader Variant B"
        reports = "CSIT-14103"
        version = "201410230000"
        last_modified = "2014-10-23"
        malware_family = "Pushdo"
    strings:
        // Byte matches
        $randconstants = { 69 c0 0d 66 19 00 05 5f f3 6e 3c 33 d2 f7 75 08 8b c2 }
        $imulconstant = { 69 c0 0d 66 19 00 }
        $modcheck = { 69 c0 cb 1e 00 00 }
        $seedrand = { 68 3d 50 08 00 e8 }
        // String matches
        $mscrypt = "Microsoft Enhanced Cryptographic Provider v1.0"
        $targetproc = "\\system32\\svchost.exe"
        $selfdelete = ":repeat\x0d\x0adel %s\x0d\x0aif exist %s goto :repeat\x0d\x0adel %%0"
    condition:
        #imulconstant > 2 and 4 of($randconstants, $modcheck, $seedrand, $mscrypt, $targetproc, $selfdelete)
}

rule CrowdStrike_CSIT_14099_01 : fraternal_jackal script 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "FRATERNAL JACKAL Joomla scanner"
        reports = "CSIT-14099"
        version = "201410270000"
        last_modified = "2014-10-27"
        actor = "FRATERNAL JACKAL"
    strings:
        $decryption_chain = "eval(gzinflate(str_rot13(base64_decode('"
    condition:
        all of them
}

rule CrowdStrike_CSIT_14102_01 : credential_dumper post_exploitation 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "ReadPwd/getpass Windows logon credential dumping tool"
        reports = "CSIT-14102"
        version = "201410270000"
        last_modified = "2014-10-27"
    strings:
        $ = "Try To Run As Administrator ..."
        $ = "echo Press any Key to EXIT ... & pause > nul"
        $ = "[Undefined OS version]  Major: %d Minor: %d"
        $ = "Specific LUID NOT found"
        $ = "echo Press any Key to Continue ... & pause > nul"
        $ = "GetProcessHandleByName fail !"
        $ = "EnableDebugPrivilege fail !"
        $ = "LsaEnumerateLogonSessions"
    condition:
        3 of them
}

rule CrowdStrike_CSIT_14104_01 : bitterbug 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Bitterbug information exfiltration tool"
        reports = "CSIT-14104"
        version = "201410300000"
        last_modified = "2014-10-30"
        malware_family = "BitterBug"
    strings:
        $ = ".php?compname="
        $ = "/path_active.php?compname="
        $ = "/fetch_updates_pops.php?compname="
        $ = "/is_array_own.php?compname="
        $ = "/checkpkg.php?compname="
        $ = "/versionchk.php?srs="
        $ = "/vtris.php?srs="
        $ = "/vtris1.php?srs="
        $ = "/fetch_updates_step.php?compname="
        $ = "/c wmic diskdrive list brief > "
        $ = "/petal_active.php?compname="
        $ = "percf001.dat"
        $ = "_percf001.dat"
        $ = "curl_easy_perform"
        $ = "http://199.91.173.45/percf002.dat"
        $ = "http://199.91.173.45/update_dll.dll"
        $ = "http://199.91.173.45/libcurld.dll"
        $ = "!microsoft!winusb.exe"
        $pdb1 = "C:\\Intel\\Logs\\file.pdb"
        $pdb2 = "C:\\Users\\Tranchulas\\Documents\\Visual Studio 2008\\Projects\\upload\\Release\\upload.pdb"
        $pdb3 = "C:\\Users\\Cert-India\\Documents\\Visual Studio 2008\\Projects\\ufile\\Release\\ufile.pdb"
    condition:
        3 of them or any of ($pdb*)
}

rule CrowdStrike_CSIT_14119_01 : zoxpng rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "ZoxPNG RAT"
        reports = "CSIT-14119"
        version = "201410300000"
        last_modified = "2014-10-30"
        malware_family = "ZoxPNG"
    strings:
        $ = "[IISEND=0x%08X][Recv:] 0x%08X %s"
        $ = "IISCMD Error:%d"
        $ = "Not Support This Function!"
        $ = "imgurl=http://%s/%04d-%02d/%04d%02d%02d%02d%02d%02d.png&w=800&h=600&ei="
        $ = "png&w=800&h=600&ei=CnJcUcSBL4rFkQX444HYCw&zoom=1&ved=1t:3588,r:1,s:0,i:92&iact=rc&dur=368&page=1&tbnh=184&tbnw=259&start=0&ndsp=20&tx=114&ty="
    condition:
        any of them
}

rule CrowdStrike_CSIT_14115_01 : zxshell rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "ZxShell RAT information exfiltration tool"
        reports = "CSIT-14115"
        version = "201807300938"
        last_modified = "2018-07-30"
        malware_family = "ZxShell"
    strings:
        $pdbstring = "h:\\Prj2012\\zxapp-console\\RemoteDeskTop\\ReleaseTest\\RemoteDeskTop.pdb"
        $transfile1 = "TransFile -get http://x.x.x.x/a.exe c:\\a.exe -run (launch it after downloading completed.)"
        $sendfscreen = "sendFirstScreen Size=%d Ret=%d."
        $zxplug = "zxplug -add getxxx c:\\xyz.dll -fromurl http://x.x.x/x.dll "
    condition:
        any of them
}

rule CrowdStrike_CSIR_14007_01 : berserk_bear certificate 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Rule to detect fake certificates used in BERSERK BEAR malware"
        reports = "CSIR-14007"
        version = "201410310000"
        last_modified = "2014-10-31"
        actor = "BERSERK BEAR"
    strings:
        $adobe = { 81 82 5f 6f b7 5a 9a 80 4c d8 6d be d2 a8 89 8b }
        $intel = { 00 c8 2c 59 ec eb 94 a3 49 ff be 96 f6 b2 ac a6 }
    condition:
        any of them
}

rule CrowdStrike_CSIR_14007_02 : berserk_bear rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Rule to detect functions exported by BERSERK BEAR malware"
        reports = "CSIR-14007"
        version = "201410310000"
        last_modified = "2014-10-31"
        actor = "BERSERK BEAR"
    strings:
        $export_explorer = "Explorer@4"
        $export_browser  = "_Browser@4"
    condition:
        all of them
}

rule CrowdStrike_CSIR_14007_03 : berserk_bear barbarian rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Rule to detect BARBARIAN malware used by BERSERK BEAR"
        reports = "CSIR-14007"
        version = "201410310000"
        last_modified = "2014-10-31"
        actor = "BERSERK BEAR"
        malware_family = "BARBARIAN"
    strings:
        $md5_export = "?_tMd5@CryptNs@@YAPA_WPAXI@Z"
        $crypt_ns = ".?AV_NoCrypt@CryptNs@@"
        $str_cmdtype = "CmdType" wide
        $str_openreg = "OpenRegNoCrypt" wide
        $str_sysregc = "SystemRegCrypt" wide
        $str_sysregnc = "SystemRegNoCrypt" wide
        $str_inregnc = "InRegNoCrypt" wide
        $str_outregnc = "OutRegNoCrypt" wide
        $str_efilereg = "EFileRegNoCrypt" wide
        $str_cfail = "Crypt failure" wide
        $file_1 = "Exec.txt" wide
        $file_2 = "BigReceipt.txt" wide
        $file_3 = "ChangeServer.txt" wide
        $file_4 = "Delay.txt" wide
        $file_5 = "CFailure.txt" wide
        $file_6 = "UFailure.txt" wide
        $file_7 = "Unknown.txt" wide
        $status_1 = "Delay send success" wide
        $status_2 = "Delay receive success" wide
        $status_3 = "File new success" wide
        $status_4 = "File delete success" wide
    condition:
        $md5_export or $crypt_ns or
        (3 of ($str_*)) or
        (3 of ($file_*)) or
        (3 of ($status_*))
}

rule CrowdStrike_CSIR_14007_04 : berserk_bear barbarian rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Rule to detect BERSERK BEAR crypt bytes"
        reports = "CSIR-14007"
        version = "201410310000"
        last_modified = "2014-10-31"
        actor = "BERSERK BEAR"
        malware_family = "BARBARIAN"
    strings:
        $byte_sub = { 8a 44 24 04 8a c8 80 e1 01 d0 e8 84 c9 74 06 f6 d0 24 7f f6 d0 c2 04 00 }
    condition:
        $byte_sub
}

rule CrowdStrike_CSIR_14007_05 : berserk_bear rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Rule to detect Email-C2 malware used by BERSERK BEAR"
        reports = "CSIR-14007"
        version = "201410310000"
        last_modified = "2014-10-31"
        actor = "BERSERK BEAR"
    strings:
        $dllname = "msdnet32.dll" ascii wide
        $api_1 = "_NtDSLLRC@4"
        $api_2 = "_NtDSLLRV@8"
        $api_3 = "_NtDSLLSPCTY@12"
        $api_4 = "_xDSLConnect@8"
        $api_5 = "_NtDSLLSPC@8"
        $api_6 = "_NtDSLLSP@20"
        $api_7 = "_SafeModeNt@12"
        $api_8 = "_NtDR@0"
        $file_1 = "crF32lib.dll"
        $file_2 = "crFlib.dll"
        $reg_1  = "CLSID"
        $reg_2  = "BX"
        $reg_3  = "EX"
        $reg_4  = "S0"
        $reg_5  = "S1"
        $reg_6  = "S2"
    condition:
        ((1 of ($api_*)) or $dllname)
        and
        ((all of ($reg_*)) or (all of ($file_*)))
}

rule CrowdStrike_CSIR_14007_06 : berserk_bear delivery_document 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "RRule to detect BERSERK BEAR PDF exploit file"
        reports = "CSIR-14007"
        version = "201410310000"
        last_modified = "2014-10-31"
        actor = "BERSERK BEAR"
    strings:
        $creation = "/CreationDate (D:20111114160831)"
    condition:
        $creation
}

rule CrowdStrike_CSIR_14007_07 : berserk_bear rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Rule identifying file names used by BERSERK BEAR"
        reports = "CSIR-14007"
        version = "201410310000"
        last_modified = "2014-10-31"
        actor = "BERSERK BEAR"
    strings:
        $fn1 = "shellsrv32.dll" ascii wide
        $fn2 = "msdnet.dll" ascii wide
        $fn3 = "shellsrv.dll" ascii wide
        $fn4 = "msdnet32.dll" ascii wide
        $fn5 = "altsrv.exe" ascii wide
        $fn6 = "altnet.exe" ascii wide
        $fn7 = "altnet32.exe" ascii wide
    condition:
        2 of them
}

rule CrowdStrike_CSIR_14007_08 : berserk_bear barbarian rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Rule to detect partial URI used by BERSERK BEAR BARBARIAN malware"
        reports = "CSIR-14007"
        version = "201410310000"
        last_modified = "2014-10-31"
        actor = "BERSERK BEAR"
        malware_family = "BARBARIAN"
    strings:
        $u = "heg235_add.php" ascii wide
    condition:
        $u
}

rule CrowdStrike_CSIR_14007_09 : berserk_bear rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Rule identifying mutexes used by BERSERK BEAR malware"
        reports = "CSIR-14007"
        version = "201410310000"
        last_modified = "2014-10-31"
        actor = "BERSERK BEAR"
    strings:
        $mutex_1 = "{118-32-FOOBOX-15}" ascii wide
        $mutex_2 = "{118-32-FOOBOLL-15}" ascii wide
        $mutex_3 = "{132-79-FOOTBOLL-18}" ascii wide
        $mutex_4 = "{119-36-FOOTBOLL-92}" ascii wide
        $gen_1 = "FOOBOX" ascii wide
        $gen_2 = "FOOBOLL" ascii wide
    condition:
        (all of ($gen_*)) or 1 of ($mutex_*)
}

rule CrowdStrike_CSIR_14007_11 : berserk_bear rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Rule identifying string appearing in packed versions of BERSERK BEAR malware"
        reports = "CSIR-14007"
        version = "201410310000"
        last_modified = "2014-10-31"
        actor = "BERSERK BEAR"
    strings:
        $pauseprintspool  = "_PausePrintSpool"
    condition:
        $pauseprintspool
}

rule CrowdStrike_CSIR_14007_12 : berserk_bear dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Rule detecting string included in BERSERK BEAR malware dropper"
        reports = "CSIR-14007"
        version = "201410310000"
        last_modified = "2014-10-31"
        actor = "BERSERK BEAR"
    strings:
        $lint = "%Error Set Lint into file failed. %d" ascii wide
    condition:
        $lint
}

rule CrowdStrike_CSIR_14007_13 : berserk_bear barbarian rat artifact 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Rule identifying log file name used by BERSERK BEAR BARBARIAN malware"
        reports = "CSIR-14007"
        version = "201410310000"
        last_modified = "2014-10-31"
        actor = "BERSERK BEAR"
        malware_family = "BARBARIAN"
    strings:
        $log = "NadzorLog.txt" ascii wide
    condition:
        $log
}

rule CrowdStrike_CSIR_14007_14 : berserk_bear tasking 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Rule identifying string appearing in password stealer BERSERK BEAR module"
        reports = "CSIR-14007"
        version = "201410310000"
        last_modified = "2014-10-31"
        actor = "BERSERK BEAR"
    strings:
        $second = "_SecondPrintSpool" ascii wide
    condition:
        $second
}

rule CrowdStrike_CSIR_14007_15 : berserk_bear rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Rule detecting BERSERK BEAR XOR routine"
        reports = "CSIR-14007"
        version = "201410310000"
        last_modified = "2014-10-31"
        actor = "BERSERK BEAR"
    strings:
        $start = { 83 ff 05 72 06 8a 55 18 30 14 37 41 81 f9 ff 03 00 00}
    condition:
        $start
}

rule CrowdStrike_CSIR_14007_16 : berserk_bear password 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Rule identifying salt used in BERSERK BEAR malware"
        reports = "CSIR-14007"
        version = "201410310000"
        last_modified = "2014-10-31"
        actor = "BERSERK BEAR"
    strings:
        $pw = "jbcyreg43lerjf893JHBDGFLUH8E9849jfmd39lieux8f8LOIUYC540IQixcm589y8943p209ifhw84hGdOI2d9slv" ascii wide
    condition:
        $pw
}

rule CrowdStrike_CSIR_14007_17 : berserk_bear artifact 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Rule identifying LNK filename associated with BERSERK BEAR malware"
        reports = "CSIR-14007"
        version = "201410310000"
        last_modified = "2014-10-31"
        actor = "BERSERK BEAR"
    strings:
        $sysshell = "SysShell.lnk" ascii wide
    condition:
        any of them
}

rule CrowdStrike_CSIR_14007_18 : berserk_bear rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Rule detecting MIME delimiter used in BERSERK BEAR malware"
        reports = "CSIR-14007"
        version = "201410310000"
        last_modified = "2014-10-31"
        actor = "BERSERK BEAR"
    strings:
        $delim = "060501080505070400060304"
    condition:
        $delim
}

rule CrowdStrike_CSIR_14007_19 : berserk_bear barbarian rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Rule detecting encoded form of C2 domain in BERSERK BEAR BARBARIAN malware"
        reports = "CSIR-14007"
        version = "201410310000"
        last_modified = "2014-10-31"
        actor = "BERSERK BEAR"
        malware_family = "BARBARIAN"
    strings:
        $enc1 = { 6E 00 65 00 74 00 00 00 2E 00 00 00 70 00 61 00 67 00 65 00 00 00 00 00 62 00 6C 00 61 00 6E 00 6B 00 00 00 77 00 68 00 69 00 74 00 65 00 00 00 }
        $enc2 = { 6E 00 65 00 74 00 00 00 00 00 00 00 2E 00 00 00 70 00 61 00 67 00 65 00 00 00 00 00 62 00 6C 00 61 00 6E 00 6B 00 00 00 00 00 00 00 77 00 68 00 69 00 74 00 65 00 00 00 }
        $enc3 = { 65 00 74 00 00 00 00 00 2E 00 6E 00 00 00 00 00 70 00 61 00 67 00 65 00 00 00 00 00 62 00 6C 00 61 00 6E 00 6B 00 00 00 77 00 68 00 69 00 74 00 65 00 00 00 }
    condition:
        any of them
}

rule CrowdStrike_CSIR_14007_20 : berserk_bear barbarian rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Rule detecting encoded form of C2 domain in BERSERK BEAR BARBARIAN malware"
        reports = "CSIR-14007"
        version = "201410310000"
        last_modified = "2014-10-31"
        actor = "BERSERK BEAR"
        malware_family = "BARBARIAN"
    strings:
        $enc1 = { 66 00 6F 00 00 00 00 00 2E 00 69 00 6E 00 00 00 6E 00 65 00 77 00 73 00 00 00 00 00 77 00 6F 00 72 00 6C 00 64 00 00 00 6C 00 69 00 6E 00 6B 00 00 00 }
        $enc2 = { 69 00 6E 00 66 00 6F 00 00 00 00 00 2E 00 00 00 6E 00 65 00 77 00 73 00 00 00 00 00 77 00 6F 00 72 00 6C 00 64 00 00 00 6C 00 69 00 6E 00 6B 00 00 00 }
        $enc3 = { 66 00 6F 00 00 00 00 00 2E 00 69 00 6E 00 00 00 6C 00 64 00 6E 00 65 00 77 00 73 00 00 00 00 00 77 00 6F 00 72 00 00 00 6C 00 69 00 6E 00 6B 00 00 00 }
    condition:
        any of them
}

rule CrowdStrike_CSIR_14007_21 : berserk_bear barbarian rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Rule detecting encoded form of C2 domain in BERSERK BEAR BARBARIAN malware"
        reports = "CSIR-14007"
        version = "201410310000"
        last_modified = "2014-10-31"
        actor = "BERSERK BEAR"
        malware_family = "BARBARIAN"
    strings:
        $enc1 = { 6F 00 72 00 67 00 00 00 2E 00 00 00 66 00 66 00 00 00 00 00 73 00 74 00 61 00 00 00 66 00 75 00 6E 00 00 00 }
    condition:
        $enc1
}

rule CrowdStrike_CSIR_14007_22 : berserk_bear barbarian rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Rule detecting encoded form of C2 domain in BERSERK BEAR BARBARIAN malware"
        reports = "CSIR-14007"
        version = "201410310000"
        last_modified = "2014-10-31"
        actor = "BERSERK BEAR"
        malware_family = "BARBARIAN"
    strings:
        $enc1 = { 66 00 6F 00 00 00 00 00 2E 00 69 00 6E 00 00 00 6F 00 63 00 6B 00 00 00 62 00 6C 00 00 00 00 00 6E 00 65 00 77 00 73 00 00 00 }
        $enc2 = { 69 00 6E 00 66 00 6F 00 00 00 00 00 2E 00 00 00 6F 00 63 00 6B 00 00 00 73 00 62 00 6C 00 00 00 6E 00 65 00 77 00 00 00 }
    condition:
        any of them
}

rule CrowdStrike_CSIR_14007_23 : berserk_bear barbarian rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Rule detecting debug paths in BERSERK BEAR BARBARIAN malware"
        reports = "CSIR-14007"
        version = "201410310000"
        last_modified = "2014-10-31"
        actor = "BERSERK BEAR"
        malware_family = "BARBARIAN"
    strings:
        // C:\\Visual Studio 2010\\Projects\\NadzorModules\\ProcessList\\Release\\ProcessList.pdb
        $pdb01 = "Projects\\NadzorModules"
        // C:\\Visual Studio 2012\\Nadzor\\Nadzor_sln\\Release\\Executor.pdb
        $pdb02 = "Nadzor\\Nadzor_sln"
    condition:
        any of them
}

rule CrowdStrike_CSIR_14007_24 : berserk_bear barbarian rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Rule detecting partial debug path in BERSERK BEAR BARBARIAN malware"
        reports = "CSIR-14007"
        version = "201410310000"
        last_modified = "2014-10-31"
        actor = "BERSERK BEAR"
        malware_family = "BARBARIAN"
    strings:
        $a = "NadzorModules"
    condition:
        $a
}

rule CrowdStrike_CSIT_14106_01 : jasus post_exploitation 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Jasus packet sniffing and ARP poisoning tool"
        reports = "CSIT-14106"
        version = "201411060000"
        last_modified = "2014-11-06"
        malware_family = "Jasus"
    strings:
        $optstr = "iurkxNn:f:o:s:t:l:g::dy:z:"
        $filemapping = "aljashahaha"
    condition:
        any of them
}

rule CrowdStrike_CSIT_14105_01 : flagdownloader dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "FlagDownloader RAT dropper"
        reports = "CSIT-14105"
        version = "201411070000"
        last_modified = "2014-11-07"
        malware_family = "FlagDownloader"
    strings:
        $dowork = "DoWork"
        $func = { 55 8b ec 6a 00 6a 00 68 ?? ?? 00 10 6a 00 e8 ?? ?? ?? ?? cc }
        $xor = { b8 f3 db 12 0d 35 bc 89 56 23 39 03 }
    condition:
        ($dowork and $func) or $xor
}

rule CrowdStrike_CSIT_14105_03 : delivery_document cve_2012_0158 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Generic detection of CVE-2012-0158 exploit document"
        reports = "CSIT-14105"
        version = "201807251348"
        last_modified = "2018-07-25"
    strings:
        $apihash_1 = "68AD9B7DDFe8" nocase
        $apihash_2 = "68AC08DA76e8" nocase
        $apihash_3 = "6854CAAF91e8" nocase
        $apihash_4 = "681665FA10e8" nocase
    condition:
        all of them and (
        for any i in (1..#apihash_4) : (for all of ($apihash_*): ($ in (@apihash_4[i]-200..@apihash_4[i]+200)))
        )
}

rule CrowdStrike_CSIT_14131_01 : goblin_panda http_tunnel_lite proxy 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Tool in use by GOBLIN PANDA (and possibly others) to likely act as a victim triage and downloader tool."
        reports = "CSIT-14131"
        version = "201411070000"
        last_modified = "2014-11-07"
        actor = "GOBLIN PANDA"
        malware_family = "HTTP Tunnel Lite"
    strings:
        $pdb = "C:\\Users\\cool\\Documents\\Visual Studio 2010\\Projects\\dlltest\\Release\\dlltest.pdb\x00"
        $up_file_error = "up File Error\x0d\x0a"
        $up_file_ok = "up file ok\x0d\x0a"
    condition:
        any of them
}

rule CrowdStrike_CSIT_14105_02 : flagdownloader delivery_document 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "FlagDownloader RAT exploit document"
        reports = "CSIT-14105"
        version = "201807300929"
        last_modified = "2018-07-30"
        malware_family = "FlagDownloader"
    strings:
        $enc_reg_add = "cmVnIGFkZCBIS0VZX0NVUlJFTlRfVVNFUlxTT0ZUV0FSRVxNaWNyb3NvZnRcV2luZG93c1xDdXJyZW50VmVyc2lvblxSdW4gL3Yg"
        $logfile = "\\msextlog.dll"
        $upload = "Upload file succsed!"
        $marker = "fc!QAZxcvbnm@WSdfghjklpo"
        $wf_error = "When UpLoad File, WriteFile Error!"
        $rf_error = "Remote create file failed!"
        $cant_logical = "Can't Use The Function GetLogicalDriveString!"
        $path_fail = "Path change failed!!Check the path!"
    condition:
        2 of them
}

rule CrowdStrike_CSIT_14115_03 : zxshell config 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "ZXShell configuration file (config.ini)"
        reports = "CSIT-14115"
        version = "201411100000"
        last_modified = "2014-11-10"
        malware_family = "ZxShell"
    strings:
        $ = "[zxconfig]"
        $ = "MyIP="
        $ = "Port="
        $ = "Password="
        $ = "Banner="
        $ = "BackConnect="
    condition:
        all of them
}

rule CrowdStrike_CSIT_14108_01 : tinyshell remote_shell unix 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "TinySHell Backdoor"
        reports = "CSIT-14108"
        version = "201411110000"
        last_modified = "2014-11-11"
        malware_family = "TinySHell"
    strings:
        // Default challenge value
        $chall = { 58 90 ae 86 f1 b9 1c f6 29 83 95 71 1d de 58 0d }
        // SHA1 constants, big endian
        $sha1_state0_be = { 01 23 45 67 }
        $sha1_state1_be = { 89 ab cd ef }
        $sha1_state2_be = { fe dc ba 98 }
        $sha1_state3_be = { 76 54 32 10 }
        $sha1_state4_be = { f0 e1 d2 c3 }
    condition:
        all of them
}

rule CrowdStrike_CSIT_14108_02 : sshd remote_shell unix 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Backdoored SSH Daemon"
        reports = "CSIT-14108"
        version = "201411110000"
        last_modified = "2014-11-11"
    strings:
        $formatstr = "user:password --> %s:%s"
    condition:
        $formatstr
}

rule CrowdStrike_CSIT_14108_03 : ssh unix 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Patched SSH Client"
        reports = "CSIT-14108"
        version = "201411110000"
        last_modified = "2014-11-11"
    strings:
        $formatstr = "user:password@host --> %s:%s@%s"
    condition:
        all of them
}

rule CrowdStrike_CSIT_14117_01 : smoke_loader loader unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Smoke Loader unpacked main. This rule is most effective against memory dumps or a running process."
        reports = "CSIT-14117"
        version = "201411110000"
        last_modified = "2014-11-11"
        malware_family = "Smoke Loader"
    strings:
        // Byte Matches
        $randseed = { 0f 31 0b 05 ?? ?? ?? ?? c1 d0 02 05 78 56 34 12 19 d0 }
        $randmagic = { 69 15 ?? ?? ?? ?? 05 84 08 08 }
        $decoderesp = { 32 45 f8 8b 17 88 04 32 83 c3 03 46 3b 5d fc }
        $deobfc2 = { 8d 7e 05 8a 56 04 84 d2 ?? ?? b0 01 33 c9 8a c8 03 cf 49 8a 09 32 0e }
        // String Matches
        $beacon = "cmd=getload&login="
        $run1 = "&run=ok"
        $run2 = "&run=fail"
        $remove = "&removed=ok"
    condition:
        all of them
}

rule CrowdStrike_CSIT_14123_01 : goblin_panda delivery_document 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "GOBLIN PANDA exploit document"
        reports = "CSIT-14123"
        version = "201411130000"
        last_modified = "2014-11-13"
        actor = "GOBLIN PANDA"
    strings:
        $rtf_hdr1= "{\\rtf1\\ansi\\ansicpg936\\uc2\\deff0\\stshfdbch13\\stshfloch0\\"
        $rtf_hdr2 = "{\\*\\panose 02020603050405020304}times new roman"
        $mscomctl = "4d53436f6d63746c4c69622e546f6f6c6261722e32"
        $sc = { 7f 8c f6 3b a1 b1 1a e1 ?? ?? ?? 00 ?? ?? ?? 00 ?? ?? ?? 00 4d 5b }
        $encpayload = { 1f 8b 36 6e 3b 58 8b 32 50 73 54 8b 32 50 73 54 }
    condition:
        (2 of ($rtf_hdr*)) and $mscomctl and (1 of ($sc, $encpayload))
}

rule CrowdStrike_CSIT_14123_02 : goblin_panda loader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Loader used by GOBLIN PANDA to sideload PlugX using legitimate software"
        reports = "CSIT-14123"
        version = "201411130000"
        last_modified = "2014-11-13"
        actor = "GOBLIN PANDA"
    strings:
        $func1 = "VirtualAlloc"
        $func2 = "CreateFileW"
        $func3 = "ReadFile"
        $func4 = "CreateFileMappingW"
        $func5 = "MapViewOfFile"
        $sleep = "Sleep"
        $pl1 = "msi.dll.mov"    wide ascii
        $pl2 = "moic.exe.dat"   wide ascii
        $ldr_date1 = { 3E 52 33 01 }
        $ldr_date2 = { 45 50 33 01 }
    condition:
        (3 of ($func*)) and $sleep and (1 of ($pl*)) and (1 of ($ldr_date*))
}

rule CrowdStrike_CSIT_14123_03 : goblin_panda plugx rat unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "GOBLIN PANDA PlugX running in memory, identified by decode routine"
        reports = "CSIT-14123"
        version = "201411130000"
        last_modified = "2014-11-13"
        actor = "GOBLIN PANDA"
        malware_family = "PlugX"
    strings:
        $header = { 13 06 14 20 }
        $xor_loop = { 81 c1 4f c3 00 00 8a d9 2a dd 89 4d 08 32 5d 0a 81 ea 25 75 00 00 2a 5d 0b 89 55 fc 32 da 2a de 32 5d fe 2a 5d ff 32 1c 06 88 18 40 4f 75 d1 }
    condition:
        #header > 5 and $xor_loop
}

rule CrowdStrike_CSIT_14109_01 : wet_panda backshell rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Backshell RAT decode routine"
        reports = "CSIT-14109"
        version = "201411140000"
        last_modified = "2014-11-14"
        actor = "WET PANDA"
        malware_family = "Backshell"
    strings:
        $decode_loop = { 58 50 33 c9 80 30 ?? 40 41 81 f9 ?? ?? 00 00 75 f3 58 eb 05 }
    condition:
        $decode_loop
}

rule CrowdStrike_CSIT_14115_02 : zxshell rootkit 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "ZXShell kernel driver"
        reports = "CSIT-14115"
        version = "201411140000"
        last_modified = "2014-11-14"
        malware_family = "ZxShell"
    strings:
        $ = "[+]Hook KiFastCallEntry success"
        $ = "[+]InitSystemCallEntry success"
        $ = "[+]Driver communication success"
        $ = "[-]Driver communication failure"
        $ = "HideDriverFromObjectDirectory ok"
        $ = "HideDriverFromPsLoadedModuleList ok"
        $ = "Pacth_KeDelayExecutionThread is 0x%x"
        $ = "Pacth_ExAllocatePoolWithTag is 0x%x"
        $ = "Pacth_ExAllocatePool is 0x%x"
        $ = "h:\\kernel\\sshell\\systemcallentry.c"
        $ = "!!Attack:%wZ"
        $ = "h:\\kernel\\sshell\\killprocess.c"
        $ = "h:\\kernel\\sshell\\objchk_win7_x86\\i386\\USBHPMS.pdb"
        $ = "= %wZ----%d----%d---%d"
    condition:
        4 of them
}

rule CrowdStrike_CSIT_15005_01 : goblin_panda plugx dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "PE file Dropper for PlugX"
        reports = "CSIT-15005"
        version = "201411190000"
        last_modified = "2014-11-19"
        actor = "GOBLIN PANDA"
        malware_family = "PlugX"
    strings:
        $a = { 3d e6 21 00 00 ?? ?? b8 e6 21 00 00 }
        $b = { 3d cc 43 00 00 ?? ?? b8 cc 43 00 00 }
        $c = { 3d b2 65 00 00 ?? ?? b8 b2 65 00 00 }
        $d = { 3d 98 87 00 00 ?? ?? b8 98 87 00 00 }
        $e = { 3d 7e a9 00 00 ?? ?? b8 7e a9 00 00 }
        $inflate = "inflate 1.2.8 Copyright 1995-2013 Mark Adler"
    condition:
        all of them
}

rule CrowdStrike_CSIT_14112_01 : post_exploitation 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Enumshare tool"
        reports = "CSIT-14112"
        version = "201411240000"
        last_modified = "2014-11-24"
    strings:
        $usage = "Usage: %s [-h] [-v] [-t target] [-u username] [-p password]"
        $assume = "[Assuming one session already existed or target is null.]"
        $ansi = "HeapAlloc() failed for ansiserver"
    condition:
        2 of them
}

rule CrowdStrike_CSIT_14112_02 : mimikatz credential_dumper post_exploitation 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Mimikatz tool"
        reports = "CSIT-14112"
        version = "201411240000"
        last_modified = "2014-11-24"
    strings:
        $fail_1 = "Error : Fail To Enumerate Current Session" ascii wide
        $fail_2 = "Error : Fail To Get Session Data" ascii wide
        $fail_3 = "Fail To Search LSASS Data" ascii wide
        $dll_1 = "kerberos.dll" ascii wide
        $dll_2 = "livessp.dll" ascii wide
        $dll_3 = "wdigest.dll" ascii wide
        $dll_4 = "tspkg.dll" ascii wide
        $dll_5 = "lsasrv.dll" ascii wide
    condition:
        1 of ($fail_*) and 3 of ($dll_*)
}

rule CrowdStrike_CSIT_14113_01 : k4rat dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "K4RAT dropper"
        reports = "CSIT-14113"
        version = "201411240000"
        last_modified = "2014-11-24"
        malware_family = "K4RAT"
    strings:
        $file = "tmp.dat"
        $export_1 = "?GetMsgProc@@YGJHIJ@Z"
        $export_2 = "ishk"
        $dllname = "msjetodb.dll"
        $xorloop = { 8a 0c 18 80 f1 ?? 88 0c 18 40 3b c7 7c f2 }
    condition:
        3 of them
}

rule CrowdStrike_CSIT_14113_02 : k4rat rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "K4RAT dropper"
        reports = "CSIT-14113"
        version = "201411240000"
        last_modified = "2014-11-24"
        malware_family = "K4RAT"
    strings:
        $dllname = "K4Dll.dll"
        $win = "The Window"
        $clsid_1 = "AEBA21FA-782A-4A90-978D-B72164C80120"
        $clsid_2 = "A8A88C49-5EB2-4990-A1A2-0876022C854F"
        $msg = "</MSG>"
        $key  = { a1 a2 a3 a4 00 }
        $m_0 = "<M00>"
        $m_13 = "</M13>"
        $ua = "Mozilla/4.0 (Compatible; MSIE 6.0;)"
    condition:
        4 of them
}

rule CrowdStrike_CSIT_14128_01 : jucom rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Jucom RAT"
        reports = "CSIT-14128"
        version = "201411240000"
        last_modified = "2014-11-24"
        malware_family = "Jucom"
    strings:
        $stackcmd = { c6 ?? ?? 2f c6 ?? ?? 63 c6 ?? ?? 6d c6 ?? ?? 64 }
        $stackmsg = { c6 ?? ?? 5b c6 ?? ?? 2b c6 ?? ?? 5d c6 ?? ?? 43 }
        $stackhttpfmt = { c6 ?? ?? 74 c6 ?? ?? 74 c6 ?? ?? 70 c6 ?? ?? 3a c6 ?? ?? 2f c6 ?? ?? 2f c6 ?? ?? 25 c6 ?? ?? 73 c6 ?? ?? 3a c6 ?? ?? 25 c6 ?? ?? 64 c6 ?? ?? 25 c6 ?? ?? 73 c6 ?? ?? 00 }
        $stackiframe = { c6 ?? ?? 3c c6 ?? ?? 69  c6 ?? ?? 66 c6 ?? ?? 72 c6 ?? ?? 61 }
    condition:
        3 of ($stackcmd, $stackmsg, $stackhttpfmt, $stackiframe)
}

rule CrowdStrike_CSIT_14113_03 : k4rat config 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "K4RAT configuration file"
        reports = "CSIT-14113"
        version = "201807301104"
        last_modified = "2018-07-30"
        malware_family = "K4RAT"
    strings:
        $http_enc = "\x0022e2HQoG"
        $https_enc = "\x0022e2HUMT"
    condition:
        any of them
}

rule CrowdStrike_CSIT_14116_01 : coiner dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Coiner dropper"
        reports = "CSIT-14116"
        version = "201411260000"
        last_modified = "2014-11-26"
        malware_family = "Coiner"
    strings:
        $rar_hdr = { 00 00 00 20 ?? ?? ?? ?? 52 61 72 21 }
        $base64_decode_fn = "FromBase64String"
        $filename = "ulti.exe"
    condition:
        3 of them and
        uint16(0) == 0x5a4d and
        uint32(uint16(0x3c)) == 0x4550
}

rule CrowdStrike_CSIT_14116_02 : coiner 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Coiner"
        reports = "CSIT-14116"
        version = "201411260000"
        last_modified = "2014-11-26"
        malware_family = "Coiner"
    strings:
        $c2_url = "run.php?userandpc=" wide
        $mutex = "ABF#RASDF4asfg54aSDG" wide
        $log_1 = "A Bandwidth Flood Attack is Already Running on " wide
        $log_2 = "CPU Miner: Stopped Successfully." wide
        $filename = "eAtShiTAnDDiE.exe" wide
    condition:
        all of them
}

rule CrowdStrike_CSIT_14118_01 : destrover gop_wiper dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Destrover/GOP Wiper dropper"
        reports = "CSIT-14118"
        version = "201411260000"
        last_modified = "2014-11-26"
        malware_family = "Destrover"
    strings:
        $cmdline_1 = "cmd.exe /c wmic.exe /node:\"%s\" /user:\"%s\" /password:\"%s\" PROCESS CALL CREATE \"%s\" > %s"
        $cmdline_2 = "cmd.exe /q /c net share shared$=%SystemRoot%"
        $logfile = "net_ver.dat"
        $encrypted_ips = /(\x6a\x6d)(.{0,75})(\x1b)((.{1,3})\x49(.{1,3})\x49(.{1,3})\x49(.{1,3}))/
    condition:
        all of them
}

rule CrowdStrike_CSIT_14118_02 : destrover gop_wiper wiper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Destrover/GOP Wiper"
        reports = "CSIT-14118"
        version = "201411260000"
        last_modified = "2014-11-26"
        malware_family = "Destrover"
    strings:
        $driver_key = "99E2428CCA4309C68AAF8C616EF3306582A64513E55C786A864BC83DAFE0C78585B692047273B0E55275102C664C5217E76B8E67F35FCE385E4328EE1AD139EA6AA26345C4F93000DBBC7EF1579D4F"
        $crypto_1 = { ef cd ab 90 [0-64] 78 56 b4 c2 [0-64] 55 84 26 fe }
    condition:
        all of them
}

rule CrowdStrike_CSIT_14118_03 : destrover_wiper gop_wiper post_exploitation 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Destrover/GOP Wiper webserver"
        reports = "CSIT-14118"
        version = "201411260000"
        last_modified = "2014-11-26"
        malware_family = "Destrover"
    strings:
        $useragent = { 48 54 54 50 2f 31 2e 31 20 32 30 30 20 4f 4b 0d 0a 43 6f 6e 74 65 6e 74 2d 4c 65 6e 67 74 68 3a 20 25 64 0d 0a 43 6f 6e 74 65 6e 74 2d 54 79 70 65 3a 20 61 75 64 69 6f 2f 77 61 76 0d 0a 41 63 63 65 70 74 2d 52 61 6e 67 65 73 3a 20 62 79 74 65 73 0d 0a 53 65 72 76 65 72 3a 20 4d 69 63 72 6f 73 6f 66 74 2d 49 49 53 2f 36 2e 30 0d 0a 0d 0a 00 }
        $services_1 = "W3SVC"
        $services_2 = "WMServer"
        $services_3 = "SSIS"
        $services_4 = "SSRS"
        $services_5 = "MSDEPSVC"
    condition:
        $useragent and 3 of ($services_*)
}

rule CrowdStrike_CSIR_15000_02 : team_bear ardamax keylogger 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "TEAM BEAR Ardamax keylogger"
        reports = "CSIR-15000"
        version = "201412020000"
        last_modified = "2014-12-02"
        actor = "TEAM BEAR"
        malware_family = "Ardamax"
    strings:
        $ = "%s?avva=%d&idda=%d&sopp=%d&ngrf=cach923&CLR=1000"
    condition:
        any of them
}

rule CrowdStrike_CSIR_15000_03 : team_bear tasking 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Tool used to gather a list of files by filename pattern"
        reports = "CSIR-15000"
        version = "201412020000"
        last_modified = "2014-12-02"
        actor = "TEAM BEAR"
    strings:
        $p00 = "*.pst"
        $p01 = "*.mdb"
        $p02 = "*.doc"
        $p03 = "*.rtf"
        $p04 = "*pass*.exe"
        $p05 = "*.pgp"
        $p06 = "*.pdf"
        $p07 = "*.xls"
        $p08 = {2A EF E0 F0 EE EB 2A 2E  2A 00}
        $p09 = {2A F1 E5 EA F0 E5 F2 2A  2E 2A 00}
        $p10 = "*secret*.*"
        $p11 = "*saidumlo*"
        $p12 = "*.vmdk"
        $p13 = "*.tc"
        $p14 = "*.p12"
        $dstfname00 = "\\ProgramData\\Adobe\\AdobeArm\\sysdll"
        $dstfname01 = "c:\\sysdll2.txt"
    condition:
        4 of ($p*) and any of ($dstfname*)
}

rule CrowdStrike_CSIR_15000_04 : team_bear tasking 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Tool used to gather system information"
        reports = "CSIR-15000"
        version = "201412020000"
        last_modified = "2014-12-02"
        actor = "TEAM BEAR"
    strings:
        $p00 = "/c wmic os get /format:\"c:\\Windows\\System32\\wbem\\en-US\\hform.xsl\" >"
        $p01 = " && wmic process list brief /format:\"c:\\Windows\\System32\\wbem\\en-US\\htable.xsl\" >>"
        $p02 = " && wmic bios list /format:\"c:\\Windows\\System32\\wbem\\en-US\\hform.xsl\" >>"
        $p03 = " && wmic computersystem list /format:\"c:\\Windows\\System32\\wbem\\en-US\\hform.xsl\" >>"
        $p04 = " && wmic logicaldisk list brief /format:\"c:\\Windows\\System32\\wbem\\en-US\\htable.xsl\" >>"
        $p05 = " && wmic useraccount list brief /format:\"c:\\Windows\\System32\\wbem\\en-US\\htable.xsl\" >>"
        $p06 = " && wmic startup list /format:\"c:\\Windows\\System32\\wbem\\en-US\\htable.xsl\" >>"
        $p07 = " && wmic share list brief /format:\"c:\\Windows\\System32\\wbem\\en-US\\htable.xsl\" >>"
        $p08 = " && wmic onboarddevice list brief /format:\"c:\\Windows\\System32\\wbem\\en-US\\htable.xsl\" >>"
        $p09 = " && wmic ntdomain list brief /format:\"c:\\Windows\\System32\\wbem\\en-US\\htable.xsl\" >>"
        $fname00 = "\\ProgramData"
        $fname01 = "\\Adobe"
        $fname02 = "\\AdobeArm"
        $fname03 = "\\sysdll15.txt"
        $fname04 = "SystemDrive"
        $fname05 = "wmic"
    condition:
        4 of ($p*) or all of ($fname*)
}

rule CrowdStrike_CSIR_15000_05 : team_bear tasking 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Tool used to enumerate files"
        reports = "CSIR-15000"
        version = "201412020000"
        last_modified = "2014-12-02"
        actor = "TEAM BEAR"
    strings:
        $l00 = "globalFunctions::%d->_mRemoveResource [%d] Resource was not found"
        $l01 = "globalFunctions::%d->_mRemoveResource [%d] Error while closing file, GLE:%d"
        $l02 = "globalFunctions::%d->_mRemoveResource [%d] Error while memory disposal, GLE%d"
        $l03 = "globalFunctions::%d->_mRemoveResource [%d] Unknown resource type: %d"
        $l04 = "globalFunctions::mRemoveResource [%d] Resource pool is NULL"
        $l05 = "globalFunctions::%d->_mClearResourceTable [%d] Not all resources were cleared successfully"
        $l06 = "globalFunctions::%d->_mClearResourceTable [%d] Error while closing file, GLE:%d"
        $l07 = "globalFunctions::%d->_mClearResourceTable [%d] Error while memory disposal, GLE:%d"
        $l08 = "globalFunctions::%d->_mClearResourceTable [%d] Unknown resource type: %d"
        $l09 = "globalFunctions::%d->_mReAlloc [%d] Can't reallocate memory, GLE:%d"
        $l10 = "globalFunctions::%d->_mReAlloc [%d] ReAlloc called without memory allocated"
        $l11 = "globalFunctions::%d->_mReadFile [%d] ReadFile failed, GLE:%d"
        $l12 = "globalFunctions::%d->_mWriteFile [%d] WriteFile error, GLE:%d"
        $l13 = "globalFunctions::%d->_mAddResource [%d] Can't reAllocate memory for resource pool, GLE:%d"
        $l14 = "globalFunctions::%d->_mAddResource [%d] Can't allocate memory for resource pool, GLE:%d"
        $l15 = "globalFunctions::%d->_mAddResouce [%d] Can't create Heap, GLE:%d"
        $l16 = "globalFunctions::%d->_mAlloc [%d] Can't allocate memory, GLE:%d"
        $l17 = "globalFunctions::%d->_mAlloc [%d] Can't create Heap, GLE:%d"
        $l18 = "globalFunctions::%d->mCreateFile [%d] error %d"
        $l19 = "globalFunctions::mWriteTemplate [%d] "
        $l20 = "globalFunctions::mEncryptData [%d] "
        $l21 = "globalFunctions::mSendData [%d] "
        $l22 = "GetFile::WinMain [%d] _key == NULL; GLE:%d"
        $l23 = "C:\\sysdll9.txt"
        $l24 = "%saVer:0001;uPackedSize:%08x;CRC:%08x"
    condition:
        any of ($l*)
}

rule CrowdStrike_CSIR_15000_06 : team_bear tasking 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Tool used to take screenshots"
        reports = "CSIR-15000"
        version = "201412020000"
        last_modified = "2014-12-02"
        actor = "TEAM BEAR"
    strings:
        $fname00 = "\\ProgramData"
        $fname01 = "\\Adobe"
        $fname02 = "\\AdobeArm"
        $fname03 = "\\sysdll"
        $fname04 = "SystemDrive"
        $s00 = "PrintScreen.jpg"
        $s01 = "PrintScreen.bmp"
        $s02 = "\\sysdll5.txt"
    condition:
        all of ($fname*) and any of ($s*)
}

rule CrowdStrike_CSIR_15000_07 : team_bear tasking 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Tool used to to list files and running processes"
        reports = "CSIR-15000"
        version = "201412020000"
        last_modified = "2014-12-02"
        actor = "TEAM BEAR"
    strings:
        $fname00 = "\\ProgramData\\Adobe\\AdobeArm\\sysdll"
        $fname04 = "SYSTEMDRIVE"
        $s00 = "PROGRAMDATA"
        $s01 = "COMPUTERNAME"
        $s02 = "PROCESSOR_ARCHITECTURE"
        $s03 = "PROCESSOR_IDENTIFIER"
        $s04 = "PROCESSOR_LEVEL"
        $s05 = "NUMBER_OF_PROCESSORS"
        $s06 = "USERDOMAIN"
        $s07 = "USERNAME"
        $s08 = "TIME"
        $s09 = "PATH"
    condition:
        all of ($fname*) and 6 of ($s*)
}

rule CrowdStrike_CSIR_15000_08 : team_bear tasking 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Tool used to list files and running processes"
        reports = "CSIR-15000"
        version = "201412020000"
        last_modified = "2014-12-02"
        actor = "TEAM BEAR"
    strings:
        $ = "c:\\sysdll5.txt"
        $ = "vgtk.exe"
        $ = "SOFTWARE\\Borland\\Delphi\\RTL"
        $ = "TJPEGData"
        $ = "TJPEGImage"
        $ = "BitBlt"
    condition:
        all of them
}

rule CrowdStrike_CSIR_15000_09 : team_bear tasking keylogger 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "TEAM BEAR keylogger"
        reports = "CSIR-15000"
        version = "201412020000"
        last_modified = "2014-12-02"
        actor = "TEAM BEAR"
    strings:
        $ = "[Nkz024.size=%d]"
        $ = "c:\\sysdll3.txt"
        $ = "kAWT:%s [%02d.%02d.%04d %02d:%02d:%02d]"
        $ = "mAWT:%s [%02d.%02d.%04d %02d:%02d:%02d]"
        $ = "LogStarted [%02d.%02d.%04d %02d:%02d:%02d]"
        $ = "kidll.dll"
        $ = "_HksKeyProc@12"
        $ = "_HksMouseProc@12"
    condition:
        6 of them
}

rule CrowdStrike_CSIR_15000_10 : team_bear tasking keylogger installer 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "TEAM BEAR keylogger installer"
        reports = "CSIR-15000"
        version = "201412020000"
        last_modified = "2014-12-02"
        actor = "TEAM BEAR"
    strings:
        $ = "PF_WorkingState"
        $ = "\\kidll.dll"
        $ = "\\wsock32.exe"
        $ = "Software\\Microsoft\\Windows\\CurrentVersion\\Run"
        $ = "hKs10"
        $ = "hKsv10"
        $ = "RegisterServiceProcess"
    condition:
        all of them
}

rule CrowdStrike_CSIR_15000_11 : team_bear tasking keylogger 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "TEAM BEAR keylogger"
        reports = "CSIR-15000"
        version = "201412020000"
        last_modified = "2014-12-02"
        actor = "TEAM BEAR"
    strings:
        $ = "__klgskot__"           wide    // mutex/event
        $ = "WCF Data Services"     wide
        $ = "\\ProgramData\\Adobe\\AdobeArm"   wide
        $ = "%s\\klg%d.klg"         wide
        $ = "__klgkillsoft__"       wide
        $ = "[CLIPBOARD_PASTE="     wide
        $ = "/%d; %s;]"             wide
        $ = "Empty Window"          wide
    condition:
        4 of them
}

rule CrowdStrike_CSIR_15000_12 : team_bear tasking 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Tool used to list running processes and wbem folder"
        reports = "CSIR-15000"
        version = "201412020000"
        last_modified = "2014-12-02"
        actor = "TEAM BEAR"
    strings:
        $ = "c:\\sysdll9.txt"
        $ = "%s\\wbem\\svchost.exe"
        $ = "c:\\sysdll12.txt"
        $ = "File copy"
        $ = "File not copy"
        $ = "File exists"
        $ = "%s pid: %d"
        $ = "/c del"
        $ = " > nul"
    condition:
        all of them
}

rule CrowdStrike_CSIR_15000_13 : team_bear tasking 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Tool used to create screenshots"
        reports = "CSIR-15000"
        version = "201412020000"
        last_modified = "2014-12-02"
        actor = "TEAM BEAR"
    strings:
        $ = "No find glue file!"
        $ = "Fatal write error."
        $ = "SystemDrive"
        $ = "\\ProgramData"
        $ = "\\CmdCapture"
        $ = "\\AdobeArm"
        $ = "\\sysdll555.txt"
        $ = "/c %s /d %s /f sysdll5.jpg > %s"
    condition:
        all of them
}

rule CrowdStrike_CSIR_15000_14 : team_bear tasking bios_dumper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Tool used to gather BIOS information"
        reports = "CSIR-15000"
        version = "201412020000"
        last_modified = "2014-12-02"
        actor = "TEAM BEAR"
    strings:
        $ = "/c wmic os get /format:HFORM > %s && wmic bios list /format:HFORM >> %s"
        $ = "\\sysdll155.html"
        $ = "\\ProgramData"
        $ = "\\AdobeArm"
    condition:
        all of them
}

rule CrowdStrike_CSIR_15000_17 : team_bear tasking bios_dumper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Tool used to gather BIOS information"
        reports = "CSIR-15000"
        version = "201412020000"
        last_modified = "2014-12-02"
        actor = "TEAM BEAR"
    strings:
        $ = {00 62 69 7E 2E 74 6D 70 00}
        $ = "Borland C++ - Copyright 1995 Borland Intl."
    condition:
        all of them
}

rule CrowdStrike_CSIR_15000_18 : team_bear tasking 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Post exploitation tool to list running processes"
        reports = "CSIR-15000"
        version = "201412020000"
        last_modified = "2014-12-02"
        actor = "TEAM BEAR"
    strings:
        $ = "SystemDrive"
        $ = "\\ProgramData"
        $ = "\\Mail"
        $ = "\\MailAg"
        $ = "\\tl.txt"
        $ = "/c tasklist >> %s"
        $ = "cmd.exe"
    condition:
        all of them
}

rule CrowdStrike_CSIR_15000_19 : team_bear tasking 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Post exploitation tool wrapping ipconfi"
        reports = "CSIR-15000"
        version = "201412020000"
        last_modified = "2014-12-02"
        actor = "TEAM BEAR"
    strings:
        $ = "SystemDrive"
        $ = "\\ProgramData"
        $ = "\\Adobe"
        $ = "\\AdobeArm"
        $ = "\\netres.txt"
        $ = "/c ipconfig /all > %s && arp -a >> %s"
        $ = "cmd.exe"
    condition:
        all of them
}

rule CrowdStrike_CSIT_14118_04 : destrover gop_wiper post_exploitation 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "McAfee McShield Disabler, used in conjunction with the Destrover/GOP Wiper"
        reports = "CSIT-14118"
        version = "201412030000"
        last_modified = "2014-12-03"
    strings:
        $device_name = "\\Device\\KProcessHacker2" wide
        $ioctl_terminate_proc = { b9 df 20 99 99 e8 8a }
    condition:
        all of them
}

rule CrowdStrike_CSIT_14118_05 : kprocess_hacker post_exploitation 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "KProcess Hacker - this tool is in general usage and is not malicious in itself, but has been used in conjunction with Destover and an additional tool identified by CrowdStrike_CSIT_14118_04 to terminate anti-virus tools."
        reports = "CSIT-14118"
        version = "201907080823"
        last_modified = "2019-07-08"
    strings:
        $ioctl_handling = { 81 ff f3 20 99 99 ?? ?? 81 ff 93 21 99 99 }
    condition:
        all of them
}

rule CrowdStrike_CSIR_15000_01 : tasking team_bear teamspy 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "TEAM BEAR TeamSpy RAT avicap module"
        reports = "CSIR-15000"
        version = "201908281808"
        last_modified = "2019-08-28"
        actor = "TEAM BEAR"
        malware_family = "TeamSpy"
    strings:
        // CALL ..; tv.cfg
        $u1 = {E8 ?? 00 00 00 74 76 2E 63 66 67 00}
        // CALL ..; szadminhost
        $u2 = {E8 ?? 00 00 00 73 7A 61 64 6D 69 6E 68  6F 73 74 00}
        // CALL ..; http://
        $u3 = {E8 ?? 00 00 00 68 74 74 70 3A 2F 2F 00}
        // CALL ..; %2.2x
        $u4 = {E8 ?? 00 00 00 25 32 2E 32 78 00}
    condition:
        2 of ($u*)
}

rule CrowdStrike_CSIR_15000_15 : team_bear tasking 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Internet Explorer Password Viewer"
        reports = "CSIR-15000"
        version = "201412050000"
        last_modified = "2014-12-05"
        actor = "TEAM BEAR"
    strings:
        $ = "IE PassView"
        $ = "z:\\Projects\\VS2005\\iepv\\Release\\iepv.pdb"
    condition:
        all of them
}

rule CrowdStrike_CSIR_15000_16 : team_bear tasking dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Internet Explorer Password Viewer"
        reports = "CSIR-15000"
        version = "201412050000"
        last_modified = "2014-12-05"
        actor = "TEAM BEAR"
    strings:
        $ = "/stext C:\\sysdll10.txt"
        $ = "%s\\iepv.exe"
        $ = "No find glue file!"
        $ = "Fatal write error."
    condition:
        all of them
}

rule CrowdStrike_CSIT_15002_01 : gothic_panda pirpi rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Pirpi RAT string decryption routine"
        reports = "CSIT-15002"
        version = "201807251351"
        last_modified = "2018-07-25"
        actor = "GOTHIC PANDA"
        malware_family = "Pirpi"
    strings:
        $enc_string_load = { 8b 4d 10 8b 75 0c 8b 7d 14 8b c1 c1 e9 02 f3 a5 8b c8 83 e1 03 f3 a4 b8 01 00 00 00 }
    condition:
        $enc_string_load
}

rule CrowdStrike_CSIT_14124_01 : credential_dumper post_exploitation 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Credential Dumping Tool, drops Mimikatz clone"
        reports = "CSIT-14124"
        version = "201412100000"
        last_modified = "2014-12-10"
    strings:
        $ = "/C C:\\PROGRA~1\\MSBuild\\Temp\\7za.exe e -oC:\\PROGRA~1\\MSBuild\\Temp\\ C:\\PROGRA~1\\MSBuild\\Temp\\inf.7z -p122333444455555 -y"
        $ = "/C C:\\PROGRA~1\\MSBuild\\Temp\\32.exe privilege::debug \"sekurlsa::logonPasswords full\" exit > C:\\PROGRA~1\\MSBuild\\Temp\\%s.txt"
        $ = "/C C:\\PROGRA~1\\MSBuild\\Temp\\64.exe privilege::debug \"sekurlsa::logonPasswords full\" exit > C:\\PROGRA~1\\MSBuild\\Temp\\%s.txt"
        $ = "/C C:\\PROGRA~1\\MSBuild\\Temp\\crypt.exe --encrypt C:\\PROGRA~1\\MSBuild\\Temp\\public.key C:\\PROGRA~1\\MSBuild\\Temp\\%s.txt C:\\PROGRA~1\\MSBuild\\Temp\\%s.inc"
        $ = "/C ATTRIB +H +S C:\\PROGRA~1\\MSBuild\\Temp"
    condition:
        any of them
}

rule CrowdStrike_CSIT_14124_02 : key 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "RSA public key modulus used by attacker"
        reports = "CSIT-14124"
        version = "201412100000"
        last_modified = "2014-12-10"
    strings:
        $ = { 9f c4 19 6e 0d bf 95 63 b9 7e ac 04 1d 2d f2 a0 00 19 f6 b7 09 8c 1a 60 07 ed 58 e1 da a8 fc a8 2e cd 9c 3e 16 db f2 7a 79 8f 70 01 7f 26 12 92 58 80 be 6e f5 f8 83 49 b2 b2 09 f6 f1 1a 08 5e 2f 0e 10 e0 a2 46 21 e1 ad a1 32 e3 88 29 18 a2 1b 5c 71 65 b1 c9 39 ef 9d d3 d5 2f 31 80 d2 7a ea bf 4d 1c fa 1d 0b fa be 88 ab d7 4e 72 b2 be 0c 35 30 98 24 e3 38 86 6c fe fc 47 0c 42 2e 71 }
    condition:
        any of them
}

rule CrowdStrike_CSIT_14124_03 : post_exploitation 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "RSA en-/decryption tool"
        reports = "CSIT-14124"
        version = "201412100000"
        last_modified = "2014-12-10"
    strings:
        $ = "crypt version 1.0"
        $ = "Encrypt and decrypt using RSA cryption alghorithm."
        $ = "crypt --generate_keys <private_key_file_name> <public_key_file_name>"
        $ = "crypt --encrypt <public_key_file_name> <plain_file_name> <cipher_file_name>"
        $ = "crypt --decrypt <private_key_file_name> <cipher_file_name> <plain_file_name>"
        $ = "crypt --generate_keys private.key public.key"
        $ = "crypt --encrypt public.key plain.txt cipher.enc"
        $ = "crypt --encrypt private.key cipher.enc recovered.txt"
    condition:
        5 of them
}

rule CrowdStrike_CSIT_15001_01 : indrik_spider dridex loader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Dridex loader"
        reports = "CSIT-15002"
        version = "201412170000"
        last_modified = "2014-12-17"
        actor = "INDRIK SPIDER"
        malware_family = "Dridex"
    strings:
        $section = ".sdata"
        $tempfile = "edg"
        $strobf = { 8d 78 10 8b 45 ec 8b 55 f0 33 07 33 57 04 }
        $atoi = { 8d 78 10 8b 45 ec 8b 55 f0 33 07 33 57 04 }
        $deadbeef = { 8d 5c 03 10 81 3b ef be ad de 74 da }
    condition:
        all of ($section, $tempfile) and 2 of($strobf, $atoi, $deadbeef)
}

rule CrowdStrike_CSIT_15001_02 : indrik_spider dridex trojan 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Dridex trojan"
        reports = "CSIT-15002"
        version = "201412170000"
        last_modified = "2014-12-17"
        actor = "INDRIK SPIDER"
        malware_family = "Dridex"
    strings:
        $section = ".sdata"
        $str1 = "nodes"
        $str2 = "VncStartServer"
        $str3 = "VncStopServer"
        $str4 = "clickshot"
        $str5 = "httpshot"
        $str6 = "Nothing found"
        $wstr1 = "sol.zip" wide
        $format = "HTTP/1.1 %d %s"
    condition:
        all of them
}

rule CrowdStrike_CSIR_14012_07 : aallaamoot dropper rocket_kitten 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "ROCKET KITTEN Aallaamoot dropper"
        reports = "CSIR-14012"
        version = "201905161815"
        last_modified = "2019-05-16"
        actor = "ROCKET KITTEN"
        malware_family = "Aallaamoot"
    strings:
        $marker = { 61 61 6c 6c 61 61 6d 6f  6f 74 00 00 }
        $shellpath = "C:\\Windows\\system32\\cmd.exe"
        $inflatever = "inflate 1.1.3 Copyright 1995-1998 Mark Adler"
        $pdbfilename = "BinderCarrier.pdb"
    condition:
        all of them
}

rule CrowdStrike_CSIR_14012_01 : rocket_kitten core_impact rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Self-modifying code in Core Impact variant used by ROCKET KITTEN"
        reports = "CSIR-14012"
        version = "201807300858"
        last_modified = "2018-07-30"
        actor = "ROCKET KITTEN"
        malware_family = "Core Impact"
    strings:
        $decoderloop = { 68 21 43 34 12 b9 ff ff ff 77 8b 44 24 00 f7 d0 c1 c8 03 2b c1 89 04 24 49 75 ef 58 35 }
    condition:
        all of them
}

rule CrowdStrike_CSIR_14012_02 : rocket_kitten core_impact rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Self-modifying code in Core Impact variant used by ROCKET KITTEN"
        reports = "CSIR-14012"
        version = "201412220000"
        last_modified = "2014-12-22"
        actor = "ROCKET KITTEN"
        malware_family = "Core Impact"
    strings:
        $decoderloop = { 55 8b ec b8 21 43 34 12 31 c9 49 81 f9 01 00 00 10 74 0a f7 d0 c1 c8 03 2b c1 49 eb ee 35 }
    condition:
        all of them
}

rule CrowdStrike_CSIR_14012_03 : rocket_kitten core_impact rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Self-modifying code in Core Impact variant used by ROCKET KITTEN"
        reports = "CSIR-14012"
        version = "201412220000"
        last_modified = "2014-12-22"
        actor = "ROCKET KITTEN"
        malware_family = "Core Impact"
    strings:
        $decoderloop = { b8 21 43 34 12 31 c9 49 81 f9 01 00 00 10 74 0a f7 d0 c1 c8 03 2b c1 49 eb ee 35 }
    condition:
        all of them
}

rule CrowdStrike_CSIR_14012_04 : rocket_kitten core_impact rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Core Impact API resolver stub"
        reports = "CSIR-14012"
        version = "201807300858"
        last_modified = "2018-07-30"
        actor = "ROCKET KITTEN"
        malware_family = "Core Impact"
    strings:
        $resolverstub = { e8 32 00 00 00 6b 65 72 6e 65 6c 33 32 2e 64 6c
        6c 20 47 65 74 50 72 6f 63 41 64 64 72 65 73 73
        4c 6f 61 64 4c 69 62 72 61 72 79 41 77 73 32 5f
        33 32 2e 64 6c 6c 00 5d }
    condition:
        all of them
}

rule CrowdStrike_CSIR_14012_05 : rocket_kitten core_impact rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Core Impact Wrapper3 String Resources"
        reports = "CSIR-14012"
        version = "201412220000"
        last_modified = "2014-12-22"
        actor = "ROCKET KITTEN"
        malware_family = "Core Impact"
    strings:
        $resources = { 00 00 00 00 08 00 77 00 72 00 61 00 70 00 70 00
        65 00 72 00 33 00 00 00 00 00 00 00 00 00 00 00
        08 00 57 00 52 00 41 00 50 00 50 00 45 00 52 00
        33 00 00 00 00 00 }
    condition:
        all of them
}

rule CrowdStrike_CSIR_14012_06 : rocket_kitten core_impact rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Core Impact encrypted code"
        reports = "CSIR-14012"
        version = "201412220000"
        last_modified = "2014-12-22"
        actor = "ROCKET KITTEN"
        malware_family = "Core Impact"
    strings:
        $enc_code = { b4 90 a9 34 5c c9 cc 46 32 c7 c5 07 6e 8c cd 58 }
    condition:
        all of them
}

rule CrowdStrike_CSIR_14012_08 : rocket_kitten mpk keylogger 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "MPK Keylogger"
        reports = "CSIR-14012"
        version = "201412220000"
        last_modified = "2014-12-22"
        actor = "ROCKET KITTEN"
        malware_family = "MPK Keylogger"
    strings:
        $versioninfo_companyname = "\\StringFileInfo\\040904B0\\CompanyName"
        $versioninfo_internalname= "\\StringFileInfo\\040904B0\\InternalName"
        $versioninfo_filedescription = "\\StringFileInfo\\040904B0\\FileDescription"
        $loadervbs = "CreateObject(\"WScript.Shell\").Run \"%s %s\""
        $droppervbs1 = "tmp.vbs"
        $droppervbs2 = "tmp1.vbs"
    condition:
        all of them
}

rule CrowdStrike_CSIR_14012_09 : rocket_kitten firemalv credential_theft 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "FireMalv credential stealer"
        reports = "CSIR-14012"
        version = "201412220000"
        last_modified = "2014-12-22"
        actor = "ROCKET KITTEN"
        malware_family = "FireMalv"
    strings:
        $pdbdir = "FireMalv\\FireMalv"
        $firefoxpath = "\\AppData\\Roaming\\Mozilla\\Firefox\\Profiles\\" wide
        $successmsg = "<h1>Success</h1>" wide
        $errormsg = "<h1>Sorry, Path not found.</h1>" wide
    condition:
        all of them
}

rule CrowdStrike_CSIR_14012_10 : rocket_kitten delivery_document 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "ROCKET KITTEN Malicious dropper Excel spreadsheet"
        reports = "CSIR-14012"
        version = "201810020931"
        last_modified = "2018-10-02"
        actor = "ROCKET KITTEN"
    strings:
        $macrorsrc = { 11 00 00 00 78 6c 2f 76 62 61 50 72 6f 6a 65 63 74 2e 62 69 6e}
        $payloadrsrc = { 16 00 00 00 78 6c 2f 63 75 73 74 6f 6d 50 72 6f 70 65 72 74 79 31 2e 62 69 6e }
    condition:
        all of them and
        uint32(@payloadrsrc - 4) < 0xffffff and
        uint32(@payloadrsrc - 8) < 0xffffff and
        uint32(@macrorsrc - 4) < 0xffff and
        uint32(@macrorsrc - 8) < 0xffff and
        filesize > 1000KB and
        filesize < 1400KB
}

rule CrowdStrike_CSIT_15004_01 : linux rat snake venomous_bear 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Linux variant of Snake malware"
        reports = "CSIT-15004"
        version = "201908131616"
        last_modified = "2019-08-13"
        actor = "VENOMOUS BEAR"
        malware_family = "Snake"
    strings:
        $trex_1 = "TREX_PID=%u"
        $trex_2 = "__TREX__STOP__STRING__"
        $cmd = "__we_are_happy__"
    condition:
        all of them
}

rule CrowdStrike_CSIT_15000_01 : rocket_kitten delivery_document 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "ROCKET KITTEN Malicious Dropper Excel Spreadsheet (New Version)"
        reports = "CSIT-15000"
        version = "201810020931"
        last_modified = "2018-10-02"
        actor = "ROCKET KITTEN"
    strings:
        $workbookrsrc = { 0f 00 00 00 78 6c 2f 77 6f 72 6b 62 6f 6f 6b 2e 62 69 6e }
        $stylesrsrc = { 0d 00 00 00 78 6c 2f 73 74 79 6c 65 73 }
        $macrorsrc = { 11 00 00 00 78 6c 2f 76 62 61 50 72 6f 6a 65 63 74 2e 62 69 6e}
    condition:
        all of them and
        uint32(@macrorsrc - 4) > 0xffff and
        uint32(@macrorsrc - 8) > 0xffff and
        filesize > 1000KB and
        filesize < 1400KB
}

rule CrowdStrike_CSIR_15002_01 : hurricane_panda plugx certificate 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Certificate used to sign a tool used to delete a file or drop and run PlugX"
        reports = "CSIR-15002"
        version = "201501060000"
        last_modified = "2015-01-06"
        actor = "HURRICANE PANDA"
        malware_family = "PlugX"
    strings:
        $pubkey = { 30 82 01 22 30 0D 06 09 2A 86 48 86 F7 0D 01 01 01 05 00 03 82 01 0F 00 30 82 01 0A 02 82 01 01 00 CB D8 C0 F0 C2 66 95 45 CA A4 F0 8B 25 0B D0 EE D4 3A C5 28 5C FD 77 3E 50 EC CF 82 5E 51 AA 49 80 70 61 77 22 8C 02 C5 64 9E 31 D0 6A A8 C3 D3 5D F1 B7 D5 2F 47 34 3E 40 33 13 A8 43 D6 C9 D9 79 9B 78 0A 10 00 13 E9 F3 22 4A 72 7E 71 60 85 FC 86 C9 37 8F D8 DE 96 87 19 D5 71 27 A7 AE CA DA F7 F1 AA 54 41 21 12 DC C4 E9 9A B4 79 62 51 04 75 F1 71 15 8B F1 CA 86 58 A6 D8 BE BF F0 67 0D 4E 41 B0 FF 8E 01 60 8E 10 6F 79 A0 32 6B 0E 06 00 9F 45 3E 81 BE 27 81 7F 69 BC F3 70 C8 5D 36 4D BE FC 11 1D 27 73 87 35 58 AC BF 84 79 28 3A 77 42 28 48 38 B2 DE BA BC 86 9B 2E FC 70 EA AE 7C DB 8F E7 81 E1 4B F2 10 F3 73 EC 17 0E A8 91 DC 68 BD 53 EB F9 D2 23 73 8C 1A 7A FB A7 56 92 35 65 4B CB 80 1D C3 E8 98 B9 B1 65 CA F5 9D A6 AD 25 89 09 74 B1 1B 17 E1 F5 BA 86 DA 15 5F 02 03 01 00 01 }
    condition:
        $pubkey
}

rule CrowdStrike_CSIR_15002_02 : hurricane_panda plugx certificate 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Certificate used to sign a tool used to delete a file or drop and run PlugX"
        reports = "CSIR-15002"
        version = "201501060000"
        last_modified = "2015-01-06"
        actor = "HURRICANE PANDA"
        malware_family = "PlugX"
    strings:
        $pubkey = { 30 82 01 0A 02 82 01 01 00 90 54 7B EF D1 09 59 21 BC 2F A8 80 AD 9C D1 A9 4F 25 48 80 34 8A 88 19 D8 0D 75 22 EE CC 3F 50 A5 16 A6 BA ED 76 28 62 FB 98 7F CA 31 E3 02 2C 46 00 44 EE BE 0F 26 EB B4 C2 2E FF 64 D1 55 75 AF 95 D2 5E 87 04 AD 2B A4 DB 16 C9 CA AE 50 C6 F1 0F 5E 3D 69 CF B6 DD 7C 35 D7 01 22 C1 09 33 75 FF 3F 98 A9 35 F5 25 52 3C A0 45 93 6C 1B 94 69 A7 86 C5 D6 8C 6F 1A 39 38 3A BA 7C 55 51 76 CB 95 73 14 CE 17 47 1F C2 96 14 FC 50 97 F7 03 E2 DF 91 3C F6 EB 77 AF 3A CE B7 98 DF 88 B7 43 53 45 59 30 68 F7 B1 FA 08 CF 43 BC F2 56 E4 A1 CD 14 71 59 B9 11 ED F8 7F A7 BB 56 13 AA 13 07 F0 77 40 D8 06 59 09 E3 34 D9 A0 A4 69 54 B8 76 E1 1D 64 9E 00 FD BB 03 FC F2 20 30 34 FC 2C 33 EE 93 29 38 CD EC 56 F7 2D EB 66 E8 EE BC 1E 1E 9A 25 55 40 EC 25 67 9E 00 92 A7 87 CD FA A4 55 02 03 01 00 01 }
    condition:
        $pubkey
}

rule CrowdStrike_CSIR_15002_03 : hurricane_panda plugx certificate 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Certificate used to sign a tool used to delete a file or drop and run PlugX"
        reports = "CSIR-15002"
        version = "201501060000"
        last_modified = "2015-01-06"
        actor = "HURRICANE PANDA"
        malware_family = "PlugX"
    strings:
        $pubkey = { 30 82 01 22 30 0D 06 09 2A 86 48 86 F7 0D 01 01 01 05 00 03 82 01 0F 00 30 82 01 0A 02 82 01 01 00 AA F0 EB 75 14 10 7B 40 01 0C 64 39 79 D3 B5 9B 69 8B 29 5D 49 3A C7 D6 BE 6D 0C 9A 47 CE 6A E6 40 7C D2 2C B6 54 9A 57 5C 28 8A 7C 40 88 9E 4F CB 70 B2 1C 44 79 9C 92 1F AC 9C 17 09 D5 80 E5 DB B5 A6 93 C8 E1 48 10 30 48 D2 CE F9 3F 34 09 AB 2D 8C A3 1B A3 E0 96 CB 96 A7 A0 10 2D 4B 1D 5B 7F 36 CA CD 47 8B B1 E2 B4 14 B3 F6 49 8E DE 79 1A FA 43 92 60 D1 98 41 96 26 04 16 A9 1A7F 59 76 14 6A BF 07 36 D4 76 92 0F 49 D1 F3 76 4D C6 0B C0 66 BF D7 33 08 23 89 47 B7 87 24 3A A6 CC 8F 05 12 1C B9 B3 10 4F BE 00 D0 5E 66 13 D1 A4 42 87 3A 3D 1F AA 10 3B 63 63 46 FC 9D 8E 53 00 15 BA 2C 73 4E 68 21 23 56 31 8B D7 21 92 23 29 AE 9D D7 F8 DD 9E B9 C0 32 97 91 64 78 58 91 7B 29 63 3B D0 B3 50 92 E3 78 9B 45 4D CD 61 B6 CB DD E5 13 ED 68 0C 4C 03 9A FB 2E 94 64 D1 7F 02 03 01 00 01 }
    condition:
        $pubkey
}

rule CrowdStrike_CSIR_15002_04 : hurricane_panda plugx certificate 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Certificate used to sign a tool used to delete a file or drop and run PlugX"
        reports = "CSIR-15002"
        version = "201501060000"
        last_modified = "2015-01-06"
        actor = "HURRICANE PANDA"
        malware_family = "PlugX"
    strings:
        $pubkey = { 30 82 01 22 30 0D 06 09 2A 86 48 86 F7 0D 01 01 01 05 00 03 82 01 0F 00 30 82 01 0A 02 82 01 01 00 D1 1A 7B 8C 65 8F 71 EF 60 B5 1B 5D 9A 01 DF AE 6A BB DA 26 0A 16 CC C3 91 56 0E B3 E9 C1 6A 21 64 BE A0 DE 4A FB F7 18 0B E9 B7 D5 4F FF 23 FA 9E 8D 2D 5E 2D 79 6B D5 3D 10 D4 2C 7E E0 19 85 B5 8F 55 EE 92 FF DB 25 C6 03 0C 02 8D F0 46 DA CF 3F 4F C5 14 C7 41 B6 81 B6 53 C4 CA DD 06 A6 37 79 9C 36 56 15 8D AE AC AC 02 A6 77 69 F4 FB FE 7C 48 8C AF D6 6F D2 C5 88 E0 FC 6C 22 9C ED D6 F2 0A 47 38 0C A1 85 F5 6B A0 62 FC 96 AD A0 29 7F 5D 9B E8 39 0D 8C F8 8F DF 29 91 0E 7E 1C 5D 19 43 53 AE 21 91 A2 B9 EE E7 6E 42 BB D6 C1 3B A0 1E FE 94 E2 E5 E8 03 A3 E7 1E 3B A8 AB D4 B6 42 46 23 A9 9F 79 B1 24 60 29 ED 0B D7 74 7E 89 9C FA 73 D0 23 26 7A CE 86 B6 32 25 84 FE 52 4E 11 2F 6D FC 29 BC BA 03 3A 06 4E F1 8C 54 5C F0 16 08 8E 3F 90 18 6F CD CF 6F 0D 8D BF 2A 93 02 03 01 00 01 }
    condition:
        $pubkey
}

rule CrowdStrike_CSIR_15002_05 : hurricane_panda plugx certificate 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Certificate used to sign a tool used to delete a file or drop and run PlugX"
        reports = "CSIR-15002"
        version = "201501060000"
        last_modified = "2015-01-06"
        actor = "HURRICANE PANDA"
        malware_family = "PlugX"
    strings:
        $pubkey = { 30 82 01 22 30 0D 06 09 2A 86 48 86 F7 0D 01 01 01 05 00 03 82 01 0F 00 30 82 01 0A 02 82 01 01 00 C0 82 3C 0A B5 7E 6C 9D D4 B6 DD 1A C8 8E 7B A1 DD 31 DD FB 33 64 47 E8 80 B9 08 E4 F3 14 D9 48 F5 AA 86 26 5D E0 BD 8B 11 96 20 9E 80 AD D0 2F C3 ED 20 A1 06 40 02 41 EF DB 5B 5D 69 DA 2F 1E 95 53 85 89 FD 60 9C 77 FF 66 07 1C 17 68 0B A1 A3 BC 9A 66 FB 5F 60 84 A1 E4 3C 79 1F 21 01 4E 62 19 89 1D 03 D0 79 65 3B CE EF 79 2A D1 07 94 85 58 09 A7 0F E3 AF 6B E8 65 D4 9D 17 72 70 21 38 12 2D 41 9B 93 88 22 D1 38 2E 8F 04 45 A7 2F 1F 88 F8 FE 04 95 F8 12 63 7F C1 2C 72 DB A7 CD DB D2 89 E5 00 B7 92 9F D7 59 21 C4 28 B6 E4 67 FC 1B 0D EE 19 F7 19 87 7E 40 11 B0 76 56 97 79 6A A0 C5 FA 8B 61 D6 65 53 1C E2 07 E4 43 31 61 D1 0C 60 DE DD 80 00 63 31 C5 6D 46 91 C8 2B 0F 96 CF 4F 6E AB 7C 5E 58 AA 85 2A E2 CB 28 01 37 94 C0 36 01 1C 1E CD EF F5 BC 5A 10 46 3C CF D5 02 03 01 00 01 }
    condition:
        $pubkey
}

rule CrowdStrike_CSIR_15002_06 : hurricane_panda plugx certificate 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Certificate used to sign a tool used to delete a file or drop and run PlugX"
        reports = "CSIR-15002"
        version = "201501060000"
        last_modified = "2015-01-06"
        actor = "HURRICANE PANDA"
        malware_family = "PlugX"
    strings:
        $pubkey = { 30 82 01 22 30 0D 06 09 2A 86 48 86 F7 0D 01 01 01 05 00 03 82 01 0F 00 30 82 01 0A 02 82 01 01 00 92 A7 82 F5 BB 0C 5C 05 2C 76 46 AD D5 08 6E 65 0C F8 79 8B BC CE 31 90 10 80 EB 9D E9 D8 E0 D5 00 E9 4B 89 A2 54 8D 83 90 EC 65 B9 83 4B AF EE 71 56 19 09 E9 3F 82 6A 0F CB 42 97 BB 9F CF A3 20 EC 7F 29 AF C7 65 88 C5 73 D1 9F CC F5 DD 79 37 C3 7B 98 24 F6 B0 8F 04 EF 92 03 EE 07 B3 94 90 A0 D7 2D B3 F7 6F AB 45 A7 0E 43 79 E0 7B 18 A6 26 90 EF A7 C3 68 EE E0 23 D3 89 05 CB C5 93 82 2E 54 9F 00 2C D1 D0 EF 2C 19 F7 41 73 8C 45 EE 94 26 09 72 1E A8 8A B8 CF AD 77 84 5E 36 B9 C8 03 95 7D C6 CD AA EB FA D5 A1 8D 2F 2F 37 06 FB DF 01 2C C4 32 E9 CC F8 38 11 C4 21 4B EC EF 53 DF 18 59 DB 77 A1 2F B6 54 1F 6D CB 53 48 0F 5D 87 A3 0E 0F 02 A4 35 F5 E9 9C EC 21 A6 88 56 86 F9 65 27 EC 44 22 DD 79 5A EF 1F 05 7F AC 7A 04 BF FA E7 8B A1 54 C7 39 1C 55 30 8C 9B 04 9D 02 03 01 00 01 }
    condition:
        $pubkey
}

rule CrowdStrike_CSIR_15002_07 : hurricane_panda plugx certificate 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Certificate used to sign a tool used to delete a file or drop and run PlugX"
        reports = "CSIR-15002"
        version = "201501060000"
        last_modified = "2015-01-06"
        actor = "HURRICANE PANDA"
        malware_family = "PlugX"
    strings:
        $pubkey = { 30 82 01 0A 02 82 01 01 00 C0 6B F1 C2 61 9D A5 BA 82 9C E4 FE 24 F5 7E 16 DE 70 AF 71 C5 17 62 E7 04 38 FD DE DC 8A D5 60 C9 80 25 8B 8C 80 C1 82 8C 56 39 FA EA D7 BE 92 B7 B5 52 DF 52 F1 5A 8D 3A 29 E9 46 FD 2F 4B D2 9C 74 32 9A C9 48 6B 50 EF 1E 3A 27 49 77 E9 4D 44 02 FB 02 76 16 16 AD 02 7B 7A 3A C1 68 BA 12 63 70 7C 6A 21 4F C5 53 E1 42 05 F2 5F F9 99 00 05 07 DD BB A9 34 E2 28 2B B0 B1 D4 2F DE 32 63 02 8B ED C7 69 42 21 45 D9 89 1F 96 D1 B3 4E 5D 8E 2C E8 2C 7D 37 0A 4F 7D 7D ED E6 84 6C 55 AF EB 60 C4 65 E0 BA C1 E5 EA 51 1B 79 D7 13 AF 55 11 14 FC EF B9 72 2D F7 E4 A6 9F 9B 36 D1 B9 65 76 61 E9 44 04 30 92 18 9F 1B E2 19 F4 F8 3D DD B9 C9 AA 2E 72 00 7C AB 52 6D 20 F2 E8 2D EF D0 F3 25 33 E5 B7 BA 59 9F 9E F7 F0 B4 A2 E6 7E 75 C2 4A 90 24 A4 B0 53 90 BE 93 90 8C 55 A5 BA ED 02 03 01 00 01 }
    condition:
        $pubkey
}

rule CrowdStrike_CSIR_15002_08 : hurricane_panda plugx rat dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Rule looks for strings in a file used to either delete a file or decrypt, drop, and run PlugX"
        reports = "CSIR-15002"
        version = "201501060000"
        last_modified = "2015-01-06"
        actor = "HURRICANE PANDA"
        malware_family = "PlugX"
    strings:
        $func_error = "Can't find Func 0x%x in %s!"
        $filename_content = "Content.dll"
        $filename_contents = "Contents.dll"
        $filename_credentials = "Credentials.dll"
    condition:
        $func_error and 1 of ($filename_*)
}

rule CrowdStrike_CSIT_15003_01 : mozartpos pos_scraper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "MozartPoS executable"
        reports = "CSIT-15003"
        version = "201501060000"
        last_modified = "2015-01-06"
        malware_family = "MozartPoS"
    strings:
        $pdb_string = "Slender\\mozart\\mozart\\Release\\mozart.pdb"
        $embedded_path = "XFxTVFdJU00lc1xEZXZpY2VVcGRhdGVzXDUwMFxhdGhlbmEuZGxs"
        $start_service_call = "cmd /c net start %s"
        $log_file = "garbage.tmp"
    condition:
        all of them
}

rule CrowdStrike_CSIT_15103_05 : hurricane_panda plugx dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Rule looks for strings in a file used by actors to either delete a file or decrypt, drop, and run Plugx."
        reports = "CSIT-15103"
        version = "201501060000"
        last_modified = "2015-01-06"
        actor = "HURRICANE PANDA"
        malware_family = "PlugX"
    strings:
        $func_error = "Can't find Func 0x%x in %s!"
        $filename_content = "Content.dll"
        $filename_contents = "Contents.dll"
        $filename_credentials = "Credentials.dll"
    condition:
        $func_error and 1 of ($filename_*)
}

rule CrowdStrike_CSIT_15010_01 : rat9002 shellcode 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Base64-encoded wrapper shellcode for 9002 RAT"
        reports = "CSIT-15010"
        version = "201501070000"
        last_modified = "2015-01-07"
        actor = "AURORA PANDA"
        malware = "9002 RAT, Naid, McProxy, Hydraq"
    strings:
        $shellcode = "TbeVfJV7loeBgYEm/b5v/k5sPj//h5wGfn4LjY"
    condition:
        all of them
}

rule CrowdStrike_CSIT_15008_01 : velvet_chollima wiper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "MBR wiping malware"
        reports = "CSIT-15008"
        version = "201812051512"
        last_modified = "2018-12-05"
        actor = "VELVET CHOLLIMA"
    strings:
        $ = { c6 84 24 14 01 00 00 77 c6 84 24 14 01 00 00 73 c6 84 24 14 01 00 00 73 c6 84 24 14 01 00 00 73 c6 84 24 14 01 00 00 2e c6 84 24 14 01 00 00 64 c6 84 24 14 01 00 00 6c c6 84 24 14 01 00 00 6c c6 84 24 14 01 00 00 00 }
        $ = { c6 85 f0 fd ff ff b8 c6 85 f0 fd ff ff 12 c6 85 f0 fd ff ff 00 c6 85 f0 fd ff ff cd c6 85 f0 fd ff ff 10 c6 85 f0 fd ff ff bd c6 85 f0 fd ff ff 18 c6 85 f0 fd ff ff 7c c6 85 f0 fd ff ff b9 }
        $ = { 81 bd d8 f9 ff ff 45 46 49 20 0f 85 ?? ?? ?? ?? 81 bd dc f9 ff ff 50 41 52 54 0f 85 }
    condition:
        any of them
}

rule CrowdStrike_CSIT_15008_02 : velvet_chollima wiper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "MBR wiping malware (64-bit)"
        reports = "CSIT-15008"
        version = "201812051516"
        last_modified = "2018-12-05"
        actor = "VELVET CHOLLIMA"
    strings:
        $ = { c6 44 24 70 b8 c6 44 24 71 12 c6 44 24 72 00 c6 44 24 73 cd c6 44 24 74 10 c6 44 24 75 bd c6 44 24 76 18 c6 44 24 77 7c }
    condition:
        any of them
}

rule CrowdStrike_CSIT_15008_03 : velvet_chollima wiper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Replacement MBR used by the MBR wiping malware"
        reports = "CSIT-15008"
        version = "201812051517"
        last_modified = "2018-12-05"
        actor = "VELVET CHOLLIMA"
    strings:
        $ = { b8 12 00 cd 10 bd 18 7c b9 18 00 b8 01 13 bb 0c 00 ba 1d 0e cd 10 e2 fe 57 68 6f 20 41 6d 20 49 }
    condition:
        any of them
}

rule CrowdStrike_CSIT_15010_02 : rat9002 config 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "9002 RAT configuration block"
        reports = "CSIT-15010"
        version = "201501080000"
        last_modified = "2015-01-08"
        actor = "AURORA PANDA"
        malware = "9002 RAT"
    strings:
        $marker = { 25 00 53 00 00 00 00 00 25 00 53 00 00 00 00 00 25 00 53 00 00 00 00 00 25 00 53 00 00 00 00 00 45 00 64 00 69 00 74 00 00 00 00 00 25 6c 73 00 }
    condition:
        all of them
}

rule CrowdStrike_CSIT_15010_03 : rat9002 rat unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "9002 RAT, new version - unpacked strings"
        reports = "CSIT-15010"
        version = "201501080000"
        last_modified = "2015-01-08"
        actor = "AURORA PANDA"
        malware = "9002 RAT"
    strings:
        $fmtstr1 = "POST http://%ls:%d/l%x HTTP/1.1"
        $export = "CreatePluginObj"
        $msg = "Dog create a loop thread"
    condition:
        all of them
}

rule CrowdStrike_CSIT_15010_04 : rat9002 loader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Probably malicious Powershell loader script"
        reports = "CSIT-15010"
        version = "201501080000"
        last_modified = "2015-01-08"
        actor = "AURORA PANDA"
    strings:
        $pshell = "powershell.exe\" -WindowStyle Hidden -NonInteractive"
        $b64 = "SC = [System.COnvert]::FromBase64String($y)"
        $xor = "SC[$i]=$SC[$i] -bxor $key[0]"
        $wproc = "WriteProcessMemory.Invoke"
    condition:
        all of them
}

rule CrowdStrike_CSIT_15008_04 : shellcode velvet_chollima 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Shellcode used in exploit documents dropping MBR wiping malware"
        reports = "CSIT-15008"
        version = "201812051517"
        last_modified = "2018-12-05"
        actor = "VELVET CHOLLIMA"
    strings:
        $ = { 5d 8b 55 f4 03 d0 c7 02 77 73 73 73 c7 42 04 2e 64 6c 6c c7 42 08 00 00 00 00 c7 45 }
        $ = { 41 8b 34 8a 03 f5 33 ff c1 cf 0d ac 03 f8 85 c0 75 f6 }
        $ = { 8a 5e fe 8a 56 ff 8a c3 32 c2 30 06 46 41 3b 4d f8 75 ed }
        $ = { 8a 06 8b cf 83 e1 07 8a d8 d2 e3 b2 08 2a d1 8a ca d2 e8 02 c3 33 c7 88 06 46 47 3b }
    condition:
        any of them
}

rule CrowdStrike_CSIT_15033_01 : sunx bootkit installer 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Sunx bootkit installer"
        reports = "CSIT-15033"
        version = "201501120000"
        last_modified = "2015-01-12"
        malware_family = "Sunx"
    strings:
        $ = "I: Found IBM HPA !!!"
        $ = "E: Clear boot 2 failed !!!"
        $ = "E: Write bios failed !!!"
        $ = "Lastfree %9I64u - %9I64u, %9I64u clusters, %d k; %s"
        $ = "E: It's not hdd boot data"
        $ = "Image place PhyDisk %d, (%u - %u) %u sectors"
        $ = "I: It's not our hdd bios data :)"
        $ = "I: Backdoor size %6d B, will use %3d sectors"
        $ = "I: rkImage size  %6d B, will use %3d sectors"
        $ = "I: boot size     %6d B, will use %3d sectos"
        $ = "I: mbr size      %6d B, will use %3d sectos"
        $ = "E: Bad rkimage size, too large !!!"
        $ = "E: Initialize driver failed, r u admin ?"
    condition:
        2 of them
}

rule CrowdStrike_CSIR_15003_02 : china_chopper webshell 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "China Chopper webshell .NET variant"
        reports = "CSIR-15003"
        version = "201501130000"
        last_modified = "2015-01-13"
        malware_family = "China Chopper"
    strings:
        $func_0 = "JScript 0"
        $func_1 = "JScript 1"
        $string_0 = "__ASP"
        $string_1 = "Microsoft.JScript.Vsa"
        $string_2 = "System.Web.UI"
        $string_3 = "Eval"
        $string_4 = "JScript Module"
    condition:
        (any of ($func*) and all of ($string*) )
        // PE binary
        and uint16(0) == 0x5A4D and uint32(uint32(0x3c)) == 0x4550
        // DLL
        and uint16(uint32(0x3C) + 0x16) & 0x2000 == 0x2000
        and (
        // Mono/.NET 32bit
        (
        uint16(uint32(0x3c)+24) == 0x010b
        and uint32(uint32(0x3c)+232) > 0
        )
        // Mono/.NET 64bit
        or (
        uint16(uint32(0x3c)+24) == 0x020b
        and uint32(uint32(0x3c)+248) > 0
        )
        )
}

rule CrowdStrike_CSIT_15033_02 : sunx bootkit artifact 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Sunx bootkit Master Boot Record"
        reports = "CSIT-15033"
        version = "201501190000"
        last_modified = "2015-01-19"
        malware_family = "Sunx"
    strings:
        $ = { aa 55 8e c0 8e d8 fb fc be 00 7c bf 00 06 b9 00 01 f3 a5 b8 88 06 50 c3 b8 02 02 bb 00 7a b9 1a 00 cd 13 b9 00 04 bb 00 7a 8a 07 34 76 88 07 43 }
    condition:
        any of them
}

rule CrowdStrike_CSIR_15003_01 : hkdoor rat config 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "HkDoor RAT configuration block"
        reports = "CSIR-15003"
        version = "201501200000"
        last_modified = "2015-01-20"
        malware_family = "HkDoor"
    strings:
        $config_map = { 5a 31 22 4f 67 24 59 78 72 3c 3e 65 21 63 2e 2b 73 49 6e 37 51 58 38 25 66 40 5e 54 71 26 35 2a 4d 28 64 20 3f 74 2f 77 6b 5b 23 4e 52 56 4b 55 75 79 3a 7c 2d 61 5f 60 6c 27 50 48 5c 39 6f 6a 70 32 53 69 2c 57 44 3b 4c 33 42 7e 7d 43 68 3d 6d 30 7a 45 36 76 7b 47 41 29 34 62 46 4a 5d }
    condition:
        all of them
}

rule CrowdStrike_CSIT_15012_01 : newposthing pos_scraper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detection for NewPoSThing PoS malware"
        reports = "CSIT-15012"
        version = "201501250000"
        last_modified = "2015-01-25"
        malware_family = "NewPoSThing"
    strings:
        $base64_alphabet = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"
        $insert_request = "cs=aW5zZXJ0&p="
    condition:
        all of them
}

rule CrowdStrike_CSIT_15028_01 : rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Rule that looks for decryption routine of self-decrypting code"
        reports = "CSIT-15028"
        version = "202010051801"
        last_modified = "2020-10-05"
    strings:
        $x86_decrypt = { 8d 04 11 25 01 00 00 80 79 05 48 83 c8 fe 40 fe c0 83 7d 0c 00 74 04 00 06 eb 02 28 06 }
        $x64_decrypt = { 43 8d 0c 03 81 e1 01 00 00 80 7d 07 ff c9 83 c9 fe ff c1 fe c1 85 db 74 05 41 00 0a eb 03 41 28 0a }
    condition:
        any of them
}

rule CrowdStrike_CSIT_15092_02 : rat9002 rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "9002 RAT, new version ws2_32 fake DLL loader"
        reports = "CSIT-15092"
        version = "201501290000"
        last_modified = "2015-01-29"
        malware_family = 9002
    strings:
        $mutex = "xws2_32"
        $path = "\\ws2_32.dll"
        $const1 = { df 9b 57 13 }
        $const2 = { e0 ac 68 24 }
        $const3 = { 31 75 b9 fd }
    condition:
        all of them
}

rule CrowdStrike_CSIT_15022_01 : alina pos_scraper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Alina PoS malware executable"
        reports = "CSIT-15022"
        version = "202101121558"
        last_modified = "2021-01-12"
        malware_family = "Alina"
    strings:
        $regex_path = "{[!12!]}{[!10!]}http://%s:%d{[!4!]}"
        $shellcode_mutex = "SHELLCODE_MUTEX"
        $monitor_mutex = "7YhngylKo09H"
        $error_message = "errorretrieving"
    condition:
        2 of them
}

rule CrowdStrike_CSIT_15018_01 : cozy_bear cosmicduke rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "CosmicDuke RAT"
        reports = "CSIT-15018"
        version = "201502020000"
        last_modified = "2015-02-02"
        actor = "COZY DUKE"
        malware_family = "CosmicDuke"
    strings:
        $service_install = "/combine local system" wide
        $rc4_key_0 = "FB7V61C7509E4L99BDZ7F74A79A69CDF"
        $rc4_key_1 = "AdjustKernelTableFromSSDTSpace2"
        $deletion_batch = "echo del \"%TEMP%\\msicheck.cmd\" >> \"%TEMP%\\msicheck.cmd\""
        $blacklist_usb = "trandescend" wide
    condition:
        2 of them
}

rule CrowdStrike_CSIR_15004_02 : spicy_panda taidoor rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Taidoor cleanup routine"
        reports = "CSIR-15004"
        version = "201502060000"
        last_modified = "2015-02-06"
        actor = "SPICY PANDA"
        malware_family = "Taidoor"
    strings:
        $deleteloop = { 83 fe 0a 7d 17 57 ff d3 85 c0 75 10 ff d5 68 e8 03 00 00 ff 15 00 50 40 00 46 eb e4 }
    condition:
        all of them
}

rule CrowdStrike_CSIR_15004_08 : spicy_panda k4rat rat dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Dropper used to deploy K4Rat"
        reports = "CSIR-15004"
        version = "201502060000"
        last_modified = "2015-02-06"
        actor = "SPICY PANDA"
        malware_family = "K4Rat"
    strings:
        $t1 = "tmp.dll"
        $t2 = "tmp.dat"
        $idr = "IDR_BIN"
        $find = "FindResourceA"
        $load = "LoadResource"
        $lock = "LockResource"
    condition:
        all of them
}

rule CrowdStrike_CSIR_15004_09 : spicy_panda k4rat rat loader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Loader used to initialize K4Rat"
        reports = "CSIR-15004"
        version = "201502060000"
        last_modified = "2015-02-06"
        actor = "SPICY PANDA"
        malware_family = "K4Rat"
    strings:
        $file = "tmp.dat"
        $export_1 = "?GetMsgProc@@YGJHIJ@Z"
        $export_2 = "ishk"
        $dllname = "msjetodb.dll"
        $xoorloop = { 8A 0C 18 80 F1 ?? 88 0C 18 40 3B C7 7C F2 }
    condition:
        3 of them
}

rule CrowdStrike_CSIR_15004_10 : spicy_panda k4rat rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "K4Rat"
        reports = "CSIR-15004"
        version = "201502060000"
        last_modified = "2015-02-06"
        actor = "SPICY PANDA"
        malware_family = "K4Rat"
    strings:
        $dllname = "K4Dll.dll"
        $win = "The Window"
        $clsid_1 = "AEBA21FA-782A-4A90-978D-B72164C80120"
        $clsid_2 = "A8A88C49-5EB2-4990-A1A2-0876022C854F"
        $msg = "</MSG>"
        $key = { a1 a2 a3 a4 00 }
        $m_0 = "<M00>"
        $m_13 = "</M13>"
        $ua = "Mozilla/4.0 (Compatible; MSIE 6.0;)"
    condition:
        4 of them
}

rule CrowdStrike_CSIR_15004_11 : dropper k4rat spicy_panda 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "K4Rat dropper"
        reports = "CSIR-15004"
        version = "201901221457"
        last_modified = "2019-01-22"
        actor = "SPICY PANDA"
        malware_family = "K4Rat"
    strings:
        $http_enc = "\x0022e2HQoG"
        $https_enc = "\x0022e2HUMT"
    condition:
        any of them
}

rule CrowdStrike_CSIT_15013_01 : numbered_panda ixeshe rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects a series of MOV instructions used to generate a string found in a NUMBERED PANDA Ixeshe RAT variant"
        reports = "CSIT-15013"
        version = "201502060000"
        last_modified = "2015-02-06"
        actor = "NUMBERED PANDA"
        malware_family = "Ixeshe"
    strings:
        $kb_71271_log = { c6 85 ?? fe ff ff 6b c6 85 ?? fe ff ff 62 c6 85 ?? fe ff ff 37 c6 85 ?? fe ff ff 31 c6 85 ?? fe ff ff 32 c6 85 ?? fe ff ff 37 c6 85 ?? fe ff ff 31 c6 85 ?? fe ff ff 2e c6 85 ?? fe ff ff 6c c6 85 ?? fe ff ff 6f c6 85 ?? fe ff ff 67 c6 85 ?? fe ff ff 00 }
        $proc  = "Process Do not exit in 10 second, so i Kill it!"
    condition:
        $kb_71271_log and not $proc
}

rule CrowdStrike_CSIT_15013_02 : numbered_panda ixeshe rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects a series of MOV instructions used to generate a string found in a NUMBERED PANDA Ixeshe RAT variant"
        reports = "CSIT-15013"
        version = "201502060000"
        last_modified = "2015-02-06"
        actor = "NUMBERED PANDA"
        malware_family = "Ixeshe"
    strings:
        $http_header = { c6 85 ?? f7 ff ff 6d c6 85 ?? f7 ff ff 69 c6 85 ?? f7 ff ff 63 c6 85 ?? f7 ff ff 72 c6 85 ?? f7 ff ff 6f c6 85 ?? f7 ff ff 73 c6 85 ?? f7 ff ff 6f c6 85 ?? f7 ff ff 66 c6 85 ?? f7 ff ff 74 c6 85 ?? f7 ff ff 5f c6 85 ?? f7 ff ff 70 c6 85 ?? f7 ff ff 72 c6 85 ?? f7 ff ff 65 c6 85 ?? f7 ff ff 64 c6 85 ?? f7 ff ff 61 c6 85 ?? f7 ff ff 74 c6 85 ?? f7 ff ff 6f c6 85 ?? f7 ff ff 72 c6 85 ?? f7 ff ff 5f c6 85 ?? f7 ff ff 63 c6 85 ?? f7 ff ff 6c c6 85 ?? f7 ff ff 69 c6 85 ?? f7 ff ff 65 c6 85 ?? f7 ff ff 6e c6 85 ?? f7 ff ff 74 c6 85 ?? f7 ff ff 3a c6 85 ?? f7 ff ff 20 c6 85 ?? f7 ff ff 25 c6 85 ?? f7 ff ff 73 c6 85 ?? f7 ff ff 0d c6 85 ?? f7 ff ff 0a c6 85 ?? f7 ff ff 00 }
    condition:
        $http_header
}

rule CrowdStrike_CSIT_15027_01 : cryptowall ransomware 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "CryptoWall Ransomware"
        reports = "CSIT-15027"
        version = "201502060000"
        last_modified = "2015-02-06"
        malware_family = "CryptoWall"
    strings:
        $ = "DECRYPT_INSTRUCTION.TXT" wide
        $ = "DECRYPT_INSTRUCTION.HTML" wide
        $ = "HELP_DECRYPT.TXT" wide
        $ = "HELP_DECRYPT.HTML" wide
        $ = "HELP_DECRYPT.URL" wide
        $ = "HELP_DECRYPT.PNG" wide
    condition:
        4 of them
}

rule CrowdStrike_CSIR_15004_05 : spicy_panda taleret taidoor loader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Taidoor/Taleret loader"
        reports = "CSIR-15004"
        version = "201807271506"
        last_modified = "2018-07-27"
        actor = "SPICY PANDA"
        malware_family = "Taidoor, Taleret"
    strings:
        $webhp = "/webhp?source="
        $pass = "WRONG PASSWORD"
        $cert = "NOT Certified"
        $aft_d = "AFTER: Disconnect"
        $alot = "%tmp%\\~alot.dat"
        $void = "Void"
    condition:
        4 of them
}

rule CrowdStrike_CSIR_15004_06 : spicy_panda taleret rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Taleret AES variant"
        reports = "CSIR-15004"
        version = "201807271505"
        last_modified = "2018-07-27"
        actor = "SPICY PANDA"
        malware_family = "Taleret"
    strings:
        $aesstacksbox = {C6 44 24 14 63 C6 44 24 15 7C C6 44 24 16 77 C6 44 24 17 7B}
        $aesinvstacksbox = {C6 84 24 F3 01 00 00 EF C6 84 24 F4 01 00 00 A0 C6 84 24 F5 01 00 00 E0 C6 84 24 F6 01 00 00 3B}
        $beaconstr = "%s/%s/%s.php?%s_id="
    condition:
        all of them
}

rule CrowdStrike_CSIR_15004_07 : spicy_panda taleret rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Taleret AES variant"
        reports = "CSIR-15004"
        version = "201807271506"
        last_modified = "2018-07-27"
        actor = "SPICY PANDA"
        malware_family = "Taleret"
    strings:
        $loopback = "127.0.0.1"
        $beaconstr = "%s/%s/%s.php?%s_id="
        $exitcmd = {65 78 69 74 0D 0A}
        $cmd = "ComSpec"
        $unkhost = "unknown"
        $content = "Content-Type:application/x-www-form-urlencoded"
        $encoding = "Accept-Encoding:gzip,deflate"
    condition:
        all of them
}

rule CrowdStrike_CSIR_15004_03 : spicy_panda taleret rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Taleret DllHandler variant, version A"
        reports = "CSIR-15004"
        version = "201807271506"
        last_modified = "2018-07-27"
        actor = "SPICY PANDA"
        malware_family = "Taleret"
    strings:
        $bignameformat = { 4E 61 6D 65 31 3A 25 73 0D 0A 50 6F 72 74 3A 25
        64 2C 25 64 2C 25 64 0D 0A 4E 61 6D 65 32 3A 25
        73 0D 0A 50 6F 72 74 3A 25 64 2C 25 64 2C 25 64
        0D 0A 4E 61 6D 65 33 3A 25 73 0D 0A 50 6F 72 74
        3A 25 64 2C 25 64 2C 25 64 0D 0A 4E 61 6D 65 34
        3A 25 73 0D 0A 50 6F 72 74 3A 25 64 2C 25 64 2C
        25 64 0D 0A 4E 61 6D 65 35 3A 25 73 0D 0A 50 6F
        72 74 3A 25 64 2C 25 64 2C 25 64 0D 0A 0D 0A 43 }
    condition:
        all of them
}

rule CrowdStrike_CSIR_15004_04 : spicy_panda taleret rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Taleret DllHandler variant, version B"
        reports = "CSIR-15004"
        version = "201807271505"
        last_modified = "2018-07-27"
        actor = "SPICY PANDA"
        malware_family = "Taleret"
    strings:
        $bigformat = { 25 73 3A 25 73 0D 0A 25 73 3A 25 64 2C 25 64 2C
        25 64 0D 0A 25 73 3A 25 73 0D 0A 25 73 3A 25 64
        2C 25 64 2C 25 64 0D 0A 25 73 3A 25 73 0D 0A 25
        73 3A 25 64 2C 25 64 2C 25 64 0D 0A 25 73 3A 25
        73 0D 0A 25 73 3A 25 64 2C 25 64 2C 25 64 0D 0A
        25 73 3A 25 73 0D 0A 25 73 3A 25 64 2C 25 64 2C
        25 64 0D 0A 0D 0A 25 73 3A 25 64 20 6D 73 0D 0A
        25 73 3A 25 73 00 }
    condition:
        all of them
}

rule CrowdStrike_CSIT_15017_01 : sharpserver rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "SharpServer RAT"
        reports = "CSIT-15017"
        version = "201807300919"
        last_modified = "2018-07-30"
        malware_family = "SharpServer"
    strings:
        $ = "SharpServer.exe"
        $ = "SharpServer.Properties"
        $ = "Capture_Screen_AsCurrentUser"
        $ = "ChangeWorkingAddress"
    condition:
        all of them
}

rule CrowdStrike_CSIT_15016_01 : stalker_panda elirks rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Elirks RAT, 2014 variant"
        reports = "CSIT-15016"
        version = "201807271803"
        last_modified = "2018-07-27"
        actor = "STALKER PANDA"
        malware_family = "Elirks"
    strings:
        // Environment variable name
        $envvar = "JOB_QUEUE" wide
        // INI file name
        $filename = "FileHash.ini" wide
        // User agent string
        $ua = "Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1)" wide
        // Self-delete script
        $script = { 3a 52 65 0a 64 65 6c 20 25 31 0a 69 66 20 65 78 69 73 74 20 25 31 20 67 6f 74 6f 20 52 65 0a 64 65 6c 20 25 30 0a 00 00 }
    condition:
        all of them
}

rule CrowdStrike_CSIT_15021_02 : cozy_bear ati_agent dropper rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Dropper and main payload for ATI Agent"
        reports = "CSIT-15021"
        version = "201502120000"
        last_modified = "2015-02-12"
        actor = "COZY BEAR"
        malware_family = "ATI-Agent"
    strings:
        $strdeobf = { 8b 31 0f be 34 06 0f b6 79 08 66 33 f7 66 33 f0 bf ff 00 00 00 66 23 f7 66 89 34 42 40 3b 41 04 }
    condition:
        all of them
}

rule CrowdStrike_CSIT_13082_06 : chopper webshell 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Rule to detect a CSharp version of the China Chopper webshell"
        reports = "CSIT-13082,CSIT-14073"
        version = "201502190000"
        last_modified = "2015-02-19"
        malware_family = "Chopper"
    strings:
        $pdbfrag    = "ChopperSreverForCsharp"
        $ban1       = "CsharpChopperServerScriptRunner By zcgonvh" ascii wide
        $chop_a     = "ChopperApi_A_Get_LocalDirectory"
        $chop_b     = "ChopperApi_B_GetFileList"
    condition:
        2 of them
}

rule CrowdStrike_CSIT_15019_01 : zonero rat unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Zonero Python-based RAT. Due to the compression used by this RAT this rule is most effective when used for memory scanning."
        reports = "CSIT-15019"
        version = "201502190000"
        last_modified = "2015-02-19"
        malware_family = "Zonero"
    strings:
        $ = "environ['PATH'] = \"\".join([it for it in environ['PATH'].split(\";\") if not it.find(\"iCLS Client\")>0])"
        $ = "\"\".join([it for it in os.environ['PATH'].split(\";\") if not it.find(\"iCLS Client\")>0])"
        $ = { 64 65 66 20 6b 69 6c 6c 70 69 64 28 62 6e 61 6d 65 29 3a 20 20 0a 20 20 20 20 70 63 6f 75 6e 74 20 3d 20 30 0a 20 20 20 20 78 78 20 3d 20 }
        $ = "def dnd(na,hname,dir2):"
        $ = "print \"Inside capturing a valid KeyStroke\""
        $ = "destpath ='C:\\\\Trash\\\\cookie\\\\'"
    condition:
        any of them
}

rule CrowdStrike_CSIT_15020_01 : delivery_document dropper cve_2014_7247 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Ichitaro document exploiting CVE-2014-7247"
        reports = "CSIT-15020"
        version = "201502190000"
        last_modified = "2015-02-19"
    strings:
        $shellcode1 = { 2e 81 de 04 bd 02 2a 0e  08 31 21 d8 df 3b a0 6d 42 6c 3f 51 57 2d 44 40  7c 77 40 88 b3 41 21 0a 44 f6 df f6 90 10 71 f4  c7 70 fd 23 63 4c fc 16 16 c9 ef 43 02 0a c4 db  52 16 04 75 fb 03 10 de 0a 7e 23 28 b8 71 f6 57  5c 2a ce 11 49 d9 33 a0 7a 92 dd 19 0b 8b 17 49  dd b6 d8 5a 9b df 05 1d 9a 8f c6 82 4a 57 58 b5  92 47 76 c4 0a ed b1 70 4c d8 7c 89 78 c6 47 88  cf 64 32 62 13 f1 1b 40 45 c4 c3 24 b1 03 f4 02  68 e7 33 d9 8c 53 df 3a b2 45 ff 69 19 3e 07 9f  fb 13 50 6f 40 7a 55 88 a7 72 90 fd cd 04 6d 76  e7 51 d1 27 3e 13 e7 55 eb 04 75 01 98 94 eb 04  75 01 98 94 eb 04 75 01 98 94 eb 04 75 01 98 94  eb 2b 98 94 58 eb 02 98 94 33 c9 eb 02 98 94 8b  f0 eb 02 98 94 b9 60 06 00 00 eb 02 98 94 8b c1  eb 02 98 94 30 44 0e ff 48 e2 f5 ff e6 eb 02 98  94 e8 ce ff ff ff 54 89 }
        $shellcode2 = { c0 1d 7b 1b 75 e2 c8 cb  5a db 5f a0 a1 a2 a3 63 e0 0e a7 a8 a9 aa 6c e9  51 ae af b0 b1 75 f6 78 f0 fb f2 ec 7e ff 6b 92  f9 f2 f3 07 84 16 c3 c4 c5 c6 00 8d 21 ca cb cc  cd 09 8a 3c d1 d2 d3 d4 12 93 33 d8 d9 da db 1b  98 2e df e0 e1 e2 24 a1 3d e6 e7 e8 e9 2d ae 58  ed ee ef f0 36 b7 07 f4 f5 f6 f7 3f bc 32 fb fc  fd fe 38 45 bd 02 03 04 05 c1 42 b0 09 0a 0b 0c  ca 4b d3 10 11 12 13 d3 50 f6 17 18 19 1a dc 59  e5 1e 1f 20 21 e5 66 88 25 26 27 28 ee 6f 9b 2c  2d 2e 2f f7 74 f6 33 34 35 36 b4 45 31 3a 4e 39  d4 54 39 40 41 c9 06 4c ce 0e 43 c1 04 fa c0 19  45 c5 4d d9 14 96 bb 54 55 56 57 00 d0 1f e3 d7  10 e6 d6 2d bd 89 6a ef 30 de e4 aa 68 e3 3e d4  e6 2b d7 5b 34 ae 4e 74 65 76 77 0b 4f f1 36 c4  fc 47 3e c1 c0 c3 f6 ad 0e d3 3f 09 f3 8e fb 0c  1d 2e fa 8d 1a d7 2b 1f }
    condition:
        all of them
}

rule CrowdStrike_CSIT_15032_01 : neverquest installer 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "NeverQuest banking trojan installer"
        reports = "CSIT-15032"
        version = "201502240000"
        last_modified = "2015-02-24"
        malware_family = "NeverQuest"
    strings:
        $reg = "regsvr32.exe \"%s"
        $regpath = "SOFTWARE\\"
        $subkey = "{%0.4X%0.4X-%0.4X-%0.4X-%0.4X-%0.4X%0.4X%0.4X}"
        $aplib = "aPLib v1.01  -  the smaller the better :)"
        $priv = "SeDebugPrivilege"
        $process = "iexplore.exe"
    condition:
        all of them
}

rule CrowdStrike_CSIT_15032_02 : neverquest trojan 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "NeverQuest banking trojan"
        reports = "CSIT-15032"
        version = "201502240000"
        last_modified = "2015-02-24"
        malware_family = "NeverQuest"
    strings:
        $s01 = "[%s - X64 EQ PID: %u TID: %u]"
        $s02 = "[%s - X32 EQ PID: %u TID: %u]"
    condition:
        all of them
}

rule CrowdStrike_CSIT_15039_05 : shadow_crane sharpshooter rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Sharpshooter: DLL installed by dropper after extraction from archive/executable"
        reports = "CSIT-15039"
        version = "201807271452"
        last_modified = "2018-07-27"
        actor = "SHADOW CRANE"
        malware_family = "SharpShooter"
    strings:
        $xor_key = { 37 db a9 ec }
        $beacon = { 66 c7 ?? ?? 3f 00 66 c7 ?? ?? ?? 41 00 66 c7 ?? ?? ?? 78 00 66 c7 ?? ?? ?? 54 00 66 c7 ?? ?? ?? 39 00 66 c7 ?? ?? ?? 32 00 66 c7 ?? ?? ?? 79 00 66 c7 ?? ?? ?? 50 00 66 c7 44 7e 10 3d 00 }
        $mutex_frag = { 66 c7 ?? ?? 41 00 66 c7 ?? ?? 45 00 66 c7 ?? ?? 65 00 66 c7 ?? ?? 47 00 66 c7 ?? ?? 43 00 66 c7 ?? ?? 31 00 66 c7 ?? ?? 33 00 66 c7 ?? ?? 33 00 66 c7 ?? ?? 51 00 66 c7 ?? ?? 77 00 }
    condition:
        2 of them
}

rule CrowdStrike_CSIT_15039_04 : shadow_crane sharpshooter injector 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Sharpshooter code injector: EXE installed by dropper after extraction from archive/executable"
        reports = "CSIT-15039"
        version = "201805110950"
        last_modified = "2018-05-11"
        actor = "SHADOW CRANE"
        malware_family = "SharpShooter"
    strings:
        $xor_key = { 37 db a9 ec }
        $mutex = { c6 85 ?? ?? ff ff 41 c6 85 ?? ?? ff ff 45 c6 85 ?? ?? ff ff 65 c6 85 ?? ?? ff ff 47 c6 85 ?? ?? ff ff 43 c6 85 ?? ?? ff ff 31 c6 85 ?? ?? ff ff 33 c6 85 ?? ?? ff ff 33 c6 85 ?? ?? ff ff 51 c6 85 ?? ?? ff ff 77 }
        $dll_name = { c6 85 ?? ?? ff ff 61 c6 85 ?? ?? ff ff 67 c6 85 ?? ?? ff ff 65 c6 85 ?? ?? ff ff 6e c6 85 ?? ?? ff ff 74 c6 85 ?? ?? ff ff 44 c6 85 ?? ?? ff ff 6c c6 85 ?? ?? ff ff 6c c6 85 ?? ?? ff ff 2e c6 85 ?? ?? ff ff 64 c6 85 ?? ?? ff ff 6c c6 85 ?? ?? ff ff 6c }
    condition:
        all of them
}

rule CrowdStrike_CSIT_15039_03 : shadow_crane sharpshooter dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Indicators of installation used by older variants of the Sharpshooter dropper executable"
        reports = "CSIT-15039"
        version = "201807271451"
        last_modified = "2018-07-27"
        actor = "SHADOW CRANE"
        malware_family = "SharpShooter"
    strings:
        $bat = { 66 c7 ?? 77 00 66 c7 ?? ?? 75 00 66 c7 ?? ?? 64 00 66 c7 ?? ?? 66 00 66 c7 ?? ?? 2e 00 66 c7 ?? ?? 62 00 66 c7 ?? ?? 61 00 66 c7 ?? ?? 74 00 }
        $key = { c6 00 41 ?? ?? ?? ?? 00 c6 40 ?? 78 ?? ?? ?? ?? 00 c6 40 ?? 78 ?? ?? ?? ?? 00 c6 40 ?? 43 ?? ?? ?? ?? 00 c6 40 ?? 74 ?? ?? ?? ?? 00 c6 40 ?? 74 ?? ?? ?? ?? 00 c6 40 ?? 31 ?? ?? ?? ?? 00 c6 40 ?? 33 ?? ?? ?? ?? 00 c6 40 ?? 70 ?? ?? ?? ?? 00 c6 40 ?? 70 }
    condition:
        all of them
}

rule CrowdStrike_CSIT_15024_01 : gekko_jackal implant 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "GEKKO JACKAL ELF implant executable"
        reports = "CSIT-15024"
        version = "201807300924"
        last_modified = "2018-07-30"
    strings:
        $ip_check_command = "GETLOCALIP"
        $quit_command = "LOLNOGTFO"
        $scanner_response = "SCANNER ON | OFF"
        $junk_response = "JUNK <ip> <port> <time>"
    condition:
        all of them
}

rule CrowdStrike_CSIT_15023_02 : upatre downloader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Upatre downloader"
        reports = "CSIT-15023"
        version = "201807301101"
        last_modified = "2018-07-30"
        malware_family = "Upatre"
    strings:
        // "Mazilla/*.0"
        $useragent = { 4d 61 7a 69 6c 6c 61 2f 3? 2e 30 }
    condition:
        all of them
}

rule CrowdStrike_CSIT_15023_01 : shkolota packer 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Shkolota Packer, used by Upatre dropper"
        reports = "CSIT-15023"
        version = "201807301055"
        last_modified = "2018-07-30"
    strings:
        $insult = "Nod32 - Shkolota."
    condition:
        // String at fixed offset, 6 sections and EP at 0x3000
        @insult == 0x600 and
        uint16(0x86) == 6 and
        uint32(0xa8) == 0x00003000
}

rule CrowdStrike_CSIT_15039_01 : shadow_crane sharpshooter dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Indicators of installation used by primary SharpShooter dropper executable. Detects obfuscation and routines used"
        reports = "CSIT-15039"
        version = "201805110949"
        last_modified = "2018-05-11"
        actor = "SHADOW CRANE"
        malware_family = "SharpShooter"
    strings:
        $bat_1 = "%s\\MSTIM.bat" ascii
        $bat_2 = "%s\\DF42EFS.bat" ascii
        $ts_target = "%SystemRoot%\\system32\\gdi32.dll" ascii
        $ts_1 = "GetFileTime" ascii
        $ts_2 = "SetFileTime" ascii
    condition:
        all of them
}

rule CrowdStrike_CSIT_15039_02 : shadow_crane sharpshooter widegate dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Indicators of dropper used to install SharpShooter and WideGate malware"
        reports = "CSIT-15039"
        version = "201807271452"
        last_modified = "2018-07-27"
        actor = "SHADOW CRANE"
        malware_family = "SharpShooter, WideGate"
    strings:
        $exec_xor_key = { 37 db a9 ec }
        $exec_event = "8d9269df-0472-4858-9fc2-aa9c48228b3e" ascii
        $startup_frag_1 = "_$PID:" ascii
        $startup_frag_2 = "_$EXE:" ascii
        $startup_frag_3 = "_$CMDLINE:" ascii
        $res_id = { 6a (66 | 67) 6a 00 ff 15 ?? ?? 40 00 }
        $res_type_1 = "IDR_OOO" ascii
        $res_type_2 = "IDR_EXE" ascii
    condition:
        1 of ($exec_*) and 2 of ($startup_frag*) and 2 of ($res*)
}

rule CrowdStrike_CSIT_15025_01 : darkst rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "DarkSt RAT"
        reports = "CSIT-15025"
        version = "201807301107"
        last_modified = "2018-07-30"
        malware_family = "DarkSt"
    strings:
        $mutex = "Dark Is Running!"
        $lnk = "netlink.lnk"
        $setting = "netsetting.ini"
    condition:
        2 of them
}

rule CrowdStrike_CSIT_15039_07 : shadow_crane widegate installer 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Indicators of installation used by WideGate dropper executable"
        reports = "CSIT-15039"
        version = "201807271426"
        last_modified = "2018-07-27"
        actor = "SHADOW CRANE"
        malware_family = "WideGate"
    strings:
        $cfg_load = { 52 (68 | 6a) ( 20 | 40 | 80 ) [0-3] 68 ?? ?? 41 00 68 ?? 22 41 00 68 ?? 22 41 00 68 ?? 22 41 00 ff d6 }
        $bat = "update.bat" ascii
        $bat_cmd_1 = /@echo off\x0D\x0A:try\x0D\x0Amove (\/\w )*\x22%s\x22 \x22%s\x22\x0D\x0Aif exist \x22%s\x22 goto try\x0D\x0A%sdel (\/\w )*\x22%s\x5c%s\x22\x0D\x0A/
        $bat_cmd_2 = "@echo off\x0D\x0A%sdel \x22%s\x5C%s\x22\x0D\x0A"
        $reg = "reg add \"HKLM\\%s\""
        $reg_1 = "ComponentID /d \x22DirectShow\x22\x0D\x0A"
        $reg_2 = "Version /d \x221,125,2406,1\x22\x0D\x0A"
        $reg_3 = "Locale /d \x22*\x22\x0D\x0A"
    condition:
        #cfg_load >= 3 and 2 of ($bat*) and #reg > 3 and 2 of ($reg_*)
}

rule CrowdStrike_CSIT_15033_04 : sunx bootkit 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Sunx bootkit"
        reports = "CSIT-15033"
        version = "201503100000"
        last_modified = "2015-03-10"
        malware_family = "Sunx"
    strings:
        $phydrv = "\\\\.\\PHYSICALDRIVE0"
        $serv1 = "System\\CurrentControlSet\\Services\\"
        $serv2 = "%systemroot%\\system32\\"
        $serv3 = "SchedServiceMain"
        $dexor1 = { 80 38 4d 75 5f 80 78 01 5a 75 59 }
        $dexor2 = { 8b 0d ?? ?? 00 10 80 34 01 76 03 c8 40 8b 0d ?? ?? 00 10 3b 01 72 }
    condition:
        $phydrv and all of ($serv*) and any of ($dexor*)
}

rule CrowdStrike_CSIT_15039_06 : shadow_crane sharpshooter rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects SharpShooter variant in executable form (injector_s.exe)"
        reports = "CSIT-15039"
        version = "201805110949"
        last_modified = "2018-05-11"
        actor = "SHADOW CRANE"
        malware_family = "SharpShooter"
    strings:
        $mutex_frag = { 66 c7 ?? ?? 4d 00 a1 ?? ?? 00 10 66 c7 ?? ?? 55 00 a1 ?? ?? 00 10 66 c7 ?? ?? 54 00 a1 ?? ?? 00 10 66 c7 ?? ?? 45 00 a1 ?? ?? 00 10 66 c7 ?? ?? 58 00  a1 ?? ?? 00 10 66 c7 ?? ?? 30 00 a1 ?? ?? 00 10 66 c7 ?? ?? 30 00 a1 ?? ?? 00 10 66 c7 ?? ?? 37 00 }
        $cmd_sysinfo = { 66 c7 ?? 73 00 66 c7 ?? ?? 79 00 66 c7 ?? ?? 73 00 66 c7 ?? ?? 74 00  66 c7 ?? ?? 65 00 66 c7 ?? ?? 6d 00 66 c7 ?? ?? 69 00 66 c7 ?? ?? 6e 00 66 c7 ?? ?? 66 00 66 c7 ?? ?? 6f 00 }
        $tmp_prefix = { 66 c7 45 f8 43 00 66 c7 45 fa 4d 00 [0-3] 66 c7 45 fc 46 00 }
        $dec = { be 0f 0f 0f 0f 8b f9 23 d6 23 fe 33 d7 bf 33 f3 ff ff 33 ca be 00 00 cc cc c1 e2 04 33 c2 8b d1 23 d7 8b d9 c1 e2 12 23 de 33 d3 8b da c1 eb 12 33 da 8b d0 23 d7 8b f8 c1 e2 12 23 fe 33 cb 33 d7 8b f2 c1 ee 12 33 f2 8b f9 33 c6 be 55 55 55 55 8b d0 23 fe d1 ea 23 d6 33 d7 bf ff 00 ff 00 33 ca 03 d2 33 c2 8b d1 c1 ea 08 8b d8 23 d7 23 df 33 d3 33 c2 c1 e2 08 33 ca 8b d0 d1 ea 8b f9 23 d6 23 fe 33 d7 bf ff ff ff 0f }
    condition:
        2 of them
}

rule CrowdStrike_CSIT_15031_01 : vixen_panda godrat rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "VIXEN PANDA GodRAT"
        reports = "CSIT-15031"
        version = "201807301011"
        last_modified = "2018-07-30"
        actor = "VIXEN PANDA"
        malware_family = "GodRAT"
    strings:
        $alphabet = "A89abcdBCDEFGHIJ27PQRSTUVWtuvwXYZefghijkKL3456MNOlmnopqrsxyz01+/"
        $lock = "C:\\Programdata\\lock" fullword
        $default = "wINsTA0\\dEFAULT" ascii wide
        $yahoo = "YahooID lang=en; ID=%sNextID=%s"
        $get = "GET http://%s/u.cfm?rnd=%s&uid=1"
        $cookie = "Cookie: lang=en; Sflag=%s"
    condition:
        $alphabet or $lock or (2 of them)
}

rule CrowdStrike_CSIR_15001_01 : eloquent_panda eracs rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "eRACS RAT strings"
        reports = "CSIR-15001"
        version = "201503130000"
        last_modified = "2015-03-13"
        actor = "ELOQUENT PANDA"
        malware_family = "eRACS"
    strings:
        $fm = "LURKER_RACS_FM" ascii wide
        $rm = "LURKER_RACS_RM" ascii wide
    condition:
        any of them
}

rule CrowdStrike_CSIR_15001_02 : eloquent_panda eracs rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "eRACS RAT command strings"
        reports = "CSIR-15001"
        version = "201503130000"
        last_modified = "2015-03-13"
        actor = "ELOQUENT PANDA"
        malware_family = "eRACS"
    strings:
        $cp_1 = "CP_OK"
        $cp_2 = "CP_ERR"
        $cp_3 = "CP_FILE_EXIST"
        $df_1 = "DF_OK"
        $df_2 = "DF_ERR"
        $dd_1 = "DD_OK"
        $dd_2 = "DD_ERR"
        $nf_1 = "NF_OK"
        $nf_2 = "NF_ERR"
        $ul_1 = "UL_FILE_OK"
        $ul_2 = "UL_FILE_NOT_EXIST"
        $ul_3 = "UL_FILE_EXIST"
    condition:
        all of them
}

rule CrowdStrike_CSIR_15001_04 : eloquent_panda eracs key 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "eRACS RAT keys"
        reports = "CSIR-15001"
        version = "201503130000"
        last_modified = "2015-03-13"
        actor = "ELOQUENT PANDA"
        malware_family = "eRACS"
    strings:
        $key_1 = "01234567890123456789eric0123456789012345678karen"
        $key_2 = "detected by mse anti-virus software, so modified"
        $key_3 = "0123456789012345601234567893456789012345678karen"
    condition:
        any of them
}

rule CrowdStrike_CSIR_15001_05 : eloquent_panda eracs rat dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "eRACS RAT dropper"
        reports = "CSIR-15001"
        version = "201503130000"
        last_modified = "2015-03-13"
        actor = "ELOQUENT PANDA"
        malware_family = "eRACS"
    strings:
        $verttab_fmt = { 25 73 20 25 64 0B 25 73 00 }
    condition:
        any of them
}

rule CrowdStrike_CSIR_15001_06 : eloquent_panda xorone rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "XorOne RAT strings"
        reports = "CSIR-15001"
        version = "201503130000"
        last_modified = "2015-03-13"
        actor = "ELOQUENT PANDA"
        malware_family = "XorOne"
    strings:
        $adm = "Xor@neisAdmin"
        $bond = "Xor@one007"
        $base = "Xor@one"
    condition:
        any of them
}

rule CrowdStrike_CSIR_15001_07 : eloquent_panda xorone rat dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "XorOne RAT dropper"
        reports = "CSIR-15001"
        version = "201503130000"
        last_modified = "2015-03-13"
        actor = "ELOQUENT PANDA"
        malware_family = "XorOne"
    strings:
        $dllname_const_1 = "xpr132.dll" ascii wide
        $dllname_const_2 = "xpr122.dll" ascii wide
        $dllname_regex = /xpr[0-9]{3}\.dll/
        $dll_frag = "%s\\xpr1" //$servicename = "ntmssvc" ascii wide
    condition:
        any of them
}

rule CrowdStrike_CSIR_15001_08 : eloquent_panda xorone rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "XorOne RAT alphabet"
        reports = "CSIR-15001"
        version = "201503130000"
        last_modified = "2015-03-13"
        actor = "ELOQUENT PANDA"
        malware_family = "XorOne"
    strings:
        $alpha = "SBk0EFGHIJKLMNrPQRATUXWVYZabcdefghijClmnvpqOstuowxyzD128456739#%"
    condition:
        any of them
}

rule CrowdStrike_CSIT_15034_01 : scanbox 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detection for Scanbox Javascript-based reconnaissance tool"
        reports = "CSIT-15034"
        version = "201906182002"
        last_modified = "2019-06-18"
        malware_family = "Scanbox"
    strings:
        $post = "basic.data=scanbox.info;"
        $random = "scanbox.random();"
    condition:
        all of them
}

rule CrowdStrike_CSIT_15044_01 : simbot dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detection for Simbot dropper"
        reports = "CSIT-15044"
        version = "201503200000"
        last_modified = "2015-03-20"
        malware_family = "Simbot"
    strings:
        $pdb = "ShellLoad\\New_Setup\\InstallCve\\Release\\InstallCve.pdb"
        /*
        .text:004012DE 83 F8 1F                              cmp     eax, 1Fh
        .text:004012E1 7C ED                                 jl      short loc_4012D0
        .text:004012E3                       loc_4012E3:
        .text:004012E3 83 F8 1F                              cmp     eax, 1Fh
        .text:004012E6 74 0C                                 jz      short loc_4012F4
        .text:004012E8 41                                    inc     ecx
        .text:004012E9 81 F9 3B EA 00 00                     cmp     ecx, 0EA3Bh
        */
        $config_check = { 83 f8 1f 7c ed 83 f8 1f 74 0c 41 81 f9 3b ea 00 00 }
    condition:
        all of them
}

rule CrowdStrike_CSIT_15044_02 : simbot downloader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detection for Simbot downloader DLL"
        reports = "CSIT-15044"
        version = "201503200000"
        last_modified = "2015-03-20"
        malware_family = "Simbot"
    strings:
        $srv = "SrvThread DownPic" wide
        $self_def = "if exist \"%s\" goto noDesKfile "
        $fail = "LoaderSrvCodeFromReg fail"
    condition:
        any of them
}

rule CrowdStrike_CSIT_15039_09 : shadow_crane blackspire dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Indicators of installation used by BlackSpire dropper"
        reports = "CSIT-15039"
        version = "201807271526"
        last_modified = "2018-07-27"
        actor = "SHADOW CRANE"
        malware_family = "BlackSpire"
    strings:
        $asep = "cmd.exe /c reg add HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Run /v bspire /t REG_SZ /f /d" wide
        $bspire = "BSPIRE" wide
        $bat = { c6 ?? ?? 3a c6 ?? ?? 6c c6 ?? ?? 6f c6 ?? ?? 6f c6 ?? ?? 70 c6 ?? ?? 0d  c6 ?? ?? 0a c6 ?? ?? 44 c6 ?? ?? 45 c6 ?? ?? 4c c6 ?? ?? 20 c6 ?? ?? 25 c6 ?? ?? 31 }
    condition:
        2 of them
}

rule CrowdStrike_CSIT_15033_03 : sunx bootkit 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Sunx bootkit stage 2 code"
        reports = "CSIT-15033"
        version = "201503250000"
        last_modified = "2015-03-25"
        malware_family = "Sunx"
    strings:
        $ = /\xEB\x2E\xAA\x55.{506}\x55\xAA/
        $ = /\x9D\x58\xDC\x23.{506}\x23\xDC/
    condition:
        any of them
}

rule CrowdStrike_CSIT_15033_05 : sunx bootkit 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Sunx bootkit raw disk I/O driver"
        reports = "CSIT-15033"
        version = "201503250000"
        last_modified = "2015-03-25"
        malware_family = "Sunx"
    strings:
        $ = "KdDisableDebugger" wide
        $ = "\\Driver\\volmgr" wide
        $ = "\\Driver\\Disk" wide
        $ = "\\Device\\Harddisk%d\\Partition%d" wide
        $ = "ntoskrnl.exe"
        $ = "DiskIo"
        $ = ".sys"
    condition:
        all of them
}

rule CrowdStrike_CSIT_15036_01 : necurs rootkit 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Necurs rootkit"
        reports = "CSIT-15036"
        version = "201809251137"
        last_modified = "2018-09-25"
        malware_family = "Necurs"
    strings:
        // device path
        $devpath = "\\??\\NtSecureSys" wide
        // Registry value names
        $regval1 = "Boot Bus Extender" wide
        $regval2 = "Group" wide
        $regval3 = "ImagePath" wide
        $regval4 = "ErrorControl" wide
        $regval5 = "DisplayName" wide
        // IOCTL codes
        $cmpioctl1 = { 81 f? 00 00 22 00 }
        $cmpioctl2 = { 81 f? 04 00 22 00 }
        $cmpioctl3 = { 81 f? 08 00 22 00 }
        $cmpioctl4 = { 81 f? 0C 00 22 00 }
        $cmpioctl5 = { 81 f? 10 00 22 00 }
        $cmpioctl6 = { 81 f? 14 00 22 00 }
        $cmpioctl7 = { 81 f? 18 00 22 00 }
        $cmpioctl8 = { 81 f? 20 00 22 00 }
        // Process ID decoding
        $xorpid = { 35 de c0 ad de 39 ?? 04 0f 85 }
        // Master key MD5 hash check
        $hashcmp = { 81 7d e4 ef 10 7e 37 0f [3] 00 00 81 7d e8 3d ef 25 f1 0f [3] 00 00 81 7d ec d2 ef dc 68 0f [3] 00 00 81 7d f0 af ac ba 0e 0f [3] 00 00 }
    condition:
        all of them
}

rule CrowdStrike_CSIT_15043_01 : eoehttp delivery_document 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "EOEHTTP RAT Exploit Document"
        reports = "CSIT-15043"
        version = "201503310000"
        last_modified = "2015-03-31"
        malware_family = "EOEHTTP"
    strings:
        // Characteristic MIME boundary tag in malicious Single File Web Page Document
        $ = "_NextPart_01CF55B9.ED0B5F90"
        // Start of embedded base64-encoded CDFv2 document
        $ = "0M8R4KGxGuEAAAAAAAAAAAAAAAAAAAAAPgADAP7"
    condition:
        all of them
}

rule CrowdStrike_CSIT_15039_08 : shadow_crane widegate rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "WideGate: malware with C2 over pseudo-DNS and interactive shell capabilities"
        reports = "CSIT-15039"
        version = "201807271427"
        last_modified = "2018-07-27"
        actor = "SHADOW CRANE"
        malware_family = "WideGate"
    strings:
        $orig_name = /drmanidd(32|64).dll/ ascii
        $mutex = /[0-9a-f]{4}3731\-[0-9a-f]{4}\-[0-9a-f]{4}\-ca88\-173bc36[0-9a-f]{5}/
        $guid_1 = { 69 24 74 27 26 27 21 21 73 3f 22 70 77 25 3f 26 77 76 20 3f 2a 21 25 2b 3f 70 25 21 27 27 21 74 24 74 70 ?? ?? 6f }
        $guid_2 = { 69 70 25 21 22 25 20 23 2b 3f 2b 71 27 2a 3f 26 23 76 27 3f 73 23 22 74 3f 77 74 24 24 76 71 77 70 2b 23 ?? ?? 6f }
        $error = "MapVieOfFile error: %d" ascii
        $wins = "Have Wins:" ascii
        $stub = "StubPath" ascii
        $comspec = "ComSpec" ascii
        $exec = "\"%s\" /c %s > %s 2>&1" ascii
        $cmd1 = "_dir" ascii
        $cmd2 = "_get" ascii
        $cmd3 = "_got" ascii
        $cmd4 = "_put" ascii
        $cmd5 = "_exe" ascii
        $cmd6 = "_quit" ascii
        $cmd7 = "_prc" ascii
        $cmd8 = "_del" ascii
        $cmd9 = "_dll" ascii
        $cmd10 = "_dlu" ascii
        $cmd11 = "_cap" ascii
        $cmd12 = "_inf" ascii
        $cmd13 = "_cmd" ascii
    condition:
        3 of ($orig_name, $mutex, $guid*, $error, $wins, $stub, $comspec, $exec) and 5 of ($cmd*)
}

rule CrowdStrike_CSIT_15043_02 : eoehttp rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "EOEHTTP RAT strings"
        reports = "CSIT-15043"
        version = "201504010000"
        last_modified = "2015-04-01"
        malware_family = "EOEHTTP"
    strings:
        $dllname = "Eoehttp.dll" fullword
        $pdb = "\\Eoehttp\\"
        $hash_1 = "D514116929C24f35"
        $hash_2 = "AE047F2B82C59B08"
        $cmd_1 = "RUNFILE"
        $cmd_2 = "SEARCHFILE"
        $cmd_3 = "LISTDIR"
        $cmd_4 = "GETDRIVERS"
        $cmd_5 = "OPTION"
        $cmd_6 = "HTTPUPLOAD"
        $cmd_7 = "DOWNLOADFILE"
        $tag_1 = "<!--?*$@" $tag_2      = "@$*?--!>"
        $class_1 = "HttpHandlerRequest"
        $class_2 = "HttpRequestManager"
        $class_3 = "HttpFileHandler"
        $gn = "_gnotifywindowclass"
    condition:
        ($dllname or $pdb) or
        (
        (any of ($hash_*)) or
        (4 of ($cmd_*)) or
        (all of ($tag_*)) or
        ( 2 of ($class_*) and $gn)
        )
}

rule CrowdStrike_CSIT_15046_01 : kernelbot bot 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "KernelBot executable"
        reports = "CSIT-15046"
        version = "201504080000"
        last_modified = "2015-04-08"
        malware_family = "KernelBot"
    strings:
        $conf_01 = "DDOS_HostStatistics" wide
        $conf_02 = "DDOS_ScriptFlood" wide
        $conf_03 = "ScriptFloodUrl" wide
        $conf_04 = "ScriptFloodDNS" wide
        $conf_05 = "ScriptFloodPort" wide
        $conf_06 = "DDOS_ScriptFlood_A1" wide
        $conf_07 = "DDOS_TcpFlood_A1" wide
        $conf_08 = "DDOS_UdpFlood_A1" wide
        $conf_09 = "DownFileRunUrl0" wide
        $conf_10 = "IsDownFileRun0" wide
        $str_01 = "NoComputerNameName" wide
        $net_01 = "?type=insert&key=" wide
    condition:
        3 of them
}

rule CrowdStrike_CSIT_15046_02 : kernelbot loader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "KernelBot loader DLL"
        reports = "CSIT-15046"
        version = "201504080000"
        last_modified = "2015-04-08"
        malware_family = "KernelBot"
    strings:
        $file_dec1 = { c6 44 24 ?? ?? 40 30 }
        $printf_01 = { 51 68 ?? ?? 00 10 }
        $read_file_calls = { 89 7c 24 2c ff 15 1c ?? 00 10 6a 02 6a 00 6a ff 53 ff 15 08 ?? 00 10 6a 00 8d ?? 24 ?? ?? 6a 01 }
    condition:
        all of them
}

rule CrowdStrike_CSIT_15046_03 : certificate 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Code signing certificate used with KernelBot. As this certificate was stolen for use in signing malicious executables, it may also identified legitimate files - alerts should be correlated with other indicators of malicious activity."
        reports = "CSIT-15046"
        version = "201910101657"
        last_modified = "2019-10-10"
    strings:
        $cn = "CallTogether, Inc."
        $serial = { 45 21 56 c3 b3 fb 01 76 36 5b db 5b 77 15 bc 4c }
    condition:
        uint16(0) == 0x5a4d and
        $cn and $serial
}

rule CrowdStrike_CSIT_15041_01 : stegodropper downloader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Steganographic PNG Payload downloader"
        reports = "CSIT-15041"
        version = "201504130000"
        last_modified = "2015-04-13"
        malware_family = "StegoDropper"
    strings:
        $ntdll = { c6 45 ec 6e c6 45 ed 74 c6 45 ee 64 c6 45 ef 6c c6 45 f0 6c c6 45 f1 2e c6 45 f2 64 c6 45 f3 6c c6 45 f4 6c c6 45 f5 00 }
        $debug1 = "watch2_err_1"
        $debug2 = "payload_type_exe_wait_del"
        $debug3 = "mark_not_setted"
        $debug4 = "payload_mem_not_ok"
    condition:
        $ntdll or 2 of ($debug*)
}

rule CrowdStrike_CSIR_13012_02 : pirate_panda mozirat rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Strings found in MoziRAT malware"
        reports = "CSIT-13033,CSIT-13037,CSIR-13012"
        version = "201504200000"
        last_modified = "2015-04-20"
        actor = "PIRATE PANDA"
        malware_family = "MoziRAT"
    strings:
        $not_config = "Not Configed, Exiting..."
        $ua = "MSIE(%s); NT(%d.%d.%d); AV(%d); OV(%s); NA(%s) VR(%s)"
    condition:
        any of them
}

rule CrowdStrike_CSIT_15039_10 : shadow_crane blackspire rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Indicators for BlackSpire malware"
        reports = "CSIT-15039"
        version = "201807271526"
        last_modified = "2018-07-27"
        actor = "SHADOW CRANE"
        malware_family = "BlackSpire"
    strings:
        $bspire = "BSPIRE" ascii wide
        $ts_fmt1 = "[%04d.%02d.%02d. %02dh%02dm%02ds%03d]" ascii
        $ts_fmt2 = "[%04d-%02d-%02d %02dh%02dm%02ds%03d]" ascii
        $hello = "Hello, world!!" wide
        $mutex = { c6 ?? ?? 3a c6 ?? ?? 6c c6 ?? ?? 6f c6 ?? ?? 6f c6 ?? ?? 70 c6 ?? ?? 0d  c6 ?? ?? 0a c6 ?? ?? 44 c6 ?? ?? 45 c6 ?? ?? 4c c6 ?? ?? 20 c6 ?? ?? 25 c6 ?? ?? 31 }
    condition:
        2 of them
}

rule CrowdStrike_CSIT_15049_01 : shadow_crane sharpshooter widegate dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Encrypted section found as part of the file infector used to distribute SharpShooter/WideGate malware"
        reports = "CSIT-15049"
        version = "201805110948"
        last_modified = "2018-05-11"
        actor = "SHADOW CRANE"
        malware_family = "SharpShooter, WideGate"
    strings:
        $zeroxor = { 87 64 2b 69 6e 84 cb a4 ac 4a 08 8e ed 0a ad 8f 87 64 2b 69 6e 84 cb a4 ac 4a 08 8e ed 0a ad 8f }
    condition:
        $zeroxor
}

rule CrowdStrike_CSIT_15049_02 : shadow_crane sharpshooter widegate dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "File infector module dropper used to distribute SharpShooter/WideGate malware"
        reports = "CSIT-15049"
        version = "201805110947"
        last_modified = "2018-05-11"
        actor = "SHADOW CRANE"
        malware_family = "SharpShooter, WideGate"
    strings:
        $rclsid = { b1 6d c5 d4 c5 91 38 42 88 8b a1 76 7a 9e d3 9a }
        $riid = { 28 d5 86 1e ec 90 93 49 a6 40 5c 92 62 a3 f5 42 }
        $install = "/i %d"
        $uninstall = "/u %d"
    condition:
        all of them
}

rule CrowdStrike_CSIT_15049_03 : shadow_crane sharpshooter widegate dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Archive module included in file infector toolset used to distribute SharpShooter and WideGate malware"
        reports = "CSIT-15049"
        version = "201805110946"
        last_modified = "2018-05-11"
        actor = "SHADOW CRANE"
        malware_family = "SharpShooter, WideGate"
    strings:
        $rclsid = { c2 3c 45 6a 8a 42 26 4f 99 91 26 98 a1 ed e4 f8 }
        $riid = { 02 a6 5d 6b be ce 20 40 a7 94 8d 27 27 c0 8d 61 }
        $aes = "pkAES-256"
        $bzip = "BZip2"
        $deflate = "Deflate64"
    condition:
        all of them
}

rule CrowdStrike_CSIT_15049_04 : shadow_crane widegate plugin 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Disk scanning module included in file infector toolset used to distribute SharpShooter and WideGate malware"
        reports = "CSIT-15049"
        version = "201805110946"
        last_modified = "2018-05-11"
        actor = "SHADOW CRANE"
        malware_family = "WideGate"
    strings:
        $rclsid = { f8 be cf 48 c7 97 24 46 a6 bb 89 9b 5b 28 91 ea }
        $riid = { 01 9c c6 94 16 90 13 49 83 50 4b 40 46 26 55 1c }
        $files = "ProgramFiles" wide
        $data = "ProgramData" wide
    condition:
        all of them
}

rule CrowdStrike_CSIT_15049_05 : shadow_crane widegate dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "File infector module included in file infector toolset used to distribute WideGate malware"
        reports = "CSIT-15049"
        version = "201805110945"
        last_modified = "2018-05-11"
        actor = "SHADOW CRANE"
        malware_family = "WideGate"
    strings:
        $rclsid = { 84 7f e0 e4 66 3e 5d 44 83 96 78 39 a4 4c 40 77 }
        $riid = { 98 65 a5 be 75 b0 5d 43 88 53 10 0d 1d b6 de 4b }
        $fileinfo = "StringFileInfo\\%04x%04x\\%s" wide
        $name = "CompanyName" wide
    condition:
        all of them
}

rule CrowdStrike_CSIT_15049_06 : shadow_crane widegate plugin 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "USB scanning module included in file infector toolset used to distribute WideGate malware"
        reports = "CSIT-15049"
        version = "201805110944"
        last_modified = "2018-05-11"
        actor = "SHADOW CRANE"
        malware_family = "WideGate"
    strings:
        $rclsid = { c8 19 f6 0f 88 2c ea 44 9d cb a3 12 63 44 3f 90 }
        $riid = { 1c ee a1 f0 36 a3 ce 43 89 a0 81 58 8a aa 6f a2 }
        $drive = "%c:\\" wide
    condition:
        all of them
}

rule CrowdStrike_CSIT_15049_08 : shadow_crane widegate plugin 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Capability module included in file infector toolset used to distribute WideGate malware"
        reports = "CSIT-15049"
        version = "201805110943"
        last_modified = "2018-05-11"
        actor = "SHADOW CRANE"
        malware_family = "WideGate"
    strings:
        $zeroxor = { 87 64 2b 69 6e 84 cb a4 ac 4a 08 8e ed 0a ad 8f 87 64 2b 69 6e 84 cb a4 ac 4a 08 8e ed 0a ad 8f }
        $magic = { 01 91 48 48 }
    condition:
        $zeroxor and $magic in ((filesize-24)..filesize)
}

rule CrowdStrike_CSIT_15049_07 : plugin shadow_crane widegate 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "DLL suspender capability module included in file infector toolset used to distribute WideGate malware"
        reports = "CSIT-15049"
        version = "201905200802"
        last_modified = "2019-05-20"
        actor = "SHADOW CRANE"
        malware_family = "WideGate"
    strings:
        $rclsid = { b1 6d c5 d4 c5 91 38 42 88 8b a1 76 7a 9e d3 9a }
        $riid = { 28 d5 86 1e ec 90 93 49 a6 40 5c 92 62 a3 f5 42 }
        $bat = "%s%s%s%d.bat" wide
    condition:
        all of them
}

rule CrowdStrike_CSIT_14025_03 : post_exploitation 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Post-exploitation tool used to execute commands on remote systems via Windows RPC interface"
        reports = "CSIT-14025"
        version = "201812191005"
        last_modified = "2018-12-19"
    strings:
        $script_name = "wmiexec.vbs"
        $error_message = "WMIEXEC ERROR"
        $usage_string = "running command background and persistent"
    condition:
        filesize < 15KB and
        (
        #script_name > 2 or
        #error_message > 3 or
        $usage_string
        )
}

rule CrowdStrike_CSIT_16112_01 : cozy_bear agent_adb rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "DLL exports used by Agent-ADB"
        reports = "CSIT-16112"
        version = "201505080000"
        last_modified = "2015-05-08"
        actor = "COZY BEAR"
        malware_family = "Agent-ADB, OnionDuke"
    strings:
        $ = "ADB_Add"
        $ = "ADB_Cleanup"
        $ = "ADB_Init"
        $ = "ADB_Load"
        $ = "ADB_Release"
        $ = "ADB_Remove"
        $ = "ADB_Setup"
    condition:
        3 of them
}

rule CrowdStrike_CSIT_15056_01 : downrage fancy_bear key xagent 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "FANCY BEAR RC4 base key used in X-Agent and DownRage malware"
        reports = "CSIT-15056"
        version = "202012141610"
        last_modified = "2020-12-14"
        actor = "FANCY BEAR"
        malware_family = "X-Agent, DownRage"
    strings:
        $key = { 3b c6 73 0f 8b 07 85 c0 74 02 ff d0 83 c7 04 3b
        fe 72 f1 5f 5e c3 8b ff 56 b8 d8 78 75 07 50 e8
        b1 d1 ff ff 59 5d c3 8b ff 55 8b ec 83 ec 10 a1
        33 35 }
    condition:
        $key
}

rule CrowdStrike_CSIT_13082_07 : chopper webshell 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Rule to alert on a Chopper webshell DLL present on a victim or GUI executable used by the adversary"
        reports = "CSIT-13082"
        version = "201505140000"
        last_modified = "2015-05-14"
        malware_family = "Chopper"
    strings:
        $c2_z1 = "Z1" wide
        $c2_z2 = "Z2" wide
        $c2_open_delim = "|<-" wide
        $c2_close_delim = "->|" wide
        $c2_exec_success = "Execute Successfully!" wide
        $c2_error = "ERROR://" wide
        $pdb = "c:\\inetpub\\wwwroot\\Chopper\\Chopper\\obj\\Debug\\Chopper.pdb"
    condition:
        (4 of ($c2_*)) or $pdb
}

rule CrowdStrike_CSIT_15051_01 : rombertik dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Rombertik dropper"
        reports = "CSIT-15051"
        version = "201807300927"
        last_modified = "2018-07-30"
        malware_family = "Rombertik"
    strings:
        $rc4Key = { 9b f3 62 e8 4c eb 9b 17 6e b3 f6 2d f4 05 91 df 92 54 6a 47 c5 bb 7c 7e 13 33 2b 6d 94 08 e2 e0 }
        $ = "malwar"
        $ = "file."
        $ = "sandb"
        $ = "viru"
        $ = "sampl"
        // Sandbox error code check
        $ = "ZwGetWriteWatch"
        $ = { 3d 05 00 00 c0 }
    condition:
        all of them
}

rule CrowdStrike_CSIT_15051_02 : rombertik credential_theft 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Rombertik credential theft tool"
        reports = "CSIT-15051"
        version = "201505150000"
        last_modified = "2015-05-15"
        malware_family = "Rombertik"
    strings:
        $referer = "runscope/0.1"
        $mbrString = "Carbon crack attempt, failed"
        // Base64 encoded processes
        // explorer.exe
        $ = "ZXhwbG9yZXIuZXhl"
        // iexplore.exe
        $ = "aWV4cGxvcmUuZXhl"
    condition:
        all of them
}

rule CrowdStrike_CSIT_15071_01 : bisonal rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Bisonal version 2 RAT variant "
        reports = "CSIT-15071"
        version = "201505150000"
        last_modified = "2015-05-15"
        malware_family = "Bisonal"
    strings:
        $beacon1 = "post to control"
        $beacon2 = "command=Y29udGludWU="
        $ip_check = "ip.dnsexit.com"
        $ua = "User-Agent:My_Agenter"
        $debug = "Download File and Executed"
    condition:
        ($beacon1 and $ip_check and $ua) or ($beacon2 and $debug)
}

rule CrowdStrike_CSIT_13091_04 : deep_panda derusbi rootkit 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "DEEP PANDA Derusbi rootkit"
        reports = "CSIT-13091"
        version = "201505180000"
        last_modified = "2015-05-18"
        actor = "DEEP PANDA"
        malware_family = "Derusbi"
    strings:
        $driver_guid = "{E190BC79-02DC-0166-4CF1-BD8F8CB2FF21}" wide
        $pool_tag_code1 = {68 74 65 6E 74 6A} //push 'tnet'
        $pool_tag_code2 = {68 52 54 44 4B 6A} //push 'KDTR'
        $pool_tag_code3 = {68 74 63 6C 6B 6A} //push 'klct'
        $pool_tag_code4 = {68 6B 64 74 6E 6A} //push 'ntdk'
        $pool_tag_code5 = {68 74 73 6C 6D 6A} //push 'mlst'
    condition:
        $driver_guid or 2 of ($pool*)
}

rule CrowdStrike_CSIT_15053_01 : mocelpa rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Mocelpa RAT"
        reports = "CSIT-15053"
        version = "201807301130"
        last_modified = "2018-07-30"
        malware_family = "Mocelpa"
    strings:
        // Hard-coded messages
        $msg1 = { 16 03 01 00 6b 01 00 00 67 03 01 54 b4 c9 7b 4f cf bc 5a 01 ec 4a 73 c8 6d bb c0 86 9f 7b a9 08 6a 60 37 05 81 97 1a c8 9f 45 e5 00 00 18 00 2f 00 35 00 05 00 0a c0 13 c0 14 c0 09 c0 0a 00 32 00 38 00 13 00 04 01 00 00 26 00 00 00 12 00 10 00 00 0d 77 77 77 2e 61 70 70 6c 65 2e 63 6f 6d 00 0a 00 06 00 04 00 17 00 18 00 0b 00 02 01 00 }
        $msg2 = { 16 03 01 01 06 10 00 01 02 01 00 08 0d 48 17 27 2e 44 b1 82 12 5f c0 9b c7 fd 75 9c 39 75 f6 47 08 35 88 b9 3c 45 64 2b 75 86 4e 60 ea 53 ca fc bf 9f 99 f8 1c 10 c6 a1 08 a7 35 87 c0 36 5f c9 df 9a ab 4e 8b 0f 3e 98 16 39 80 58 2e 74 a4 c4 d2 40 2d 1d c8 0f 8f 52 dc 2d d4 66 06 83 20 d8 5f 04 e0 aa 28 6d 74 2b 89 2d 51 a2 4e 7b f7 51 15 9d 26 08 7a 17 bc 60 89 ed 8f c3 f9 f7 ec 22 e0 ef f3 25 70 3d f9 a2 77 5e 9d f4 8f 04 99 e8 23 2e a7 a4 c9 79 ff f0 84 7a 85 8b 1a 9c 1a dd e1 cb 2c 43 2e 83 f9 bd a2 15 45 34 bc 90 bb 57 80 1e ec 07 b4 13 fe a2 5a 2f b7 7f 5e 4c b0 9d 69 b4 5d 5c 32 2b 01 e3 33 df 7b ac b7 0c f6 28 03 36 c0 01 bd 89 cd 76 f0 9c b4 ad a2 f9 44 99 be de a3 3a 2f 0e 5d 81 e0 97 e7 e9 a6 be 20 c2 4b 98 1f cd 1f 8b 7e 90 9d 7d 1d 5a be 68 01 5c 7b 4a b9 ab ab fe 5f fc 8e 79 ed 14 03 01 00 01 01 16 03 01 00 30 63 79 b9 a2 37 87 b6 a0 5a e4 39 ff be b2 de 20 97 df da 24 91 1d a8 2c 8f ae 30 4c 8b ca 81 54 64 a4 33 ce 58 f2 76 41 14 d7 19 93 a9 7d 92 89 }
        $msg3 = { 17 03 01 00 c0 6e f7 08 5e 4b ef 68 c2 70 f9 11 4e 90 01 3d 72 9c 1e ba 92 83 af 73 79 33 0b 61 f7 5d 5f ad 8f 94 bb 74 4f 3c 7d ca 43 c0 cb 2d c7 eb bf 3f e2 35 6d 4a a1 f0 c1 1a 74 33 41 66 26 73 b5 f4 51 d0 60 04 a1 6d 6f b3 6d 1e a7 f8 cf 60 d3 55 52 1b 1a 40 57 28 16 cd ae f7 93 25 49 4c d0 88 a3 1d 45 c8 83 4d f5 08 23 b7 2b e0 5c 39 4f 27 9c e7 34 f8 d0 19 95 90 fc c8 2f f8 05 76 c8 22 51 ed b4 60 50 89 98 ba d7 d9 b4 dd 46 dd 9d 24 ad bd fd d1 10 f3 8d 3e 60 3a e0 d2 7a e9 a3 8d 90 f9 ef fa 94 93 99 28 ba 04 64 2f 70 fe 83 18 cb ab 4a c6 45 53 ed 25 57 3c aa 05 7e 4f 08 7e 6a }
    condition:
        all of them
}

rule CrowdStrike_CSIT_15053_02 : mocelpa rat artifact 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Mocelpa RAT logfile"
        reports = "CSIT-15053"
        version = "201505220000"
        last_modified = "2015-05-22"
        malware_family = "Mocelpa"
    strings:
        // Characteristic log messages
        $ = { 32 30 3? 3? 2d 3? 3? 2d 3? 3? 20 3? 3? 3a 3? 3? 3a 3? 3? 20 53 6c 65 65 70 20 33 30 30 20 73 65 63 6f 6e 64 73 2e }
        $ = { 32 30 3? 3? 2d 3? 3? 2d 3? 3? 20 3? 3? 3a 3? 3? 3a 3? 3? 20 53 6c 65 65 70 20 33 36 30 30 20 73 65 63 6f 6e 64 73 2e }
        $ = " Get Default IE Proxy Server succ"
        $ = " Connect to Proxy Server failed"
        $ = " The Default IE Proxy Server unsetted,no using..."
        $ = " send client hello succ."
        $ = " Waiting for serverhello certificate serverhellodone ..."
    condition:
        any of them
}

rule CrowdStrike_CSIT_16006_02 : minion_rat rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Minion RAT DLL main payload"
        reports = "CSIT-16006"
        version = "201505220000"
        last_modified = "2015-05-22"
        malware_family = "Minion RAT"
    strings:
        $ = "\\\\.\\{B95BC6A1-1589-4571-B439-D51789BD3B60}" wide
        $ = "ServiceDll" wide
        $ = "start2work" wide
        $ = "input type=\"%s\" name=\"%s\" value="
        $ = "SeLoadDriverPrivilege" wide
        $ = "SeDebugPrivilege" wide
        // IOCTLs for user/kernel communication
        $ = { 0c 20 22 00 }
        $ = { 08 20 22 00 }
        $ = { 14 20 22 00 }
        $ = { 18 20 22 00 }
    condition:
        8 of them
}

rule CrowdStrike_CSIT_15060_01 : irat dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Dropper used by DYNAMITE PANDA fork of iRAT"
        reports = "CSIT-15060"
        version = "201505270000"
        last_modified = "2015-05-27"
        actor = "DYNAMITE PANDA"
        malware_family = "iRAT"
    strings:
        $obfuscated_api_0 = { 57 69 6e 00 45 78 65 63 00 }
        $obfuscated_api_1 = { 47 65 74 4d 00 [0-3] 6f 64 75 6c 65 00 [0-3] 46 69 6c 65 4e 61 00 [0-3] 6d 65 41 00 }
        $sleep_routine = { 83 fe 36 7e ?? 83 ee 37 eb }
    condition:
        2 of them
}

rule CrowdStrike_CSIT_15060_02 : irat rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "DYNAMITE PANDA fork of iRAT Remote Access Tool"
        reports = "CSIT-15060"
        version = "201505270000"
        last_modified = "2015-05-27"
        actor = "DYNAMITE PANDA"
        malware_family = "iRAT"
    strings:
        $mov_header = { c7 ?? ?? 88 88 08 00 }
        $remark = "WinX"
        $readcfg = "readcfg"
        $telnet_msg = ">>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>"
        $cmd = "killme"
    condition:
        all of them
}

rule CrowdStrike_CSIT_15058_01 : deadeye_jackal seanux webshell 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "DEADEYE JACKAL SEANux webshell"
        reports = "CSIT-15058"
        version = "201505300000"
        last_modified = "2015-05-30"
        actor = "DEADEYE JACKAL"
        malware_family = "SEANux"
    strings:
        $logo = "http://sea.sy/style/css/images/sea_en.png"
        $banner = "center>SyRiAn Electronic Army"
        $title = "<title>SyRiAn Electronic Army Shell :: SEA Shell</title>"
    condition:
        all of them
}

rule CrowdStrike_CSIT_15058_02 : deadeye_jackal seanux webshell 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "DEADEYE JACKAL SEANux webshell"
        reports = "CSIT-15058"
        version = "201505300000"
        last_modified = "2015-05-30"
        actor = "DEADEYE JACKAL"
        malware_family = "SEANux"
    strings:
        $logo = "http://sea.sy/style/css/images/sea_en.png"
        $css1 = ".hacking{"
        $css2 = "color:\".$sh3llColor.\";"
    condition:
        all of them
}

rule CrowdStrike_CSIT_15061_01 : bisonal rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Bisonal RAT"
        reports = "CSIT-15061"
        version = "201506020000"
        last_modified = "2015-06-02"
        malware_family = "Bisonal"
    strings:
        $info = "flag:%s host:%s IP:%s OS:%sSP%d vm:%s proxy:%s"
        $time = "%sDay%sHour%sMin" wide
    condition:
        all of them
}

rule CrowdStrike_CSIT_15062_01 : lecna rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Lecna RAT strings"
        reports = "CSIT-15062"
        version = "202004092131"
        last_modified = "2020-04-09"
        malware_family = "Lecna"
    strings:
        $useragent = "User-Agent: SJZJ (compatible; MSIE 6.0; Win32)"
        $ = "!! Use Splice Socket !!"
        $ = "!! Use Connect Method !!"
        $ = "!!Connect Directly!!"
    condition:
        $useragent or 2 of them
}

rule CrowdStrike_CSIT_15062_02 : lecna rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Lecna RAT obfuscation routines"
        reports = "CSIT-15062"
        version = "202004092131"
        last_modified = "2020-04-09"
        malware_family = "Lecna"
    strings:
        $obf1 = { 2a C2 34 ?? 8a d8 c0 eb ?? c0 e0 ?? 0a d8 }
        $obf2 = { 80 ca ff 03 c1 2a d1 00 10 41 }
        $obf3 = { 8a 10 80 f2 ?? 80 ea ?? 41 }
    condition:
        1 of them
}

rule CrowdStrike_CSIT_15055_01 : darkcomet rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "DarkComet RAT"
        reports = "CSIT-15055"
        version = "202103092127"
        last_modified = "2021-03-09"
        malware_family = "DarkComet"
    strings:
        $compute_890 = { bb 8f ff ff ff 81 c3 e8 03 00 00 b8 04 00 00 00 43 48 75 fc }
    condition:
        $compute_890
}

rule CrowdStrike_CSIT_15055_02 : commodity darkcomet rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Mutex used by DarkComet RAT"
        reports = "CSIT-15055"
        version = "201904251014"
        last_modified = "2019-04-25"
        malware_family = "DarkComet"
    strings:
        $mutex = /DC_MUTEX-\w{7}/
    condition:
        $mutex
}

rule CrowdStrike_CSIT_15090_01 : ffrat rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "FF-RAT Remote Access Tool"
        reports = "CSIT-15090"
        version = "201807300930"
        last_modified = "2018-07-30"
        malware_family = "FF-RAT"
    strings:
        $ = "cmd.exe /c ping 127.0.0.1 -n 5&del"
        $ = "%08X-%04X-%04x-%02X%02X-%02X%02X%02X%02X%02X%02X"
    condition:
        all of them
}

rule CrowdStrike_CSIT_15091_01 : treasurehunter pos_scraper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "TreasureHunter PoS malware"
        reports = "CSIT-15091"
        version = "201807300931"
        last_modified = "2018-07-30"
        malware_family = "TreasureHunter"
    strings:
        $ = "Error - Treasure Hunter is already running on this computer"
        $ = "CLINGFISH_MODE_PLACEHOLDER"
    condition:
        any of them
}

rule CrowdStrike_CSIR_15002_09 : hurricane_panda hikit rat dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "HIKIT RAT dropper"
        reports = "CSIR-15002"
        version = "201506150000"
        last_modified = "2015-06-15"
        actor = "HURRICANE PANDA"
        malware_family = "HIKIT"
    strings:
        $encr_payload = {1b a2 30 01 14 ef 6a 91 1b a1 30 01 1b 5d}
        $crypt_loop = {31 ?? 83 c6 04 83 e8 01 75 f6 85}
    condition:
        any of them
}

rule CrowdStrike_CSIT_15064_01 : newct dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects a dropper used to install NewCT malware"
        reports = "CSIT-15064"
        version = "201506160000"
        last_modified = "2015-06-16"
        actor = "SAMURAI PANDA"
        malware = "NewCT"
    strings:
        $drop = "DROP_OVER"
        $load = "%s /load /IM %s"
        $settings = "Settings.DAT"
    condition:
        2 of them
}

rule CrowdStrike_CSIT_15067_01 : nanocore rat unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "NanoCore RAT rule intended to be used against live memory or memory dumps."
        reports = "CSIT-15067"
        version = "201904170755"
        last_modified = "2019-04-17"
        malware_family = "Nanocore"
    strings:
        $name = "NanoCore Client"
        $mod = "<Module>"
        $plug = "ClientPlugin"
    condition:
        all of them
}

rule CrowdStrike_CSIT_15066_01 : acehash credential_dumper post_exploitation 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "AceHash credential dumping tool"
        reports = "CSIT-15066"
        version = "201506260000"
        last_modified = "2015-06-26"
        malware_family = "AceHash"
    strings:
        $ = "  Logon Sessions Found: %d"
        $ = "  Reading by injecting code! (less-safe mode)"
        $ = "ERROR: CreateProcessWithLogonW, GetLastError = %d"
        $ = "Dbg Inf: "
    condition:
        all of them
}

rule CrowdStrike_CSIT_15066_02 : acehash credential_dumper post_exploitation 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Windows Credential Editor auxiliary DLL used by AceHash credential dumping tool"
        reports = "CSIT-15066"
        version = "201506260000"
        last_modified = "2015-06-26"
        malware_family = "AceHash"
    strings:
        $ = "WceAddNTLMCredentials_one"
        $ = "g_pfunc_NlpDeletePrimaryCredential"
        $ = "WceGetNTLMCredentials_one IsResOfCallOk"
    condition:
        all of them
}

rule CrowdStrike_CSIT_15066_03 : acehash credential_dumper post_exploitation 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "PWDumpX auxiliary DLL used by AceHash credential dumping tool"
        reports = "CSIT-15066"
        version = "201807201343"
        last_modified = "2018-07-20"
        malware_family = "PWDumpX,AceHash"
    strings:
        $ = " %02X %02X %02X %02X %02X %02X %02X %02X %02X %02X %02X %02X %02X %02X %02X %02X  %c%c%c%c%c%c%c%c%c%c%c%c%c%c%c%c"
        $ = "NO PASSWORD*********************"
        $ = "ERROR! Cannot open SAM on remote host."
        $ = "ERROR! Cannot connect to SAM on remote host."
        $ = "ERROR! Cannot query LSA information policy on remote host."
        $ = "ERROR! Cannot open LSA policy on remote host."
        $ = "ERROR! Cannot load SAM functions on remote host."
        $ = "%s_hist_%d:%d:%s:%s:::"
    condition:
        2 of them
}

rule CrowdStrike_CSIT_15074_01 : gothic_panda mimikatz credential_dumper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "MimiKatz credential dumping tool with Pirpi-like string obfuscation"
        reports = "CSIT-15074"
        version = "201506270000"
        last_modified = "2015-06-27"
        actor = "GOTHIC PANDA"
        malware_family = "MimiKatz"
    strings:
        // x64 xor loop used for Pirpi-style string decryption
        $xorloop = { 41 8a 04 10 32 42 ff 32 02 41 88 04 12 48 ff ca 49 ff cb 75 eb }
        // Characteristic Mimikatz strings
        $ = "ChainingModeCBC" wide
        $ = "UndefinedLogonType" wide
        $ = "Unknown !" wide
    condition:
        all of them
}

rule CrowdStrike_CSIT_15076_03 : angler exploit payload 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "XTEA-encrypted Angler Exploit Kit payload"
        reports = "CSIT-15076"
        version = "201506290000"
        last_modified = "2015-06-29"
    strings:
        $ = { 3c 7b 9d 8b 2a 9a c0 62 97 7c f6 e9 76 b2 fd aa ac 60 09 23 d5 6b 9a 70 57 8a 9f d5 bd eb 61 b5 08 fe 4a ac c6 d6 06 8d 08 fe 4a ac c6 d6 06 8d 08 fe 4a ac c6 d6 06 8d 08 fe 4a ac c6 d6 06 8d }
    condition:
        all of them
}

rule CrowdStrike_CSIT_15083_01 : emissary_panda httpbrowser rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "HttpBrowser RAT"
        reports = "CSIT-15083"
        version = "201911121933"
        last_modified = "2019-11-12"
        actor = "EMISSARY PANDA"
        malware_family = "HttpBrowser"
    strings:
        $ws_httpbrowser = "HttpBrowser/1.0" wide
        $ws_fmt_1 = "%d|%s|%04d/%02d/%02d %02d:%02d:%02d|%ld|%d" wide
        $ws_fmt_2 = "%d|%s|%04d/%02d/%02d %02d:%02d:%02d|%d|%d" wide
        $ws_down = "/down?p=%ld&l=%d" wide
        $ws_loop = "/loop?c=%s&l=%s&o=%s&u=%s&r=%d&t=%d" wide
        $ws_result = "/result?%d" wide
        $ws_upload = "/upload%d" wide
        $ws_dllurl = "\\pnipcn.dll.url" wide
        $ws_hexfmt_1 = "{%08X-%04X-%04X-%02X%02X-%02X%02X%02X%02X%02X%02X}" wide
        $ws_hexfmt_2 = "%08x%08x%x" wide
        $ws_error    = "WSAAddressToString() Error:[%d]" wide
        $def_desc    = "descripion" wide
    condition:
        (3 of ($ws_*)) and not (any of ($def_*))
}

rule CrowdStrike_CSIT_15070_01 : hkdoor certificate 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Serial number of code signing certificate seen used by HkDoor authors"
        reports = "CSIT-15070"
        version = "201507060000"
        last_modified = "2015-07-06"
        malware_family = "HkDoor"
    strings:
        // Certificate serial number
        $ = { 10 73 e9 d9 54 42 07 fb 90 30 30 ca 6d e4 88 20 }
    condition:
        all of them
}

rule CrowdStrike_CSIR_16019_09 : cozy_bear minidionis 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "COZY BEAR MiniDionis - Downloader over Microsoft OneDrive"
        reports = "CSIR-16019"
        version = "201507100000"
        last_modified = "2015-07-10"
        actor = "COZY BEAR"
        malware_family = "MiniDionis"
    strings:
        $ = "\\\\d.docs.live.net@SSL\\{0}\\Documents\\" wide
        $ = "\\\\d.docs.live.net@SSL\\{0}\\Pictures\\" wide
        $ = "Select * From Win32_Process Where ProcessID = {0}" wide
    condition:
        all of them
}

rule CrowdStrike_CSIT_15076_01 : anglerek exploit 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Angler Exploit Kit loader page"
        reports = "CSIT-15076"
        version = "201907250755"
        last_modified = "2019-07-25"
        malware_family = "AnglerEK"
    strings:
        $a = { 3e [1-2] 3c 68 65 61 64 3e [2-4] 3c 74 69 74 6c 65 3e }
        $b = { 3c 2f 74 69 74 6c 65 3e [1-2] 3c 2f 68 65 61 64 3e [1-2] 3c 62 6f 64 79 3e }
        $c = { 3c 2f 62 6f 64 79 3e [1-2] 3c 2f 68 74 6d 6c 3e }
        $d = { 66 75 6e 63 74 69 6f 6e 20 [1-8] 28 [2-8] 29 7b 20 76 61 72 20 }
        $e = { 3c 73 63 72 69 70 74 20 3e 0d }
        $f = "Array"
        $g = "String"
        $reg = /\s{1}\'([A-Za-z0-9\/\+=]{20,40})\';\s{1}/
    condition:
        all of them
}

rule CrowdStrike_CSIT_15076_02 : anglerek exploit key 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Angler Exploit Kit Flash exploit RC4 key"
        reports = "CSIT-15076"
        version = "201507140000"
        last_modified = "2015-07-14"
        malware_family = "AnglerEK"
    strings:
        $ = "rbJ4ga8Lr7gRe46UsUdzt"
        $ = "oej8qtgwy0amcapt7kz9itbxc"
    condition:
        any of them
}

rule CrowdStrike_CSIT_15073_01 : gothic_panda pirpi exploit 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Pirpi browser exploit landing page"
        reports = "CSIT-15073"
        version = "201507150000"
        last_modified = "2015-07-15"
        actor = "GOTHIC PANDA"
        malware_family = "Pirpi"
    strings:
        // Characteristic HTML code
        $htmlcode = {
        3c 74 69 74 6c 65 3e 3c 2f 74 69 74 6c 65 3e 0d
        0a 3c 73 63 72 69 70 74 20 73 72 63 3d 27 69 6e
        64 65 78 2e 6a 73 27 3e 3c 2f 73 63 72 69 70 74
        3e 0d 0a 3c 2f 68 65 61 64 3e 0d 0a 3c 62 6f 64
        79 20 69 64 3d 22 62 6f 64 79 49 64 22 20 6f 6e
        6c 6f 61 64 3d 22 73 68 6f 77 42 6f 64 79 28 29
        22 3e 0d 0a
        }
    condition:
        all of them
}

rule CrowdStrike_CSIT_15073_02 : gothic_panda pirpi exploit javascript 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Pirpi browser exploit JavaScript"
        reports = "CSIT-15073"
        version = "201507150000"
        last_modified = "2015-07-15"
        actor = "GOTHIC PANDA"
        malware_family = "Pirpi"
    strings:
        // User agent check
        $ = "navigator.userAgent.toLowerCase().indexOf"
        // Dynamic code
        $ = "document.body.innerHTML+="
        // Characteristic script code
        $ = "document.body.innerHTML+="
        // "<embed src='[name].swf' width=10 height=10 flashvars=\"[var]="+[var]+"\"></embed>";
        $ = {
        22 3c 65 6d 62 65 64 20 73 72 63 3d 27 [1-32] 2e 73
        77 66 27 20 77 69 64 74 68 3d 31 30 20 68 65 69 67
        68 74 3d 31 30 20 66 6c 61 73 68 76 61 72 73 3d 5c
        22 ?? 3d 22 2b ?? 2b 22 5c 22 3e 3c 2f 65 6d 62 65
        64 3e 22 3b
        }
    condition:
        all of them
}

rule CrowdStrike_CSIT_15073_03 : gothic_panda pirpi ieproxy rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Pirpi IeProxy RAT"
        version = "201507150000"
        last_modified = "2015-07-15"
        actor = "GOTHIC PANDA"
        malware_family = "Pirpi"
    strings:
        // DLL export #1 code
        $ = { 6a 00 6a 00 6a 00 68 ?? ?? ?? ?? 6a 00 6a 00 ff 15 ?? ?? ?? ?? 50 ff 15 ?? ?? ?? ?? 33 c0 c2 04 }
        // Cookie
        $ = "vv;expires = Sat,01-Jan-2000 00:00:00 GMT"
        // Status messages
        $ = "unkstate"
        $ = "Copy Ok"
        $ = "Echo Ok"
        $ = "Echo Err"
    condition:
        all of them
}

rule CrowdStrike_CSIT_15078_01 : rat skipper venomous_bear 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Skipper RAT"
        reports = "CSIT-15078"
        version = "201908131554"
        last_modified = "2019-08-13"
        actor = "VENOMOUS BEAR"
        malware_family = "Skipper"
    strings:
        $code_keygen = { 0f b7 c0 99 6a 07 59 f7 f9 8a (06|07) }
        $code_rc4_snippet = { 0f b6 c8 0f b6 5c 0c 2c 8d 4c 0c 2c 0f b6 fa 8d
        7c 3c 2c 88 5c 24 13 0f b6 1f 88 19 8a 5c 24 13
        88 1f 0f b6 09 89 7c 24 18 0f b6 fb 03 cf 81 e1
        ff 00 00 80 79 08 49 81 c9 00 ff ff ff 41 0f b6
        c9 8a 4c 0c 2c 32 0c 2e 46 83 6c 24 14 01 88 4e
        ff 75 87 }
        $str_cname = "csrss_class"
        $str_hash_1 = "d8094442f39ad50e7d8de03910aa5da3"
        $str_hash_2 = "2cbb6062cfcd108bd379d19d8d491595"
        $str_hash_3 = "e2c6e14d87819cbfd7b1"
        $str_key = "holy32tr98"
    condition:
        (any of ($code_*)) or (any of ($str_*))
}

rule CrowdStrike_CSIT_15078_02 : delivery_document skipper venomous_bear 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Skipper RAT malicious delivery document"
        reports = "CSIT-15078"
        version = "201908131616"
        last_modified = "2019-08-13"
        actor = "VENOMOUS BEAR"
        malware_family = "Skipper"
    strings:
        $str_thisdodc = "ThisDocument"
        $str_scripting = "Scripting.FileSystemObject$"
        $str_word = "MSWord.exe"
        $str_mac_array = "MacrosArray"
        $str_mac_size = "MacrosSize"
        $str_check = "CheckFile"
        $doc_header = { d0 cf 11 e0 a1 b1 1a e1 }
    condition:
        $doc_header at 0 and (4 of ($str_*))
}

rule CrowdStrike_CSIT_15078_03 : rat skipper venomous_bear 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Skipper RAT obfuscated MZ header"
        reports = "CSIT-15078"
        version = "201908131608"
        last_modified = "2019-08-13"
        actor = "VENOMOUS BEAR"
        malware_family = "Skipper"
    strings:
        $encstart_1 = { 6e a0 b2 f9 20 fe 22 fd 27 f2 22 f1 dc 09 22 f5 }
        $encstart_2 = { 06 d9 db 83 48 83 4b 83 4f 93 4b 93 b4 6c 4b 93 }
    condition:
        any of ($encstart*)
}

rule CrowdStrike_CSIT_15078_04 : rat skipper venomous_bear 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Skipper RAT obfuscated strings"
        reports = "CSIT-15078"
        version = "201908131615"
        last_modified = "2019-08-13"
        actor = "VENOMOUS BEAR"
        malware_family = "Skipper"
    strings:
        $enc_1 = { 3d 62 3a 58 2d e6 aa cd 65 39 50 ec 56 73 d1 53 3a 9c 2d e6 3b }
        $enc_2 = { 4f 31 1d 2c 96 73 55 73 b2 9c 28 76 2b b9 74 a9 1d 4e 96 73 9d }
        $enc_3 = { 4f 31 1d 2c 96 73 55 73 b2 9c 28 76 2b b9 74 a9 1d 4e 96 73 9d }
        $enc_4 = { 4f 31 1d 2c 96 73 55 73 b2 9c 28 76 2b b9 74 a9 1d 4e 96 73 9d }
        $enc_5 = { d3 4c 47 0b a5 6e aa dc ac 27 0a 9d 65 37 1d 6a 47 93 a5 6e b3 }
        $enc_6 = { e9 26 a3 85 69 37 55 6e 56 93 05 67 b2 9b 8e 35 a3 c9 69 37 d9 }
        $enc_7 = { f4 13 d1 61 b4 9b aa 37 2b c9 41 b3 59 cd 47 9a d1 72 b4 9b ec }
    condition:
        any of them
}

rule CrowdStrike_CSIT_17052_01 : zombie_spider kelihos bot 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Kelihos version 5"
        reports = "CSIT-17052"
        version = "201507240000"
        last_modified = "2015-07-24"
        actor = "ZOMBIE SPIDER"
        malware_family = "Kelihos"
    strings:
        $ = "Gen new list key!"
        $ = "SonyObj"
        $ = "SonyPath"
        $ = "SonyPathA"
        $ = "SonyObjT"
        $ = "Gen new port key!"
        $ = "Gen new job key!"
        $ = "Gen new list key!"
        $ = "InvertibleRSAFunction: specified modulus size is too small"
        $ = "wpcap.dll Dynamic Link Library - based on libpcap" wide
    condition:
        all of them
}

rule CrowdStrike_CSIT_15088_02 : exploit 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Hacking Team Privilege Escalation Exploit"
        reports = "CSIT-15088"
        version = "201507300000"
        last_modified = "2015-07-30"
    strings:
        // Pushing of CreateBitmap() parameters
        $ = { 6a 20 6a 01 68 2f 01 00 00 6a 6e }
    condition:
        all of them
}

rule CrowdStrike_CSIT_15081_03 : explosive_rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Explosive RAT helper DLL"
        reports = "CSIT-15081"
        version = "201508010000"
        last_modified = "2015-08-01"
        malware_family = "Explosive RAT"
    strings:
        $ = "winsec.dll"
        // Exports:
        // CON
        $ = { 43 4f 4e 00 }
        $ = "CreateNewFile"
        $ = "GetAllData"
        $ = "GetIEHistory"
        $ = "PathProcess"
        $ = "SetWinHoK"
        $ = "registerapp"
        // Password GUIDs
        $ = "220d5cc1"
        $ = "5e7e8100"
        $ = "b9819c52"
    condition:
        // Is MZ
        uint16(0) == 0x5A4D and
        // Is DLL
        uint8(uint32(0x3c)+23) == 0x21 and
        5 of them
}

rule CrowdStrike_CSIT_15081_01 : dropper explosive_rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Explosive RAT dropper"
        reports = "CSIT-15081"
        version = "202106171536"
        last_modified = "2021-06-17"
        malware_family = "Explosive RAT"
    strings:
        $payload_separator = "^*!#^`|"
        // CMP/JNZ pattern looking for "^*!#^`|"
        $searchArgs = { 80 3c 18 5e 0f 85 ?? ?? ?? ?? 80 7c 18 01 2a 0f 85 ?? ?? ?? ?? 80 7c 18 02 21 0f 85 ?? ?? ?? ?? 80 7c 18 03 23 0f 85 ?? ?? ?? ?? 80 7c 18 04 5e 0f 85 ?? ?? ?? ?? 80 7c 18 05 60 0f 85 ?? ?? ?? ?? 80 7c 18 06 7c 0f 85 }
    condition:
        1 of them
}

rule CrowdStrike_CSIT_15081_02 : explosive_rat rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Explosive RAT"
        reports = "CSIT-15081"
        version = "202106171536"
        last_modified = "2021-06-17"
        malware_family = "Explosive RAT"
    strings:
        // Encoded strings:
        // <!*securedok*!>
        $ = "==gKg5XI+BmK8EiKj9mbuV2Y092aqEiP"
        // <!*connectok*!>
        $ = "==gKg5XI+BmK8EiKzV2Y1JXZk92aqEiP"
        // <*`EOF`*>
        $ = "==gKg5XI+BmK8oCYF9kRgpiP"
        // Logs
        // "\n\nService UnInstalled Sucessfully\n"
        $ = { 0a 0a 45 72 72 6f 72 20 55 6e 49 6e 73 74 61 6c 6c 69 6e 67 20 53 65 72 76 69 63 65 0a }
        // "\n\nError UnInstalling Service\n"
        $ = { 0a 0a 53 65 72 76 69 63 65 20 55 6e 49 6e 73 74 61 6c 6c 65 64 20 53 75 63 65 73 73 66 75 6c 6c 79 0a }
    condition:
        3 of them
}

rule CrowdStrike_CSIT_15085_02 : samurai_panda nflog isspace rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "IsSpace (NfLog variant) URLs"
        reports = "CSIT-15085"
        version = "201508070000"
        last_modified = "2015-08-07"
        actor = "SAMURAI PANDA"
        malware_family = "NfLog, IsSpace"
    strings:
        $init = "STTip.asp"
        $report = "SNews.asp?HostID="
        $trans = "SGames.asp?HostID="
        $cmd = "STravel.asp?HostID="
        $browse = "SJobs.asp?HostID="
        $down = "SSports.asp?HostID="
        $up = "SWeather.asp?HostID="
    condition:
        3 of them
}

rule CrowdStrike_CSIT_15085_01 : samurai_panda nflog isspace rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "IsSpace (NfLog variant) strings"
        reports = "CSIT-15085"
        version = "201807301103"
        last_modified = "2018-07-30"
        actor = "SAMURAI PANDA"
        malware_family = "NfLog, IsSpace"
    strings:
        $str_isu = "IsUsers"
        $str_isg = "IsGoogle"
        $str_iss = "IsSpace"
        $str_begin1 = "Begin to maintrans dowork"
        $str_begin2 = "Begin to Main"
        $str_uninstall = "!UNINSTALL"
        $xorkey = { 35 8e 9d 7a }
    condition:
        3 of them
}

rule CrowdStrike_CSIT_15021_03 : cozy_bear adobearm_rat installer 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Python installer for AdobeARM RAT (UPX packed)"
        reports = "CSIT-15021"
        version = "201508120000"
        last_modified = "2015-08-12"
        actor = "COZY BEAR"
        malware_family = "AdobeARM RAT"
    strings:
        $t_upx0 = "UPX0"
        $t_upx1 = "UPX1"
        $t_python27 = "python27.dll"
        $t_out00 = "out00-PYZ.pyz"
        $t_pyiospath = "pyi_os_path"
        $t_pyiarchive = "pyi_archive"
        $t_pyiimporters = "pyi_importers"
        $t_pyicarchive = "pyi_carchive"
        $t_cryptoaes = "Crypto.Cipher._AES.pyd"
        $t_selectpyd = "select.pyd"
        $t_bz2 = "bz2.pyd"
        $t_unicodedata = "unicodedata.pyd"
        $t_hashlib = "_hashlib.pyd"
        $t_pyibootstrap = "_pyi_bootstrap"
        $t_ssl = "_ssl.pyd"
        $t_ctypes = "_ctypes.pyd"
        $t_socket = "_socket.pyd"
        $distorm3 = "distorm3.dll"
    condition:
        all of ($t_*) and not $distorm3
}

rule CrowdStrike_MalJS_Keylogger_01 : keylogger 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects a malicious Javascript keylogger observed to harvest credentials in spoofed OWA login pages."
        version = "201508130000"
        last_modified = "2015-08-13"
    strings:
        $eventListener1 = "document.addEventListener(\"keypress\","
        $eventListener2 = "document.addEventListener('keypress',"
        $url_id = "'?id='+window.location"
        $url_callback = "callback\"+"
        $url_data = "&data=\"+"
    condition:
        any of ($eventListener*) and all of ($url*)
}

rule CrowdStrike_CSIR_16019_01 : cozy_bear atiagent dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "SFX RAR dropper for ATI-Agent implant"
        reports = "CSIR-16019"
        version = "201508170000"
        last_modified = "2015-08-17"
        actor = "COZY BEAR"
        malware_family = "ATI-Agent"
    strings:
        $rarsfx = "d:\\Projects\\WinRAR\\SFX\\build\\sfxrar32\\Release\\sfxrar.pdb"
        $payload = "reader_sl.exe"
        $decoy = ".pdf"
    condition:
        all of them
}

rule CrowdStrike_CSIT_13033_01 : pirate_panda mozirat rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Format string used to populate victim enumeration into a user-agent by MoziRAT."
        reports = "CSIT-13033"
        version = "201508170000"
        last_modified = "2015-08-17"
        actor = "PIRATE PANDA"
        malware_family = "MoziRAT"
    strings:
        $ua_first = "MSIE(%s); NT(%d.%d.%d "
        $ua_second = "); AV(%d); OV(%s); NA(%s) VR(%s)"
    condition:
        all of them
}

rule CrowdStrike_CSIR_13012_01 : pirate_panda config 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "PIRATE PANDA - Encrypted Config"
        reports = "CSIT-13033,CSIT-13037,CSIR-13012"
        version = "201807300834"
        last_modified = "2018-07-30"
        actor = "PIRATE PANDA"
    strings:
        // encrypted config magic string in RAT version 1
        $encconfmagic1 = { 38 3b 22 31 2d 3b 21 2e 2d 54 54 54 54 }
        // encrypted config magic string in RAT version 2
        $encconfmagic2 = { bb 93 06 01 01 01 01 01 01 01 01 01 01 }
        // encrypted config magic string in RAT version 3
        $encconfmagic3 = { d8 e5 15 56 8b f4 42 ba f0 75 32 02 d7 }
        // encrypted config magic string in RAT version 4
        $encconfmagic4 = { e4 db 18 6d 79 98 5d 83 af 82 53 6d 92 }
        $encconfmagic4_2 = { d0 ed 1d 5e 83 fc 4a b2 f8 7d 3a 0a df }
        // encrypted config magic strings in RAT version 5
        $encconfmagic5 = { 87 84 9d 8e 92 84 9e 91 92 eb eb eb eb }
        $encconfmagic6 = { a1 b1 d9 af a7 a7 db da b3 eb eb eb eb }
    condition:
        any of them
}

rule CrowdStrike_CSIR_16019_02 : cozy_bear atiagent dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Dropper component ATI-Agent implant"
        reports = "CSIR-16019"
        version = "201807271804"
        last_modified = "2018-07-27"
        actor = "COZY BEAR"
        malware_family = "ATI-Agent"
    strings:
        $strdeobf = { 8B 31 0F BE 34 06 0F B6 79 08 66 33 F7 66 33 F0 BF FF 00 00 00 66 23 F7 66 89 34 42 40 3B 41 04 }
        $find = "FindResourceW"
        $load = "LoadResource"
        $lock = "LockResource"
    condition:
        all of them
}

rule CrowdStrike_CSIT_15086_01 : poisonivy rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "PoisonIvy with HTTP Proxy-Authorization support"
        reports = "CSIT-15086"
        version = "201508190000"
        last_modified = "2015-08-19"
        malware_family = "PoisonIvy"
    strings:
        $ = { c7 85 b0 fd ff ff 53 4f 46 54 c7 85 b4 fd ff ff 57 41 52 45 c7 85 b8 fd ff ff 5c 43 4c 41 c7 85 bc fd ff ff 53 53 45 53 c7 85 c0 fd ff ff 5c 42 4a 5c c7 85 c4 fd ff ff 53 54 41 54 c7 85 c8 fd ff ff 49 43 20 00 }
        $ = { c7 85 90 fd ff ff 4d 65 73 73 c7 85 94 fd ff ff 61 67 65 46 c7 85 98 fd ff ff 69 6c 65 00 }
    condition:
        all of them
}

rule CrowdStrike_CSIT_15086_02 : poisonivy dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "String decryption routine used in a PoisonIvy dropper"
        reports = "CSIT-15086"
        version = "201807201304"
        last_modified = "2018-07-20"
        malware_family = "PoisonIvy"
    strings:
        $ = { ff 05 ?? ?? ?? ?? 2a cb 80 f1 3f 6a 00 02 cb 6a 00 88 0f }
    condition:
        all of them
}

rule CrowdStrike_CSIT_15086_03 : poisonivy dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "PoisonIvy dropper involving a scheduled task"
        reports = "CSIT-15086"
        version = "201508190000"
        last_modified = "2015-08-19"
        malware_family = "PoisonIvy"
    strings:
        $ = { 73 63 68 74 [0-6] 61 73 6b 73 [0-6] 20 2f 63 72 [0-6] 65 61 74 65 [0-6] 20 2f 73 63 [0-6] 20 6d 69 6e [0-6] 75 74 65 20 [0-6] 2f 6d 6f 20 [0-6] 31 20 2f 74 [0-6] 6e 20 20 22 [0-6] 55 70 64 61 [0-6] 74 65 20 41 [0-6] 73 73 69 73 [0-6] 74 22 20 2f [0-6] 74 72 20 22 [0-6] 5c 22 25 73 [0-6] 5c 22 22 20 }
    condition:
        all of them
}

rule CrowdStrike_CSIT_15092_01 : rat9002 rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "9002 variant seen in attacks against healthcare sector"
        reports = "CSIT-15092"
        version = "201508190000"
        last_modified = "2015-08-19"
        malware_family = 9002
    strings:
        $ali = "\\Aliapp.exe"
        $stub = "StubPath"
        $basereg = "SOFTWARE\\Microsoft\\Active Setup\\Installed Components\\{"
        $allocerr = "AllocateAndInitializeSid Error %u"
        $regres = "RegCreateKeyEx result %u"
    condition:
        3 of them
}

rule CrowdStrike_CSIT_15094_01 : dfdownloader downloader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Malicious first stage downloader (DFDownloader)"
        reports = "CSIT-15094"
        version = "201807300931"
        last_modified = "2018-07-30"
        malware_family = "DFDownloader"
    strings:
        $remote = "REMOTE_USER:"
        $ctype = "Content-type: application/x-www-form-urlencoded"
        $ua = /User-Agent: (sk|skype)/ nocase
        $path = /\\ProgramData\\(syn|Drives|Skypee)/
    condition:
        all of them
}

rule CrowdStrike_CSIT_15089_01 : defex rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Defex RAT"
        reports = "CSIT-15089"
        version = "201508220000"
        last_modified = "2015-08-22"
        malware_family = "Defex"
    strings:
        $taskingRequest = "Data$$01%c%sData"
        $mutex = "Global\\ESDXX"
    condition:
        all of them
}

rule CrowdStrike_CSIT_15089_02 : defex shellcode 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Defex RAT shellcode"
        reports = "CSIT-15089"
        version = "201508220000"
        last_modified = "2015-08-22"
        malware_family = "Defex"
    strings:
        $shellcode = { 55 8b ec 81 ec c4 00 00 00 c7 45 c0 34 12 00 00 c7 85 5c ff ff ff 21 43 00 00 c7 85 60 ff ff ff 78 56 00 00 }
        $sig = "QWERTYUIOPLKJHG"
    condition:
        all of them
}

rule CrowdStrike_CSIT_16035_01 : wicked_spider rbdoor dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "RbDoor dropper"
        reports = "CSIT-16035"
        version = "201807300909"
        last_modified = "2018-07-30"
        actor = "WICKED SPIDER"
        malware_family = "RbDoor"
    strings:
        $ = "RbDoor" nocase wide
        // inflate version string part
        $ = " inflate 1."
        // capitalized dll name
        $ = "Kernel32.dll"
        // embedded payload marker, sizes and first encrypted DWORD
        $ = { 00 00 00 00 ?? ?? ?? 00 ?? ?? ?? 00 (b1 ff f8 ed | 78 9c ec) }
    condition:
        all of them
}

rule CrowdStrike_CSIT_16035_02 : rbdoor loader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "RbDoor loader DLL"
        reports = "CSIT-16035"
        version = "201807300910"
        last_modified = "2018-07-30"
        actor = "WICKED SPIDER"
        malware_family = "RbDoor"
    strings:
        // Process names
        $ = "rundll32.exe"
        $ = "svchost.exe"
        // Registry key
        $ = "SYSTEM\\CurrentControlSet\\Services\\%s\\Parameters"
        // Registry value
        $ = "ServiceDll"
        // Payload DLL export names
        $ = "RMain"
        $ = "SMain"
        $ = "Install_uac"
        $ = "Install"
        $ = "DeleteF"
    condition:
        all of them
}

rule CrowdStrike_CSIT_16026_01 : trkwks rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "TrkWks RAT characteristic string set"
        reports = "CSIT-16026"
        version = "201508310000"
        last_modified = "2015-08-31"
        malware_family = "TrkWks"
    strings:
        $ = "%d %d %s %d %s"
        $ = "Microsoft Unified Security Protocol Provider"
    condition:
        all of them
}

rule CrowdStrike_CSIT_16026_02 : trkwks rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "TrkWks RAT with scanning functionality"
        reports = "CSIT-16026"
        version = "201508310000"
        last_modified = "2015-08-31"
        malware_family = "TrkWks"
    strings:
        $ = "Open %s failed! Error:%d"
        $ = "dwHostIndex:%d, dwTotalHostIndexCount:%d"
        $ = "[Host]=%s [Port]=%d [Vunl]=%s [Info]=%s []"
        $ = "0: [%-15s]:  (%d) (%s) EXCEPTION_EXECUTE_HANDLER !!!  Vunl=%s Inf"
    condition:
        any of them
}

rule CrowdStrike_CSIT_15095_01 : acunetix_wvs scanner 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Acunetix Web Vulnerability Scanner primary executable"
        reports = "CSIT-15095"
        version = "201509020000"
        last_modified = "2015-09-02"
    strings:
        $ = "BMP16_ACUNETIX" wide
        $ = "scanURLW"
        $ = "Web Vulnerability Scanner" wide
        $ = "html2plainWW"
    condition:
        uint16(0) == 0x5A4D and uint32(uint32(0x3c)) == 0x4550 and all of them
}

rule CrowdStrike_CSIT_15102_01 : minirandrat rat post_exploitation 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "MiniRandRAT post-exploitation controller"
        reports = "CSIT-15102"
        version = "201509040000"
        last_modified = "2015-09-04"
        malware_family = "MiniRandRAT"
    strings:
        $ = "%s 192.168.1.1 \"put c:\\windows\\system32\\calc.exe d:\\xx\\oo.exe\""
        $ = "put file example:"
        $ = "%s 192.168.1.1 \"get c:\\windows\\system32\\calc.exe d:\\xx\\oo.exe\""
        $ = "get file example:"
        $ = "%s 192.168.1.1:10086 \"net user\""
        $ = "%s [ipAddrass[:port]] cmd"
        $ = "upload over!"
    condition:
        2 of them
}

rule CrowdStrike_CSIT_15122_01 : qrat quaverserat rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "QUAVerse (QRAT) Dropper"
        reports = "CSIT-15122"
        version = "201509040000"
        last_modified = "2015-09-04"
        malware_family = "QUAVerse"
    strings:
        $resource = "e-data"
        $crypt = "Qrypt.class"
    condition:
        // JAR Header
        uint16(0) == 0x4b50 and
        all of them
}

rule CrowdStrike_CSIT_15122_02 : qrat quaverserat rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "QUAVerse (QRAT)"
        reports = "CSIT-15122"
        version = "201509040000"
        last_modified = "2015-09-04"
        malware_family = "QUAVerse"
    strings:
        $crypt = "Qrypt.class"
        $qtring = "Qtring.class"
        $quaverse = "quaverse" nocase
    condition:
        // JAR Header
        uint16(0) == 0x4b50 and
        2 of them
}

rule CrowdStrike_CSIT_15097_01 : deboxdown downloader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "DeboxDown Dropbox-based downloader"
        reports = "CSIT-15097"
        version = "201509070000"
        last_modified = "2015-09-07"
        malware_family = "DeboxDown"
    strings:
        $ = "_silent.txt"
        $ = "_period.txt&root=auto"
        $ = "_period.txt"
        $ = "_download?overwrite=False"
        $ = "_upload.bat&root=auto"
        $ = "_upload.bat"
        $ = "_upload&root=auto"
    condition:
        all of them
}

rule CrowdStrike_CSIT_15101_01 : cgirat dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "CGI RAT dropper (Cluster 1 variant)"
        reports = "CSIT-15101"
        version = "201509080000"
        last_modified = "2015-09-08"
        malware_family = "CGI RAT"
    strings:
        $ = "%s %d \"%s\""
        $ = "Del"
        $ = "Open"
        $ = "SizeofResource"
        $ = { 68 09 04 00 00 }
        $ = { 68 d0 07 00 00 }
        $ = { b0 41 b1 50 }
    condition:
        all of them
}

rule CrowdStrike_CSIT_15101_02 : cgirat dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "CGI RAT dropper (Cluster 2 variant)"
        reports = "CSIT-15101"
        version = "201509080000"
        last_modified = "2015-09-08"
        malware_family = "CGI RAT"
    strings:
        $visualc = "Microsoft Visual C++ Runtime Library"
        $com = "COMSPEC"
        $open = "open"
        $size = "SizeofResource"
        // Byte string - ResourceA
        $resa = { 52 c6 ?? ?? 65 c6 ?? ?? 73 c6 ?? ?? 6f c6 ?? ?? 75 c6 ?? ?? 72 c6 ?? ?? 63 c6 ?? ?? 65 c6 ?? ?? 41 }
        // Byte string = /c del %s
        $cdel = { 2f c6 ?? ?? 63 c6 ?? ?? 20 c6 ?? ?? 64 c6 ?? ?? 65 c6 ?? ?? 6c c6 ?? ?? 20 c6 ?? ?? 22 c6 ?? ?? 25 c6 ?? ?? 73 }
    condition:
        all of them
}

rule CrowdStrike_CSIT_15101_03 : cgirat rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "CGI RAT main payload"
        reports = "CSIT-15101"
        version = "201509080000"
        last_modified = "2015-09-08"
        malware_family = "CGI RAT"
    strings:
        $ = "[S][tmp]:%s"
        $ = "[S][szCommand]:%s"
        $ = "ReadFile"
        $ = "1*%d"
        $ = "2*%d"
    condition:
        3 of them
}

rule CrowdStrike_CSIT_15113_01 : labyrinth_chollima zippwddropper dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Dropper with password-protected ZIP as resource"
        reports = "CSIT-15113"
        version = "201509110000"
        last_modified = "2015-09-11"
        actor = "LABYRINTH CHOLLIMA"
        malware_family = "ZipPwdDropper"
    strings:
        $zip_password = "!1234567890 dghtdhtrhgfjnui$%^^&fdt"
        $resname = "MYRES" wide
    condition:
        all of them
}

rule CrowdStrike_CSIT_15113_02 : labyrinth_chollima hawup rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Hawup RAT"
        reports = "CSIT-15113"
        version = "201807301040"
        last_modified = "2018-07-30"
        actor = "LABYRINTH CHOLLIMA"
        malware_family = "Hawup"
    strings:
        $ = "%sd.e%sc %s >%s 2>&1" wide
        $ = "%sd.e%sc %s 2>%s" wide
        $ = "%d\t%s\t%s\t%s\t\t%s\x0d\x0a" wide
        $ = "cmd.exe /c %s > %s 2>&1" wide
        $ = "@echo off\x0d\x0a:L1\x0d\x0asc stop %s\x0d\x0asc delete %s\x0d\x0adel \"%s\"\x0d\x0adel \"%s\"\x0d\x0aif exist \"%s\" goto L1\x0d\x0adel \"%s\""
    condition:
        2 of them
}

rule CrowdStrike_CSIT_15100_01 : sec_worm 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Sec-wOrm malware"
        reports = "CSIT-15100"
        version = "201509140000"
        last_modified = "2015-09-14"
        malware_family = "Sec-wOrm"
    strings:
        $func1 = "\"%windir%\") & \"\\Microsoft.NET\\Framework\\"
        $func2 = "if w.readystate<>4 Then"
        $func3 = "set shell = WScript.CreateObject"
        $comment1 = "' \\\\ Configuration ~"
        $comment2 = "' \\\\ Sub and Function ~"
        $comment3 = "'<[ Recoder :"
    condition:
        all of ($func*) or all of ($comment*)
}

rule CrowdStrike_CSIT_15103_01 : certificate 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Rule to detect binaries signed with stolen certificate issued to QTI International, Inc"
        reports = "CSIT-15103"
        version = "201509210000"
        last_modified = "2015-09-21"
    strings:
        $serial = { 2e df b9 fd cf a0 0c cb 5a b0 09 ee 3a db 97 b9 }
        $org = "QTI International Inc"
    condition:
        uint16(0) == 0x5A4D and all of them
}

rule CrowdStrike_CSIT_15103_02 : certificate 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Rule to detect binaries signed with stolen certificate issued to CallTogether, Inc"
        reports = "CSIT-15103"
        version = "201910140959"
        last_modified = "2019-10-14"
    strings:
        $cn = "CallTogether, Inc."
        $serial = { 45 21 56 c3 b3 fb 01 76 36 5b db 5b 77 15 bc 4c }
    condition:
        uint16(0) == 0x5a4d and
        ($cn and $serial)
}

rule CrowdStrike_CSIT_15103_03 : certificate 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Rule to detect binaries signed with stolen certificate issued to MOCOMSYS, Inc"
        reports = "CSIT-15103"
        version = "201910140958"
        last_modified = "2019-10-14"
    strings:
        $cn = "MOCOMSYS INC"
        $serial = { 03 e5 a0 10 b0 5c 92 87 f8 23 c2 58 5f 54 7b 80 }
    condition:
        uint16(0) == 0x5a4d and
        ($cn and $serial)
}

rule CrowdStrike_CSIT_15103_04 : certificate 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Rule to detect binaries signed with stolen certificate issued to Ssangyong Motor Co., Ltd"
        reports = "CSIT-15103"
        version = "201910140956"
        last_modified = "2019-10-14"
    strings:
        $cn = "Ssangyong Motor Co., Ltd"
        $serial = { 1d 2b c8 46 d1 00 d8 fb 94 fa ea 4b 7b 5f d8 94 }
    condition:
        uint16(0) == 0x5a4d and
        ($cn and $serial)
}

rule CrowdStrike_CSIR_16019_06 : cozy_bear seadaddy 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "SeaDaddy implant written in Python using Installer (UPX packed)"
        reports = "CSIR-16019"
        version = "201509240000"
        last_modified = "2015-09-24"
        actor = "COZY BEAR"
        malware_family = "SeaDaddy"
    strings:
        $t_upx0 = "UPX0"
        $t_upx1 = "UPX1"
        $t_python27 = "python27.dll"
        $t_out00 = "out00-PYZ.pyz"
        $t_pyiospath = "pyi_os_path"
        $t_pyiarchive = "pyi_archive"
        $t_pyiimporters = "pyi_importers"
        $t_pyicarchive = "pyi_carchive"
        $t_cryptoaes = "Crypto.Cipher._AES.pyd"
        $t_selectpyd = "select.pyd"
        $t_bz2 = "bz2.pyd"
        $t_unicodedata = "unicodedata.pyd"
        $t_hashlib = "_hashlib.pyd"
        $t_pyibootstrap = "_pyi_bootstrap"
        $t_ssl = "_ssl.pyd"
        $t_ctypes = "_ctypes.pyd"
        $t_socket = "_socket.pyd"
        $distorm3 = "distorm3.dll"
    condition:
        all of ($t_*) and not  $distorm3 and filesize < 4MB
}

rule CrowdStrike_CSIR_16019_07 : cozy_bear agentadb rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Agent-ADB string obfuscation routine"
        reports = "CSIR-16019"
        version = "201509240000"
        last_modified = "2015-09-24"
        actor = "COZY BEAR"
        malware_family = "Agent-ADB"
    strings:
        $ = { 8d 49 00 8a 44 0a 03 32 c3 0f b6 c0 66 89 04 4e 41 3b cf 72 ee }
    condition:
        all of them
}

rule CrowdStrike_CSIR_16019_08 : cozy_bear tasking credential_theft 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "RARSFX loads Active Directory credential collection scripts"
        reports = "CSIR-16019"
        version = "201509240000"
        last_modified = "2015-09-24"
        actor = "COZY BEAR"
    strings:
        $ = "sdelete.exe"
        $ = "diag.ps1"
        $ = "extaudit.vbs"
        $ = "d:\\Projects\\WinRAR\\SFX\\build\\sfxrar32\\Release\\sfxrar.pdb"
    condition:
        all of them
}

rule CrowdStrike_CSIR_15006_01 : berserk_bear barbarian rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Named pipe used in BARBARIAN malware"
        reports = "CSIR-15006"
        version = "201509250000"
        last_modified = "2015-09-25"
        actor = "BERSERK BEAR"
        malware_family = "BARBARIAN"
    strings:
        $pipe = "iieunh523Xsaw" ascii wide
    condition:
        $pipe
}

rule CrowdStrike_CSIR_15006_02 : berserk_bear tasking credential_theft 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Second stage BERSERK BEAR tool - Chrome data stealer"
        reports = "CSIR-15006"
        version = "201509250000"
        last_modified = "2015-09-25"
        actor = "BERSERK BEAR"
    strings:
        $pack = "Pack failed" ascii wide
        $steal = "Steal storage failed" ascii wide
        $dir = "\\Google\\Chrome\\User Data\\Default\\login data" ascii wide
    condition:
        all of them
}

rule CrowdStrike_CSIT_15099_01 : aimrat rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Strings noted in AIMRAT samples"
        reports = "CSIT-15099"
        version = "201510010000"
        last_modified = "2015-10-01"
        malware_family = "AIMRAT"
    strings:
        $ = "text/aolrtf; charset=\"iso-8859-1\""
        $ = "&amp;"
    condition:
        all of them
}

rule CrowdStrike_CSIT_15099_02 : aimrat packer 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Custom packer used in AIMRAT"
        reports = "CSIT-15099"
        version = "201510050000"
        last_modified = "2015-10-05"
        malware_family = "AIMRAT"
    strings:
        $lio_0     = { 4c 49 4f 30 00 }
        $lio_1     = { 4c 49 4f 31 00 }
        $lio_start = { 4c 49 4f 21 }
    condition:
        all of them and (
        for all of ($lio_*) : ( @ < 0x600 )
        )
}

rule CrowdStrike_CSIT_16006_01 : minion_rat dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Minion RAT dropper"
        reports = "CSIT-16006"
        version = "201510050000"
        last_modified = "2015-10-05"
        malware_family = "Minion RAT"
    strings:
        // Marker to be replaced with config
        $popo_00 = "POPOPOPOPOPO\x00\x00\x00\x00"
        // rundll as persistence
        $rundll = "rundll32.exe \"%s\"," ascii
        $seload = "SeLoadDriverPrivilege" wide
        $sedebug = "SeDebugPrivilege" wide
        $reg = "SYSTEM\\CurrentControlSet\\Services\\"
    condition:
        all of them
}

rule CrowdStrike_CSIT_16006_03 : minion_rat rootkit 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Minion RAT rootkit driver"
        reports = "CSIT-16006"
        version = "201510050000"
        last_modified = "2015-10-05"
        malware_family = "Minion RAT"
    strings:
        $driver = "\\Device\\{B95BC6A1-1589-4571-B439-D51789BD3B60}" wide
        $keimport = "KeServiceDescriptorTable"
        // Strings for hook installations
        $a = "\\Driver\\nsiproxy" wide
        $b = "\\Device\\Tcp" wide
        $c = "ZwQueryValueKey" wide
        $d = "ZwSaveKey" wide
        $e = "ZwQueryDirectoryFile" wide
        $f = "ZwQuerySystemInformation" wide
        // IOCTLs for user/kernel communication
        $1 = { 0c 20 22 00 }
        $2 = { 08 20 22 00 }
        $3 = { 14 20 22 00 }
        $4 = { 18 20 22 00 }
        $5 = { 04 20 22 00 }
    condition:
        all of ($driver,$keimport) or ((4 of($a,$b,$c,$d,$e,$f)) and (2 of($1,$2,$3,$4,$5)))
}

rule CrowdStrike_CSIR_16019_03 : cozy_bear atiagent rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Main component for ATI-Agent implant"
        reports = "CSIR-16019"
        version = "201510090000"
        last_modified = "2015-10-09"
        actor = "COZY BEAR"
        malware_family = "ATI-Agent"
    strings:
        $strdeobf = { 8B 31 0F BE 34 06 0F B6 79 08 66 33 F7 66 33 F0 BF FF 00 00 00 66 23 F7 66 89 34 42 40 3B 41 04 }
        $c1 = "CryptGenKey"
        $c2 = "CryptDecrypt"
        $c3 = "CryptHashData"
        $c4 = "CryptImportKey"
    condition:
        all of them
}

rule CrowdStrike_CSIR_16019_04 : cozy_bear atiagent loader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "COM object loader for ATI-Agent implant - 32 bit version"
        reports = "CSIR-16019"
        version = "201510090000"
        last_modified = "2015-10-09"
        actor = "COZY BEAR"
        malware_family = "ATI-Agent"
    strings:
        $strdeobf1 = { 0F BE 14 01 33 D0 81 F2 ?? ?? ?? ?? 81 E2 FF 00 00 00 }
        $strdeobf2 = { 0F BE 14 01 33 D0 83 F2 ?? 81 E2 FF 00 00 00 }
        $const1 = { B8 11 01 04 80 }
        $const2 = { B8 05 00 04 80 }
        $const3 = { B8 00 02 04 80 }
        $const4 = { B8 57 00 07 80 }
        $const5 = { 68 02 00 00 80 }
        $exp1 = "DllCanUnloadNow"
        $exp2 = "DllGetClassObject"
        $exp3 = "DllRegisterServer"
        $exp4 = "DllUnregisterServer"
    condition:
        all of ($exp1,$exp2,$exp3,$exp4) and (all of ($const*)) and (1 of ($strdeobf1,$strdeobf2))
}

rule CrowdStrike_CSIR_16019_05 : cozy_bear atiagent loader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "COM object loader for ATI-Agent implant - 64 bit version"
        reports = "CSIR-16019"
        version = "201510090000"
        last_modified = "2015-10-09"
        actor = "COZY BEAR"
        malware_family = "ATI-Agent"
    strings:
        $strdeobf1 = { 0F BE 04 0A 66 33 C1 48 FF C1 66 41 33 C1 66 41 23 C0 }
        $strdeobf2 = { 42 0F B6 04 02 32 C1 FE C1 34 ?? }
        $exp1 = "DllCanUnloadNow"
        $exp2 = "DllGetClassObject"
        $exp3 = "DllRegisterServer"
        $exp4 = "DllUnregisterServer"
    condition:
        all of ($exp1,$exp2,$exp3,$exp4) and (1 of ($strdeobf1,$strdeobf2))
}

rule CrowdStrike_CSIR_16019_10 : cozy_bear atiagent rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Command module for ATI-Agent malware"
        reports = "CSIR-16019"
        version = "201510090000"
        last_modified = "2015-10-09"
        actor = "COZY BEAR"
        malware_family = "ATI-Agent"
    strings:
        //XOR encode with 6byte key when writing to file
        $xor6 = {3B 4D 08 7D 1C 8A 54 05 F4 30 14 0E 41 40 83 F8 06 75 02 33 C0 80 7C 05 F4 00 75 E4}
        //XOR encoder 6byte key 2DEF5AB9C173
        $xorkey = {C7 45 F4 B9 5A EF 2D 66 C7 45 F8 73 C1}
        //String obfuscation algorithm
        $strobf = {8B 30 0F BE 34 0E 0F B6 78 08 66 33 F7 66 33 F1 BF FF 00 00 00 66 23 F7 66 89 34 4A 41 3B 48 04}
        $pipe = "PeekNamedPipe"
        $process = "CreateProcessW"
    condition:
        $xor6 or $xorkey or (all of($strobf,$pipe,$process))
}

rule CrowdStrike_CSIR_16019_11 : cozy_bear atiagent dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Self extracting dropper for COZY BEAR ATI-Agent implant 2014 - Monkeys"
        reports = "CSIR-16019"
        version = "201510090000"
        last_modified = "2015-10-09"
        actor = "COZY BEAR"
        malware_family = "ATI-Agent"
    strings:
        $rarsfx = "d:\\Projects\\WinRAR\\SFX\\build\\sfxrar32\\Release\\sfxrar.pdb"
        $payload = "player.exe"
        $decoy = "Monkeys.exe"
    condition:
        all of them
}

rule CrowdStrike_CSIT_15106_01 : wet_panda preshin rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Constants used to manipulate default MAC address value by Preshin RAT"
        reports = "CSIT-15106"
        version = "201510170000"
        last_modified = "2015-10-17"
        actor = "WET PANDA"
        malware_family = "Preshin"
    strings:
        $const_1 = { 65 b4 cA 65 }
        $const_2 = { 0f d3 65 7d }
        $const_3 = { 1d 56 b9 8b }
        $const_4 = { ab c6 55 2a }
        $const_5 = { 87 a9 a1 fd }
        $const_6 = { 01 00 ff ff }
    condition:
        all of them
}

rule CrowdStrike_CSIT_15106_02 : wet_panda preshin rat key 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "RC4 key used in Preshin variant"
        reports = "CSIT-15106"
        version = "201804181235"
        last_modified = "2018-04-18"
        actor = "WET PANDA"
        malware_family = "Preshin"
    strings:
        $stack_0 = { 4d 73 6e 5f }
        $stack_1 = { 40 3d 32 39 }
        $plain = "Msn_@=29P"
    condition:
        $plain or
        for any i in (1 .. #stack_0):
        (
        $stack_1 in (@stack_0[i] .. @stack_0[i] + 100)
        )
}

rule CrowdStrike_CSIT_15116_01 : greencrash dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects GreenCrash RAT DLL dropper"
        reports = "CSIT-15116"
        version = "201510200000"
        last_modified = "2015-10-20"
        malware_family = "GreenCrash"
    strings:
        $help = "[+] ins.exe -h (show this)"
        $ins = "[+] ins.exe (install with random svc)"
        $status = "[-] no netsvc svc available!"
        $orznet = "orz_SCGetNetsvcs"
        $orzrel = "orz_ResRelease"
        $orzclone = "orz_FileTimeCloneFromKernel32"
    condition:
        3 of them
}

rule CrowdStrike_CSIT_15116_03 : greencrash rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects GreenCrash RAT EXE"
        reports = "CSIT-15116"
        version = "201510200000"
        last_modified = "2015-10-20"
        malware_family = "GreenCrash"
    strings:
        $formatstr = "[Green] pid=%d tid=%d modulePath=%s|" wide
        $help = "green.exe ip port second"
        $status = "ReConfig success"
        $process = "%d Core %.2f GHz"
        $aplib = "aPLib v1.01  -  the smaller the better"
        $const = { fe 34 01 2c }
    condition:
        (1 of ($formatstr,$help)) and (2 of ($status,$process,$aplib,$const))
}

rule CrowdStrike_CSIT_15116_02 : greencrash rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects GreenCrash RAT DLL"
        reports = "CSIT-15116"
        version = "201807271901"
        last_modified = "2018-07-27"
        malware_family = "GreenCrash"
    strings:
        $formatstr= "[injectPE] svcName=%s"
        $xxtea = { 00 79 37 9e }
        $status = "ReConfig success"
        $process = "%d Core %.2f GHz"
        $aplib = "aPLib v1.01  -  the smaller the better"
        $const = { fe 34 01 2c }
    condition:
        (1 of ($formatstr,$xxtea)) and (2 of ($status,$process,$aplib,$const))
}

rule CrowdStrike_CSIT_15115_01 : bisty iegrab dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Bisty/IEGrab dropper"
        reports = "CSIT-15115"
        version = "201510230000"
        last_modified = "2015-10-23"
        malware_family = "Bisty"
    strings:
        $xor_58 = { 80 30 58 46 3b 75 0c 7c ec }
        $regstring = "Software\\rar"
        $strings_2 = "tmp092.tmp"
        $strings_3 = "winlogon.exe"
        $strings_4 = "svchost.exe"
    condition:
        1 of ($xor_58, $regstring) and 2 of ($strings_*)
}

rule CrowdStrike_CSIT_15115_02 : bisty iegrab rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Bisty/IEGrab RAT"
        reports = "CSIT-15115"
        version = "201510230000"
        last_modified = "2015-10-23"
        malware_family = "Bisty"
    strings:
        // Found in both Stage 1 and Stage 2
        $xor_58_func = { 33 c9 39 4c 24 08 7e 10 8b 44 24 04 03 c1 80 30 58 41 3b 4c 24 08 7c f0 c3 }
        // Only found in Stage 2
        $key_name1 = "<Start Application 2 key>"
        $key_name2 = "<Start Application 1 key>"
        $key_name3 = "<Select Media key>"
        $key_name4 = "<Start Mail key>"
        $key_name5 = "<Play/Pause Media key>"
    condition:
        $xor_58_func or 3 of ($key_name*)
}

rule CrowdStrike_CSIT_15107_01 : rwmc credential_dumper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "PowerShell-based credential dumping tool, Reveal Windows Memory Credentials (RWMC)"
        reports = "CSIT-15107"
        version = "201510270000"
        last_modified = "2015-10-27"
        malware_family = "Reveal Windows Memory Credentials"
    strings:
        $func = "function White-Rabbit"
        $pm = "PowerMemory (Follow the White Rabbit)"
    condition:
        any of them
}

rule CrowdStrike_CSIT_15123_05 : msger dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "msger dropper executable"
        reports = "CSIT-15123"
        version = "201510270000"
        last_modified = "2015-10-27"
        malware_family = "msger"
    strings:
        $aplib_1 = { 41 50 33 32 ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? 4d 38 5a } // AP32 ...20... M8Z
        $aplib_2 = "This copy of aPLib is free for non-commercial use"
        $aplib_3 = "aPLib v0.43  -  the smaller the better :)"
        $base64_indicator = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"
        $self_destruct = "cmd.exe /c ping 127.0.0.1 -n 5&cmd.exe /c del /a /f "
        $rundll32 = "%SystemRoot%\\system32\\rundll32.exe"
        $command = " Install"
    condition:
        uint16(0) == 0x5A4D and uint32(uint32(0x3C)) == 0x00004550 and uint8(uint32(0x3C)+23) != 0x21 // PE and not a DLL
        and all of them
}

rule CrowdStrike_CSIT_15123_01 : msger config 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "msger configuration data"
        reports = "CSIT-15123"
        version = "201807301159"
        last_modified = "2018-07-30"
        malware_family = "msger"
    condition:
        (uint16(0) == 0x5A4D) and (uint32(uint32(0x3C)) == 0x00004550) // PE (DLL or not)
        and (uint32(filesize-408) > 0x0000 and uint32(filesize-408) < 0xFFFF)
        and for all field_offset in (508,304,204):(
        (uint8(filesize-(field_offset+1)) == 0x00)
        and (uint8(filesize-(field_offset+2)) == 0x00)
        and for all i in (0..2):(
        (
        (uint8(filesize-field_offset+i) >= 0x62 and uint8(filesize-field_offset+i) <= 0x7a) // a..z
        or (uint8(filesize-field_offset+i) >= 0x41 and uint8(filesize-field_offset+i) <= 0x5a) // A..Z
        or (uint8(filesize-field_offset+i) >= 0x30 and uint8(filesize-field_offset+i) <= 0x39) // 0..9
        or (uint8(filesize-field_offset+i) == 0x3d) // =
        or (uint8(filesize-field_offset+i) == 0x2f) // /
        or (uint8(filesize-field_offset+i) == 0x2b) // +
        )
        )
        )
}

rule CrowdStrike_CSIT_15123_04 : msger dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "msger dropper DLL"
        reports = "CSIT-15123"
        version = "201807301202"
        last_modified = "2018-07-30"
        malware_family = "msger"
    strings:
        $aplib = { 41 50 33 32 ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? 4d 38 5a } // AP32 ...20... M8Z
        $base64_indicator = "ABCDEFGHIJKLMNOPQRSTUVWXYZ"
        $self_destruct = "cmd.exe /c ping 127.0.0.1 -n 5&cmd.exe /c del /a /f"
        $netsvcs = "%SystemRoot%\\System32\\svchost.exe -k netsvcs"
        $registry_key = "SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\SvcHost"
        $deflate = "deflate 1.1.4 Copyright 1995-2002 Jean-loup Gailly"
    condition:
        uint16(0) == 0x5A4D and uint32(uint32(0x3C)) == 0x00004550 and uint8(uint32(0x3C)+23) == 0x21 // PE DLL
        and all of them
}

rule CrowdStrike_CSIT_15123_03 : msger rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "msger RAT"
        reports = "CSIT-15123"
        version = "201807301205"
        last_modified = "2018-07-30"
        malware_family = "msger"
    strings:
        $base64 = "!\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~"
        $weekdays = "SunMonTueWedThuFriSat"
        $months = "JanFebMarAprMayJunJulAugSepOctNovDec"
        $message = "the file downloaded successfully"
        $self_destruct = "cmd /c \" net stop %s & sc delete %s "
        $str_template = "%02X-%02X-%02X-%02X-%02X-%02X"
        $registry = "\\Software\\Microsoft\\Windows\\CurrentVersion\\Internet Settings"
        $user_agent = "Mozilla/4.0 (compatible; MSIE 8.0; Win32)"
        $url_template_1 = "http://%s:%d/lib/common.asp?action=user_login&uid=%s&lan=%s&hname=%s&uname=%s&os=%s&proxy=%s"
        $url_template_2 = "/lib/common.asp?action=user_upload&file=%s"
        $url_template_3 = "http://%s:%d/data/%s.1000001000"
        $url_template_4 = "http://%s:%d/lib/common.asp?action=user_cmd&uid=%s&del=true"
        $url_template_5 = "http://%s:%d/lib/common.asp?action=verify"
        $status_1 = "downloaded"
        $status_3 = "uploaded"
        $status_6 = "was successfully compressed"
        $status_7 = "compressed failed"
        $status_8 = "is successfully be extracted"
        $status_9 = "extracted failed"
    condition:
        uint16(0) == 0x5A4D and uint32(uint32(0x3C)) == 0x00004550 and uint8(uint32(0x3C)+23) == 0x21 // PE DLL
        and all of them
}

rule CrowdStrike_CSIT_15123_02 : msger rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "msger RAT"
        reports = "CSIT-15123"
        version = "201807301206"
        last_modified = "2018-07-30"
        malware_family = "msger"
    strings:
        $campaign_1 = "10011110101110110100010.1000001000"
        $campaign_2 = "10011110101110110100011.1000001000"
        $message_1 = "[%s->%s] the file was successfully compressed !"
    condition:
        any of them
}

rule CrowdStrike_CSIT_15110_01 : oceanlotus dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "OceanLotus dropper"
        reports = "CSIT-15110"
        version = "201511020000"
        last_modified = "2015-11-02"
        malware_family = "OceanLotus"
    strings:
        // Encrypted Tencent\QQ\Plugin\Com.Tencent.DirectShow
        $ = { d4 80 e5 80 ee 80 e3 80 e5 80 ee 80 f4 80 dc 80 d1 80 d1 80 dc 80 d0 80 ec 80 f5 80 e7 80 e9 80 ee 80 dc 80 c3 80 ef 80 ed 80 ae 80 d4 80 e5 80 ee 80 e3 80 e5 80 ee 80 f4 80 ae 80 c4 80 e9 80 f2 80 e5 80 e3 80 f4 80 d3 80 e8 80 ef 80 f7 80 }
        // Encrypted Bundle.rdb
        $ = { c2 80 f5 80 ee 80 e4 80 ec 80 e5 80 ae 80 f2 80 e4 80 e2 80 }
        // Encrypted QQIntlUdt
        $ = { c2 80 f5 80 ee 80 e4 80 ec 80 e5 80 ae 80 f2 80 e4 80 e2 80 }
    condition:
        any of them
}

rule CrowdStrike_CSIT_15110_02 : oceanlotus loader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "OceanLotus RAT loader"
        reports = "CSIT-15110"
        version = "201511020000"
        last_modified = "2015-11-02"
        malware_family = "OceanLotus"
    strings:
        // Encrypted syswow64/msiexec.exe
        $ = "tztxpx75]ntjfyfd/fyf" wide
        // Encrypted system32\msiexec.exe
        $ = "tztufn43]ntjfyfd/fyf" wide
        // Encrypted Program Files (x86)\Internet Explorer\ielowutil.exe
        $ = "Qsphsbn!Gjmft!)y97*]Joufsofu!Fyqmpsfs]jfmpxvujm/fyf" wide
        // Encrypted Program Files\Messenger\msmsgs.exe
        $ = "Qsphsbn!Gjmft]Nfttfohfs]ntntht/fyf" wide
        // Encrypted Program Files (x86)\Internet Explorer\iexplore.exe
        $ = "Qsphsbn!Gjmft!)y97*]Joufsofu!Fyqmpsfs]jfyqmpsf/fyf" wide
        // Encrypted Program Files\Internet Explorer\iexplore.exe
        $ = "Qsphsbn!Gjmft]Joufsofu!Fyqmpsfs]jfyqmpsf/fyf" wide
    condition:
        3 of them
}

rule CrowdStrike_CSIT_15110_03 : oceanlotus rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "OceanLotus RAT"
        reports = "CSIT-15110"
        version = "201511020000"
        last_modified = "2015-11-02"
        malware_family = "OceanLotus"
    strings:
        // Hardcoded beacon message
        $ = { 38 ce 64 01 ba 7f 62 03 42 dd 66 05 f4 db c3 03 07 f8 db 00 13 f1 0e 02 6d e7 4c 01 }
    condition:
        all of them
}

rule CrowdStrike_CSIT_15117_01 : jjdoor downloader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "JJDoor downloader"
        reports = "CSIT-15117"
        version = "201511050000"
        last_modified = "2015-11-05"
        malware_family = "JJDoor"
    strings:
        $HTAHeader = "<HTA:APPLICATION"
        $post_data0 = "action=bbb&data="
        $post_data1 = "action=aaa&data="
        $enc_function = "65,68,79,68,66,46,83,116,114,101,97,109"
    condition:
        all of them
}

rule CrowdStrike_CSIT_15117_02 : jjdoor dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "JJDoor dropper"
        reports = "CSIT-15117"
        version = "201511050000"
        last_modified = "2015-11-05"
        malware_family = "JJDoor"
    strings:
        $ = "cscript /E:vbscript "
        $ = "Dfile2 = "
        $ = "PGh0bWw+DQo8aGVhZD4NCjx0aXRsZT48L3RpdGxlPg0KPHN"
        $ = "A8A8.tmp"
    condition:
        all of them
}

rule CrowdStrike_CSIT_16018_01 : set_powershell loader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Social Engineer Toolkit payload loader"
        reports = "CSIT-16018"
        version = "201511100000"
        last_modified = "2015-11-10"
    strings:
        $ps1 = "$1 = '$c = ''[DllImport(\"kernel32.dll\")]"
        $unicode_ps1 = "$1 = '$c = ''[DllImport(\"kernel32.dll\")]" wide
        $ps2 = "if ($z.Length -gt 1000){$g = $z.Length};"
        $unicode_ps2 = "if ($z.Length -gt 1000){$g = $z.Length};" wide
        $ps3 = "$e = [System.Convert]::ToBase64String([System.Text.Encoding]::Unicode.GetBytes($1));"
        $unicode_ps3 = "$e = [System.Convert]::ToBase64String([System.Text.Encoding]::Unicode.GetBytes($1));" wide
    condition:
        all of ($unicode*) or all of ($ps*)
}

rule CrowdStrike_CSIT_16018_02 : loader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Powershell payload loader string with initial base64 content."
        reports = "CSIT-16018"
        version = "201511100000"
        last_modified = "2015-11-10"
    strings:
        $ = "winecho."
        $ = "powershell -nop -win hidden -noni -enc JAAxACAAPQAgA"
    condition:
        uint16(0) == 0x5A4D and all of them
}

rule CrowdStrike_CSIT_16018_03 : loader metasploit 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Metasploit payload loader"
        reports = "CSIT-16018"
        version = "201904170754"
        last_modified = "2019-04-17"
        malware_family = "Metasploit"
    strings:
        $ps = "0xfc,0xe8,0x89,0x00,0x00,0x00,0x60,0x89,0xe5,0x31,0xd2,0x64,0x8b,0x52,0x30,0x8b,0x52,0x0c,0x8b,0x52,0x14,0x8b,0x72,0x28,0x0f,0xb7,0x4a" wide
        $shellcode = { 31 c0 ac 3c 61 7c 02 2c 20 c1 cf 0d 01 c7 e2 f0 52 57 }
    condition:
        any of them
}

rule CrowdStrike_CSIT_15119_01 : rocket_kitten mpk bot 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "ROCKET KITTEN MPK Toolkit IRC variant"
        reports = "CSIT-15119"
        version = "201511110000"
        last_modified = "2015-11-11"
        actor = "ROCKET KITTEN"
        malware_family = "MPK"
    strings:
        $ = "<<mpk>>"
        $ = "PRIVMSG %s :!%s %s%s%s%s%s%d%s"
        $ = "!SendkeyLogToServer"
        $ = "!ExeCuteFile"
    condition:
        all of them
}

rule CrowdStrike_CSIT_15117_03 : jjdoor 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "JJDoor Cleanup Script"
        reports = "CSIT-15117"
        version = "201511120000"
        last_modified = "2015-11-12"
        malware_family = "JJDoor"
    strings:
        $ = "Dfile2 = "
        $ = "CreateObject(\"scripting.filesystemobject\").Deletefile Dfile2"
    condition:
        all of them
}

rule CrowdStrike_CSIT_15118_01 : ngen_rat rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "NGEN RAT"
        reports = "CSIT-15118"
        version = "201911141954"
        last_modified = "2019-11-14"
        malware_family = "NGEN RAT"
    strings:
        $xor_key_1 = "98EFucEF"
        $xor_key_2 = "12ABCEF161FS31611213121D3SFAS6E1F"
        $xor_key_3 = "UE5SDF"
        $xor_key_4 = "985SDF"
        $str_setmytime = "SetMyTime"
        $str_mytmp = "MyTmpFile.Dat"
        $str_fsend_s = "FSEND_SUCCESS_02"
        $str_fsend_e = "FSEND_ERROR_01"
        $str_cookie = "Cookie: 1aTnvmM="
        $str_process_1 = "ProcessCmd recv success!"
        $str_process_2 = "ProcessCmd recv error!"
        $str_dll_libcon = "libcon.dll"
        $str_uahost =  "User-Agent: %sHost: %s"
        $str_ip = "Ip not get!"
    condition:
        2 of them
}

rule CrowdStrike_CSIT_15120_02 : charming_kitten key parastoo 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "CHARMING KITTEN Parastoo implant variant with specific AES key"
        reports = "CSIT-15120"
        version = "202003241516"
        last_modified = "2020-03-24"
        actor = "CHARMING KITTEN"
        malware_family = "Parastoo"
    strings:
        $key = "agkrhfpdbvhdhrkj"
        $sbox = { 63 7c 77 7b f2 6b 6f c5 30 01 67 2b fe d7 ab 76 }
    condition:
        all of them
}

rule CrowdStrike_CSIT_15120_01 : charming_kitten parastoo rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "CHARMING KITTEN Parastoo RAT rule updated to cover all variants"
        reports = "CSIT-15120"
        version = "201511180000"
        last_modified = "2015-11-18"
        actor = "CHARMING KITTEN"
        malware_family = "Parastoo"
    strings:
        $format = "%s %s :"
        $name = "my name is"
        $led = "%s %s : %s %d LED= %s"
    condition:
        all of them
}

rule CrowdStrike_CSIT_16013_01 : rebel_jackal exploit cve_2014_4726 perl 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "exp.pl attack script"
        reports = "CSIT-16013"
        version = "201511180000"
        last_modified = "2015-11-18"
        actor = "REBEL JACKAL"
    strings:
        $ = "admin-post.php?page=wysija_campaigns&action=themes"
        $ = "gassrini.zip"
        $ = "[ERROR] Not Defaced Mr.Gassrini"
        $ = "zokometheme"
    condition:
        all of them
}

rule CrowdStrike_CSIT_16013_02 : dropper php rebel_jackal 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "herewego.php dropper script"
        reports = "CSIT-16013"
        version = "201904191704"
        last_modified = "2019-04-19"
        actor = "REBEL JACKAL"
    strings:
        $ = "fallagassrini.xx.tn/w.txt"
        $ = "$open0 = fopen($check0,"
        $ = "$text = http_get"
    condition:
        all of them
}

rule CrowdStrike_CSIT_16013_03 : rebel_jackal webshell 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "REBEL JACKAL webshell"
        reports = "CSIT-16013"
        version = "201511180000"
        last_modified = "2015-11-18"
        actor = "REBEL JACKAL"
    strings:
        $ = "jok Shell - Took the Best made it Better"
        $ = "7da205bfd13d1d7821fe2234dc7e91ee"
        $ = "b47chguru"
    condition:
        all of them
}

rule CrowdStrike_CSIR_16004_02 : corebot bot unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "PDB strings included in memory dump of main Core Bot component"
        reports = "CSIR-16004"
        version = "201511260000"
        last_modified = "2015-11-26"
        malware_family = "Core Bot"
    strings:
        $x86 = "C:\\work\\itco\\core\\bin\\x86\\Release\\core.pdb"
        $x64 = "C:\\work\\itco\\core\\bin\\x64\\Release\\core.pdb"
    condition:
        1 of them
}

rule CrowdStrike_CSIR_16004_04 : corebot bot 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Generic detection for Core Bot plugins"
        reports = "CSIR-16004"
        version = "201511260000"
        last_modified = "2015-11-26"
        malware_family = "Core Bot"
    strings:
        //PluginInit,0,PluginUninit,0
        $init = { 50 6c 75 67 69 6e 49 6e 69 74 00 50 6c 75 67 69 6e 55 6e 69 6e 69 74 00 }
    condition:
        all of them
}

rule CrowdStrike_CSIR_16004_05 : corebot bot tasking credential_theft 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Core Bot password stealer plugin"
        reports = "CSIR-16004"
        version = "201511260000"
        last_modified = "2015-11-26"
        malware_family = "Core Bot"
    strings:
        $format = "%8X-%4hX-%4hX-%2hX%2hX-%2hX%2hX%2hX%2hX%2hX%2hX"
        $firefox = "stealer.firefox"
        $done = "stealer.done"
        $outlook = "outlook account manager passwords" wide
        $mozilla = "@mozilla.org/security/x509certdb;1"
        $cuteftp = "Software\\GlobalSCAPE\\CuteFTP" wide
    condition:
        4 of them
}

rule CrowdStrike_CSIR_16004_06 : corebot bot tasking 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Core Bot MITM web inject plugin"
        reports = "CSIR-16004"
        version = "201511260000"
        last_modified = "2015-11-26"
        malware_family = "Core Bot"
    strings:
        $mitmname = "mitm.conf_name"
        $workdir = "core.work_dir"
        $botnet = "%BOTNET%"
        $sessid = "%%sess_id%%"
        $edge = "MicrosoftEdgeCP.exe" wide
        $injformat = "injected to pid: %d, name: %s, version: %s"
    condition:
        4 of them
}

rule CrowdStrike_CSIR_16004_01 : corebot bot loader unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "PDB strings included in memory dump of Core Bot loader"
        reports = "CSIR-16004"
        version = "201807300840"
        last_modified = "2018-07-30"
        malware_family = "Core Bot"
    strings:
        $x86 = "C:\\work\\itco\\core\\bin\\x86\\Release\\loader.pdb"
        $x64 = "C:\\work\\itco\\core\\bin\\x64\\Release\\loader.pdb"
    condition:
        1 of them
}

rule CrowdStrike_CSIR_16004_03 : corebot bot 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Strings found in Core Bot main module"
        reports = "CSIR-16004"
        version = "201807271858"
        last_modified = "2018-07-27"
        malware_family = "Core Bot"
    strings:
        $guid = "%08x-%04x-%04x-%02x%02x-%02x%02x%02x%02x%02x%02x"
        $params = ".params"
        $init = "PluginInit"
        $uninit = "PluginUninit"
        $stop = "._stopped"
        $mutex = "62DFDF4F-C9F7-4416-9688-41C7791D0C33"
        $workdir = "core.work_dir"
    condition:
        4 of them
}

rule CrowdStrike_CSIT_16017_01 : turbine_panda plugx loader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects variant of PlugX loader DLL used by TURBINE PANDA"
        reports = "CSIT-16017"
        version = "201512030000"
        last_modified = "2015-12-03"
        actor = "TURBINE PANDA"
        malware_family = "PlugX"
    strings:
        $msg_1 = "thank you!"
        $msg_2 = "install complete!"
        $virtalloc = { c7 45 e8 56 69 72 74 }
        $sleep = { 6a ff ff 15 0c 20 00 10 }
    condition:
        2 of them and filesize <= 5KB
}

rule CrowdStrike_CSIT_15126_01 : omnirat rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "OmniRAT desktop client"
        reports = "CSIT-15126"
        version = "201512050000"
        last_modified = "2015-12-05"
        malware_family = "OmniRAT"
    strings:
        // RAT Commands
        $cmd_1 = "SystemInformation.class"
        $cmd_2 = "DriveInformation.class"
        $cmd_3 = "Processes.class"
        $cmd_4 = "TransferFile.class"
        $cmd_5 = "Location.class"
        $libs_1 = "webcam-capture-"
        $libs_2 = "slf4j-api-"
        $libs_3 = "JNativeHook.jar"
        $libs_4 = "bridj-"
    condition:
        // JAR Header
        uint16(0) == 0x4b50 and (2 of ($libs_*)) and (3 of ($cmd_*))
}

rule CrowdStrike_CSIT_16015_01 : milmanbag rat velvet_chollima 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Milmanbag RAT"
        reports = "CSIT-16015"
        version = "201812051519"
        last_modified = "2018-12-05"
        actor = "VELVET CHOOLLIMA"
        malware_family = "Milmanbag"
    strings:
        $ = "urlhash=&rememberme=0&longsession=0&httpssession=0&jan_offset=-28800&jun_offset=-25200&cors_capable=0&user="
        $ = { ca e0 ea ed fc f4 b9 f0 ea b9 ce f0 f7 ae b8 b8 b8 00 }
        $ = { ca e0 ea ed fc f4 b9 f0 ea b9 c1 c9 b8 b8 b8 00 }
        $ = { da f6 f4 e9 ec ed fc eb b9 f7 f8 f4 fc a3 b9 bc 00 }
        $ = { d8 fa fa fc e9 ed b4 d5 f8 f7 fe ec f8 fe fc a3
        b9 f2 f6 b4 d2 cb b5 f2 f6 a2 e8 a4 a9 b7 a1 b5
        fc f7 b4 cc ca a2 e8 a4 a9 b7 af b5 fc f7 a2 e8
        a4 a9 b7 ad }
        $ = { d8 fa fa fc e9 ed b4 da f1 f8 eb ea fc ed a3 b9
        ee f0 f7 fd f6 ee ea b4 a0 ad a0 b5 ec ed ff b4
        a1 a2 e8 a4 a9 b7 ae b5 b3 a2 e8 a4 a9 b7 aa }
        $ = { ec eb f5 f1 f8 ea f1 a4 bf eb fc f4 fc f4 fb fc
        eb f4 fc a4 a9 bf f5 f6 f7 fe ea fc ea ea f0 f6
        f7 a4 a9 bf f1 ed ed e9 ea ea fc ea ea f0 f6 f7
        a4 a9 bf f3 f8 f7 c6 f6 ff ff ea fc ed a4 b4 ab
        a1 a1 a9 a9 bf f3 ec f7 c6 f6 ff ff ea fc ed a4
        b4 ab ac ab a9 a9 bf fa f6 eb ea c6 fa f8 e9 f8
        fb f5 fc a4 a9 bf ec ea fc eb a4 }
        $ = { cb fc ff fc eb fc eb a3 b9 f1 ed ed e9 a3 b6 b6
        f4 f8 f0 f5 b7 fb fe b6 ba f4 fc ea ea f8 fe fc
        b6 f0 f7 fb f6 e1 b6 a8 b6 }
        $ = { cb fc ff fc eb fc eb a3 b9 f1 ed ed e9 a3 b6 b6
        f4 f8 f0 f5 b7 fb fe b6 f8 ec ed f1 b6 f5 f6 fe
        f6 ec ed b6 }
        $ = { ff f8 ea f0 f6 f7 f4 f8 f7 d9 f4 f8 f0 f5 b7 fb
        fe }
        $ = { f0 f6 e9 a8 a8 a9 a8 a8  ab d9 f1 f6 ed f4 f8 f0
        f5 b7 fa f6 f4 }
    condition:
        any of them
}

rule CrowdStrike_CSIT_16017_02 : turbine_panda plugx shellcode 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects variants of PlugX shellcode file used by TURBINE PANDA"
        reports = "CSIT-16017"
        version = "201512070000"
        last_modified = "2015-12-07"
        actor = "TURBINE PANDA"
        malware_family = "PlugX"
    strings:
        $op1 = { eb 12 5e b9 ?? ?? ( 02 | 03 ) 00 80 6c }
        $op2_1 = { e8 ?? ?? 02 00 d9 ?? ?? ( 8c | 36) }
        $op2_2 = { e8 ?? ?? 02 00 da ?? ?? ( 8c | 36) }
        $op2_3 = { e8 ?? ?? 03 00 d9 ?? ?? ( 8c | 36) }
        $op2_4 = { e8 ?? ?? 03 00 da ?? ?? ( 8c | 36) }
    condition:
        (($op1 at 0) or ($op2_1 at 0) or ($op2_2 at 0) or ($op2_3 at 0) or ($op2_4 at 0)) and filesize <= 300KB
}

rule CrowdStrike_CSIT_16017_03 : turbine_panda plugx rat unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects in-memory PlugX variant used by TURBINE PANDA"
        reports = "CSIT-16017"
        version = "201512070000"
        last_modified = "2015-12-07"
        actor = "TURBINE PANDA"
        malware_family = "PlugX"
    strings:
        $king = "KingOfPhantom0308_20140826" ascii
        $reg = "Software\\CLASSES\\FAST" wide
        $post = "/update?id=%8.8x"
    condition:
        all of them
}

rule CrowdStrike_CSIT_16001_01 : defex rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Defex new DLL exports"
        reports = "CSIT-16001"
        version = "201512090000"
        last_modified = "2015-12-09"
        malware_family = "Defex"
    strings:
        $exports = { 50 79 74 68 6f 6e 54 68 72 65 61 64 53 74 61 72
        74 00 50 79 74 68 6f 6e 54 68 72 65 61 64 53 74
        6f 70 00 }
    condition:
        $exports
}

rule CrowdStrike_CSIT_16001_02 : defex rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Defex new DLL strings"
        reports = "CSIT-16001"
        version = "201512090000"
        last_modified = "2015-12-09"
        malware_family = "Defex"
    strings:
        $profile = "PreferredProfile"
        $regkey = "SOFTWARE\\Microsoft\\Windows Update Reporting"
        $mutex = "BitsAppSingleInstanceObject"
        $key = "8b4a4a541435080"
        $marker = "****==7f7e7d"
        $format = "cmd /c ping 8.8.8.8 & sc delete \"%s"
    condition:
        3 of them
}

rule CrowdStrike_CSIT_16001_03 : defex rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Defex DLL exports"
        reports = "CSIT-16001"
        version = "201512110000"
        last_modified = "2015-12-11"
        malware_family = "Defex"
    strings:
        $cmd03 = "$$03"
        $cmd04 = "$$04"
        $cmd06 = "$$06"
        $cmd07 = "$$07"
        $cmd09 = "$$09"
        $cmd11 = "$$11"
        $cmd12 = "$$12"
        $cmd16 = "$$16"
        $cmd17 = "$$17"
        $api = "InternetCrackUrlA"
    condition:
        (5 of ($cmd*)) and $api
}

rule CrowdStrike_CSIT_16002_01 : genuinedns_rat rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "GenuineDNS RAT"
        reports = "CSIT-16002"
        version = "201911141955"
        last_modified = "2019-11-14"
        malware_family = "GenuineDNS RAT"
    strings:
        $str_updata = "updata.dll" ascii wide
        $str_winconfig = "winconfig.cof" ascii wide
        $str_ipnot = "Ip not get!"
        $str_taskkill = "taskkill /f /im updrgui.exe"
        $str_mycmd = "mycmd"
        $dns_api = "DnsQuery_A"
        $dns_g_1 = "8.8.8.8"
        $dns_g_2 = "8.8.4.4"
    condition:
        4 of them
}

rule CrowdStrike_CSIT_16014_01 : voodoo_bear passkilldisk wiper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "PassKillDisk disk wiping tool"
        reports = "CSIT-16014"
        version = "201601010000"
        last_modified = "2016-01-01"
        actor = "VOODOO BEAR"
        malware_family = "PassKillDisk"
    strings:
        $ = "/c format %c: /Y /X /FS:NTFS"
        $ = ".exe.sys.drv.doc.docx.xls.xlsx.mdb.ppt.pptx.xml.jpg.jpeg.ini.inf.ttf"  wide
        $ = ".dll.exe.xml.ttf.nfo.fon.ini.cfg.boot.jar"    wide
        $ = ".crt.bin.exe.db.dbf.pdf.djvu.doc.docx.xls.xlsx.jar.ppt.pptx.tib.vhd.iso.lib.mdb.accdb.sql.mdf.xml.rtf.ini.cfg.boot.txt.rar.msi.zip.jpg.bmp.jpeg.tiff" wide
        $tempfilename = "%ls_%ls_%ls_%d.~tmp"  ascii wide
    condition:
        2 of them
}

rule CrowdStrike_CSIT_16011_01 : backdoored_dropbear 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Backdoored version of Dropbear"
        reports = "CSIT-16011"
        version = "201601030000"
        last_modified = "2016-01-03"
        malware_family = "Backdoored Dropbear"
    strings:
        $dropbear0 = "Dropbear server"
        $dropbear1 = "Auth succeeded with"
        $password = "passDs5Bu9Te7"
        $rsa_key = "rsa-key-20131121"
    condition:
        all of ($dropbear*) and ($password or $rsa_key)
}

rule CrowdStrike_CSIT_13040_01 : cozy_bear miniduke downloader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Downloader used to download MiniDuke RAT"
        reports = "CSIT-13040"
        version = "201807251357"
        last_modified = "2018-07-25"
        actor = "COZY BEAR"
        malware_family = "MiniDuke"
    strings:
        $sig_3 = { 01 ?? 24 } // add [esp], reg32
        // API is moved to the stack in 4 byte parts
        // Breaking out different opcodes due to limitation in Yara <=1.7.2.
        $part_VirtualProtect_1_1 = {  68 63 74 00 00 } // 'ct\0\0'
        $part_VirtualProtect_1_2 = { C7 04 ?? 63 74 00 00 } // 'ct\0\0'
        $part_VirtualProtect_2_1 = { 68 72 6F 74 65 } // 'rote'
        $part_VirtualProtect_2_2 = { C7 04 ?? 72 6F 74 65 } // 'rote'
        $part_VirtualProtect_3_1 = { 68 75 61 6C 50 } // 'ualP'
        $part_VirtualProtect_3_2 = { C7 04 ?? 75 61 6C 50 } // 'ualP'
        $part_VirtualProtect_4_1 = { 68 56 69 72 74 } // 'Virt'
        $part_VirtualProtect_4_2 = { C7 04 ?? 56 69 72 74 } // 'Virt'
        $part_LdrLoadDll_1_1 = { 68 6C 6C 00 00 } // 'll\0\0'
        $part_LdrLoadDll_1_2 = { C7 04 ?? 6C 6C 00 00 } // 'll\0\0'
        $part_LdrLoadDll_2_1 = { 68 6F 61 64 44 } // 'oadD'
        $part_LdrLoadDll_2_2 = { C7 04 ?? 6F 61 64 44 } // 'oadD'
        $part_LdrLoadDll_3_1 = { 68 4C 64 72 4C } // 'LdrL'
        $part_LdrLoadDll_3_2 = { C7 04 ?? 4C 64 72 4C } // 'LdrL'
        $part_Kernel32_1_1 =  { 68 33 00 32 00 } //"32" wide
        $part_Kernel32_1_2 =  { C7 04 ?? 33 00 32 00 } //"32" wide
        $part_Kernel32_2_1 =  { 68 65 00 6c 00 } //"el" wide
        $part_Kernel32_2_2 =  { C7 04 ?? 65 00 6c 00 } //"el" wide
        $part_Kernel32_3_1 =  { 68 72 00 6e 00 } //"rn" wide
        $part_Kernel32_3_2 =  { C7 04 ?? 72 00 6e 00 } //"rn" wide
        $part_Kernel32_4_1 =  { 68 6b 00 65 00 } //"ke" wide
        $part_Kernel32_4_2 =  { C7 04 ?? 6b 00 65 00 } //"ke" wide
        $decrypt_string = { D2 C0 } // rol al, cl
    condition:
        // MZ signature at offset 0
        uint16(0) == 0x5A4D and
        // PE signature at 'lfa_new' offset
        uint32(uint32(0x3c)) == 0x4550 and
        // MajorLinkerVersion == 7
        uint8(uint32(0x3c) + 0x1a) == 7 and
        4 of ($part_VirtualProtect_*) and 3 of ($part_LdrLoadDll_*) and 3 of ($part_Kernel32_*) and $decrypt_string and $sig_3
}

rule CrowdStrike_CSIR_14007_10 : berserk_bear rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Rule identifying mutexes used by BERSERK BEAR malware"
        reports = "CSIR-14007"
        version = "201601050000"
        last_modified = "2016-01-05"
        actor = "BERSERK BEAR"
    strings:
        $reg1a = /{[0-9]{3}-[0-9]{2}-FOOT?BO[A-Z]{1,3}-[0-9]{2}}/ ascii
        $reg1w = /{[0-9]{3}-[0-9]{2}-FOOT?BO[A-Z]{1,3}-[0-9]{2}}/ wide
    condition:
        any of them
}

rule CrowdStrike_CSIT_13114_03 : anchor_panda downloader tornrat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "ANCHOR PANDA TornRAT downloader"
        reports = "CSIT-13114"
        version = "202005141324"
        last_modified = "2020-05-14"
        actor = "ANCHOR PANDA"
        malware_family = "TornRAT"
    strings:
        $subxor = { 8a 14 30 32 ?? 2a ?? 32 ?? 88 14 30 }
        $addxor = { 8a 14 30 32 ?? 02 ?? 32 ?? 88 14 30 }
    condition:
        all of them
}

rule CrowdStrike_CSIT_16030_01 : extreme_jackal nedworm rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "NeDWorm RAT"
        reports = "CSIT-16030"
        version = "201908202016"
        last_modified = "2019-08-20"
        actor = "EXTREME JACKAL"
        malware_family = "NeDWorm"
    strings:
        // SOFTWARE\Microsoft\Windows\CurrentVersion\Run
        $encrypted_string_0 = { 7e 00 63 01 6d 02 7e 03 7e 04 69 05 75 06 63 07 79 08 69 09 4a 0a 41 0b 53 0c 4f 0d 6c 0e 71 0f 7b 10 68 11 47 12 4d 13 70 14 76 15 73 16 79 17 62 18 67 19 4f 1a 51 1b 64 1c 62 1d 7d 1e 6b 1f 63 20 78 21 5d 22 6f 23 7b 24 7b 25 6e 26 69 27 6b 28 58 29 51 2a 77 2b 6f 2c }
        // SELECT Caption FROM Win32_OperatingSystem
        $encrypted_string_1 = { 7a 00 6d 01 6b 02 63 03 66 04 70 05 03 06 61 07 40 08 50 09 6b 0a 77 0b 72 0c 72 0d 3b 0e 5c 0f 4b 10 57 11 5a 12 36 13 42 14 7d 15 7d 16 21 17 23 18 4f 19 40 1a 7e 1b 68 1c 7e 1d 6a 1e 7e 1f 60 20 66 21 60 22 55 23 7c 24 77 25 77 26 67 27 6c 28 }
        // defeat for quasa
        $str_quasar_xclient = "xClient"
    condition:
        all of ($encrypted_*) and not $str_quasar_xclient
}

rule CrowdStrike_CSIT_16014_02 : passkilldisk artifact 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Potentially destroyed file generated by PassKillDisk"
        reports = "CSIT-16014"
        version = "201601080000"
        last_modified = "2016-01-08"
        actor = "VOODOO BEAR"
        malware_family = "PassKillDisk"
    strings:
        $start = { 29 23 be 84 e1 6c d6 ae 52 90 49 f1 f1 bb e9 eb b3 a6 db 3c 87 0c 3e 99 24 5e 0d 1c 06 b7 47 de b3 12 4d c8 43 bb 8b a6 1f 03 5a 7d 09 38 25 1f }
    condition:
        $start at 0
}

rule CrowdStrike_CSIT_16003_01 : potao rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Potao malware"
        reports = "CSIT-16003"
        version = "201601140000"
        last_modified = "2016-01-14"
        malware_family = "Potao"
    strings:
        // Class names used to hold dynamic imports
        $import_kernel32 = "?AVKernel32Import"
        $import_dll = "?AVDllImport"
        $import_secur32 = "?AVSecur32Import"
        $import_ntdll = "?AVNtDllImport"
        $import_crypt32 = "?AVCrypt32Import"
        $xor_loop_1 = { 8b c1 83 e0 03 8a 90 ?? ?? ?? 00 8a 84 0e ?? ??
        ?? 00 32 c2 88 81 ?? ?? ?? 00 75 06 88 91 ?? ??
        ?? 00 41 3b cf 7c d9 }
        $xor_loop_2 = { 8b cf 81 e1 03 00 00 80 79 05 49 83 c9 fc 41 8a
        94 38 ?? ?? ?? 00 8a 99 ?? ?? ?? 00 32 d3 88 97
        ?? ?? ?? 00 75 06 88 9f ?? ?? ?? 00 47 3b 7d fc
        7c ce }
        $xor_loop_3 = { 8b 45 fc 0f be 0c 10 8b 55 f4 0f be 82 ?? ?? ??
        00 33 c1 8b 4d f4 88 81 ?? ?? ?? 00 }
    condition:
        (3 of ($import_*)) or (any of ($xor_loop_*))
}

rule CrowdStrike_CSIT_16005_01 : zeroaccess bot dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "PNG header from ZeroAccess3 dropper resource"
        reports = "CSIT-16005"
        version = "201601200000"
        last_modified = "2016-01-20"
        malware_family = "ZeroAccess"
    strings:
        // PNG header in resource
        $ = { 89 50 4e 47 0d 0a 1a 0a 00 00 00 0d 49 48 44 52
        00 00 00 10 00 00 04 af 08 06 00 00 00 00 20 7a
        d2 00 00 00 01 73 52 47 42 00 ae ce 1c e9 00 00
        00 04 67 41 4d 41 00 00 b1 8f 0b fc 61 05 00 00
        00 09 70 48 59 73 00 00 0e c3 00 00 0e c3 01 c7
        6f a8 64 00 00 ff a5 49 44 41 54 78 5e ec bc }
        // Decoder loop
        $ = { 8b 02 8d 52 04 33 05 ?? ?? ?? 00 89 01 8d 49 04
        ff 4c 24 14 75 ea 8b f5 8d 44 24 40 50 ff 74 24 }
    condition:
        all of them
}

rule CrowdStrike_CSIT_16005_02 : zeroaccess bot installer 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Cabinet archive with ZeroAccess components"
        reports = "CSIT-16005"
        version = "201601200000"
        last_modified = "2016-01-20"
        malware_family = "ZeroAccess"
    strings:
        $ = { 4d 53 43 46 00 00 00 00 ?? ?? ?? 00 00 00 00 00
        ?? 00 00 00 00 00 00 00 03 01 01 00 06 00 00 00
        4d 42 00 00 ?? 00 00 00 ?? 00 03 15 ?? ?? 00 00
        00 00 00 00 00 00 ?? ?? ?? ?? 20 00 6c 33 32 00 }
        $ = "k32"
        $ = "k64"
        $ = "l32"
        $ = "l64"
        $ = "s32"
        $ = "s64"
    condition:
        all of them
}

rule CrowdStrike_CSIT_16005_03 : zeroaccess bot key 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "ZeroAccess3 RSA Public Key"
        reports = "CSIT-16005"
        version = "201601200000"
        last_modified = "2016-01-20"
        malware_family = "ZeroAccess"
    strings:
        $rsakey32 = {
        06 02 00 00 00 24 00 00  52 53 41 31 00 04 00 00
        01 00 01 00 a9 60 94 60  e1 74 92 3a d6 b9 2a 60
        7e 89 98 29 57 16 01 89  25 36 3b 99 f3 51 b6 f9
        ff d7 2c 2f 1e 98 3b 4e  5e 4a 1b 39 1e 90 97 3b
        48 71 12 4c 74 ed c4 1f  be de da 03 9f c4 0b 66
        52 ef bd bd ea 7f 1f e2  b2 64 c9 08 97 d3 8c 97
        a0 ee c8 28 b1 1a dd 46  bb 7d 01 d1 55 7d b8 e2
        4b 9b fe 66 58 ba 9c 18  58 48 aa aa 69 fd 3e e6
        a6 83 25 da 18 a3 43 ac  49 0a a2 7b ac 98 fc 25
        f7 94 b2 b0
        }
        $rsakey64 = {
        06 02 00 00 00 24 00 00  52 53 41 31 00 04 00 00
        01 00 01 00 e7 44 50 da  57 da 0c 36 a1 fa e6 9f
        f1 87 c4 fc 88 60 ac fe  94 36 ce d6 8b 3d d5 d2
        a9 8a e0 30 30 37 3e c8  ae dd 30 5b dd 3a 62 fc
        6d 79 8f 58 75 3d 83 5a  2f 50 52 da e8 81 e4 d0
        63 b5 96 04 4d d6 89 3e  bd 06 45 42 34 5b 96 f7
        10 c1 fc ca a0 0a a9 3f  3a 1f d0 9e fe e2 91 8f
        13 cc f2 57 b7 90 9f fa  e3 2b c4 69 4b c6 a2 21
        5c 99 c1 d3 43 44 30 0d  d8 eb ed 9a 65 4d 99 33
        57 93 1a fa
        }
    condition:
        any of them
}

rule CrowdStrike_CSIT_16007_01 : netwire rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Netwire RAT"
        reports = "CSIT-16007"
        version = "201601210000"
        last_modified = "2016-01-21"
        malware_family = "Netwire"
    strings:
        $old = "Unable to Open File !"
        $new = "@echo off"
        $mozcreds = "NSSBase64_DecodeBuffer"
        $lsaenum = "LsaEnumerateLogonSessions"
        $kl_format = "[%s] - [%.2d/%.2d/%d %.2d:%.2d:%.2d]"
        $stub_path = "StubPath"
        $identifier = ".Identifier"
    condition:
        4 of them
}

rule CrowdStrike_CSIT_17022_02 : winapp10rat dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Dropper payload creating downloader"
        reports = "CSIT-17022"
        version = "201807271424"
        last_modified = "2018-07-27"
        malware_family = "WinApp10Rat"
    strings:
        $message_1 = "Error parsing script text" wide
        $message_2 = "Error running the script" wide
        $message_3 = "Error getting script dispatch" wide
        $path_fragment = "\\darrius\\" wide
        $filename_artefact = "MSUPDATE3.exe" wide
    condition:
        all of them
}

rule CrowdStrike_CSIT_17022_01 : delivery_document 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Decoy document containing a WinApp10Rat dropper payload"
        reports = "CSIT-17022"
        version = "201807271423"
        last_modified = "2018-07-27"
        malware_family = "WinApp10Rat"
    strings:
        $doc_magic = { d0 cf 11 e0 a1 b1 1a e1 }
        $message_1 = "This document is protected by Microsoft Office and requires human verification."
        $message_2 = "CANT? VIEW FOLLOW THE STEPS BELOW"
        $dos_magic = "MZ"
    condition:
        $doc_magic at 0
        and any of ($message_*)
        and for 1 i in (1..#dos_magic) : (uint32(@dos_magic[i] + uint32(@dos_magic[i] + 0x3c)) == 0x00004550)
}

rule CrowdStrike_CSIT_17022_03 : winapp10rat downloader javascript 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Batch/JScript hybrid file used to compile a downloader"
        reports = "CSIT-17022"
        version = "201807271425"
        last_modified = "2018-07-27"
        malware_family = "WinApp10Rat"
    strings:
        $call_to_downloader = "simpledownloader.exe "
        $dotnet_path = "Microsoft.NET\\Framework"
        $compiler_executable = "jsc.exe"
        $std_redirects = ">NUL 2>NUL"
        $jscript_dotnet_import = "import System;"
        $jscript_download = "webClient.DownloadFile"
    condition:
        all of them
}

rule CrowdStrike_CSIT_17022_05 : winapp10rat rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "WinApp10Rat RAT"
        reports = "CSIT-17022"
        version = "201807271424"
        last_modified = "2018-07-27"
        malware_family = "WinApp10Rat"
    strings:
        $pdb_path_component = "WindowsApplication10"
        $dotnet_magic = "BSJB"
        $aes_key = "FuckYou" wide
        $development_arterfact = "My.Application"
        $component_name_timer_1 = { 00 54 69 6d 65 72 31 00 }
        $component_name_timer_2 = { 00 54 69 6d 65 72 32 00 }
        $component_name_timer_3 = { 00 54 69 6d 65 72 33 00 }
        $component_name_timer_4 = { 00 54 69 6d 65 72 34 00 }
    condition:
        all of them
}

rule CrowdStrike_CSIT_17022_04 : winapp10rat downloader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "WinApp10Rat downloader application, not malicious in itself but presence may be indicative of infection"
        reports = "CSIT-17022"
        version = "201807271424"
        last_modified = "2018-07-27"
        malware_family = "WinApp10Rat"
    strings:
        $dotnet_magic = "BSJB"
        $dotnet_stream_1 = "#Strings"
        $dotnet_stream_2 = "#US"
        $dotnet_stream_3 = "#GUID"
        $dotnet_stream_4 = "#Blob"
        $JScriptImport = { 00 4a 53 63 72 69 70 74 49 6d 70 6f 72 74 00 }
        $mscorlib = { 00 6d 73 63 6f 72 6c 69 62 00 }
        $Concat = { 43 6f 6e 63 61 74 00 }
        $DownloadFile = { 00 44 6f 77 6e 6c 6f 61 64 46 69 6c 65 00 }
        $message_1 = "Downloading" wide
        $original_filename = "simpledownloader.exe" wide
    condition:
        all of them and filesize < 6KB
}

rule CrowdStrike_CSIT_16019_01 : voodoo_bear blackenergy delivery_document 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detection for image included in BlackEnergy lure documents"
        reports = "CSIT-16019"
        version = "201602010000"
        last_modified = "2016-02-01"
        actor = "VOODOO BEAR"
        malware_family = "BlackEnergy"
    strings:
        $ = { 77 88 fb bf da 94 bb f7 87 dd fe d4 b8 fc 0f e0 }
    condition:
        any of them
}

rule CrowdStrike_CSIT_16021_01 : archy_rat rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Customised RC4 algorithm seen in ARCHY RAT variant"
        reports = "CSIT-16021"
        version = "201602010000"
        last_modified = "2016-02-01"
        actor = "PUTTER PANDA"
        malware_family = "ARCHY RAT"
    strings:
        // Code fragments for various stages of customized RC4 algorithm
        $sumshift = { 8b 4c 24 04 56 8a 41 0b 02 41 0a 02 01 02 41 40 33 f6 8a 54 31 01 88 14 31 46 83 fe 40 7c f3 88 41 40 5e c3 }
        $bitmod = { 8b 78 0c 8b ce 8b d6 c1 e9 05 c1 ea 04 8b 18 32 ca 8b d7 c1 ea 1e 32 ca 8b d6 32 08 c1 e2 1f d1 eb 0b d3 80 e1 01 89 10 8b 50 08 8b da c1 e3 1f d1 ee 0f b6 c9 0b de 8b f7 c1 e1 1e d1 ef d1 ea c1 e6 1f 0b cf 0b d6 5f 89 58 04 }
        $xorloop = { 0f b6 57 40 25 ff 00 00 00 8a 14 13 03 c3 ff 45 10 8a 08 81 7d 10 00 10 00 00 88 10 0f b6 47 40 88 0c 03 7c bd }
        $fillentbuf = { 80 a4 35 d8 fd fe ff 00 8a 9c 35 d8 fd fe ff 8d 84 35 d8 fd fe ff 33 ff 8b d6 8b cf d3 fa 80 e2 01 32 da 47 83 ff 10 7c ef 46 88 18 81 fe 00 00 01 00 7c cc 33 f6 bb 20 02 00 00 }
    condition:
        any of them
}

rule CrowdStrike_CSIT_16020_01 : ragua dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Ragua RAT dropper"
        reports = "CSIT-16020"
        version = "201602030000"
        last_modified = "2016-02-03"
        malware_family = "Ragua"
    strings:
        $ = "A build of the Microsoft Windows." wide
        $ = "(SO) Microsoft Windows" wide
        $ = ".\\dist\\" wide
        $ = { 55 8b ec 83 ec 5c 83 7d 0c 0f 74 2b 83 7d 0c 46
        8b 45 14 75 0d 83 48 18 10 8b 0d 68 3e 42 00 89
        48 04 50 ff 75 10 ff 75 0c ff 75 08 ff 15 48 72
        40 00 e9 42 01 00 00 53 56 8b 35 70 3e 42 00 8d }
    condition:
        all of them
}

rule CrowdStrike_CSIT_16020_02 : ragua dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Ragua RAT dropper"
        reports = "CSIT-16020"
        version = "201602030000"
        last_modified = "2016-02-03"
        malware_family = "Ragua"
    strings:
        $filename1 = "ruta.txt"
        $filename2 = "caso.txt"
        $sfx = { 80 f9 40 73 16 80 f9 20 73 06 0f ad d0 d3 fa c3
        8b c2 c1 fa 1f 80 e1 1f d3 f8 c3 c1 fa 1f 8b c2
        c3 cc cc cc cc cc cc cc cc cc cc cc cc cc cc cc
        8b 44 24 08 8b 4c 24 10 0b c8 8b 4c 24 0c 75 09 }
    condition:
        ($filename1 or $filename2) and $sfx
}

rule CrowdStrike_CSIT_16012_02 : hworm rat builder 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "H-Worm2 RAT builder/controller"
        reports = "CSIT-16012"
        version = "201602080000"
        last_modified = "2016-02-08"
        malware_family = "H-Worm"
    strings:
        $ = "hworm .:: back after strique ::." wide
        $ = "pass recover by / houdini =-=-=-=-=-=-=-=-=-=-=-=-=-=-=" wide
        $ = "- execution webpassview.exe ..." wide
        $ = "-- error : no dns added , plaise add less one" wide
        $ = "this plugin is already in use , are u wont to send remote plugin ini way ?" wide
        $ = "error : geoip data-file not found !" wide
        $ = "error : webpassview tool not found !" wide
    condition:
        any of them
}

rule CrowdStrike_CSIT_16012_03 : hworm rat dropper vbscript 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "H-Worm2 RAT dropper VBScript"
        reports = "CSIT-16012"
        version = "201602080000"
        last_modified = "2016-02-08"
        malware_family = "H-Worm"
    strings:
        $ = "RESUME NEXT" nocase ascii wide
        $ = "TVpsAAEAAAACAAAA//8AAAAAAAARAAAAQAAAAAAAAABXaW4zMiBQcm9ncmFtIQ0KJLQJugAB" ascii wide
        $ = "AABpcAAAeXAAAItwAACWcAAAqHAAAB4QAABwEgAAUhIAADEQAADnEQAAZHlud3JhcHguZGxs" ascii wide
        $ = "REGSVR32.EXE" nocase ascii wide
        $ = "WSCRIPT.EXE" nocase ascii wide
    condition:
        all of them
}

rule CrowdStrike_CSIT_16012_04 : hworm rat loader shellcode 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "H-Worm2 RAT loader shellcode"
        reports = "CSIT-16012"
        version = "201602080000"
        last_modified = "2016-02-08"
        malware_family = "H-Worm"
    strings:
        $ = { 55 8b ec 83 c4 f8 53 56 57 8b 7d 0c 8b 75 08 8d
        5d fc 33 c0 55 68 ff 50 40 00 64 ff 30 64 89 20
        e8 97 07 00 00 89 03 8b 03 05 20 01 00 00 50 e8
        10 02 00 00 50 e8 2e 02 00 00 50 e8 9c 02 00 00 }
    condition:
        all of them
}

rule CrowdStrike_CSIT_16020_03 : ragua rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Ragua RAT/module file"
        reports = "CSIT-16020"
        version = "201602090000"
        last_modified = "2016-02-09"
        malware_family = "Ragua"
    strings:
        $py2exe_1 = "PYTHONSCRIPT"
        $py2exe_2 = "PY2EXE_VERBOSE"
        $py2exe_3 = "PK"
        $py2exe_4 = "Could not load python dll"
        $ragua_1 = "caso.txt"
        $ragua_2 = "ruta.txt"
        $ragua_3 = "Descargas"
        $ragua_4 = "JavaS.py"
        $ragua_5 = "JavaS.exe"
        $ragua_6 = "leame123.txt"
    condition:
        all of ($py2exe_*) and any of ($ragua_*)
}

rule CrowdStrike_CSIT_16026_03 : trkwks rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "TrkWks RAT characteristic magic bytes in network traffic"
        reports = "CSIT-16026"
        version = "201602100000"
        last_modified = "2016-02-10"
        malware_family = "TrkWks"
    strings:
        $FIB06 = { 46 49 42 06 0d 0a }
        $FIB05 = { 46 49 42 05 0d 0a }
        $FIB04 = { 46 49 42 04 0d 0a }
    condition:
        all of them
}

rule CrowdStrike_CSIT_16026_04 : trkwks rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "TrkWks characteristic function to adapt the timestamps of files"
        reports = "CSIT-16026"
        version = "201602100000"
        last_modified = "2016-02-10"
        malware_family = "TrkWks"
    strings:
        $setfiletimes = { ff 15 ?? ?? ?? ?? 8b 44 24 60 8b 35 ?? ?? ?? ??
        50 ff d6 8b 4c 24 68 66 89 44 24 2c 51 ff d6 8b
        54 24 70 66 89 44 24 32 52 ff d6 66 89 44 24 3a
        8b 44 24 78 50 ff d6 8b 8c 24 80 00 00 00 66 89
        44 24 40 51 ff d6 83 c4 14 66 89 44 24 32 8d 54
        24 20 8d 44 24 28 52 50 ff 15 }
    condition:
        $setfiletimes
}

rule CrowdStrike_CSIT_16026_05 : trkwks rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "TrkWks RAT strings"
        reports = "CSIT-16026"
        version = "201602100000"
        last_modified = "2016-02-10"
        malware_family = "TrkWks"
    strings:
        $ = "\x0a\x0d URL invalidation!\x0a\x0d"
        $ = "\x0a\x0d Download Err!\x0a\x0d"
        $ = "\x0a\x0d Download ok!\x0a\x0d"
        $ = "\x0a\x0d Downloading...\x0a\x0d"
        $ = "\x0a\x0d [+] Wellcome u < %s:%d >, now waiting she comin ...\x0a\x0d"
        $ = "The Server Already Install.\x0a"
        $ = "Test Services..."
        $ = "Create Files ..."
        $ = "Create Services..."
        $ = "Query service failed...:("
        $ = "s t wai p: %d\x0a"
        $ = "s t cli p: %d\x0a"
        $ = "s c p: %d\x0a"
        $ = "s c i: %s\x0a"
        $ = "s b p: %d\x0a"
        $u0 = "\x0a\x0d p Path\x0a\x0d b REBOOT\x0a\x0d d SHUTDOWN\x0a\x0d s SHELL\x0a\x0d f DOWNLOAD FILE\x0a\x0d q QUIT\x0a\x0d"
        $u1 = "Authentication Successfull...\x0d\x0aStarting shell..\x0d\x0a\x0d\x0a"
    condition:
        4 of them or any of ($u*)
}

rule CrowdStrike_CSIT_16023_01 : dungeon_spider locky ransomware unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Locky ransomware, characteristic strings in the unpacked payload"
        reports = "CSIT-16023"
        version = "201602190000"
        last_modified = "2016-02-19"
        actor = "DUNGEON SPIDER"
        malware_family = "Locky"
    strings:
        // HTTP query format strings
        $ = "&length="
        $ = "&failed="
        $ = "&act=stats&path="
        // ransom notice filenames
        $ = "_Locky_recover_instructions.bmp" wide
        $ = "_Locky_recover_instructions.txt" wide
        // suffix for encrypted files
        $ = ".locky" wide
    condition:
        all of them
}

rule CrowdStrike_CSIT_16057_01 : dnstunnel rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detection for DNSTunnel Malware"
        reports = "CSIT-16057"
        version = "201602220000"
        last_modified = "2016-02-22"
        malware_family = "DNSTunnel"
    strings:
        $task_call = "sc weekly"
        $error_msg = "because of error, can not analysis data"
        $usage_msg = "pls input -domain/-ip <param>"
        $path = "dns control\\t-DNSTunnel"
    condition:
        3 of them
}

rule CrowdStrike_CSIT_16025_01 : malumpos pos_scraper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "MalumPOS memory-scraping credit card dumping tool"
        reports = "CSIT-16025"
        version = "201602240000"
        last_modified = "2016-02-24"
        malware_family = "MalumPOS"
    strings:
        $track1 = "((b|B)[0-9]{13,19}\\^[A-Za-z\\s]{0,30}"
        $track2 = "([3-9]{1}[0-9]{14,15}[D=]"
        $pdb = "RegExpr.pas"
        $api1 = "CreateToolhelp32Snapshot"
        $api2 = "Process32Next"
        $api3 = "OpenProcess"
        $api4 = "VirtualQueryEx"
        $api5 = "ReadProcessMemory"
    condition:
        all of them
}

rule CrowdStrike_CSIT_16041_01 : aryan rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Aryan RAT derivative"
        reports = "CSIT-16041"
        version = "201602250000"
        last_modified = "2016-02-25"
        malware_family = "Aryan"
    strings:
        $ = "ServiceMain"
        $ = "%s/?sort=%d"
        $ = "%s/?id="
        $ = "ComSpec"
        $ = "blog/%Y/%m/%d"
    condition:
        all of them
}

rule CrowdStrike_CSIT_16041_02 : aryandropper dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Dropper for an Aryan RAT derivative"
        reports = "CSIT-16041"
        version = "201807181046"
        last_modified = "2018-07-18"
    strings:
        $ = { 81 fd 6a 1e 00 00 }
        $ = { 81 fd 8d 1f 00 00 }
        $ = { 81 fd ed 26 00 00 }
        $ = { 81 fd 10 27 00 00 }
        $ = { 81 fd 24 15 00 00 }
        $ = { 81 fd f7 1a 00 00 }
        $ = { 81 fd 80 0d 00 00 }
        $ = { 81 fd b8 04 00 00 }
    condition:
        all of them
}

rule CrowdStrike_CSIT_16027_01 : iwebrat rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "IWebRAT main payload"
        reports = "CSIT-16027"
        version = "201602290000"
        last_modified = "2016-02-29"
        malware_family = "IWebRAT"
    strings:
        $ = "Content-Disposition: form-data; name=\"m1.jpg\""
        $ = "Content-Type: multipart/form-data; boundary=----=_Part_%x" wide
        $ = { 65 78 69 74 0D 0A 00 }
        $ = "%02X%02X%02x%02x%02x%02x"
        $ = ",,IEHelper" wide
    condition:
        3 of them
}

rule CrowdStrike_CSIT_16042_01 : dipsind rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Dipsind RAT executable"
        reports = "CSIT-16042"
        version = "202001131939"
        last_modified = "2020-01-13"
        malware_family = "Dipsind"
    strings:
        // Characteristic strings
        $str1 = "exitokee!"
        $str1_obfu1 = { 6d 80 71 7c 77 73 6d 6d 29 }
        $str1_obfu2 = { 10 74 29 74 36 3c 2b 7d 56 }
        $str2 = "command okie"
        $str2_obfu1 = { 6b 77 75 75 69 76 6c 28 77 73 71 6d }
        $str2_obfu2 = { 16 63 2d 6d 38 39 2a 38 18 60 35 65 }
        $str3 = "Comds ava: "
        $str3_obfu1 = { 4b 77 75 6c 7b 28 69 7e 69 42 28 }
        $str4_obfu2 = { 36 63 2d 64 2a 77 2f 6e 16 31 7c }
        // XOR key used to obfuscate
        $xor_key = { 75 0c 40 00 59 57 4E 18 77 0b 5c 00 33 0f 41 23
        2b 5b 40 4d 2b 2d 4e 16 58 51 00 57 00 0f 21 0c }
        // AES KEY used to encrypt traffic
        $aes = "AOPSH03SK09POKSID7FF674PSLI91965"
        $aes_obfu1 = { 49 57 58 5b 50 38 3b 5b 53 38 41 58 57 53 5b 51
        4c 3f 4e 4e 3e 3f 3c 58 5b 54 51 41 39 41 3e 3d }
        $aes_obfu2 = { 34 43 10 53 11 67 7d 4b 3c 3b 65 50 7c 44 12 6a
        6f 6c 06 0b 1d 1a 7a 46 0b 1d 49 6e 31 36 17 39 }
    condition:
        any of them
}

rule CrowdStrike_CSIT_16028_01 : installer dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Malicious Nullsoft installer using the System plugin for payload extraction."
        reports = "CSIT-16028"
        version = "201603020000"
        last_modified = "2016-03-02"
    strings:
        $nsishdr = { 04 00 00 00 ef be ad de 4e 75 6c 6c 73 6f 66 74
        49 6e 73 74 ?? ?? 00 00 ?? ?? 0? 00 5d 00 00 80
        00 00 }
        $pehdrtime0 = { 50 45 00 00 4c 01 08 00 19 5e 42 2a 00 00 00 00 }
        $pehdrtime1 = { 50 45 00 00 4c 01 05 00 ?? ?? ?? 54 00 00 00 00 }
        $rsrchdr = { 2e 72 73 72 63 00 00 00 ?? ?? 0? 00 00 ?0 0? 00
        ?? ?? 0? 00 00 ?? 0? 00 00 00 00 00 00 00 00 00 }
    condition:
        $nsishdr
        and $rsrchdr
        and 1 of ($pehdrtime*)
        and uint32(@nsishdr + 20) < 0x3000
        and uint32(@nsishdr + 24) < 0x80000
}

rule CrowdStrike_CSIT_16039_03 : carbon_spider agentorm rat unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Signature for unpacked AgentORM malware"
        reports = "CSIT-16039"
        version = "201807271848"
        last_modified = "2018-07-27"
        actor = "CARBON SPIDER"
        malware_family = "AgentORM"
    strings:
        //Native API for process injection
        $api1 = "ZwWriteVirtualMemory"
        $api2 = "ZwSetContextThread"
        $api3 = "ZwAllocateVirtualMemory"
        //Screen capture capability
        $api4 = "CreateCompatibleBitmap"
        $api5 = "BitBlt"
        //String obfuscation routine code
        $strobf1 = {8A 1F 0F B6 77 01 0F B6 C3 33 F0 8D 46 01}
        $strobf2 = {8A 44 0F 02 32 C3 88 04 11 41 3B CE 7C F2}
        $strobf3 = {0F B6 77 01 0F B6 C3 33 F0 8D 46 01}
    condition:
        (all of ($api*)) and (any of ($strobf*))
}

rule CrowdStrike_CSIT_16032_01 : boss_spider samas ransomware 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Samas ransomware"
        reports = "CSIT-16032"
        version = "201807300932"
        last_modified = "2018-07-30"
        actor = "BOSS SPIDER"
        malware_family = "Samas"
    strings:
        // Strings present in various samples
        $mssam = "MicrosoftSAM" wide fullword
        $help = "HELP_DECRYPT_YOUR_FILES" wide
        $selfdel = "\\selfdel.exe" wide fullword
        $mtaeskey_1 = "<MtAeSKeYForFile>" wide
        $mtaeskey_2 = "<MMtt_AeS_KeY_For_File>" wide
        $ssres = "samsam.Properties.Resources" wide fullword
        $mikores = "MIKOPONI.Properties.Resources" wide fullword
        $adobe = "\\AdobeReder" wide fullword
        // bytes from "drakred" misspelling
        $drakred = "66006F006E007400200063006F006C006F0072003D0022004400720061006B0052006500640022003E" wide
    condition:
        2 of them
}

rule CrowdStrike_CSIT_16043_01 : carbon_spider sekur rat unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Unpacked CARBON SPIDER Sekur malware"
        reports = "CSIT-16043"
        version = "201807271852"
        last_modified = "2018-07-27"
        actor = "CARBON SPIDER"
        malware_family = "Sekur"
    strings:
        $cmd1 = { 87 79 a3 0a }
        $cmd2 = { a5 a8 7a 00 }
        $cmd3 = { bf fa 7c 00 }
        $cmd4 = { c4 33 e5 06 }
        $cmd5 = { 09 45 68 00 }
        $cmd6 = { a5 a8 c6 07 }
        $api1 = { 68 b1 e3 14 06 }
        $api2 = { 68 51 8a 34 0c }
        $api3 = { 68 01 10 8a 00 }
        $api4 = { 68 11 89 d6 0a }
        $api5 = { 68 33 6c d9 07 }
        $api6 = { 68 61 14 e4 0e }
    condition:
        (4 of ($cmd*)) and (4 of ($api*))
}

rule CrowdStrike_CSIT_16030_02 : nedworm rat keylogger 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "NeDWorm Keylogger"
        reports = "CSIT-16030"
        version = "201603210000"
        last_modified = "2016-03-21"
        actor = "EXTREME JACKAL"
        malware_family = "NeDWorm"
    strings:
        $log = "Log created on" wide
        $path = "\\temps" wide
        $keys_0 = "SHIFT-CTRL-ALT-" wide
        $keys_1 = "CTRL-ALT-" wide
        $keys_2 = "ALT-" wide
        $keys_3 = "CTRL-" wide
    condition:
        all of them
}

rule CrowdStrike_CSIT_16037_01 : wonknu trojan 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Wonknu RAT mimicking as Kaspersky Anti-virus"
        reports = "CSIT-16037"
        version = "201807310900"
        last_modified = "2018-07-31"
        malware_family = "Wonknu"
    strings:
        $ = "CmdThreadOver\x0a"
        $ = "recv = %s\x0d\x0a"
        $ = "CreateProcess Error\x0a"
        $ = "Find Errors!\x0a"
        $ = "CmeShell\x0a"
        $ = "UnKnow Command\x0a"
    condition:
        all of them
}

rule CrowdStrike_CSIT_16037_02 : certificate 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "RSA modulus of certificate #1 used to sign Wonknu binaries"
        reports = "CSIT-16037"
        version = "201807271420"
        last_modified = "2018-07-27"
    strings:
        $ = { 00 cf b1 5a 3d 39 bd 37 7c f5 27 df 4a 7e ea
        89 d9 e0 7f 95 66 b8 d4 f3 91 ec 86 fb 5c 40
        03 d0 88 ea 48 41 5e 98 cb 0c 0a be 88 06 cb
        58 4a a0 eb 57 e9 b3 29 13 a0 6b 16 b9 f9 31
        8f bd 23 26 f6 51 36 bf c4 c9 bf 67 06 1a bd
        ba 56 89 17 19 18 09 c7 b7 a3 28 3b 7f 11 85
        52 4a 89 82 f4 57 92 d4 56 8d 06 99 b2 c9 5b
        bb 2f 97 0e 02 f8 ec 07 7a c0 3d 46 f6 52 3a
        12 9f 2b 2d df ba 01 fe 45 f6 97 97 c0 a5 ec
        5e 33 a7 55 54 ef 0d 97 94 7e 8f 58 b6 e7 a2
        18 a7 e4 db 36 e0 71 68 24 49 f5 fb 4d 2e 0b
        00 cc 3f b7 7e fb eb b2 78 ef 48 2e f0 44 88
        3d 0d af f9 76 d8 bc 4c 23 cf fe 5b de 88 2b
        cf 6d f9 c1 a6 82 fc 51 fe 45 1b d7 cc df 40
        fb 76 10 97 70 10 14 dd c3 61 2d d8 50 2e a8
        e6 41 0e 72 06 ac 95 15 7c a4 e3 c4 3a de 34
        50 04 f6 4a 10 6c b3 8a 73 59 49 42 09 53 70
        c8 e1 }
    condition:
        all of them
}

rule CrowdStrike_CSIT_16037_03 : certificate 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "RSA modulus of certificate #2 used to sign Wonknu binaries"
        reports = "CSIT-16037"
        version = "201807271420"
        last_modified = "2018-07-27"
    strings:
        $ = { 00 c7 10 15 bf 0a 07 f8 63 98 d4 6c 1a c3 86
        12 c1 63 34 db bf bc 69 95 2b fc 72 b4 38 1e
        f2 5c 02 27 a8 98 15 a8 f5 4c 25 4a 8d ec f2
        01 c6 22 6b 6f fc 24 24 c5 e6 76 c4 e9 04 63
        2e e0 33 02 c8 de 7a 9a 8b 67 b9 0a d8 23 0c
        e8 bc e4 5b 18 f4 46 89 ac f0 ad 48 d4 c2 42
        4f 4b ef 03 22 80 aa a9 31 cc c0 24 60 1f ec
        55 de 78 0a b2 d1 f8 f4 5c f2 85 54 56 79 df
        a8 83 68 a8 28 f1 33 78 bf 7b f5 02 71 63 0e
        f5 5a b3 9a cc 72 e9 81 bb a6 cf 18 b3 a9 af
        4c cd 82 23 b1 db 1b dc 27 17 bc 9f 42 1f 89
        5f 77 77 dc 98 fd b9 dc f4 4c ef 22 9d 13 8e
        ca c2 7e d8 68 a6 b5 a6 2b df 03 59 52 2c d4
        94 59 26 eb 4f 23 28 8a f1 ce 7e 54 25 6b 2a
        bc 51 d1 28 69 f4 47 06 f5 cf 65 6d 47 97 04
        40 b3 a4 7c b8 1d fa 0c 5f 41 54 d1 fb 63 8a
        10 b7 a5 5b 45 66 0b d3 a1 46 a8 6f a1 85 2f
        89 1d }
    condition:
        all of them
}

rule CrowdStrike_CSIT_16038_01 : certificate wet_panda 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Stolen certificates used in Suckfly operation (WET PANDA activity). As this certificate was stolen for use in signing malicious executables, it may also identified legitimate files - alerts should be correlated with other indicators of malicious activity."
        reports = "CSIT-16038"
        version = "201910101658"
        last_modified = "2019-10-10"
        actor = "WET PANDA"
        malware_family = "Preshin, Backshell, PlugX"
    strings:
        $cn = "BLSoft Co.,Ltd"
        $serial = { 15 09 15 7a e6 03 a7 1a 59 fb ff 31 3b fa e3 81 }
    condition:
        uint16(0) == 0x5a4d and
        $cn and $serial
}

rule CrowdStrike_CSIT_16038_02 : wet_panda preshin rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Preshin variant observed in Suckfly (WET PANDA) activity"
        reports = "CSIT-16038"
        version = "201603300000"
        last_modified = "2016-03-30"
        actor = "WET PANDA"
        malware_family = "Preshin"
    strings:
        $str_errpipe = "error to create pipe!"
        $str_cp_succ = "CreateProcess SUCC"
        $str_dllmem = "RUN DLLMEM THREAD FAIL"
        $str_load = "Load library from memory succ"
        $str_modify = "MODIFYCONFIG SUCC!"
        $dllname = "WorkDll.dll"
    condition:
        2 of them
}

rule CrowdStrike_CSIT_16038_03 : wet_panda backshell rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Backshell malware variant observed in Suckfly (WET PANDA) activity"
        reports = "CSIT-16038"
        version = "201603300000"
        last_modified = "2016-03-30"
        actor = "WET PANDA"
        malware_family = "Backshell"
    strings:
        $str_call_1 = "DllRegisterServer is called"
        $str_call_2 = "DllGetClass0bject is called"
        $str_call_3 = "ServiceMain is called"
        $str_call_4 = "DoInstallEntry is called"
        $str_call_5 = "InstallUserProcess is called"
        $str_call_6 = "DLL_PROCESS_ATTACH is called"
    condition:
        3 of ($str_call_*)
}

rule CrowdStrike_CSIT_16047_01 : delivery_document phishing 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Phishing PDF"
        reports = "CSIT-16047"
        version = "201603300000"
        last_modified = "2016-03-30"
    strings:
        $ = "<</Subtype/Link/Rect["
        $ = /\] ?\/BS<<\/W 0>>\/F 4\/A<<\/Type\/Action\/S\/URI\/URI ?\(http/
        $ = ">>/StructParent 1>>"
        $ = ">>/StructParent 2>>"
        $ = "<</Creator (http://www.convertapi.com                 )/Author"
    condition:
        all of them
}

rule CrowdStrike_CSIT_16039_01 : carbon_spider certificate 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "In travel TOV certificate serial used for CARBON SPIDER Agent ORM malware."
        reports = "CSIT-16039"
        version = "201910140953"
        last_modified = "2019-10-14"
        actor = "CARBON SPIDER"
    strings:
        $cn = "In travel TOV"
        $serial = { df d9 15 e3 2c 5f 31 81 a0 cd f0 af f5 0f 80 52 }
    condition:
        uint16(0) == 0x5a4d and
        ($cn and $serial)
}

rule CrowdStrike_CSIT_16039_02 : carbon_spider certificate 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "TOV Golden travel certificate serial used for CARBON SPIDER Agent ORM malware."
        reports = "CSIT-16039"
        version = "201910140944"
        last_modified = "2019-10-14"
        actor = "CARBON SPIDER"
    strings:
        $cn = "TOV Golden travel"
        $serial = { e0 ad 11 10 32 da bb fe ed a5 67 36 39 6e 8b 5c }
    condition:
        uint16(0) == 0x5a4d and
        ($cn and $serial)
}

rule CrowdStrike_CSIT_16043_02 : certificate 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Gals DV certificate used by CARBON SPIDER Sekur malware"
        reports = "CSIT-16043"
        version = "201910140937"
        last_modified = "2019-10-14"
    strings:
        $cn = "Gals DV"
        $serial = { af 6f 87 ca e3 37 88 4c f3 9a 77 63 23 9c a8 7d }
    condition:
        uint16(0) == 0x5a4d and
        ($cn and $serial)
}

rule CrowdStrike_CSIT_16050_01 : searchinject injector 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Tool for injecting PoS scraper into targeted process"
        reports = "CSIT-16050"
        version = "201604010000"
        last_modified = "2016-04-01"
    strings:
        $usage = "Usage: SearchInject <PID1>[PID2][PID3]"
        $message1 = "inject base: "
        $message2 = "Current active processes:"
        $message3 = "Injecting %s into %i"
    condition:
        all of them
}

rule CrowdStrike_CSIT_16050_02 : pos_scraper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Injected DLL for scraping credit card data"
        reports = "CSIT-16050"
        version = "201604010000"
        last_modified = "2016-04-01"
    strings:
        $log_format = "%s%i_%s_%i.log"
        $format_check1 = { 80 f9 5e }
        $format_check2 = { 80 f9 3d }
        $data_check1 = { 66 83 fe 20 }
        $data_check2 = { 66 83 fe 7f }
    condition:
        all of them
}

rule CrowdStrike_CSIT_16049_01 : droidjack android 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Malicious Islamic News Service Android application infected with DroidJack"
        reports = "CSIT-16049"
        version = "201604070000"
        last_modified = "2016-04-07"
        malware_family = "DroidJack"
    strings:
        $ = "res/drawable-hdpi-v4/abc_scrubber_control_to_pressed_mtrl_005.png"
        $ = "assets/zip_3113756/font/roboto/Roboto-Bold.ttf"
        $ = "assets/zip_3113756/img/ic_live_tv_white_48dp.png"
    condition:
        all of them
}

rule CrowdStrike_CSIT_16049_02 : droidjack android unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Unpacked Malicious Islamic News Service Android Application"
        reports = "CSIT-16049"
        version = "201604070000"
        last_modified = "2016-04-07"
        malware_family = "DroidJack"
    strings:
        $ = "\\u0642\\u0646\\u0627\\u0629 \\u062f\\u0648\\u0644\\u0629 \\u0627\\u0644\\u062e\\u0644\\u0627\\u0641\\u0629"
        $ = ".collection-item.col.s6.m4.l3"
    condition:
        all of them
}

rule CrowdStrike_CSIT_16049_03 : droidjack rat sandrorat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Android malware DroidJack"
        reports = "CSIT-16049"
        version = "201904251601"
        last_modified = "2019-04-25"
        malware_family = "DroidJack"
    strings:
        $ = "#Lnet/droidjack/server/CallListener"
        $ = "SMSOutgoingTable"
        $ = "SMS_RECORDING"
        $ = "MYTXT TEXT, CNAME TEXT, TOPHNO TEXT, MDATE "
    condition:
        all of them
}

rule CrowdStrike_Comfoo_01 : rat unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Strings found in malware similar to Comfoo. This rule will alert against memory dumps or unpacked samples."
        version = "202102191608"
        last_modified = "2021-02-19"
    strings:
        $alt_b64 = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789._"
        $user_agent = "Mozilla/4.0 (compatible; MSIE 6.0; Win32)"
        $drive_unknown = "DRIVE_UNKNOWN"
        $drive_no_root_dir = "DRIVE_NO_ROOT_DIR"
        $drive_removable = "DRIVE_REMOVABLE"
        $drive_fixed = "DRIVE_FIXED"
        $drive_remote = "DRIVE_REMOTE"
        $drive_cdrom = "DRIVE_CDROM"
        $drive_ramdisk = "DRIVE_RAMDISK"
    condition:
        all of them
}

rule CrowdStrike_CSIT_16040_01 : comfoo comfoorsa keyhole_panda rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "ComfooRSA (Comfoo variant) RAT detection"
        reports = "CSIT-16040"
        version = "202102191608"
        last_modified = "2021-02-19"
        actor = "KEYHOLE PANDA"
        malware_family = "Comfoo"
    strings:
        $str_exit = "receive party exit"
        $str_shell = "The Remote Shell Execute: %s completed!"
        $str_err = "CreatPipe Error: %d"
        $str_noinfo = "No Information Return! Perhaps No Proxy."
        $str_rettum = "ReturnTime Set"
        $str_alt_b64 = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789._"
        $str_user_agent = "Mozilla/4.0 (compatible; MSIE 6.0; Win32)"
        $drive_unknown = "DRIVE_UNKNOWN"
        $drive_no_root_dir = "DRIVE_NO_ROOT_DIR"
        $drive_removable = "DRIVE_REMOVABLE"
        $drive_fixed = "DRIVE_FIXED"
        $drive_remote = "DRIVE_REMOTE"
        $drive_cdrom = "DRIVE_CDROM"
        $drive_ramdisk = "DRIVE_RAMDISK"
    condition:
        all of ($drive_*) and 3 of ($str_*)
}

rule CrowdStrike_CSIT_16073_01 : tsohksat dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Tsohksat dropper"
        reports = "CSIT-16073"
        version = "201604150000"
        last_modified = "2016-04-15"
        malware_family = "Tsohksat"
    strings:
        $ = "http://nsis.sf.net/NSIS_Error" wide ascii
        $ = "Error writing temporary file. Make sure your temp folder is valid." wide ascii
        $ = "NSIS Error" wide ascii
        $ = "unpacking data: %d%%"
        $ = "ImageList_Destroy"
        $ = "A build of the Microsoft Windows." wide
    condition:
        (uint16(0) == 0x5A4D) and all of them
}

rule CrowdStrike_CSIT_16073_02 : ragua rat tsohksat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Tsohksat module"
        reports = "CSIT-16073"
        version = "201904010639"
        last_modified = "2019-04-01"
        malware_family = "Tsohksat"
    strings:
        $module_1 = "This program must be run under Win32"
        $module_2 = "Delphi" ascii wide
        $module_3 = "\\Microsoft\\utility\\" ascii wide
        $tsoksat_1 = "Taskost" ascii wide
        $tsoksat_2 = "dohksat.scr" ascii wide
        $tsoksat_3 = "\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run" ascii wide
        $tsoksat_4 = "Activar keylogger"
        $tsoksat_5 = "Detener keylogger"
        $tsoksat_6 = "No se ha podido guardar el valor en el registro de configuracione"
        $sohksat_1 = "RECORD MicSound" wide
        $sohksat_2 = "WAVEAUDIO ALIAS MicSound" wide
        $sohksat_3 = "Microsoft Corporation.Reservados todos los derechos" wide
        $dohksat_1 = "Disco-" ascii wide
        $dohksat_2 = "*.*" ascii wide
        $dohksat_3 = ".txt" ascii wide
        $dohksat_4 = "Include subfolders" ascii wide
    condition:
        all of ($module_*) and (
        (all of ($tsoksat_*)) or
        (all of ($sohksat_*)) or
        (all of ($dohksat_*)))
}

rule CrowdStrike_CSIT_14091_02 : gh0st lurk0 rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Lurk0 Gh0st RAT variant"
        reports = "CSIT-14091"
        version = "201604180000"
        last_modified = "2016-04-18"
        malware_family = "Gh0st"
    strings:
        $av_proc_name = "360TRAY.EXE" wide
        $iexplorer = "iexplore.exe" wide
        $registry_key = "SOFTWARE\\Microsoft\\WindowsDbxUpdateBT" wide
        $config_file_name = "IconConfigBt.DAT" wide
    condition:
        3 of them
}

rule CrowdStrike_CSIT_16084_01 : qakbot trojan 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Qakbot DLL"
        reports = "CSIT-16084"
        version = "202005080803"
        last_modified = "2020-05-08"
        malware_family = "Qakbot"
    strings:
        $chrome = "c:\\tmp_dbg\\chrome_POST_%08x_%u"
        $ac = "type=[ac] data=[%s:%s]"
        $ou2 = "type=[ou2] data=[%s:%s]"
        $msn = "type=[msn] login=[%s] pass=[%s]"
        $pw = "type=[pw] url=[%s] login=[%s] pass=[%s]"
        $oe = "type=[oe] data=[%s:%s]"
        $raw_pw = "raw_password_data=[%s]"
    condition:
        $chrome or (2 of them)
}

rule CrowdStrike_CSIT_16084_02 : qakbot trojan unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Qakbot unpacked executable"
        reports = "CSIT-16084"
        version = "202005080809"
        last_modified = "2020-05-08"
        malware_family = "Qakbot"
    strings:
        $pattern1 = { 63 3a 5c 00 25 75 00 00 25 73 25 75 00 00 00 00 25 73 2e 25 30 36 64 00 }
        $pattern2 = { 2f 63 20 00 25 73 25 63 00 }
        $pattern3 = { 49 00 44 00 42 00 5f 00 42 00 49 00 54 00 4d 00 41 00 50 00 }
    condition:
        2 of them
}

rule CrowdStrike_CSIT_16060_01 : carbon_spider delivery_document macro 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Macro dropper document used by CARBON SPIDER"
        reports = "CSIT-16060"
        version = "201604280000"
        last_modified = "2016-04-28"
        actor = "CARBON SPIDER"
    strings:
        $str1 = "NewMacros" wide ascii nocase
        $str2 = "http://" wide ascii nocase
        $file = "AdobeUpdateManagementTool.vbs"
    condition:
        all of them
}

rule CrowdStrike_CSIT_16060_02 : carbon_spider vbflash rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "CARBON SPIDER malware VBFlash"
        reports = "CSIT-16060"
        version = "201807271854"
        last_modified = "2018-07-27"
        actor = "CARBON SPIDER"
        malware_family = "VBFlash"
    strings:
        $md5_1 = "FF a, b, c, d, x(k + 0), S11, &HD76AA478"
        $md5_2 = "m_lOnBits(30) = CLng(2147483647)"
        $url_1 = "urlArry(0)"
        $url_2 = "ReDim urlArry"
        $sleep = "WScript.Sleep 1000 * 60 *"
        $file = "AdobeUpdateManagementTool"
        $const = "9007199254740991"
    condition:
        4 of them
}

rule CrowdStrike_CSIT_16104_01 : wicked_spider winnti rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Winnti engine component"
        reports = "CSIT-16104"
        version = "201605040000"
        last_modified = "2016-05-04"
        actor = "WICKED SPIDER"
        malware_family = "Winnti"
    strings:
        $uac = "%s\\sysprep"
        $servicestart = "net start %s"
        $export0 = "Workmain"
        $export1 = "Install"
        $export2 = "DeleteF"
    condition:
        all of them
}

rule CrowdStrike_CSIT_16104_02 : wicked_spider winnti rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Winnti service component"
        reports = "CSIT-16104"
        version = "201605040000"
        last_modified = "2016-05-04"
        actor = "WICKED SPIDER"
        malware_family = "Winnti"
    strings:
        $uac = "%s\\sysprep\\cryptbase.dll"
        $export0 = "work_start"
        $export1 = "work_end"
        $servicestart = "net start %s"
    condition:
        all of them
}

rule CrowdStrike_CSIT_16104_03 : wicked_spider winnti rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Winnti core component"
        reports = "CSIT-16104"
        version = "201605040000"
        last_modified = "2016-05-04"
        actor = "WICKED SPIDER"
        malware_family = "Winnti"
    strings:
        $drive_check0 = "\\\\.\\Scsi%d:"
        $uac = "%s\\sysprep\\cryptbase.dll"
        $enc = { CEFA ADDE }
    condition:
        all of them
}

rule CrowdStrike_CSIT_16062_02 : spicy_panda taleret rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Taleret variant using substitution for config concealment"
        reports = "CSIT-16062"
        version = "201807271505"
        last_modified = "2018-07-27"
        actor = "SPICY PANDA"
        malware_family = "Taleret"
    strings:
        $sbox = { 00 40 80 c0 10 e0 b0 d0 20 a0 90 60 30 70 50 f0
        04 44 84 c4 14 e4 b4 d4 24 a4 94 64 34 74 54 f4
        08 48 88 c8 18 e8 b8 d8 28 a8 98 68 38 78 58 f8
        0c 4c 8c cc 1c ec bc dc 2c ac 9c 6c 3c 7c 5c fc
        01 41 81 c1 11 e1 b1 d1 21 a1 91 61 31 71 51 f1
        0e 4e 8e ce 1e ee be de 2e ae 9e 6e 3e 7e 5e fe
        0b 4b 8b cb 1b eb bb db 2b ab 9b 6b 3b 7b 5b fb
        0d 4d 8d cd 1d ed bd dd 2d ad 9d 6d 3d 7d 5d fd
        02 42 82 c2 12 e2 b2 d2 22 a2 92 62 32 72 52 f2
        0a 4a 8a ca 1a ea ba da 2a aa 9a 6a 3a 7a 5a fa
        09 49 89 c9 19 e9 b9 d9 29 a9 99 69 39 79 59 f9
        06 46 86 c6 16 e6 b6 d6 26 a6 96 66 36 76 56 f6
        03 43 83 c3 13 e3 b3 d3 23 a3 93 63 33 73 53 f3
        07 47 87 c7 17 e7 b7 d7 27 a7 97 67 37 77 57 f7
        05 45 85 c5 15 e5 b5 d5 25 a5 95 65 35 75 55 f5
        0f 4f 8f cf 1f ef bf df 2f af 9f 6f 3f 7f 5f ff }
    condition:
        all of them
}

rule CrowdStrike_CSIT_16062_01 : spicy_panda taleret rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Taleret variant using substitution for config concealment"
        reports = "CSIT-16062"
        version = "201807271505"
        last_modified = "2018-07-27"
        actor = "SPICY PANDA"
        malware_family = "Taleret"
    strings:
        $ = "Wrong Pass."
        $ = { 52 75 6e 20 25 73 20 66 61 69 6c 2e 54 72 79 0a 63 6d 64 20 2f 63 20 25 73 20 0a }
        $ = "Run fail: > %d Bytes."
        $ = "MSIE 9.0; Windows NT 6.1; SV1)"
        $ = "Into WinMain."
        $ = "Into Sleep."
        $ = "Disconn %s:%d"
    condition:
        4 of them
}

rule CrowdStrike_CSIT_16052_01 : andromeda 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Andromeda USB spreader DLL"
        reports = "CSIT-16052"
        version = "201605060000"
        last_modified = "2016-05-06"
        malware_family = "Andromeda"
    strings:
        $rc4key = "61b5c891c5595852cef22c29c11201b8"
        $user_agent = "Mozilla/5.0 (compatible; MSIE 10.0; Windows NT 6.1; Trident/4.0; InfoPath.2; SV1; .NET CLR 2.0.50727; WOW64)" wide
        $usb_thread = "USBTHREAD" wide
        $mutex = "Global\\msiff0x1" wide
        $marker = "MARKER"
        $nameless = "NAMELESS"
        $link = "%s\\%s (%dGB).lnk" wide
    condition:
        $rc4key or (3 of them)
}

rule CrowdStrike_CSIT_16058_01 : hound_spider cerber ransomware unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Cerber unpacked strings"
        reports = "CSIT-16058"
        version = "201605100000"
        last_modified = "2016-05-10"
        actor = "HOUND SPIDER"
        malware_family = "Cerber"
    strings:
        $a = "Keysize: %d, Encryption time: %d" wide
        $b = "Total files found: %d, Files crypted: %d" wide
        $c = "done!" wide
    condition:
        all of them
}

rule CrowdStrike_CSIT_16053_01 : teslacrypt ransomware unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "TeslaCrypt ransomware, characteristic strings in the unpacked payload"
        reports = "CSIT-16053"
        version = "201605110000"
        last_modified = "2016-05-11"
        malware_family = "TeslaCrypt"
    strings:
        $uid_placeholder = "XXXXXXXXXXXXX"
        $iv_1 = { c7 44 ?? ?? ff ff aa aa }
        $iv_2 = { c7 44 ?? ?? 00 00 be ef }
        $iv_3 = { c7 44 ?? ?? de ad 00 00 }
        $iv_4 = { c7 44 ?? ?? be ff ff ff }
    condition:
        all of them
}

rule CrowdStrike_CSIT_16054_01 : swift rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Secure-delete function present in SWIFT malware"
        reports = "CSIT-16054"
        version = "201605130000"
        last_modified = "2016-05-13"
    strings:
        $ = { 7f 0a 3b cb 76 5a eb 04 8b 4c 24 10 2b cd 1b c7
        78 15 7f 08 81 f9 00 10 00 00 76 0b b9 00 10 00
        00 89 5c 24 20 eb 04 89 44 24 20 8d 54 24 18 53
        52 8d 44 24 2c 51 50 56 ff }
    condition:
        all of them
}

rule CrowdStrike_CSIT_16056_01 : excalibur rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Excalibur RAT"
        reports = "CSIT-16056"
        version = "201807300953"
        last_modified = "2018-07-30"
        malware_family = "Excalibur"
    strings:
        $str_tian = "tianshiyed@iaomaomark1#23mark123tokenmarkqwebjiuga664115" wide
        $str_avc_getcloud = "AVCGetCloudConFromSokServer"
        $str_avc_callback = "AVCMYSOCKCALLBACK"
        $str_saber_start = "saberstart."
        $str_saber_end = ".saberend"
        $str_tsym = "Tsydm-Saber-%d" wide
        $str_excal_svc = "ExcaliburSvc" wide
        $str_ip_parse_dc = "data-compress"
        $str_ip_parse_ip = { ce d2 b5 c4 69 70 b5 d8 d6 b7 00 }
    condition:
        $str_tian                   or
        $str_avc_getcloud           or
        (all of ($str_saber_*))     or
        (all of ($str_ip_parse*))   or
        3 of them
}

rule CrowdStrike_FANCYBEAR_XAgent_02 : fancy_bear rat xagent 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "X-Agent implant, uniquely attributed to FANCY BEAR"
        version = "202012141611"
        last_modified = "2020-12-14"
        actor = "FANCY BEAR"
        malware_family = "X-Agent"
    strings:
        $ = "One thread has died so the process is killed too"  ascii wide
        $ = "Create process failed on: (%s) , error (%d)"
        $ = "unsuccess&nbsp:&nbsp" wide
    condition:
        any of them
}

rule CrowdStrike_FANCYBEAR_XTunnel_01 : fancy_bear xtunnel 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "X-Tunnel tool, uniquely attributed to FANCY BEAR"
        version = "202012141610"
        last_modified = "2020-12-14"
        actor = "FANCY BEAR"
        malware_family = "X-Tunnel"
    strings:
        $ = { 2d 00 53 00 69 00 00 00 2d 00 53 00 70 00 00 00
        2d 00 55 00 70 00 00 00 2d 00 50 00 69 00 00 00
        2d 00 50 00 70 00 00 00 }
    condition:
        all of them
}

rule CrowdStrike_FANCYBEAR_XAgent_01 : fancy_bear xagent rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "X-Agent implant, uniquely attributed to FANCY BEAR"
        version = "201807301125"
        last_modified = "2018-07-30"
        actor = "FANCY BEAR"
        malware_family = "X-Agent"
    strings:
        $ = "11ReservedApi"
        $ = "11RemoteShell"
        $ = "11HttpChannel"
        $ = "12LocalStorage"
    condition:
        all of them
}

rule CrowdStrike_CSIT_17179_02 : bot cutwail unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Cutwail version 2, matching on memory dumps"
        reports = "CSIT-17179"
        version = "202102022224"
        last_modified = "2021-02-02"
        actor = "NARWHAL SPIDER"
        malware_family = "Cutwail"
    strings:
        $ = "Thuz program"
        $ = "SendARP"
        $ = "MimeOleGenerateMID"
        $ = { 8b 55 f8 8a 14 0a 30 11 41 4e 75 f4 33 f6 8d 48 1c }
        $ = { 8a 19 8a 14 30 88 1c 30 46 88 11 49 83 fe 0e 72 ef }
    condition:
        all of them
}

rule CrowdStrike_CSIT_18013_02 : narwhal_spider cutwail bot unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Cutwail version 2, matching on memory dumps"
        reports = "CSIT-18013"
        version = "201808271819"
        last_modified = "2018-08-27"
        malware_family = "Cutwail"
        actor_name = "NARWHAL SPIDER"
    strings:
        $ = "Thuz program"
        $ = "SendARP"
        $ = "MimeOleGenerateMID"
        $ = { 8b 55 f8 8a 14 0a 30 11 41 4e 75 f4 33 f6 8d 48 1c }
        $ = { 8a 19 8a 14 30 88 1c 30 46 88 11 49 83 fe 0e 72 ef }
    condition:
        all of them
}

rule CrowdStrike_CSIR_16007_01 : rat sakula 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Sakula RAT"
        reports = "CSIR-16007"
        version = "201902150937"
        last_modified = "2019-02-15"
        malware_family = "Sakula"
    strings:
        $ua = "iexplorer"
        $regkey = "CCPUpdate"
        $params = "/c ping 127.0.0.1 & del /q"
        $procmsg = "Self Process Id:%d\\n"
        $freadmsg = "%d_of_%d_for_%s_on_%s"
        $plaindropfname = {73 68 69 61 70 65 2E 65 78 65 00}
    condition:
        3 of them and not $plaindropfname
}

rule CrowdStrike_CSIR_16007_02 : sakula dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Sakula intermediate dropper"
        reports = "CSIR-16007"
        version = "201807300931"
        last_modified = "2018-07-30"
        malware_family = "Sakula"
    strings:
        $xor_decryption = { 8A 9C 05 ?? ?? ?? ?? 32 DA 32 D9 88 9C 05 ?? ?? ?? ?? 40 3D 84 00 00 00}
    condition:
        any of them
}

rule CrowdStrike_CSIR_16007_03 : sakula rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Sakula RAT second generation"
        reports = "CSIR-16007"
        version = "201807271458"
        last_modified = "2018-07-27"
        malware_family = "Sakula"
    strings:
        $ = { 0D 0A 43 6D 64 50 72 6F  63 65 73 73 45 78 69 74 65 64 0A 00 }
        $ = "%08x%08x%08x%08x"
        $ = { C7 45 D0 50 00 4F 00 C7 45 D4 53 00 54 00 C7 45 90 48 00 54 00 C7 45 94 54 00 50 00 C7 45 98 2F 00 31 00 C7 45 9C 2E 00 31 00 }
    condition:
        all of them
}

rule CrowdStrike_CSIR_16007_07 : dropper loader sakula 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Sakula dropper DLL - side-loading DLL which loads the encrypted Sakula payload"
        reports = "CSIR-16007"
        version = "202103091313"
        last_modified = "2021-03-09"
        malware_family = "Sakula"
    strings:
        $dexor_routine = { 31 C0 8A 04 0B 3C 00 74 09 38 D0 74 05 30 D0 88 04 0B 83 F9 00 74 03 49 EB E6 }
    condition:
        all of them
}

rule CrowdStrike_CSIR_16007_05 : sakula dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Sakula dropper"
        reports = "CSIR-16007"
        version = "201807300933"
        last_modified = "2018-07-30"
        malware_family = "Sakula"
    strings:
        $decrypt_embedded_payload = { 8B 45 08 8D 0C 02 8A 01 84 C0 74 08 3C ?? 74 04 34 ?? 88 01 42 3B 55 0C }
        $uninstall = "/c ping 127.0.0.1 & del /q \"%s\""
    condition:
        all of them
}

rule CrowdStrike_CSIR_16007_06 : dropper sakula 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Sakula dropper"
        reports = "CSIR-16007"
        version = "201902150937"
        last_modified = "2019-02-15"
        malware_family = "Sakula"
    strings:
        $ = { 8A 88 ?? ?? ?? ?0 84 C9 74 0E 80 F9 ?? 74 09 80 F1 ?? 88 88 ?? ?? ?? ?0 8A 88 ?? ?? ?? ?0 84 C9 74 0E 80 F9 ?? 74 09 80 F1 ?? 88 88 ?? ?? ?? ?0 }
    condition:
        all of them
}

rule CrowdStrike_CSIR_16007_04 : sakula dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Sakula dropper"
        reports = "CSIR-16007"
        version = "201807300933"
        last_modified = "2018-07-30"
        malware_family = "Sakula"
    strings:
        $decrypt_embedded_payload = { 8A 88 00 ?? ?? ?? 84 C9 74 0E 80 F9 ?? 74 09 80 F1 ?? 88 88 00 ?? ?? ?? 8A 88 }
        $dropper_format_path = "%s\\%s%d.%s"
    condition:
        2 of them
}

rule CrowdStrike_CSIT_16063_01 : godzilla 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Godzilla Loader"
        reports = "CSIT-16063"
        version = "201909051026"
        last_modified = "2019-09-05"
        malware_family = "Godzilla"
    strings:
        $godzilla_key = { 6a 47 58 66 89 45 ?? 6a 4f 58 66 89 45 ?? 6a 44 58 66 89 45 ?? 6a 5a 58 66 89 45 ?? 6a 49 58 66 89 45 ?? 6a 4c 58 66 89 45 ?? 6a 4c 58 66 89 45 ?? 6a 41 58 }
    condition:
        $godzilla_key
}

rule CrowdStrike_CSIR_16008_01 : silent_chollima exportcontrol dropper unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "SILENT CHOLLIMA ExportControl dropper unpacked payload"
        reports = "CSIR-16008"
        version = "201606010000"
        last_modified = "2016-06-01"
        actor = "SILENT CHOLLIMA"
        malware_family = "ExportControl"
    strings:
        $deobloop_1 =  { FE CA 88 10 40 83 E9 01 79 EF }
        $deobloop_2 =  { FE CA 88 11 41 83 E8 01 79 F3 }
        $deobloop_gen= { FE CA 88 1? 4? 83 E? 01 79 }
        $gifstring  = "gjh/gbe9:e9f56e76`zuofsbfo"
        $avg_enc    = "fyf/fuohwb"
        $str_isb_1  = "ISBXBDBFEF"
        $str_isb_2  = "ISBXBDB0SF"
        $str_isb_3  = "ISBXBDBFIN"
    condition:
        2 of them
}

rule CrowdStrike_CSIR_16008_02 : silent_chollima delivery_document vbscript macro 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "SILENT CHOLLIMA ExportControl delivery document with macro"
        reports = "CSIR-16008"
        version = "201606010000"
        last_modified = "2016-06-01"
        actor = "SILENT CHOLLIMA"
        malware_family = "ExportControl"
    strings:
        $docheader = { D0 CF 11 E0 }
        $vba = "_VBA_PROJECT" wide
        $str_enable = "enable content" wide
        $str_getfilesize = "GetFileSize"
        $str_shell = "ShellExecuteA"
        $str_setfile = "SetFilePointer"
        $str_lpfile = "lpFileSizeHigh"
        $str_docopen = "Document_Open"
        $str_hex_4d_mayb = "&HP4D"
    condition:
        $docheader at 0 and ($vba and (4 of ($str_*)))
}

rule CrowdStrike_CSIR_16008_06 : silent_chollima exportcontrol tasking keylogger 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "SILENT CHOLLIMA ExportControl dropper associated keylogger payload"
        reports = "CSIR-16008"
        version = "201606010000"
        last_modified = "2016-06-01"
        actor = "SILENT CHOLLIMA"
        malware_family = "Exportcontrol"
    strings:
        $str_nls = "\\DM%d%02d%02d.nls"
        $str_4you = "'@I4You@12!!!"
        $str_file_1 = "KB987324.log"
        $str_file_2 = "KB987325.log"
        $str_clipboard = "### {CLIPBOARD} ###"
        $str_myhook = "MyHook Session"
    condition:
        3 of them
}

rule CrowdStrike_CSIR_16008_07 : silent_chollima exportcontrol tasking 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "SILENT CHOLLIMA ExportControl dropper associated uploader payload"
        reports = "CSIR-16008"
        version = "201606010000"
        last_modified = "2016-06-01"
        actor = "SILENT CHOLLIMA"
        malware_family = "ExportControl"
    strings:
        $str_boundary = "------7f90bc891ee40c"
        $str_freadand = "fread and InternetWriteFileB Fail: retry=0 cnt:%d %d"
        $str_fail = "InternetWriteFileB mimetail Fail"
    condition:
        any of them
}

rule CrowdStrike_CSIR_16008_10 : silent_chollima exportcontrol tasking 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "SILENT CHOLLIMA ExportControl dropper associated downloader payload"
        reports = "CSIR-16008"
        version = "201606010000"
        last_modified = "2016-06-01"
        actor = "SILENT CHOLLIMA"
        malware_family = "ExportControl"
    strings:
        $enc_str_contenttype = { BC 90 91 8B 9A 91 8B D2 AB 86 8F 9A C5 DF 9E 8F 8F 93 96 9C 9E 8B 96 90 91 D0 87 D2 88 88 88 D2 99 90 8D 92 D2 8A 8D 93 9A 91 9C 90 9B 9A 9B 00 }
        $enc_str_http = { 97 8B 8B 8F C5 D0 D0 }
    condition:
        2 of them
}

rule CrowdStrike_CSIR_16008_11 : silent_chollima exportcontrol dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "SILENT CHOLLIMA ExportControl dropper - distinctive shell command string, plain and encoded"
        reports = "CSIR-16008"
        version = "201606010000"
        last_modified = "2016-06-01"
        actor = "SILENT CHOLLIMA"
        malware_family = "ExportControl"
    strings:
        $plain = "/c systeminfo >NUL & del /q \"%s\" >> NUL"
        $enc_00 = { 2F 63 20 73 79 73 74 65 6D 69 6E 66 6F 20 3E 4E 55 4C 20 26 20 64 65 6C 20 2F 71 20 22 25 73 22 20 3E 3E 20 4E 55 4C }
        $enc_01 = { 2E 62 21 72 78 72 75 64 6C 68 6F 67 6E 21 3F 4F 54 4D 21 27 21 65 64 6D 21 2E 70 21 23 24 72 23 21 3F 3F 21 4F 54 4D }
        $enc_02 = { 2D 61 22 71 7B 71 76 67 6F 6B 6C 64 6D 22 3C 4C 57 4E 22 24 22 66 67 6E 22 2D 73 22 20 27 71 20 22 3C 3C 22 4C 57 4E }
        $enc_03 = { 2C 60 23 70 7A 70 77 66 6E 6A 6D 65 6C 23 3D 4D 56 4F 23 25 23 67 66 6F 23 2C 72 23 21 26 70 21 23 3D 3D 23 4D 56 4F }
        $enc_04 = { 2B 67 24 77 7D 77 70 61 69 6D 6A 62 6B 24 3A 4A 51 48 24 22 24 60 61 68 24 2B 75 24 26 21 77 26 24 3A 3A 24 4A 51 48 }
        $enc_05 = { 2A 66 25 76 7C 76 71 60 68 6C 6B 63 6A 25 3B 4B 50 49 25 23 25 61 60 69 25 2A 74 25 27 20 76 27 25 3B 3B 25 4B 50 49 }
        $enc_06 = { 29 65 26 75 7F 75 72 63 6B 6F 68 60 69 26 38 48 53 4A 26 20 26 62 63 6A 26 29 77 26 24 23 75 24 26 38 38 26 48 53 4A }
        $enc_07 = { 28 64 27 74 7E 74 73 62 6A 6E 69 61 68 27 39 49 52 4B 27 21 27 63 62 6B 27 28 76 27 25 22 74 25 27 39 39 27 49 52 4B }
        $enc_08 = { 27 6B 28 7B 71 7B 7C 6D 65 61 66 6E 67 28 36 46 5D 44 28 2E 28 6C 6D 64 28 27 79 28 2A 2D 7B 2A 28 36 36 28 46 5D 44 }
        $enc_09 = { 26 6A 29 7A 70 7A 7D 6C 64 60 67 6F 66 29 37 47 5C 45 29 2F 29 6D 6C 65 29 26 78 29 2B 2C 7A 2B 29 37 37 29 47 5C 45 }
        $enc_0A = { 25 69 2A 79 73 79 7E 6F 67 63 64 6C 65 2A 34 44 5F 46 2A 2C 2A 6E 6F 66 2A 25 7B 2A 28 2F 79 28 2A 34 34 2A 44 5F 46 }
        $enc_0B = { 24 68 2B 78 72 78 7F 6E 66 62 65 6D 64 2B 35 45 5E 47 2B 2D 2B 6F 6E 67 2B 24 7A 2B 29 2E 78 29 2B 35 35 2B 45 5E 47 }
        $enc_0C = { 23 6F 2C 7F 75 7F 78 69 61 65 62 6A 63 2C 32 42 59 40 2C 2A 2C 68 69 60 2C 23 7D 2C 2E 29 7F 2E 2C 32 32 2C 42 59 40 }
        $enc_0D = { 22 6E 2D 7E 74 7E 79 68 60 64 63 6B 62 2D 33 43 58 41 2D 2B 2D 69 68 61 2D 22 7C 2D 2F 28 7E 2F 2D 33 33 2D 43 58 41 }
        $enc_0E = { 21 6D 2E 7D 77 7D 7A 6B 63 67 60 68 61 2E 30 40 5B 42 2E 28 2E 6A 6B 62 2E 21 7F 2E 2C 2B 7D 2C 2E 30 30 2E 40 5B 42 }
        $enc_0F = { 20 6C 2F 7C 76 7C 7B 6A 62 66 61 69 60 2F 31 41 5A 43 2F 29 2F 6B 6A 63 2F 20 7E 2F 2D 2A 7C 2D 2F 31 31 2F 41 5A 43 }
        $enc_10 = { 3F 73 30 63 69 63 64 75 7D 79 7E 76 7F 30 2E 5E 45 5C 30 36 30 74 75 7C 30 3F 61 30 32 35 63 32 30 2E 2E 30 5E 45 5C }
        $enc_11 = { 3E 72 31 62 68 62 65 74 7C 78 7F 77 7E 31 2F 5F 44 5D 31 37 31 75 74 7D 31 3E 60 31 33 34 62 33 31 2F 2F 31 5F 44 5D }
        $enc_12 = { 3D 71 32 61 6B 61 66 77 7F 7B 7C 74 7D 32 2C 5C 47 5E 32 34 32 76 77 7E 32 3D 63 32 30 37 61 30 32 2C 2C 32 5C 47 5E }
        $enc_13 = { 3C 70 33 60 6A 60 67 76 7E 7A 7D 75 7C 33 2D 5D 46 5F 33 35 33 77 76 7F 33 3C 62 33 31 36 60 31 33 2D 2D 33 5D 46 5F }
        $enc_14 = { 3B 77 34 67 6D 67 60 71 79 7D 7A 72 7B 34 2A 5A 41 58 34 32 34 70 71 78 34 3B 65 34 36 31 67 36 34 2A 2A 34 5A 41 58 }
        $enc_15 = { 3A 76 35 66 6C 66 61 70 78 7C 7B 73 7A 35 2B 5B 40 59 35 33 35 71 70 79 35 3A 64 35 37 30 66 37 35 2B 2B 35 5B 40 59 }
        $enc_16 = { 39 75 36 65 6F 65 62 73 7B 7F 78 70 79 36 28 58 43 5A 36 30 36 72 73 7A 36 39 67 36 34 33 65 34 36 28 28 36 58 43 5A }
        $enc_17 = { 38 74 37 64 6E 64 63 72 7A 7E 79 71 78 37 29 59 42 5B 37 31 37 73 72 7B 37 38 66 37 35 32 64 35 37 29 29 37 59 42 5B }
        $enc_18 = { 37 7B 38 6B 61 6B 6C 7D 75 71 76 7E 77 38 26 56 4D 54 38 3E 38 7C 7D 74 38 37 69 38 3A 3D 6B 3A 38 26 26 38 56 4D 54 }
        $enc_19 = { 36 7A 39 6A 60 6A 6D 7C 74 70 77 7F 76 39 27 57 4C 55 39 3F 39 7D 7C 75 39 36 68 39 3B 3C 6A 3B 39 27 27 39 57 4C 55 }
        $enc_1A = { 35 79 3A 69 63 69 6E 7F 77 73 74 7C 75 3A 24 54 4F 56 3A 3C 3A 7E 7F 76 3A 35 6B 3A 38 3F 69 38 3A 24 24 3A 54 4F 56 }
        $enc_1B = { 34 78 3B 68 62 68 6F 7E 76 72 75 7D 74 3B 25 55 4E 57 3B 3D 3B 7F 7E 77 3B 34 6A 3B 39 3E 68 39 3B 25 25 3B 55 4E 57 }
        $enc_1C = { 33 7F 3C 6F 65 6F 68 79 71 75 72 7A 73 3C 22 52 49 50 3C 3A 3C 78 79 70 3C 33 6D 3C 3E 39 6F 3E 3C 22 22 3C 52 49 50 }
        $enc_1D = { 32 7E 3D 6E 64 6E 69 78 70 74 73 7B 72 3D 23 53 48 51 3D 3B 3D 79 78 71 3D 32 6C 3D 3F 38 6E 3F 3D 23 23 3D 53 48 51 }
        $enc_1E = { 31 7D 3E 6D 67 6D 6A 7B 73 77 70 78 71 3E 20 50 4B 52 3E 38 3E 7A 7B 72 3E 31 6F 3E 3C 3B 6D 3C 3E 20 20 3E 50 4B 52 }
        $enc_1F = { 30 7C 3F 6C 66 6C 6B 7A 72 76 71 79 70 3F 21 51 4A 53 3F 39 3F 7B 7A 73 3F 30 6E 3F 3D 3A 6C 3D 3F 21 21 3F 51 4A 53 }
        $enc_20 = { 0F 43 00 53 59 53 54 45 4D 49 4E 46 4F 00 1E 6E 75 6C 00 06 00 44 45 4C 00 0F 51 00 02 05 53 02 00 1E 1E 00 6E 75 6C }
        $enc_21 = { 0E 42 01 52 58 52 55 44 4C 48 4F 47 4E 01 1F 6F 74 6D 01 07 01 45 44 4D 01 0E 50 01 03 04 52 03 01 1F 1F 01 6F 74 6D }
        $enc_22 = { 0D 41 02 51 5B 51 56 47 4F 4B 4C 44 4D 02 1C 6C 77 6E 02 04 02 46 47 4E 02 0D 53 02 00 07 51 00 02 1C 1C 02 6C 77 6E }
        $enc_23 = { 0C 40 03 50 5A 50 57 46 4E 4A 4D 45 4C 03 1D 6D 76 6F 03 05 03 47 46 4F 03 0C 52 03 01 06 50 01 03 1D 1D 03 6D 76 6F }
        $enc_24 = { 0B 47 04 57 5D 57 50 41 49 4D 4A 42 4B 04 1A 6A 71 68 04 02 04 40 41 48 04 0B 55 04 06 01 57 06 04 1A 1A 04 6A 71 68 }
        $enc_25 = { 0A 46 05 56 5C 56 51 40 48 4C 4B 43 4A 05 1B 6B 70 69 05 03 05 41 40 49 05 0A 54 05 07 00 56 07 05 1B 1B 05 6B 70 69 }
        $enc_26 = { 09 45 06 55 5F 55 52 43 4B 4F 48 40 49 06 18 68 73 6A 06 00 06 42 43 4A 06 09 57 06 04 03 55 04 06 18 18 06 68 73 6A }
        $enc_27 = { 08 44 07 54 5E 54 53 42 4A 4E 49 41 48 07 19 69 72 6B 07 01 07 43 42 4B 07 08 56 07 05 02 54 05 07 19 19 07 69 72 6B }
        $enc_28 = { 07 4B 08 5B 51 5B 5C 4D 45 41 46 4E 47 08 16 66 7D 64 08 0E 08 4C 4D 44 08 07 59 08 0A 0D 5B 0A 08 16 16 08 66 7D 64 }
        $enc_29 = { 06 4A 09 5A 50 5A 5D 4C 44 40 47 4F 46 09 17 67 7C 65 09 0F 09 4D 4C 45 09 06 58 09 0B 0C 5A 0B 09 17 17 09 67 7C 65 }
        $enc_2A = { 05 49 0A 59 53 59 5E 4F 47 43 44 4C 45 0A 14 64 7F 66 0A 0C 0A 4E 4F 46 0A 05 5B 0A 08 0F 59 08 0A 14 14 0A 64 7F 66 }
        $enc_2B = { 04 48 0B 58 52 58 5F 4E 46 42 45 4D 44 0B 15 65 7E 67 0B 0D 0B 4F 4E 47 0B 04 5A 0B 09 0E 58 09 0B 15 15 0B 65 7E 67 }
        $enc_2C = { 03 4F 0C 5F 55 5F 58 49 41 45 42 4A 43 0C 12 62 79 60 0C 0A 0C 48 49 40 0C 03 5D 0C 0E 09 5F 0E 0C 12 12 0C 62 79 60 }
        $enc_2D = { 02 4E 0D 5E 54 5E 59 48 40 44 43 4B 42 0D 13 63 78 61 0D 0B 0D 49 48 41 0D 02 5C 0D 0F 08 5E 0F 0D 13 13 0D 63 78 61 }
        $enc_2E = { 01 4D 0E 5D 57 5D 5A 4B 43 47 40 48 41 0E 10 60 7B 62 0E 08 0E 4A 4B 42 0E 01 5F 0E 0C 0B 5D 0C 0E 10 10 0E 60 7B 62 }
        $enc_2F = { 00 4C 0F 5C 56 5C 5B 4A 42 46 41 49 40 0F 11 61 7A 63 0F 09 0F 4B 4A 43 0F 00 5E 0F 0D 0A 5C 0D 0F 11 11 0F 61 7A 63 }
        $enc_30 = { 1F 53 10 43 49 43 44 55 5D 59 5E 56 5F 10 0E 7E 65 7C 10 16 10 54 55 5C 10 1F 41 10 12 15 43 12 10 0E 0E 10 7E 65 7C }
        $enc_31 = { 1E 52 11 42 48 42 45 54 5C 58 5F 57 5E 11 0F 7F 64 7D 11 17 11 55 54 5D 11 1E 40 11 13 14 42 13 11 0F 0F 11 7F 64 7D }
        $enc_32 = { 1D 51 12 41 4B 41 46 57 5F 5B 5C 54 5D 12 0C 7C 67 7E 12 14 12 56 57 5E 12 1D 43 12 10 17 41 10 12 0C 0C 12 7C 67 7E }
        $enc_33 = { 1C 50 13 40 4A 40 47 56 5E 5A 5D 55 5C 13 0D 7D 66 7F 13 15 13 57 56 5F 13 1C 42 13 11 16 40 11 13 0D 0D 13 7D 66 7F }
        $enc_34 = { 1B 57 14 47 4D 47 40 51 59 5D 5A 52 5B 14 0A 7A 61 78 14 12 14 50 51 58 14 1B 45 14 16 11 47 16 14 0A 0A 14 7A 61 78 }
        $enc_35 = { 1A 56 15 46 4C 46 41 50 58 5C 5B 53 5A 15 0B 7B 60 79 15 13 15 51 50 59 15 1A 44 15 17 10 46 17 15 0B 0B 15 7B 60 79 }
        $enc_36 = { 19 55 16 45 4F 45 42 53 5B 5F 58 50 59 16 08 78 63 7A 16 10 16 52 53 5A 16 19 47 16 14 13 45 14 16 08 08 16 78 63 7A }
        $enc_37 = { 18 54 17 44 4E 44 43 52 5A 5E 59 51 58 17 09 79 62 7B 17 11 17 53 52 5B 17 18 46 17 15 12 44 15 17 09 09 17 79 62 7B }
        $enc_38 = { 17 5B 18 4B 41 4B 4C 5D 55 51 56 5E 57 18 06 76 6D 74 18 1E 18 5C 5D 54 18 17 49 18 1A 1D 4B 1A 18 06 06 18 76 6D 74 }
        $enc_39 = { 16 5A 19 4A 40 4A 4D 5C 54 50 57 5F 56 19 07 77 6C 75 19 1F 19 5D 5C 55 19 16 48 19 1B 1C 4A 1B 19 07 07 19 77 6C 75 }
        $enc_3A = { 15 59 1A 49 43 49 4E 5F 57 53 54 5C 55 1A 04 74 6F 76 1A 1C 1A 5E 5F 56 1A 15 4B 1A 18 1F 49 18 1A 04 04 1A 74 6F 76 }
        $enc_3B = { 14 58 1B 48 42 48 4F 5E 56 52 55 5D 54 1B 05 75 6E 77 1B 1D 1B 5F 5E 57 1B 14 4A 1B 19 1E 48 19 1B 05 05 1B 75 6E 77 }
        $enc_3C = { 13 5F 1C 4F 45 4F 48 59 51 55 52 5A 53 1C 02 72 69 70 1C 1A 1C 58 59 50 1C 13 4D 1C 1E 19 4F 1E 1C 02 02 1C 72 69 70 }
        $enc_3D = { 12 5E 1D 4E 44 4E 49 58 50 54 53 5B 52 1D 03 73 68 71 1D 1B 1D 59 58 51 1D 12 4C 1D 1F 18 4E 1F 1D 03 03 1D 73 68 71 }
        $enc_3E = { 11 5D 1E 4D 47 4D 4A 5B 53 57 50 58 51 1E 00 70 6B 72 1E 18 1E 5A 5B 52 1E 11 4F 1E 1C 1B 4D 1C 1E 00 00 1E 70 6B 72 }
        $enc_3F = { 10 5C 1F 4C 46 4C 4B 5A 52 56 51 59 50 1F 01 71 6A 73 1F 19 1F 5B 5A 53 1F 10 4E 1F 1D 1A 4C 1D 1F 01 01 1F 71 6A 73 }
        $enc_40 = { 6F 23 60 33 39 33 34 25 2D 29 2E 26 2F 60 7E 0E 15 0C 60 66 60 24 25 2C 60 6F 31 60 62 65 33 62 60 7E 7E 60 0E 15 0C }
        $enc_41 = { 6E 22 61 32 38 32 35 24 2C 28 2F 27 2E 61 7F 0F 14 0D 61 67 61 25 24 2D 61 6E 30 61 63 64 32 63 61 7F 7F 61 0F 14 0D }
        $enc_42 = { 6D 21 62 31 3B 31 36 27 2F 2B 2C 24 2D 62 7C 0C 17 0E 62 64 62 26 27 2E 62 6D 33 62 60 67 31 60 62 7C 7C 62 0C 17 0E }
        $enc_43 = { 6C 20 63 30 3A 30 37 26 2E 2A 2D 25 2C 63 7D 0D 16 0F 63 65 63 27 26 2F 63 6C 32 63 61 66 30 61 63 7D 7D 63 0D 16 0F }
        $enc_44 = { 6B 27 64 37 3D 37 30 21 29 2D 2A 22 2B 64 7A 0A 11 08 64 62 64 20 21 28 64 6B 35 64 66 61 37 66 64 7A 7A 64 0A 11 08 }
        $enc_45 = { 6A 26 65 36 3C 36 31 20 28 2C 2B 23 2A 65 7B 0B 10 09 65 63 65 21 20 29 65 6A 34 65 67 60 36 67 65 7B 7B 65 0B 10 09 }
        $enc_46 = { 69 25 66 35 3F 35 32 23 2B 2F 28 20 29 66 78 08 13 0A 66 60 66 22 23 2A 66 69 37 66 64 63 35 64 66 78 78 66 08 13 0A }
        $enc_47 = { 68 24 67 34 3E 34 33 22 2A 2E 29 21 28 67 79 09 12 0B 67 61 67 23 22 2B 67 68 36 67 65 62 34 65 67 79 79 67 09 12 0B }
        $enc_48 = { 67 2B 68 3B 31 3B 3C 2D 25 21 26 2E 27 68 76 06 1D 04 68 6E 68 2C 2D 24 68 67 39 68 6A 6D 3B 6A 68 76 76 68 06 1D 04 }
        $enc_49 = { 66 2A 69 3A 30 3A 3D 2C 24 20 27 2F 26 69 77 07 1C 05 69 6F 69 2D 2C 25 69 66 38 69 6B 6C 3A 6B 69 77 77 69 07 1C 05 }
        $enc_4A = { 65 29 6A 39 33 39 3E 2F 27 23 24 2C 25 6A 74 04 1F 06 6A 6C 6A 2E 2F 26 6A 65 3B 6A 68 6F 39 68 6A 74 74 6A 04 1F 06 }
        $enc_4B = { 64 28 6B 38 32 38 3F 2E 26 22 25 2D 24 6B 75 05 1E 07 6B 6D 6B 2F 2E 27 6B 64 3A 6B 69 6E 38 69 6B 75 75 6B 05 1E 07 }
        $enc_4C = { 63 2F 6C 3F 35 3F 38 29 21 25 22 2A 23 6C 72 02 19 00 6C 6A 6C 28 29 20 6C 63 3D 6C 6E 69 3F 6E 6C 72 72 6C 02 19 00 }
        $enc_4D = { 62 2E 6D 3E 34 3E 39 28 20 24 23 2B 22 6D 73 03 18 01 6D 6B 6D 29 28 21 6D 62 3C 6D 6F 68 3E 6F 6D 73 73 6D 03 18 01 }
        $enc_4E = { 61 2D 6E 3D 37 3D 3A 2B 23 27 20 28 21 6E 70 00 1B 02 6E 68 6E 2A 2B 22 6E 61 3F 6E 6C 6B 3D 6C 6E 70 70 6E 00 1B 02 }
        $enc_4F = { 60 2C 6F 3C 36 3C 3B 2A 22 26 21 29 20 6F 71 01 1A 03 6F 69 6F 2B 2A 23 6F 60 3E 6F 6D 6A 3C 6D 6F 71 71 6F 01 1A 03 }
        $enc_50 = { 7F 33 70 23 29 23 24 35 3D 39 3E 36 3F 70 6E 1E 05 1C 70 76 70 34 35 3C 70 7F 21 70 72 75 23 72 70 6E 6E 70 1E 05 1C }
        $enc_51 = { 7E 32 71 22 28 22 25 34 3C 38 3F 37 3E 71 6F 1F 04 1D 71 77 71 35 34 3D 71 7E 20 71 73 74 22 73 71 6F 6F 71 1F 04 1D }
        $enc_52 = { 7D 31 72 21 2B 21 26 37 3F 3B 3C 34 3D 72 6C 1C 07 1E 72 74 72 36 37 3E 72 7D 23 72 70 77 21 70 72 6C 6C 72 1C 07 1E }
        $enc_53 = { 7C 30 73 20 2A 20 27 36 3E 3A 3D 35 3C 73 6D 1D 06 1F 73 75 73 37 36 3F 73 7C 22 73 71 76 20 71 73 6D 6D 73 1D 06 1F }
        $enc_54 = { 7B 37 74 27 2D 27 20 31 39 3D 3A 32 3B 74 6A 1A 01 18 74 72 74 30 31 38 74 7B 25 74 76 71 27 76 74 6A 6A 74 1A 01 18 }
        $enc_55 = { 7A 36 75 26 2C 26 21 30 38 3C 3B 33 3A 75 6B 1B 00 19 75 73 75 31 30 39 75 7A 24 75 77 70 26 77 75 6B 6B 75 1B 00 19 }
        $enc_56 = { 79 35 76 25 2F 25 22 33 3B 3F 38 30 39 76 68 18 03 1A 76 70 76 32 33 3A 76 79 27 76 74 73 25 74 76 68 68 76 18 03 1A }
        $enc_57 = { 78 34 77 24 2E 24 23 32 3A 3E 39 31 38 77 69 19 02 1B 77 71 77 33 32 3B 77 78 26 77 75 72 24 75 77 69 69 77 19 02 1B }
        $enc_58 = { 77 3B 78 2B 21 2B 2C 3D 35 31 36 3E 37 78 66 16 0D 14 78 7E 78 3C 3D 34 78 77 29 78 7A 7D 2B 7A 78 66 66 78 16 0D 14 }
        $enc_59 = { 76 3A 79 2A 20 2A 2D 3C 34 30 37 3F 36 79 67 17 0C 15 79 7F 79 3D 3C 35 79 76 28 79 7B 7C 2A 7B 79 67 67 79 17 0C 15 }
        $enc_5A = { 75 39 7A 29 23 29 2E 3F 37 33 34 3C 35 7A 64 14 0F 16 7A 7C 7A 3E 3F 36 7A 75 2B 7A 78 7F 29 78 7A 64 64 7A 14 0F 16 }
        $enc_5B = { 74 38 7B 28 22 28 2F 3E 36 32 35 3D 34 7B 65 15 0E 17 7B 7D 7B 3F 3E 37 7B 74 2A 7B 79 7E 28 79 7B 65 65 7B 15 0E 17 }
        $enc_5C = { 73 3F 7C 2F 25 2F 28 39 31 35 32 3A 33 7C 62 12 09 10 7C 7A 7C 38 39 30 7C 73 2D 7C 7E 79 2F 7E 7C 62 62 7C 12 09 10 }
        $enc_5D = { 72 3E 7D 2E 24 2E 29 38 30 34 33 3B 32 7D 63 13 08 11 7D 7B 7D 39 38 31 7D 72 2C 7D 7F 78 2E 7F 7D 63 63 7D 13 08 11 }
        $enc_5E = { 71 3D 7E 2D 27 2D 2A 3B 33 37 30 38 31 7E 60 10 0B 12 7E 78 7E 3A 3B 32 7E 71 2F 7E 7C 7B 2D 7C 7E 60 60 7E 10 0B 12 }
        $enc_5F = { 70 3C 7F 2C 26 2C 2B 3A 32 36 31 39 30 7F 61 11 0A 13 7F 79 7F 3B 3A 33 7F 70 2E 7F 7D 7A 2C 7D 7F 61 61 7F 11 0A 13 }
        $enc_60 = { 4F 03 40 13 19 13 14 05 0D 09 0E 06 0F 40 5E 2E 35 2C 40 46 40 04 05 0C 40 4F 11 40 42 45 13 42 40 5E 5E 40 2E 35 2C }
        $enc_61 = { 4E 02 41 12 18 12 15 04 0C 08 0F 07 0E 41 5F 2F 34 2D 41 47 41 05 04 0D 41 4E 10 41 43 44 12 43 41 5F 5F 41 2F 34 2D }
        $enc_62 = { 4D 01 42 11 1B 11 16 07 0F 0B 0C 04 0D 42 5C 2C 37 2E 42 44 42 06 07 0E 42 4D 13 42 40 47 11 40 42 5C 5C 42 2C 37 2E }
        $enc_63 = { 4C 00 43 10 1A 10 17 06 0E 0A 0D 05 0C 43 5D 2D 36 2F 43 45 43 07 06 0F 43 4C 12 43 41 46 10 41 43 5D 5D 43 2D 36 2F }
        $enc_64 = { 4B 07 44 17 1D 17 10 01 09 0D 0A 02 0B 44 5A 2A 31 28 44 42 44 00 01 08 44 4B 15 44 46 41 17 46 44 5A 5A 44 2A 31 28 }
        $enc_65 = { 4A 06 45 16 1C 16 11 00 08 0C 0B 03 0A 45 5B 2B 30 29 45 43 45 01 00 09 45 4A 14 45 47 40 16 47 45 5B 5B 45 2B 30 29 }
        $enc_66 = { 49 05 46 15 1F 15 12 03 0B 0F 08 00 09 46 58 28 33 2A 46 40 46 02 03 0A 46 49 17 46 44 43 15 44 46 58 58 46 28 33 2A }
        $enc_67 = { 48 04 47 14 1E 14 13 02 0A 0E 09 01 08 47 59 29 32 2B 47 41 47 03 02 0B 47 48 16 47 45 42 14 45 47 59 59 47 29 32 2B }
        $enc_68 = { 47 0B 48 1B 11 1B 1C 0D 05 01 06 0E 07 48 56 26 3D 24 48 4E 48 0C 0D 04 48 47 19 48 4A 4D 1B 4A 48 56 56 48 26 3D 24 }
        $enc_69 = { 46 0A 49 1A 10 1A 1D 0C 04 00 07 0F 06 49 57 27 3C 25 49 4F 49 0D 0C 05 49 46 18 49 4B 4C 1A 4B 49 57 57 49 27 3C 25 }
        $enc_6A = { 45 09 4A 19 13 19 1E 0F 07 03 04 0C 05 4A 54 24 3F 26 4A 4C 4A 0E 0F 06 4A 45 1B 4A 48 4F 19 48 4A 54 54 4A 24 3F 26 }
        $enc_6B = { 44 08 4B 18 12 18 1F 0E 06 02 05 0D 04 4B 55 25 3E 27 4B 4D 4B 0F 0E 07 4B 44 1A 4B 49 4E 18 49 4B 55 55 4B 25 3E 27 }
        $enc_6C = { 43 0F 4C 1F 15 1F 18 09 01 05 02 0A 03 4C 52 22 39 20 4C 4A 4C 08 09 00 4C 43 1D 4C 4E 49 1F 4E 4C 52 52 4C 22 39 20 }
        $enc_6D = { 42 0E 4D 1E 14 1E 19 08 00 04 03 0B 02 4D 53 23 38 21 4D 4B 4D 09 08 01 4D 42 1C 4D 4F 48 1E 4F 4D 53 53 4D 23 38 21 }
        $enc_6E = { 41 0D 4E 1D 17 1D 1A 0B 03 07 00 08 01 4E 50 20 3B 22 4E 48 4E 0A 0B 02 4E 41 1F 4E 4C 4B 1D 4C 4E 50 50 4E 20 3B 22 }
        $enc_6F = { 40 0C 4F 1C 16 1C 1B 0A 02 06 01 09 00 4F 51 21 3A 23 4F 49 4F 0B 0A 03 4F 40 1E 4F 4D 4A 1C 4D 4F 51 51 4F 21 3A 23 }
        $enc_70 = { 5F 13 50 03 09 03 04 15 1D 19 1E 16 1F 50 4E 3E 25 3C 50 56 50 14 15 1C 50 5F 01 50 52 55 03 52 50 4E 4E 50 3E 25 3C }
        $enc_71 = { 5E 12 51 02 08 02 05 14 1C 18 1F 17 1E 51 4F 3F 24 3D 51 57 51 15 14 1D 51 5E 00 51 53 54 02 53 51 4F 4F 51 3F 24 3D }
        $enc_72 = { 5D 11 52 01 0B 01 06 17 1F 1B 1C 14 1D 52 4C 3C 27 3E 52 54 52 16 17 1E 52 5D 03 52 50 57 01 50 52 4C 4C 52 3C 27 3E }
        $enc_73 = { 5C 10 53 00 0A 00 07 16 1E 1A 1D 15 1C 53 4D 3D 26 3F 53 55 53 17 16 1F 53 5C 02 53 51 56 00 51 53 4D 4D 53 3D 26 3F }
        $enc_74 = { 5B 17 54 07 0D 07 00 11 19 1D 1A 12 1B 54 4A 3A 21 38 54 52 54 10 11 18 54 5B 05 54 56 51 07 56 54 4A 4A 54 3A 21 38 }
        $enc_75 = { 5A 16 55 06 0C 06 01 10 18 1C 1B 13 1A 55 4B 3B 20 39 55 53 55 11 10 19 55 5A 04 55 57 50 06 57 55 4B 4B 55 3B 20 39 }
        $enc_76 = { 59 15 56 05 0F 05 02 13 1B 1F 18 10 19 56 48 38 23 3A 56 50 56 12 13 1A 56 59 07 56 54 53 05 54 56 48 48 56 38 23 3A }
        $enc_77 = { 58 14 57 04 0E 04 03 12 1A 1E 19 11 18 57 49 39 22 3B 57 51 57 13 12 1B 57 58 06 57 55 52 04 55 57 49 49 57 39 22 3B }
        $enc_78 = { 57 1B 58 0B 01 0B 0C 1D 15 11 16 1E 17 58 46 36 2D 34 58 5E 58 1C 1D 14 58 57 09 58 5A 5D 0B 5A 58 46 46 58 36 2D 34 }
        $enc_79 = { 56 1A 59 0A 00 0A 0D 1C 14 10 17 1F 16 59 47 37 2C 35 59 5F 59 1D 1C 15 59 56 08 59 5B 5C 0A 5B 59 47 47 59 37 2C 35 }
        $enc_7A = { 55 19 5A 09 03 09 0E 1F 17 13 14 1C 15 5A 44 34 2F 36 5A 5C 5A 1E 1F 16 5A 55 0B 5A 58 5F 09 58 5A 44 44 5A 34 2F 36 }
        $enc_7B = { 54 18 5B 08 02 08 0F 1E 16 12 15 1D 14 5B 45 35 2E 37 5B 5D 5B 1F 1E 17 5B 54 0A 5B 59 5E 08 59 5B 45 45 5B 35 2E 37 }
        $enc_7C = { 53 1F 5C 0F 05 0F 08 19 11 15 12 1A 13 5C 42 32 29 30 5C 5A 5C 18 19 10 5C 53 0D 5C 5E 59 0F 5E 5C 42 42 5C 32 29 30 }
        $enc_7D = { 52 1E 5D 0E 04 0E 09 18 10 14 13 1B 12 5D 43 33 28 31 5D 5B 5D 19 18 11 5D 52 0C 5D 5F 58 0E 5F 5D 43 43 5D 33 28 31 }
        $enc_7E = { 51 1D 5E 0D 07 0D 0A 1B 13 17 10 18 11 5E 40 30 2B 32 5E 58 5E 1A 1B 12 5E 51 0F 5E 5C 5B 0D 5C 5E 40 40 5E 30 2B 32 }
        $enc_7F = { 50 1C 5F 0C 06 0C 0B 1A 12 16 11 19 10 5F 41 31 2A 33 5F 59 5F 1B 1A 13 5F 50 0E 5F 5D 5A 0C 5D 5F 41 41 5F 31 2A 33 }
        $enc_80 = { AF E3 A0 F3 F9 F3 F4 E5 ED E9 EE E6 EF A0 BE CE D5 CC A0 A6 A0 E4 E5 EC A0 AF F1 A0 A2 A5 F3 A2 A0 BE BE A0 CE D5 CC }
        $enc_81 = { AE E2 A1 F2 F8 F2 F5 E4 EC E8 EF E7 EE A1 BF CF D4 CD A1 A7 A1 E5 E4 ED A1 AE F0 A1 A3 A4 F2 A3 A1 BF BF A1 CF D4 CD }
        $enc_82 = { AD E1 A2 F1 FB F1 F6 E7 EF EB EC E4 ED A2 BC CC D7 CE A2 A4 A2 E6 E7 EE A2 AD F3 A2 A0 A7 F1 A0 A2 BC BC A2 CC D7 CE }
        $enc_83 = { AC E0 A3 F0 FA F0 F7 E6 EE EA ED E5 EC A3 BD CD D6 CF A3 A5 A3 E7 E6 EF A3 AC F2 A3 A1 A6 F0 A1 A3 BD BD A3 CD D6 CF }
        $enc_84 = { AB E7 A4 F7 FD F7 F0 E1 E9 ED EA E2 EB A4 BA CA D1 C8 A4 A2 A4 E0 E1 E8 A4 AB F5 A4 A6 A1 F7 A6 A4 BA BA A4 CA D1 C8 }
        $enc_85 = { AA E6 A5 F6 FC F6 F1 E0 E8 EC EB E3 EA A5 BB CB D0 C9 A5 A3 A5 E1 E0 E9 A5 AA F4 A5 A7 A0 F6 A7 A5 BB BB A5 CB D0 C9 }
        $enc_86 = { A9 E5 A6 F5 FF F5 F2 E3 EB EF E8 E0 E9 A6 B8 C8 D3 CA A6 A0 A6 E2 E3 EA A6 A9 F7 A6 A4 A3 F5 A4 A6 B8 B8 A6 C8 D3 CA }
        $enc_87 = { A8 E4 A7 F4 FE F4 F3 E2 EA EE E9 E1 E8 A7 B9 C9 D2 CB A7 A1 A7 E3 E2 EB A7 A8 F6 A7 A5 A2 F4 A5 A7 B9 B9 A7 C9 D2 CB }
        $enc_88 = { A7 EB A8 FB F1 FB FC ED E5 E1 E6 EE E7 A8 B6 C6 DD C4 A8 AE A8 EC ED E4 A8 A7 F9 A8 AA AD FB AA A8 B6 B6 A8 C6 DD C4 }
        $enc_89 = { A6 EA A9 FA F0 FA FD EC E4 E0 E7 EF E6 A9 B7 C7 DC C5 A9 AF A9 ED EC E5 A9 A6 F8 A9 AB AC FA AB A9 B7 B7 A9 C7 DC C5 }
        $enc_8A = { A5 E9 AA F9 F3 F9 FE EF E7 E3 E4 EC E5 AA B4 C4 DF C6 AA AC AA EE EF E6 AA A5 FB AA A8 AF F9 A8 AA B4 B4 AA C4 DF C6 }
        $enc_8B = { A4 E8 AB F8 F2 F8 FF EE E6 E2 E5 ED E4 AB B5 C5 DE C7 AB AD AB EF EE E7 AB A4 FA AB A9 AE F8 A9 AB B5 B5 AB C5 DE C7 }
        $enc_8C = { A3 EF AC FF F5 FF F8 E9 E1 E5 E2 EA E3 AC B2 C2 D9 C0 AC AA AC E8 E9 E0 AC A3 FD AC AE A9 FF AE AC B2 B2 AC C2 D9 C0 }
        $enc_8D = { A2 EE AD FE F4 FE F9 E8 E0 E4 E3 EB E2 AD B3 C3 D8 C1 AD AB AD E9 E8 E1 AD A2 FC AD AF A8 FE AF AD B3 B3 AD C3 D8 C1 }
        $enc_8E = { A1 ED AE FD F7 FD FA EB E3 E7 E0 E8 E1 AE B0 C0 DB C2 AE A8 AE EA EB E2 AE A1 FF AE AC AB FD AC AE B0 B0 AE C0 DB C2 }
        $enc_8F = { A0 EC AF FC F6 FC FB EA E2 E6 E1 E9 E0 AF B1 C1 DA C3 AF A9 AF EB EA E3 AF A0 FE AF AD AA FC AD AF B1 B1 AF C1 DA C3 }
        $enc_90 = { BF F3 B0 E3 E9 E3 E4 F5 FD F9 FE F6 FF B0 AE DE C5 DC B0 B6 B0 F4 F5 FC B0 BF E1 B0 B2 B5 E3 B2 B0 AE AE B0 DE C5 DC }
        $enc_91 = { BE F2 B1 E2 E8 E2 E5 F4 FC F8 FF F7 FE B1 AF DF C4 DD B1 B7 B1 F5 F4 FD B1 BE E0 B1 B3 B4 E2 B3 B1 AF AF B1 DF C4 DD }
        $enc_92 = { BD F1 B2 E1 EB E1 E6 F7 FF FB FC F4 FD B2 AC DC C7 DE B2 B4 B2 F6 F7 FE B2 BD E3 B2 B0 B7 E1 B0 B2 AC AC B2 DC C7 DE }
        $enc_93 = { BC F0 B3 E0 EA E0 E7 F6 FE FA FD F5 FC B3 AD DD C6 DF B3 B5 B3 F7 F6 FF B3 BC E2 B3 B1 B6 E0 B1 B3 AD AD B3 DD C6 DF }
        $enc_94 = { BB F7 B4 E7 ED E7 E0 F1 F9 FD FA F2 FB B4 AA DA C1 D8 B4 B2 B4 F0 F1 F8 B4 BB E5 B4 B6 B1 E7 B6 B4 AA AA B4 DA C1 D8 }
        $enc_95 = { BA F6 B5 E6 EC E6 E1 F0 F8 FC FB F3 FA B5 AB DB C0 D9 B5 B3 B5 F1 F0 F9 B5 BA E4 B5 B7 B0 E6 B7 B5 AB AB B5 DB C0 D9 }
        $enc_96 = { B9 F5 B6 E5 EF E5 E2 F3 FB FF F8 F0 F9 B6 A8 D8 C3 DA B6 B0 B6 F2 F3 FA B6 B9 E7 B6 B4 B3 E5 B4 B6 A8 A8 B6 D8 C3 DA }
        $enc_97 = { B8 F4 B7 E4 EE E4 E3 F2 FA FE F9 F1 F8 B7 A9 D9 C2 DB B7 B1 B7 F3 F2 FB B7 B8 E6 B7 B5 B2 E4 B5 B7 A9 A9 B7 D9 C2 DB }
        $enc_98 = { B7 FB B8 EB E1 EB EC FD F5 F1 F6 FE F7 B8 A6 D6 CD D4 B8 BE B8 FC FD F4 B8 B7 E9 B8 BA BD EB BA B8 A6 A6 B8 D6 CD D4 }
        $enc_99 = { B6 FA B9 EA E0 EA ED FC F4 F0 F7 FF F6 B9 A7 D7 CC D5 B9 BF B9 FD FC F5 B9 B6 E8 B9 BB BC EA BB B9 A7 A7 B9 D7 CC D5 }
        $enc_9A = { B5 F9 BA E9 E3 E9 EE FF F7 F3 F4 FC F5 BA A4 D4 CF D6 BA BC BA FE FF F6 BA B5 EB BA B8 BF E9 B8 BA A4 A4 BA D4 CF D6 }
        $enc_9B = { B4 F8 BB E8 E2 E8 EF FE F6 F2 F5 FD F4 BB A5 D5 CE D7 BB BD BB FF FE F7 BB B4 EA BB B9 BE E8 B9 BB A5 A5 BB D5 CE D7 }
        $enc_9C = { B3 FF BC EF E5 EF E8 F9 F1 F5 F2 FA F3 BC A2 D2 C9 D0 BC BA BC F8 F9 F0 BC B3 ED BC BE B9 EF BE BC A2 A2 BC D2 C9 D0 }
        $enc_9D = { B2 FE BD EE E4 EE E9 F8 F0 F4 F3 FB F2 BD A3 D3 C8 D1 BD BB BD F9 F8 F1 BD B2 EC BD BF B8 EE BF BD A3 A3 BD D3 C8 D1 }
        $enc_9E = { B1 FD BE ED E7 ED EA FB F3 F7 F0 F8 F1 BE A0 D0 CB D2 BE B8 BE FA FB F2 BE B1 EF BE BC BB ED BC BE A0 A0 BE D0 CB D2 }
        $enc_9F = { B0 FC BF EC E6 EC EB FA F2 F6 F1 F9 F0 BF A1 D1 CA D3 BF B9 BF FB FA F3 BF B0 EE BF BD BA EC BD BF A1 A1 BF D1 CA D3 }
        $enc_A0 = { 8F C3 80 D3 D9 D3 D4 C5 CD C9 CE C6 CF 80 9E EE F5 EC 80 86 80 C4 C5 CC 80 8F D1 80 82 85 D3 82 80 9E 9E 80 EE F5 EC }
        $enc_A1 = { 8E C2 81 D2 D8 D2 D5 C4 CC C8 CF C7 CE 81 9F EF F4 ED 81 87 81 C5 C4 CD 81 8E D0 81 83 84 D2 83 81 9F 9F 81 EF F4 ED }
        $enc_A2 = { 8D C1 82 D1 DB D1 D6 C7 CF CB CC C4 CD 82 9C EC F7 EE 82 84 82 C6 C7 CE 82 8D D3 82 80 87 D1 80 82 9C 9C 82 EC F7 EE }
        $enc_A3 = { 8C C0 83 D0 DA D0 D7 C6 CE CA CD C5 CC 83 9D ED F6 EF 83 85 83 C7 C6 CF 83 8C D2 83 81 86 D0 81 83 9D 9D 83 ED F6 EF }
        $enc_A4 = { 8B C7 84 D7 DD D7 D0 C1 C9 CD CA C2 CB 84 9A EA F1 E8 84 82 84 C0 C1 C8 84 8B D5 84 86 81 D7 86 84 9A 9A 84 EA F1 E8 }
        $enc_A5 = { 8A C6 85 D6 DC D6 D1 C0 C8 CC CB C3 CA 85 9B EB F0 E9 85 83 85 C1 C0 C9 85 8A D4 85 87 80 D6 87 85 9B 9B 85 EB F0 E9 }
        $enc_A6 = { 89 C5 86 D5 DF D5 D2 C3 CB CF C8 C0 C9 86 98 E8 F3 EA 86 80 86 C2 C3 CA 86 89 D7 86 84 83 D5 84 86 98 98 86 E8 F3 EA }
        $enc_A7 = { 88 C4 87 D4 DE D4 D3 C2 CA CE C9 C1 C8 87 99 E9 F2 EB 87 81 87 C3 C2 CB 87 88 D6 87 85 82 D4 85 87 99 99 87 E9 F2 EB }
        $enc_A8 = { 87 CB 88 DB D1 DB DC CD C5 C1 C6 CE C7 88 96 E6 FD E4 88 8E 88 CC CD C4 88 87 D9 88 8A 8D DB 8A 88 96 96 88 E6 FD E4 }
        $enc_A9 = { 86 CA 89 DA D0 DA DD CC C4 C0 C7 CF C6 89 97 E7 FC E5 89 8F 89 CD CC C5 89 86 D8 89 8B 8C DA 8B 89 97 97 89 E7 FC E5 }
        $enc_AA = { 85 C9 8A D9 D3 D9 DE CF C7 C3 C4 CC C5 8A 94 E4 FF E6 8A 8C 8A CE CF C6 8A 85 DB 8A 88 8F D9 88 8A 94 94 8A E4 FF E6 }
        $enc_AB = { 84 C8 8B D8 D2 D8 DF CE C6 C2 C5 CD C4 8B 95 E5 FE E7 8B 8D 8B CF CE C7 8B 84 DA 8B 89 8E D8 89 8B 95 95 8B E5 FE E7 }
        $enc_AC = { 83 CF 8C DF D5 DF D8 C9 C1 C5 C2 CA C3 8C 92 E2 F9 E0 8C 8A 8C C8 C9 C0 8C 83 DD 8C 8E 89 DF 8E 8C 92 92 8C E2 F9 E0 }
        $enc_AD = { 82 CE 8D DE D4 DE D9 C8 C0 C4 C3 CB C2 8D 93 E3 F8 E1 8D 8B 8D C9 C8 C1 8D 82 DC 8D 8F 88 DE 8F 8D 93 93 8D E3 F8 E1 }
        $enc_AE = { 81 CD 8E DD D7 DD DA CB C3 C7 C0 C8 C1 8E 90 E0 FB E2 8E 88 8E CA CB C2 8E 81 DF 8E 8C 8B DD 8C 8E 90 90 8E E0 FB E2 }
        $enc_AF = { 80 CC 8F DC D6 DC DB CA C2 C6 C1 C9 C0 8F 91 E1 FA E3 8F 89 8F CB CA C3 8F 80 DE 8F 8D 8A DC 8D 8F 91 91 8F E1 FA E3 }
        $enc_B0 = { 9F D3 90 C3 C9 C3 C4 D5 DD D9 DE D6 DF 90 8E FE E5 FC 90 96 90 D4 D5 DC 90 9F C1 90 92 95 C3 92 90 8E 8E 90 FE E5 FC }
        $enc_B1 = { 9E D2 91 C2 C8 C2 C5 D4 DC D8 DF D7 DE 91 8F FF E4 FD 91 97 91 D5 D4 DD 91 9E C0 91 93 94 C2 93 91 8F 8F 91 FF E4 FD }
        $enc_B2 = { 9D D1 92 C1 CB C1 C6 D7 DF DB DC D4 DD 92 8C FC E7 FE 92 94 92 D6 D7 DE 92 9D C3 92 90 97 C1 90 92 8C 8C 92 FC E7 FE }
        $enc_B3 = { 9C D0 93 C0 CA C0 C7 D6 DE DA DD D5 DC 93 8D FD E6 FF 93 95 93 D7 D6 DF 93 9C C2 93 91 96 C0 91 93 8D 8D 93 FD E6 FF }
        $enc_B4 = { 9B D7 94 C7 CD C7 C0 D1 D9 DD DA D2 DB 94 8A FA E1 F8 94 92 94 D0 D1 D8 94 9B C5 94 96 91 C7 96 94 8A 8A 94 FA E1 F8 }
        $enc_B5 = { 9A D6 95 C6 CC C6 C1 D0 D8 DC DB D3 DA 95 8B FB E0 F9 95 93 95 D1 D0 D9 95 9A C4 95 97 90 C6 97 95 8B 8B 95 FB E0 F9 }
        $enc_B6 = { 99 D5 96 C5 CF C5 C2 D3 DB DF D8 D0 D9 96 88 F8 E3 FA 96 90 96 D2 D3 DA 96 99 C7 96 94 93 C5 94 96 88 88 96 F8 E3 FA }
        $enc_B7 = { 98 D4 97 C4 CE C4 C3 D2 DA DE D9 D1 D8 97 89 F9 E2 FB 97 91 97 D3 D2 DB 97 98 C6 97 95 92 C4 95 97 89 89 97 F9 E2 FB }
        $enc_B8 = { 97 DB 98 CB C1 CB CC DD D5 D1 D6 DE D7 98 86 F6 ED F4 98 9E 98 DC DD D4 98 97 C9 98 9A 9D CB 9A 98 86 86 98 F6 ED F4 }
        $enc_B9 = { 96 DA 99 CA C0 CA CD DC D4 D0 D7 DF D6 99 87 F7 EC F5 99 9F 99 DD DC D5 99 96 C8 99 9B 9C CA 9B 99 87 87 99 F7 EC F5 }
        $enc_BA = { 95 D9 9A C9 C3 C9 CE DF D7 D3 D4 DC D5 9A 84 F4 EF F6 9A 9C 9A DE DF D6 9A 95 CB 9A 98 9F C9 98 9A 84 84 9A F4 EF F6 }
        $enc_BB = { 94 D8 9B C8 C2 C8 CF DE D6 D2 D5 DD D4 9B 85 F5 EE F7 9B 9D 9B DF DE D7 9B 94 CA 9B 99 9E C8 99 9B 85 85 9B F5 EE F7 }
        $enc_BC = { 93 DF 9C CF C5 CF C8 D9 D1 D5 D2 DA D3 9C 82 F2 E9 F0 9C 9A 9C D8 D9 D0 9C 93 CD 9C 9E 99 CF 9E 9C 82 82 9C F2 E9 F0 }
        $enc_BD = { 92 DE 9D CE C4 CE C9 D8 D0 D4 D3 DB D2 9D 83 F3 E8 F1 9D 9B 9D D9 D8 D1 9D 92 CC 9D 9F 98 CE 9F 9D 83 83 9D F3 E8 F1 }
        $enc_BE = { 91 DD 9E CD C7 CD CA DB D3 D7 D0 D8 D1 9E 80 F0 EB F2 9E 98 9E DA DB D2 9E 91 CF 9E 9C 9B CD 9C 9E 80 80 9E F0 EB F2 }
        $enc_BF = { 90 DC 9F CC C6 CC CB DA D2 D6 D1 D9 D0 9F 81 F1 EA F3 9F 99 9F DB DA D3 9F 90 CE 9F 9D 9A CC 9D 9F 81 81 9F F1 EA F3 }
        $enc_C0 = { EF A3 E0 B3 B9 B3 B4 A5 AD A9 AE A6 AF E0 FE 8E 95 8C E0 E6 E0 A4 A5 AC E0 EF B1 E0 E2 E5 B3 E2 E0 FE FE E0 8E 95 8C }
        $enc_C1 = { EE A2 E1 B2 B8 B2 B5 A4 AC A8 AF A7 AE E1 FF 8F 94 8D E1 E7 E1 A5 A4 AD E1 EE B0 E1 E3 E4 B2 E3 E1 FF FF E1 8F 94 8D }
        $enc_C2 = { ED A1 E2 B1 BB B1 B6 A7 AF AB AC A4 AD E2 FC 8C 97 8E E2 E4 E2 A6 A7 AE E2 ED B3 E2 E0 E7 B1 E0 E2 FC FC E2 8C 97 8E }
        $enc_C3 = { EC A0 E3 B0 BA B0 B7 A6 AE AA AD A5 AC E3 FD 8D 96 8F E3 E5 E3 A7 A6 AF E3 EC B2 E3 E1 E6 B0 E1 E3 FD FD E3 8D 96 8F }
        $enc_C4 = { EB A7 E4 B7 BD B7 B0 A1 A9 AD AA A2 AB E4 FA 8A 91 88 E4 E2 E4 A0 A1 A8 E4 EB B5 E4 E6 E1 B7 E6 E4 FA FA E4 8A 91 88 }
        $enc_C5 = { EA A6 E5 B6 BC B6 B1 A0 A8 AC AB A3 AA E5 FB 8B 90 89 E5 E3 E5 A1 A0 A9 E5 EA B4 E5 E7 E0 B6 E7 E5 FB FB E5 8B 90 89 }
        $enc_C6 = { E9 A5 E6 B5 BF B5 B2 A3 AB AF A8 A0 A9 E6 F8 88 93 8A E6 E0 E6 A2 A3 AA E6 E9 B7 E6 E4 E3 B5 E4 E6 F8 F8 E6 88 93 8A }
        $enc_C7 = { E8 A4 E7 B4 BE B4 B3 A2 AA AE A9 A1 A8 E7 F9 89 92 8B E7 E1 E7 A3 A2 AB E7 E8 B6 E7 E5 E2 B4 E5 E7 F9 F9 E7 89 92 8B }
        $enc_C8 = { E7 AB E8 BB B1 BB BC AD A5 A1 A6 AE A7 E8 F6 86 9D 84 E8 EE E8 AC AD A4 E8 E7 B9 E8 EA ED BB EA E8 F6 F6 E8 86 9D 84 }
        $enc_C9 = { E6 AA E9 BA B0 BA BD AC A4 A0 A7 AF A6 E9 F7 87 9C 85 E9 EF E9 AD AC A5 E9 E6 B8 E9 EB EC BA EB E9 F7 F7 E9 87 9C 85 }
        $enc_CA = { E5 A9 EA B9 B3 B9 BE AF A7 A3 A4 AC A5 EA F4 84 9F 86 EA EC EA AE AF A6 EA E5 BB EA E8 EF B9 E8 EA F4 F4 EA 84 9F 86 }
        $enc_CB = { E4 A8 EB B8 B2 B8 BF AE A6 A2 A5 AD A4 EB F5 85 9E 87 EB ED EB AF AE A7 EB E4 BA EB E9 EE B8 E9 EB F5 F5 EB 85 9E 87 }
        $enc_CC = { E3 AF EC BF B5 BF B8 A9 A1 A5 A2 AA A3 EC F2 82 99 80 EC EA EC A8 A9 A0 EC E3 BD EC EE E9 BF EE EC F2 F2 EC 82 99 80 }
        $enc_CD = { E2 AE ED BE B4 BE B9 A8 A0 A4 A3 AB A2 ED F3 83 98 81 ED EB ED A9 A8 A1 ED E2 BC ED EF E8 BE EF ED F3 F3 ED 83 98 81 }
        $enc_CE = { E1 AD EE BD B7 BD BA AB A3 A7 A0 A8 A1 EE F0 80 9B 82 EE E8 EE AA AB A2 EE E1 BF EE EC EB BD EC EE F0 F0 EE 80 9B 82 }
        $enc_CF = { E0 AC EF BC B6 BC BB AA A2 A6 A1 A9 A0 EF F1 81 9A 83 EF E9 EF AB AA A3 EF E0 BE EF ED EA BC ED EF F1 F1 EF 81 9A 83 }
        $enc_D0 = { FF B3 F0 A3 A9 A3 A4 B5 BD B9 BE B6 BF F0 EE 9E 85 9C F0 F6 F0 B4 B5 BC F0 FF A1 F0 F2 F5 A3 F2 F0 EE EE F0 9E 85 9C }
        $enc_D1 = { FE B2 F1 A2 A8 A2 A5 B4 BC B8 BF B7 BE F1 EF 9F 84 9D F1 F7 F1 B5 B4 BD F1 FE A0 F1 F3 F4 A2 F3 F1 EF EF F1 9F 84 9D }
        $enc_D2 = { FD B1 F2 A1 AB A1 A6 B7 BF BB BC B4 BD F2 EC 9C 87 9E F2 F4 F2 B6 B7 BE F2 FD A3 F2 F0 F7 A1 F0 F2 EC EC F2 9C 87 9E }
        $enc_D3 = { FC B0 F3 A0 AA A0 A7 B6 BE BA BD B5 BC F3 ED 9D 86 9F F3 F5 F3 B7 B6 BF F3 FC A2 F3 F1 F6 A0 F1 F3 ED ED F3 9D 86 9F }
        $enc_D4 = { FB B7 F4 A7 AD A7 A0 B1 B9 BD BA B2 BB F4 EA 9A 81 98 F4 F2 F4 B0 B1 B8 F4 FB A5 F4 F6 F1 A7 F6 F4 EA EA F4 9A 81 98 }
        $enc_D5 = { FA B6 F5 A6 AC A6 A1 B0 B8 BC BB B3 BA F5 EB 9B 80 99 F5 F3 F5 B1 B0 B9 F5 FA A4 F5 F7 F0 A6 F7 F5 EB EB F5 9B 80 99 }
        $enc_D6 = { F9 B5 F6 A5 AF A5 A2 B3 BB BF B8 B0 B9 F6 E8 98 83 9A F6 F0 F6 B2 B3 BA F6 F9 A7 F6 F4 F3 A5 F4 F6 E8 E8 F6 98 83 9A }
        $enc_D7 = { F8 B4 F7 A4 AE A4 A3 B2 BA BE B9 B1 B8 F7 E9 99 82 9B F7 F1 F7 B3 B2 BB F7 F8 A6 F7 F5 F2 A4 F5 F7 E9 E9 F7 99 82 9B }
        $enc_D8 = { F7 BB F8 AB A1 AB AC BD B5 B1 B6 BE B7 F8 E6 96 8D 94 F8 FE F8 BC BD B4 F8 F7 A9 F8 FA FD AB FA F8 E6 E6 F8 96 8D 94 }
        $enc_D9 = { F6 BA F9 AA A0 AA AD BC B4 B0 B7 BF B6 F9 E7 97 8C 95 F9 FF F9 BD BC B5 F9 F6 A8 F9 FB FC AA FB F9 E7 E7 F9 97 8C 95 }
        $enc_DA = { F5 B9 FA A9 A3 A9 AE BF B7 B3 B4 BC B5 FA E4 94 8F 96 FA FC FA BE BF B6 FA F5 AB FA F8 FF A9 F8 FA E4 E4 FA 94 8F 96 }
        $enc_DB = { F4 B8 FB A8 A2 A8 AF BE B6 B2 B5 BD B4 FB E5 95 8E 97 FB FD FB BF BE B7 FB F4 AA FB F9 FE A8 F9 FB E5 E5 FB 95 8E 97 }
        $enc_DC = { F3 BF FC AF A5 AF A8 B9 B1 B5 B2 BA B3 FC E2 92 89 90 FC FA FC B8 B9 B0 FC F3 AD FC FE F9 AF FE FC E2 E2 FC 92 89 90 }
        $enc_DD = { F2 BE FD AE A4 AE A9 B8 B0 B4 B3 BB B2 FD E3 93 88 91 FD FB FD B9 B8 B1 FD F2 AC FD FF F8 AE FF FD E3 E3 FD 93 88 91 }
        $enc_DE = { F1 BD FE AD A7 AD AA BB B3 B7 B0 B8 B1 FE E0 90 8B 92 FE F8 FE BA BB B2 FE F1 AF FE FC FB AD FC FE E0 E0 FE 90 8B 92 }
        $enc_DF = { F0 BC FF AC A6 AC AB BA B2 B6 B1 B9 B0 FF E1 91 8A 93 FF F9 FF BB BA B3 FF F0 AE FF FD FA AC FD FF E1 E1 FF 91 8A 93 }
        $enc_E0 = { CF 83 C0 93 99 93 94 85 8D 89 8E 86 8F C0 DE AE B5 AC C0 C6 C0 84 85 8C C0 CF 91 C0 C2 C5 93 C2 C0 DE DE C0 AE B5 AC }
        $enc_E1 = { CE 82 C1 92 98 92 95 84 8C 88 8F 87 8E C1 DF AF B4 AD C1 C7 C1 85 84 8D C1 CE 90 C1 C3 C4 92 C3 C1 DF DF C1 AF B4 AD }
        $enc_E2 = { CD 81 C2 91 9B 91 96 87 8F 8B 8C 84 8D C2 DC AC B7 AE C2 C4 C2 86 87 8E C2 CD 93 C2 C0 C7 91 C0 C2 DC DC C2 AC B7 AE }
        $enc_E3 = { CC 80 C3 90 9A 90 97 86 8E 8A 8D 85 8C C3 DD AD B6 AF C3 C5 C3 87 86 8F C3 CC 92 C3 C1 C6 90 C1 C3 DD DD C3 AD B6 AF }
        $enc_E4 = { CB 87 C4 97 9D 97 90 81 89 8D 8A 82 8B C4 DA AA B1 A8 C4 C2 C4 80 81 88 C4 CB 95 C4 C6 C1 97 C6 C4 DA DA C4 AA B1 A8 }
        $enc_E5 = { CA 86 C5 96 9C 96 91 80 88 8C 8B 83 8A C5 DB AB B0 A9 C5 C3 C5 81 80 89 C5 CA 94 C5 C7 C0 96 C7 C5 DB DB C5 AB B0 A9 }
        $enc_E6 = { C9 85 C6 95 9F 95 92 83 8B 8F 88 80 89 C6 D8 A8 B3 AA C6 C0 C6 82 83 8A C6 C9 97 C6 C4 C3 95 C4 C6 D8 D8 C6 A8 B3 AA }
        $enc_E7 = { C8 84 C7 94 9E 94 93 82 8A 8E 89 81 88 C7 D9 A9 B2 AB C7 C1 C7 83 82 8B C7 C8 96 C7 C5 C2 94 C5 C7 D9 D9 C7 A9 B2 AB }
        $enc_E8 = { C7 8B C8 9B 91 9B 9C 8D 85 81 86 8E 87 C8 D6 A6 BD A4 C8 CE C8 8C 8D 84 C8 C7 99 C8 CA CD 9B CA C8 D6 D6 C8 A6 BD A4 }
        $enc_E9 = { C6 8A C9 9A 90 9A 9D 8C 84 80 87 8F 86 C9 D7 A7 BC A5 C9 CF C9 8D 8C 85 C9 C6 98 C9 CB CC 9A CB C9 D7 D7 C9 A7 BC A5 }
        $enc_EA = { C5 89 CA 99 93 99 9E 8F 87 83 84 8C 85 CA D4 A4 BF A6 CA CC CA 8E 8F 86 CA C5 9B CA C8 CF 99 C8 CA D4 D4 CA A4 BF A6 }
        $enc_EB = { C4 88 CB 98 92 98 9F 8E 86 82 85 8D 84 CB D5 A5 BE A7 CB CD CB 8F 8E 87 CB C4 9A CB C9 CE 98 C9 CB D5 D5 CB A5 BE A7 }
        $enc_EC = { C3 8F CC 9F 95 9F 98 89 81 85 82 8A 83 CC D2 A2 B9 A0 CC CA CC 88 89 80 CC C3 9D CC CE C9 9F CE CC D2 D2 CC A2 B9 A0 }
        $enc_ED = { C2 8E CD 9E 94 9E 99 88 80 84 83 8B 82 CD D3 A3 B8 A1 CD CB CD 89 88 81 CD C2 9C CD CF C8 9E CF CD D3 D3 CD A3 B8 A1 }
        $enc_EE = { C1 8D CE 9D 97 9D 9A 8B 83 87 80 88 81 CE D0 A0 BB A2 CE C8 CE 8A 8B 82 CE C1 9F CE CC CB 9D CC CE D0 D0 CE A0 BB A2 }
        $enc_EF = { C0 8C CF 9C 96 9C 9B 8A 82 86 81 89 80 CF D1 A1 BA A3 CF C9 CF 8B 8A 83 CF C0 9E CF CD CA 9C CD CF D1 D1 CF A1 BA A3 }
        $enc_F0 = { DF 93 D0 83 89 83 84 95 9D 99 9E 96 9F D0 CE BE A5 BC D0 D6 D0 94 95 9C D0 DF 81 D0 D2 D5 83 D2 D0 CE CE D0 BE A5 BC }
        $enc_F1 = { DE 92 D1 82 88 82 85 94 9C 98 9F 97 9E D1 CF BF A4 BD D1 D7 D1 95 94 9D D1 DE 80 D1 D3 D4 82 D3 D1 CF CF D1 BF A4 BD }
        $enc_F2 = { DD 91 D2 81 8B 81 86 97 9F 9B 9C 94 9D D2 CC BC A7 BE D2 D4 D2 96 97 9E D2 DD 83 D2 D0 D7 81 D0 D2 CC CC D2 BC A7 BE }
        $enc_F3 = { DC 90 D3 80 8A 80 87 96 9E 9A 9D 95 9C D3 CD BD A6 BF D3 D5 D3 97 96 9F D3 DC 82 D3 D1 D6 80 D1 D3 CD CD D3 BD A6 BF }
        $enc_F4 = { DB 97 D4 87 8D 87 80 91 99 9D 9A 92 9B D4 CA BA A1 B8 D4 D2 D4 90 91 98 D4 DB 85 D4 D6 D1 87 D6 D4 CA CA D4 BA A1 B8 }
        $enc_F5 = { DA 96 D5 86 8C 86 81 90 98 9C 9B 93 9A D5 CB BB A0 B9 D5 D3 D5 91 90 99 D5 DA 84 D5 D7 D0 86 D7 D5 CB CB D5 BB A0 B9 }
        $enc_F6 = { D9 95 D6 85 8F 85 82 93 9B 9F 98 90 99 D6 C8 B8 A3 BA D6 D0 D6 92 93 9A D6 D9 87 D6 D4 D3 85 D4 D6 C8 C8 D6 B8 A3 BA }
        $enc_F7 = { D8 94 D7 84 8E 84 83 92 9A 9E 99 91 98 D7 C9 B9 A2 BB D7 D1 D7 93 92 9B D7 D8 86 D7 D5 D2 84 D5 D7 C9 C9 D7 B9 A2 BB }
        $enc_F8 = { D7 9B D8 8B 81 8B 8C 9D 95 91 96 9E 97 D8 C6 B6 AD B4 D8 DE D8 9C 9D 94 D8 D7 89 D8 DA DD 8B DA D8 C6 C6 D8 B6 AD B4 }
        $enc_F9 = { D6 9A D9 8A 80 8A 8D 9C 94 90 97 9F 96 D9 C7 B7 AC B5 D9 DF D9 9D 9C 95 D9 D6 88 D9 DB DC 8A DB D9 C7 C7 D9 B7 AC B5 }
        $enc_FA = { D5 99 DA 89 83 89 8E 9F 97 93 94 9C 95 DA C4 B4 AF B6 DA DC DA 9E 9F 96 DA D5 8B DA D8 DF 89 D8 DA C4 C4 DA B4 AF B6 }
        $enc_FB = { D4 98 DB 88 82 88 8F 9E 96 92 95 9D 94 DB C5 B5 AE B7 DB DD DB 9F 9E 97 DB D4 8A DB D9 DE 88 D9 DB C5 C5 DB B5 AE B7 }
        $enc_FC = { D3 9F DC 8F 85 8F 88 99 91 95 92 9A 93 DC C2 B2 A9 B0 DC DA DC 98 99 90 DC D3 8D DC DE D9 8F DE DC C2 C2 DC B2 A9 B0 }
        $enc_FD = { D2 9E DD 8E 84 8E 89 98 90 94 93 9B 92 DD C3 B3 A8 B1 DD DB DD 99 98 91 DD D2 8C DD DF D8 8E DF DD C3 C3 DD B3 A8 B1 }
        $enc_FE = { D1 9D DE 8D 87 8D 8A 9B 93 97 90 98 91 DE C0 B0 AB B2 DE D8 DE 9A 9B 92 DE D1 8F DE DC DB 8D DC DE C0 C0 DE B0 AB B2 }
        $enc_FF = { D0 9C DF 8C 86 8C 8B 9A 92 96 91 99 90 DF C1 B1 AA B3 DF D9 DF 9B 9A 93 DF D0 8E DF DD DA 8C DD DF C1 C1 DF B1 AA B3 }
    condition:
        any of them
}

rule CrowdStrike_CSIR_16008_12 : silent_chollima exportcontrol tasking downloader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "SILENT CHOLLIMA ExportControl dropper Engage Downloader payload"
        reports = "CSIR-16008"
        version = "201606010000"
        last_modified = "2016-06-01"
        actor = "SILENT CHOLLIMA"
        malware_family = "ExportControl"
    strings:
        $str_urlformat = "%s?&user_name=\"%s\"&mid=\"%s\"&os_ver=\"%s\"&ext_ver=%d" wide
        $str_seupdates = "SEUpdateS.exe" wide
        $str_seu0 = "SEU0.exe" wide
        $str_securitydomain = "http://securityengage.com/" wide
        $str_regkey = "software\\SE Update" wide
    condition:
        2 of them
}

rule CrowdStrike_CSIT_16064_01 : swift rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Code for secure deletion of files observed in malware used on SWIFT-related network"
        reports = "CSIT-16064"
        version = "201606010000"
        last_modified = "2016-06-01"
    strings:
        $ = { 81 ec 04 01 00 00 53 56 57 b9 40 00 00 00 33 c0
        8d 7c 24 0d c6 44 24 0c 00 8b 9c 24 14 01 00 00
        f3 ab 66 ab aa 8b fb 83 c9 ff 33 c0 8d 54 24 0c
        f2 ae f7 d1 2b f9 6a 5c 8b c1 8b f7 8b fa c1 e9
        02 f3 a5 8b c8 83 e1 03 f3 a4 8d 4c 24 10 51 ff
        ?? ?? ?? ?? 00 8b f0 83 c4 08 85 f6 74 03 46 eb
        04 8d 74 24 0c 80 3e 00 74 1d 8b 3d ?? ?? ?? ??
        ff d7 99 b9 1a 00 00 00 f7 f9 80 c2 61 88 16 8a
        46 01 46 84 c0 75 e9 8d 54 24 0c 52 53 ff 15 ??
        ?? ?? ?? 85 c0 74 04 8d 5c 24 0c 8a 84 24 18 01
        00 00 53 84 c0 74 1a ff 15 ?? ?? ?? ?? 85 c0 75
        2a ff 15 ?? ?? ?? ?? 5f 5e 5b 81 c4 04 01 00 00
        c3 ff 15 ?? ?? ?? ?? 85 c0 75 10 ff 15 ?? ?? ??
        ?? 5f 5e 5b 81 c4 04 01 00 00 c3 5f 5e 33 c0 5b
        81 c4 04 01 00 00 c3 }
    condition:
        all of them
}

rule CrowdStrike_CSIT_16064_02 : swift rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Code for filling a buffer with random bytes observed in malware used on SWIFT-related network"
        reports = "CSIT-16064"
        version = "201606010000"
        last_modified = "2016-06-01"
    strings:
        $ = { 56 8b 74 24 0c 8b c6 4e 85 c0 7e 28 53 8b 1d ??
        ?? ?? 00 57 8b 7c 24 10 ff d3 25 ff 00 00 80 79
        07 48 0d 00 ff ff ff 40 88 04 37 8b ce 4e 85 c9
        7f e6 5f 5b 5e c3 90 90 90 90 90 90 90 90 90 90 }
    condition:
        all of them
}

rule CrowdStrike_CSIT_16064_03 : swift artifact post_exploitation 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Foxit PDF SDK unlock token seen in malware that modified PDF messages, observed on SWIFT-related network"
        reports = "CSIT-16064"
        version = "201606010000"
        last_modified = "2016-06-01"
    strings:
        // FPDF SDK unlock token
        $ = "921315A06BD486EBC0792D60A826A5C4455E33A8" nocase ascii wide
    condition:
        all of them
}

rule CrowdStrike_CSIR_16008_04 : dropper exportcontrol silent_chollima 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "SILENT CHOLLIMA ExportControl dropper stack string (CloseHandle)"
        reports = "CSIR-16008"
        version = "201905161643"
        last_modified = "2019-05-16"
        actor = "SILENT CHOLLIMA"
        malware_family = "ExportControl"
    strings:
        $push_closehandle = { c6 01 43 8b 55 fc c6 42 01 6c 8b 45 fc c6 40 02 6f 8b 4d fc c6 41 03 73 8b 55 fc c6 42 04 65 8b 45 fc c6 40 05 48 8b 4d fc c6 41 06 61 8b 55 fc c6 42 07 6e 8b 45 fc c6 40 08 64 8b 4d fc c6 41 09 6c 8b 55 fc c6 42 0a 65 }
    condition:
        $push_closehandle
}

rule CrowdStrike_CSIR_16008_08 : silent_chollima exportcontrol shellcode 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "SILENT CHOLLIMA ExportControl dropper encoded shellcode"
        reports = "CSIR-16008"
        version = "201807300952"
        last_modified = "2018-07-30"
        actor = "SILENT CHOLLIMA"
        malware_family = "ExportControl"
    strings:
        $enc_1 = { dd a1 b8 82 e4 a5 d3 b1 17 8e 7d 61 ad a8 3b 0a 17 a4 23 3f fc 10 52 fb cf 1b 8b 6d e8 8a bc e6 }
        $enc_2 = { dd a1 b8 82 e4 a5 d3 b1 17 8e 7d 61 ad a8 3b 0a 17 a4 23 3f fc 10 0b f7 cf 1b 8b 6d e8 8a bc e6 }
    condition:
        any of them
}

rule CrowdStrike_CSIR_16008_05 : silent_chollima exportcontrol dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "SILENT CHOLLIMA ExportControl dropper variant XOR code"
        reports = "CSIR-16008"
        version = "201807300952"
        last_modified = "2018-07-30"
        actor = "SILENT CHOLLIMA"
        malware_family = "ExportControl"
    strings:
        $xorloop_inner = { c1 e8 18 32 da 32 d8 8b 44 24 10 8d 0c 3f 33 cf 81 e1 fe 01 00 00 c1 e0 18 0b 44 24 2c c1 e1 16 0b 4c 24 14 8a d3 46 }
        $push_closehandle = { b2 6c b1 65 83 c4 04 c6 00 43 88 50 01 c6 40 02 6f c6 40 03 73 88 48 04 c6 40 05 48 c6 40 06 61 c6 40 07 6e c6 40 08 64 88 50 09 88 48 0a c6 40 0b 00 }
    condition:
        any of them
}

rule CrowdStrike_CSIR_16008_03 : silent_chollima exportcontrol dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "SILENT CHOLLIMA ExportControl dropper XOR code"
        reports = "CSIR-16008"
        version = "201807300951"
        last_modified = "2018-07-30"
        actor = "SILENT CHOLLIMA"
        malware_family = "ExportControl"
    strings:
        $code_pushkey = { 68 EF CD AB 89 68 67 45 23 01 }
        $code_xorloop_inner = { C1 E8 08 8B 4D FC C1 E9 10 23 C1 33 D0 8B 45 FC C1 E8 18 33 D0 8B 4D F8 C1 E9 08 23 4D F8 8B 45 F8 C1 E8 10 23 C8 33 D1 }
        $code_pecmp = { 81 BD F0 FD FF FF 50 45 00 00 }
    condition:
        2 of them
}

rule CrowdStrike_CSIR_16008_09 : silent_chollima tdrop rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "SILENT CHOLLIMA TDrop variant"
        reports = "CSIR-16008"
        version = "201807300950"
        last_modified = "2018-07-30"
        actor = "SILENT CHOLLIMA"
        malware_family = "TDrop"
    strings:
        $code_dec_loop_1 = { 8a 14 30 32 16 40 3b c7 88 54 01 ff 7c f2 }
        $code_dec_loop_2 = { 8a 14 30 32 16 fe c1 88 94 38 1f e0 40 00 0f b6 c1 3b 45 fc 7c ea }
        $code_dec_generic = { 8a 14 30 32 16 [0-2] c? 88 }
    condition:
        any of them
}

rule CrowdStrike_CSIT_16065_01 : andromeda powershell dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Andromeda Powershell dropper"
        reports = "CSIT-16065"
        version = "201606030000"
        last_modified = "2016-06-03"
        malware_family = "Andromeda"
    strings:
        $dll32 = "dll32_regValueName_placeholder"
        $dll64 = "dll64_regValueName_placeholder"
        $reflective_loader = "base64_encoded_reflective_loader_ps1"
        $cipherkey = "cipherkey"
        $reg_key_holder = "reg_key_placeholder"
        $powershell = "Console\\%SystemRoot%_system32_WindowsPowerShell_v1.0_powershell.exe"
        $decompressbin = "decompressbin"
    condition:
        $reflective_loader or (3 of them)
}

rule CrowdStrike_CSIT_16074_04 : rat shadowplay 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Dropped DLL with ShadowPlay or DisPlay export"
        version = "202008151112"
        last_modified = "2020-08-15"
        actor = "WICKED SPIDER"
        malware_family = "ShadowPlay"
    strings:
        // DisPlay
        $exportfunc1 = { 00 44 69 73 50 6c 61 79 00 }
        // ShadowPlay
        $exportfunc2 = { 00 53 68 61 64 6f 77 50 6c 61 79 00 }
        // dll.dll
        $exportfname1 = { 00 64 6c 6c 2e 64 6c 6c 00 }
        // nxdisps.dll
        $exportfname2 = { 00 6e 76 64 69 73 70 73 2e 64 6c 6c 00 }
    condition:
        any of ($exportfunc*) and any of ($exportfname*)
}

rule CrowdStrike_CSIT_16074_05 : rat shadowplay 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Dropped DLL with ShadowPlay decryption loop"
        version = "202008151112"
        last_modified = "2020-08-15"
        actor = "WICKED SPIDER"
        malware_family = "ShadowPlay"
    strings:
        // Decryption loop
        $loopcode1 = { 8a 5c 24 30 8d 14 31 02 d9 32 1c 10 41 88 1a 3b cf 72 ed 33 db }
        $loopcode2 = { 8a 5c 24 30 8d 14 31 02 d9 32 1c 10 41 88 1a 3b cf 72 ed 33 db }
    condition:
        any of ($loopcode*)
}

rule CrowdStrike_CSIT_16106_02 : vbe3link threeproxy proxy 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "3proxy with disguise 1 specific to VBE3Link"
        reports = "CSIT-16106"
        version = "201606130000"
        last_modified = "2016-06-13"
        malware_family = "VBE3link"
    strings:
        $overwrite_string_1 = "dfgdfhf"
        $overwrite_string_2 = "hsifi3e eui3u ow439ujoeur"
        $overwrite_string_3 = "oweut woeut weotuo34 tj0w9u4"
        $overwrite_string_4 = "tosdjt43u weoeut93uw eoi4ut oi4"
        $pos_1 = "3proxy" wide
    condition:
        any of ($overwrite_string_*) and all of ($pos_*)
}

rule CrowdStrike_CSIT_16106_03 : vbe3link threeproxy proxy 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "3proxy with disguise 2 specific to VBE3Link"
        reports = "CSIT-16106"
        version = "201606130000"
        last_modified = "2016-06-13"
        malware_family = "VBE3link"
    strings:
        $overwrite_string = "hsifi3e eui3u ow439ujoeur oweut woeut weotuo34 tj0w9u4 tosdjt43u weoeut93uw eoi4ut oi4"
    condition:
        all of them
}

rule CrowdStrike_CSIT_16106_04 : vbe3link threeproxy proxy 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "3proxy with disguise 3 specific to VBE3Link"
        reports = "CSIT-16106"
        version = "201606130000"
        last_modified = "2016-06-13"
        malware_family = "VBE3link"
    strings:
        $ = { 6f 66 20 20 20 20 20 20 20 20 20 20 20 20 20 20
        20 20 20 20 20 20 20 20 20 20 20 20 20 20 20 20
        20 20 20 20 20 20 20 20 20 20 20 20 20 20 20 20
        20 20 20 20 20 20 20 20 20 20 20 20 20 20 20 20
        20 20 20 20 20 20 20 20 20 20 20 20 20 20 20 20
        20 20 20 20 20 20 20 20 20 20 20 20 20 20 20 20
        20 20 20 20 20 20 20 20 20 20 20 20 20 20 20 20
        20 20 20 20 20 20 20 20 20 20 20 20 20 20 20 20
        20 20 20 20 20 20 20 20 20 20 20 20 20 20 20 20
        20 20 20 20 2e 31 0a 0a 25 73 }
    condition:
        all of them
}

rule CrowdStrike_CSIT_16106_05 : vbe3link proxy 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Decoded VBE3link malware instance"
        reports = "CSIT-16106"
        version = "201606130000"
        last_modified = "2016-06-13"
        malware_family = "VBE3link"
    strings:
        $proxy_arg_1 = "-d"
        $proxy_arg_2 = "-t"
        $proxy_arg_3 = "-l"
        $proxy_arg_4 = "-e0.0.0.0"
        $proxy_arg_5 = "-i127.0.0."
        $proxy_arg_6 = "-p"
        $proxy_arg_7 = "-a"
        $plink_arg_1 = "-ssh"
        $plink_arg_2 = "-R"
        $plink_arg_3 = ":127.0.0."
        $plink_arg_4 = "-pw"
    condition:
        all of them and filesize < 10240
}

rule CrowdStrike_COZYBEAR_SeaDaddy_01
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects a variant of COZY BEAR's SeaDaddy malware."
        version = "202012141609"
        last_modified = "2020-12-14"
        actor = "COZY BEAR"
        malware_family = "SeaDaddy"
    strings:
        $ = "UPX0"
        $ = "UPX1"
        $ = "base64.pyo"
        $ = "random.pyo"
        $ = "string.pyo"
        $ = "tempfile.pyo"
        $ = "urllib.pyo"
        $ = "time.pyo"
        $ = "subprocess.pyo"
        $ = "shutil.pyo"
        $ = "threading.pyo"
        $ = "argparse.pyo"
        $ = "shlex.pyo"
        $ = "urlparse.pyo"
        $ = "getpass.pyo"
        $ = "HTMLParser.pyo"
        $ = "Crypto/Cipher/AES.pyo"
        $ = "ctypes/wintypes.pyo"
    condition:
        all of them
}

rule CrowdStrike_CSIT_16071_01 : fancy_bear proxy xtunnel 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "X-Tunnel proxying tool"
        reports = "CSIT-16071"
        version = "202012141613"
        last_modified = "2020-12-14"
        actor = "FANCY BEAR"
        malware_family = "XTunnel"
    strings:
        $binstring = { 2d 00 53 00 69 00 00 00 2d 00 53 00 70 00 00 00
        2d 00 55 00 70 00 00 00 2d 00 50 00 69 00 00 00
        2d 00 50 00 70 00 00 00 }
        $error_2005_recv = "error 2005 recv from  server UDP - %d\x0a"
        $error_2004_send = "error 2004  send to  TPS  - %d\x0a"
        $error_2003_recv = "error 2003  recv from  TPS - %d\x0a"
        $error_2002_send = "error 2002  send to server UDP - %d\x0a"
        $imwait = "i`m wait\x0a"
    condition:
        any of them
}

rule CrowdStrike_CSIT_16071_02 : fancy_bear key proxy xtunnel 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "RC4 keys used by the X-Tunnel proxy tool"
        reports = "CSIT-16071"
        version = "202012141613"
        last_modified = "2020-12-14"
        actor = "FANCY BEAR"
        malware_family = "XTunnel"
    strings:
        $key000 = { 987ab999fe0924a2df0a412b14e26093746fcdf9ba31dc05536892c33b116ad3 }
        $key001 = { 8b236c892d902b0c9a6d37ae4f9842c3070fbdc14099c6930158563c6ac00ff5 }
        $key002 = { e47b7f110caa1da617545567ec972af3a6e7b4e6807b7981d3cfbd3d8fcc3373 }
        $key003 = { 48b284545ca1fa74f64fdbe2e605d68ced8a726d05ebefd9baac164a7949bdc1 }
        $key004 = { fb421558e30fccd95fa7bc45ac92d2991c44072230f6fbeaa211341b5bf2dc56 }
        $key005 = { 34f1ae17017af16021ada5ce3f77675bbc6e7dec6478d6078a0b22e5fdff3b31 }
        $key006 = { f0ea48f164395186e6f754256ebb812a2afe168e77ed9501f8b8e6f5b72126a7 }
        $key007 = { 0b6e9970a8eaf68ee14ab45005357a2f3391beaa7e53ab760b916bc2b3916abe }
        $key008 = { ff032ea7ed2436cf6eea1f741f99a3522a61fda8b5a81ec03a8983ed1aedab1a }
        $key009 = { f0dac1ddfef7ac6de1cbe1006584538fe650389bf8565b32e0de1ffacbcb14bb }
        $key010 = { a5d699a3cd4510af11f1af767602055c523df74b94527d74319d6efc6883b80d }
        $key011 = { 5951b02696c1d5a7b2851d28872384da607b25f4cea268ff3fd7fba75ab3b4b3 }
        $key012 = { 0465d99b26af42d8346001bb838595e301bad8cf5d40ce9c17c944717df82481 }
        $key013 = { 5dfe1c83ad5f5ce1bf5d9c42e23225e3ecfdb2493e80e6554a2ac7c722eb4880 }
        $key014 = { e9650396c45f7783bc14c59f46ea8232e8357c26b5627bff8c42c6ae2e0f2e17 }
        $key015 = { 7432ae389125bb4e3980ed7f6a6fb252a42e785a90f4591c3620ca642ff97ca3 }
        $key016 = { 2b2adbbc4f960a8916f7088067bad30be84b65783fbf9476df5fda0e5856b183 }
        $key017 = { 808c3fd0224a59384161b8a81c8bb404d7197d16d8118cb77067c5c8bd764b3e }
        $key018 = { 028b0e24d5675c16c815bfe4a073e9778c668e65771a1ce881e2b03f58fc7d5b }
        $key019 = { 878b7f5cf2dc72baf1319f91a4880931ee979665b1b24d3394fe72edfaef4881 }
        $key020 = { 7ac7dd6ca34f269481c526254d2f563bc6eca1779feeaa33ec1c20e60b686785 }
        $key021 = { 3044f1d394186815dd8e3a2bbd9166837d07fa1cf6a550e2c170c9cdd9305209 }
        $key022 = { 7544dc095c441e39d258648fe9cb1267d20d83c8b2d3ab734474401da4932619 }
        $key023 = { d702223347406c1999d1a9829cbbe96ec86d377a40e2ee84562ea1fac1c71498 }
        $key024 = { ca36cb1177382a1009d392a58f7c1357e94ad2292cc0ae82ee4f7db0179148e1 }
        $key025 = { c714f23e4c1c4e55f0e1fa7f5d0dd64658a86f84681d07576d840784154f65dc }
        $key026 = { 63571baf736904634afee2a70cb9ed64615de8ca7aef21e773286b8877d065db }
        $key027 = { 27808a9be98ffe348de1db999ac9fdfb26e6c5a0d5e688490ef3d186c43661eb }
        $key028 = { b6eb86a07a85d40866afa100789ffb9e85c13f5aa7c7a3b6ba753c7eab9d6a62 }
        $key029 = { 88f0020375d60bdb85acdbfe4bd79cd098db2b3fa2cef55d4331dbefce455157 }
        $key030 = { 36535aab296587ae1162ac5d39492dd1245811c72706246a38ff590645aa5d7b }
        $key031 = { fdb726261cadd52e10818b49cab81bef112cb63832daa26ad9fc711ea6ce99a4 }
        $key032 = { 86c0caa26d9fd07d215bc7eb14e2da250e905d406affab44fb1c62a2eafc4670 }
        $key033 = { bc101329b0e3a7d13f6ebc535097785e27d59e92d449d6d06538725034b8c0f0 }
        $key034 = { c8d31a78b7c149f62f06497f9dc1ddc4967b566ac52c3a2a65ac7a99643b8a2d }
        $key035 = { 0ea4a5c565efbb94f5041392c5f0565b6badc630d9005b3eadd5d81110623e1f }
        $key036 = { 06e4e46bd3a0ffc8a4125a6a02b0c56d5d8b9e378cf97539ce4d4adfaf89feb5 }
        $key037 = { 6de22040821f0827316291331256a170e23fa76e381ca7066af1e5197ae3cfe7 }
        $key038 = { c6ef27480f2f6f40910074a45715143954bba78cd74e92413f785bba5b2aa121 }
        $key039 = { 19c96a28f8d9698adadd2e31f2426a46fd11d2d45f64169edc7158389bfa59b4 }
        $key040 = { c3c3ddbb9d4645772373a815b5125bb2232d8782919d206e0e79a6a973ff5d36 }
        $key041 = { c33af1608037d7a3aa7fb860911312b4409936d236564044cfe6ed42e54b78a8 }
        $key042 = { 856a0806a1dfa94b5e62abef75bea3b657d9888e30c8d2ffaec042930bba3c90 }
        $key043 = { 244496c524401182a2bc72177a15cdd2ef55601f1d321ecbf2605ffd1b9b8e3f }
        $key044 = { df24050364168606d2f81e4d0deb1ffc417f1b5eb13a2aa49a89a1b5242ff503 }
        $key045 = { 54fa07b8108dbfe285dd2f92c84e8f09cdaa687fe492237f1bc4343ff4294248 }
        $key046 = { 23490033d6bf165b9c45ee65947d6e6127d6e00c68038b83c8bfc2bce905040c }
        $key047 = { 4e044025c45680609b6ec52feb3491130a711f7375aaf63d69b9f952befd5f0c }
        $key048 = { 019f31c5f5b2269020ebc00c1f511f2ac23e9d37e89374514c6da40a6a03176c }
        $key049 = { a2483197fa57271b43e7276238468cfb8429326cbda7bd091461147f642beb06 }
        $key050 = { 731c9d6e74c589b7acb019e5f6a6e07acf12e68cb9a396ce05aa4d69d5387048 }
        $key051 = { 540db6c8d23f7f7fef9964e53f445f0e56459b10e931deeedb2b57b063c7f8b7 }
        $key052 = { d5af80a7eeff26de988ac3d7ce23e62568813551b2133f8d3e973da15e355833 }
        $key053 = { e4d8dbd3d801b1708c74485a972e7f00afb45161c791ee05282ba68660ffba45 }
        $key054 = { d79518af96c920223d687dd596fcd545b126a678b7947edfbf24661f232064fb }
        $key055 = { b57caa4b45ca6e8332eb58c8e72d0d9853b3110b478fea06b35026d7708ad225 }
        $key056 = { 077c714c47dfcf79ca2742b1544f4aa8035bb34aea9d519dee77745e01468408 }
        $key057 = { c3f5550ad424839e4cc54fa015994818f4fb62de99b37c872af0e52c376934fa }
        $key058 = { 5e890432ae87d0fa4d209a62b9e37aaededc8c779008febaf9e4e6304d1b2aac }
        $key059 = { a42ede52b5af4c02cfe76488cade36a8bbc3204bcb1e05c402ecf450071efcab }
        $key060 = { 4cdafe02894a04583169e1fb4717a402dac44da6e2536ae53f5f35467d31f1ca }
        $key061 = { 0befcc953ad0ed6b39ce6781e60b83c0cfd166b124d1966330cba9adfc9a7708 }
        $key062 = { 8a439dc4148a2f4d5996ce3fa152ff702366224737b8aa6784531480ed8c8877 }
        $key063 = { cf253be3b06b310901ff48a351471374ad35bbe4ee654b72b860f2a6ec7b1dbb }
        $key064 = { a0599f50c4d059c5cfa16821e97c9596b1517b9fb6c6116f260415127f32ce1f }
        $key065 = { 8b6d704f3dc9150c6b7d2d54f9c3eaab14654aca2c5c3952604e65df8133fe0c }
        $key066 = { a06e5cdd3871e9a3ee17f7e8dae193ee47ddb87339f2c599402a78c15d77cefd }
        $key067 = { e52ada1d9bc4c089dbb771b59904a3e0e25b531b4d18b58e432d4fa0a41d9e8a }
        $key068 = { 4778a7e23c686c171fddccb8e26f98c4cbebdf180494a647c2f6e7661385f05b }
        $key069 = { fe983d3a00a9521f871ed8698e702d595c0c7160a118a7630e8ec92114ba7c12 }
        $key070 = { 52ba4c52639e71eabd49534bba80a4168d15762e2d1d913bab5a5dbf14d9d166 }
        $key071 = { 931eb8f7bc2ae1797335c42db56843427eb970abd601e7825c4441701d13d7b1 }
        $key072 = { 318fa8edb989672dbe2b5a74949eb6125727bd2e28a4b084e8f1f50604ccb735 }
        $key073 = { 5b5f2315e88a42a7b59c1b493ad15b92f819c021bd70a5a6619aac6666639bc2 }
        $key074 = { c2bed7aa481951feb56c47f03ea38236bc425779b2fd1f1397cb79fe2e15c0f0 }
        $key075 = { d3979b1cb0ec1a655961559704d7cdc019253acb2259dfb92558b7536d774441 }
        $key076 = { 0edf5dbecb772424d879bbdd51899d6aaed736d0311589566d41a9dbb8ed1cc7 }
        $key077 = { cc798598f0a9bcc82378a5740143deaf1a147f4b2908a197494b7202388ec905 }
        $key078 = { 074e9df7f859bf1bd1658fd2a86d81c282000eab09af4252fab45433421d3849 }
        $key079 = { 6cd540642e007f00650ed20d7b54cffd54dda95d8debb087a004bae222f22c8e }
        $key080 = { c76cf2f66c71f6d17fc8defa1caef8718ba1ce188c7ea02c835a0fa54d3b3314 }
        $key081 = { a7250a149600e515c9c40fe5720756fda8251635a3b661261070cb5dabfe7253 }
        $key082 = { 237c67b97d4cce4610de2b82e582808ea796c34a4c24715c953cba403b2c935e }
        $key083 = { a8fa182547e66b57c497daaa195a38c0f0fb0a3c1f7b98b4b852f5f37e885127 }
        $key084 = { 83694cca50b821144ffbbe6855f62845f1328111ae1ac5666cba59eb43aa12c6 }
        $key085 = { 145e906416b17865ad37cd022df5481f28c930d6e3f53c50b0953bf33f4db953 }
        $key086 = { ab49b7c2fa3027a767f5aa94eaf2b312bbe3e89fd924ef89b92a7cf977354c22 }
        $key087 = { 7e04e478340c209b01ca2febbce3fe77c6e6169f0b0528c42fa4bda6d90ac957 }
        $key088 = { 0eadd042b9f0ddbaba0ca676efa4edb68a045595097e5a392217dffc21a8532f }
        $key089 = { 5623710f134ecacd5b70434a1431009e3556343ed48e77f6a557f2c7ff46f655 }
        $key090 = { 6968657db62f4a119f8e5cb3bf5c51f4b285328613aa7db9016f8000b576561f }
        $key091 = { debb9c95eae6a68974023c335f8d2711135a98260415df05845f053ad65b59b4 }
        $key092 = { 16f54900dbf08950f2c5835153ab636605fb8c09106c0e94cb13cea16f275685 }
        $key093 = { 1c9f86f88f0f4882d5cbd32876368e7b311a84418692d652a6a4f315cc499ae8 }
        $key094 = { e920e0783028fa05f4ce2d6a04bbe636d56a775cfd4daea3f2a1b8beeb52a6d4 }
        $key095 = { 73874ca3af47a8a315d50e1990f44f655ec7c15b146ffe0611b6c4fc096bd07c }
        $key096 = { f21c1fa163c745789c53922c47e191a5a85301bdc2ffc3d3b688cfbff39f3be5 }
        $key097 = { bc5a861f21cb98bd1e2ae9650b7a0bb4cd0c71900b3463c1bc3380afd2bb948e }
        $key098 = { 151bae36e646f30570dc6a7b57752f2481a0b48dd5184e914bcf411d8ad5aca0 }
        $key099 = { f05ad6d7a0cadc10a6468bfdbcbb223d5bd6ca30ee19c239e8035772d80312c9 }
        $key100 = { 5de9a0fdb37c0d59c298577e5379bcaf4f86df3e9fa17787a4cefa7dd10c462e }
        $key101 = { f5e62ba862380224d159a324d25fd321e5b35f8554d70cf9a506767713bca508 }
        $key102 = { a2d1b10409b328da0ccbffde2ad2ff10855f95da36a1d3dba84952bb05f8c3a7 }
        $key103 = { c974abd227d3ad339fac11c97e11d904706edea610b181b8fad473ffcc36a695 }
        $key104 = { ab5167d2241406c3c0178d3f28664398d5213ee5d2c09dcc9410cb604671f5f1 }
        $key105 = { c25cc4e671caaa31e137700a9db3a272d4e157a6a1f47235043d954bae8a3c70 }
        $key106 = { e6005757ca0189ac38f9b6d5ad584881399f28da949a0f98d8a4e3862e20f715 }
        $key107 = { 204e6ceb4ff59787ef4d5c9ca5a41ddf4445b9d8e0c970b86d543e9c7435b194 }
        $key108 = { 831d7fd21316590263b69e095abbe89e01a176e16ae799d83bd774af0d254390 }
        $key109 = { 42c36355d9bc573d72f546cdb12e6bb2cfe2933ac92c12040386b310abf6a1ed }
        $key110 = { b9044393c09ad03390160041446bf3134d864d16b25f1ab5e5cdc690c4677e7d }
        $key111 = { 6bc1102b5be05eebf65e2c3aca1f4e17a59b2e57fb480de016d371da3aef57a5 }
        $key112 = { b068d00b482ff73f8d23795743c76fe8639d405ee54d3efb20afd55a9e2dff4e }
        $key113 = { 95cf5addfe511c8c7496e3b75d52a0c0efe01ed52d5dd04d0ca6a7abd3a6f968 }
        $key114 = { 75534574a4620019f8e3d055367016255034fa7d91cbca9e717149441742ac8d }
        $key115 = { 96f1013a5301534be424a11a94b740e5eb3a627d052d1b769e64bab6a666433c }
        $key116 = { 584477ab45caf729ee9844834f84683abecab7c4f7d23a9636f54cdd5b8f19b3 }
        $key117 = { d3905f185b564149ee85cc3d093477c8ff2f8cf601c68c38bbd81517672eca3a }
        $key118 = { bf29521a7f94636d1930aa236422eb6351775a523de68af9bf9f1026ceda618d }
        $key119 = { 04b3a783470af1613a9b849fbd6f020ee65c612343eb1c028b2c28590789e60b }
        $key120 = { 3d8d8e84977fe5d21b6971d8d873e7bed048e21333fe15be2b3d1732c7fd3d04 }
        $key121 = { 8acb88224b6ef466d7653eb0d8256ea86d50bba14fd05f7a0e77acd574e9d9ff }
        $key122 = { b46121ffcf1565a77aa45752c9c5fb3716b6d8658737df95ae8b6a2374432228 }
        $key123 = { a4432874588d1bd2317224fb371f324dd60ab25d4191f2f01c5c13909f35b943 }
        $key124 = { 78e1b7d06ed2a2a044c69b7ce6cdc9bcd77c19180d0b082a671bba06507349c8 }
        $key125 = { 540198c3d33a631801fe94e7cb5da3a2d9bcbae7c7c3112edecb342f3f7df793 }
        $key126 = { 7e905652cab96acbb7feb2825b55243511df1cd8a22d0680f83aaf37b8a7cb36 }
        $key127 = { 37218801dbf2cd92f07f154cd53981e6189dbfbacac53bc200eafab891c5eec8 }
    condition:
        any of them
}

rule CrowdStrike_CSIT_17014_02 : urlzone trojan unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Deobfuscated strings found in unpacked URLZone malware"
        reports = "CSIT-17014"
        version = "201808271823"
        last_modified = "2018-08-27"
        malware_family = "URLZone"
    strings:
        $s1 = "?tver="
        $s2 = "&keret="
        $s3 = "&hh="
        $s4 = "Microsoft-CryptoApi/6.1"
        $s5 = "#EndSecGValue#"
        $s6 = "qwertyuiopasdfghjklzxcvbnm123945678"
        $s7 = "Wgf02"
    condition:
        4 of them
}

rule CrowdStrike_CSIT_16074_02 : dropper shadowplay shellcode wicked_spider 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "ShadowPlay Dropper"
        version = "202008151112"
        last_modified = "2020-08-15"
        actor = "WICKED SPIDER"
        malware_family = "ShadowPlay"
    strings:
        // Encrypted shellcode pattern
        $ = { bc 55 56 57 58 01 d9 b3 59 35 ba 55 60 61 8a 87 }
    condition:
        all of them
}

rule CrowdStrike_CSIT_16074_03 : dropper shadowplay shellcode wicked_spider 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "ShadowPlay Dropper"
        version = "202008151113"
        last_modified = "2020-08-15"
        actor = "WICKED SPIDER"
        malware_family = "ShadowPlay"
    strings:
        // Encrypted shellcode pattern
        $ = { a8 41 42 43 44 1d c5 af 4d 21 ae 41 4c 4d a6 ab }
    condition:
        all of them
}

rule CrowdStrike_CSIT_16078_01 : dropboxclientrat rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "RAT using Dropbox API for C2"
        reports = "CSIT-16078"
        version = "202004222106"
        last_modified = "2020-04-22"
        malware_family = "DropboxClientRAT"
    strings:
        $cmd_setpuls = "setpuls %f success!"
        $cmd_putfile_f = "putfile failed !"
        $cmd_putfile_s = "putfile succeed !"
        $cmd_getfile_s = "getfile succeed !"
        $header_xdropbox = "x-dropbox-metadata"
        $header_auth = "Authorization: Bearer"
        $host_apidropbox = "api-content.dropbox.com"
        $path_pdb = "C:\\Client\\Client\\Release\\Client.pdb"
    condition:
        2 of ($cmd_*) or
        (1 of ($cmd_*) and 1 of ($header_*)) or
        4 of them
}

rule CrowdStrike_CSIT_16078_02 : githubclientrat rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "RAT using GitHub API for C2"
        reports = "CSIT-16078"
        version = "202004222107"
        last_modified = "2020-04-22"
        malware_family = "GithubClientRAT"
    strings:
        $common = { 41 42 43 44 45 46 47 48 49 4a 4b 4c 4d 4e 4f 50 51 52 53 54 55 56 57 58 59 5a 32 33 34 35 36 37 00 00 00 00 00 00 00 00 2d 2d 2d 2d 2d 42 45 47 49 4e 20 50 55 42 4c 49 43 20 4b 45 59 2d 2d 2d 2d 2d 0a 4d 49 47 66 4d 41 30 47 43 53 71 47 }
        $github = "api.github.com"
    condition:
        $common and $github
}

rule CrowdStrike_CSIT_16078_03 : mongolabclientrat rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "RAT using MongoLab API for C2"
        reports = "CSIT-16078"
        version = "202004222107"
        last_modified = "2020-04-22"
        malware_family = "MongoLabClientRAT"
    strings:
        $common = { 41 42 43 44 45 46 47 48 49 4a 4b 4c 4d 4e 4f 50 51 52 53 54 55 56 57 58 59 5a 32 33 34 35 36 37 00 00 00 00 00 00 00 00 2d 2d 2d 2d 2d 42 45 47 49 4e 20 50 55 42 4c 49 43 20 4b 45 59 2d 2d 2d 2d 2d 0a 4d 49 47 66 4d 41 30 47 43 53 71 47 }
        $mongo = "api.mongolab.com"
    condition:
        $common and $mongo
}

rule CrowdStrike_CSIT_16078_04 : githubclientrat mongolabclientrat rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Generic signature for GitHub/MongoLab RATs"
        reports = "CSIT-16078"
        version = "202004222107"
        last_modified = "2020-04-22"
        malware_family = "GitHubClientRAT, MongoLabClientRAT"
    strings:
        $common = { 41 42 43 44 45 46 47 48 49 4a 4b 4c 4d 4e 4f 50 51 52 53 54 55 56 57 58 59 5a 32 33 34 35 36 37 00 00 00 00 00 00 00 00 2d 2d 2d 2d 2d 42 45 47 49 4e 20 50 55 42 4c 49 43 20 4b 45 59 2d 2d 2d 2d 2d 0a 4d 49 47 66 4d 41 30 47 43 53 71 47 }
    condition:
        $common
}

rule CrowdStrike_CSIT_16074_01 : dropper shadowplay wicked_spider 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "ShadowPlay Dropper"
        reports = "CSIT-16074"
        version = "202008151113"
        last_modified = "2020-08-15"
        actor = "WICKED SPIDER"
        malware_family = "ShadowPlay"
    strings:
        // Characteristic rundll32.exe command format string
        $ = { 25 73 5c 72 75 6e 64 6c 6c 33 32 2e 65 78 65 20 22 25 73 22 2c 20 [2-10] 50 6c 61 79 20 3? 3? }
        // Reverse string "CreateProcessA"
        $ = "AssecorPetaerC"
    condition:
        all of them
}

rule CrowdStrike_CSIT_16083_01 : rekaf rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Rekaf RAT main DLL"
        reports = "CSIT-16083"
        version = "201807301022"
        last_modified = "2018-07-30"
        malware_family = "Rekaf"
    strings:
        $s1 = "SeTcbPrivilege" wide
        $s2 = "SeAssignPrimaryTokenPrivilege" wide
        $s3 = "explorer.exe"
        $s4 = "GET" wide
        $s5 = "POST" wide
        $s6 = "http://" wide
        $s7 = "https://" wide
        $xor_32 = { 8a 58 08 30 1c 31 46 3b 70 04 }
        $xor_64 = { f8 e4 e4 e0 aa bf bf }
    condition:
        (5 of ($s*)) and (1 of ($xor*))
}

rule CrowdStrike_CSIT_16106_07 : proxy threeproxy 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "3proxy, may be used legitimately"
        reports = "CSIT-16106"
        version = "201904161035"
        last_modified = "2019-04-16"
    strings:
        $ = "Vladimir Dubrovin & 3proxy.ru"
    condition:
        all of them
}

rule CrowdStrike_CSIT_16106_08 : threeproxy proxy 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "3proxy, may be used legitimately"
        reports = "CSIT-16106"
        version = "201607060000"
        last_modified = "2016-07-06"
    strings:
        $any_of_01 = "Given address is not block aligned, ignoring"
        $any_of_02 = "-pPORT - service port to accept connections"
        $all_of_01 = "mscoree.dll" wide
        $all_of_02 = "No space left on device"
        $all_of_03 = "UTF-16LE"
        $all_of_04 = "SunMonTueWedThuFriSat"
        $all_of_05 = "UNICODE"
        $all_of_06 = "JanFebMarAprMayJunJulAugSepOctNovDec"
        $all_of_07 = "TZ"
        // Base64 alphabet
        $all_of_08 = { 21 22 23 24 25 26 27 28 29 2a 2b 2c 2d 2e 2f 30
        31 32 33 34 35 36 37 38 39 3a 3b 3c 3d 3e 3f 40
        41 42 43 44 45 46 47 48 49 4a 4b 4c 4d 4e 4f 50
        51 52 53 54 55 56 57 58 59 5a 5b 5c 5d 5e 5f 60
        61 62 63 64 65 66 67 68 69 6a 6b 6c 6d 6e 6f 70
        71 72 73 74 75 76 77 78 79 7a }
        $all_of_09 = "December"
        $all_of_10 = "November"
        $all_of_11 = "October"
        $all_of_12 = "September"
        $all_of_13 = "August"
        $all_of_14 = "July"
        $all_of_15 = "June"
        $all_of_16 = "April"
        $all_of_17 = "March"
        $all_of_18 = "February"
        $all_of_19 = "January"
    condition:
        (all of ($all_of_*)) and (any of ($any_of_*))
}

rule CrowdStrike_NUMBEREDPANDA_Dropper_01 : numbered_panda dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule alerts on NUMBERED PANDA usage of stack strings in a dropper commonly used to deploy Ixeshe."
        version = "201607110000"
        last_modified = "2016-07-11"
        actor = "NUMBERED PANDA"
    strings:
        $temp = { c6 [2] 54 c6 [2] 45 c6 [2] 4d c6 [2] 50 }
        $tmp = { c6 [2] 54 c6 [2] 4d c6 [2] 50 }
        $inary = { c6 [2] 49 c6 [2] 4e c6 [2] 41 c6 [2] 52 c6 [2] 59 }
        $dot_exe = { c6 [2] 2e c6 [2] 65 c6 [2] 78 c6 [2] 65 }
    condition:
        all of them
}

rule CrowdStrike_NUMBEREDPANDA_Ixeshe_03 : numbered_panda ixeshe rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects stack strings used in Ixeshe malware during mid-2016."
        version = "201607110000"
        last_modified = "2016-07-11"
        actor = "NUMBERED PANDA"
        malware = "Ixeshe"
    strings:
        // mov ebp+x,'d'
        // mov ebp+x+1,'/'
        // mov ebp+x+2, 'S'
        // ...
        // and so on to put "d/SDU%d=%d.(jpg|cgi)?%s" on the stack
        $sdu_http_c2 = { c6 [5] 2f c6 [5] 53 c6 [5] 44 c6 [5] 55 c6 [5] 25 c6 [5] 64 c6 [5] 3d c6 [5] 25 c6 [5] 64 c6 [5] 2e c6 [5] (63|6a) c6 [5] (67|70) c6 [5] (69|67) c6 [5] 3f c6 [5] 25 c6 [5] 73 }
        // \x0d\x0aSleep over!\x0d\x0a
        $sleep_over = { c6 [5] 0d c6 [5] 0a c6 [5] 53 c6 [5] 6c c6 [5] 65 c6 [5] 65 c6 [5] 70 c6 [5] 20 c6 [5] 6f c6 [5] 76 c6 [5] 65 c6 [5] 72 c6 [5] 21 c6 [5] 0d c6 [5] 0a }
    condition:
        $sdu_http_c2 or $sleep_over
}

rule CrowdStrike_NUMBEREDPANDA_StageOneTool_01 : numbered_panda downloader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects a stage one tool, similar to CGIRAT, in use by NUMBERED PANDA in April 2016."
        version = "201607110000"
        last_modified = "2016-07-11"
        actor = "NUMBERED PANDA"
    strings:
        $c2_stack_strings = { c6 [5] 73 c6 [5] 68 c6 [5] 20 c6 [5] 00 c6 [5] 70 c6 [5] 74 c6 [5] 20 c6 [5] 00 c6 [5] 73 c6 [5] 6c c6 [5] 65 c6 [5] 65 c6 [5] 70 c6 [5] 20 c6 [5] 00 }
    condition:
        any of them
}

rule CrowdStrike_CSIT_16123_01 : shadow_crane asruex installer 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detection for lure LNK file used to install Asruex"
        reports = "CSIT-16123"
        version = "201805110909"
        last_modified = "2018-05-11"
        actor = "SHADOW CRANE"
        malware_family = "Asruex"
    strings:
        $lnk_header = { 4c 00 00 00 01 14 02 00 00 00 }
        $target_1 = "D'+'ownloadFile" wide
        $target_2 = "powershell" wide
        $target_3 = "%CD%" wide
    condition:
        $lnk_header at (0x0) and ( all of ($target_*))
}

rule CrowdStrike_CSIT_16123_02 : shadow_crane asruex downloader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detection for Asruex batch downloader"
        reports = "CSIT-16123"
        version = "201805110906"
        last_modified = "2018-05-11"
        actor = "SHADOW CRANE"
        malware_family = "Asruex"
    strings:
        $ = "chcp 65001"
        $ = "del /f \"%1\\*.*.lnk\""
        $ = "powershell -Enc KAB"
        $ = "start winword "
        $ = "KABuAGUAdwAtAG8AY"
    condition:
        all of them
}

rule CrowdStrike_CSIT_16123_03 : shadow_crane asruex downloader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detection for Asruex stage 1 downloader"
        reports = "CSIT-16123"
        version = "201805110902"
        last_modified = "2018-05-11"
        actor = "SHADOW CRANE"
        malware_family = "Asruex"
    strings:
        $ = "Spyware, Version 1.0" wide
        $ = { 00 00 00 00 54 68 69 73 20 50 72 6f 67 72 61 6d 20 63 61 6e 6e 6f 74 20 62 65 20 72 75 6e 20 69 6e 20 44 4f 53 20 6d 6f 64 65 00 00 54 68 69 73 20 50 72 6f 67 72 61 6d 20 63 61 6e 6e 6f 74 20 62 65 20 72 75 6e 20 69 6e 20 44 4f 53 20 6d 6f 64 65 00 00 49 00 6e 00 76 00 61 00 6c 00 69 00 }
    condition:
        all of them
}

rule CrowdStrike_CSIT_16123_04 : shadow_crane asruex rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detection for Asruex RAT"
        reports = "CSIT-16123"
        version = "201805110901"
        last_modified = "2018-05-11"
        actor = "SHADOW CRANE"
        malware_family = "Asruex"
    strings:
        $ = "\\\\?\\%s\\%s" wide
        $ = "%x%x" wide
        $ = "AddRef"
        $ = "DllCanUnloadNow"
        $ = "----Boundary"
    condition:
        all of them
}

rule CrowdStrike_CSIT_16090_01 : axel dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Dropper for Axel RAT"
        reports = "CSIT-16090"
        version = "201607210000"
        last_modified = "2016-07-21"
        malware_family = "Axel"
    strings:
        $format1 = "%LOCALAPPDATA%"
        $format2 = "%s.%d"
        $format3 = "\"%s\" , %s"
        $rsrc = { 78 38 36 00 78 36 34 00 }
        $marker = "GDGDGDGDGDGD"
        $xor = { 40 3d 43 08 00 00 7c f1 b0 01 c3 }
    condition:
        (all of ($format*)) and (2 of ($rsrc,$marker,$xor))
}

rule CrowdStrike_CSIT_16090_02 : axel rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Axel RAT main DLL"
        reports = "CSIT-16090"
        version = "201807271817"
        last_modified = "2018-07-27"
        malware_family = "Axel"
    strings:
        $http = {F8 E4 E4 E0 AA BF BF}
        $riid = {61 16 0C D3 AF CD D0 11 8A 3E 00 C0 4F C9 E2 6E}
        $rclsid = {01 DF 02 00 00 00 00 00 C0 00 00 00 00 00 00 46}
        $xor_x86 = {8B 08 80 34 11 90 42}
        $xor_x64 = {41 FF C0 80 34 02 90}
    condition:
        (all of ($http, $riid, $rclsid)) and (1 of ($xor*))
}

rule CrowdStrike_CSIT_16118_01 : h1n1 downloader unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "H1N1 (unpacked)"
        reports = "CSIT-16118"
        version = "201807301039"
        last_modified = "2018-07-30"
        malware_family = "H1N1"
    strings:
        $guid1 = "guid=%.8X%.8X&os=%d&bits=%d&pl=%d&spread=%d"
        $guid2 = "guid=%.8X%.8X&report="
        $email_pw = "email: %s,username: %s,password: %s,server: %s,port: %d"
        $browser_pw = "url: %s,login: %s,password: %s"
        $rc4size = "RC4-Size: "
        $file = "FILE"
        $link = "LINK"
        $encrypteduser = "encryptedUsername"
        $encryptedpw = "encryptedPassword"
        $browsers = "&browsers="
        $mails = "&mails="
    condition:
        $guid1 or $guid2 or $email_pw or (7 of them)
}

rule CrowdStrike_CSIT_16096_01 : helix_kitten helminth delivery_document macro 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Macro contained in Office document used to deploy Helminth"
        reports = "CSIT-16096"
        version = "201607260000"
        last_modified = "2016-07-26"
        actor = "HELIX KITTEN"
        malware_family = "Helminth"
    strings:
        $ = "schtasks /create /F /sc minute /mo 3 /tn"
        $ = "Set-Content $env:Public\\Libraries"
        $ = ".vbs}\""
    condition:
        all of them
}

rule CrowdStrike_CSIT_16096_02 : helix_kitten helminth vbscript 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "VBScript component used to deploy Helminth"
        reports = "CSIT-16096"
        version = "201607260000"
        last_modified = "2016-07-26"
        actor = "HELIX KITTEN"
        malware_family = "Helminth"
    strings:
        $ = "'\"&SERVER&\"-_&m=d','\"&HOME&\"dn\\'+$r+'.-_'"
        $ = "Run Replace(Dwn,\"-_\",\"dwn\""
    condition:
        all of them
}

rule CrowdStrike_CSIT_16096_03 : helix_kitten helminth powershell 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "PowerShell component of Helminth"
        reports = "CSIT-16096"
        version = "201607260000"
        last_modified = "2016-07-26"
        actor = "HELIX KITTEN"
        malware_family = "Helminth"
    strings:
        $ = "(convertTo-Base36(Get-Random -Maximum 46655)))"
        $ = "$mydata.Equals("
        $ = "if($myflag2 -eq 0)"
    condition:
        all of them
}

rule CrowdStrike_CSIT_15088_01 : exploit cve_2015_2426 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Malicious Font File for CVE-2015-2426"
        reports = "CSIT-15088"
        version = "201607290000"
        last_modified = "2016-07-29"
    strings:
        // OTF font header
        $hdr = { 4f 54 54 4f 00 ?? 00 ?? 00 ?? 00 ?? }
        // HMTX table header
        $hmtx = { 68 6d 74 78 ?? ?? ?? ?? 00 ?? ?? ?? 00 ?? ?? ?? }
    condition:
        $hdr
        // Require a large hmtx table...
        and $hmtx and (uint32(@hmtx + 8) & 0x0000ffff) != 0
        // ... where the hmtx header is in the table array...
        and for any of ($hdr*) : (
        @ < @hmtx and (@ + 8 + 4 * uint16(@ + 4)) > @hmtx
        // ... and the HMTX table contains mostly zeros.
        // convert and check big endian uint32 values
        // checking the first 32 bytes should be sufficient
        and uint32(@ + (uint8(@hmtx + 8) << 24) + (uint8(@hmtx + 9) << 16) + (uint8(@hmtx + 10) << 8) + (uint8(@hmtx + 11)) + 16) == 0
        and uint32(@ + (uint8(@hmtx + 8) << 24) + (uint8(@hmtx + 9) << 16) + (uint8(@hmtx + 10) << 8) + (uint8(@hmtx + 11)) + 20) == 0
        and uint32(@ + (uint8(@hmtx + 8) << 24) + (uint8(@hmtx + 9) << 16) + (uint8(@hmtx + 10) << 8) + (uint8(@hmtx + 11)) + 24) == 0
        and uint32(@ + (uint8(@hmtx + 8) << 24) + (uint8(@hmtx + 9) << 16) + (uint8(@hmtx + 10) << 8) + (uint8(@hmtx + 11)) + 28) == 0
        and uint32(@ + (uint8(@hmtx + 8) << 24) + (uint8(@hmtx + 9) << 16) + (uint8(@hmtx + 10) << 8) + (uint8(@hmtx + 11)) + 32) == 0
        and uint32(@ + (uint8(@hmtx + 8) << 24) + (uint8(@hmtx + 9) << 16) + (uint8(@hmtx + 10) << 8) + (uint8(@hmtx + 11)) + 36) == 0
        and uint32(@ + (uint8(@hmtx + 8) << 24) + (uint8(@hmtx + 9) << 16) + (uint8(@hmtx + 10) << 8) + (uint8(@hmtx + 11)) + 40) == 0
        and uint32(@ + (uint8(@hmtx + 8) << 24) + (uint8(@hmtx + 9) << 16) + (uint8(@hmtx + 10) << 8) + (uint8(@hmtx + 11)) + 44) == 0
        )
}

rule CrowdStrike_CSIT_16088_01 : anonybr downloader silent_chollima 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "ANONYBR Downloader tool in use by SILENT CHOLLIMA"
        reports = "CSIT-16088"
        version = "202002131923"
        last_modified = "2020-02-13"
        actor = "SILENT CHOLLIMA"
        malware_family = "ANONYBR"
    strings:
        // RC4 loop
        /* Code from starting VA 00401400:
        and     esi, 0FFh
        mov     edi, [esp+esi*4+200Ch+var_2000]
        movzx   edx, dl
        mov     [esp+ecx*4+200Ch+var_2000], edi
        mov     [esp+esi*4+200Ch+var_2000], edx
        mov     edi, [esp+ecx*4+200Ch+var_2000]
        add     edi, edx
        and     edi, 800000FFh
        jns     short loc_40142B
        dec     edi
        or      edi, 0FFFFFF00h
        inc     edi
        and     edi, 0FFh
        movzx   edx, byte ptr [esp+edi*4+200Ch+var_2000]
        xor     [eax+ebx], dl
        inc     eax
        cmp     eax, [esp+200Ch+arg_0]
        */
        $code_va_00401400 = { 81 e6 ff 00 00 00 8b 7c b4 0c 0f b6 d2 89 7c 8c 0c 89 54 b4 0c 8b 7c 8c 0c 03 fa 81 e7 ff 00 00 80 79 08 4f 81 cf 00 ff ff ff 47 81 e7 ff 00 00 00 0f b6 54 bc 0c 30 14 18 40 3b 84 24 10 20 00 00 }
        $str_anonykey = "ANONYBR" ascii fullword
    condition:
        any of them
}

rule CrowdStrike_CSIT_16087_01 : silent_chollima tornrat rcmd rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "TornRAT RCmd variant"
        reports = "CSIT-16087"
        version = "201807300951"
        last_modified = "2018-07-30"
        actor = "SILENT CHOLLIMA"
        malware_family = "TornRAT, RCmd"
    strings:
        $str_rcmdsvc = "rcmdsvc"
        $str_killyou = "Kill You"
        $str_fmtbang = "#0%s!"
        $str_servicename = "Remote Command Service"
        $str_w32dllpath = "%SystemRoot%\\System32\\w32time.dll"
        $str_encc2 = "7D48FDAA337062043133342E3438"
    condition:
        3 of them
}

rule CrowdStrike_NUMBEREDPANDA_StageOneTool_02 : numbered_panda downloader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule alerts on a stage-one tool likely used by NUMBERED PANDA by checking for part of a stack string."
        version = "201608050000"
        last_modified = "2016-08-05"
        actor = "NUMBERED PANDA"
    strings:
        $remote_create_file_error = { c6 [5] 5b c6 [5] 2d c6 [5] 5d c6 [5] 52 c6 [5] 6d c6 [5] 6f c6 [5] 74 c6 [5] 43 }
    condition:
        all of them
}

rule CrowdStrike_CSIT_16095_01 : gootkit loader unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "GootKit loader DLL running in memory"
        reports = "CSIT-16095"
        version = "201608110000"
        last_modified = "2016-08-11"
        malware_family = "Gootkit"
    strings:
        $s1 = "crackme"
        $s2 = "servicedll_%d"
        $s3 = "vendor_id"
        $api1 = "RtlDecompressBuffer"
        $api2 = "RtlRandom"
        $api3 = "RtlNtStatusToDosError"
        $avm1 = "INTEL  - 6040000"
        $avm2 = "BOCHS"
        $avm3 = "VBOX"
        $avm4 = "QEMU"
        $avm5 = "FTNT-1"
        $avm6 = "7SILVIA"
    condition:
        all of ($s*) and all of ($api*) and 2 of ($avm*)
}

rule CrowdStrike_CSIT_16128_02 : gootkit unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "GootKit body DLL running in memory"
        reports = "CSIT-16128"
        version = "201608110000"
        last_modified = "2016-08-11"
        malware_family = "Gootkit"
    strings:
        $s1 = "gootkit_crypt"
        $s2 = "vmx_detection"
        $s3 = "SpHookHttp"
        $s4 = "SpGetVendor"
        $s5 = "SpResetConfigs"
        $node1 = "Entering the V8 API"
        $node2 = "JS stack trace"
    condition:
        all of ($s*) and all of ($node*)
}

rule CrowdStrike_CSIT_16095_02 : gootkit trojan unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "GootKit main DLL running in memory"
        reports = "CSIT-16095"
        version = "201807271606"
        last_modified = "2018-07-27"
        malware_family = "Gootkit"
    strings:
        $s1 = "gootkit_crypt"
        $s2 = "vmx_detection"
        $s3 = "SpHookHttp"
        $s4 = "SpGetVendor"
        $s5 = "SpResetConfigs"
        $node1 = "Entering the V8 API"
        $node2 = "JS stack trace"
    condition:
        all of ($s*) and all of ($node*)
}

rule CrowdStrike_CSIT_16093_01 : gothic_panda xmclient downloader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Rule to match on XMClient downloader typelibs"
        reports = "CSIT-16093"
        version = "201608120000"
        last_modified = "2016-08-12"
        actor = "GOTHIC PANDA"
        malware_family = "XMClient"
    strings:
        $val1 = "$4c3903e1-b507-4611-8a6f-14e5c4f3e567"
        $val2 = "$625c5548-f3a9-4654-925b-1fa1d667990d"
        $val3 = "$cd9f1eb8-fdb9-407e-85b2-d97b73d60356"
        $val4 = "$4878d88f-b5a0-4502-a838-ff4be88df101"
    condition:
        any of them
}

rule CrowdStrike_CSIT_16093_02 : gothic_panda xmclient downloader unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Rule to match on unpacked XMClient"
        reports = "CSIT-16093"
        version = "201608120000"
        last_modified = "2016-08-12"
        actor = "GOTHIC PANDA"
        malware_family = "XMClient"
    strings:
        $lib0 = "DESCryptoServiceProvider"
        $lib1 = "CryptoStream"
        $lib2 = "CryptoStreamMode"
        $lib3 = "CreateDecryptor"
        $str0 = "Software\\Microsoft\\Windows\\CurrentVersion\\Run" wide
        $str1 = "ExplorerConfig" wide
        $str2 = "download fail" wide
        $str3 = "downloaded" wide
    condition:
        all of them
}

rule CrowdStrike_CSIT_16105_02 : quilted_tiger delivery_document 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Malicious PPT, possibly delivering EnfourksAutoRAT"
        reports = "CSIT-16105"
        version = "201608120000"
        last_modified = "2016-08-12"
        actor = "QUILTED TIGER"
    strings:
        $olefile_magic = { D0 CF 11 E0 }
        $patchwork_1 = "generated using python-pptx"
        $patchwork_2 = "Windows User"
    condition:
        all of them
}

rule CrowdStrike_CSIT_16105_01 : quilted_tiger delivery_document 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Malicious RTF document, possibly delivering EnfourksAutoRAT"
        reports = "CSIT-16105"
        version = "201807300835"
        last_modified = "2018-07-30"
        actor = "QUILTED TIGER"
    strings:
        // Exploit RTF indicators
        $hdr = "{\\rt"
        $marker1 = { ba ba ba ba }
        $marker2 = { bb bb bb bb }
        $marker3 = { bc bc bc bc }
        $enc1 = { ba ba fe ca }
        $enc2 = { f2 0f 52 45 f2 0f 52 45 }
        $encrypted_upx0 = { eb ea a6 fa }
        // 00"enerator" instead of "generator"
        $enfourks_1 = { 00 65 6E 65 72 61 74 6F 72 }
        // 00"sftedit" instead of "Msftedit"
        $enfourks_2 = { 00 73 66 74 65 64 69 74 }
        // Characteristic string
        $enfourks_3 = "lang1049"
    condition:
        ($marker1 and $marker2) and $hdr at 0
        // assume maximum payload len of 0x100000 bytes
        and $marker2 in (@marker1[1]+0x3000..@marker1[1]+0x100000)
        // assume maximum decoy len of 0x500000 bytes
        and ($marker3 in (@marker2[1]+0x3000..@marker2[1]+0x500000)
        or ($enc1 and $enc2))
        and $encrypted_upx0
        and (all of ($enfourks_*))
        and filesize > 500KB and filesize < 2MB
}

rule CrowdStrike_CSIT_16113_03 : quilted_tiger tinytyphon rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "TinyTyphon malware"
        reports = "CSIT-16113"
        version = "201807300832"
        last_modified = "2018-07-30"
        actor = "QUILTED TIGER"
        malware_family = "TinyTyphon"
    strings:
        $mutex_name = "{9754893678976458374658764387563876}"
        $http_1 = "HTTP/1."
        $http_2 = "Content-Disposition: form-data"
        $asep = "Software\\Microsoft\\Windows\\CurrentVersion\\Run"
        $md5_to_hex = "%.8x%.8x%.8x%.8x"
        $import = "WININET.dll"
    condition:
        all of them
        // config size not too large (but still encrypted with 0x90)
        and uint8(filesize-4) == 0x90
        and uint8(filesize-3) == 0x90
        and uint8(filesize-2) == 0x90
        and filesize < 200KB
}

rule CrowdStrike_CSIT_16113_02 : dropper quilted_tiger tinytyphon 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "TinyTyphon dropper, UPX packed"
        reports = "CSIT-16113"
        version = "201907180929"
        last_modified = "2019-07-18"
        actor = "QUILTED TIGER"
        malware_family = "TinyTyphon"
    strings:
        $compiler = "Embarcadero RAD Studio - Copyright 2009 Embarcadero Technologies, Inc."
        $encoded_mz = "TVqQ**"
        $stars = "***********************************************"
        $encoded_upx = "*FVQWD**"
    condition:
        all of them
}

rule CrowdStrike_CSIT_16113_01 : quilted_tiger tinytyphon delivery_document 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Document containing encrypted TinyTyphon malware"
        reports = "CSIT-16113"
        version = "201807300831"
        last_modified = "2018-07-30"
        actor = "QUILTED TIGER"
        malware_family = "TinyTyphon"
    strings:
        $hdr = "{\\rt"
        $marker1 = { ba ba ba ba }
        $marker2 = { bb bb bb bb }
        $marker3 = { bc bc bc bc }
        $enc1 = { ba ba fe ca }
        $enc2 = { f2 0f 52 45 f2 0f 52 45 }
        $encrypted_mz = { f3 e0 ae ca bc ba fe ca ba ba }
        // Embarcadero RAD Studio - Copyright 2009 Embarcadero Technologies, Inc.
        $encrypted_compiler = { fb d7 9c ab cc d9 9f ae db c8 91 ea ea df 9d a2 d0 d5 92 a5 d9 d3 9b b9 92 9a b7 a4 dd 94 fe ca }
        // Base64 encoded MZ
        $encrypted_TVqQ = { ea ec 8f 9b 94 90 }
        $encrypted_stars = { 90 d4 e0 94 90 d4 e0 94 90 d4 e0 94 90 d4 e0 94 90 d4 e0 94 90 d4 e0 94 90 d4 e0 94 90 d4 e0 94 90 d4 e0 94 90 d4 e0 94 90 d4 e0 94 90 d4 e0 }
        // *FVQWD** (base64 encoded "upx0" with A -> *)
        $encrypted_upx = { 94 fc a8 9b e9 fe d4 e0 }
        // 00"enerator" instaed of "generator"
        $patchwork_1 = { 00 65 6E 65 72 61 74 6F 72 }
        // 00"sftedit" instead of "Msftedit"
        $patchwork_2 = { 00 73 66 74 65 64 69 74 }
        $patchwork_3 = "lang1049"
    condition:
        ($marker1 and $marker2) and $hdr at 0
        and $marker2 in (@marker1[1]+0x3000..@marker1[1]+0x100000)
        and ($marker3 in (@marker2[1]+0x3000..@marker2[1]+0x500000) or ($enc1 and $enc2))
        and $encrypted_mz
        and $encrypted_compiler
        and $encrypted_TVqQ
        and $encrypted_stars
        and $encrypted_upx
        and (all of ($patchwork_*))
        and filesize > 500KB and filesize < 2MB
}

rule CrowdStrike_CSIT_16105_03 : quilted_tiger enfourksautorat rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "EnfourksAutoRAT"
        reports = "CSIT-16105"
        version = "201807300834"
        last_modified = "2018-07-30"
        actor = "QUILTED TIGER"
        malware_family = "EnfourksAutoRAT"
    strings:
        // Binary($
        $common_1 = { 42 69 6e 61 72 79 28 24 }
        // DllStructCreate("byte[" & BinaryLen(
        $common_2 = { 44 6c 6c 53 74 72 75 63 74 43 72 65 61 74 65 28
        22 62 79 74 65 5b 22 20 26 20 42 69 6e 61 72 79
        4c 65 6e 28 }
        $common_3 = "*.doc"
        $common_4 = "*.pdf"
        $common_5 = "Windows"
        $common_6 = "update-request.php?profile="
        $common_7 = "Content-Type: multipart/form-data"
        $common_8 = "Random("
        $url_1 = "ddager="
        $url_2 = "dropper.php?profile="
        $url_3 = "profile.php?id="
        $post = "POST"
    condition:
        all of ($common_*) and $post and any of ($url_*)
}

rule CrowdStrike_CSIT_16105_04 : quilted_tiger enfourksautorat rat privilege_escalation 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Privilege escalation pefile used by EnfourksAutoRAT"
        reports = "CSIT-16105"
        version = "201608170000"
        last_modified = "2016-08-17"
        actor = "QUILTED TIGER"
        malware_family = "EnfourksAutoRAT"
    strings:
        $ = "This program cannot be run in DOS mode."
        $ = "Elevation:Administrator!new:{3ad05575-8857-4850-9277-11b85bdb8e09}" wide
        $ = "Computer Management.lnk" wide
        $ = "SHGetSpecialFolderPathW"
        $ = "SHCreateItemFromParsingName"
        $ = "CoInitialize"
        $ = "CoGetObject"
    condition:
        all of them
}

rule CrowdStrike_CSIT_16105_05 : uacme privilege_escalation 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "UAC bypass DLL used by EnfourksAutoRAT, but is not exclusive capability."
        reports = "CSIT-16105"
        version = "201608170000"
        last_modified = "2016-08-17"
        malware_family = "UACME"
    strings:
        $string_1 = "Software\\Akagi" wide
        $string_2 = "LoveLetter" wide
        $string_3 = "Akagi letter found" wide
        $string_4 = "Fubuki at your service." wide
        $dll_name_1 = "Fubuki.dll"
        $dll_name_2 = "Fubuki32.dll"
        $dll_name_3 = "Fubuki64.dll"
    condition:
        any of ($string_*) and any of ($dll_name_*)
}

rule CrowdStrike_CSIT_16105_06 : quilted_tiger enfourksautorat rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "HTTP uploader used by EnfourksAutoRAT"
        reports = "CSIT-16105"
        version = "201608170000"
        last_modified = "2016-08-17"
        actor = "QUILTED TIGER"
        malware_family = "EnfourksAutoRAT"
    strings:
        $pdb_path = "C:\\Users\\Kanishk\\Documents\\Visual Studio 2015\\Projects\\ConsoleApplication1\\ConsoleApplication1\\obj\\Debug\\ConsoleApplication1.pdb"
        $uuid = "e66e7027-363e-4f49-9b5a-3c4824e85c8f"
        $generic_string_1 = "WebClient"
        $generic_string_2 = "POST" wide
        $generic_string_3 = "ConsoleApplication1"
    condition:
        $pdb_path or $uuid or
        (all of ($generic_string_*) and filesize < 5KB)
}

rule CrowdStrike_TunnaWebshell_01 : tunna webshell proxy 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Alerts on a component to the Tunna Webshell to run a proxy. Available open source at https://github.com/SECFORCE/Tunna."
        version = "201608170000"
        last_modified = "2016-08-17"
        malware = "Tunna Webshell"
    strings:
        $import_tunna_client = "from lib.TunnaClient import TunnaClient"
    condition:
        $import_tunna_client
}

rule CrowdStrike_TunnaWebshell_02 : tunna webshell artifact 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Alert on Tunna webshell settings file. Available open source at https://github.com/SECFORCE/Tunna."
        version = "201608170000"
        last_modified = "2016-08-17"
        malware = "Tunna Webshell"
    strings:
        $tunna_default = "Tunna_Defaults"
        $remote_ip = "remote_ip"
        $remote_port = "remote_port"
    condition:
        all of them
}

rule CrowdStrike_TunnaWebshell_03 : tunna webshell 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Alerts on a webshell used to tunnel connections over HTTP. Part of an open source tool available at https://github.com/SECFORCE/Tunna."
        version = "202012141606"
        last_modified = "2020-12-14"
        malware = "Tunna Webshell"
    strings:
        $tunna = "Tunna "
        $unable_to_create_socket = "[Server] Unable to create Socket" nocase
        $unable_to_connect_to_socket = "[Server] Unable to connect to socket"
        $good_to_go = "[Server] All good to go, ensure the listener is working ;-)"
        $file_uploaded = "[Server] File Uploaded at "
    condition:
        2 of them
}

rule CrowdStrike_TunnaWebshell_04 : tunna webserver webshell 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Alerts on the webserver included with the Tunna webshell tool. Available open source at https://github.com/SECFORCE/Tunna."
        version = "202012141558"
        last_modified = "2020-12-14"
        malware = "Tunna Webshell"
    strings:
        $tunnelwebserver = "TunnaWebServer"
        $oclet = "Content-type\":'application/oclet-stream"
        $upload_msg = "[W] File uploaded to:"
        $webserver_start = "Web Server Starts - %s:%s"
    condition:
        2 of them
}

rule CrowdStrike_reGeorg_Webshell_01 : regeorg webshell proxy 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Alerts on a webshell named 'reGeorg'. The webshell can be used to tunnel traffic through a compromised webserver. It is available open-source at https://github.com/sensepost/reGeorg."
        version = "201608170000"
        last_modified = "2016-08-17"
        malware = "reGeorg"
    strings:
        $regeorg = "reGeorg"
        $xcmd = "X-CMD"
        $xstatus = "X-STATUS"
        $xtarget = "X-TARGET"
        $xport = "X-PORT"
        $xerror = "X-ERROR"
    condition:
        4 of them
}

rule CrowdStrike_CSIT_16098_01 : heartloader loader radio_panda 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "HeartLoader strings"
        reports = "CSIT-16098"
        version = "202011251936"
        last_modified = "2020-11-25"
        actor = "RADIO PANDA"
        malware_family = "HeartLoader"
    strings:
        $str_err_send = { 65 72 72 6f 72 20 73 65 6e 64 a3 a1 0a 00 }
        $str_err_recv = { 65 72 72 6f 72 20 72 65 63 76 a3 a1 0a 00 }
        $str_heart_error_1 = "error send heart package!"
        $str_heart_error_2 = "error at recv heart client len:%d"
        $str_mutux = "myMutux"
        $str_junk = "2113544564567fdsfjkfsjkhf"
        $str_err_crypt = "error at CryptAndSendData line 1"
        $str_err_crc = "crc is error"
        $str_rsa_key = "C4D5CFEA62B57A8E066D10411125D7010B5477DCC9F2E2F50677A1141BDB78C0D0C7FB3ED290A8D73B1063877A84358BCFBFC0A7A4159A35C7AA5F6F534E1F2EEC1EA15FB0EC3D3A7E3D611BF83249F7CA56C17D9FF2DD8B5F998AA1222E16770019D2DD217743912F890B11DDF1EB583543A7C69E5834E2AA92AD32945289E7A278C4F3F96AB9481B12BCCE1E3407F61B4C23EA21100B919EAEEFF80A82DB104DFE757FEFFFDCCD7FCCA6D9225DE5503F123F5D2B4EE27C3B6E55BE559942C1"
    condition:
        2 of them or $str_rsa_key
}

rule CrowdStrike_CSIT_16098_02 : heartloader loader radio_panda 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "HeartLoader code fragments"
        reports = "CSIT-16098"
        version = "202011251937"
        last_modified = "2020-11-25"
        actor = "RADIO PANDA"
        malware_family = "HeartLoader"
    strings:
        $code_rc4 = { fe c2 0f b6 ca 8d 74 39 02 8a 0e 02 d9 88 5c 24 0f 0f b6 db 8d 6c 3b 02 8a 5d 00 88 1e 8a 5c 24 0f 88 4d 00 0f b6 36 0f b6 c9 03 f1 81 e6 ff 00 00 00 0f b6 4c 3e 02 8b 74 24 14 30 0c 30 40 3b 44 24 18 7c bb 5e 5d }
        $code_bignum_mul = { 8b 54 24 1c 8b 0c 3e 33 c0 50 52 50 51 e8 ?? ?? ?? ?? 33 c9 03 c3 13 d1 89 06 83 c6 04 83 6c 24 14 01 8b da 75 da }
    condition:
        any of them
}

rule CrowdStrike_CSIT_16098_04 : bifrost kivars loader radio_panda 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Bifrost/KIVARS loader strings"
        reports = "CSIT-16098"
        version = "202011251937"
        last_modified = "2020-11-25"
        actor = "RADIO PANDA"
        malware_family = "Bifrost, KIVARS"
    strings:
        $str_hres = "hRes ERR!"
        $str_size = "size 0 err!"
        $str_load = "load err!"
        $str_locak = "locak err!"
        $pdb = "E:\\shellcode\\shellcode\\Release\\shellcode.pdb"
    condition:
        $pdb or (3 of ($str_*))
}

rule CrowdStrike_CSIT_16098_05 : bifrost kivars radio_panda rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Bifrost/KIVARS RAT"
        reports = "CSIT-16098"
        version = "202011251937"
        last_modified = "2020-11-25"
        actor = "RADIO PANDA"
        malware_family = "Bifrost, KIVARS"
    strings:
        $str_dat_addon = "addon.dat" fullword
        $str_dat_ccp = "ccp.dat" fullword
        $str_bifrost = "Bifrost Remote Controller" fullword
        $str_format_1 = "<%u-%.2u-%.2u %.2u:%.2u><%s>"
        $str_mutex = "dbeWd" fullword
        $str_torwrite = "torWrite" fullword
        $str_close = "Close running server at this computer "
    condition:
        3 of them
}

rule CrowdStrike_CSIT_16098_03 : bifrost kivars radio_panda rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Bifrost/KIVARS modified RC4 code"
        reports = "CSIT-16098"
        version = "202011251937"
        last_modified = "2020-11-25"
        actor = "RADIO PANDA"
        malware_family = "Bifrost, KIVARS"
    strings:
        $code_va_004010EB = { 8a 1e 02 d9 32 d8 88 1e eb 10 8a 0e 32 c8 0f be 84 24 48 02 00 00 02 c8 88 0e 8b 44 24 10 46 48 89 44 24 10 75 9c }
        $code_va_10009408 = { 8b 55 08 8b 75 10 03 f2 8a 16 02 55 18 32 d1 eb 0f 8b 55 10 8b 75 08 03 f2 8a 16 32 d1 02 55 18 ff 45 ?? 88 16 8b 4d 10 3b 4d 0c 72 91 }
    condition:
        any of them
}

rule CrowdStrike_CSIT_16097_01 : hitler ransomware 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Hitler ransomware strings"
        reports = "CSIT-16097"
        version = "201608230000"
        last_modified = "2016-08-23"
        malware_family = "Hitler"
    strings:
        $str1 = "This is the Hitler-Ransonware" wide
        $str2 = "Your Files was encrypted!" wide
        $str3 = "Do you decrypt your Files?" wide
        $str4 = "Your Files delete in:" wide
    condition:
        3 of them
}

rule CrowdStrike_CSIT_16092_01 : android fancy_bear rat xagent 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "FANCY BEAR X-Agent - Android malware"
        reports = "CSIT-16092"
        version = "202012141612"
        last_modified = "2020-12-14"
        actor = "FANCY BEAR"
        malware_family = "X-Agent"
    strings:
        $ = "<font size=4 color=blue><br>GoogleAccounts: "
        $ = "<br>***************Call Log*************** :"
        $ = "<br>***********SMS History*********** :"
        $ = "<font size=4 color=blue><br>Browser history & bookmarks</font>"
        $ = "<font size=4 color=blue><br>File succesfully downloaded"
        $ = "<font size=4 color=blue><br>GoogleAccounts:"
        $ = "<font size=4 color=blue><br>WiFi Network is available</font></pre>"
        $ = "<font size=4 color=blue><br>WiFi Network is available</font><br> LinkSpeed:"
        $ = "<font size=4 color=blue><br>mobile data usage is available</font><br> SubtypeName:"
        $ = "<font size=4 color=red><br>Empty history</font>"
        $ = "<font size=4 color=red><br>FILE NOT FOUND"
        $ = "<font size=4 color=red><br>FILE SENDING ERROR</font></pre>"
        $ = "<font size=4 color=red><br>NO CONTACTS !!!</font></pre>"
        $ = "<font size=4 color=red><br>WiFi Network is NOT available</font></pre>"
        $ = "<pre><font size=4 color=green><br>CMD 100 success</font>"
        $ = "<pre><font size=4 color=green><br>CMD 101 success</font>"
        $ = "<pre><font size=4 color=green><br>CMD 102 success</font>"
        $ = "<pre><font size=4 color=green><br>CMD 104 success</font>"
        $ = "<pre><font size=4 color=green><br>CMD 106 success</font>"
        $ = "<pre><font size=4 color=green><br>CMD 107 success</font>"
        $ = "<pre><font size=4 color=green><br>CMD 109 success</font>"
        $ = "<pre><font size=4 color=green><br>CMD 110 success</font>"
        $ = "<pre><font size=4 color=green><br>CMD 111 success</font>"
        $ = "<pre><font size=4 color=green><br>CMD 112 failure</font>"
        $ = "<pre><font size=4 color=green><br>CMD 112 success</font>"
        $ = "mil/poprD30/BinDataConstructor"
        $ = "mil/poprD30/DataConstructor"
        $ = "mil/poprD30/DataExtractor"
        $ = "mil/poprD30/MainService"
        $ = "mil/poprD30/NetworkStateReceiver"
        $ = "mil/poprD30/ReqG"
        $ = "mil/poprD30/ReqP"
        $ = "mil/poprD30/ReqPbin"
    condition:
        2 of them
}

rule CrowdStrike_CSIT_16092_02 : android fancy_bear rat xagent 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "FANCY BEAR X-Agent - Android APK"
        reports = "CSIT-16092"
        version = "202012141612"
        last_modified = "2020-12-14"
        actor = "FANCY BEAR"
        malware_family = "X-Agent"
    strings:
        $s01 = "classes.dex" fullword
        $s02 = "AndroidManifest.xml" fullword
        $s03 = "res/drawable-hdpi/dmk.png"
        $s04 = "res/drawable-hdpi/ic_launcher.png"
        $s05 = "res/drawable-mdpi/fon_1.jpg"
        $s06 = "res/drawable-mdpi/fon_2.png"
        $s07 = "res/drawable-mdpi/fon_3.png"
        $s08 = "res/drawable-mdpi/ic_action_search.png"
        $s09 = "res/drawable-mdpi/ic_launcher.png"
        $s10 = "res/drawable-mdpi/panel_7.png"
        $s11 = "res/drawable-mdpi/panel_2.gifGIF89a"
        $omit = { 27 a3 8d 42 00 00 00 00 00 00 00 00 00 00 00 00 20 00 04 00 72 65 }
    condition:
        all of ($s*) and not $omit
}

rule CrowdStrike_CSIT_16101_01 : cozy_bear artifact 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Artifacts seen in targeted emails sent by COZY BEAR in attacks described in CSIT-16101"
        reports = "CSIT-16101"
        version = "201609050000"
        last_modified = "2016-09-05"
        actor = "COZY BEAR"
    strings:
        $str_from = "halberts@iiss.org" ascii wide
        $str_attach_name = "58-4-2-ven-bruusgaard.xls" ascii wide
        $str_orig_ip = "104.145.235.35" ascii wide
        $str_subject = "Subject: Latest Research on Russian Strategic Deterrence" ascii wide
    condition:
        any of them
}

rule CrowdStrike_CSIT_16101_02 : cozy_bear delivery_document 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects documents with malicious macros used by COZY BEAR in August 2016 campaign"
        reports = "CSIT-16101"
        version = "201609050000"
        last_modified = "2016-09-05"
        actor = "COZY BEAR"
    strings:
        $header = { d0 cf 11 e0 }
        $enc_M = "&H4D"
        $str_macro_smbios = "SMBIOSBIOSVersion7"
        $str_macro_part = "PartOfDomain"
        $str_macro_serial = "SerialNumber"
        $str_macro_device = "DeviceId"
        $str_macro_create = "CreateObject"
        $str_macro_text = "CreateTextFile"
        $str_macro_appdata = "%APPDATA%\\Adobe\\"
        $str_auto_1 = "Auto_Open"
        $str_auto_2 = "AutoOpen"
        $str_beforeclose_wb = "WorkbookBeforeClose"
        $str_beforeclose_d = "DocumentBeforeClose"
    condition:
        filesize < 5MB and ( (($header at 0 and $enc_M and (any of ($str_auto_*)) and (any of ($str_beforeclose*))) and (2 of ($str_macro_*))) or (($header at 0) and $enc_M and (any of ($str_auto_*)) and (3 of ($str_macro_*))) )
}

rule CrowdStrike_CSIT_16101_03 : cozy_bear rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "COZY BEAR stage 1 RAT - seen on disk"
        reports = "CSIT-16101"
        version = "201609050000"
        last_modified = "2016-09-05"
        actor = "COZY BEAR"
    strings:
        $code_va_00402498 = { 56 57 be ?? ?? ?? ?? 89 f7 b9 ?? ?? ?? ?? 8a 06 32 47 ff 32 47 fe 88 06 4e 4f e2 f2 5f 5e c3 } // Api loading loop
        $code_va_00402380 = { ad 09 c0 74 16 50 53 ff 15 ?? ?? ?? ?? 09 c0 75 07 c7 45 f9 00 00 00 00 ab eb e5 } // PNG parsing loop
        $code_va_004026D7 = { 8b 06 0f c8 81 7c 30 10 49 44 41 54 74 07 01 c6 83 c6 0c eb eb }
    condition:
        any of them
}

rule CrowdStrike_CSIT_16101_04 : cozy_bear rat unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "COZY BEAR stage 2 RAT - seen in memory"
        reports = "CSIT-16101"
        version = "201609050000"
        last_modified = "2016-09-05"
        actor = "COZY BEAR"
    strings:
        $str_alpha_1 = "tZCA8DmTqJ6WFKhUI.vVcX3aPgzHnsNM2Y59ekBdbEywiplOoRGjx7f1r0QSL4u"
        // Translation code
        $str_alpha_2 = "tngmrdxQ3wsh.E0YeoJcC6pZflKNVvkD5A2OTuGWz9qHLIXi1yRSMPF4jUb8a7B"
        // Unxor string loop
        $code_va_7034E320 = { 2d ?? ?? ?? ?? 89 c2 81 c2 ?? ?? ?? ?? 0f b6 02 83 ee 01 88 86 ?? ?? ?? ?? 83 fe ff 74 22 0f be 04 33 c7 04 24 ?? ?? ?? ?? 89 44 24 04 e8 ?? ?? ?? ?? 85 c0 75 ca ba ?? ?? ?? ?? eb d0 }
        $code_va_7034EFE0 = { 89 c8 f7 e7 89 c8 c1 ea 03 6b d2 1a 29 d0 0f b6 44 04 06 30 04 0b 83 c1 01 39 f1 75 e3 }
    condition:
        any of them
}

rule CrowdStrike_CSIT_16111_02 : ricochet_chollima stratus rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "XOR keys used in samples of Stratus RAT"
        reports = "CSIT-16111"
        version = "201609060000"
        last_modified = "2016-09-06"
        actor = "RICOCHET CHOLLIMA"
        malware_family = "Stratus"
    strings:
        $key1 = { ff ec 90 47 b3 f5 c3 e9 00 0c 59 eb 14 9c 15 34
        5f 13 13 a5 33 25 e8 cb 6b 8e f4 c7 cd 5b 26 fb
        bb 34 dc c2 3f a6 c9 7c d0 92 9b 36 5e e7 48 79
        f4 be 06 f2 ee 26 18 d3 b0 11 b5 53 32 76 f5 df }
        $key2 = { 51 d1 a4 75 fb b7 1d ca 59 2f d4 68 23 35 c1 05
        4f d7 78 04 c2 85 71 9c fe 55 b7 88 8d a0 dc ea
        95 e8 8f d4 9b df c8 d3 c0 a7 b4 e3 67 af e5 c9
        47 77 1a 91 ec 08 9e 87 ac 7d 57 30 78 dc 83 ba }
        $key3 = { bb c5 73 b1 53 9e 7c d5 4a 14 5b f8 81 0e 40 a7
        0c bd 53 aa 76 d4 c9 a2 08 73 89 77 2c 9e 39 21
        9d ca b4 21 25 5c e0 47 76 74 95 9f 1e f1 19 e6
        b9 cb 94 1c a4 ac 2f 56 bc c4 c7 b1 28 8f bb 39 }
    condition:
        any of them
}

rule CrowdStrike_CSIT_16111_01 : ricochet_chollima stratus rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Strings contained in Stratus RAT"
        reports = "CSIT-16111"
        version = "201807301059"
        last_modified = "2018-07-30"
        actor = "RICOCHET CHOLLIMA"
        malware_family = "Stratus"
    strings:
        $file1 = "cldbct.dll"
        $file2 = "cldb.dat"
        $file3 = "AICFL.tmp"
        $file4 = "Websvc.bat"
        $file5 = "scsvc.bat"
        $format = "%04d%02d%02d%02d"
        $del1 = "regsvr32.exe /s /u %s\\r\\ntskill explorer\\r\\n:Repeat 1\\nDel %s\\nif exist %s goto Repeat 1\\nDel %s\\n"
        $del2 = ":Repeat 1\\nSleep 1\\nDel %s\\nif exist %s goto Repeat 1\\nDel %s\\n"
        $proc1 = "procexp.exe"
        $proc2 = "procmon.exe"
        $proc3 = "prcview.exe"
        $proc4 = "ethereal.exe"
        $proc5 = "commview.exe"
        $proc6 = "avp.exe"
    condition:
        ((2 of ($file*)) and $format) and ((1 of ($del*)) or (3 of ($proc*)))
}

rule CrowdStrike_CSIT_16108_01 : gothic_panda sportloader downloader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detection for SportLoader downloader used to obtain Pirpi malware"
        reports = "CSIT-16108"
        version = "201609090000"
        last_modified = "2016-09-09"
        actor = "GOTHIC PANDA"
        malware_family = "SportLoader"
    strings:
        $ = ".bat"
        $ = ".cmd"
        $ = ".exe"
        $ = ".com"
        $ = /[0-9]+\[\%d\]\.gif/
        $ = "expand.exe"
        $ = "open"
    condition:
        all of them
}

rule CrowdStrike_CSIT_16108_02 : gothic_panda sportloader artifact 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detection for LNK file used to download SportLoader"
        reports = "CSIT-16108"
        version = "201609090000"
        last_modified = "2016-09-09"
        actor = "GOTHIC PANDA"
        malware_family = "SportLoader"
    strings:
        $ = "tom-pc"
        $ = "Windows"
        $ = "powershell.exe"
        $ = { 00 77 00 2d 00 4f 00 62 00 6a 00 65 00 63 00 74 }
    condition:
        uint16(0) == 0x004c and all of them
}

rule CrowdStrike_CSIT_16080_01 : wordie rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "WordIE RAT"
        reports = "CSIT-16080"
        version = "201609130000"
        last_modified = "2016-09-13"
        malware_family = "WordIE"
    strings:
        $format1 = "s|%s|4|%d|%4d-%02d-%02d %02d:%02d:%02d"
        $format2 = "%s|%s|5|%d|%4d-%02d-%02d %02d:%02d:%02d"
        $b_cmd1 = "ilist"
        $b_cmd2 = "dumps.dat"
        $b_cmd3 = "makescr.dat"
        $b_rid = ";TID="
        $b_url = "/news.asp"
        $b_file = "wordpade.exe"
        $b_mutex = "Global\\wordIE"
    condition:
        (1 of ($format*)) and (3 of ($b_*))
}

rule CrowdStrike_CSIT_16080_02 : wordie rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "WordIE RAT string obfuscation"
        reports = "CSIT-16080"
        version = "201609130000"
        last_modified = "2016-09-13"
        malware_family = "WordIE"
    strings:
        $key = "fuckthisplace"
        $api1 = "cbyNEyxVn0PKJNSK9Q=="
        $api2 = "cbyNEyxVn0PGO9+K0QlbMQ=="
        $api3 = "cKaNBhFLn1nXMcCR0RlbMQ=="
        $api4 = "cKaNBh9fnmXgJcSBxx5nFS+8s7abcQ=="
    condition:
        $key and (1 of ($api*))
}

rule CrowdStrike_CSIT_16110_01 : shadow_crane cookle downloader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Cookle downloader"
        reports = "CSIT-16110"
        version = "201805110857"
        last_modified = "2018-05-11"
        actor = "SHADOW CRANE"
        malware_family = "Cookle"
    strings:
        $strdec = { 8b 4d f0 8a 04 0e 8a d8 80 e3 0c 8a d0 c0 fa 02 02 db 80 e2 0c 02 db 0a d3 24 c3 0a d0 88 14 0e 46 3b f7 }
        $contenttype_dec = "Content-Type: multipart/form-data; boundary=---------7e01122020806f2" wide
        $contenttype_enc = "OTk5OTk5OTk5OTkfWQwNDQ4ODA4MLAweWg4xIkN7elxZelw5UGlPTHtPaVxpe3ouC"
        $str2_enc = "Q3t6XFl6XDlUbUxZLgh5XXhcaUxJTlw7WntOeTlYSVxJLwhKe116WElObT05OTk5OTk5OTkfWQwNDQ4ODA4MLAweWg4="
        $pdb = "C:\\Users\\user\\Documents\\Visual Studio 2010\\Projects\\LDE"
    condition:
        any of them
}

rule CrowdStrike_CSIT_16110_02 : exploit delivery_document 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Possible exploit document with control block at the end and key 0xDEADF00D"
        reports = "CSIT-16110"
        version = "201609140000"
        last_modified = "2016-09-14"
    strings:
        $block = { 00 ?? ?? ?? 00 ?? ?? ?? 00 ?? ?? ?? 00 0d f0 ad de }
    condition:
        $block at (filesize - 17)
}

rule CrowdStrike_CSIT_16110_03 : shadow_crane cookle downloader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Cookle downloader, related variant"
        reports = "CSIT-16110"
        version = "201805141233"
        last_modified = "2018-05-14"
        actor = "SHADOW CRANE"
        malware_family = "Cookle"
    strings:
        $c2_token = "yahoo_img_src"
        $c2_beacon_1 = /banner[\d]{1}\.php/
        $c2_beacon_2 = /search[\d]{1}\.php/
        $fail = "fail"
        $code = { 8b 45 fc 0f b6 4c 05 f4 d1 f9 8b 55 fc 88 4c 15 f4 8b 45 fc 0f b6 4c 05 f4 81 c9 80 00 00 00 8b 55 fc 88 4c 15 f4 eb 11 }
    condition:
        ($c2_token and $fail and 1 of ($c2_beacon*)) or $code
}

rule CrowdStrike_CSIT_16107_01 : downloader hancitor unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Hancitor downloader (unpacked)"
        reports = "CSIT-16107"
        version = "202010291406"
        last_modified = "2020-10-29"
        malware_family = "Hancitor"
    strings:
        $fmt_str1 = "GUID=%I64u&BUILD=%s&INFO=%s"
        $fmt_str2 = "&IP=%s&TYPE=1&WIN=%d.%d"
        $ua1 = "Mozilla/5.0 (Windows NT 6.1; rv:24.0) Gecko/20100101 Firefox/24.0"
        $ua2 = "Mozilla/5.0 (Windows NT 6.1; Win64; x64; Trident/7.0; rv:11.0) like Gecko"
        $str1 = "GetNativeSystemInfo"
        $str2 = "http://api.ipify.org"
        $str3 = "WinHost32.exe"
        $str4 = "Content-Type: application/x-www-form-urlencoded"
    condition:
        1 of ($fmt_str*) and 1 of ($ua*) and 3 of ($str*)
}

rule CrowdStrike_CSIT_16131_03 : quilted_tiger badnews rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Badnews Malware jli.dll"
        reports = "CSIT-16131"
        version = "201807300835"
        last_modified = "2018-07-30"
        actor = "QUILTED TIGER"
        malware_family = "Badnews"
    strings:
        $base64_alphabet_upper = "ABCDEFGHIJKLMNOPQRSTUVWXYZ"
        $base64_alphabet_lower = "abcdefghijklmnopqrstuvwxyz"
        $dll_export_01 = "JLI_AcceptableRelease"
        $dll_export_02 = "JLI_ExactVersionId"
        $dll_export_03 = "JLI_FreeManifest"
        $dll_export_04 = "JLI_JarUnpackFile"
        $dll_export_05 = "JLI_ManifestIterate"
        $dll_export_06 = "JLI_MemAlloc"
        $dll_export_07 = "JLI_MemFree"
        $dll_export_08 = "JLI_MemRealloc"
        $dll_export_09 = "JLI_ParseManifest"
        $dll_export_10 = "JLI_PrefixVersionId"
        $dll_export_11 = "JLI_StringDup"
        $dll_export_12 = "JLI_ValidVersionString"
        $dll_export_13 = "JLI_WildcardExpandClasspath"
        $start_marker = "{{"
        $end_marker = "}}"
        $ = "DMCZ0001.dat"
        $ = "TZ0000002.dat"
        $ = "TZ0000001.dat"
        $ = "TY10.dat"
    condition:
        all of them
}

rule CrowdStrike_CSIT_16109_01 : dropper uroboros venomous_bear 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "VENOMOUS BEAR PNG Resource Dropper"
        reports = "CSIT-16109"
        version = "201911041327"
        last_modified = "2019-11-04"
        actor = "VENOMOUS BEAR"
        malware_family = "Uroboros"
    strings:
        $ = { af be ad de }
        $ = { fc 01 59 21 }
        $ = { 05 00 59 21 }
        $ = "GdiplusStartup"
        $ = "GdiplusShutdown"
        $ = "GdipBitmapLockBits"
        $ = "GdipBitmapUnlockBits"
    condition:
        all of them
}

rule CrowdStrike_CSIT_16109_02 : artifact dropper uroboros venomous_bear 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "VENOMOUS BEAR PNG Resource"
        reports = "CSIT-16109"
        version = "201911041328"
        last_modified = "2019-11-04"
        actor = "VENOMOUS BEAR"
        malware_family = "Uroboros"
    strings:
        $ = { 49 44 41 54 78 5e ec ?d 2d ?? a4 ba b6 }
    condition:
        all of them
}

rule CrowdStrike_CSIT_16117_01 : ricochet_chollima cirrus rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Cirrus RAT - Generic signature"
        reports = "CSIT-16117"
        version = "201609230000"
        last_modified = "2016-09-23"
        actor = "RICOCHET CHOLLIMA"
        malware_family = "Cirrus"
    strings:
        $pcloud1 = "api.pcloud.com"
        $pcloud2 = "/currentserver"
        $pcloud3 = "/uploadfile?folderid=0&progresshash=upload-%s-xhr-%d&nopartial=1&"
        $http1 = "Mozilla/5.0 (Windows NT 6.1; WOW64; Trident/7.0; rv:11.0) like Gecko"
        $http2 = "Accept-Language: en-US,en;q=0.7,ko;q=0.3"
        $http3 = "boundary=---------------------------7df17010b01765"
        $hwp = ".hwp" ascii wide
    condition:
        (2 of ($pcloud*)) and (2 of($http*)) and ($hwp)
}

rule CrowdStrike_CSIT_16117_02 : ricochet_chollima cirrus rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Cirrus RAT - variant 1"
        reports = "CSIT-16117"
        version = "201609230000"
        last_modified = "2016-09-23"
        actor = "RICOCHET CHOLLIMA"
        malware_family = "Cirrus"
    strings:
        $marker = "[DIR]"
        $dat = "%s.dat"
        $file = "group%d.css"
        $cmd1 = "dir /a:-d /od /tw /s c:\\users\\*.doc*,c:\\users\\*.xls*,c:\\users\\*.hwp"
        $cmd2 = "tasklist >>"
    condition:
        all of them
}

rule CrowdStrike_CSIT_16135_01 : fancy_bear downrage rat macos 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "DownRage macOS variant"
        reports = "CSIT-16135"
        version = "201807301113"
        last_modified = "2018-07-30"
        actor = "FANCY BEAR"
        malware_family = "DownRage"
    strings:
        $ = "__ZN6InfoOS14getProcessList"
        $ = "__ZN6InfoOS11getIdLoader"
        $ = "__ZN6Loader21generateUrlParameters"
        $ = "__ZN6Loader18createHelloMessageEv"
        $ = "/Users/kazak/Desktop/Project/komplex/komplex/"
        $ = "Mac OS X - %s\x0aOperation system name - %s\x0aUser name - %s\x0aUse proxy - %s\x0a\t\t\t\t\t\tProcess list :\x0a\x0a%s"
    condition:
        any of them
}

rule CrowdStrike_CSIT_16135_02 : fancy_bear downrage dropper macos 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "DownRage macOS dropper"
        reports = "CSIT-16135"
        version = "201807301113"
        last_modified = "2018-07-30"
        actor = "FANCY BEAR"
        malware_family = "DownRage"
    strings:
        $ = "Y2htb2QgNzU1IC9Vc2Vycy9TaGFyZWQvZHVmaCAmPiAvZGV2L251bGw="
        $ = "cp /Users/Shared/com.apple.updater.plist $HOME/Library/LaunchAgents  &>/dev/null"
        $ = "bWtkaXIgLXAgL1VzZXJzL1NoYXJlZC8gJj4gL2Rldi9udWxs"
        $ = "chmod 755 /Users/Shared/.local/kextd"
        $ = "chmod 755 /Users/Shared/start.sh"
        $ = "/Users/Shared/start.sh"
        $ = "#!/bin/sh\x0alaunchctl load -w ~/Library/LaunchAgents/com.apple.updates.plist\x0a\x0a"
        $ = "<string>/Users/Shared/.local/kextd</string>"
    condition:
        2 of them
}

rule CrowdStrike_CSIT_16117_03 : ricochet_chollima cirrus rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Cirrus RAT - variant 2"
        reports = "CSIT-16117"
        version = "201609290000"
        last_modified = "2016-09-29"
        malware_family = "Cirrus"
    strings:
        $file = "*****" ascii wide
        $sqllite = "RIGHT and FULL OUTER JOINs are not currently supported"
        $upload = "/uploadfile?folderid=0&progresshash=upload-%s-xhr-%d"
        $mac = "%02x%02x%02x%02x%02x%02x"
        $exe = "%s%s.exe"
    condition:
        all of them
}

rule CrowdStrike_CSIT_16115_01 : predator_panda hexrat dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "SFX Dropper for HexRAT"
        reports = "CSIT-16115"
        version = "201610020000"
        last_modified = "2016-10-02"
        actor = "PREDATOR PANDA"
        malware = "HexRAT"
    strings:
        $pdb = "d:\\Projects\\WinRAR\\SFX\\build\\sfxrar32\\Release\\sfxrar.pdb"
        $file_potdll = "PotPlayer.dll"
        $file_potplayer = "PotPlayerMini.exe"
        $file_appinfo = "appinfo.dat"
        $file_update = "update.dat"
    condition:
        $pdb and (3 of ($file_*))
}

rule CrowdStrike_CSIT_16115_02 : hexrat rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Distinctive XOR loop used in HexRAT"
        reports = "CSIT-16115"
        version = "201610020000"
        last_modified = "2016-10-02"
        actor = "PREDATOR PANDA"
        malware = "HexRAT"
    strings:
        $code_va_100012C4 = { b1 ?? 33 c0 30 0c 30 40 80 c1 02 3d ?? ?? 00 00 72 f2 }
    condition:
        any of them
}

rule CrowdStrike_CSIT_16128_01 : gootkit loader unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Gootkit loader DLL running in memory"
        reports = "CSIT-16128"
        version = "201807301038"
        last_modified = "2018-07-30"
        malware_family = "Gootkit"
    strings:
        $vend1 = "unstable_%d"
        $vend2 = "servicedll_%d"
        $vend3 = "scheduler_%d"
        $s1 = "crackme"
        $s2 = "vendor_id"
        $s3 = "rpersist"
        $avm1 = "INTEL  - 6040000"
        $avm2 = "BOCHS"
        $avm3 = "VBOX"
        $avm4 = "QEMU"
        $avm5 = "FTNT-1"
        $avm6 = "7SILVIA"
    condition:
        1 of ($vend*) and all of ($s*) and 2 of ($avm*)
}

rule CrowdStrike_CSIT_16106_06 : vbe3link proxy 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Encoded VBE3link malware instance"
        reports = "CSIT-16106"
        version = "201807251342"
        last_modified = "2018-07-25"
        malware_family = "VBE3link"
    strings:
        // -e0.0.0.0
        $vbe_04_00 = { 52 2b 5a 20 21 63 21 20 54 }
        $vbe_04_01 = { 4f 6e 21 63 54 52 5a 52 54 }
        $vbe_04_02 = { 20 6e 21 63 21 20 21 63 21 }
        $vbe_04_03 = { 20 2b 21 63 54 20 21 63 21 }
        $vbe_04_04 = { 20 2b 5a 20 21 63 21 20 21 }
        $vbe_04_05 = { 52 6e 5a 52 21 20 54 63 21 }
        $vbe_04_06 = { 20 6e 5a 52 54 63 21 63 21 }
        $vbe_04_07 = { 4f 2b 5a 52 5a 20 21 63 21 }
        $vbe_04_08 = { 20 2b 21 63 54 52 5a 52 21 }
        $vbe_04_09 = { 4f 2b 54 20 5a 52 54 52 5a }
        $vbe_04_10 = { 4f 7f 21 20 54 63 21 52 5a }
        $vbe_04_11 = { 52 7f 21 20 21 63 54 63 21 }
        $vbe_04_12 = { 4f 7f 21 20 54 63 21 52 54 }
        $vbe_04_13 = { 4f 7f 54 52 5a 52 21 63 54 }
        $vbe_04_14 = { 20 2b 54 52 54 20 5a 52 54 }
        $vbe_04_15 = { 52 2b 5a 52 21 63 54 20 21 }
        $vbe_04_16 = { 20 2b 5a 52 54 52 54 20 5a }
        $vbe_04_17 = { 4f 7f 21 52 5a 20 54 52 5a }
        $vbe_04_18 = { 52 2b 5a 52 54 20 5a 52 21 }
        $vbe_04_19 = { 20 2b 5a 52 21 63 21 63 54 }
        $vbe_04_20 = { 20 2b 54 20 5a 52 21 20 54 }
        $vbe_04_21 = { 4f 7f 21 52 5a 52 5a 20 21 }
        $vbe_04_22 = { 4f 7f 21 63 54 52 5a 52 54 }
        $vbe_04_23 = { 4f 7f 21 63 21 20 21 20 54 }
        $vbe_04_24 = { 4f 6e 21 20 54 63 21 20 21 }
        $vbe_04_25 = { 20 6e 54 52 5a 52 5a 52 54 }
        $vbe_04_26 = { 20 2b 54 52 5a 20 5a 52 54 }
        $vbe_04_27 = { 20 2b 54 63 21 63 21 52 5a }
        $vbe_04_28 = { 4f 7f 21 20 21 63 21 20 54 }
        $vbe_04_29 = { 52 7f 21 20 5a 52 5a 52 21 }
        $vbe_04_30 = { 4f 7f 21 20 21 20 54 63 21 }
        $vbe_04_31 = { 20 2b 54 20 5a 52 21 63 54 }
        $vbe_04_32 = { 4f 6e 54 63 21 52 54 20 5a }
        $vbe_04_33 = { 4f 7f 54 20 21 63 21 63 21 }
        $vbe_04_34 = { 20 2b 54 52 5a 20 21 63 21 }
        $vbe_04_35 = { 52 2b 54 20 5a 52 54 52 5a }
        $vbe_04_36 = { 52 7f 21 63 21 52 5a 52 5a }
        $vbe_04_37 = { 4f 2b 5a 20 21 63 21 52 5a }
        $vbe_04_38 = { 52 2b 5a 52 5a 52 54 52 54 }
        $vbe_04_39 = { 52 2b 5a 52 54 52 5a 52 54 }
        $vbe_04_40 = { 20 6e 21 63 21 20 54 63 21 }
        $vbe_04_41 = { 52 7f 21 52 5a 20 21 63 21 }
        $vbe_04_42 = { 4f 6e 54 63 21 52 5a 20 21 }
        $vbe_04_43 = { 52 6e 21 63 21 63 21 20 21 }
        $vbe_04_44 = { 4f 7f 54 52 5a 52 54 52 5a }
        $vbe_04_45 = { 20 6e 21 63 21 52 5a 20 54 }
        $vbe_04_46 = { 52 6e 5a 52 54 52 5a 20 21 }
        $vbe_04_47 = { 52 6e 5a 52 21 63 54 52 5a }
        $vbe_04_48 = { 4f 7f 54 52 5a 52 54 20 5a }
        $vbe_04_49 = { 52 2b 5a 20 5a 52 54 63 21 }
        $vbe_04_50 = { 20 2b 54 52 5a 52 54 20 5a }
        $vbe_04_51 = { 52 7f 21 52 54 20 5a 52 54 }
        $vbe_04_52 = { 20 2b 21 63 21 63 54 52 5a }
        $vbe_04_53 = { 4f 6e 21 63 21 20 54 63 21 }
        $vbe_04_54 = { 52 6e 5a 52 54 52 5a 20 5a }
        $vbe_04_55 = { 4f 2b 5a 20 54 52 5a 52 5a }
        $vbe_04_56 = { 4f 6e 54 63 21 20 21 63 54 }
        $vbe_04_57 = { 20 2b 21 20 54 63 21 20 21 }
        $vbe_04_58 = { 4f 7f 54 63 21 20 5a 52 5a }
        $vbe_04_59 = { 4f 6e 5a 52 5a 52 21 63 21 }
        $vbe_04_60 = { 4f 6e 21 63 54 63 21 20 5a }
        $vbe_04_61 = { 52 7f 21 20 21 63 54 52 5a }
        // -i127.0.0.
        $vbe_05_00 = { 20 6b 71 20 46 52 54 20 5a 52 }
        $vbe_05_01 = { 52 6b 38 20 47 63 54 20 21 63 }
        $vbe_05_02 = { 52 62 46 2b 47 63 54 52 5a 52 }
        $vbe_05_03 = { 4f 62 71 20 46 52 21 63 54 20 }
        $vbe_05_04 = { 4f 62 46 79 7b 52 5a 52 54 52 }
        $vbe_05_05 = { 20 6b 46 2b 7b 63 21 20 21 63 }
        $vbe_05_06 = { 4f 62 71 79 47 20 5a 52 5a 52 }
        $vbe_05_07 = { 4f 62 46 2b 7b 63 21 52 54 20 }
        $vbe_05_08 = { 4f 72 46 79 7b 63 21 20 5a 52 }
        $vbe_05_09 = { 4f 62 46 20 46 52 5a 20 21 63 }
        $vbe_05_10 = { 52 6b 38 2b 46 52 54 63 21 63 }
        $vbe_05_11 = { 20 6b 71 79 47 63 21 52 5a 52 }
        $vbe_05_12 = { 52 72 38 20 47 20 54 63 21 20 }
        $vbe_05_13 = { 4f 62 71 20 46 52 54 52 5a 52 }
        $vbe_05_14 = { 4f 72 71 79 47 52 5a 20 21 63 }
        $vbe_05_15 = { 20 6b 71 20 7b 20 5a 52 54 52 }
        $vbe_05_16 = { 52 72 38 20 7b 52 5a 20 5a 52 }
        $vbe_05_17 = { 52 6b 71 2b 46 52 54 52 5a 20 }
        $vbe_05_18 = { 20 72 38 20 7b 63 21 63 21 52 }
        $vbe_05_19 = { 52 72 38 20 7b 52 5a 20 21 63 }
        $vbe_05_20 = { 4f 6b 38 2b 7b 52 5a 52 5a 52 }
        $vbe_05_21 = { 4f 62 46 2b 7b 63 21 52 5a 20 }
        $vbe_05_22 = { 4f 6b 38 2b 47 63 21 52 5a 20 }
        $vbe_05_23 = { 20 6b 46 79 7b 20 21 63 21 63 }
        $vbe_05_24 = { 20 6b 71 2b 46 52 21 63 54 52 }
        $vbe_05_25 = { 4f 62 71 20 46 52 54 20 5a 52 }
        $vbe_05_26 = { 52 6b 38 20 46 52 54 52 54 20 }
        $vbe_05_27 = { 4f 6b 71 2b 46 52 54 52 5a 20 }
        $vbe_05_28 = { 20 6b 38 20 47 63 21 63 54 52 }
        $vbe_05_29 = { 52 62 46 2b 46 52 5a 52 21 63 }
        $vbe_05_30 = { 4f 62 71 2b 47 63 21 63 21 20 }
        $vbe_05_31 = { 4f 72 46 2b 7b 63 21 20 21 63 }
        $vbe_05_32 = { 20 6b 71 20 46 20 21 63 21 20 }
        $vbe_05_33 = { 52 62 46 79 47 52 5a 52 5a 20 }
        $vbe_05_34 = { 4f 72 46 79 47 20 54 63 21 52 }
        $vbe_05_35 = { 20 6b 38 2b 47 63 21 20 21 63 }
        $vbe_05_36 = { 20 72 46 79 47 20 54 63 21 52 }
        $vbe_05_37 = { 4f 72 38 20 46 52 21 63 21 63 }
        $vbe_05_38 = { 4f 62 46 20 46 20 54 52 5a 52 }
        $vbe_05_39 = { 20 72 46 79 47 52 5a 20 54 52 }
        $vbe_05_40 = { 4f 72 46 79 7b 52 5a 52 54 20 }
        $vbe_05_41 = { 4f 72 71 79 47 52 54 20 5a 52 }
        $vbe_05_42 = { 52 62 46 2b 47 63 54 63 21 20 }
        $vbe_05_43 = { 52 72 38 20 47 63 54 52 5a 52 }
        $vbe_05_44 = { 52 62 46 20 7b 20 5a 52 54 52 }
        $vbe_05_45 = { 52 6b 38 20 7b 52 5a 52 54 20 }
        $vbe_05_46 = { 20 6b 38 20 7b 52 54 20 5a 52 }
        $vbe_05_47 = { 20 6b 71 2b 46 52 21 20 54 63 }
        $vbe_05_48 = { 4f 62 46 79 47 20 21 20 54 63 }
        $vbe_05_49 = { 20 72 46 79 47 20 21 63 21 20 }
        $vbe_05_50 = { 52 62 46 20 46 20 21 63 21 52 }
        $vbe_05_51 = { 4f 72 71 79 47 20 21 63 54 63 }
        $vbe_05_52 = { 20 6b 46 79 47 63 54 52 5a 52 }
        $vbe_05_53 = { 20 6b 71 20 46 20 5a 52 54 63 }
        $vbe_05_54 = { 20 6b 46 79 7b 52 5a 52 21 63 }
        $vbe_05_55 = { 52 72 46 79 47 63 21 20 21 20 }
        $vbe_05_56 = { 52 6b 38 20 7b 20 5a 52 21 63 }
        $vbe_05_57 = { 20 72 71 20 46 52 5a 52 54 52 }
        $vbe_05_58 = { 52 6b 38 2b 47 63 21 20 54 63 }
        $vbe_05_59 = { 4f 62 46 2b 47 63 21 20 54 63 }
        $vbe_05_60 = { 52 6b 38 20 7b 20 5a 52 21 20 }
        $vbe_05_61 = { 4f 72 71 79 47 20 21 63 54 52 }
        $vbe_05_62 = { 4f 6b 38 20 46 20 21 63 21 20 }
        $vbe_05_63 = { 4f 62 46 2b 47 20 54 63 21 20 }
        // -ssh
        $vbe_08_00 = { 20 64 6b 74 }
        $vbe_08_01 = { 4f 6b 2f 34 }
        $vbe_08_02 = { 4f 64 64 34 }
        $vbe_08_03 = { 52 2f 6b 74 }
        $vbe_08_04 = { 4f 6b 64 34 }
        $vbe_08_05 = { 4f 2f 64 34 }
        $vbe_08_06 = { 52 6b 2f 34 }
        $vbe_08_07 = { 20 64 2f 34 }
        $vbe_08_08 = { 4f 64 6b 74 }
        $vbe_08_09 = { 20 2f 6b 74 }
        $vbe_08_10 = { 52 64 6b 74 }
        $vbe_08_11 = { 20 2f 64 34 }
        $vbe_08_12 = { 4f 64 2f 34 }
        $vbe_08_13 = { 20 2f 2f 34 }
        $vbe_08_14 = { 4f 2f 6b 34 }
        $vbe_08_15 = { 52 64 2f 34 }
        $vbe_08_16 = { 4f 6b 2f 74 }
        $vbe_08_17 = { 20 64 64 74 }
        $vbe_08_18 = { 52 2f 6b 34 }
        $vbe_08_19 = { 4f 6b 64 74 }
        $vbe_08_20 = { 52 6b 2f 74 }
        $vbe_08_21 = { 20 2f 6b 34 }
        $vbe_08_22 = { 20 2f 64 74 }
        $vbe_08_23 = { 4f 2f 6b 74 }
        $vbe_08_24 = { 52 2f 64 34 }
        // :127.0.0.
        $vbe_10_00 = { 29 71 2b 46 52 21 20 54 63 }
        $vbe_10_01 = { 29 38 2b 46 52 54 63 21 63 }
        $vbe_10_02 = { 6c 71 20 46 52 5a 52 54 52 }
        $vbe_10_03 = { 3d 46 20 7b 20 5a 52 54 52 }
        $vbe_10_04 = { 6c 38 20 7b 63 21 63 21 52 }
        $vbe_10_05 = { 6c 71 79 47 20 21 63 54 52 }
        $vbe_10_06 = { 3d 71 20 46 52 21 63 54 20 }
        $vbe_10_07 = { 6c 46 79 47 63 21 20 21 20 }
        $vbe_10_08 = { 29 38 20 46 20 21 63 21 20 }
        $vbe_10_09 = { 3d 46 2b 47 63 21 20 54 63 }
        $vbe_10_10 = { 29 38 20 7b 52 54 20 5a 52 }
        $vbe_10_11 = { 29 38 20 7b 20 5a 52 21 20 }
        $vbe_10_12 = { 3d 71 20 46 52 54 52 5a 52 }
        $vbe_10_13 = { 3d 46 20 46 20 54 52 5a 52 }
        $vbe_10_14 = { 3d 71 79 47 20 5a 52 5a 52 }
        $vbe_10_15 = { 3d 71 2b 47 63 21 63 21 20 }
        $vbe_10_16 = { 29 71 20 7b 20 5a 52 54 52 }
        $vbe_10_17 = { 29 71 20 46 52 54 20 5a 52 }
        $vbe_10_18 = { 3d 46 79 47 52 5a 52 5a 20 }
        $vbe_10_19 = { 6c 46 2b 7b 63 21 20 21 63 }
        $vbe_10_20 = { 29 38 20 7b 52 5a 52 54 20 }
        $vbe_10_21 = { 29 46 2b 7b 63 21 20 21 63 }
        $vbe_10_22 = { 3d 46 2b 47 63 54 52 5a 52 }
        $vbe_10_23 = { 29 38 2b 47 63 21 52 5a 20 }
        $vbe_10_24 = { 3d 71 20 46 52 54 20 5a 52 }
        $vbe_10_25 = { 6c 38 20 46 52 21 63 21 63 }
        $vbe_10_26 = { 29 71 20 46 20 5a 52 54 63 }
        $vbe_10_27 = { 3d 46 2b 47 63 54 63 21 20 }
        $vbe_10_28 = { 6c 71 79 47 20 21 63 54 63 }
        $vbe_10_29 = { 29 71 79 47 63 21 52 5a 52 }
        $vbe_10_30 = { 6c 38 20 47 20 54 63 21 20 }
        $vbe_10_31 = { 29 38 20 47 63 54 20 21 63 }
        $vbe_10_32 = { 6c 71 79 47 52 5a 20 21 63 }
        $vbe_10_33 = { 29 46 79 47 63 54 52 5a 52 }
        $vbe_10_34 = { 6c 71 79 47 52 54 20 5a 52 }
        $vbe_10_35 = { 6c 38 20 47 63 54 52 5a 52 }
        $vbe_10_36 = { 29 46 79 7b 20 21 63 21 63 }
        $vbe_10_37 = { 29 38 2b 7b 52 5a 52 5a 52 }
        $vbe_10_38 = { 3d 46 2b 46 52 5a 52 21 63 }
        $vbe_10_39 = { 6c 38 20 7b 52 5a 20 21 63 }
        $vbe_10_40 = { 29 71 2b 46 52 21 63 54 52 }
        $vbe_10_41 = { 29 38 20 7b 20 5a 52 21 63 }
        $vbe_10_42 = { 6c 46 79 47 20 21 63 21 20 }
        $vbe_10_43 = { 3d 46 20 46 20 21 63 21 52 }
        $vbe_10_44 = { 29 38 20 46 52 54 52 54 20 }
        $vbe_10_45 = { 6c 46 79 47 52 5a 20 54 52 }
        $vbe_10_46 = { 3d 46 20 46 52 5a 20 21 63 }
        $vbe_10_47 = { 3d 46 2b 47 20 54 63 21 20 }
        $vbe_10_48 = { 6c 46 79 47 20 54 63 21 52 }
        $vbe_10_49 = { 6c 46 79 7b 52 5a 52 54 20 }
        $vbe_10_50 = { 29 71 20 46 20 21 63 21 20 }
        $vbe_10_51 = { 6c 38 20 7b 52 5a 20 5a 52 }
        $vbe_10_52 = { 29 38 2b 47 63 21 20 21 63 }
        $vbe_10_53 = { 29 38 20 47 63 21 63 54 52 }
        $vbe_10_54 = { 3d 46 2b 7b 63 21 52 54 20 }
        $vbe_10_55 = { 6c 46 79 7b 63 21 20 5a 52 }
        $vbe_10_56 = { 29 46 79 7b 52 5a 52 21 63 }
        $vbe_10_57 = { 3d 46 79 47 20 21 20 54 63 }
        $vbe_10_58 = { 29 71 2b 46 52 54 52 5a 20 }
        $vbe_10_59 = { 3d 46 79 7b 52 5a 52 54 52 }
        $vbe_10_60 = { 3d 46 2b 7b 63 21 52 5a 20 }
        $vbe_10_61 = { 29 38 2b 47 63 21 20 54 63 }
        // -pw
        $vbe_11_00 = { 52 77 41 }
        $vbe_11_01 = { 20 32 53 }
        $vbe_11_02 = { 4f 61 41 }
        $vbe_11_03 = { 20 77 41 }
        $vbe_11_04 = { 52 32 68 }
        $vbe_11_05 = { 4f 77 41 }
        $vbe_11_06 = { 4f 32 53 }
        $vbe_11_07 = { 20 77 68 }
        $vbe_11_08 = { 4f 61 68 }
        $vbe_11_09 = { 52 77 53 }
        $vbe_11_10 = { 20 32 68 }
        $vbe_11_11 = { 20 77 53 }
        $vbe_11_12 = { 4f 32 68 }
        $vbe_11_13 = { 20 32 41 }
        $vbe_11_14 = { 52 32 53 }
        $vbe_11_15 = { 52 61 68 }
        $vbe_11_16 = { 4f 77 53 }
        $vbe_11_17 = { 4f 32 41 }
    condition:
        any of ($vbe_04_*)
        and any of ($vbe_05_*)
        and any of ($vbe_08_*)
        and any of ($vbe_10_*)
        and any of ($vbe_11_*)
}

rule CrowdStrike_CSIT_16121_01 : bot linux mirai 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detection for Mirai Linux DDOS bot"
        reports = "CSIT-16121"
        version = "202104121046"
        last_modified = "2021-04-12"
        malware_family = "Mirai"
    strings:
        $ = "url="
        $ = "HTTP/1.1"
        $ = "User-Agent: "
        $ = "CRRNKACVKML"
        $ = "cRRNGuG@iKV"
    condition:
        all of them
}

rule CrowdStrike_CSIT_16121_02 : downloader linux mirai 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detection for Mirai Linux DDOS downloader"
        reports = "CSIT-16121"
        version = "202104121046"
        last_modified = "2021-04-12"
        malware_family = "Mirai"
    strings:
        $ = "MIRAI"
        $ = "FIN"
        $ = "NIF"
        $ = "dvrHelper"
        $ = { 48 54 54 50 2f 31 2e 30 0d 0a 0d 0a 00 00 00 00 }
    condition:
        all of them
}

rule CrowdStrike_CSIT_17039_01 : fancy_bear zekapab rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "FANCY BEAR Zekapab RAT"
        reports = "CSIT-17039"
        version = "201807301800"
        last_modified = "2018-07-30"
        actor = "FANCY BEAR"
        malware_family = "Zekapab"
    strings:
        $ = "-UPLOAD_AND_EXECUTE_FILE-"
        $ = "_UPLOAD_AND_EXECUTE_FILE"
        $ = "-DELETE_FILES-"
        $ = "-REG_DELETE_VALUE-"
        $ = "-REG_GET_KEYS_VALUES-"
        $ = "_REG_GET_KEYS_VALUES"
        $ = "-KILL_PROCESS-"
        $ = "_KILL_PROCESS"
        $ = "-CONFIG-"
        $ = "_CONFIG" fullword
        $ = "-FILE_EXECUTE_AND_KiLL_MYSELF-"
        $ = "_FILE_EXECUTE"
        $ = "KBrd Lang:" fullword
        $ = "IP: %s, SubNetMask: %s" fullword
        $ = "Default getaway: " fullword
        $ = "P Addreses:" fullword
    condition:
        4 of them
}

rule CrowdStrike_CSIT_16127_01 : derusbi_server rat linux 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Dropper for Derusbi Linux server variant"
        reports = "CSIT-16127"
        version = "201610190000"
        last_modified = "2016-10-19"
        malware_family = "Derusbi"
    strings:
        $ = "echo -n KHBraWx"
        $ = "|base64 -d |/bin/sh"
        $ = {6A 3B 58 99 48 BB 2F 62 69 6E 2F 73 68}
    condition:
        all of them
}

rule CrowdStrike_CSIT_16127_02 : derusbi_server rat linux 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Derusbi Linux Server usermode component"
        reports = "CSIT-16127"
        version = "201610190000"
        last_modified = "2016-10-19"
        malware_family = "Derusbi"
    strings:
        $ = "/proc/%u/cmdline"
        $ = "TERM=vt100"
        $ = "# \\u@\\h:\\w \\$"
        $ = "/sbin/insmod"
        $ = "/proc/self/exe"
        $ = "cp -a"
        $ = "ret %d" wide
    condition:
        5 of them
}

rule CrowdStrike_CSIT_16127_03 : derusbi_server rootkit linux 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Derusbi Linux Server rootkit component"
        reports = "CSIT-16127"
        version = "201610240000"
        last_modified = "2016-10-24"
        malware_family = "Derusbi"
    strings:
        $format1 = "%u.%u.%u.%u:%d->%u.%u.%u.%u:%d, tot_len %u, fragoff %u, flag %s%s%s%s%s"
        $format2 = "u.%u.%u.%u->%u.%u.%u.%u, proto %d"
        $path = "/proc/"
        $sys = "sys_call_table"
        $api1 = "nf_register_hooks"
        $api2 = "netlink_unicast"
        $api3 = "filp_open"
        $ror = { c9 89 f8 89 f1 d3 c8 c3}
    condition:
        (any of ($format*)) or (all of ($path,$sys,$api1,$api2,$api3,$ror))
}

rule CrowdStrike_CSIT_16129_01 : wizard_spider trickbot dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "TrickBot"
        reports = "CSIT-16129"
        version = "201610310000"
        last_modified = "2016-10-31"
        malware_family = "TrickBot"
    strings:
        $resource1 = "IDR_X64BOT" wide
        $resource2 = "IDR_X86BOT" wide
        $resource3 = "IDR_X64LOADER" wide
    condition:
        all of them
}

rule CrowdStrike_CSIT_16143_03 : tvspy rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "TVSpy packed payload - unpacking routine"
        reports = "CSIT-16143"
        version = "201610310000"
        last_modified = "2016-10-31"
        malware_family = "TVSpy"
    strings:
        // Start of DllEntryPoint register exception handler
        $ep_1 = { 31 c0 68 ?? ?? ?? ?? 64 ff 30 }
        // Just below trigger exception handler and call JMP 4
        $ep_2 = { f6 f0 fe c8 f6 f0 e8 04 00 00 00 }
        // Call JMP 4, pop to stack two WORD values
        $call = { e8 04 00 00 00 c8 b4 ac 00 58 8b 00 0f b7 00 }
    condition:
        (all of ($ep*)) or ($call)
}

rule CrowdStrike_CSIT_16129_02 : loader trickbot unpacked wizard_spider 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "TrickBot loader (unpacked)"
        reports = "CSIT-16129"
        version = "202103190011"
        last_modified = "2021-03-19"
        malware_family = "TrickBot"
    strings:
        $trick_loader = "TrickLoader" wide
        $bot_loader = "BotLoader" wide
        $ssert = "ssert" wide
        $expir = "expir" wide
        $moduleconfig = "<moduleconfig>*</moduleconfig>"
        $path1 = "/%s/%s/0/%s/%s/%s/%s/%s/" wide
        $path2 = "/%s/%s/1/%s/" wide
        $path3 = "/%s/%s/5/%s/" wide
        $path4 = "/%s/%s/10/%s/%s/%d/" wide
        $path5 = "/%s/%s/14/%s/%s/0/" wide
        $path6 = "/%s/%s/23/%d/" wide
        $path7 = "/%s/%s/25/%s/" wide
        $path8 = "%s/%s/63/%s/%s/%s/%s/" wide
        $mutex = "Global\\TrickBot" wide
    condition:
        8 of them
}

rule CrowdStrike_CSIT_16131_01 : quilted_tiger badnews delivery_document 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Malicious RTF dropping Badnews RAT"
        reports = "CSIT-16131"
        version = "201611020000"
        last_modified = "2016-11-02"
        actor = "QUILTED TIGER"
        malware_family = "Badnews"
    strings:
        // Generic patterns, which may match on yet unknown RTFs dropping Badnews
        $generic_rtf_magic = "{\\rt"
        $generic_microsoft_office_word_document = "004D6963726F736F6674204F666669636520576F726420446F63756D656E7400" nocase
        $generic_pk_magic = "504B0304140000" nocase
        $generic_pk_local_file_header = "504B0102140014000000080040665D475F4E9E4D020100005D01000019" nocase
        $generic_heap_spray = "776F72642F616374697665582F61637469766558312E62696E" nocase
        // Specific patterns, which only match on known RTFs dropping Badnews
        $specific_rtf_blip_id_1 = "022323a450833711eca00557cf394fc8"
        $specific_rtf_blip_id_2 = "119e178b4f20801b01cf4375bdec170d"
        $specific_rtf_blip_id_3 = "8b3f54a372e4241bc7d9a2881264cc36"
        $specific_rtf_blip_id_4 = "a725ffb7fb6e0bedaac872914f59bd5d"
        $specific_rtf_blip_id_5 = "c513a6c5695128d2736bd8176a8959c3"
        $specific_rtf_blip_id_6 = "d066be4a517cfc317c0e1a1f75c64b79"
        $specific_rtf_blip_id_7 = "e7dedd3ebba669a3f914734d7c809899"
        $specific_ole_class_id_1 = "7bA08A033D-1A75-4AB6-A166-EAD02F547959"
    condition:
        all of ($generic_*) or any of ($specific_*)
}

rule CrowdStrike_CSIT_16131_02 : quilted_tiger badnews enfourksautorat delivery_document 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Malicious PPT - possibly dropping Badnews or EnfourksAutoRAT"
        reports = "CSIT-16131"
        version = "201807300833"
        last_modified = "2018-07-30"
        actor = "QUILTED TIGER"
        malware_family = "EnfourksAutoRAT, Badnews"
    strings:
        $olefile_magic = { d0 cf 11 e0 }
        $patchwork_1 = "generated using python-pptx"
        $patchwork_2 = "Windows User"
    condition:
        $olefile_magic at 0 and all of ($patchwork*)
}

rule CrowdStrike_CSIR_15001_03 : eloquent_panda eracs rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "eRACS RAT DLL names"
        reports = "CSIR-15001"
        version = "201611030000"
        last_modified = "2016-11-03"
        actor = "ELOQUENT PANDA"
        malware_family = "eRACS"
    strings:
        $ntmcsvc = "ntmcsvc.dll" ascii wide fullword
        $ntmssvc = "ntmssvc.dll" ascii fullword
        $ntmssvc_w = "ntmssvc.dll" wide fullword
        $ntmsevc = "ntmsevc.dll" ascii wide fullword
        $wmdmsvc = "wmdmsvc.dll" ascii wide fullword
        $wmdm = "wmdm.dll" ascii wide fullword
        $ntmslib = "NtmsLib.dll" ascii wide fullword
    condition:
        2 of them and #ntmssvc_w < 2
}

rule CrowdStrike_CSIT_16106_01 : vbe3link plink 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "plink from PuTTY suite specific to VBE3Link"
        reports = "CSIT-16106"
        version = "201611030000"
        last_modified = "2016-11-03"
        malware_family = "VBE3link"
    strings:
        $plink_matcher = "The server's host key is not cached in the registry. You"
        $banner = "PuTTY-Local: Apr 17 2009 18:40:09"
    condition:
        $plink_matcher and $banner
}

rule CrowdStrike_CSIT_15075_01 : jucheck rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Jucheck RAT - mimics Java Update"
        reports = "CSIT-15075"
        version = "201807300849"
        last_modified = "2018-07-30"
        malware_family = "Jucheck"
    strings:
        $ = "http://%s/%s?l=1&q=%s"
        $ = "http://%s/%s?ul=1"
        $ = "http://%s/%s?c=1&q=%s"
        $ = "UPLOAD"
        $ = "CONFIG"
        $ = "SLEEP"
    condition:
        5 of them
}

rule CrowdStrike_CSIT_16134_01 : silent_chollima hadesbot rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "HadesBot malware used by SILENT CHOLLIMA"
        reports = "CSIT-16134"
        version = "201807300949"
        last_modified = "2018-07-30"
        actor = "SILENT CHOLLIMA"
        malware_family = "HadesBot"
    strings:
        $code_push_const_for_id = { 68 ca 78 f1 30 }
        $str_hades = "HadesBot" ascii wide nocase
        $str_default = "default123"
    condition:
        2 of them
}

rule CrowdStrike_CSIT_16138_01 : fox_stealer credential_theft unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Fox Stealer (unpacked)"
        reports = "CSIT-16138"
        version = "201807271404"
        last_modified = "2018-07-27"
        malware_family = "Fox Stealer"
    strings:
        $s1 = "botid="
        $s2 = "hello"
        $s3 = "os_version"
        $s4 = "\"password\":"
        $s5 = "moz_places"
        $s6 = "winex="
        $s7 = "origin_url"
        $s8 = "compname="
        $s9 = "username="
        $s10 = "volume_sn=0x%.8X"
        $s11 = "PROCESSOR_IDENTIFIER"
        $s12 = "Mozilla/5.0 (compatible; MSIE 10.0; Windows NT 6.1; WOW64; Trident/6.0)" wide
    condition:
        9 of them
}

rule CrowdStrike_CSIT_16019_02 : voodoo_bear blackenergy delivery_document macro 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detection for Office macro included in BlackEnergy lure documents"
        reports = "CSIT-16019"
        version = "201611110000"
        last_modified = "2016-11-11"
        actor = "VOODOO BEAR"
        malware_family = "BlackEnergy"
    strings:
        // CDFv2 document signature
        $ = { d0 cf 11 e0 a1 b1 1a e1 }
        // Macro Function Name
        $ = { 49 6e 69 74 ?? ( 38 | 31 | 30 ) }
        $ = ") = @Array("
    condition:
        all of them
}

rule CrowdStrike_CSIT_16132_01 : voodoo_bear downloader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detection for VOODOO BEAR's Telegram malware downloader"
        reports = "CSIT-16132"
        version = "201611140000"
        last_modified = "2016-11-14"
        actor = "VOODOO BEAR"
    strings:
        $ = "C:\\Users\\mr_black\\"
        $ = "C:/bot/slave/"
        $ = "rsRUST_BACKTRACE0Box"
    condition:
        all of them
}

rule CrowdStrike_CSIT_16132_02 : voodoo_bear rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detection for VOODOO BEAR's Telegram malware"
        reports = "CSIT-16132"
        version = "201611140000"
        last_modified = "2016-11-14"
        actor = "VOODOO BEAR"
    strings:
        $ = "NmKrEZA2aQN3.exe"
        $ = "requests\\cacert.pem"
        $ = "python27.dll"
        $ = "Crypto.Cipher._AES"
        $ = "Crypto.Hash._SHA256"
    condition:
        all of them
}

rule CrowdStrike_CSIT_16132_03 : macro 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detection for MacroShop created macros"
        reports = "CSIT-16132"
        version = "201611140000"
        last_modified = "2016-11-14"
    strings:
        // Embedded Copyright
        $copyright = "Generated by macro_safe.py by khr0x40sh-"
        // Macro Structure
        $path = "Arch = Environ(\"PROCESSOR_ARCHITECTURE\")"
        $var0 = "str = str + "
        $var1 = "exec = exec + "
    condition:
        ($copyright or ($path and $var0 and $var1))
}

rule CrowdStrike_CSIT_16140_01 : downloader mythic_leopard 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Downloader for RAT used by MYTHIC LEOPARD"
        reports = "CSIT-16140"
        version = "201807191407"
        last_modified = "2018-07-19"
    strings:
        $key_1 = "sdf256rt2tt" ascii wide fullword
        $key_2 = "8686vgkjgvjhfg" ascii wide fullword
        $alt_key_1 = "8gutj23" ascii wide fullword
        $mod_name_1 = "igfxtsk.exe" ascii wide fullword
    condition:
        filesize < 2048KB and any of them
}

rule CrowdStrike_CSIT_16140_02 : downloader mythic_leopard 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = ".NET GUIDS used in downloaders deployed by MYTHIC LEOPARD"
        reports = "CSIT-16140"
        version = "201807191408"
        last_modified = "2018-07-19"
    strings:
        $typelib_1 = "35e9a24a-cc3d-4b2e-dc7b-7c3673ed519a" ascii wide
        $mvid_1 = "07ab92be-ca0e-4256-a342-adcedac25753" ascii wide
        $typelib_2 = "ad1bbfe6-1d50-43ab-899d-f11609b7cd0f" ascii wide
        $mvid_2 = "7f34ccb4-fea5-4473-b684-128ad7893489" ascii wide
        $typelib_3 = "5cd334b7-2985-4e2f-a02d-485bab1e4d38" ascii wide
        $mvid_3 = "a05782d4-baac-41a9-af3c-ee039eed5e8a" ascii wide
    condition:
        filesize < 2048KB and any of them
}

rule CrowdStrike_CSIT_16140_03 : delivery_document mythic_leopard 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Malicious document used to deploy simple downloader"
        reports = "CSIT-16140"
        version = "201807191408"
        last_modified = "2018-07-19"
    strings:
        $header = { d0 cf 11 e0 }
        $str_pathdom1 = "YT4B5RV3DCu"
        $str_alpha = "ghiabcdefjklqrstuvwmnopxyz"
        $str_bela = "BelaStand"
    condition:
        $header at 0 and ( any of ($str_*) )
}

rule CrowdStrike_CSIR_16019_12 : cozy_bear atiagent config 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Encrypted RACSS Configuration File ATI-Agent Implant"
        reports = "CSIR-16019"
        version = "201611230000"
        last_modified = "2016-11-23"
        actor = "COZY BEAR"
        malware_family = "ATI-Agent"
    strings:
        $data = { 0A C4 F8 AF 71 3D C9 BE 79 70 34 5C EE E0 CD 98
        23 C1 E9 1E 63 AB 9C 43 A2 A7 79 68 3D 8A 7F 58
        2A CF F1 13 D9 67 AF 1C 74 CC BA 5D 79 87 67 AE
        34 86 8F E3 21 3E E0 B3 44 F3 AE 26 62 53 0F 95
        3B E9 0C 64 1A 7F 2A 33 D4 FD D6 F7 5F 3F 5A 9D
        8E 50 38 51 E1 32 4B 20 B2 48 A9 05 C5 62 60 1D }
    condition:
        all of them
}

rule CrowdStrike_CSIT_16143_02 : rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Payload encoded using VB character strings"
        reports = "CSIT-16143"
        version = "201611250000"
        last_modified = "2016-11-25"
    strings:
        $mz = "&H4D&H5A&H90&H00" wide ascii nocase
        $text = "&H2E&H74&H65&H78&H74" wide ascii nocase
        $rdata = "&H2E&H72&H64&H61&H74" wide ascii nocase
        $data = "&H2E&H64&H61&H74&H61" wide ascii nocase
    condition:
        all of them
}

rule CrowdStrike_CSIT_17006_02 : uh98ddosbot bot 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = ".NET dropper used for Uh98 DDoS-Bot malware"
        reports = "CSIT-17006"
        version = "201611280000"
        last_modified = "2016-11-28"
        malware_family = "Uh98DDoSBot"
    strings:
        $ = "VirtualBox.exe" wide
        $ = "Oracle Corporation" wide
        $ = "r110634" wide
        $ = "Thawte Certification"
        $ = "#GUID"
        $ = "#Strings"
        $ = "get_Width"
        $ = "get_Height"
        $ = "GetPixel"
    condition:
        all of them
}

rule CrowdStrike_CSIT_17006_03 : uh98ddosbot bot 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Uh98 DDoS-Bot malware"
        reports = "CSIT-17006"
        version = "201611280000"
        last_modified = "2016-11-28"
        malware_family = "Uh98DDoSBot"
    strings:
        $ = "Uh98H989" wide
    condition:
        any of them
}

rule CrowdStrike_CSIT_16143_01 : carbon_spider delivery_document macro 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Macro Dropper Document used by CARBON SPIDER and Buhtrap"
        reports = "CSIT-16143"
        version = "201611300000"
        last_modified = "2016-11-30"
        actor = "CARBON SPIDER"
    strings:
        $a = "After OnTime:" wide ascii nocase
        $b = "FUCK AV" wide ascii nocase
        $c = "Module=NewMacros" wide ascii nocase
    condition:
        all of them
}

rule CrowdStrike_CSIT_17006_01 : uh98ddosbot bot 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Downloader used for Uh98 DDoS-Bot malware"
        reports = "CSIT-17006"
        version = "201611300000"
        last_modified = "2016-11-30"
        malware_family = "Uh98DDoSBot"
    strings:
        $user_message = "SSA Sucessfully Install. Please click Add Device button on website"
        $javascript_code_1 = "GetObject"
        $javascript_code_2 = "ActiveXObject"
    condition:
        filesize < 10KB and all of them
}

rule CrowdStrike_CSA_181171_01 : dropper shamoon shamoon2 volatile_kitten 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Shamoon2 dropper"
        reports = "CSA-181171"
        version = "202106171615"
        last_modified = "2021-06-17"
        actor = "VOLATILE KITTEN"
        malware_family = "Shamoon"
    strings:
        $ = { 66 8b 55 ee 66 8b 5d da 66 3b d3 77 2c 75 2e }
        $ = { 23 23 23 41 56 31 23 23 23 00 00 00 01 00 00 00 23 23 23 41 56 32 23 23 23 00 00 00 01 00 00 00 }
    condition:
        any of them
}

rule CrowdStrike_CSIT_16139_02 : shamoon shamoon2 wiper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Shamoon2 reporter"
        reports = "CSIT-16139"
        version = "201612010000"
        last_modified = "2016-12-01"
        actor = "VOLATILE KITTEN"
        malware_family = "Shamoon"
    strings:
        $obfuscated_shinu = { 8a 00 7f 00 80 00 85 00 8c 00 }
        $obfuscated_c2 = { 00 00 00 00 00 00 00 00 48 00 45 00 48 00 45 00 48 00 45 00 48 00 51 00 4f 00 47 00 4f 00 47 00 }
        $obfuscated_localhost = { 00 00 00 00 00 00 00 00 83 00 86 00 7a 00 78 00 83 00 7F 00 86 00 8a 00 8b 00 17 00 00 00 00 00 }
        // /category/page.php
        $obfuscated_c2_path = { 46 00 7a 00 78 00 8b 00 7c 00 7e 00 86 00 89 00 90 00 46 00 87 00 78 00 7e 00 7c 00 45 00 87 00 7f 00 87 00 17 00 00 00 00 00 00 00 00 00 00 00 }
        // Mozilla/5.0 (MSIE 7.1; Windows NT 6.0)
        $obfuscated_user_agent = { 46 00 7a 00 78 00 8b 00 7c 00 7e 00 86 00 89 00 90 00 46 00 87 00 78 00 7e 00 7c 00 45 00 87 00 7f 00 87 00 }
        $ = "mkdir %s%s > nul 2>&1"
    condition:
        all of them
}

rule CrowdStrike_CSIT_16139_03 : shamoon shamoon2 wiper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Shamoon2 wiper"
        reports = "CSIT-16139"
        version = "201612010000"
        last_modified = "2016-12-01"
        actor = "VOLATILE KITTEN"
        malware_family = "Shamoon"
    strings:
        $c_lib_copyright = "Copyright (c) 1992-2004 by P.J. Plauger, licensed by Dinkumware, Ltd. ALL RIGHTS RESERVED."
        $eldos_device_name = "\\\\?\\ElRawDisk" wide
        $necessary_api_call_1 = "LeaveCriticalSection"
        $necessary_api_call_2 = "GetSystemTime"
        $necessary_api_call_3 = "SetSystemTime"
        $eldos_key = "#{8A6DB7D2-FECF-41ff-9A92-6EDA696613DE}#" wide
    condition:
        all of them
}

rule CrowdStrike_CSIT_16139_04 : shamoon2 benign 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Benign ElDos DLL used in Shamoon2"
        reports = "CSIT-16139"
        version = "201612010000"
        last_modified = "2016-12-01"
    strings:
        $ = "c:\\projects\\rawdisk\\bin\\w2k\\fre\\i386\\elrawdsk.pdb"
        $ = "c:\\projects\\rawdisk\\bin\\wnet\\fre\\amd64\\elrawdsk.pdb"
    condition:
        any of them
}

rule CrowdStrike_CSIT_16142_01 : wiper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Matches on key used to resolve API functions in a wiper documented in CSIT-16142"
        reports = "CSIT-16142"
        version = "201612060000"
        last_modified = "2016-12-06"
    strings:
        $ = { 41 61 43 63 64 44 65 46 66 47 68 69 4b 4c 6c 4d
        6d 6e 4e 6f 4f 70 50 72 52 73 53 54 74 55 75 56
        76 77 57 78 79 5a 7a 33 32 2e 5c 45 62 67 6a 48
        49 20 5f 59 51 42 3a 22 2f 40 }
    condition:
        all of them
}

rule CrowdStrike_CSIT_15079_01 : cozy_bear minidionis installer 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Self extracting installer used to deploy MiniDionis"
        reports = "CSIT-15079,CSIR-16019"
        version = "201612080000"
        last_modified = "2016-12-08"
        actor = "COZY BEAR"
        malware_family = "MiniDionis"
    strings:
        $rarsfx = "d:\\Projects\\WinRAR\\SFX\\build\\sfxrar32\\Release\\sfxrar.pdb"
        $decoy = ".pdf"
        $a = "reader.exe" nocase
        $b = "acrotray.exe" nocase
        $c = "readerview.exe" nocase
    condition:
        ($rarsfx and $decoy) and any of($a,$b,$c)
}

rule CrowdStrike_CSIT_15079_03 : minidionis dropper cozy_bear 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Stage 2 MiniDionis dropper"
        reports = "CSIT-15079,CSIR-16019"
        version = "201807231622"
        last_modified = "2018-07-23"
        actor = "COZY BEAR"
        malware_family = "MiniDionis"
    strings:
        $1 = { 3d af ba 42 }
        $2 = { 9d 9e b4 30 }
        $3 = { b4 22 da 80 }
        $4 = { 2c 9f ac 41 }
        $regkey = "SOFTWARE\\Microsoft\\NET Framework Setup\\NDP" wide
        $aesinvexp = { 00 00 00 00 0e 09 0d 0b 1c 12 1a 16 12 1b 17 1d }
        $aesin = { 52 09 6a d5 30 36 a5 38 bf 40 a3 9e 81 f3 d7 fb }
    condition:
        all of ($regkey,$aesinvexp,$aesin) and 3 of ($1,$2,$3,$4)
}

rule CrowdStrike_CSIT_15079_05 : cozy_bear minidionis loader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "MiniDionis stage 1 loader for stage 2"
        reports = "CSIT-15079,CSIR-16019"
        version = "201612080000"
        last_modified = "2016-12-08"
        actor = "COZY BEAR"
        malware_family = "MiniDionis"
    strings:
        $pdb = "C:\\DropperSolution\\Droppers\\Projects\\Drop_v2\\Release\\Drop_v2.pdb"
    condition:
        all of them
}

rule CrowdStrike_CSIT_15079_02 : cozy_bear minidionis dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Stage 1 dropper, drops MiniDionis loader"
        reports = "CSIT-15079,CSIR-16019"
        version = "201807271805"
        last_modified = "2018-07-27"
        actor = "COZY BEAR"
        malware_family = "MiniDionis"
    strings:
        $format = "%ws_out%ws" wide
        $func = "ProcDataWrap"
        $aesinvexp = { 00 00 00 00 0e 09 0d 0b 1c 12 1a 16 12 1b 17 1d }
        $aesin = { 52 09 6a d5 30 36 a5 38 bf 40 a3 9e 81 f3 d7 fb }
    condition:
        all of them
}

rule CrowdStrike_CSIT_15079_04 : cozy_bear minidionis downloader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Minidionis downloader"
        reports = "CSIT-15079,CSIR-16019"
        version = "201807271809"
        last_modified = "2018-07-27"
        actor = "COZY BEAR"
        malware_family = "MiniDionis"
    strings:
        $ = "//entity" wide
        $ = "name" wide
        $ = "action" wide
        $ = "crc" wide
        $ = "file" wide
        $ = "type" wide
        $ = "entry" wide
        $xml1 = { 05 6a d9 88 92 f1 d4 11 a6 5f 00 40 96 32 51 e5 }
        $xml2 = { 81 bf 33 29 36 7b d2 11 b2 0e 00 c0 4f 98 3e 60 }
        $path = "\\AppData\\Roaming\\Microsoft\\Windows\\Start Menu\\Programs\\Startup" wide
    condition:
        all of them
}

rule CrowdStrike_CSIT_15079_06 : cozy_bear minidionis rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "MiniDionis RAT"
        reports = "CSIT-15079,CSIR-16019"
        version = "201807271809"
        last_modified = "2018-07-27"
        actor = "COZY BEAR"
        malware_family = "MiniDionis"
    strings:
        $kid = "key_id" wide
        $bid = "bot_id" wide
        $sc = "host_scripts" wide
        $aes = "aes_iv" wide
        $file = "File {0} has been downloaded to {1}" wide
        $proc = "Process (pid:{1}) {0} has been started" wide
    condition:
        all of them
}

rule CrowdStrike_CSIT_17000_01 : voodoo_bear gcat unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detection for GCat malware variant after it is unpacked. Will be most useful for in-memory detection."
        reports = "CSIT-17000"
        version = "201612140000"
        last_modified = "2016-12-14"
        actor = "VOODOO BEAR"
        malware_family = "GCat"
    strings:
        $ = "SystemRoot' , '\\\\Windows' ) , 'temp'"
        $ = "{ 'CMD' : 'download' , 'RES' : 'Success' }"
        $ = "UNSEEN SUBJECT 'gcat:{}')"
    condition:
        all of them
}

rule CrowdStrike_CSIT_17000_02 : voodoo_bear gcat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Possible Voodoo Bear GCat malware variant. This rule looks for strings found in a packed compiled Python executable. In order to determine if it's a true positive, additional analysis on the unpacked code is required."
        reports = "CSIT-17000"
        version = "201612140000"
        last_modified = "2016-12-14"
        actor = "VOODOO BEAR"
        malware_family = "GCat"
    strings:
        $manifest = "opyi-windows-manifest-filename enc.exe.manifest"
        $senc = "senc\x00"
        $spyi = "spyiboot01_bootstrap"
    condition:
        all of them
}

rule CrowdStrike_CSIT_17001_01 : con_rat rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Strings in Con-RAT main payload"
        reports = "CSIT-17001"
        version = "202101261916"
        last_modified = "2021-01-26"
        malware_family = "Con-RAT"
    strings:
        $ = "[+] Starting......"
        $ = "-debug"
        $ = "'http://%s:%d"
        $ = "[-] Failed Decrypt()!"
        $ = "[+] RecvData:%s"
        $ = "[-] Main() Exit!"
        $ = "Vesion "
        $ = "~jh1AE.tmp"
    condition:
        4 of them
}

rule CrowdStrike_NUMBEREDPANDA_Ixeshe_01 : dropper ixeshe numbered_panda 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects a dropper used by NUMBERED PANDA to deploy Ixeshe and other malware."
        version = "202012011452"
        last_modified = "2020-12-01"
        actor = "NUMBERED PANDA"
        malware = "Ixeshe"
    strings:
        $olly_mov = { c7 84 ?? ?? ?? ?? 00 6f 6c 6c 79 }
        $gdb_mov = { c7 84 ?? ?? ?? ?? 00 64 62 67 00 }
        $ice_mov = { c7 84 ?? ?? ?? ?? 00 69 63 65 00 }
        $idaq_mov = { c7 84 ?? ?? ?? ?? 00 69 64 61 71 }
        $bina_mov = { c7 44 ?? ?? 42 49 4e 41 }
        $ry_mov = { 66 c7 44 ?? ?? 52 59 }
    condition:
        all of them
}

rule CrowdStrike_NUMBEREDPANDA_Ixeshe_02 : ixeshe numbered_panda rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Series of opcodes to move strings on to the stack. Related to malware described in CSIT-14128 but recently rediscovered."
        version = "202012011452"
        last_modified = "2020-12-01"
        actor = "NUMBERED PANDA"
        malware = "Ixeshe"
    strings:
        $percent_ses = { c6 85 ?? ?? ff ff 25 c6 85 ?? ?? ff ff 73 c6 85 ?? ?? ff ff 2c c6 85 ?? ?? ff ff 25 c6 85 ?? ?? ff ff 73 c6 85 ?? ?? ff ff 2c c6 85 ?? ?? ff ff 25 c6 85 ?? ?? ff ff 73 c6 85 ?? ?? ff ff 2c c6 85 ?? ?? ff ff 25 c6 85 ?? ?? ff ff 73 c6 85 ?? ?? ff ff 2c c6 85 ?? ?? ff ff 25 c6 85 ?? ?? ff ff 73 }
        $asp_movs2 = { c6 85 ?? ?? ff ff 25 c6 85 ?? ?? ff ff 64 c6 85 ?? ?? ff ff 2e c6 85 ?? ?? ff ff 61 c6 85 ?? ?? ff ff 73 c6 85 ?? ?? ff ff 70 c6 85 ?? ?? ff ff 3f c6 85 ?? ?? ff ff 25 c6 85 ?? ?? ff ff 73 }
        $asp_movs1 = { c6 44 24 ?? 25 c6 44 24 ?? 64 c6 44 24 ?? 2e c6 44 24 ?? 61 c6 44 24 ?? 73 c6 44 24 ?? 70 c6 44 24 ?? 3f c6 44 24 ?? 25 c6 44 24 ?? 73 }
        $ua_movs = { c6 44 24 ?? 4d c6 44 24 ?? 6f c6 44 24 ?? 7a c6 44 24 ?? 69 c6 44 24 ?? 61 c6 44 24 ?? 2f c6 44 24 ?? 3? c6 44 24 ?? 2e c6 44 24 ?? 20 c6 44 24 ?? 28 c6 44 24 ?? 63 c6 44 24 ?? 6f c6 44 24 ?? 6d c6 44 24 ?? 70 c6 44 24 ?? 61 }
        $htm_mov = { c6 44 24 ?? 25 c6 44 24 ?? 64 c6 44 24 ?? 2e c6 44 24 ?? 68 c6 44 24 ?? 74 c6 44 24 ?? 6d c6 44 24 ?? 6c c6 44 24 ?? 23 c6 44 24 ?? 25 c6 44 24 ?? 73 }
        $htm_mov2 = { c6 85 ?? ?? ff ff 25 c6 85 ?? ?? ff ff 64 c6 85 ?? ?? ff ff 2e c6 85 ?? ?? ff ff 68 c6 85 ?? ?? ff ff 74 c6 85 ?? ?? ff ff 6d c6 85 ?? ?? ff ff 6c c6 85 ?? ?? ff ff 23 c6 85 ?? ?? ff ff 25 c6 85 ?? ?? ff ff 73 }
    condition:
        any of them
}

rule CrowdStrike_CSIT_17029_03 : firstblood loader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "FirstBlood loader"
        reports = "CSIT-17029"
        version = "201701050000"
        last_modified = "2017-01-05"
        malware_family = "FirstBlood"
    strings:
        $ = "esd +2"
        $ = "ere +2"
        $ = "bsd -1"
        $ = "bre -1"
        $ = "esd -1"
        $ = "ere -1"
    condition:
        4 of them
}

rule CrowdStrike_CSIT_19167_01 : banking downloader dridex dridex_loader ecrime unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects unpacked Dridex Loader executables"
        reports = "CSIT-19167"
        version = "202010221132"
        last_modified = "2020-10-22"
        malware_family = "Dridex"
    strings:
        $deadbeef = { b9 4d 5a 00 00 ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? 00 00 ef be ad de }
        $deadbeef2 = { bb 4d 5a 00 00 ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? 00 00 ef be ad de }
        $get_cfg = { 66 8b 04 f5 [4] 0f b7 c8 8b 04 f5 [4] ?? }
        $get_core_mod = { 6a 01 6a 01 b? 01 1f 04 11 }
        $get_module = { 81 7c 24 ?? c8 00 00 00 74 ?? 81 7c 24 ?? 94 01 00 00 75 }
        $create_request = { 6a 04 8d 44 24 ?? 50 e8 [4] 6a 04 8d 44 24 ?? }
    condition:
        2 of them
}

rule CrowdStrike_CSIR_14008_25 : fancy_bear javascript sedkit 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "FANCY BEAR SWC JavaScript Code known as Sedkit"
        reports = "CSIR-14008"
        version = "201901301244"
        last_modified = "2019-01-30"
        actor = "FANCY BEAR"
        malware_family = "Sedkit"
    strings:
        $var1 = "var ate1"
        $var2 = "var atz1"
        $var3 = "var co1"
        $var4 = "var pco1"
        $var5 = "var jtc1"
        $var6 = "var vPP1"
        $ua = "if(navigator.userAgent.indexOf(\"MSIE\") > -1"
        $detect1 = "string_of_json += DetectPdfForMSIE();"
        $detect2 = "string_of_json += DetectFlashForMSIE();"
        $detect3 = "string_of_json += DetectJavaForMSIE();"
        $detect4 = "string_of_json += EnumeratePlugins();"
        $detect5 = "function DetectJavaForMSIE()"
        // CVE-2013-3897 exploit code
        $addr1 = "0x77BD18D3"
        $addr2 = "0x77BCEF5B"
        $addr3 = "0x77BCF519"
        $addr4 = "0x77BD3E25"
        $addr5 = "0x77BE746A"
        $addr6 = "0x77BC1120"
        $ = "// offset was 0x94 now 0xA4"
        $ = "for (i = 1; i <= (0x42c-4) / 4; i++) {"
    condition:
        6 of them and
        (4 of ($detect*))
}

rule CrowdStrike_CSIT_17011_01 : mythic_leopard delivery_document macro 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Integer-encoded PE payload inside Office file, used by MYTHIC LEOPARD and possibly other actors"
        reports = "CSIT-17011"
        version = "201701120000"
        last_modified = "2017-01-12"
        actor = "MYTHIC LEOPARD"
    strings:
        $header = { d0 cf 11 e0 }
        $nums = "77,90,144,0,3,0,0,0,4,0,0,0,255,255"
    condition:
        filesize < 5MB and $header at 0 and $nums
}

rule CrowdStrike_CSIT_17011_02 : mythic_leopard rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = ".NET GUIDs seen in MYTHIC LEOPARD RAT samples"
        reports = "CSIT-17011"
        version = "201807301048"
        last_modified = "2018-07-30"
        actor = "MYTHIC LEOPARD"
    strings:
        $typelib_1      = "374dcb0b-593d-488f-9ad3-4aebf53a7279" ascii wide
        $typelib_2      = "3f70180d-3e61-4930-92d9-54a7f6372c4f" ascii wide
        $typelib_3      = "a375e3c1-020f-494b-8105-f929bd72991b" ascii wide
        $typelib_4      = "d0f5ee2b-49b0-4e42-be2c-4a71c50e9836" ascii wide
        $typelib_5      = "e10aa797-4cd8-4c53-bd13-c5c23c7a97e4" ascii wide
        $typelib_6      = "f33b6b98-5c67-4a5e-adc4-b3d2aa27d60f" ascii wide
        $typelib_7      = "087351b4-c383-4a9b-80a6-f7a2e87de9ba" ascii wide
        $typelib_8      = "18140762-bb8b-4703-a89f-88d27c1b5d8a" ascii wide
        $typelib_9      = "ed064f09-b811-4a5b-826d-6a5a2db9e345" ascii wide
        $mvid_1         = "1410a39a-9c6e-4f5c-8e7e-b1adcc1d9a07" ascii wide
        $mvid_2         = "20b0322d-2c6b-433c-8eb3-82e67c24b35b" ascii wide
        $mvid_3         = "478b2318-202d-4850-bdf6-6336285b8343" ascii wide
        $mvid_4         = "896bfc03-a288-4664-9517-782d1a08f152" ascii wide
        $mvid_5         = "b75920b2-8da6-449a-9992-a2dba855a4c1" ascii wide
        $mvid_6         = "bca83080-76a4-48be-88af-a68bd2a90074" ascii wide
        $mvid_7         = "f4681f42-4d4b-47a7-b00e-d1530f9222bd" ascii wide
        $mvid_8         = "7136516d-3636-4869-ae8b-58114f116c19" ascii wide
        $mvid_9         = "995580c7-cde1-4733-926b-0033ef6d7b32" ascii wide
        $mvid_10        = "60b9ee45-919c-4144-a55d-15b7329b86bd" ascii wide
    condition:
        any of them
}

rule CrowdStrike_CSIT_17011_03 : mythic_leopard rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "PDB path formats associated with MYTHIC LEOPARD tools"
        reports = "CSIT-17011"
        version = "201807301050"
        last_modified = "2018-07-30"
        actor = "MYTHIC LEOPARD"
    strings:
        $x86 = "\\obj\\x86\\"
        $s_pre = "E:\\pre\\"
        $s_poe = "E:\\poe\\"
        $s_isql = "ISqlManager"
        $s_muneeb = "C:\\Users\\muneeb\\"
        $s_proj = "D:\\ProjectsReadytoGo\\"
        $s_pp = "E:\\pp\\"
        $s_waiz         = "\\waizsar\\"
    condition:
        $x86 and (any of ($s_*))
}

rule CrowdStrike_CSIT_17020_03 : carbon_spider vbflash loader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "CARBON SPIDER VBFlash loader component"
        reports = "CSIT-17020"
        version = "201701170000"
        last_modified = "2017-01-17"
        actor = "CARBON SPIDER"
        malware_family = "VBFlash"
    strings:
        $re_cmd = { 22 5c 24 5c 24 5c 24 28 2e 2b 29 5c 24 5c 24 5c 24 28 2e 2b 29 5c 24 5c 24 5c 24 22 }
        $re_c2 = { 22 2c 5c 5c 78 32 32 75 73 65 72 48 74 6d 6c 5c 5c 78 32 32 3a 5c 5c 78 32 32 28 2e 2b 29 5c 24 5c 24 5c 24 28 2e 2b 29 5c 24 5c 24 5c 24 28 2e 2b 29 5c 5c 78 32 32 2c 5c 5c 78 32 32 6e 63 63 22 }
        $url_1 = "docs.google.com/forms/d/"
        $url_2 = "script.google.com/macros/s/"
        $cmd_1 = "#deleteBot#"
        $cmd_2 = "#GetCompInfo#"
        $cmd_3 = "#GetProcList#"
        $cmd_4 = "#RunCMDLine#"
    condition:
        (1 of ($re_*) and 1 of ($url_*)) or (3 of ($cmd_*))
}

rule CrowdStrike_CSIT_17013_01 : cryptfile2 ransomware 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "C2 strings found in CryptFile2 ransomware"
        reports = "CSIT-17013"
        version = "201701180000"
        last_modified = "2017-01-18"
        malware_family = "CryptFile2"
    strings:
        $status = "&status="
        $doneworkend = "DoneWorkEnd"
        $hexformat = "0x%02x"
        $osvalid = "os_valid:TRUE"
    condition:
        all of them
}

rule CrowdStrike_CSIT_17020_01 : carbon_spider delivery_document 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "CARBON SPIDER RTF/VBE delivery document"
        reports = "CSIT-17020"
        version = "201701180000"
        last_modified = "2017-01-18"
        actor = "CARBON SPIDER"
    strings:
        $ = "756e70726f7465637465642e76626500"
        $ = "\\*\\objdata"
    condition:
        all of them
}

rule CrowdStrike_CSIT_17020_02 : carbon_spider delivery_document 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "CARBON SPIDER Word/VBE delivery document"
        reports = "CSIT-17020"
        version = "201701180000"
        last_modified = "2017-01-18"
        actor = "CARBON SPIDER"
    strings:
        $vbe_1 = { 00 00 00 75 00 6e 00 70 00 72 00 6f 00 74 00 65 00 63 00 74 00 65 00 64 00 2e 00 76 00 62 00 65 00 2f 00 00 00 }
        $vbe_2 = "C:\\Users\\TESTAD~1.TES\\AppData\\Local\\Temp\\unprotected.vbe" wide
        $vbe_3 = "C:\\Users\\testadmin.TEST\\Desktop\\unprotected.vbe" wide
        $sc_enc = "Scripts Encryptor - Encoder"
    condition:
        (any of ($vbe*)) and $sc_enc
}

rule CrowdStrike_CSIT_17020_04 : carbon_spider vbflash rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "CARBON SPIDER VBFlash version 2"
        reports = "CSIT-17020"
        version = "201701180000"
        last_modified = "2017-01-18"
        actor = "CARBON SPIDER"
        malware_family = "VBFlash"
    strings:
        $ini_r = "Function ReadIni( myFilePath, mySection, myKey )"
        $ini_w = "Sub WriteIni( myFilePath, mySection, myKey, myValue )"
        $section_1 = "RunSection"
        $section_2 = "FileNameSection"
        $section_3 = "ArgsSection"
        $section_4 = "EXESection"
        $key_1 = "ruunn_cmd_type"
        $key_2 = "fileNameStr"
        $key_3 = "ArgsStr"
        $key_4 = "exeFileName"
    condition:
        (1 of ($ini*)) and (2 of ($section*)) and (2 of ($key*))
}

rule CrowdStrike_CSIT_17014_01 : urlzone trojan unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Strings and code fragment found in decoded URLZone malware from unpacked code in memory"
        reports = "CSIT-17014"
        version = "201808271822"
        last_modified = "2018-08-27"
        malware_family = "URLZone"
    strings:
        $marker1 = "R$01-"
        $marker2 = "$$RsC@"
        $rsa = "RSA1"
        $find_lib = { 64 8b 05 30 00 00 00 8b 40 0c 8b 40 1c }
    condition:
        all of them
}

rule CrowdStrike_CSIT_17020_05 : carbon_spider powershell 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "CARBON SPIDER Powershell Script for Staging Cobalt Strike"
        reports = "CSIT-17020"
        version = "201807301020"
        last_modified = "2018-07-30"
        actor = "CARBON SPIDER"
    strings:
        $ = "JABzAD0ATgBlAHcALQBPAGIAagBlAGMAdAAgAEkATwAuAE0AZQBtAG8AcgB5AFMAdAByAGUAYQBtACgALABbAEMAbwBuAHYAZQByAHQAXQA6ADoARgByAG8AbQBCAGEAcwBlADYANABTAHQAcgBpAG4AZw"
        $ = "powershell.exe -nop -w hidden -encodedcommand"
    condition:
        all of them
}

rule CrowdStrike_CSIT_17013_02 : cryptfile2 ransomware dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "CrowdStrike_CSIT_17013_02"
        reports = "CSIT-17013"
        version = "201701250000"
        last_modified = "2017-01-25"
        malware_family = "CryptFile2"
        desciption = "CryptFile2 ransomware dropper"
    strings:
        $stack_str_rtl = { c6 44 ?? ?? 52 c6 44 ?? ?? 74 c6 44 ?? ?? 6c [8] c6 44 ?? ?? 76 [4] c6 44 ?? ?? 6d [4] c6 44 ?? ?? 72 c6 44 ?? ?? 79 c6 44 ?? ?? 00 }
        $cmp_Z = { 80 7e 01 5a 0f }
    condition:
        all of them
}

rule CrowdStrike_CSIT_17029_02 : firstblood dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "FirstBlood loader key in dropper"
        reports = "CSIT-17029"
        version = "201702070000"
        last_modified = "2017-02-07"
        malware_family = "FirstBlood"
    strings:
        $ = "sdflpopdfjkaweriopasdfnkl"
    condition:
        all of them
}

rule CrowdStrike_CSIT_17039_02 : fancy_bear zekapab rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "FANCY BEAR Zekapab implant"
        reports = "CSIT-17039"
        version = "201807301801"
        last_modified = "2018-07-30"
        actor = "FANCY BEAR"
        malware_family = "Zekapab"
    strings:
        $ = "$$MSUpdate\\"
        $ = { 16 00 00 00 35 30 37 32 36 37 32 30 37 33 37 34 36 31 37 32 37 34 33 41 32 30 00 }
        $ = { 16 00 00 00 34 42 34 32 37 32 36 34 32 30 34 43 36 31 36 45 36 37 33 41 32 30 00 }
        $key = { 45 fc 55 ec 89 fc e8 fa 8b fa ff 33 c0 55 68 f7 c3 e9 6e 44 fa ff eb f8 55 e0 89 45 e9 4d f1 f1 }
    condition:
        any of them
}

rule CrowdStrike_CSIT_17032_01 : charming_kitten powershell macro 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detection for macro contained in CHARMING KITTEN delivery documents delivering Pupy"
        reports = "CSIT-17032"
        version = "201702150000"
        last_modified = "2017-02-15"
        actor = "CHARMING KITTEN"
        malware_family = "Pupy"
    strings:
        $ = "-window hidden -e cABvAHcAZQByAHMAaA"
        $ = "e = \"She@et1\""
        $ = "Auto_Open"
    condition:
        all of them
}

rule CrowdStrike_CSIT_17032_02 : pupy rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detection for the Pupy malware"
        reports = "CSIT-17032"
        version = "201702150000"
        last_modified = "2017-02-15"
        malware_family = "Pupy"
    strings:
        $ = "Builtins utilities for pupy"
        $ = "add_pseudo_pupy_module"
        $ = "get_pupy_config"
        $ = "<memimport>"
    condition:
        all of them
}

rule CrowdStrike_CSIT_17039_03 : autodown downloader fancy_bear 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "FANCY BEAR AutoDown AutoIt-based downloader"
        reports = "CSIT-17039,CSIT-19067"
        version = "201904290828"
        last_modified = "2019-04-29"
        actor = "FANCY BEAR"
        malware_family = "AutoDown"
    strings:
        $ = "application/x-www-form-urlencoded"
        $ = "---------------------------7dd177a260412"  ascii wide
        $ = "$sexname = "
        $ = "MsgBox(64, \"Ok!\", \"Update is already runnig!\")"
        $ = "MsgBox(64, \"Ok!\", \"Install update successful!\")"
        $ = "InputBox(\"Please enter password\", \"Please any key for open file!\""
        $ = "FileExists(@TempDir & \"\\srvssml.exe\")"
    condition:
        2 of them
}

rule CrowdStrike_CSIT_17029_01 : akbuilder delivery_document exploit cve_2015_1641 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "AKBuilder shellcode pattern, often used with CVE-2015-1641"
        reports = "CSIT-17029"
        version = "201807300944"
        last_modified = "2018-07-30"
        malware_family = "AKBuilder"
    strings:
        $hdr = "{\\rt"
        $marker1 = { ba ba ba ba }
        $marker2 = { bb bb bb bb }
        $marker3 = { bc bc bc bc }
        $enc1 = { ba ba fa ca }
        $enc2 = { f2 0f 52 45 f2 0f 52 45 }
    condition:
        ($marker1 and $marker2)
        and $hdr at 0
        and $marker2 in (@marker1[1]+0x3000..@marker1[1]+0x100000)
        and ($marker3 in (@marker2[1]+0x3000..@marker2[1]+0x500000) or ($enc1 and $enc2))
}

rule CrowdStrike_CSIT_17028_01 : charming_kitten sloodropper dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "CHARMING KITTEN SlooDropper generic detection"
        reports = "CSIT-17028"
        version = "201702210000"
        last_modified = "2017-02-21"
        actor = "CHARMING KITTEN"
        malware_family = "SlooDropper, SlooPower"
    strings:
        $str_exe_spp = "/im spp.exe"
        $str_exe_sloo = "\\sloo.exe" fullword
        $str_exe_spoo = "\\spoo.exe" fullword
        $str_exe_vsc = "\\vschos.exe" fullword
        $str_exe_offline = "\\offlinefile.exe" fullword
        $str_ps_preamble_1 = "/c powershell -window hidden -EncodedCommand JA"
        $str_ps_preamble_2 = "/c powershell -window hidden -enc JA"
        $str_block = "Data not multiple of Block Size"
    condition:
        2 of them
}

rule CrowdStrike_CSIT_17028_03 : charming_kitten tasking 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "CHARMING KITTEN registry utility"
        reports = "CSIT-17028"
        version = "201702210000"
        last_modified = "2017-02-21"
        actor = "CHARMING KITTEN"
    strings:
        $code_va_00401004 = { 8b 1d ?? ?? ?? ?? 55 8b 2d ?? ?? ?? ?? 56 8b 35 ?? ?? ?? ?? 57 c7 44 24 14 02 00 00 00 8b 56 04 8d 44 24 1c 8d 4c 24 10 50 51 6a 00 6a 00 6a 00 6a 00 6a 00 52 68 01 00 00 80 ff 15 }
    condition:
        any of them
}

rule CrowdStrike_CSIT_17031_01 : smokebot smokeloader unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Smoke Bot unpacked in-memory"
        reports = "CSIT-17031"
        version = "201907231328"
        last_modified = "2019-07-23"
        malware_family = "Smoke Loader, Smoke Bot"
    strings:
        $rc4 = { 55 8b ec 81 c4 f8 fe ff ff 53 56 57 33 c9 8d 85 f8 fe ff ff 88 08 41 40 }
        $random = { 0f 31 0b 05 ?? ?? ?? ?? c1 d0 02 05 78 56 34 12 19 d0 }
        $randmagic = { 69 15 ?? ?? ?? ?? 05 84 08 08 }
    condition:
        all of them
}

rule CrowdStrike_CSIT_17028_04 : charming_kitten sloopower loader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "CHARMING KITTEN SlooPower loader"
        reports = "CSIT-17028"
        version = "201807300957"
        last_modified = "2018-07-30"
        actor = "CHARMING KITTEN"
        malware_family = "SlooPower"
    strings:
        $pshell_start1 = "/c powershell -window hidden -EncodedCommand JA"
        $pshell_start2 = "/c powershell -window hidden -enc JA"
    condition:
        any of them
}

rule CrowdStrike_CSIT_17028_02 : charming_kitten sloodropper dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "CHARMING KITTEN SlooDropper"
        reports = "CSIT-17028"
        version = "201807300931"
        last_modified = "2018-07-30"
        actor = "CHARMING KITTEN"
        malware_family = "SlooDropper"
    strings:
        $str_block = "Data not multiple of Block Size"
        $str_taskkil = "/c taskkill /im"
        $code_va_00405FF4 = { 8b 4c 24 18 8a c5 8a d1 c0 e8 04 24 03 8a cd c0 e2 02 02 c2 80 e1 0f 88 44 24 14 8a 44 24 1a 8a d0 24 03 c0 ea 02 80 e2 0f c0 e1 04 02 d1 8a 4c 24 1b c0 e0 06 02 c1 88 54 24 15 88 44 24 16 33 ff }
    condition:
        $code_va_00405FF4 and any of ($str_*)
}

rule CrowdStrike_CSIT_17029_04 : firstblood loader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "FirstBlood loader key from byte strings"
        reports = "CSIT-17029"
        version = "201702220000"
        last_modified = "2017-02-22"
        malware_family = "FirstBlood"
    strings:
        $code = { c6 45 e4 12 c6 45 e5 44 c6 45 e6 56 c6 45 e7 38
        c6 45 e8 55 c6 45 e9 82 c6 45 ea 56 c6 45 eb 85
        c6 45 ec 23 c6 45 ed 25 c6 45 ee 56 c6 45 ef 45
        c6 45 f0 52 c6 45 f1 47 c6 45 f2 45 c6 45 f3 86 }
    condition:
        all of them
}

rule CrowdStrike_CSIT_17037_04 : stardust_chollima ratankba downloader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Ratankba downloader"
        reports = "CSIT-17037"
        version = "201807301021"
        last_modified = "2018-07-30"
        actor = "STARDUST CHOLLIMA"
        malware_family = "Ratankba"
    strings:
        $ = "%s?action=CmdRes&u=%I64u&err=kill" wide
        $ = "killkill" wide
        $ = "%s?action=What&u=%I64u" wide
        $ = "cmd.exe /c \"netstat -ano | find \"TCP" wide
        $ = "if exist %1 goto del1" wide
    condition:
        3 of them
}

rule CrowdStrike_CSIT_17036_01 : charming_kitten playplug rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "PlayPlug C2 domains"
        reports = "CSIT-17036"
        version = "201703010000"
        last_modified = "2017-03-01"
        actor = "CHARMING KITTEN"
        malware_family = "PlayPlug"
    strings:
        $dom_chrome = "chrome-up.date" ascii wide
        $domain1 = "microsoftexplorerservices.cloud" ascii wide
        $domain2 = "msservice.site" ascii wide
    condition:
        any of them
}

rule CrowdStrike_CSIT_17036_02 : charming_kitten playplug rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "PlayPlug .NET Namespace"
        reports = "CSIT-17036"
        version = "201703010000"
        last_modified = "2017-03-01"
        actor = "Charming Kitten"
        malware_family = "PlayPlug"
    strings:
        $namespace = { 61 6d 6d 61 72 ?? 73 61 6d 61 6e 65 68 }
    condition:
        all of them
}

rule CrowdStrike_CSIT_17036_03 : charming_kitten playplug rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "PlayPlug PDB Path"
        reports = "CSIT-17036"
        version = "201703010000"
        last_modified = "2017-03-01"
        actor = "Charming Kitten"
        malware_family = "PlayPlug"
    strings:
        $pdb_path_general = "C:\\Users\\Main\\Desktop\\ser\\VB\\VBWindowsService\\obj\\Release"
    condition:
        any of them
}

rule CrowdStrike_CSIT_17036_04 : charming_kitten playplug rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "PlayPlug SOAP Actions"
        reports = "CSIT-17036"
        version = "201703010000"
        last_modified = "2017-03-01"
        actor = "Charming Kitten"
        malware_family = "PlayPlug"
    strings:
        $setlog = "SetLog" ascii wide
        $gethasanything = "GetHasAnything" ascii wide
        $getidabone = "GetIdAbOne" ascii wide
        $getnamebyid = "GetNameAbById" ascii wide
        $getishide = "GetishideAbById" ascii wide
        $getisrunas = "GetisrunasAbById" ascii wide
    condition:
        3 of them
}

rule CrowdStrike_CSIT_17037_05 : stardust_chollima twopence dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Droppers using TwoPence framework"
        reports = "CSIT-17037"
        version = "201703010000"
        last_modified = "2017-03-01"
        actor = "STARDUST CHOLLIMA"
        malware_family = "TwoPence"
    strings:
        $ = { 49 43 4f 4e 00 }
        $ = "ContextHandler"
        $ = "SOFTWARE\\Classes\\NR%s"
        $ = { 8a ?? 01 01 00 00 8a ?? 00 01 00 00 }
    condition:
        all of them
}

rule CrowdStrike_CSIT_17037_01 : rigek exploit cve_2016_0034 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Silverlight DLL - CVE_2016_0034 from Rig EK"
        reports = "CSIT-17037"
        version = "201703020000"
        last_modified = "2017-03-02"
    strings:
        $encstr = { 73 78 7f 70 63 68 63 74 70 75 74 63 3f 54 69 61 7d 7e 78 65 }
        $pdb1  = "Shell_siver.pdb"
        $pdb2 = "Users\\KKK\\Desktop\\"
        $guid = "$d5794791-1550-41f2-a015-8d8ab014342b"
        $rsc = "Resources.Resource1" wide
        $xor = { 38 38 38 38 38 38 38 38 38 38 38 38 b8 38 38 38 }
    condition:
        3 of them
}

rule CrowdStrike_CSIT_17037_02 : stardust_chollima exploit 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "First stage compressed SWF exploit, used to install Ratankba malware"
        reports = "CSIT-17037"
        version = "201703020000"
        last_modified = "2017-03-02"
        actor = "STARDUST CHOLLIMA"
    strings:
        $hdr = "CWS"
        $orin = "orinBin"
        $str = "String_Com"
    condition:
        ($hdr at 0) and ($orin in (filesize-100..filesize)) and ($str in (filesize-100..filesize))
}

rule CrowdStrike_CSIT_17037_03 : stardust_chollima exploit 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Second stage SWF exploit based on Neutrino Exploit Kit, used to install Ratankba malware"
        reports = "CSIT-17037"
        version = "201703020000"
        last_modified = "2017-03-02"
        actor = "STARDUST CHOLLIMA"
    strings:
        $hdr = "FWS"
        $key1 = "hvxgiep857520"
        $key2 = "littleEndian"
        $rsc1 = "bin22"
        $rsc2 = "bin23"
        $rsc3 = "bin24"
        $var1 = "nw22"
        $var2 = "nw23"
        $var3 = "nw24"
    condition:
        ($hdr at 0) and (4 of them)
}

rule CrowdStrike_CSIT_17037_06 : stardust_chollima twopence loader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Loader instance using TwoPence framework"
        reports = "CSIT-17037"
        version = "201703020000"
        last_modified = "2017-03-02"
        actor = "STARDUST CHOLLIMA"
        malware_family = "TwoPence"
    strings:
        $key1 = { a6 eb 96 00 }
        $key2 = { 61 b2 e2 ef }
        $key3 = { 0d cb e8 c4 }
        $key4 = { 5a f1 66 9c }
        $key5 = { a4 80 cd 9a }
        $key6 = { f1 2f 46 25 }
        $key7 = { 2f db 16 26 }
        $key8 = { 4b c4 3f 3c }
        $ = "SeDebugPrivilege" wide
        $ = "CreateRemoteThread"
    condition:
        all of them
}

rule CrowdStrike_CSIT_17037_07 : stardust_chollima twopence rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "TwoPence RAT payload using Curl library"
        reports = "CSIT-17037"
        version = "201703020000"
        last_modified = "2017-03-02"
        actor = "STARDUST CHOLLIMA"
        malware_family = "TwoPence"
    strings:
        $cmd1 = "ssylka"
        $cmd2 = "ustanavlivat"
        $cmd3 = "poluchit"
        $cmd4 = "pereslat"
        $cmd5 = "derzhat"
        $cmd6 = "vykhodit"
        $cmd7 = "Nachalo"
        $cmd8 = "kliyent2podklyuchit"
        $frmt1 = "Host: %s%s%s:%hu"
        $frmt2 = "%s%s%s%s%s%s%s%s%s%s"
    condition:
        (4 of ($cmd*)) and (1 of ($frmt*))
}

rule CrowdStrike_CSIT_17037_08 : stardust_chollima twopence loader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "TwoPence DLL service loader"
        reports = "CSIT-17037"
        version = "201703020000"
        last_modified = "2017-03-02"
        actor = "STARDUST CHOLLIMA"
        malware_family = "TwoPence"
    strings:
        $str1 = "%s\\Help\\%s.chm"
        $str2 = "SeDebugPrivilege"
        $str3 = "lsass.exe"
        $str4 = "wide_loader.dll"
        $str5 = "ServiceMain"
        $crypt1 = { 00 81 00 01 00 00 0f b6 91 00 01 00 00 0f b6 04 0a }
        $crypt2 = { 48 ff c3 32 44 1e ff 48 ff cf 88 43 ff }
        $cryptkey = { 65 06 18 33 60 10 48 c7 57 9b 98 76 ca b5 29 60
        71 cb 0b 97 7e d4 a2 f9 22 cc 4e 79 52 64 4a 75 }
    condition:
        (3 of ($str*)) and (1 of ($crypt*))
}

rule CrowdStrike_CSIT_17043_03 : zodownloader downloader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Downloader component possibly related to Zonero"
        reports = "CSIT-17043"
        version = "201703070000"
        last_modified = "2017-03-07"
        malware_family = "ZoDownloader"
    strings:
        $magic_mei = { 4d 45 49 0c 0b 0a 0b 0e }
        $magic_veil_1 = "python27.dll"
        $magic_veil_2 = "out00-PYZ.pyz"
        $magic_veil_3 = "Crypto.Cipher._AES.pyd"
        $magic_veil_4 = "select.pyd"
        $magic_veil_5 = "bz2.pyd"
        $magic_veil_6 = "unicodedata.pyd"
        $magic_veil_7 = "_ctypes.pyd"
        $magic_veil_8 = "_hashlib.pyd"
        $known_names_1 = "bwininet.exe.manifest"
    condition:
        all of ($magic_*) and any of ($known_names_*)
}

rule CrowdStrike_CSIT_17043_01 : checkconfdownloader delivery_document macro 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Macro document dropping CheckConfDownloader"
        reports = "CSIT-17043"
        version = "201703080000"
        last_modified = "2017-03-08"
        malware_family = "CheckConfDownloader"
    strings:
        $doc_header = { d0 cf 11 e0 }
        $next_stage_mz = "77,90,144,0,3,0,0,0,4,0,0,0,255,255,0,0"
        $next_stage_checkconf = "92,67,104,101,99,107,67,111,110,102,92"
        $chars_for_random_name_1 = "1348906257"
        $chars_for_random_name_2 = "ghiabcdefjklqrstuvwmnopxyz"
    condition:
        all of them
}

rule CrowdStrike_CSIT_17043_02 : checkconfdownloader downloader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Instances of the CheckConfDownloader family"
        reports = "CSIT-17043"
        version = "201807271541"
        last_modified = "2018-07-27"
        malware_family = "CheckConfDownloader"
    strings:
        $dotnet_3 = "BSJB"
        $dotnet_4 = "v2.0.50727"
        $pdb_path = "\\CheckConf\\CheckConf\\obj\\x86\\"
    condition:
        all of them and filesize < 100KB
}

rule CrowdStrike_CSIT_17041_01 : torrentlocker unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Identifies TorrentLocker in an unpacked state"
        reports = "CSIT-17041"
        version = "201807271715"
        last_modified = "2018-07-27"
        malware_family = "TorrentLocker"
    strings:
        $upack = "UpackByDwing"
        $rack = "rack-core-container"
        $racketeer = "racketeer"
    condition:
        all of them
}

rule CrowdStrike_CSIT_17056_03 : labyrinth_chollima hawup rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Hawup RC4 crypt code"
        reports = "CSIT-15113,CSIT-17056"
        version = "201703120000"
        last_modified = "2017-03-12"
        actor = "LABYRINTH CHOLLIMA"
        malware_family = "Hawup"
    strings:
        $ = { 33 c0 8a 04 0a 8b 4d ec 81 e1 ff 00 00 00 8b 55 f8 33 db 8a 1c 0a 03 c3 25 ff 00 00 00 8b 4d 08 03 4d f0 8b 55 f8 8a 09 32 0c 02 8b 55 08 03 55 f0 88 0a e9 }
    condition:
        any of them
}

rule CrowdStrike_CSIT_17056_02 : labyrinth_chollima hawup rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Hawup pseudo TLS 1.0"
        reports = "CSIT-15113,CSIT-17056"
        version = "201703150000"
        last_modified = "2017-03-15"
        actor = "LABYRINTH CHOLLIMA"
        malware_family = "Hawup"
    strings:
        $ = { 8b 3d a4 01 41 00 8b f1 68 01 03 00 00 88 44 24 10 ff d7 }
        $ = { 8b 3d ?? ?? (4? ??| 00 10) 8b f1 68 01 03 00 00 88 44 24 10 ff d7 }
    condition:
        any of them
}

rule CrowdStrike_CSIT_17056_01 : labyrinth_chollima hawup rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Hawup pseudo TLS 1.1"
        reports = "CSIT-15113,CSIT-17056"
        version = "201703160000"
        last_modified = "2017-03-16"
        actor = "LABYRINTH CHOLLIMA"
        malware_family = "Hawup"
    strings:
        $x86 = { c6 45 ec 17 ?? ?? ?? c6 45 ed 03 c6 45 ee 02 c6 45 f0 0c e8  }
        $x64 = { c7 44 24 20 17 03 02 00 c6 44 24 24 0c e8 }
    condition:
        any of them
}

rule CrowdStrike_CSIT_17055_01 : turbine_panda portreuse cmdclient rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detection for CMDClient component of PortReuse RAT"
        reports = "CSIT-17055"
        version = "201703230000"
        last_modified = "2017-03-23"
        actor = "TURBINE PANDA"
        malware_family = "PortReuse"
    strings:
        $ = "MSGR: Start download file..." wide
        $ = "MSGR: Downloading file, packet size: %d" wide
        $ = "MSGR: Send file failed." wide
        $ = "MSGR: Finish download file..." wide
        $ = "PortReuse\\CmdClient\\Release" nocase
        $ = "CmdClient.dll"
        $ = ".log.tmp" wide
        $ = "?keylog?"
        $ = "%ls\\system32\\cmd.exe" wide
        $ = "BINARY" wide
        $ = "%ls\\%ls"
    condition:
        5 of them
}

rule CrowdStrike_CSIT_17055_02 : turbine_panda portreuse portcore rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detection for PortCore component of PortReuse RAT"
        reports = "CSIT-17055"
        version = "201703230000"
        last_modified = "2017-03-23"
        actor = "TURBINE PANDA"
        malware_family = "PortReuse"
    strings:
        $ = "portreuse\\portcore"
        $ = "\\SystemRoot\\System32\\drivers\\tcpip.sys" wide
        $ = { 7d e0 07 20 00 80 }
    condition:
        all of them
}

rule CrowdStrike_CSIT_17055_03 : turbine_panda portreuse installer 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detection for installer of PortReuse RAT"
        reports = "CSIT-17055"
        version = "201703230000"
        last_modified = "2017-03-23"
        actor = "TURBINE PANDA"
        malware_family = "PortReuse"
    strings:
        $ = "Windows Port Manager Kernel Mode Driver" wide
        $ = "\\tcpip.sys" wide
        $ = "\\MMessenger.dll" wide
        $ = "\\PortManager.sys" wide
    condition:
        all of them
}

rule CrowdStrike_CSIT_17064_02 : nymaim goznym trojan banking 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Nymaim control flow obfuscation techniques"
        reports = "CSIT-17064"
        version = "201809251138"
        last_modified = "2018-09-25"
        malware_family = "Nymaim, GozNym"
    strings:
        $push_reg = { 6a ?? e8 ?? ?? ?? ?? 6a ?? e8 }
        $add_calc = { 8b 45 0c 03 45 08 e9 }
        $sub_calc = { 8b 45 0c 2b 45 08 e9 }
        $xor_calc = { 8b 45 0c 33 45 08 e9 }
        $cmp_jump = { 83 7c 24 04 ?? 0f 85 }
    condition:
        (all of them) and
        #push_reg > 30
        and filesize < 600KB
}

rule CrowdStrike_CSIT_17064_01 : nymaim goznym 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Nymaim string deobfucation routine"
        reports = "CSIT-17064"
        version = "201807271451"
        last_modified = "2018-07-27"
        malware_family = "Nymaim, GozNym"
    strings:
        $str_deob = { 83 e1 03 c1 e1 03 89 d8 d3 c8 42 }
    condition:
        $str_deob
}

rule CrowdStrike_CSIT_17046_02 : silentbytes delivery_document macro 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Malicious macro document noted deploying SilentBytes"
        reports = "CSIT-17046"
        version = "201703270000"
        last_modified = "2017-03-27"
        malware_family = "SilentBytes"
    strings:
        $str_nextpart = "_NextPart_01D2925D.CCE59EE0"
        $str_fileloc = "file:///C:/DE62D170/AMDCRIP.htm"
    condition:
        filesize < 2MB and any of them
}

rule CrowdStrike_CSIT_17047_01 : gootkit loader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Gootkit loader DLL obfuscated strings"
        version = "201807271604"
        last_modified = "2018-07-27"
        malware_family = "Gootkit"
    strings:
        $as1 = "/rbo"
        $as2 = "dy32"
        $as3 = "dy64"
        $as4 = "$CHICAGO$"
        $as5 = "GetNativeSystemIDigitalProductIdSOFTWARE\\Microsoft\\Windows NT\\Cu"
        $as6 = "< destination IP address >"
    condition:
        4 of ($as*)
}

rule CrowdStrike_CSIT_17046_01 : silentbytes rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "JAR file containing SilentBytes RAT instance"
        reports = "CSIT-17046"
        version = "201807300932"
        last_modified = "2018-07-30"
        malware_family = "SilentBytes"
    strings:
        $str_conf_name = "Y29uZmlnDQo="
    condition:
        uint16(0) == 0x4b50 and $str_conf_name
}

rule CrowdStrike_CSIT_17056_04 : labyrinth_chollima hawup delivery_document 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Hex-encoded XOR'ed PE file"
        reports = "CSIT-15113,CSIT-17056"
        version = "201703300000"
        last_modified = "2017-03-30"
        actor = "LABYRINTH CHOLLIMA"
        malware_family = "Hawup"
    strings:
        $hdr = { d0 cf 11 e0 a1 b1 1a e1 }
        $thisprogram_binary = { b3 8f 8e 94 c7 97 95 88 80 95 86 8a c7 84 86 89 89 88 93 c7 85 82 c7 95 92 89 c7 8e 89 c7 a3 a8 b4 c7 8a 88 83 82 }
        $thisprogram_hex = "B38F8E94C79795888095868AC7848689898893C78582C7959289C78E89C7A3A8B4C78A888382" nocase
    condition:
        $hdr and any of ($thisprogram*)
}

rule CrowdStrike_CSIT_17053_01 : sage ransomware unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Sage Ransomware"
        reports = "CSIT-17053"
        version = "201808061353"
        last_modified = "2018-08-06"
        malware_family = "Sage Ransomware"
    strings:
        $encrypted = "encrypted by SAGE" wide
        $sage = ".sage" wide
        $sagenotice = "sage.notice" wide
    condition:
        all of them
}

rule CrowdStrike_CSIT_17059_01 : pspos pos_scraper loader powershell 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detection for encoded shellcode in PSPoS PowerShell script"
        reports = "CSIT-17059"
        version = "201704050000"
        last_modified = "2017-04-05"
        malware_family = "PSPoS"
    strings:
        $hex_payload_flag = "0xbe,0xba,0xad,0xab,0x0d,0xf0,0xad,0x8b" nocase
        $hex_hashed_api1 = "0xfe,0x6a,0x7a,0x69" nocase
        $hex_hashed_api2 = "0x5f,0x70,0x35,0x3a" nocase
        $compression_const = "0x3d,0x00,0x7d,0x00" nocase
    condition:
        all of them
}

rule CrowdStrike_CSIT_17059_02 : pspos pos_scraper loader shellcode 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detection of PSPoS shellcode loader"
        reports = "CSIT-17059"
        version = "201704050000"
        last_modified = "2017-04-05"
        malware_family = "PSPoS"
    strings:
        $payload_flag = { be ba ad ab 0d f0 ad 8b }
        $hashed_api1 = { fe 6a 7a 69 }
        $hashed_api2 = { 5f 70 35 3a }
        $compression_const = { 3d 00 7d 00 }
    condition:
        all of them
}

rule CrowdStrike_CSIT_17059_03 : pspos pos_scraper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detection for PSPoS memory scraper"
        reports = "CSIT-17059"
        version = "201704050000"
        last_modified = "2017-04-05"
        malware_family = "PSPoS"
    strings:
        $enc1 = { 0d 66 19 00 }
        $enc2 = { 6b 1e f9 49 }
        $time_val = { bd 42 7a e5 d5 94 bf d6 }
        $pipe_compariston = { 66 83 f8 7c }
    condition:
        all of them
}

rule CrowdStrike_CSIT_17056_05 : labyrinth_chollima hawup rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Hawup TLS 1.2"
        reports = "CSIT-15113,CSIT-17056"
        version = "201704200000"
        last_modified = "2017-04-20"
        actor = "LABYRINTH CHOLLIMA"
        malware_family = "Hawup"
    strings:
        $ = { 69 c0 fd 06 00 00 89 45 fc c6 45 dc 17 c6 45 dd 03 c6 45 de 03 }
    condition:
        any of them
}

rule CrowdStrike_CSIT_17068_01 : vixen_panda mirage rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detection for variant of Mirage used for Wifi-tampering"
        reports = "CSIT-17068"
        version = "201704200000"
        last_modified = "2017-04-20"
        actor = "VIXEN PANDA"
        malware_family = "Mirage"
    strings:
        $core2 = "/result?hl=en&meta="
        $core3 = "<%s*%d*%d*%d*%d*>" wide
        $wifi1 = "<WLANProfile xmlns="
        $wifi2 = "SSIDConfig>"
    condition:
        all of them
}

rule CrowdStrike_CSA_17086_01 : carbon dropper venomous_bear 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Carbon dropper"
        reports = "CSA-17086"
        version = "201908131615"
        last_modified = "2019-08-13"
        actor = "VENOMOUS BEAR"
        malware_family = "Carbon"
    strings:
        $ = "extract_file(): %s in '%s'" wide
        $ = "extract_file(): FindRes failed - %d" wide
        $ = "extract_file(): LoadRes failed - %d" wide
        $ = "extract_file(): LockRes failed - %d" wide
        $ = "extract_file(): CreateFile '%s' failed - %d" wide
        $ = "extract_file(): InitSecDescr failed - %d" wide
        $ = "extract_file(): OK" wide
        $ = { 42 00 49 00 4e 00 41 00 52 00 59 00 00 00 4d 5a 90 00 03 00 00 00 }
    condition:
        all of them
}

rule CrowdStrike_CSIT_17069_01 : certificate soldier 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Code signing certificate used in custom compiled version of the Hacking Team Soldier malware, used in specific targeted attacks."
        reports = "CSIT-17069"
        version = "201910140911"
        last_modified = "2019-10-14"
    strings:
        $cn = "SPC"
        $serial = { 58 be 7b 63 89 43 cb 90 44 1a 09 42 25 ed c5 1c }
    condition:
        uint16(0) == 0x5a4d and
        ($cn and $serial)
}

rule CrowdStrike_CSIT_17069_02 : soldier key 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Code signing key used in custom compiled version of the Hacking Team Soldier malware, used in specific targeted attacks."
        reports = "CSIT-17069"
        version = "201807181157"
        last_modified = "2018-07-18"
    strings:
        $key = { 30 82 01 0a 02 82 01 01 00 ea 18 30 07 99 07 fc f1 ea 3f 32 6a a8 32 c9 0b 17 da 7f cd 3b 12 36 c4 e1 ad 84 46 9c 2d c6 a5 b9 50 e6 2e 84 a5 1b 41 21 8a 9e f3 87 87 f2 35 cc f8 d1 5a ba ba ac 6b c7 c6 66 03 15 b0 1b 83 92 f6 c7 de 4f 9a ee 46 2c e6 6a 88 2c 43 fc 3d 0b 3d c0 68 e9 14 40 7c d9 f1 a6 14 72 01 96 d7 8b 90 99 b0 50 6d a3 bd d8 34 e8 cf e3 04 80 42 eb 9e 2d a5 e2 12 24 69 a3 14 a0 d3 d2 86 b8 3d 6e 83 fa a3 8a 39 6f c1 4a ef b0 3a 6b 51 cd 0c 97 f3 e8 0f 56 e7 40 66 59 c8 45 78 f9 20 c6 a8 aa 8f bd 25 6f a6 44 18 c4 7c 62 77 34 32 33 43 d6 43 8a 46 3a 9e 77 4f 05 58 aa 5d 94 02 28 ed 83 35 2e e7 57 4e ac 34 a4 bd 7a 61 ce 52 e5 e4 26 65 1e f5 c8 f3 45 97 7c a0 4b 2a 3e 69 c3 f7 68 1c e2 ad 61 0b 74 c6 81 38 b5 e0 00 b5 db 2e d6 b1 20 e3 93 c8 65 68 21 00 03 c3 a1 58 ca 39 02 03 01 00 01 }
    condition:
        $key
}

rule CrowdStrike_CSIT_17071_01 : helix_kitten helminth dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Helminth dropper, detected by config and paths"
        reports = "CSIT-17071"
        version = "201704240000"
        last_modified = "2017-04-24"
        actor = "HELIX KITTEN"
        malware_family = "Helminth"
    strings:
        $config = "config.txt" wide
        $isalive = { 17 b0 5b 5e 43 4d 50 d7 }
        $appdata = "Microsoft FxCop" wide
        $task = "schtasks /create /sc daily /tn \"Optimize Start Menu Cache Files" wide
    condition:
        all of them
}

rule CrowdStrike_CSIT_17071_02 : helix_kitten helminth rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Helminth RAT, detected by key or PDB path"
        reports = "CSIT-17071"
        version = "201704240000"
        last_modified = "2017-04-24"
        actor = "HELIX KITTEN"
        malware_family = "Helminth"
    strings:
        $key = "f246b23d-c2d6-45f2-b268-dec30d9adaad"
        $pdb = "E:\\Projects\\hlm updated\\Helminth\\Release\\Helminth.pdb"
        $old_url = "/CheckUpdate.aspx"
        $new_url = "/CheckUpdateRequest.aspx"
    condition:
        ($key or $pdb) and ($old_url or $new_url)
}

rule CrowdStrike_CSIT_17066_04 : guru_spider mbs 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "MBS bitcoin stealer"
        reports = "CSIT-17066"
        version = "201807271624"
        last_modified = "2018-07-27"
        actor = "GURU SPIDER"
        malware_family = "MBS"
    strings:
        $http1 = "Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8"
        $http2 = "User-Agent: Uploador"
        $dll1 = "bs.dll"
        $dll2 = "+Mbs_Main"
        $mod1 = "\\MultiBit"
        $mod2 = "\\Terracoin"
        $mod3 = "\\PPCoin"
        $mod4 = "\\Primecoin"
        $mod5 = "\\Electrum"
    condition:
        1 of ($http*) and 1 of ($dll*) and 3 of ($mod*)
}

rule CrowdStrike_CSIT_17066_02 : guru_spider madness bot unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Madness PRO DDoS bot running in memory"
        reports = "CSIT-17066"
        version = "201807271610"
        last_modified = "2018-07-27"
        actor = "GURU SPIDER"
        malware_family = "Madness"
    strings:
        $instructions1 = { 55 89 e5 56 53 83 ec 20 8b 45 08 80 38 00 75 0c c7 45 ec ?? ?? ?? 00 }
        $instructions2 = { e9 84 00 00 00 c7 44 24 08 00 02 00 00 c7 44 24 04 00 00 00 00 c7 04 24 ?? ?? ?? 00 }
        $guid = { c7 44 24 08 08 00 00 00 c7 44 24 04 02 00 00 00 }
    condition:
        1 of ($instructions*) and $guid
}

rule CrowdStrike_CSIT_17067_01 : padcrypt ransomware 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "PadCrypt ransomware"
        reports = "CSIT-17067"
        version = "201807271636"
        last_modified = "2018-07-27"
        malware_family = "PadCrypt"
    strings:
        $padcrypt = "PadCrypt"
        $decryption = "Decryption Software"
        $publickey = "publicKey"
        $commkey = "communicationKey"
    condition:
        all of them
}

rule CrowdStrike_CSIT_17066_01 : guru_spider quantloader downloader unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "QuantLoader running in memory"
        reports = "CSIT-17066"
        version = "201807271625"
        last_modified = "2018-07-27"
        actor = "GURU SPIDER"
        malware_family = "QuantLoader"
    strings:
        $instructions1 = { 55 89 e5 56 53 83 ec 20 8b 45 08 80 38 00 75 0c c7 45 ec ?? ?? ?? 00 }
        $instructions2 = { e9 84 00 00 00 c7 44 24 08 00 02 00 00 c7 44 24 04 00 00 00 00 c7 04 24 ?? ?? ?? 00 }
        $guid = { c7 44 24 08 08 00 00 00 c7 44 24 04 05 00 00 00 }
    condition:
        1 of ($instructions*) and $guid
}

rule CrowdStrike_CSIT_17066_03 : guru_spider zstealer infostealer 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "z*Stealer information stealer"
        reports = "CSIT-17066"
        version = "201807271623"
        last_modified = "2018-07-27"
        actor = "GURU SPIDER"
        malware_family = "zStealer"
    strings:
        $s1 = "Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8"
        $s2 = "User-Agent: Uploador"
        $s3 = "bla-bla-blabla-bla-blabla-bla-blabla-bla-blabla-bla-bla"
        $dll1 = "sqlite3.dll"
        $dll2 = "zs.dll"
        $mod1 = "TModule_FTP_Abstract"
        $mod2 = "TModule_IM_Abstract"
        $mod3 = "TModule_Miranda"
        $mod4 = "TModule_Mozilla_Base"
        $mod5 = "TModule_Windows_Mail_Base"
        $mod6 = "TModule_RDP"
    condition:
        2 of ($s*) and 1 of ($dll*) and 3 of ($mod*)
}

rule CrowdStrike_CSIR_13004_04 : vixen_panda dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "VIXEN PANDA family 3 dropper strings"
        reports = "CSIT-13004"
        version = "201704270000"
        last_modified = "2017-04-27"
        actor = "VIXEN PANDA"
    strings:
        $lnk1 = "\\Adobe Gamma Loader.lnk"
        $lnk2 = "\\HP Printer.lnk"
        $spool = "%s\\spoolsv.exe"
        $reg = "REG"
        $bin = "BIN"
        $encdec = { 40 83 f8 68 72 }
    condition:
        uint16(0) == 0x5A4D and $encdec and 3 of ($spool, $lnk1, $lnk2, $reg, $bin)
}

rule CrowdStrike_CSIT_13008_01 : smacdown rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Rule identifies HTTP communication artifacts used by SmacDown RAT"
        reports = "CSIT-13008"
        version = "201704270000"
        last_modified = "2017-04-27"
        malware_family = "SmacDown"
    strings:
        $str_sres = "sres=%s" wide
        $str_mac = "s?smac=%s" wide
        $str_down = "x-Down("  wide
        $str_only = "x-DownOnly(" wide
    condition:
        1 of them
}

rule CrowdStrike_CSIT_13111_01 : deep_panda derusbi rootkit 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "DEEP PANDA Derusbi rootkit with firewall filter"
        reports = "CSIT-13111"
        version = "201704270000"
        last_modified = "2017-04-27"
        actor = "DEEP PANDA"
        malware_family = "Derusbi"
    strings:
        $ipinjectpkt = "IPInjectPkt"
        $version_check = { 25 00 00 ff ff 3d 00 00 00 06 72 06 b8 bb 00 00 c0 }
        $packet_verification_algo = { 8b 75 08 0f b6 36 83 e6 0f c1 e6 02 57 8b 7d 10 2b fe 8b f1 c1 ee 02 81 e6 fc ff ff 3f 2b fe 33 c0 83 ff 40 75 1a c1 e9 04 8d 0c 8a 8b 11 8b f2 f7 d6 39 71 04 75 09 c1 ca 07 39 51 08 75 01 40 }
        $tag1 = "kdtn"
        $tag2 = "tslm"
        $tag3 = "tent"
        $tag4 = "TCPf"
        $tag5 = "FBPI"
    condition:
        $ipinjectpkt and $version_check or $packet_verification_algo or 3 of($tag*) and uint16(0) == 0x5a4d and uint32(uint32(0x3C)) == 0x00004550 and uint16(uint32(0x3C)+0x5c) == 1
}

rule CrowdStrike_CSIT_17070_01 : stardust_chollima twopence xordns rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "TwoPence XorDNS RAT registry variant"
        reports = "CSIT-17070"
        version = "201705010000"
        last_modified = "2017-05-01"
        actor = "STARDUST CHOLLIMA"
        malware_family = "TwoPence"
    strings:
        $reg1 = "SYSTEM\\CurrentControlSet\\Control\\Network"
        $reg2 = "%s\\Software\\Microsoft\\Windows\\CurrentVersion\\Internet Settings"
        $temp = "cmd.exe /c \"%s\" > %s 2>&1"
        $winsta = "winsta0\\default"
        $fname = "IMEKLMG"
        $install = { 2d 73 00 00 2d 69 00 00 }
    condition:
        4 of them
}

rule CrowdStrike_CSIT_17070_02 : stardust_chollima twopence xordns rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "TwoPence XorDNS implant file variant"
        reports = "CSIT-17070"
        version = "201705010000"
        last_modified = "2017-05-01"
        actor = "STARDUST CHOLLIMA"
        malware_family = "TwoPence"
    strings:
        $hlp = "%s\\Help\\%s.hlp" wide
        $chm = "%s\\Help\\%s.chm" wide
        $libcurl = "# Fatal libcurl error"
        $dns = "dnsapi.dll"
        $cmd_runx = { 3d 58 4e 55 52 }
        $cmd_wipe = { 3d 45 50 49 57 }
        $cmd_ginf = { 3d 46 4e 49 47 }
        $cmd_down = { 3d 4e 57 4f 44 }
    condition:
        3 of them
}

rule CrowdStrike_CSIT_17070_03 : stardust_chollima twopence xordns rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "TwoPence XorDNS implant keys"
        reports = "CSIT_17070"
        version = "201705010000"
        last_modified = "2017-05-01"
        actor = "STARDUST CHOLLIMA"
        malware_family = "TwoPence"
    strings:
        $ = { 6b ea f5 11 df 18 6d 74 af f2 d9 30 8d 17 72 e4 bd a1 45 2d 3f 91 eb de dc f6 fa 4c 9e 3a 8f 98 }
        $ = { 58 29 ab 7c 86 c2 a5 f9 }
    condition:
        any of them
}

rule CrowdStrike_CSIT_13064_02 : citadel proxy trojan 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Citadel Proxy Tunnel"
        reports = "CSIT-13064"
        version = "201910080953"
        last_modified = "2019-10-08"
        malware_family = "Citadel"
    strings:
        $cmd = "cmd:"
        $rc4_pwd = "012345678901234567890"
        $peb_parse = { 56 31 c0 64 8b 40 30 8b 40 0c 8b 70 1c ad 8b 40 08 5e c3 }
        $fc = "-fc" fullword
        $fp = "-fp" fullword
    condition:
        all of them
}

rule CrowdStrike_CSIT_15064_02 : newct rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "SAMURAI PANDA NewCT RAT"
        reports = "CSIT-15064"
        version = "201705020000"
        last_modified = "2017-05-02"
        actor = "SAMURAI PANDA"
        malware = "NewCT"
    strings:
        $cl_tunbase = ".?AVTunnelBase@@"
        $cl_gdiplus = ".?AVGdiplusBase@Gdiplus@@"
        $cl_screen = ".?AVScreenshots@@"
        $cl_image = ".?AVImage@Gdiplus@@"
        $dll_name = "xldll.dll"
        $dll_exp1 = "CreateInstance" fullword
        $dll_exp2 = "SendData" fullword
        $str_setting = "\\Settings.DAT"
        $str_stat = "stat.txt"
        $str_iis = "IIS"
        $str_set = "SETDOMAIN"
        $str_err = "domain name change error."
        $rundll = "rundll32.exe"
        $im = "/IM"
    condition:
        ((3 of ($cl_*)) or (2 of ($dll_*)) and (1 of ($str_*))) and 4 of them and #dll_exp1 < 3 and $rundll and $im
}

rule CrowdStrike_CSA_17103_01 : config snake venomous_bear 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Snake configuration (queue) file"
        reports = "CSA-17103"
        version = "201908131615"
        last_modified = "2019-08-13"
        actor = "VENOMOUS BEAR"
        malware_family = "Snake"
    strings:
        $ = {
        00 ?? ?? 00 00 ?? ?? 00  00 00 ?? ?? 00 ?? ?? 00
        ?? 00 00 00 ?? ?? ?? 00  ?? 00 00 00 01 00 00 00
        5a 00 00 00 ?? 00 00 00  83 e0 45 a9 fe ff ff ff
        }
    condition:
        all of them
}

rule CrowdStrike_CSIT_13032_05 : silent_chollima downloader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "SILENT CHOLLIMA tool - downloader variant 1"
        reports = "CSIT-13032"
        version = "201705030000"
        last_modified = "2017-05-03"
        actor = "SILENT CHOLLIMA"
    strings:
        $hello = "hello" ascii
        $hash_createproc = { 72 fe b3 16 }
        $hash_urldownload = { 36 1a 2f 70 }
        $hash_winexe = { 98 fe 8a 0e }
        $echo_off = { 40 65 63 68 6f 20 6f 66 66 0a 3a }
    condition:
        all of them
}

rule CrowdStrike_CSIT_13032_06 : silent_chollima downloader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "SILENT CHOLLIMA tool - downloader variant 2"
        reports = "CSIT-13032"
        version = "201705030000"
        last_modified = "2017-05-03"
        actor = "SILENT CHOLLIMA"
    strings:
        $epgetpc = { 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 55 8b ec 83 ec 34 e8 00 00 00 00 58 ?? ?? ?? ?? ?? ?? ?? ?? ?? 05 }
        $hello = "hello"
    condition:
        @epgetpc >= 0x10 and @epgetpc <= 0x1000 and $hello
}

rule CrowdStrike_CSIT_14095_01 : cve_2014_4113 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "CVE-2014-4113 Microsoft Windows x64 Local Privilege Escalation Exploit"
        reports = "CSIT-14095"
        version = "201809251138"
        last_modified = "2018-09-25"
    strings:
        // Fixed memory addresses
        $addr1 = { 48 a? 8b 00 00 00 01 00 00 00 }
        $addr2 = { 48 a? 0b 00 00 00 01 00 00 00 }
        $addr3 = { 48 b? 8b 00 00 00 01 00 00 00 }
        $addr4 = { 48 b? 0b 00 00 00 01 00 00 00 }
        $addr5 = { 48 c? 8b 00 00 00 01 00 00 00 }
        $addr6 = { 48 c? 0b 00 00 00 01 00 00 00 }
        $addr7 = { 48 8? 8b 00 00 00 01 00 00 00 }
        $addr8 = { 48 8? 0b 00 00 00 01 00 00 00 }
        $snip_a = { 41 8a 03 49 03 e9 3c e8 75 05 45 85 c0 74 09 3c }
        $snip_b = { 49 03 c3 48 8d 54 01 05 49 3b d1 72 05 48 3b d5 }
        $snip_c = { 8c 00 00 45 33 c9 8d 53 df 45 8d 41 27 48 8b cf }
    condition:
        uint16(0) == 0x5A4D and ((any of ($addr*) and filesize < 1MB) or (any of ($snip*)))
}

rule CrowdStrike_Gh0st_01 : gh0st rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Gh0st - Alerts on the building of the keylog filename via stack strings."
        version = "201705050000"
        last_modified = "2017-05-05"
        malware_family = "Gh0st"
    strings:
        $ss_ourlog=  { c6 45 ?? 75 c6 45 ?? 72 c6 45 ?? 6c c6 45 ?? 67 c6 45 ?? 2e c6 45 ?? 64 c6 45 ?? 61 c6 45 ?? 74 c6 45 ?? 00 ff }
        $fmt_string = "%-24s %-15s 0x%x(%d)"
    condition:
        $ss_ourlog and $fmt_string
}

rule CrowdStrike_Gh0st_02 : gh0st rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule alerts on a routine moving an xor key onto the stack found in a small number of Gh0st sample. The xor key is applied to the first of the compressed C2 traffic."
        version = "201705050000"
        last_modified = "2017-05-05"
        malware_family = "Gh0st"
    strings:
        $xorkey =  { 66 c7 ?? ?? 01 00 66 c7 ?? ?? 06 00 66 c7 ?? ?? 08 00 66 c7 ?? ?? 08 00 66 c7 ?? ?? 03 00 66 c7 ?? ?? 05 00 66 c7 ?? ?? 06 00 66 c7 ?? ?? 07 00 66 c7 ?? ?? 06 00 66 c7 ?? ?? 04 00 66 c7 ?? ?? 04 00 66 c7 ?? ?? 03 00 66 c7 ?? ?? 01 00 66 c7 ?? ?? 04 00 66 c7 ?? ?? 08 00 66 c7 ?? ?? 01 00 66 c7 ?? ?? 02 00 66 c7 ?? ?? 04 00 66 c7 ?? ?? 03 00 66 c7 ?? ?? 01 00 66 c7 ?? ?? 01 00 66 c7 ?? ?? 05 00 66 c7 ?? ?? 02 00 66 c7 ?? ?? 02 00 66 c7 ?? ?? 01 00 66 c7 ?? ?? 02 00 66 c7 ?? ?? 01 00 66 c7 ?? ?? 03 00 66 c7 ?? ?? 03 00 66 c7 ?? ?? 02 00 66 c7 ?? ?? 05 00 66 c7 ?? ?? 08 00 66 c7 ?? ?? 05 00 66 c7 ?? ?? 01 00 66 c7 ?? ?? 02 00 66 c7 ?? ?? 03 00 66 c7 ?? ?? 02 00 66 c7 ?? ?? 05 00 66 c7 ?? ?? 03 00 66 c7 ?? ?? 04 00 66 c7 ?? ?? 01 00 66 c7 ?? ?? 02 00 }
    condition:
        $xorkey
}

rule CrowdStrike_CSIT_17079_01 : installer rawdoor 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "RawDoor installer"
        reports = "CSIT-17079"
        version = "202010022109"
        last_modified = "2020-10-02"
        actor = "JUDGMENT PANDA"
        malware_family = "RawDoor"
    strings:
        // Debugging strings
        $ = "%s exist"
        $ = "step 1 : CreateService %s success!"
        $ = "CreateService %s success! but Start Faile.. %d"
    condition:
        all of them
}

rule CrowdStrike_CSIT_17079_02 : rat rawdoor 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "RawDoor RAT main component"
        reports = "CSIT-17079"
        version = "202010022109"
        last_modified = "2020-10-02"
        actor = "JUDGMENT PANDA"
        malware_family = "RawDoor"
    strings:
        $ = "=================RawDoor %g================"
        $ = "%0.4u-%0.2u-%0.2u  %0.2u:%0.2u"
        $ = "%u:UDP:*:Enabled:%u"
        $ = "DIR [drive:][path][filename]"
        $ = "Failed to create shell stdin pipe, error = %d"
        $ = "Failed to create ReadShell session thread, error = %d"
    condition:
        3 of them
}

rule CrowdStrike_CSIT_17113_01 : kazuar rat venomous_bear 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Kazuar malware"
        reports = "CSIT-17113"
        version = "202001061042"
        last_modified = "2020-01-06"
        actor = "VENOMOUS BEAR"
        malware_family = "Kazuar"
    strings:
        $dotnet_magic = "BSJB"
        $dotnet_stream_1 = "#Strings"
        $dotnet_stream_2 = "#US"
        $dotnet_stream_3 = "#GUID"
        $dotnet_stream_4 = "#Blob"
        $ = "Agent.exe"
        $ = "HttpListener"
        $ = "Confused"
        $ = { 74 30 00 74 31 00 74 32 00 74 33 00 } // t0 t1 t2 t3
    condition:
        all of them and filesize < 500KB
}

rule CrowdStrike_CSIT_18012_01 : kazuar rat venomous_bear 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Kazuar malware"
        reports = "CSIT-18012"
        version = "202001061042"
        last_modified = "2020-01-06"
        actor = "VENOMOUS BEAR"
        malware_family = "Kazuar"
    strings:
        $dotnet_magic = "BSJB"
        $dotnet_stream_1 = "#Strings"
        $dotnet_stream_2 = "#US"
        $dotnet_stream_3 = "#GUID"
        $dotnet_stream_4 = "#Blob"
        $ = "Agent.exe"
        $ = "HttpListener"
        $ = "Confused"
        $ = { 74 30 00 74 31 00 74 32 00 74 33 00 } // t0 t1 t2 t3
    condition:
        all of them and filesize < 500KB
}

rule CrowdStrike_CSIT_18012_02 : kazuar rat venomous_bear 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Helper DLL used by Kazuar malware"
        reports = "CSIT-18012"
        version = "201908131552"
        last_modified = "2019-08-13"
        actor = "VENOMOUS BEAR"
        malware_family = "Kazuar"
    strings:
        $pe_magic_1 = "This program cannot be run in DOS mode."
        $section_2 = ".rdata"
        $section_3 = ".edata"
        $section_4 = ".idata"
        $str_3 = "explorer.exe"
        $str_5 = "DllMain"
        $name_32 = "dl32.dll"
        $name_32_2 = "dll32.dll"
        $name_64 = "dl64.dll"
        $name_64_2 = "dll64.dll"
        $import_1 = "CreateThread"
        $import_2 = "GetModuleFileNameA"
        $import_3 = "LoadLibraryA"
        $import_4 = "lstrcmpiA"
        $import_5 = "PathFindFileNameA"
        $import_6 = "CallNextHookEx"
        $import_7 = "KERNEL32.dll"
        $import_8 = "SHLWAPI.dll"
        $import_9 = "USER32.dll"
    condition:
        $pe_magic_1 and
        all of ($section_*)
        and all of ($str_*)
        and all of ($import_*)
        and any of ($name_*)
        and uint16(0) == 0x5A4D and uint16(0x80) == 0x4550
        and filesize < 10KB
}

rule CrowdStrike_CSIT_17113_02 : kazuar rat venomous_bear 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Helper DLL used by Kazuar malware"
        reports = "CSIT-17113"
        version = "202001281735"
        last_modified = "2020-01-28"
        actor = "VENOMOUS BEAR"
        malware_family = "Kazuar"
    strings:
        $pe_magic_1 = "This program cannot be run in DOS mode."
        $section_1 = ".wtf"
        $section_2 = ".rdata"
        $section_3 = ".edata"
        $section_4 = ".idata"
        $str_3 = "explorer.exe"
        $str_5 = "DllMain"
        $str_6 = "HookProc"
        $name_32 = "dl32.dll"
        $name_64 = "dl64.dll"
        $import_1 = "CreateThread"
        $import_2 = "GetModuleFileNameA"
        $import_3 = "LoadLibraryA"
        $import_4 = "lstrcmpiA"
        $import_5 = "PathFindFileNameA"
        $import_6 = "CallNextHookEx"
        $import_7 = "KERNEL32.dll"
        $import_8 = "SHLWAPI.dll"
        $import_9 = "USER32.dll"
    condition:
        $pe_magic_1 and
        all of ($section_*)
        and all of ($str_*)
        and all of ($import_*)
        and any of ($name_*)
        and uint16(0) == 0x5A4D and uint16(0x80) == 0x4550
        and filesize < 10KB
}

rule CrowdStrike_CSIT_17083_01 : kovter bot loader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Kovter (unpacked) loader or payload with config attached in DATA resource."
        reports = "CSIT-17083"
        version = "201807271434"
        last_modified = "2018-07-27"
        malware_family = "Kovter"
    strings:
        $a = { 8b 55 ec 30 04 3a 47 ff 4d }
        $b = { 08 4b 81 cb 00 ff ff ff 43 03 b4 }
        $c = { 79 08 4e 81 ce 00 ff ff ff 46 8a 84 9d }
        $d = "DATA" wide
    condition:
        all of them
}

rule CrowdStrike_CSIT_14055_01 : plugx rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detection for some versions of PlugX set to run on a specific date"
        reports = "CSIT-14055"
        version = "201705160000"
        last_modified = "2017-05-16"
        malware_family = "PlugX"
    strings:
        $header_20130808 = { 6b c? 64 03 c? [1-7] 6b c? 64 03 c? [1-3] f8 2b 33 01 }
        $header_2014 = { 6b c? 64 03 c? [1-3] 12 03 00 0f }
    condition:
        any of them
}

rule CrowdStrike_CSIT_17091_01 : mythic_leopard waizsar 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = ".NET GUIDs seen in MYTHIC LEOPARD builder"
        reports = "CSIT-17091"
        version = "201705190000"
        last_modified = "2017-05-19"
        actor = "MYTHICLEOPARD"
        malware_family = "Waizsar"
    strings:
        $guid_typelib = "82049fae-5ccb-444f-823a-8cd3633b7df3"
        $guid_mvid = "fb1183f0-6122-4271-a763-ee69cdbed05d"
    condition:
        filesize < 2MB and any of them
}

rule CrowdStrike_CSIT_17091_02 : mythic_leopard waizsar rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "PDB paths seen in MYTHIC LEOPARD malware and tools"
        reports = "CSIT-17091"
        version = "201705190000"
        last_modified = "2017-05-19"
        actor = "MYTHICLEOPARD"
        malware_family = "Waizsar, updatc"
    strings:
        $x86 = "\\obj\\x86\\"
        $s_miprj = "E:\\Projects\\mi_project\\"
        $s_mprj = "E:\\Projects\\m_project\\"
        $s_binderdocs = "C:\\Binder\\microsoftdocs\\"
        $s_binderscan = "c:\\Binder\\filescan\\"
        $s_pre = "E:\\pre\\"
        $s_poe = "E:\\poe\\"
        $s_isql = "ISqlManager"
        $s_muneeb = "C:\\Users\\muneeb\\"
        $s_proj = "D:\\ProjectsReadytoGo\\"
        $s_pp = "E:\\pp\\"
        $s_waiz = "\\waizsar\\"
    condition:
        $x86 and (any of ($s_*))
}

rule CrowdStrike_CSIT_17081_01 : pony unpacked infostealer 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Rule for unpacked Pony samples"
        reports = "CSIT-17081"
        version = "201809211620"
        last_modified = "2018-09-21"
        malware_family = "Pony"
    strings:
        $s1 = "PWDFILE0"
        $s2 = "PKDFILE0"
        $s3 = "CRYPTED0"
        $s4 = "Software\\WinRAR"
        $s5 = "{%08X-%04X-%04X-%02X%02X-%02X%02X%02X%02X%02X%02X}"
        $s6 = "STATUS-IMPORT-OK"
        $s7 = "POST %s HTTP/1.0"
        $s8 = "GET %s HTTP/1.0"
        $s9 = "Client Hash"
    condition:
        5 of them
}

rule CrowdStrike_CSIT_17085_01 : stardust_chollima twopence xordns rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "TwoPence XorDNS x86 component"
        reports = "CSIT-17085"
        version = "201705240000"
        last_modified = "2017-05-24"
        actor = "STARDUST CHOLLIMA"
        malware_family = "TwoPence"
    strings:
        $ = { 8b 44 24 ?? 8b 54 24 ?? 6a 01 50 8b 48 18 81 f1
        ?? ?? ?? ?? 89 0a 8b 0d }
        $ = { 8b 44 24 04 8b ?? ?? ?? 6a 01 50 8b 50 18 81 f2
        ?? ?? ?? ?? 89 ?? 8b 0d }
        $ = { 8b 44 24 10 8b 4c 24 14 6a 01 50 ff 70 18 5a 81
        f2 ?? ?? ?? ?? 52 8f 01 }
        $ = { 8b 44 24 10 8b 4c 24 14 6a 01 50 8b 50 18 81 f2
        ?? ?? ?? ?? 52 8f 01 }
    condition:
        any of them
}

rule CrowdStrike_CSIT_17085_02 : stardust_chollima twopence xordns rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "TwoPence XorDNS x64 component"
        reports = "CSIT-17085"
        version = "201705240000"
        last_modified = "2017-05-24"
        actor = "STARDUST CHOLLIMA"
        malware_family = "TwoPence"
    strings:
        $ = { 48 8b 4c 24 ?? ba 01 00 00 00 8b 41 20 35 ?? ??
        ?? ?? 89 03 }
        $ = { 48 8b 4c 24 ?? 41 8b d4 8b 41 20 35 ?? ?? ?? ??
        89 03 48 }
    condition:
        any of them
}

rule CrowdStrike_CSIT_17085_03 : stardust_chollima twopence rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "TwoPence C2 key generation component"
        reports = "CSIT-17085"
        version = "201705240000"
        last_modified = "2017-05-24"
        actor = "STARDUST CHOLLIMA"
        malware_family = "TwoPence"
    strings:
        $ = { f6 ea 34 ?? 88 44 0c 00 41 83 f9 10 72 }
    condition:
        all of them
}

rule CrowdStrike_CSIT_17085_04 : stardust_chollima twopence rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "TwoPence self delete batch script format strings"
        reports = "CSIT-17085"
        version = "201705240000"
        last_modified = "2017-05-24"
        actor = "STARDUST CHOLLIMA"
        malware_family = "TwoPence"
    strings:
        //:L1..del "%s"..if exist "%s" goto L1..del "%s"..
        $l1_ascii = { 3a 4c 31 0d 0a 64 65 6c 20 22 25 73 22 0d 0a 69
        66 20 65 78 69 73 74 20 22 25 73 22 20 67 6f 74
        6f 20 4c 31 0d 0a 64 65 6c 20 22 25 73 22 0d 0a }
        //@echo off..:D1..del /a %1..if exist %1 goto D1..del /a %0
        $d1_ascii = { 40 65 63 68 6f 20 6f 66 66 0d 0a 3a 44 31 0d 0a
        64 65 6c 20 2f 61 20 25 31 0d 0a 69 66 20 65 78
        69 73 74 20 25 31 20 67 6f 74 6f 20 44 31 0d 0a
        64 65 6c 20 2f 61 20 25 30 }
        //:L1..del "%s"..ping 0.0.0.0.>nul..if exist "%s" goto L1..del "%%0"..
        $l1_ping_a = { 3a 4c 31 0d 0a 64 65 6c 20 22 25 73 22 0d 0a 70
        69 6e 67 20 30 2e 30 2e 30 2e 30 3e 6e 75 6c 0d
        0a 69 66 20 65 78 69 73 74 20 22 25 73 22 20 67
        6f 74 6f 20 4c 31 0d 0a 64 65 6c 20 22 25 25 30 }
        //:L1..del "%s"..ping 0.0.0.0.>nul..if exist "%s" goto L1..del "%%0"..
        $l1_ping_w = { 3a 00 4c 00 31 00 0d 00 0a 00 64 00 65 00 6c 00 20
        00 22 00 25 00 73 00 22 00 0d 00 0a 00 70 00 69 00
        6e 00 67 00 20 00 30 00 2e 00 30 00 2e 00 30 00 2e
        00 30 00 3e 00 6e 00 75 00 6c 00 0d 00 0a 00 69 00
        66 00 20 00 65 00 78 00 69 00 73 00 74 00 20 00 22
        00 25 00 73 00 22 00 20 00 67 00 6f 00 74 00 6f 00
        20 00 4c 00 31 00 0d 00 0a 00 64 00 65 00 6c 00 20
        00 22 00 25 00 25 00 30 00 22 00 0d 00 0a }
    condition:
        any of them
}

rule CrowdStrike_CSIT_17085_05 : stardust_chollima twopence rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "TwoPence secure file wipe component"
        reports = "CSIT-17085"
        version = "201705240000"
        last_modified = "2017-05-24"
        actor = "STARDUST CHOLLIMA"
        malware_family = "TwoPence"
    strings:
        $ = { 81 ec 04 01 00 00 53 56 57 b9 40 00 00 00 33 c0
        8d 7c 24 0d c6 44 24 0c 00 8b 9c 24 14 01 00 00
        f3 ab 66 ab aa 8b fb 83 c9 ff 33 c0 8d 54 24 0c
        f2 ae f7 d1 2b f9 6a 5c 8b c1 8b f7 8b fa c1 e9
        02 f3 a5 8b c8 83 e1 03 f3 a4 8d 4c 24 10 51 ff
        ?? ?? ?? ?? 00 8b f0 83 c4 08 85 f6 74 03 46 eb
        04 8d 74 24 0c 80 3e 00 74 1d 8b 3d ?? ?? ?? ??
        ff d7 99 b9 1a 00 00 00 f7 f9 80 c2 61 88 16 8a
        46 01 46 84 c0 75 e9 8d 54 24 0c 52 53 ff 15 ??
        ?? ?? ?? 85 c0 74 04 8d 5c 24 0c 8a 84 24 18 01
        00 00 53 84 c0 74 1a ff 15 ?? ?? ?? ?? 85 c0 75
        2a ff 15 ?? ?? ?? ?? 5f 5e 5b 81 c4 04 01 00 00
        c3 ff 15 ?? ?? ?? ?? 85 c0 75 10 ff 15 ?? ?? ??
        ?? 5f 5e 5b 81 c4 04 01 00 00 c3 5f 5e 33 c0 5b
        81 c4 04 01 00 00 c3 }
    condition:
        all of them
}

rule CrowdStrike_CSIT_17085_06 : stardust_chollima twopence rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "TwoPence component for filling random buffer with data"
        reports = "CSIT-17085"
        version = "201705240000"
        last_modified = "2017-05-24"
        actor = "STARDUST CHOLLIMA"
        malware_family = "TwoPence"
    strings:
        $ = { 56 8b 74 24 0c 8b c6 4e 85 c0 7e 28 53 8b 1d ??
        ?? ?? 00 57 8b 7c 24 10 ff d3 25 ff 00 00 80 79
        07 48 0d 00 ff ff ff 40 88 04 37 8b ce 4e 85 c9
        7f e6 5f 5b 5e c3 90 90 90 90 90 90 90 90 90 90 }
    condition:
        all of them
}

rule CrowdStrike_CSIT_17148_01 : turbine_panda post_exploitation 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Post-exploitation binary used to hide a specified Service"
        reports = "CSIT-17148"
        version = "201807201301"
        last_modified = "2018-07-20"
        actor = "TURBINE PANDA"
    strings:
        $ = "found service_record table! version <= 6.1"
        $ = "found service_record table 6.2 or 6.3!"
    condition:
        any of them
}

rule CrowdStrike_CSIT_17148_02 : credential_theft mimikatz post_exploitation 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "MimiKatz strings included in variant used by TURBINE PANDA"
        reports = "CSIT-17148"
        version = "202003101404"
        last_modified = "2020-03-10"
        actor = "TURBINE PANDA"
        malware_family = "MimiKatz"
    strings:
        $str_a1 = "Authentication Id:" wide
        $str_a2 = "Authentication Domain:" wide
        $str_a3 = "Authentication Package:" wide
        $str_a4 = "* Password:" wide
        $str_a5 = "* Domain:" wide
        $str_a6 = "* User:" wide
        $str_b1 = "Authentication Id : %u ; %u (%08x:%08x)" wide
        $str_b2 = "Session           : %s from %u"     wide
        $str_b3 = "User Name         : %wZ"            wide
        $str_b4 = "Domain            : %wZ"            wide
        $str_b5 = "SID               : "               wide
    condition:
        all of ($str_a*) or all of ($str_b*)
}

rule CrowdStrike_CSIT_17077_01 : jaff ransomware 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Jaff Ransomware"
        reports = "CSIT-17077"
        version = "201807271613"
        last_modified = "2018-07-27"
        malware_family = "Jaff"
    strings:
        $jaff = "jaff"
        $decryptor = "decryptor"
        $tor = "Tor"
        $onion = ".onion"
        $strjnz1 = { 3c 30 74 }
        $strjnz2 = { 3c 31 74 }
        $strjnz3 = { 3c 32 74 }
    condition:
        all of them
}

rule CrowdStrike_CSIT_17098_01 : venuslocker ransomware 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "VenusLocker ransomware strings used in the malware"
        reports = "CSIT-17098"
        version = "201706010000"
        last_modified = "2017-06-01"
        malware_family = "VenusLocker"
    strings:
        $ = "VenusLockerRun"
        $ = "CheckVM"
        $ = "SendInfo"
        $ = "CreatePassword"
        $ = "RNGCryptoServiceProvider"
        $ = "GetInt"
    condition:
        all of them
}

rule CrowdStrike_CSIT_17098_03 : venuslocker ransomware 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "VenusLocker ransomware PDB paths"
        reports = "CSIT-17098"
        version = "201706020000"
        last_modified = "2017-06-02"
        malware_family = "VenusLocker"
    strings:
        $ = "\\Projects\\VenusLockerV2\\VenusLocker\\obj\\Release\\VenusLocker.pdb"
        $ = "VenusLocker\\obj\\Release\\VenusLocker.pdb"
        $ = "\\Projects\\VenusLockerV2EmailBTCAdmin\\VenusLocker\\obj\\Release\\VenusLocker.pdb"
        $ = "\\VenusLockerV2EmailBTCAdmin\\"
    condition:
        any of them
}

rule CrowdStrike_CSIT_17087_01 : threeproxy proxy 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Modified version of 3Proxy, distributed through existing DOUBLEPULSAR installations and possibly via Equation Group ETERNAL* exploits."
        reports = "CSIT-17087"
        version = "201807300934"
        last_modified = "2018-07-30"
        malware_family = "3Proxy"
    strings:
        // Common to all 3Proxy installations
        $usage1 = "%s --install [conffile]"
        $usage2 = "to install as service"
        $usage3 = "%s --remove"
        $usage4 = "to remove service"
        $usage5 = "Usage: %s [conffile]"
        // Source additions
        $volume = "GetVolumeInformationA"
        $beacon = "%s?id=%u"
    condition:
        all of them
}

rule CrowdStrike_CSIT_19027_01 : banking gozi isfb trojan unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule matches on the dropper for ISFB/Gozi/Ursnif with a packed client DLL."
        reports = "CSIT-19027"
        version = "201902221119"
        last_modified = "2019-02-22"
        malware_family = "ISFB,Gozi"
    strings:
        $dev1 = "WORM Device"
        $dev2 = "Tape Device"
        $dev3 = "IEEE 1394"
        $bss1 = ".bss"
        $bss2 = { 8d 7d ?? ab 66 ab 6a 08 aa 68 [4] 8d ?? ?? 5? }
        $m8z1 = "\x00M8Z"
        $m8z2 = { 40 0e 54 7c } // catches aplib packed clients that don't start with MZ
    condition:
        1 of ($dev*) and all of ($bss*) and 1 of ($m8z*)
}

rule CrowdStrike_CSIR_12027_03 : plugx rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Deobfuscation routine for PlugX RAT"
        reports = "CSIR-12027,CSIR-18014,CSIT-13097"
        version = "201810250927"
        last_modified = "2018-10-25"
        malware_family = "PlugX"
    strings:
        $winsta0_lower = { 77 00 69 00 6e 00 73 00 74 00 61 00 30 00 }
        $winsta0_upper = { 57 00 49 00 4e 00 53 00 54 00 41 00 30 00 }
        $deob_func_generic = { c1 ?? 03 [4-20] c1 ?? 05 [4-20] c1 ?? 07 [4-20] c1 ?? 09 }
    condition:
        uint16(0) == 0x5A4D and uint32(uint32(0x3C)) == 0x00004550 and $deob_func_generic and ($winsta0_lower or $winsta0_upper) and filesize < 1MB
}

rule CrowdStrike_CSIT_14092_02 : nettraveler rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "NetTraveler RAT"
        reports = "CSIT-14092"
        version = "201910241024"
        last_modified = "2019-10-24"
        malware_family = "NetTraveler"
    strings:
        $debug = " Is Running!"
        $decrypt_fn = { 8a 1c 07 2a d9 80 eb 0a 41 }
        $commands_1 = "RUN_STARTUP"
        $commands_2 = "RUN_REBOOT"
        $commands_3 = "RUN_DIRECT"
        $commands_4 = "UNINSTALL"
        $commands_5 = "UPLOAD"
        $c2_beacon = "%s?hostid=%s&hostname=%s&hostip=%s&filename=%s&filestart=%u&filetext="
        $c2_action = /%s?action=(updated|getdata|datasize)/
    condition:
        3 of them and (#commands_3 <= 1 and #commands_4 <= 1)
        and (any of ($debug, $decrypt_fn, $c2_beacon, $c2_action) or filesize < 100KB)
}

rule CrowdStrike_CSIT_17116_01 : silent_chollima monorat rat dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detection for MonoRAT and dropper"
        reports = "CSIT-17116"
        version = "201706120000"
        last_modified = "2017-06-12"
        actor = "SILENT CHOLLIMA"
        malware_family = "MonoRAT"
    strings:
        $ = "%s\\cmd.exe /c echo | %s > %s"
        $ = "%s*****%s"
        $ = ";$;,;4;<;D;L;T;\\;d;"
    condition:
        all of them
}

rule CrowdStrike_CSIT_16012_01 : hworm rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "H-Worm2 RAT"
        reports = "CSIT-16012"
        version = "201706130000"
        last_modified = "2017-06-13"
        malware_family = "H-Worm"
    strings:
        $ = "SOFTWARE\\Borland\\Delphi\\RTL" wide ascii
        $ = "inconnue" wide ascii
        $ = "new_slave" wide ascii
        $ = "file_manager_init" wide ascii
        $ = "password_init" wide ascii
        $ = "plugin_file_init" wide ascii
        $ = "plugin_url_init" wide ascii
    condition:
        5 of them
}

rule CrowdStrike_CSIT_17093_01 : adylkuzz unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Adylkuzz cryptominer unpacked strings"
        reports = "CSIT-17093"
        version = "201807271541"
        last_modified = "2018-07-27"
        malware_family = "Adylkuzz"
    strings:
        $miner = "Miner"
        $taskkill = "taskkill"
        $server = "--server"
        $service = "InstallService"
        $lfs = "LuaFileSystem"
        $ls = "LuaSocket"
    condition:
        all of them
}

rule CrowdStrike_CSIT_17096_01 : khrat dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "KHRAT SFX RAR dropper file"
        reports = "CSIT-17096"
        version = "201706170000"
        last_modified = "2017-06-17"
        malware_family = "KHRAT"
    strings:
        $ = "d:\\Projects\\WinRAR\\SFX\\build\\sfxrar32\\Release\\sfxrar.pdb"
        $ = "adobe.vbs"
        $ = "reader11_en_ha_install.exe"
    condition:
        filesize < 3MB and
        // MZ signature at offset 0
        uint16(0) == 0x5A4D and
        all of them
}

rule CrowdStrike_CSIT_17096_02 : khrat downloader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "KHRAT small executable downloader for VB Script"
        reports = "CSIT-17096"
        version = "201706170000"
        last_modified = "2017-06-17"
        malware_family = "KHRAT"
    strings:
        $ = "regsvr32.exe /s /n /u /i:http"
        $ = "scrobj.dll"
    condition:
        uint16(0) == 0x5A4D and
        filesize < 10KB and
        all of them
}

rule CrowdStrike_CSIT_17096_03 : khrat dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "KHRAT executable dropper"
        reports = "CSIT-17096"
        version = "201807191527"
        last_modified = "2018-07-19"
        malware_family = "KHRAT"
    strings:
        $ = ".DAT"
        /*
        .text:004010F1 8A 06     mov     al, [esi]
        .text:004010F3 F6 D0     not     al
        .text:004010F5 32 C3     xor     al, bl
        .text:004010F7 88 07     mov     [edi], al
        .text:004010F9 46        inc     esi
        .text:004010FA 47        inc     edi
        .text:004010FB 49        dec     ecx
        */
        $ = { 8a 06 f6 d0 32 c3 88 07 46 47 49 }
    condition:
        all of them
}

rule CrowdStrike_CSIT_17096_04 : khrat loader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "KHRAT DLL loader"
        reports = "CSIT-17096"
        version = "201706170000"
        last_modified = "2017-06-17"
        malware_family = "KHRAT"
    strings:
        $ = "DialogBoxParamA"
        $ = "EndDialog"
        $ = { 2e 44 41 54 00 4b 31 00 }
    condition:
        filesize < 10KB and
        all of them
}

rule CrowdStrike_CSIT_17096_05 : khrat rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "KHRAT main payload"
        reports = "CSIT-17096"
        version = "201706170000"
        last_modified = "2017-06-17"
        malware_family = "KHRAT"
    strings:
        $ = { 4b 31 00 4b 32 00 4b 33 00 }
        $ = "\\%u-%u-%u"
        $ = "{Ctrl+V}"
        $ = "(%u).log"
        $ = "Intel(R) Capability Licensing Service Interface"
    condition:
        2 of them
}

rule CrowdStrike_CSIR_17007_01 : voodoo_bear blackenergy3 rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detection for BlackEnergy3 executable"
        reports = "CSIR-17007"
        version = "201706190000"
        last_modified = "2017-06-19"
        actor = "VOODOO BEAR"
        malware_family = "BlackEnergy3"
    strings:
        $ = "\\Pipe\\{AA0EED25-4167-4CBB-BDA8-9A0F5FF93EA8}"
        $ = "\\\\%s.lnk" wide
        $ = "MCSF_Config" wide
        $ = "ldplg"
        $ = "getpd"
    condition:
        3 of them
}

rule CrowdStrike_CSIR_17007_02 : voodoo_bear blackenergy3 plugin 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detection for BlackEnergy version 3 plugins"
        reports = "CSIR-17007"
        version = "201706190000"
        last_modified = "2017-06-19"
        actor = "VOODOO BEAR"
        malware_family = "BlackEnergy3"
    strings:
        $ = "\\Pipe\\{AA0EED25-4167-4CBB-BDA8-9A0F5FF93EA8}"
        $ = "enc="
        $ = "cmdl"
    condition:
        all of them
}

rule CrowdStrike_CSIT_17104_01 : poseidon loader unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "PoSeidon loader (unpacked)"
        reports = "CSIT-17104"
        version = "201807271456"
        last_modified = "2018-07-27"
        malware_family = "PoSeidon"
    strings:
        // Strings used for C2 communication and tracking of modules
        $a = "uid=%I64u&uinfo=%s&win=%d.%d&bits=%d&vers=%s&build=%s"
        $b = "&bots="
        $c = "{b:%s|%s}"
    condition:
        $a and $b and $c
}

rule CrowdStrike_CSIT_17098_02 : venuslocker ransomware 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "VenusLocker ransomware credentials"
        reports = "CSIT-17098"
        version = "201706200000"
        last_modified = "2017-06-20"
        malware_family = "VenusLocker"
    strings:
        $offlineAesKey0 = "zyQCCu4Ml*4T=v!YP4oe9S5hbcoTGb8A"  ascii wide
        $offlineAesKey1 = "AyQCCu4Ml*4T=v!YP4oe9S5hbcoTGb8A"  ascii wide
        $btcaddr0 = "16jvWspVfvhjRgJhGCDETf29cjQAyNmx9G" ascii wide
        $btcaddr1 = "1BwZYTvWxw8d3RNFY9QY9gJ4RjEPt93p37" ascii wide
        $btcaddr2 = "182cLr8KvMogtDnP4DHbtuqEn5UfrUVHsk" ascii wide
        $btcaddr3 = "1C6ZF6vmFP5YDbmuwMqUrXfjrE6azjqNXS" ascii wide
        $rsakey = "<RSAKeyValue><Modulus>33h27lNoiA3zNWAsHEGmprf6ztXszThFMSmvh3QFh72trcyHyBZT9XccFtVcUxqH2yGW1Ary7vgjmEmkZqtYfU8S/lVOD7DxKVJlqqIxJjuVuJo0QHowCyUv0FJVQuPv7XcZAaOuuBoubgMAXv6H5J8EQ0Sw7SU7QsuZyqZv0tAXxVan1dXXa8MAjsw0d4BeZ2RAmj0hmZQI85yGyOykvggKw+ut6gL2kRGPmZnIP/Ydhnvvwnv/WFi1cymMcQsJsJ2NdWSH7oRkECoxFnxpqIcKcVxVTCXQRj2uXiiWMRGpJp0vP2uO1E7qhx64/2rAp6R5TacakBpps0OKZpu8jw==</Modulus><Exponent>AQAB</Exponent></RSAKeyValue>" ascii wide
    condition:
        any of them
}

rule CrowdStrike_MacRansom_01 : macransom ransomware mac 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "MacRansom ransomware string deobfuscation routine"
        version = "201706220000"
        last_modified = "2017-06-22"
        malware_family = "MacRansom"
    strings:
        // Mach-O Headers
        $feedfacf = { cf fa ed fe }
        $feedface = { ce fa ed fe }
        $cafebabe = { ca fe ba be }
        $str_deobf = { 48 b9 00 00 00 00 f? ff ff ff 48 01 c1 48 c1 f9 20 80 3c 0b ?? 0f 85 }
    condition:
        ($feedfacf at 0 or $feedface at 0 or $cafebabe at 0) and #str_deobf > 4
}

rule CrowdStrike_MacSpy_01 : macspy rat mac 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "MacSpy malware strings and plist autostart entry"
        version = "201809251139"
        last_modified = "2018-09-25"
        malware_family = "MacSpy"
    strings:
        // Mach-O Headers
        $feedfacf = { cf fa ed fe }
        $feedface = { ce fa ed fe }
        $cafebabe = { ca fe ba be }
        // Matches
        $q = { 71 3? 09 00 }
        $v = { 76 3? 09 00 }
        $i = { 69 3? 09 00 }
        $f = { 66 3? 09 00 }
        // <key>RunAtLoad</key>\r\0\t\t<true/>
        $runatload = { 3c 6b 65 79 3e 52 75 6e 41 74 4c 6f 61 64 3c 2f 6b 65 79 3e 0a 00 09 09 3c 74 72 75 65 2f 3e }
    condition:
        ($feedfacf at 0 or $feedface at 0 or $cafebabe at 0) and $runatload and #q > 2 and #v > 2 and #i > 2 and #f > 2
}

rule CrowdStrike_CSIT_17104_02 : poseidon pos_scraper unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "PoSeidon POSNumBot (unpacked)"
        reports = "CSIT-17104"
        version = "201807271505"
        last_modified = "2018-07-27"
        malware_family = "PoSeidon"
    strings:
        // Strings used for C2 communication
        $a = "oprat=2&uid=%I64u&uinfo=%s&win=%d.%d&vers=%s"
        $b = "&data="
        $c = "&logs="
    condition:
        all of them
}

rule CrowdStrike_CSIT_17109_02 : notpetya wiper ransomware 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "NotPetya wiper/ransomware encoded components"
        reports = "CSA-17159,CSIT-17109"
        version = "201807201209"
        last_modified = "2018-07-20"
        malware_family = "NotPetya"
    strings:
        $hdr_10010BB8 = { 2c ed 84 02 e7 80 94 25 33 25 32 25 31 25 30 37 }
        $hdr_100123B0 = { fd 0c 8c 5c b8 c4 24 c5 cc cc cc 0e e8 cc 24 6b }
        $hdr_10012D27 = { 45 20 8d 93 8d 92 8d 91 8d 90 92 93 91 97 0f 9f }
        $hdr_100131A8 = { fd 0c 8c 5c c3 48 5c ca cc cc 24 cc cc cc cc 94 }
    condition:
        all of them
}

rule CrowdStrike_CSIT_17118_01 : bokbot trojan unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "BokBot banking trojan, unpacked sample"
        reports = "CSIT-17118"
        version = "201807300935"
        last_modified = "2018-07-30"
        malware_family = "BokBot"
    strings:
        $instr1 = { 8b 45 f4 c1 e8 03 8b 4d f4 c1 e1 1d 0b c1 89 45 f4 0f b7 45 fc 03 45 f4 89 45 f4 0f b7 45 fc 8b 4d 08 0f b6 04 01 0f b6 4d f4 33 c1 0f b7 4d fc 8b 55 0c 88 04 0a }
        $instr2 = { 8b 4d f8 33 4d f4 8b d1 89 0d 38 89 41 00 c1 ea 18 8b c1 c1 e8 10 02 d0 c1 e9 08 02 d1 02 15 3f 89 41 00 02 15 38 89 41 00 02 15 3c 89 41 00 02 15 3d 89 41 00 02 15 3e 89 41 00 88 15 40 89 41 00 85 f6 74 08 f6 d2 88 15 40 89 41 00 }
        $s1 = "&%c=%u"
        $s2 = "\\%0.8X.tmp"
        $s3 = "%s|%s|%s"
        $s4 = "Default%u"
        $s5 = "HTTP/1.1 502 Bad Gateway"
        $s6 = "front://"
        $s7 = "IsImmersiveProcess"
    condition:
        1 of ($instr*) and 4 of ($s*)
}

rule CrowdStrike_CSIT_17101_01 : mustang_panda delivery_document exploit cve_2017_0199 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "RTF exploiting CVE-2017-0199 downloading .gif file"
        reports = "CSIT-17101"
        version = "201706280000"
        last_modified = "2017-06-28"
        actor = "MUSTANG PANDA"
    strings:
        $rtf_magic = "{\\rtf1"
        $objdata = "objdata 0105000002000000" nocase
        $url = "E0C9EA79F9BACE118C8200AA004BA90B" nocase
        // Matches on hex encoded "/1.gif" ... "/13.gif"
        $gif_1 = "2F0031002E00670069006600" nocase
        $gif_2 = "2F0032002E00670069006600" nocase
        $gif_3 = "2F0033002E00670069006600" nocase
        $gif_4 = "2F0034002E00670069006600" nocase
        $gif_5 = "2F0035002E00670069006600" nocase
        $gif_6 = "2F0036002E00670069006600" nocase
        $gif_7 = "2F0037002E00670069006600" nocase
        $gif_8 = "2F0038002E00670069006600" nocase
        $gif_9 = "2F0039002E00670069006600" nocase
        $gif_10 = "2F00310030002E00670069006600" nocase
        $gif_11 = "2F00310031002E00670069006600" nocase
        $gif_12 = "2F00310032002E00670069006600" nocase
        $gif_13 = "2F00310033002E00670069006600" nocase
    condition:
        $rtf_magic at 0 and $objdata and $url and any of ($gif_*)
}

rule CrowdStrike_CSIT_17101_02 : vbscript 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Matches small encoded VB scripts sometimes delivered as HTAs"
        reports = "CSIT-17101"
        version = "201706280000"
        last_modified = "2017-06-28"
        actor = "MUSTANG PANDA, other unknown"
    strings:
        $encoded_vb1 = "#@~^"
        $encoded_vb2 = "==^#~@"
        $script_tag = "<script language=\"VBScript.Encode\">"
    condition:
        all of ($encoded_*) and (uint16(0) != 0x5A4D) and $script_tag and filesize < 5KB
}

rule CrowdStrike_CSIT_17101_03 : vbscript 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Matches small obfuscated VB scripts sometimes delivered as HTAs"
        reports = "CSIT-17101"
        version = "201706280000"
        last_modified = "2017-06-28"
        actor = "MUSTANG PANDA, other unknown"
    strings:
        $chr = "chr" nocase
        $script_tag = "<script language=\"VBScript\">"
    condition:
        #chr > 100 and (uint16(0) != 0x5A4D) and $script_tag and filesize < 5KB
}

rule CrowdStrike_CSIT_17095_01 : swc javascript 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Malicious JavaScript installed on web servers to redirect visitors to SWC landing pages"
        reports = "CSIT-17095"
        version = "201706300000"
        last_modified = "2017-06-30"
    strings:
        $ = "InjectionType"
        $ = "InjectionString"
        $ = "execute_request"
        $ = "analyze_traffic"
        $ = "apply_payload"
        $ = "init_xhr"
        $ = "REMOTE_URL"
        $ = "C_TIMEOUT"
    condition:
        6 of them
}

rule CrowdStrike_CSIT_17114_01 : helix_kitten delivery_document exploit cve_2017_0199 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Document exploiting CVE-2017-0199 to install Helminth"
        reports = "CSIT-17114"
        version = "201706300000"
        last_modified = "2017-06-30"
        actor = "HELIX KITTEN"
    strings:
        $rtf_header = "{\\rtf1"
        $object_header = "objdata 0105000002000000"
        $urlmoniker_uuid = "e0c9ea79f9bace118c8200aa004ba90b"
        $http = "68007400740070003a002f002f"
        $test_num_hta = /2f00[\r\n]{0,2}7400[\r\n]{0,2}6500[\r\n]{0,2}7300[\r\n]{0,2}7400[\r\n]{0,2}[0-9]{0,6}[\r\n]{0,2}2e00[\r\n]{0,2}6800[\r\n]{0,2}7400[\r\n]{0,2}61/
    condition:
        $rtf_header at 0 and all of ($object_header, $urlmoniker_uuid, $http, $test_num_hta)
}

rule CrowdStrike_CSIT_17114_02 : helix_kitten helminth dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Base64 encoded start of Helminth installer inside office document"
        reports = "CSIT-17114"
        version = "201706300000"
        last_modified = "2017-06-30"
        actor = "HELIX KITTEN"
        malware_family = "Helminth"
    strings:
        $docmagic = { d0 cf 11 e0 a1 b1 1a e1 }
        $rtfmagic = "{\\rtf"
        $public_path = "JGhvbWVfZGlyID0gJEVudjpQdWJsaWMrIlxMaWJyYXJpZXNcUmVjb3JkZWRUVlwiOw"
    condition:
        ($docmagic or $rtfmagic) and $public_path
}

rule CrowdStrike_CSIT_17114_03 : helix_kitten helminth dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Helminth installer"
        reports = "CSIT-17114"
        version = "201706300000"
        last_modified = "2017-06-30"
        actor = "HELIX KITTEN"
        malware_family = "Helminth"
    strings:
        $home_dir = "$home_dir = $Env:Public+\"\\Libraries\\RecordedTV\\\";"
        $template = "-Replace ('__'+$i+'__'),(((65..90)+(97..122)|Get-Random|%{[char]$_})+(Get-Random));"
        $load = "[System.Text.Encoding]::UTF8.GetString([System.Convert]::FromBase64String("
        $store = "&{iex ''powershell -encodedcommand '+([System.Convert]::ToBase64String([System.Text.Encoding]::Unicode.GetBytes("
        $persist = "schtasks /create /F /sc minute /mo 3 /tn"
    condition:
        all of them
}

rule CrowdStrike_CSIT_17095_02 : notpetya ransomware wiper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Hashed avp.exe process name featured in several NotPetya variants"
        reports = "CSIT-17095"
        version = "201707060000"
        last_modified = "2017-07-06"
        malware_family = "NotPetya"
    strings:
        $ = { c7 45 f8 78 56 34 12 }
        $ = { 81 7d f8 44 4b 21 2e }
    condition:
        all of them
}

rule CrowdStrike_CSIT_17095_03 : notpetya ransomware wiper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Encrypted MBR fragments included in standalone version of NotPetya likely delivered through SWC campaigns"
        reports = "CSIT-17095"
        version = "201707060000"
        last_modified = "2017-07-06"
        malware_family = "NotPetya"
    strings:
        $ = { 5f 23 e3 ba 63 24 49 06 e5 05 37 99 a9 b6 a2 84
        01 3c 80 c4 2e 74 8d a5 67 62 fa 1e 2d 0b 51 c6 }
        $ = { f7 c6 d7 e8 61 50 3f 2e b7 2e b6 3f 03 7a f1 69
        b5 69 ad f1 10 cb 87 43 a5 43 65 87 78 56 61 b8 }
    condition:
        all of them
}

rule CrowdStrike_CSIT_17103_02 : fakecry ransomware 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Fake .NET WannaCry imposter - encryption module"
        reports = "CSIT-17103"
        version = "201707070000"
        last_modified = "2017-07-07"
        malware_family = "FakeCry"
    strings:
        // Generic .NET identification
        $a = "_CorExeMain"
        $b = "mscoree.dll"
        // Command switches
        $c = "-delshadowcopies" wide
        $d = "-index" wide
        $e = "-genrsa" wide
        // Index file name
        $f = "_drive.index" wide
        // CMD for shadow file deletion
        $g = "/c vssadmin delete shadows /all /quiet & wmic shadowcopy delete & bcdedit /set {default} bootstatuspolicy ignoreallfailures & bcdedit /set {default} recoveryenabled no & wbadmin delete catalog" wide
        // File metadata and pdb
        $h = "ed.exe" fullword
        $i = "C:\\Users\\Developer\\Desktop\\WannaCry\\ed\\obj\\Release\\ed.pdb"
        // Call to SysInternals handle tool
        $j = "handle.exe" wide
    condition:
        all of them
}

rule CrowdStrike_CSIT_17103_03 : fakecry ransomware 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Fake .NET WannaCry imposter - decryption module"
        reports = "CSIT-17103"
        version = "201707070000"
        last_modified = "2017-07-07"
        malware_family = "FakeCry"
    strings:
        // Generic .NET identification
        $a = "_CorExeMain"
        $b = "mscoree.dll"
        // Dropped file names
        $c = "@WanaDecryptor@.exe" wide
        $d = "@Please_Read_Me@.txt" wide
        // TOR onion ULRs
        $e = "http://4gxdnocmhl2tzx3z.onion/" wide
        $f = "http://4gxdnocmhl2tzx3z.onion/?guid={0}&transId={1}&key={2}" wide
        $g = "http://4gxdnocmhl2tzx3z.onion/?guid={0}&msg={1}" wide
        // Registry strings
        $h = "Software\\WC" wide
        $i = "Prx" wide fullword
        $j = "Cred" wide fullword
        $k = "private_key" wide
        $l = "wc_path" wide
        $m = "private_key_encrypted" wide
        // File metadata and pdb
        $n = "wg.exe" fullword
        $o = "C:\\Users\\Developer\\Desktop\\WannaCry\\wg\\obj\\Release\\wg.pdb"
    condition:
        all of them
}

rule CrowdStrike_CSIT_17103_04 : fakecry ransomware 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Fake .NET WannaCry imposter - TOR module"
        reports = "CSIT-17103"
        version = "201707070000"
        last_modified = "2017-07-07"
        malware_family = "FakeCry"
    strings:
        // Generic .NET identification
        $a = "_CorExeMain"
        $b = "mscoree.dll"
        // HTTP header
        $c = "GET {0} HTTP/1.1" wide
        $d = "Host: {1}" wide
        $e = "Connection: keep-alive" wide
        $f = "Accept: text/html" wide
        $g = "User-Agent: Mozilla / 5.0(Windows NT 6.1; WOW64) AppleWebKit / 535.2(KHTML, like Gecko) Chrome / 15.0.874.121 Safari / 535.2" wide
        $h = "Content-Length: 0" wide
        // TOR components
        $i = "unzip.exe" wide
        $j = "-o tor.zip" wide
        $k = "tor.exe" wide
        $l = "torrc.txt" wide
        $m = "libeay32.dll" wide
        $n = "libevent_core-2-0-5.dll" wide
        $o = "libevent_extra-2-0-5.dll" wide
        $p = "libevent-2-0-5.dll" wide
        $q = "libgcc_s_sjlj-1.dll" wide
        $r = "libssp-0.dll" wide
        $s = "ssleay32.dll" wide
        $t = "zlib1.dll" wide
        // File metadata and pdb
        $u = "tg.exe" fullword
        $v = "C:\\Users\\Developer\\Desktop\\WannaCry\\tg\\obj\\Release\\tg.pdb"
    condition:
        all of them
}

rule CrowdStrike_CSIT_17112_01 : zloader trojan 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Zloader"
        reports = "CSIT-17112"
        version = "201807300937"
        last_modified = "2018-07-30"
        malware_family = "Zloader"
    strings:
        $shellcode = { ba ?? ?? ?? ?? b9 ?? ?? ?? ?? b8 ?? ?? ?? ?? 33
        db 8b f0 30 16 c1 c2 08 46 42 90 43 e2 f5 b8 ??
        ?? ?? ?? 50 b8 ?? ?? ?? ?? ff d0 }
        $static_config_key_unobfuscated = { e8 ?? ?? ?? 00 68 23 af 29 30 (56 | 57) }
        $static_config_key_obfuscated = { c7 44 24 08 23 af 29 30 c7 44 24 04}
        $base_config = "{BASECONFIG}"
        $path_to_exe = "{PATH_TO_EXE}"
    condition:
        any of them and filesize < 1MB
}

rule CrowdStrike_CSIT_17097_01
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Suspicious M.E.Doc software update - maliciousness of payload must be determined by additional analysis."
        reports = "CSIT-17097"
        version = "201707090000"
        last_modified = "2017-07-09"
    strings:
        $ = { 50 41 54 43 48 09 00 00 00 50 41 54 43 48 48 45
        41 44 0a 00 00 00 53 52 43 56 45 52 53 49 4f 4e }
        $ = { 00 09 00 00 00 50 41 54 43 48 42 4f 44 59 50 41
        43 4b 45 44 5f 46 49 4c 45 00 }
        $ = "ZvitPublishedObjects.dll"
    condition:
        all of them
}

rule CrowdStrike_CSIT_17097_02 : backdoor 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Malicious M.E.Doc software update, backdoored DLL"
        reports = "CSIT-17097"
        version = "201707090000"
        last_modified = "2017-07-09"
    strings:
        $ = "ZvitPublishedObjects"
        $ = "Cmds"
        $ = "Compression"
        $ = "Crypto"
        $ = "GetIV"
        $ = "Worker"
    condition:
        // PE binary
        uint16(0) == 0x5A4D and uint32(uint32(0x3c)) == 0x4550 and
        // Mono/.NET 32bit
        ((uint16(uint32(0x3c)+24) == 0x010b and uint32(uint32(0x3c)+232) > 0) or
        // Mono/.NET 64bit
        (uint16(uint32(0x3c)+24) == 0x020b and uint32(uint32(0x3c)+248) > 0))
        and all of them
}

rule CrowdStrike_CSIT_17122_01 : matrix trojan 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Matrix banking trojan strings"
        reports = "CSIT-17122"
        version = "201807300915"
        last_modified = "2018-07-30"
        malware_family = "Matrix"
    strings:
        $targeturl = "targeturl="
        $rule1 = "rule1:"
        $rule2 = "rule2:"
        $ua = "Mozilla/5.0 (Windows NT 6.3; Trident/7.0; rv:11.0) like Gecko"
        $reflectiveloader = "ReflectiveLoader"
        $inject = "[INJECT] inject_via_remotethread"
        $binary = "BINARY"
        $service = "GITSecureService"
    condition:
        6 of them
}

rule CrowdStrike_CSIT_17125_01 : hanarat judgement_panda judgment_panda rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detection for HanaRat malware"
        reports = "CSIT-17125"
        version = "202010071929"
        last_modified = "2020-10-07"
        malware_family = "HanaRAT"
    strings:
        $ctcp_ctor_log = "[>]CTCP:CTCP()"
        $protocol_log = "[CreateProtocol]:ip:%s,port:%d"
        $classname1 = "CHandShake"
        $classname2 = "CHeartBeat"
        $classname3 = "CFileManager"
    condition:
        $ctcp_ctor_log and $protocol_log and 1 of ($classname*)
}

rule CrowdStrike_CSIT_17125_02 : dropper hanarat kandropper webshell 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detection for KanDropper, used to deploy HanaRAT"
        reports = "CSIT-17125"
        version = "202010071930"
        last_modified = "2020-10-07"
        malware_family = "KanDropper"
    strings:
        $rc4_1 = { 4e 81 ce 00 ff ff ff 46 }
        $rc4_2 = { 8a 1c 10 0f b6 cb 03 f1 81 e6 ff 00 00 80 }
        $key_read = { 6a 02 6a 00 6a f5 }
        $data_read = { 6a 02 6a 00 6a f1 56 ff d7 6a 00 }
    condition:
        all of them
}

rule CrowdStrike_CSIT_17102_01 : stardust_chollima wannacry ransomware 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "WannaCry ransomware, XorBuffer routine"
        reports = "CSIT-17102"
        version = "201707180000"
        last_modified = "2017-07-18"
        actor = "STARDUST CHOLLIMA"
        malware = "WannaCry"
    strings:
        $xorbuffer = { 8b 44 24 1? 8a 4? 26 [0-2] 6a 1e [6-9] 8a
        5? 26 ?? ?? 13 8d 4? 0? 50 [2-4] (ff 15 | e8)
        ?? ?? ?? ?? [0-4] 83 c4 0c 4? [0-3] 3b [1-6]
        7c ?? [0-1] 5b 5f 5e c2 08 00 }
    condition:
        $xorbuffer
}

rule CrowdStrike_CSIT_17102_03 : artifact key stardust_chollima wannacry 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "WannaCry ransomware, encrypted file header"
        reports = "CSIT-17102"
        version = "201903071214"
        last_modified = "2019-03-07"
        actor = "STARDUST CHOLLIMA"
        malware = "WannaCry"
    strings:
        // February 2017 variant, RSA public key
        $RsaPubKey_Feb2017 = {
        06 02 00 00 00 a4 00 00 52 53 41 31 00 08 00 00
        01 00 01 00 9d 7a e4 c7 db 3b dd 16 6c 4e 32 d7
        56 61 f6 6c 17 4a a5 41 d1 84 97 6a 12 58 30 ab
        be 34 e5 f2 80 5f 4a be a9 a5 a9 bb 4a fe cf 6f
        08 5a 53 61 c5 23 2c 44 92 e3 87 4e 00 af 50 5d
        43 65 3f 5e 7c 4c cc fc 81 3f 0b f7 41 31 8b c3
        5b 7b f5 81 02 bf 0a c0 d8 6d 42 67 97 b5 20 98
        16 9d de 9c 9b 50 06 a9 60 c8 9a f6 0f f9 36 ee
        10 ec fe be 8b e5 19 63 5b 17 23 36 0e 58 a9 34
        0e aa b8 08 b0 a7 d6 b3 14 e1 b3 b8 8c b5 55 4c
        b6 66 91 93 b5 de 32 8f 0b 11 c9 27 e3 0a 7d b2
        8c e5 5d 86 d4 ad 93 92 87 9e 96 11 e3 cb cc 7b
        78 21 e6 f3 ee 55 22 ec 4f c6 76 66 a8 df 8f 16
        3a 0c 6c 0c 75 76 1b b3 72 5b 79 17 02 bc 38 e7
        ad a0 6c ed c3 ef 9d 9b 42 99 fc 44 80 57 29 6e
        f2 62 b7 30 f8 8d be a7 89 bf c6 eb 58 5d 53 7a
        ae f4 79 65 3d 30 fe d2 86 79 22 52 f0 77 39 4a
        0b d6 0f d0 }
        // March 2017 variant, RSA private key
        $RsaPrivKey_Mar2017 = {
        07 02 00 00 00 a4 00 00 52 53 41 32 00 08 00 00
        01 00 01 00 f1 70 52 a8 ea 9d c0 e2 48 e8 23 43
        80 5d 4b 81 e9 5f 5f 39 5f 8d 69 f8 0e 81 be 21
        22 08 9b 18 5c 07 28 5a 2a 88 65 a0 40 94 60 84
        c3 b9 87 bd d2 74 33 dc fd 02 c5 70 86 c0 e0 7a
        14 fc 46 62 82 32 08 d2 57 17 d5 f4 5e 47 c5 dc
        08 28 7d 3a 36 64 2a 4c c7 94 d0 8c b8 d7 ea e9
        da 1e 45 f7 cc 4f 7c f6 f2 f9 3c c6 61 d5 cc 1a
        c9 68 10 38 a5 03 0e 61 b8 0c b1 1c 53 35 11 fa
        b2 75 82 e4 b9 03 e6 fe cb 9e 7f d5 bc 55 a5 9c
        65 80 f3 a9 71 af 60 9b d1 10 ab 78 92 a2 05 b9
        35 c5 b9 08 97 50 03 e1 da 9f 18 35 c5 2f 49 d5
        4d 14 f4 6f d5 c8 6a ba e9 00 ff 42 96 44 d9 d4
        0d f7 70 20 05 80 58 7d f6 47 e7 96 7a 09 3c 52
        96 2b 2d 38 6d 96 32 5e f2 86 58 7c b3 2a 9b 9d
        20 78 f4 d9 2a 02 37 cd 0b 9d db eb fe f1 18 37
        97 0a a6 81 ee dc 0b 79 b7 ed f6 f6 f4 f4 88 92
        79 eb 1e df c7 05 b7 ed 01 ce 41 a6 f4 da 43 6d
        57 a4 00 be d5 eb dd 45 c8 ab 72 9a 5a 73 04 a8
        26 bd 1b 32 da 61 60 28 1c 90 b4 9d e2 5b 04 52
        94 ad da 83 43 59 7c 07 d9 e6 8f d2 31 02 c1 e0
        63 cc a7 b5 af 88 07 88 12 b3 42 76 da e1 fe dd
        c0 f4 30 37 d7 5c 3a 61 d0 8a fb 57 7e 21 7b 57
        56 17 c1 2c 63 5d ae 7b fb b2 f6 a4 a4 56 42 d0
        e6 d8 e6 6f 9f b6 d2 5b 1e 08 29 4b b1 15 9f 85
        c2 d2 16 f9 87 73 1a 89 19 da 42 c5 58 e7 13 7a
        f8 f8 68 b5 9b 83 aa d0 d4 2f 82 90 2a 00 b8 60
        a9 73 29 20 af ba c3 91 60 ef 0a bc 19 1e 15 aa
        84 e2 d6 f5 96 ba f5 00 a2 d5 0e 09 54 10 8d 22
        a6 02 ae af de 7d 19 84 e6 bd 84 23 ca 76 0e e0
        3f 15 5a 6f 15 63 2a 51 af 69 f3 c1 ca 66 73 47
        e2 93 ab 1d ce 40 e0 e0 9c 6a 1f 3e 6d bc da 41
        11 58 b1 2c 69 6a 01 68 3b 90 32 65 05 ee b1 8a
        6b a7 4f e5 e3 af c8 89 6b fb 0a bb 53 cf 63 cc
        69 d0 70 d2 be c3 e9 eb 29 63 a2 82 82 e3 33 f8
        13 eb b2 27 e6 04 3d d8 44 88 c0 f7 c3 67 1e 4c
        c6 e6 a9 4e 0a e0 0f 85 c9 98 01 65 01 28 64 fc
        17 6d 9f bb ca 09 14 50 57 cd 2c ae cf 3d 0b 22
        af fc 05 59 fc 86 7b fc e2 61 b2 c0 6c 3d b3 75
        bc 45 53 f6 bd 16 78 0f 0a 9e 60 22 5a 12 32 91
        c3 e4 3b 86 9d f6 63 9e 2d 76 b2 9c e0 80 11 7d
        ac 95 ac e7 97 74 91 eb ea b9 c2 af b4 dd c3 02
        5c db a7 33 dd 0b 32 c4 3a 8f 4d db bd 3d 4c 5e
        14 21 da 9e 29 81 81 a0 d8 05 69 fc bb 62 dd b1
        57 48 5e c2 4e 17 b4 63 06 0b ad e4 60 66 15 66
        51 ef 4c 64 93 3f 22 7b fe bc a3 5e b0 99 af 6c
        fb 88 57 db cd 2c ed 81 ec 09 fe 0d b3 9d 7c a2
        76 2e 5d 5a de 88 8f b0 49 dd 51 0c 7d c2 6a 57
        fe 96 7c 1c 85 75 92 4c a9 05 0c 17 38 f2 04 af
        a6 99 7f 61 bb 5c ad ff c5 96 1e 6f 25 4e 3f ad
        bc 3a df f9 d3 cc 1e 98 16 31 57 0c bb de e2 58
        d0 c5 f9 aa b1 12 c7 73 bd 86 af cc 8a 08 b5 18
        a4 56 98 45 0d a9 f6 99 b5 90 8a 54 68 2a 35 5c
        3e 5a 9b 0f 94 34 11 f4 94 26 98 b8 f6 04 54 85
        ea d8 77 a3 55 b5 de 6a 93 ef 31 eb 1b cb c1 48
        eb c9 f4 1a c7 c6 cc 36 99 07 cb 3b 66 48 34 2f
        95 be a3 16 15 3f 2a cf 71 88 71 dd 6e 2f 7b 2c
        60 69 ee 8e a9 3f 3e 52 1b b5 38 84 ad 0e 9f 4d
        28 93 3d 1b 5a 11 8b 1f b2 bc e1 8c e0 e4 2b 40
        fd 8e 32 ec fd db be 11 cc d2 10 8d 14 6b 6e b6
        f1 3e 82 69 6e 59 38 55 2b f1 67 12 6f 33 0a 0c
        31 96 56 ca e9 98 e9 b5 6b 11 f9 49 31 ab 80 be
        a1 35 a6 6a a5 fc 12 0b 87 9c 57 8e 95 86 c5 33
        2c 58 cc 9f a3 92 73 65 db a4 ad e4 72 26 bd 1c
        3e 70 9d e1 29 b4 22 85 26 a7 e4 1e b8 34 60 01
        87 43 8a b1 34 3e 4c e7 3a fc ed 01 27 97 b5 e5
        ef b4 bc e4 6e 52 b6 eb ae 04 59 ce e2 85 09 7e
        a6 12 8e ec 0a 5e f9 4e a6 82 7b 63 f9 4c f7 42
        0e 41 3e 0e 09 3c 06 a8 2f d6 9e 8b b8 64 73 c7
        fe 73 2e 5e 32 85 eb c1 47 e8 65 e5 a2 81 19 b9
        e1 6f 7d 13 90 94 13 3b 52 de fe 0f 7a cc 69 47
        24 8f 73 15 13 0b a3 8e c8 ae 6a fb bd e8 9e bf
        02 f7 2e 27 f3 82 31 15 1d 06 8e 3d 03 fb 3c 13
        b0 9a a7 26 }
        // April 2017 variant, RSA private key
        $RsaPrivKey_Apr2017 = {
        07 02 00 00 00 a4 00 00 52 53 41 32 00 08 00 00
        01 00 01 00 f1 70 52 a8 ea 9d c0 e2 48 e8 23 43
        80 5d 4b 81 e9 5f 5f 39 5f 8d 69 f8 0e 81 be 21
        22 08 9b 18 5c 07 28 5a 2a 88 65 a0 40 94 60 84
        c3 b9 87 bd d2 74 33 dc fd 02 c5 70 86 c0 e0 7a
        14 fc 46 62 82 32 08 d2 57 17 d5 f4 5e 47 c5 dc
        08 28 7d 3a 36 64 2a 4c c7 94 d0 8c b8 d7 ea e9
        da 1e 45 f7 cc 4f 7c f6 f2 f9 3c c6 61 d5 cc 1a
        c9 68 10 38 a5 03 0e 61 b8 0c b1 1c 53 35 11 fa
        b2 75 82 e4 b9 03 e6 fe cb 9e 7f d5 bc 55 a5 9c
        65 80 f3 a9 71 af 60 9b d1 10 ab 78 92 a2 05 b9
        35 c5 b9 08 97 50 03 e1 da 9f 18 35 c5 2f 49 d5
        4d 14 f4 6f d5 c8 6a ba e9 00 ff 42 96 44 d9 d4
        0d f7 70 20 05 80 58 7d f6 47 e7 96 7a 09 3c 52
        96 2b 2d 38 6d 96 32 5e f2 86 58 7c b3 2a 9b 9d
        20 78 f4 d9 2a 02 37 cd 0b 9d db eb fe f1 18 37
        97 0a a6 81 ee dc 0b 79 b7 ed f6 f6 f4 f4 88 92
        79 eb 1e df c7 05 b7 ed 01 ce 41 a6 f4 da 43 6d
        57 a4 00 be d5 eb dd 45 c8 ab 72 9a 5a 73 04 a8
        26 bd 1b 32 da 61 60 28 1c 90 b4 9d e2 5b 04 52
        94 ad da 83 43 59 7c 07 d9 e6 8f d2 31 02 c1 e0
        63 cc a7 b5 af 88 07 88 12 b3 42 76 da e1 fe dd
        c0 f4 30 37 d7 5c 3a 61 d0 8a fb 57 7e 21 7b 57
        56 17 c1 2c 63 5d ae 7b fb b2 f6 a4 a4 56 42 d0
        e6 d8 e6 6f 9f b6 d2 5b 1e 08 29 4b b1 15 9f 85
        c2 d2 16 f9 87 73 1a 89 19 da 42 c5 58 e7 13 7a
        f8 f8 68 b5 9b 83 aa d0 d4 2f 82 90 2a 00 b8 60
        a9 73 29 20 af ba c3 91 60 ef 0a bc 19 1e 15 aa
        84 e2 d6 f5 96 ba f5 00 a2 d5 0e 09 54 10 8d 22
        a6 02 ae af de 7d 19 84 e6 bd 84 23 ca 76 0e e0
        3f 15 5a 6f 15 63 2a 51 af 69 f3 c1 ca 66 73 47
        e2 93 ab 1d ce 40 e0 e0 9c 6a 1f 3e 6d bc da 41
        11 58 b1 2c 69 6a 01 68 3b 90 32 65 05 ee b1 8a
        6b a7 4f e5 e3 af c8 89 6b fb 0a bb 53 cf 63 cc
        69 d0 70 d2 be c3 e9 eb 29 63 a2 82 82 e3 33 f8
        13 eb b2 27 e6 04 3d d8 44 88 c0 f7 c3 67 1e 4c
        c6 e6 a9 4e 0a e0 0f 85 c9 98 01 65 01 28 64 fc
        17 6d 9f bb ca 09 14 50 57 cd 2c ae cf 3d 0b 22
        af fc 05 59 fc 86 7b fc e2 61 b2 c0 6c 3d b3 75
        bc 45 53 f6 bd 16 78 0f 0a 9e 60 22 5a 12 32 91
        c3 e4 3b 86 9d f6 63 9e 2d 76 b2 9c e0 80 11 7d
        ac 95 ac e7 97 74 91 eb ea b9 c2 af b4 dd c3 02
        5c db a7 33 dd 0b 32 c4 3a 8f 4d db bd 3d 4c 5e
        14 21 da 9e 29 81 81 a0 d8 05 69 fc bb 62 dd b1
        57 48 5e c2 4e 17 b4 63 06 0b ad e4 60 66 15 66
        51 ef 4c 64 93 3f 22 7b fe bc a3 5e b0 99 af 6c
        fb 88 57 db cd 2c ed 81 ec 09 fe 0d b3 9d 7c a2
        76 2e 5d 5a de 88 8f b0 49 dd 51 0c 7d c2 6a 57
        fe 96 7c 1c 85 75 92 4c a9 05 0c 17 38 f2 04 af
        a6 99 7f 61 bb 5c ad ff c5 96 1e 6f 25 4e 3f ad
        bc 3a df f9 d3 cc 1e 98 16 31 57 0c bb de e2 58
        d0 c5 f9 aa b1 12 c7 73 bd 86 af cc 8a 08 b5 18
        a4 56 98 45 0d a9 f6 99 b5 90 8a 54 68 2a 35 5c
        3e 5a 9b 0f 94 34 11 f4 94 26 98 b8 f6 04 54 85
        ea d8 77 a3 55 b5 de 6a 93 ef 31 eb 1b cb c1 48
        eb c9 f4 1a c7 c6 cc 36 99 07 cb 3b 66 48 34 2f
        95 be a3 16 15 3f 2a cf 71 88 71 dd 6e 2f 7b 2c
        60 69 ee 8e a9 3f 3e 52 1b b5 38 84 ad 0e 9f 4d
        28 93 3d 1b 5a 11 8b 1f b2 bc e1 8c e0 e4 2b 40
        fd 8e 32 ec fd db be 11 cc d2 10 8d 14 6b 6e b6
        f1 3e 82 69 6e 59 38 55 2b f1 67 12 6f 33 0a 0c
        31 96 56 ca e9 98 e9 b5 6b 11 f9 49 31 ab 80 be
        a1 35 a6 6a a5 fc 12 0b 87 9c 57 8e 95 86 c5 33
        2c 58 cc 9f a3 92 73 65 db a4 ad e4 72 26 bd 1c
        3e 70 9d e1 29 b4 22 85 26 a7 e4 1e b8 34 60 01
        87 43 8a b1 34 3e 4c e7 3a fc ed 01 27 97 b5 e5
        ef b4 bc e4 6e 52 b6 eb ae 04 59 ce e2 85 09 7e
        a6 12 8e ec 0a 5e f9 4e a6 82 7b 63 f9 4c f7 42
        0e 41 3e 0e 09 3c 06 a8 2f d6 9e 8b b8 64 73 c7
        fe 73 2e 5e 32 85 eb c1 47 e8 65 e5 a2 81 19 b9
        e1 6f 7d 13 90 94 13 3b 52 de fe 0f 7a cc 69 47
        24 8f 73 15 13 0b a3 8e c8 ae 6a fb bd e8 9e bf
        02 f7 2e 27 f3 82 31 15 1d 06 8e 3d 03 fb 3c 13
        b0 9a a7 26 }
        // May 2017 variant, RSA private key
        $RsaPrivKey_May2017 = {
        07 02 00 00 00 a4 00 00 52 53 41 32 00 08 00 00
        01 00 01 00 43 2b 4d 2b 04 9c 0a d9 9f 1e da 5f
        ed 32 a9 ef e1 ce 1a 50 f4 15 e7 51 7b ec b0 27
        56 05 58 b4 f6 83 c9 b6 77 5b 80 61 18 1c ab 14
        d5 6a fd 3b 70 9d 13 3f 2e 21 13 f1 e7 af e3 fb
        ab 6e 43 71 25 6d 1d 52 d6 05 5f 13 27 9e 28 89
        f6 ca 90 93 0a 68 c4 de 82 9b aa c2 82 02 b1 18
        60 01 63 1b bc 71 8d be 64 88 5e d5 0d 6c c1 9c
        c9 01 36 89 c9 80 37 8f 1d 89 67 4f 0c b1 3c 61
        09 3a 02 5d b8 4e f5 88 0a 9f 8c 0a 86 df 91 fe
        cd 9f a3 a0 13 d3 2d 30 77 d1 f0 a8 d7 ab 96 e5
        48 96 37 03 69 64 97 06 5c 27 50 8c 91 76 67 85
        3a 6c 6a b2 59 12 0a 61 f2 a1 ee a8 24 c8 e4 b1
        11 6d d6 cc f7 8f 4c 5e b0 55 84 81 6d 60 45 84
        0f fc df f9 27 a5 52 c9 5b 06 28 a3 de 74 03 d6
        c7 72 66 dc be a4 1e ff 20 96 ed 51 84 00 cc 9c
        36 64 f2 85 4d cf 36 60 dd c8 b0 f1 91 db 7a 0b
        83 ee cf ef 19 d7 12 da ae 86 d9 f9 0e be 02 af
        78 f3 5b 49 be 0c 98 af b5 5f d6 8a 4c 05 48 64
        9c 40 e1 1c f9 3c c4 e4 42 08 2d b2 b8 8a e6 0b
        6d df 93 cc 34 e8 48 30 93 5d df 8d 2e b3 3d 35
        e4 66 30 ad 8b e7 20 3d e0 c9 d9 6c 36 4b 79 b9
        64 cd bc 5e 24 48 d4 88 90 1c 3d 17 4e 65 0c ec
        fb 1b 2b ec 5c c3 06 d6 6c 39 d8 6c 7e 23 9f 40
        af 40 61 b4 fb b1 f6 82 cd a1 26 b8 8d c8 38 8f
        94 03 4e fb bb ec 17 5e dd 46 f7 e7 fb df 25 21
        ad 35 bd 9b 1d b5 01 3f 4e b0 20 b7 23 36 79 81
        29 3c de e2 76 d7 e6 1f 9f ea 2d a5 c4 6a aa 40
        30 0d cc fe 58 e9 89 28 cb d7 e4 9c 7b b9 50 17
        a7 31 21 3b b4 91 f3 84 a6 bd 9e 03 ca e9 cd ee
        4d 2b 29 fa 02 0f e7 2c ae 30 bd 85 cc 2d 13 83
        12 53 d3 f3 41 4e f5 23 d6 ce 5f 41 cd 81 7c 3b
        f0 49 81 b8 ee 8d 35 3c ba ec 92 c7 ee cf 24 63
        01 f3 4a f4 d9 da 8b e2 c0 a4 a5 7f da 8f 3c 50
        19 ec c2 33 5a 8f ee 7b 5a e9 83 7a 96 fd 94 4b
        69 50 9a d2 34 d1 09 61 45 96 7d d8 12 5e a8 ae
        7a c0 26 a5 6f d6 e5 64 93 03 13 a3 29 6d 03 24
        f7 c2 89 e9 46 46 72 ab 54 dc d8 c7 75 0f 2d 13
        31 e7 6d 88 a1 3e a1 2d be ff db 94 d1 bd 6d e3
        c2 55 c7 ca fb 2b 63 31 17 97 42 91 93 21 dd 53
        25 1d 64 c9 95 64 d9 b5 7a 9f a3 ca e2 0f 19 66
        e4 04 b5 4d 6f 5d 33 76 1c e9 20 71 4b 22 e0 55
        5e 91 56 54 94 3c 36 3b fd fe a1 62 d0 df d3 6e
        95 8b e1 96 ce 4f 7c 78 38 2b 5e 5f 1b 8c 93 80
        5a 6d 23 6f 6d f7 19 88 f1 8c 3d 52 1b d8 ab b4
        d4 a0 88 0d ac fb 7a fa c2 35 c4 a7 a9 50 62 4a
        ac 98 9b 30 e1 59 37 51 0c 6d 28 74 ac 11 d9 70
        38 2c 35 d3 b8 d9 f1 b7 4f a1 34 36 8b 29 61 39
        35 00 70 de 73 e5 d5 1c bb 5e b8 60 b6 70 49 85
        79 65 46 7a 94 81 d6 cc 12 05 84 43 40 6d fc 77
        55 8e 45 f8 3d b9 87 a7 89 d2 59 28 ce 16 9a 53
        dc 9d 82 93 ad b1 3c b9 a6 2d aa 9d 43 ec e2 7d
        ca 32 2f 4f 2d 5f 2e 58 38 77 2e 2b 1b 0a fa fe
        79 5a 80 e1 8d 23 67 40 ff d3 d3 95 7a 14 be 93
        1b f8 ef 37 c2 ee c8 bf 59 3c 9c 5d 25 b6 44 ff
        6b 9b e9 b4 fd 59 85 ba f1 3a 01 05 f1 3e 62 0d
        7f 1f e2 81 97 66 63 90 20 bb 96 b4 cf 44 c7 7c
        7e 7d 25 2e 31 35 8b 2a 18 ab d2 41 c9 32 aa 4b
        ca ef 28 1d bf 2a 9c 1c 36 02 6b 02 0f a7 ed 10
        c0 a0 da cf 09 72 59 5b c6 3c f9 15 7f aa 22 00
        72 e0 a5 5c 79 06 6e 62 35 33 89 56 ab 5f f1 fd
        93 62 4e 81 1e 3d fc 05 69 a4 2f 51 1b e2 c8 0e
        a6 86 a2 bf 9d a4 9c b3 dc 89 b3 e3 b0 f0 d7 60
        d6 6c de 69 1e c9 b0 02 85 96 d7 35 86 36 16 5b
        e6 05 e1 f9 0b ed 25 80 e0 0a 04 c5 96 5d 34 6c
        4c f0 e0 c7 b7 8a 90 3c 98 a2 7a 92 ea 51 e9 05
        ec 7d 3c c9 cd aa b6 66 b3 db 48 cf 7d fb 6d dd
        04 b9 1b 97 9e be e1 58 66 fd e9 70 ac f9 ff b6
        23 17 fd f0 35 0c 41 3a 38 9a 2f 3f 16 2a e8 a9
        73 30 7c 38 c9 c4 7e c6 68 a4 78 fe 6d 00 28 4e
        33 87 e5 b6 c9 c5 3d ec 0e 92 03 eb 15 9b 38 73
        bf 0f c1 7b 5a 89 51 f1 97 71 f5 d5 ca 44 9f 87
        e7 dd 35 6d c0 1f cd 5b 93 c1 00 0e f1 a9 25 c8
        f6 e8 8b c7 }
        // May 2017 variant, RSA public keys
        $RsaPubKey1_May2017 = {
        06 02 00 00 00 a4 00 00 52 53 41 31 00 08 00 00
        01 00 01 00 75 97 4c 3b 84 46 de 2c 2a f4 95 a8
        5d c0 cd 6d da d7 d4 92 1e 13 82 34 6a 70 8d 8f
        7c f7 04 92 55 7f f1 a2 27 b2 9e 41 ac 90 80 91
        18 93 c2 b1 7b ad 2b f3 ff af db 2b 51 be 1d a3
        27 e3 a7 57 08 5a be c1 1d f6 04 f8 1c be 5b b1
        67 fb e4 c8 da 75 00 70 b1 17 70 24 6c 09 63 74
        ac 4b 0a 1d 71 ae 7f ae 65 b8 c5 86 79 c5 7e 9f
        98 60 4c 52 b9 29 62 cb 23 29 ed 31 91 74 7b 7b
        0b 26 1b f2 7d 67 bf da 7a 40 da f2 61 4d 94 a5
        7d ad 59 6b ad 9e a3 3a 39 c6 5b 6e 9f d2 bb 36
        b5 f5 d2 65 f5 2c 30 d8 c1 17 bd af 28 00 96 20
        46 a7 2d 62 03 0c d7 d0 75 a0 0b 07 ea d4 1f ca
        e8 d9 4e db 38 f2 26 75 cb 12 a6 88 70 9b e1 ea
        32 dc f8 71 72 50 41 e6 17 81 68 27 42 8e df e5
        de a1 72 d9 3b fb e5 9d 30 11 69 92 cd 60 2b e2
        d5 46 3c 28 cf 9d 30 4a f7 ad b9 fb 0f 91 fe 2e
        be 18 f1 ce }
        $RsaPubKey2_May2017 = {
        06 02 00 00 00 a4 00 00 52 53 41 31 00 08 00 00
        01 00 01 00 43 2b 4d 2b 04 9c 0a d9 9f 1e da 5f
        ed 32 a9 ef e1 ce 1a 50 f4 15 e7 51 7b ec b0 27
        56 05 58 b4 f6 83 c9 b6 77 5b 80 61 18 1c ab 14
        d5 6a fd 3b 70 9d 13 3f 2e 21 13 f1 e7 af e3 fb
        ab 6e 43 71 25 6d 1d 52 d6 05 5f 13 27 9e 28 89
        f6 ca 90 93 0a 68 c4 de 82 9b aa c2 82 02 b1 18
        60 01 63 1b bc 71 8d be 64 88 5e d5 0d 6c c1 9c
        c9 01 36 89 c9 80 37 8f 1d 89 67 4f 0c b1 3c 61
        09 3a 02 5d b8 4e f5 88 0a 9f 8c 0a 86 df 91 fe
        cd 9f a3 a0 13 d3 2d 30 77 d1 f0 a8 d7 ab 96 e5
        48 96 37 03 69 64 97 06 5c 27 50 8c 91 76 67 85
        3a 6c 6a b2 59 12 0a 61 f2 a1 ee a8 24 c8 e4 b1
        11 6d d6 cc f7 8f 4c 5e b0 55 84 81 6d 60 45 84
        0f fc df f9 27 a5 52 c9 5b 06 28 a3 de 74 03 d6
        c7 72 66 dc be a4 1e ff 20 96 ed 51 84 00 cc 9c
        36 64 f2 85 4d cf 36 60 dd c8 b0 f1 91 db 7a 0b
        83 ee cf ef }
    condition:
        any of them
}

rule CrowdStrike_CSA_17186_01 : fancy_bear xagent rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "X-Agent C2 tokens"
        reports = "CSA-17186"
        version = "201807301126"
        last_modified = "2018-07-30"
        actor = "FANCY BEAR"
        malware_family = "X-Agent"
    strings:
        $token1_body = { 66 5c 8c 34 99 e5 a4 00 }
        $token2_uri  = { 56 0e 9f f0 eb 98 43 00 }
        $token3_data_data = { 3a 66 95 64 4b 56 ff 22 4d 81 4f }
    condition:
        all of them
}

rule CrowdStrike_CSIT_17124_01 : daserf rat stalker_panda 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detection for Daserf malware"
        reports = "CSIT-17124"
        version = "202104211421"
        last_modified = "2021-04-21"
        actor = "STALKER PANDA"
        malware_family = "Daserf"
    strings:
        $ = "DRIVE_UNKNOWN" wide
        $ = "a0=0&a1=0&text=ID="
        $ = "&t1=START"
        $ = "Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 5.1; SV1)"
        $ = "JustInject Edition"
        $ = "*FILELIST*" wide
        $ = "###"
    condition:
        4 of them
}

rule CrowdStrike_CSIT_17118_02 : bokbot trojan 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "BokBot banking trojan with spreader functionality"
        reports = "CSIT-17118"
        version = "201807271542"
        last_modified = "2018-07-27"
        malware_family = "BokBot"
    strings:
        $instr1 = { 8b 44 24 04 d1 c8 f7 d0 d1 c8 2d 20 01 00 00 d1 c0 f7 d0 2d 01 91 00 00 }
        $instr2 = { 59 8a 0c 2f 8b d0 32 ca 43 88 4d 00 45 }
        $instr3 = { ba fc e0 cf 2a }
        $s1 = "NetUserEnum"
        $s2 = "ACTIVEDS.dll"
        $s3 = "LogonUserW"
        $s4 = "WNetAddConnection2W"
    condition:
        all of ($s*) and 2 of ($instr*)
}

rule CrowdStrike_CSIT_17127_01 : xdata dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "XDATA dropper"
        reports = "CSIT-17127"
        version = "201707200000"
        last_modified = "2017-07-20"
        malware_family = "XDATA"
    strings:
        $x_u = "USERNAME" wide
        $x_a = "-accepteula" wide
        $x_n = { 73 00 79 00 73 00 74 00 65 00 6d 00 33 00 32 00
        5c 00 6e 00 6f 00 74 00 65 00 70 00 61 00 64 00
        2e 00 65 00 78 00 65 00 }
        $x_m = "mfemmc.exe" wide
        $x_ip = "%d.%d.%d.%d" wide
        $x_name = { 65 00 78 00 70 00 6c 00 6f 00 72 00 65 00 72 00
        00 00 00 00 73 00 70 00 6f 00 6f 00 6c 00 73 00
        73 00 00 00 73 00 70 00 6f 00 6f 00 6c 00 73 00
        76 00 00 00 73 00 79 00 73 00 74 00 65 00 6d 00 }
    condition:
        all of them
}

rule CrowdStrike_CSIT_17127_02 : xdata ransomware 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "XDATA main payload"
        reports = "CSIT-17127"
        version = "201707200000"
        last_modified = "2017-07-20"
        malware_family = "XDATA"
    strings:
        // CryptAcquiteContextA
        $ = { 68 50 d5 83 eb }
        // CreateFileW
        $ = { 68 dc 12 2e e2 }
        // CryptGenRandom
        $ = { 68 4a dc 4d 94 }
        // FindNextFileW
        $ = { 68 ec 67 32 c2}
    condition:
        all of them
}

rule CrowdStrike_CSIT_17127_03 : mimikatz credential_dumper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "MimiKatz variant observed alongside XDATA ransomware"
        reports = "CSIT-17127"
        version = "201707200000"
        last_modified = "2017-07-20"
        malware_family = "MimiKatz"
    strings:
        $ = "Lists Kerberos credentials" wide
        $ = "Lists TsPkg credentials" wide
        $ = "sekurlsa" wide
        $ = "lsass.exe" wide
        $ = "PASSWORD" wide
        $ = "USERNAME" wide
        $ = "ENDPASS" wide
        // rabbitlib.dll export run
        $ = { 72 61 62 62 69 74 6c 69 62 2e 64 6c 6c 00 }
    condition:
        all of them
}

rule CrowdStrike_CSIT_17127_04 : mimikatz credential_dumper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "MimiKatz variant observed alongside XDATA ransomware"
        reports = "CSIT-17127"
        version = "201707200000"
        last_modified = "2017-07-20"
        malware_family = "MimiKatz"
    strings:
        $ = "pipe\\307b5eb8-6f40-4858-b61e-43cff1e128a6" wide
        $ = "<null>" wide
        $ = "PIC" wide
        $ = "run"
    condition:
        all of them
}

rule CrowdStrike_FANCYBEAR_DownRage_01 : downrage fancy_bear rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "String decryption loop using XOR with a 17-byte key, identifying instances of DownRage"
        version = "201911050803"
        last_modified = "2019-11-05"
        actor = "FANCY BEAR"
        malware_family = "DownRage"
    strings:
        $x68 = { 8d 0c 30 c7 45 08 11 00 00 00 33 d2 f7 75 08 8a 82 ?? ?? ?? ?? 32 04 0f 88 01 8b 45 0c 40 89 45 0c 3b c3 7c db 5f }
        $x86_2017_04 = { 8d 0c 30 c7 45 ?? 1? 00 00 00 33 d2 f7 75 ?? 8a 82 ?? ?? 00 ?? 32 04 0f 88 01 8b 45 0c 40 89 45 0c 3b c3 7c }
        $x86_2017_07b = { 8d 0c 16 83 e0 0f 8a 80 ?? ?? 00 ?? 32 04 0f 46 88 01 3b f3 7c e8 5f }
        $x64 = { 49 8b c8 48 b8 f1 f0 f0 f0 f0 f0 f0 f0 49 f7 e0 49 ff c0 48 c1 ea 04 48 6b c2 11 48 2b c8 48 8d 05 ?? ?? ?? ?? 8a 04 01 42 32 04 17 }
    condition:
        any of them
}

rule CrowdStrike_CSIT_17123_01 : credential_theft lokibot 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "LokiBot strings"
        reports = "CSIT-17123"
        version = "202002251701"
        last_modified = "2020-02-25"
        malware_family = "LokiBot"
    strings:
        $machineguid = "MachineGuid"
        $mscrypt = "SOFTWARE\\Microsoft\\Cryptography"
        $sqlite = "SQLite format 3"
        $fuckavru = "Fuckav.ru"
        $chrome = "Google\\Chrome" wide
        $firefox = "Mozilla\\Firefox" wide
    condition:
        all of them
}

rule CrowdStrike_CSIT_17130_01 : greencrash loader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "GreenCrash RAT 32-bit loader"
        reports = "CSIT-17130"
        version = "201807191136"
        last_modified = "2018-07-19"
        malware_family = "GreenCrash"
    strings:
        $key_bytes_1 = { 62 06 e8 7c 79 00 72 01 50 6e b1 4e c4 2a 0b 6c }
        $key_bytes_2 = { 2b 1f 84 5c 96 61 b2 5b 6f 17 b3 02 83 67 af 7f }
        $export_name = "PXLoader_32.dll"
        /* Xor loop
        Code from starting VA 100010cd:
        mov     eax, [ecx]
        mov     edx, esi
        and     edx, 0Fh
        mov     dl, [edx+ecx+408h]
        xor     [eax+esi], dl
        inc     esi
        cmp     esi, [ecx+4]
        jb      short loc_100010CD
        */
        $code_va_100010CD = { 8b 01 8b d6 83 e2 0f 8a 94 0a 08 04 00 00 30 14 30 46 3b 71 04 72 e9 }
    condition:
        filesize < 1MB and any of them
}

rule CrowdStrike_CSIT_17130_02 : greencrash loader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "GreenCrash RAT 64-bit loader"
        reports = "CSIT-17130"
        version = "201707270000"
        last_modified = "2017-07-27"
        malware_family = "GreenCrash"
    strings:
        $key_bytes_1 = { 43 72 cd 1d 01 65 9f 7a d0 47 65 1d 9a 60 3c 5f }
        $key_bytes_2 = { 71 6b 49 65 fb 3d be 6e 09 0d 88 35 e4 4c 3e 42 }
        $export_name = "PXLoader_64.dll"
        $code = { 48 8b 45 00 41 8b d0 49 8d 0c 00 83 e2 0f 41 ff c0 0f b6 84 2a 0c 04 00 00 30 01 44 3b 45 08 72 df }
    condition:
        filesize < 1MB and any of them
}

rule CrowdStrike_CSIT_17130_03 : credential_theft 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Credential dumper used in GreenCrash RAT campaign"
        reports = "CSIT-17130"
        version = "201807191139"
        last_modified = "2018-07-19"
    strings:
        $str_exportname = "CrE_Win32.dll"
        $str_logfiledefault = "\\Temp\\dp.tmp"
        $str_ossupport = { 54 68 65 20 6f 70 65 72 61 74 69 6e 67 20 73 79 73 74 65 6d 20 64 6f 65 73 20 6e 6f 74 20 73 75 70 70 6f 72 74 2e 20 0a 00 }
        /* Code from starting VA 10001172:
        mov     cl, byte ptr aWdigest_dll[eax]; "wdigest.dll"
        test    cl, cl
        jz      short loc_10001185
        xor     cl, 56h
        mov     byte ptr aWdigest_dll[eax], cl; "wdigest.dll"
        mov     cl, byte ptr (aWdigest_dll+1)[eax]; "digest.dll"
        test    cl, cl
        jz      short loc_10001198
        xor     cl, 56h
        mov     byte ptr (aWdigest_dll+1)[eax], cl; "digest.dll"
        mov     cl, byte ptr (aWdigest_dll+2)[eax]; "igest.dll"
        test    cl, cl
        jz      short loc_100011AB
        xor     cl, 56h
        mov     byte ptr (aWdigest_dll+2)[eax], cl; "igest.dll"
        mov     cl, byte ptr (aWdigest_dll+3)[eax]; "gest.dll"
        test    cl, cl
        jz      short loc_100011BE
        xor     cl, 56h
        mov     byte ptr (aWdigest_dll+3)[eax], cl; "gest.dll"
        mov     cl, byte ptr (aWdigest_dll+4)[eax]; "est.dll"
        test    cl, cl
        jz      short loc_100011D1
        xor     cl, 56h
        mov     byte ptr (aWdigest_dll+4)[eax], cl; "est.dll"
        add     eax, 5
        cmp     eax, 280h
        jb      short loc_10001172
        */
        $code = { 8a 88 ?? ?? ?? ?? 84 c9 74 09 80 f1 56 88 88 ?? ?? ?? ?? 8a 88 ?? ?? ?? ?? 84 c9 74 09 80 f1 56 88 88 ?? ?? ?? ?? 8a 88 ?? ?? ?? ?? 84 c9 74 09 80 f1 56 88 88 ?? ?? ?? ?? 8a 88 ?? ?? ?? ?? 84 c9 74 09 80 f1 56 88 88 ?? ?? ?? ?? 8a 88 ?? ?? ?? ?? 84 c9 74 09 80 f1 56 88 88 ?? ?? ?? ?? 83 c0 05 3d 80 02 00 00 72 97 }
    condition:
        filesize < 1MB and any of them
}

rule CrowdStrike_CSIT_17144_03 : cetk downloader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "cetk custom downloader"
        reports = "CSIT-17144"
        version = "201707270000"
        last_modified = "2017-07-27"
        actor = "TEMPER PANDA"
        malware_family = "cetk downloader"
    strings:
        // Set up call to rc4 init
        $code_va_004028AD = { c1 fa 05 8b c2 41 c1 e8 1f 03 d0 83 c5 52 3b ca}
        $code_va_00402826 = { 33 c9 8a 4a ff 51 52 8d 54 24 4c 52 }
        $str_cetk = "cetk>>" fullword
        $str_cmd_exe = { 6d 64 2e 65 78 65 20 2f 63 20 00 00 32 5c 63 00 }
    condition:
        filesize < 1MB and any of them
}

rule CrowdStrike_CSIT_17144_02 : adzok rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Adzok Java-based RAT (publicly available)"
        reports = "CSIT-17144"
        version = "201807300958"
        last_modified = "2018-07-30"
        malware_family = "Adzok"
    strings:
        $magic = { 50 4b 03 04 ( 14 | 0a ) 00 }
        $string_1 = "META-INF/"
        $string_2 = ".class" nocase
        $filename_config = "config.xml"
        $filename_key = "key.class"
        $filename_icono = "resources/icono.png"
        $filename_unin = "Uninstall.jar"
    condition:
        ($magic at 0 and 1 of ($string_*)) and (all of ($filename_*))
}

rule CrowdStrike_CSIT_17144_01 : chilarchy rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "ChilArchy RAT"
        reports = "CSIT-17144"
        version = "201807300956"
        last_modified = "2018-07-30"
        actor = "TEMPER PANDA"
        malware_family = "ChilArchy, ARCHY"
    strings:
        $code_va_00406296 = { 81 be ?? ?? ?? ?? aa 44 11 99 }
        $code_va_004040C4 = { 8a 54 24 0c 30 14 31 41 3b c8 7c f4 }
        $str_id_1 = "jhe*93N"
        $str_id_2 = "^&23HS&"
        $c = { 6a 1e 8b 00 5a 8b c8 8b f1 0f af ce 0f af c1 }
    condition:
        filesize < 2MB and ( ($str_id_1 and $str_id_2) or 4 of them )
}

rule CrowdStrike_CSIT_17109_01 : notpetya wiper ransomware 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "NotPetya wiper/ransomware"
        reports = "CSA-17159,CSIT-17109"
        version = "201807201208"
        last_modified = "2018-07-20"
        malware_family = "NotPetya"
    strings:
        $email = "wowsmith123456@posteo.net" wide
        $exts = ".3ds.7z.accdb.ai.asp.aspx.avhd.back.bak.c.cfg.conf.cpp.cs.ctl.dbf.disk.djvu.doc.docx.dwg.eml.fdb.gz.h.hdd.kdbx.mail.mdb.msg.nrg.ora.ost.ova.ovf.pdf.php.pmf.ppt.pptx.pst.pvi.py.pyc.rar.rtf.sln.sql.tar.vbox.vbs.vcb.vdi.vfd.vmc.vmdk.vmsd.vmx.vsdx.vsv.work.xls.xlsx.xvd.zip" wide
        $keymsg_1 = "Your personal installation key:" wide
        $keymsg_2 = "Incorrect key! Please try again."
        $reboot_1 = "schtasks %ws/Create /SC once /TN \"\" /TR \"%ws\" /ST %02d:%02d" wide
        $reboot_2 = "shutdown.exe /r /f" wide
        $func_1 = "SeShutdownPrivilege" wide
        $func_2 = "GetExtendedTcpTable"
        $func_3 = "CryptGenRandom"
        $func_4 = "ConnectNamedPipe"
    condition:
        all of ($func_*) and 3 of ($email, $exts, $keymsg_*, $reboot_*)
}

rule CrowdStrike_CSA_17202_01 : downloader javascript 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Javascript-based downloader observed in phishing attacks against Ukrainian entities as described in CSA-17202."
        reports = "CSA-17202"
        version = "201708030000"
        last_modified = "2017-08-03"
    strings:
        $ = "var linksssee = ["
        $ = ".responseText.indexOf('|||');"
        $ = ".Status == 200)break;"
        $ = ".Charset = 'ISO-8859-1';"
    condition:
        all of them
}

rule CrowdStrike_CSIT_17115_01 : notpetya bootloader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects bootloader component of NotPetya wiper malware"
        reports = "CSIT-17115"
        version = "201708030000"
        last_modified = "2017-08-03"
        malware_family = "NotPetya"
    strings:
        // Bitcoin address found in sector 32
        $wallet = "1Mz7153HMuxXTuR2R1t78mGSdzaAtNbBWX"
        // Start of the Boot Loader code
        $bootloader = { fa 31 c0 8e d8 8e d0 8e c0 8d 26 00 7c fb 66 b8 20 00 00 00 88 16 93 7c }
        // NotPetya code fragment
        $code = { 68 6c 9f e8 51 01 5b 90 90 90 68 71 9f }
    condition:
        any of them
}

rule CrowdStrike_CSIT_17154_01 : dropper wali walidropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Matches on WaliDropper component of the Wali malware toolkit"
        reports = "CSIT-17154"
        version = "201908200845"
        last_modified = "2019-08-20"
        malware_family = "WaliDropper"
    strings:
        $batch_file_name_1 = "xxmm"
        $batch_file_name_2 = ".bat"
        $rc4_key = "1234"
        $import_1 = "LoadResource"
        $import_2 = "LockResource"
        $source = "if(!"
    condition:
        uint16(0) == 0x5a4d and
        all of them
}

rule CrowdStrike_CSIT_17154_02 : wali waliexpander 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Matches on WaliExpander component of the Wali malware toolkit"
        reports = "CSIT-17154"
        version = "201708030000"
        last_modified = "2017-08-03"
        malware_family = "WaliExpander"
    strings:
        $mutex_name_with_length = { 00 00 00 14 00 01 04 b6 }
        $persistence_command = "/t reg_sz /d "
    condition:
        all of them
}

rule CrowdStrike_CSIT_17154_03 : wali waliloader loader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Matches on WaliLoader component of the Wali malware toolkit"
        reports = "CSIT-17154"
        version = "201708030000"
        last_modified = "2017-08-03"
        malware_family = "WaliLoader"
    strings:
        $in_all = "powershell -encodedcommand"
        $a_1 = "[wali]" wide
        $a_2 = "find changetime command" wide
        $b_1 = "if exist \""
        $b_2 = "\" goto try"
        $b_3 = "del %0"
        $b_4 = "xxmm"
        $b_5 = ".bat"
        $c_1 = "xxmm"
        $c_2 = ":try"
        $c_3 = "del \""
        $c_4 = "if exist \""
        $c_5 = "\" goto try"
        $c_6 = "del %0"
        $c_7 = ".bat"
    condition:
        $in_all and (all of ($a_*) or all of ($b_*) or all of ($c_*))
}

rule CrowdStrike_CSIT_17154_04 : wali waliloader loader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Matches on mutexes used by WaliLoader component of the Wali malware toolkit"
        reports = "CSIT-17154"
        version = "201708030000"
        last_modified = "2017-08-03"
        malware_family = "WaliLoader"
    strings:
        $ = "1qaz3edc5"
        $ = "1qaz2wsx5"
        $ = "1qazse48ik," wide
    condition:
        any of them
}

rule CrowdStrike_CSIT_17154_05 : wali walibuilder 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Matches on WaliBuilder component of the Wali malware toolkit"
        reports = "CSIT-17154"
        version = "201708030000"
        last_modified = "2017-08-03"
        malware_family = "WaliBuilder"
    strings:
        $ = "xxmm2_build."
    condition:
        all of them
}

rule CrowdStrike_CSIT_17102_02 : stardust_chollima wannacry ransomware artifact 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "WannaCry ransomware, encrypted file header"
        reports = "CSIT-17102"
        version = "201708040000"
        last_modified = "2017-08-04"
        actor = "STARDUST CHOLLIMA"
        malware = "WannaCry"
    strings:
        $hdr = { 57 41 4e ?? ?? ?? ?? ?? 00 01 00 00 }
    condition:
        $hdr and filesize >= uint32(@hdr + 256 + 12) and uint32(@hdr + 268) == 0x00000004
}

rule CrowdStrike_CSIT_17131_01 : wicked_panda dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Dropper/installer used by probable WICKED PANDA actor group"
        reports = "CSIT-17131"
        version = "201708100000"
        last_modified = "2017-08-10"
        actor = "WICKED PANDA"
    strings:
        $r3 = "[]r3 Ret=%d(%x)\x0a" fullword
        $r5 = "[]r5 Ret=%d(%x)\x0a" fullword
        $r7 = "[]r7 Ret=%d(%x)\x0a" fullword
        $rundll_with_pipe = "%s\\rundll32.exe \"%s\", setup %s|%s|%s"
        $rundll_with_space = "%s\\rundll32.exe \"%s\", run %s %s %s" fullword
    condition:
        any of them
}

rule CrowdStrike_CSIT_17131_02 : wicked_panda dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "AES CTR initialization value used in dropper/installer"
        reports = "CSIT-17131"
        version = "201708100000"
        last_modified = "2017-08-10"
        actor = "WICKED PANDA"
    strings:
        $aes_ctr_iv = "q@3$%hy*&u"
    condition:
        all of them
}

rule CrowdStrike_CSIT_17146_01 : bunitu loader proxy unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Bunitu (unpacked) loader or payload"
        reports = "CSIT-17146"
        version = "201910240402"
        last_modified = "2019-10-24"
        malware_family = "Bunitu"
    strings:
        // thread test connection
        $aa = { 87 fa 5f 8b c2 48 40 8d 44 38 25 66 8b 00 86 e0 }
        // extra function uncalled and unchanged
        $bb = { d8 18 1f 13 15 c8 40 00 40 83 c5 08 f7 d2 57 f7 d2 58 83 ed }
    condition:
        all of them
}

rule CrowdStrike_CSIT_17141_01 : voodoo_bear killdisk wiper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detection for 2016 variant of KillDisk"
        reports = "CSIT-17141"
        version = "201807051046"
        last_modified = "2018-07-05"
        actor = "VOODOO BEAR"
        malware_family = "KillDisk"
    strings:
        $fmt_1 = "%d.%d.%d#%d:%d"
        $fmt_2 = "/c \"echo Y|"
        $fmt_3 = "[+] > %ls"
        $fmt_4 = "[-] > %ls"
        $aenc_1 = "c7amanmza3(mf}5="
        $aenc_2 = "c7amc7Ck:n6Fa1=="
        $benc_1 = "l*d*l;d#ieEog*Ftgf0Bj.]v0,5@k$9tj8=="
        $benc_2 = "l*d*l;d#ieEog*Ftgf0Bj.]v0,5tg$d(if9@"
        $cenc_1 = "xsj>z#D]y,m[vtD&"
        $cenc_2 = "xsv&v#&<vo;&Acq="
        $img_0 = { 00 1f f8 00 00 00 00 00 00 1c 1f 00 7e 7c 00 00 00 00 }
        $img_1 = { fc 0e e7 fc ff 03 f8 7e f0 7f 00 ef f0 38 3c 1f }
    condition:
        ( ( 1 of ($aenc_*) or 1 of ($benc_*) or 1 of ($cenc_*) )
        and ($fmt_1 or $fmt_2 or $img_0 or $img_1 )
        or (3 of them) )
}

rule CrowdStrike_CSA_17215_01 : dropper shadowpad 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "ShadowPad malicious DLL dropper"
        reports = "CSA-17215"
        version = "202008151117"
        last_modified = "2020-08-15"
        malware_family = "ShadowPad"
    strings:
        $code = {69 C9 51 D3 BE C9 81 E9 37 5E A2 57}
        $msg = "###ERROR###"
    condition:
        all of them
}

rule CrowdStrike_CSIT_17162_01 : dropper shadowpad 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "ShadowPad malicious DLL dropper"
        reports = "CSIT-17162"
        version = "202008151117"
        last_modified = "2020-08-15"
        malware_family = "ShadowPad"
    strings:
        $code = { 69 c9 51 d3 be c9 81 e9 37 5e a2 57 }
        $msg = "###ERROR###"
    condition:
        all of them
}

rule CrowdStrike_CSIT_17128_01 : globe_imposter ransomware 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Globe Imposter ransomware strings"
        reports = "CSIT-17128"
        version = "202004071349"
        last_modified = "2020-04-07"
        malware_family = "Globe Imposter"
    strings:
        $rsaencrypt = "rsa_encrypt"
        $rsagenkey = "rsa_genkey"
        $rsaexp = "010001"
        $hwprofile = "GetCurrentHwProfileW"
        $taskkill = "taskkill /F /T /PID"
        $vssadmin = "vssadmin.exe Delete Shadows /All /Quiet"
        $defaultrdp = "Default.rdp"
        $certificates = "CertificatesCheck" wide
    condition:
        6 of them
}

rule CrowdStrike_CSIT_17143_02 : diamondfox loader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects DiamondFox VBS loaders created using 4.2.0.650 builder."
        reports = "CSIT-17143"
        version = "201807301020"
        last_modified = "2018-07-30"
        malware_family = "DiamondFox, Gorynch"
    strings:
        $aVB = "gate.php"
        $aFT = "UserAgent"
        $aOL = "ConnectionKey"
        $aKe = "ConnectionTime"
        $aPr = "ElseIf Left(strText, 3) = \"VV|\" Then"
        $aWr = "ElseIf Left(strText, 3) = \"VH|\" Then"
    condition:
        all of ($a*) and uint16(0) != 0x5A4D
}

rule CrowdStrike_CSIT_17143_01 : diamondfox loader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects DiamondFox loaders created using 4.2.0.650 builder. Targets APIs & strings."
        reports = "CSIT-17143"
        version = "201807301017"
        last_modified = "2018-07-30"
        malware_family = "DiamondFox, Gorynch"
    strings:
        $aVB = "MSVBVM60.DLL"
        $aFT = "FTPUPLOAD"
        $aOL = "A_OLLY"
        $aKe = "P_KEYLOGGER"
        $aPr = "ProcCallEngine"
        $aWr = "NtWriteVirtualMemory"
    condition:
        (uint16(0) == 0x5A4D and uint32(uint32(0x3C)) == 0x00004550) and all of ($a*)
}

rule CrowdStrike_CSIT_17143_03 : diamondfox loader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects DiamondFox loaders created by the 4.2.0.650+ builder. Targets modified DOS Header & strings."
        reports = "CSIT-17143"
        version = "201807301022"
        last_modified = "2018-07-30"
        malware_family = "DiamondFox, Gorynch"
    strings:
        // Hardcoded section name created by the builder
        $sec = "L!NK"
        // API used for process hollowing
        $api = "NtResumeThread"
    condition:
        // Detect JMP instruction after MZ header, PE header and section name at offset
        uint32(0) == 0x45525A4D and uint32(uint32(0x3C)) == 0x00004550 and $sec at 0x1b0 and $api
}

rule CrowdStrike_CSIT_17158_01 : wicked_panda gh0st rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detection for Gh0st RAT variant attributed to WICKED PANDA"
        reports = "CSIT-17158"
        version = "201708280000"
        last_modified = "2017-08-28"
        actor = "WICKED PANDA"
        malware_family = "Gh0st"
    strings:
        $pktflag = "m_bPacketFlag: %s, bPacketFlag: %s"
        $plugin = "PluginMe"
        $del = "<<<DEL>>>"
        $file1 = "Server.dat"
        $file2 = "TempModule.dat" ascii
        $file3 = "klog_d.dat" ascii
        $file4 = "klog.dat" ascii
        $file5 = "c:\\temp\\Nonull_Log_%04d_%02d_%02d.log" ascii
    condition:
        3 of them
}

rule CrowdStrike_CSIT_17145_01 : rm3 gozi loader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "RM3 loader - client DLL for Gozi/ISFB variant"
        reports = "CSIT-17145"
        version = "201708300000"
        last_modified = "2017-08-30"
        malware_family = "RM3"
    strings:
        $jtag_1 = { 4a 32 00 11 64 5e 28 e1 }
        $jtag_2 = { 4a 32 00 10 e1 dd b1 8f }
        $s1 = "type=%u&soft=%u&version=%u&user=%08x%08x%08x%08x&group=%u&id=%x&arc=%u&crc=%x&uptime=%u"
        $s2 = "Content-Type: multipart/form-data; boundary=%s"
    condition:
        all of them
}

rule CrowdStrike_CSIT_17140_01 : mamba ransomware 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Mamba ransomware strings"
        reports = "CSIT-17140"
        version = "201708310000"
        last_modified = "2017-08-31"
        malware_family = "Mamba"
    strings:
        $xmaphttp = "C:\\xamp\\http\\log.txt"
        $shutdown = "ICYgc2h1dGRvd24gL2YgL3IgL3QgMA=="
        $encryptpt = "LWVuY3J5cHQgcH"
        $setmbr = "LWJvb3QgLXNldG1iciBoZDA="
        $service = "RGVmcmFnbWVudFNlcnZpY2U="
        $dccon = "XGRjY29uLmV4ZQ=="
        $setup = "LXNldHVw"
        $dcconw = "DCCON.EXE" wide
        $dcryptw = "DCRYPT.SYS" wide
    condition:
        7 of them
}

rule CrowdStrike_CSIT_17162_02 : dropper shadowpad 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "ShadowPad malicious DLL dropper"
        reports = "CSIT-17162"
        version = "202008151117"
        last_modified = "2020-08-15"
        malware_family = "ShadowPad"
    strings:
        $ = { 69 c0 00 00 12 41 c1 ea 10 69 d2 ee be 4c 43 2b c2 33 d2 2d 0f 8e 87 2f }
    condition:
        all of them
}

rule CrowdStrike_Possible_Java_Deserialization_Exploit_01 : exploit cve_2015_3253 cve_2017_9805 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects possible exploitation attempts of Java deserialization vulnerabilities like CVE-2017-9805 and CVE-2015-3253."
        version = "201709080000"
        last_modified = "2017-09-08"
    strings:
        $java_proc = "java.lang.ProcessBuilder"
        $dl_http = /http(s?):(\/\/|%2F%2F)/
        $dl_ftp1 = /ftp:(\/\/|%2F%2F)/
        $dl_ftp2 = "ftp."
        $cmd_curl = "curl"
        $cmd_wget = "wget"
        $cmd_bin_sh = /(\/|%2F)bin(\/|%2F)sh/
        $cmd_cme_exe = "cmd.exe"
        $cmd_applications = /(%2F|\/)Applications(%2F|\/)/
        $cmd_powershell = "powershell.exe"
        $cmd_wscript = "wscript.exe"
        $cmd_cscript = "cscript.exe"
        $string = /(%3C|\<)string(%3E|\>)/
        $command = /(%3C|\<)command(%3E|\>)/
        $ids_rule = "alert tcp "
        $head = "<head>"
        $title = "<title>"
    condition:
        $java_proc and 1 of ($dl_*) and 1 of ($cmd_*) and ($string or $command) and not $ids_rule and not $head and not $title
}

rule CrowdStrike_CSIT_17174_01 : adwind rat unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Adwind Java RAT"
        reports = "CSIT-17174"
        version = "202003031301"
        last_modified = "2020-03-03"
        malware_family = "Adwind"
    strings:
        $ = "\"NETWORK\":"
        $ = "\"INSTALL\":"
        $ = "\"MODULE_PATH\":"
        $ = "\"PLUGIN_FOLDER\":"
        $ = "\"JRE_FOLDER\":"
        $ = "\"JAR_FOLDER\":"
        $ = "\"JAR_EXTENSION\":"
        $ = "\"ENCRYPT_KEY\":"
        $ = "\"DELAY_INSTALL\":"
        $ = "\"NICKNAME\":"
        $ = "\"VMWARE\":"
        $ = "\"PLUGIN_EXTENSION\":"
        $ = "\"WEBSITE_PROJECT\":"
        $ = "\"JAR_NAME\":"
        $ = "\"SECURITY\":"
        $ = "\"JAR_REGISTRY\":"
        $ = "\"DELAY_CONNECT\":"
        $ = "\"SECURITY_TIMES\":"
        $ = "\"VBOX\":"
    condition:
        16 of them
}

rule CrowdStrike_CSIT_17151_02 : shadow_crane macro 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Custom Base64 alphabet noted in macro documents used with KONNI/Babylon malware and related tools"
        reports = "CSIT-17151"
        version = "201805110931"
        last_modified = "2018-05-11"
        actor = "SHADOW CRANE"
    strings:
        $str_customalphabet = "KXU/yP=B29tLzidqNRuf-SbVInw0oCrmWZk6OpFc7A5GTD1QxaJ3H8h4jMeEsYglv"
    condition:
        filesize < 1MB and $str_customalphabet
}

rule CrowdStrike_VenomousBear_Gayzer_Dropper : dropper gayzer venomous_bear 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Gayzer RAT, dropper component"
        version = "202001201416"
        last_modified = "2020-01-20"
        actor = "VENOMOUS BEAR"
        malware_family = "Gayzer"
    strings:
        $ = { 83 ec 18 53 55 56 33 ?? 57 83 f8 ff 74 0d ?? ?? 50 ff 15 ?? ?? ?? ?? 85 c0 75 11 e8 ?? ?? ff ff 84 c0 75 08 }
        $ = { 50 00 49 00 44 00 3d 00 25 00 64 00 09 00 54 00 49 00 44 00 3d 00 25 00 64 00 09 00 48 00 65 00 61 00 70 00 73 00 3d 00 25 00 64 00 09 00 25 00 73 00 0a 00 00 00 00 }
        $ = "|%02d:%02d:%02d:%03d|\t" wide
        $ = "[%04d|%-48s]\t" wide
        $ = "[HeapFree] NULL" wide
        $ = "myHandle = 0x%x" wide
    condition:
        all of them
}

rule CrowdStrike_VenomousBear_Gayzer_Orchestrator : gayzer rat venomous_bear 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Gayzer RAT, orchestrator component"
        version = "202001201416"
        last_modified = "2020-01-20"
        actor = "VENOMOUS BEAR"
        malware_family = "Gayzer"
    strings:
        $ = "GetNamedPipeHandleStateW"
        $ = { 4d 5a 90 00 03 00 00 00 04 00 00 00 ff ff 00 00
        b8 00 00 00 00 00 00 00 40 00 00 00 00 00 00 00
        00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 }
        $ = { 00 00 00 00 00 00 00 00 06 00 42 00 49 00 4e 00
        41 00 52 00 59 00 00 00 00 00 00 00 00 00 00 00 }
        $ = "LTManager" wide
        $ = "HiddenTaskAutorun" wide
        $ = "AutorunManager" wide
        $ = "DllInjector" wide
        $ = "ScreenSaverAutorun" wide
        $ = "TaskQueue" wide
        $ = "ResultQueue" wide
        $ = "CExecutionSubsystem" wide
    condition:
        all of them
}

rule CrowdStrike_VenomousBear_Gayzer_TransportModule : gayzer rat venomous_bear 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Gayzer RAT, transport component"
        version = "202001201417"
        last_modified = "2020-01-20"
        actor = "VENOMOUS BEAR"
        malware_family = "Gayzer"
    strings:
        $xorkey = { f7 23 bc 67 80 ab 9e dc 7a 45 67 98 ab cd ef f7 a1 a7 89 ab cd ef 01 23 }
        $3desiv = { 7c 92 56 78 0d ab cd ef }
    condition:
        all of them
}

rule CrowdStrike_CSIT_17151_01 : babylon konni rat velvet_chollima 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "KONNI malware AKA Babylon"
        reports = "CSIT-17151"
        version = "202004141206"
        last_modified = "2020-04-14"
        actor = "VELVET CHOLLIMA"
        malware_family = "KONNI, babylon"
    strings:
        $str_dropcom = "%s_dropcom"
        $str_solhelp = "solhelp.ocx"
        $str_driveinfo = "Drive Information is as follow"
        $str_virus          = "virus-dll.dll" fullword
    condition:
        filesize < 2MB and 2 of them
}

rule CrowdStrike_CSIT_17160_01 : loader snake venomous_bear 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "VENOMOUS BEAR Snake loader entrypoint code"
        reports = "CSIT-17160"
        version = "201908131615"
        last_modified = "2019-08-13"
        actor = "VENOMOUS BEAR"
        malware_family = "Snake"
    strings:
        $ = { 55 8b ec 83 e4 f8 51 b8 af be ad de 39 45 0c 56 }
    condition:
        all of them
}

rule CrowdStrike_CSIT_17160_02 : key snake venomous_bear 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "VENOMOUS BEAR VFS default CAST128 key"
        reports = "CSIT-17160"
        version = "201908131614"
        last_modified = "2019-08-13"
        actor = "VENOMOUS BEAR"
        malware_family = "Snake"
    strings:
        $ = { a1 d2 10 b7 6d 5e da 0f a1 65 af ef 79 c3 66 fa }
    condition:
        all of them
}

rule CrowdStrike_CSIT_17160_03 : key snake venomous_bear 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "VENOMOUS BEAR C2 default CAST128 key"
        reports = "CSIT-17160"
        version = "201908131614"
        last_modified = "2019-08-13"
        actor = "VENOMOUS BEAR"
        malware_family = "Snake"
    strings:
        $ = "gLASs D1cK"
    condition:
        all of them
}

rule CrowdStrike_CSIT_17160_04 : artifact snake venomous_bear 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "VENOMOUS BEAR LZMA Compressed Data"
        reports = "CSIT-17160"
        version = "201908131614"
        last_modified = "2019-08-13"
        actor = "VENOMOUS BEAR"
        malware_family = "Snake"
    strings:
        $ = { 00 ?0 00 00 e8 45 bf cd ?? ?? ?? 00 ?? ?? 00 00
        00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
        00 00 00 00 00 00 00 00 ?? 00 }
    condition:
        all of them
}

rule CrowdStrike_CSIT_17177_01 : neutrino_bot bot 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects Neutrino Bot form grabbers"
        reports = "CSIT-17177"
        version = "201807301024"
        last_modified = "2018-07-30"
        malware_family = "Neutrino Bot, Kasidet"
    strings:
        $aa = "PR_Write"
        $ab = "inject_after_keyword"
        $ac = "Z:\\nn\\nn_core_dll_x32.dll" wide
        $ad = "MachineGuid" wide
        $af = "FlushInstructionCache"
    condition:
        uint16(0) == 0x5A4D and all of ($a*)
}

rule CrowdStrike_CSIT_17160_05 : config snake venomous_bear 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "VENOMOUS BEAR Snake configuration (Queue) file"
        reports = "CSIT-17160"
        version = "201908131607"
        last_modified = "2019-08-13"
        actor = "VENOMOUS BEAR"
        malware_family = "Snake"
    strings:
        $ = { 00 ?? ?? 00 00 ?? ?? 00 00 00 ?? ?? 00 ?? ?? 00
        ?? 00 00 00 ?? ?? ?? 00 ?? 00 00 00 01 00 00 00
        5a 00 00 00 ?? 00 00 00 83 e0 45 a9 fe ff ff ff }
    condition:
        all of them
}

rule CrowdStrike_CSIT_17166_01 : rm3 isfb 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "RM3 Core module ID:8576b0d0"
        reports = "CSIT-17166"
        version = "201709290000"
        last_modified = "2017-09-29"
        malware_family = "RM3"
    strings:
        $mod1 = "\\Modules32" wide
        $mod2 = "\\Modules64" wide
        $fmt1 = "\\REGISTRY\\USER\\%s\\%s\\" wide
        $mod = "8576b0d0" wide
    condition:
        all of them
}

rule CrowdStrike_CSIT_17156_01 : labyrinth_chollima htdnloader loader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "HtDnLoader - x86 variant"
        reports = "CSIT-17156"
        version = "201710040000"
        last_modified = "2017-10-04"
        actor = "LABYRINTH CHOLLIMA"
        malware_family = "HtDnLoader"
    strings:
        $code_va_00401E90 = { 80 b0 ?? ?? ?? ?? 79 40 3d 86 ea 00 00 72 f1 f6 05 ?? ?? ?? ?? 02 }
        $code_va_10001CBD = { 33 c0 80 B0 ?? ?? ?? ?? 79 40 3d 86 ea 00 00 72 f1 }
        $code_generic = { 79 40 3d ?? e? 00 00 72 f1 }
    condition:
        filesize < 2MB and any of them
}

rule CrowdStrike_CSIT_17156_02 : labyrinth_chollima htdnloader loader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "HtDnLoader - x64 variant"
        reports = "CSIT-17156"
        version = "201710040000"
        last_modified = "2017-10-04"
        actor = "LABYRINTH CHOLLIMA"
        malware_family = "HtDnLoader"
    strings:
        $code_va_1800020D4 = { 80 31 79 48 8D 49 01 FF C2 48 63 C2 48 3D 2F 0C 01 00 72 EC }
        $str_dll_name = "HtDnRun_x64.dll" fullword
    condition:
        filesize < 2MB and any of them
}

rule CrowdStrike_CSIT_17156_03 : labyrinth_chollima htdnloader downloader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "HtDnDownloader malware used to download an additional malware stage"
        reports = "CSIT-17156"
        version = "201710040000"
        last_modified = "2017-10-04"
        actor = "LABYRINTH CHOLLIMA"
        malware_family = "HtDnDownloader"
    strings:
        $str_exported_dll_func_bin_32 = { 43 6f 72 65 2e 64 6c 6c 00 43 6f 72 65 44 6e }
        $str_exported_dll_func_bin_64 = { 43 6f 72 65 36 34 2e 64 6c 6c 00 43 6f 72 65 44 6e }
        $str_commandlinearg = "qLyTGfVSYmWhTLRR" fullword
    condition:
        filesize < 2MB and any of them
}

rule CrowdStrike_CSIT_17156_04 : delivery_document 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects HWP documents with embedded EPS files, used for exploitation"
        reports = "CSIT-17156"
        version = "201710040000"
        last_modified = "2017-10-04"
        actor = "LABYRINTH CHOLLIMA"
    strings:
        $str_hang = { 48 57 50 20 44 6f 63 75 6d 65 6e 74 20 46 69 6c }
        $str_ps1 = "BIN0001.ps" wide fullword
        $str_ps2 = "BIN0002.ps" wide fullword
        $str_ps3 = "BIN0003.ps" wide fullword
    condition:
        $str_hang and (any of ($str_ps*))
}

rule CrowdStrike_CSIT_17156_05 : delivery_document macro 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects macro documents used to install LABYRINTH CHOLLIMA payloads"
        reports = "CSIT-17156"
        version = "201710040000"
        last_modified = "2017-10-04"
        actor = "LABYRINTH CHOLLIMA"
    strings:
        $str_enc_pe_start = "AABD77E7E4E7E7E7E3E7E7E7"
        $str_fragment_1 = "C7E7E787C995838"
        $str_fragment_2 = "AABD77E7E4E7E7E"
        $doc_magic = { d0 cf 11 e0 }
    condition:
        filesize < 5MB and $doc_magic at 0 and ( any of ($str_*) )
}

rule CrowdStrike_CSA_17283_01 : delivery_document kopiluwak venomous_bear 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Kopiluwak Dropper Document Search Pattern"
        reports = "CSA-17283"
        version = "202003130935"
        last_modified = "2020-03-13"
        actor = "VENOMOUS BEAR"
        malware_family = "Kopiluwak"
    strings:
        $ = "MxOH8pcrlepD3SRfF5ffVTy86Xe41L2qLnqTd5d5R7Iq87mWGES55fswgG84hIRdX74dlb1SiFOkR1Hh"
    condition:
        any of them
}

rule CrowdStrike_CSIT_17159_01 : labyrinth_chollima hawup rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Obfuscation routine used in Hawup for API strings"
        reports = "CSIT-17159"
        version = "201710060000"
        last_modified = "2017-10-06"
        actor = "LABYRINTH CHOLLIMA"
        malware_family = "Hawup"
    strings:
        $code = { fe 0a 44 0f b6 02 41 8d 40 9e 3c 17 77 0a b8 db ff ff ff 41 2a c0 88 02 }
        $str1 = "MmybpBppmy"
        $str2 = "DjwbhwUtjwbx"
        $str3 = "MmybpGjww"
    condition:
        $code or (2 of ($str*))
}

rule CrowdStrike_CSIT_17159_02 : labyrinth_chollima hawup rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Encrypted SNI hosts used in Hawup"
        reports = "CSIT-17159"
        version = "201710060000"
        last_modified = "2017-10-06"
        actor = "LABYRINTH CHOLLIMA"
        malware_family = "Hawup"
    strings:
        $site1 = { 1a a8 e3 f4 c1 c3 87 eb f0 f7 e6 a4 67 d3 28 fd fd 10 84 6c 12 de cd e5 58 ff b1 }
        $site2 = { 1e a8 e3 f4 c1 c3 87 eb f0 f2 e6 a6 67 cc 28 e1 fd 17 84 2d 12 c5 cd a4 58 f1 b1 b3 c6 9a f7 }
        $site3 = { 20 a8 e3 f4 c1 c3 87 eb f0 f0 e6 b5 67 c0 28 f4 fd 17 84 2d 12 d2 cd e1 58 bc b1 bf c6 98 f7 be 5a }
        $site4 = { 1c a8 e3 f4 c1 c3 87 eb f0 f1 e6 bd 67 d7 28 f9 fd 00 84 20 12 93 cd e9 58 fd b1 b1 c6 }
    condition:
        2 of them
}

rule CrowdStrike_CSIT_17159_03 : labyrinth_chollima hawup rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Hawup RAT"
        reports = "CSIT-17159"
        version = "201808231338"
        last_modified = "2018-08-23"
        actor = "LABYRINTH CHOLLIMA"
        malware_family = "Hawup"
    strings:
        $str1 = "MmybpBppmy"
        $str2 = "DjwbhwUtjwbx"
        $str3 = "MmybpGjww"
        $alt_str1 = "LlxaoAoolx"
        $alt_str2 = "CivagvTsivaw"
        $alt_str3 = "LlxaoFivv"
        $site1 = {1A A8 E3 F4 C1 C3 87 EB F0 F7 E6 A4 67 D3 28 FD
        FD 10 84 6C 12 DE CD E5 58 FF B1}
        $site2 = {1E A8 E3 F4 C1 C3 87 EB F0 F2 E6 A6 67 CC 28 E1
        FD 17 84 2D 12 C5 CD A4 58 F1 B1 B3 C6 9A F7}
        $site3 = {20 A8 E3 F4 C1 C3 87 EB F0 F0 E6 B5 67 C0 28 F4
        FD 17 84 2D 12 D2 CD E1 58 BC B1 BF C6 98 F7 BE
        5A}
        $site4 = {1C A8 E3 F4 C1 C3 87 EB F0 F1 E6 BD 67 D7 28 F9
        FD 00 84 20 12 93 CD E9 58 FD B1 B1 C6}
    condition:
        ((2 of ($str*)) or (2 of ($alt_str*))) and (2 of ($site*))
}

rule CrowdStrike_CSIT_17165_01 : shade ransomware unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Shade ransomware unpacked strings"
        reports = "CSIT-17165"
        version = "201807271621"
        last_modified = "2018-07-27"
        malware_family = "Shade"
    strings:
        $gpa = { 68 ?? ?? ?? 00 57 a3 ?? ?? ?? 00 ff d6 68 ?? ?? ?? 00 57 a3 ?? ?? ?? 00 ff d6 }
        $aes = { ff b6 ?? ?? ?? 00 8b be ?? ?? ?? 00 e8 ?? ?? ?? 00 }
        $exp = { ac ad ac }
        $oni = ".onion"
        $tor = "/tor/"
        $sig = "-----BEGIN SIGNATURE-----"
    condition:
        all of them
}

rule CrowdStrike_CSIT_17103_01 : fakecry ransomware 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Fake .NET WannaCry imposter - main module"
        reports = "CSIT-17103"
        version = "201710130000"
        last_modified = "2017-10-13"
        malware_family = "FakeCry"
    strings:
        // Generic .NET identification
        $a = "_CorExeMain"
        $b = "mscoree.dll"
        // Embedded demo RSA keys
        $c = "BgIAAACkAABSU0ExAAgAAAEAAQAdbwYdlbhbpDhA8l/d4oYSxIfiYq2AZkp2tj+07AOFQMP1u7MEIrEyoYDfCnaAgfOhuzRNy3m5Dq3ESl5zsmpa6mxR7jyg1c/lcgYQELYnJhpCZtRDWXiAJlOTzHehLquYg5jRXmtS7fKqAnU4l1xRqx1MSLk0M/U+c/v21OWZOPPWj399OmladHnO518JpyI3cm62wtr2JI7df5RGJFp+5EiHglHd0tcFatm0KgPCpf+VNQhIz4sA+wrO/m1Nbp8VVBc5xmk7oDmic3gxkkqD3eBNkDse+OMgpZJhvQ1bFOr2/UBxUiqVf+K01KN/Y7/f6cebWf43nx0q4FinyPu3" wide
        $d = "BwIAAACkAABSU0EyAAgAAAEAAQAdbwYdlbhbpDhA8l/d4oYSxIfiYq2AZkp2tj+07AOFQMP1u7MEIrEyoYDfCnaAgfOhuzRNy3m5Dq3ESl5zsmpa6mxR7jyg1c/lcgYQELYnJhpCZtRDWXiAJlOTzHehLquYg5jRXmtS7fKqAnU4l1xRqx1MSLk0M/U+c/v21OWZOPPWj399OmladHnO518JpyI3cm62wtr2JI7df5RGJFp+5EiHglHd0tcFatm0KgPCpf+VNQhIz4sA+wrO/m1Nbp8VVBc5xmk7oDmic3gxkkqD3eBNkDse+OMgpZJhvQ1bFOr2/UBxUiqVf+K01KN/Y7/f6cebWf43nx0q4FinyPu3" wide
        // File metadata and pdb
        $e = "wc.exe" fullword
        $f = "wanna_cry"
        $g = "C:\\Users\\Developer\\Desktop\\WannaCry\\wanna_cry\\obj\\Release\\wc.pdb"
    condition:
        ($a and $b and $e and $f and $g) or ($c and $d)
}

rule CrowdStrike_CSIT_17168_01 : dropper loader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detection for CCleaner second-stage dropper and loader"
        reports = "CSIT-17168"
        version = "201710180000"
        last_modified = "2017-10-18"
    strings:
        $path1 = "\\spool\\prtprocs\\w32x86\\localspl.dll"
        $path2 = "\\spool\\prtprocs\\x64\\localspl.dll"
        $path3 = "\\TSMSISrv.dll"
        $const1 = { 17 93 28 f3 33 }
        $const2 = { 32 c6 cf 01 }
        $const3 = { fd eb e5 0a }
        $const4 = { c7 ?? ?? 30 30 31 00 }
        $reg1 = "WbemPerf"
    condition:
        uint16(0) == 0x5A4D and uint32(uint32(0x3C)) == 0x00004550 and (( 1 of ($path*) and $reg1 and (1 of ($const*) ) ) or
        ( 2 of ($const*) and $const4 ) )
}

rule CrowdStrike_CSIT_17168_02 : loader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detection for CCleaner second-stage loader"
        reports = "CSIT-17168"
        version = "201710180000"
        last_modified = "2017-10-18"
    strings:
        $reg1 = "SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\WbemPerf"
        $event1 = "Global\\KsecDDE"
        $token1 = "ptoken="
        $const1 = { 26 59 41 31 }
        $const2 = { ef 79 78 01 }
        $const3 = { 25 51 d3 00 }
        $const4 = { c6 2d 00 }
        $const5 = { c9 ae f1 e1 05 }
    condition:
        ( (4 of ($const*) ) or
        ( $reg1 and $token1 and ( 1 of ($const*) ) ) or
        ( $reg1 and $event1 and $token1 )
        )
}

rule CrowdStrike_PIRATEPANDA_MoziRAT_01 : pirate_panda mozirat rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "MoziRAT variant seen in mid/late 2017"
        version = "201807300947"
        last_modified = "2018-07-30"
        actor = "PIRATE PANDA"
        malware_family = "MoziRAT"
    strings:
        $str_dllorigname = "InstallClient.dll" fullword
        $str_export_insys = "Insys" fullword
        $str_export_inuser = "Inuser" fullword
        $str_overwritten = "Ping 127.0.0.1rrentVersion"
        $str_current = "Current user is a member of the %s\\%s group"
        $str_changefile = "ChangeFileTime %s->%s"
        $str_errrelease = "error:ReleaseFileFromRes:%s error"
        /* Code from starting VA 10003011:
        mov     al, [esi+edi]
        movsx   ecx, byte ptr [ebp+ecx*4+keytemp]
        xor     al, 1
        movsx   eax, al
        imul    ecx, eax
        xor     cl, 85h
        mov     [esi+edi], cl
        inc     esi
        cmp     esi, edx
        jl      short loc_10003002
        */
        $code_va_10003011 = { 8a 04 3e 0f be 4c 8d e0 34 01 0f be c0 0f af c8 80 f1 85 88 0c 3e 46 3b f2 7c d6 }
    condition:
        filesize < 2MB and 4 of them
}

rule CrowdStrike_CSIT_17176_02 : azorult stealer 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Azorult Version 1 rule"
        reports = "CSIT-17176"
        version = "202002251655"
        last_modified = "2020-02-25"
        malware_family = "Azorult"
    strings:
        $ = "getCoins Start"
        $ = "getSkype Start"
        $ = "getSteam Start"
        $ = "GLOBALFUNC"
        $ = "PROTOCOL:"
        $ = "----WebKitFormBoundaryAyFLe1eF4NAHbJq0"
        $ = "}],\"disabledHosts"
        $ = "_NO_WORK_EXIT_"
    condition:
        all of them and CrowdStrike_CSIT_17176_01
}

rule CrowdStrike_CSIT_17176_03 : azorult stealer 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Azorult Version 2 rule"
        reports = "CSIT-17176"
        version = "202002251655"
        last_modified = "2020-02-25"
        malware_family = "Azorult"
    strings:
        $ = "ST234LMUV56CklAopq78Brstuvwxyz01NOPQRmGHIJKWXYZabcdefgDEFhijn9+/" wide ascii
        $ = "SYSInfo.txt"
        $ = "AA6EEE0A-97B7-46FE-BD01-0FC54FD36163-ED03A8DD-6213-4535-8891-5D0A112A3F40"
    condition:
        all of them
}

rule CrowdStrike_CSIT_17172_01 : carbon_spider jsflash rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "CARBON SPIDER JSFlash obfuscated payload 1"
        reports = "CSIT-17172"
        version = "201710200000"
        last_modified = "2017-10-20"
        actor = "CARBON SPIDER"
        malware_family = "JSFlash"
    strings:
        // "];ksS="";for(ks=0;ks&lt;kss.length;ks++){ksS+=kss[ks];}
        $loop = { 22 5d 3b 6b 73 53 3d 22 22 3b 66 6f 72 28 6b 73
        3d 30 3b 6b 73 26 6c 74 3b 6b 73 73 2e 6c 65 6e
        67 74 68 3b 6b 73 2b 2b 29 7b 6b 73 53 2b 3d 6b
        73 73 5b 6b 73 5d 3b 7d }
        // fromCharCode((parseInt(kSs[ks],16)^
        $xor = { 22 5d 3b 6b 73 53 3d 22 22 3b 66 6f 72 28 6b 73
        3d 30 3b 6b 73 26 6c 74 3b 6b 73 73 2e 6c 65 6e
        67 74 68 3b 6b 73 2b 2b 29 7b 6b 73 53 2b 3d 6b
        73 73 5b 6b 73 5d 3b 7d }
    condition:
        all of them
}

rule CrowdStrike_CSIT_17092_01 : geodo key mummy_spider trojan 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Geodo RSA Keys"
        reports = "CSIT-17092"
        version = "202101191528"
        last_modified = "2021-01-19"
        actor = "MUMMY SPIDER"
        malware_family = "Geodo"
    strings:
        // Generate Name
        // 0x69e08c ?? ?? 3a    lea    eax, dword ptr [edx + edi]
        // 0x69e08f 3b c7    cmp    eax, edi
        // 0x69e091 76 0a    jbe    0x69e09d
        // 0x69e093 80 38 2c    cmp    byte ptr [eax], 0x2c
        // 0x69e096 74 0a    je    0x69e0a2
        // 0x69e098 48    dec    eax
        // 0x69e099 3b c7    cmp    eax, edi
        // 0x69e09b 77 f6    ja    0x69e093
        // 0x69e09d 80 38 2c    cmp    byte ptr [eax], 0x2c
        // 0x69e0a0 75 01    jne    0x69e0a3
        $block1 = { 3a 3b c7 76 0a 80 38 2c 74 0a 48 3b c7 77 f6 80 38 2c 75 01 }
        // Decrypt Strings
        // 0x691d54 8b 16    mov    edx, dword ptr [esi]
        // 0x691d56 8d 49 08    lea    ecx, dword ptr [ecx + 8]
        // 0x691d59 33 55 08    xor    edx, dword ptr [ebp + 8]
        // 0x691d5c 8d 76 04    lea    esi, dword ptr [esi + 4]
        // 0x691d5f 0f b6 c2    movzx    eax, dl
        $block2 = { 8b 16 8d 49 08 33 55 08 8d 76 04 0f b6 c2 }
        // Setup Decrypt Verify Signature
        // 0x692505 8d 58 8c    lea    ebx, dword ptr [eax - 0x74]
        // 0x692508 83 f8 74    cmp    eax, 0x74
        // 0x69250b 73 08    jae    0x692515
        $block3 = { 8d 58 8c 83 f8 74 73 08 }
        /*
        malware_init_network_info
        .text:003F18E1 8B 48 18                mov     ecx, [eax+18h]
        .text:003F18E4 C7 40 04 E8 D3 3F 00    mov     dword ptr [eax+4], offset dword_3FD3E8
        .text:003F18EB C7 00 E8 D3 3F 00       mov     dword ptr [eax], offset dword_3FD3E8
        .text:003F18F1 C7 40 10 00 00 00 00    mov     dword ptr [eax+10h], 0
        .text:003F18F8 83 3C CD E8 D3 3F 00 00 cmp     dword_3FD3E8[ecx*8], 0
        */
        $c2_1 = {8B 48 18 C7 40 04 [4] C7 00 [4] C7 40 10 00 00 00 00 83 3C CD}
        /*
        malware_init_network_info
        .text:001F1861 8B 48 18                mov     ecx, [eax+18h]
        .text:001F1864 C7 00 08 D4 1F 00       mov     dword ptr [eax], offset g_C2_list
        .text:001F186A C7 40 08 08 D4 1F 00    mov     dword ptr [eax+8], offset g_C2_list
        .text:001F1871 C7 40 0C 00 00 00 00    mov     dword ptr [eax+0Ch], 0
        .text:001F1878 83 3C CD 08 D4 1F 00 00 cmp     g_C2_list[ecx*8], 0
        */
        $c2_2 = {8B 48 18 C7 00 [4] C7 40 08 [4] C7 40 0C 00 00 00 00 83 3C CD}
        /*
        malware_init_network_info
        .text:019C1861 8B 48 08                    mov     ecx, [eax+8]
        .text:019C1864 C7 40 0C ?? ?? ?? ??    mov     dword ptr [eax+0Ch], offset dword_19CD3D8
        .text:019C186B C7 40 20 ?? ?? ?? ??    mov     dword ptr [eax+20h], offset dword_19CD3D8
        .text:019C1872 C7 40 24 00 00 00 00    mov     dword ptr [eax+24h], 0
        .text:019C1879 83 3C CD D8 ?? ?? ?? ?? cmp     dword_19CD3D8[ecx*8], 0
        .text:019C1881 74 0E                   jz      short loc_19C1891
        */
        $c2_3 = {8B 48 08 C7 40 0C [4] C7 40 20 [4] C7 40 24 00 00 00 00 83 3C CD D8 [4] 74 0E}
        /*
        malware init network info
        .text:10019BDC EB 04                       jmp     short loc_10019BE2
        .text:10019BDE 41                          inc     ecx
        .text:10019BDF 89 48 04                    mov     [eax+4], ecx
        .text:10019BE2 39 34 CD D8 D2 01 10        cmp     g_c2_list_config[ecx*8], esi
        .text:10019BE9 75 F3                       jnz     short loc_10019BDE
        .text:10019BEB FF 75 DC                    push    [ebp+var_24]
        .text:10019BEE FF 75 F0                    push    [ebp+var_10]
        */
        $c2_4 = {eb ?? 41 89 48 04 39 34 cd [4] 75 ?? ff 75 ?? ff 75}
        /*
        .text:10003267 EB 04                             jmp     short loc_1000326D
        .text:10003269 40                                inc     eax
        .text:1000326A 89 41 30                          mov     [ecx+30h], eax
        .text:1000326D 39 14 C5 00 00 02 10              cmp     c2_list[eax*8], edx
        .text:10003274 75 F3                             jnz     short loc_10003269
        .text:10003276 8B 55 E4                          mov     edx, [ebp+var_1C]
        .text:10003279 8B 4D FC                          mov     ecx, [ebp+var_4]
        */
        $c2_5 = {eb 04 40 89 41 30 39 14 c5 [4] 75 ?? 8b 55 ?? 8b}
        $active_module_asm = {85 F6 74 5D 53 33 DB 83 7E 08 01 74 06 83 7E 08 02 75 03}
        $rsa_key1 = {3068026100a2652dff16cbf08e50dcdb9fcc5bcddd0740fcccde5a713895018ea13f2779f51f68d202902fb7331768b121339bfbf01804a00b325d29ac78d9c3f867facf17b87187496f71867affbe84afa78f4fd5e16a5b0b582d36834fc98163dceb2c7b0203010001}
        $rsa_key2 = {30680261009d7a401bf90acab47abb85cb806f4dc5e6988c9ea946f7bc209cf0aff33983a92ff5b0e8509d529bcf7ecf9147fb0b05a970b4a993d7889151a36625dca09c0294211591d4736dd2b4118abd290f842591796767d9596b34dfc8c57c04b09ab70203010001}
        $rsa_key3 = {3068026100BF2602352389E3FD0B450885D07DF37C3448E03BA841B81991AAD930836C0C83637274A64711B0060840189ECFE8E30F600E0F15059523E067296AFEEE9754AF93AA50241528198D86C055FB6D8DC3C7D8393BBEEC3AA2B964BE0FFF805826A90203010001}
        $rsa_key4 = {3068026100C7C0A69BF4E3CFF7A036149F92E09AC76647DA9829A1E394C71BEFF21BFA4930750D6EE44BC442529E9384F3CBF3E681B0773FCE1F2345A22929EE8ADCB261D05E8CE29F236ACEC2765D87444082624030B0A07FB280CBC7AB9E97B859A396370203010001}
        $rsa_key5 = {3068026100b1cd502a44b2f73b5a41bdfc7161571b6bd887fc08e6d9a1c01e82b75b7b0874654ab36d9f95dd4a090d2fa5ce3b74260e94be00602445c0388c3f156caf78b22aedee1df58c347c9f210a7d86d7ffb6b258cf316904971a92e6a560b907d1c90203010001}
        $rsa_key6 = {3068026100ada9a6b83c87246b9c4bbc7df2cada87687b015f51d41a16344496bcc95151a94043a92d9ef4438a0b40ea4087ada3dc9d863c527ab50b436518dc40084a3cd5430410f1bf279975068a92845fe1f6f4fea7330b24225d8f52ad0c9b8657a9f70203010001}
        $rsa_key7 = {3068026100AE262B2D5440574E524CC4502CCE70F0699B6EA50DD41080C1D0BCE2B73884C1470CDE8007CEA112FBAD98FCB97E2C5DC8EFB15782CD002EE60E4B8EA198C38C4F0895FE965C47AE72A8CDFE891C5A1A962983CE36D5D5E055D31458704281EB0203010001}
        $rsa_key8 = {3068026100c4a1ba5c6f35b3b8799781ed3f18eb8c23ebd59ae0a936ea91eb1300b991ec97a3e578183c4802dfa2c05c5e610d06cb948d500126198d233e5ffb836f6b2bf89fa6e7d6dbb7b4419cab0eb7a5e713972a7a7c289eb4aef9166886af3774a6f50203010001}
        $rsa_key9 = {3068026100dfadd733c8b85c616dbd57f54667ab3f63002a92ab16a185d411026e2af4fa8caa384635513be97fca32f7405cb5f4de3e1d38c4729a9596f777151dea6bfd1bcdeccd62ca6c4f630ccf847742fc6dd0f406a7623a6a2b6402abee31196a15630203010001}
        $rsa_key10 = {3068026100cb490037719f1364a404436860a53fc56a3c167b6cda9c100cb733e904e9d676047a82990b2585536fece08cedad8fb742ed8e2169b7c5bd94d525f40f30c48f102a0a005238c5f0dec2b93021cd077c58706f20eef2b4f15be43dd2313178d70203010001}
        $rsa_key11 = {3068026100eec4943d8788797f2a1ed5bcc806a772eb3f4dc4468f3db6a7c705b689df76b0d11c1453efcdc537fc71456c650ba2fea952d9e4a88a4533710c718a06a8fe125f559d48f936a42e67310fa426e537ddc3e3c2805324586ce2d7703901c94e0f0203010001}
        $rsa_key12 = {3068026100EDEBFCFC4D6CB3F996B31692642629866A738F9048EC6B7EEABE6FAF7C002CD4CA127919348F585EFDDC238C017D482C865D8826FD39EA6BE7B8FA475CF34280C48AC7CB5CF14C1A58D44ABDDD7D439FEABDDE7C04686235F2430114172F23890203010001}
        $rsa_key13 = {3068026100bf4a44a5aa725778d316d467a85187e7cf3648097bb2bed32d6b474505a9cd920669f2a11ff60ad77ef0c46f53cceb8b678d564541c42507d42b617f7004811a98da41af6bc80959caa5b378fb473b59cea1682fec0cf43367cff396ba2c8f010203010001}
        $rsa_key14 = {3068026100c3cb81c3b445074983f2d382292ee7b9c7e0a70bc070b14b495bca739484784a8d39e610dacc03689d51b2ba848d09459b628bda094a56f77b93598822be42bfcd076bbb64d45c846f3b6a26e6d27752f712834577265b0690905d0f16e387a70203010001}
    condition:
        uint16(0) == 0x5a4d and (all of ($block*) or $active_module_asm or 1 of ($rsa_key*) or 1 of ($c2_*))
}

rule CrowdStrike_CSIT_17172_02 : carbon_spider jsflash rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "CARBON SPIDER JSFlash obfuscated payload 2"
        reports = "CSIT-17172"
        version = "201906072016"
        last_modified = "2019-06-07"
        actor = "CARBON SPIDER"
        malware_family = "JSFlash"
    strings:
        // var srcTxt = ["
        $array_1 = { 76 61 72 20 73 72 63 54 78 74 20 3d 20 5b 22 }
        $array_2 = "srcTxt.join"
        // f.Write( b64dec('
        $array_3 = { 66 2e 57 72 69 74 65 28 20 62 36 34 64 65 63 28 27 }
        // ()[String.fromCharCode(101)+'va'+'l']
        $eval_1 = { 28 29 5b 53 74 72 69 6e 67 2e 66 72 6f 6d 43 68
        61 72 43 6f 64 65 28 31 30 31 29 2b 27 76 61 27
        2b 27 6c 27 5d }
        // [String.fromCharCode(101)+'v'+'al']
        $eval_2 = { 53 74 72 69 6e 67 2e 66 72 6f 6d 43 68 61 72 43
        6f 64 65 28 31 30 31 29 2b 27 76 27 2b 27 61 6c
        27 5d }
        // [String.fromCharCode(101)+'va'+'l']
        $eval_3 = { 5b 53 74 72 69 6e 67 2e 66 72 6f 6d 43 68 61 72
        43 6f 64 65 28 31 30 31 29 2b 27 76 61 27 2b 27
        6c 27 5d }
        // new ActiveXObject("CDO.Message")
        $cd0_1 = { 6e 65 77 20 41 63 74 69 76 65 58 4f 62 6a 65 63
        74 28 22 43 44 4f 2e 4d 65 73 73 61 67 65 22 29 }
        $cd0_2 = "<w:r><w:t>CDO.Message</w:t>"
    condition:
        (1 of ($array*)) and (1 of ($eval*)) and (1 of ($cd0*))
}

rule CrowdStrike_CSIT_18006_03 : b374k webshell 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects the B374K PHP webshell when it is compressed and base64 encoded"
        reports = "CSIT-18006"
        version = "201710210000"
        last_modified = "2017-10-21"
        malware_family = "B374K Webshell"
    strings:
        $md5pass = "// sha1(md5(pass))"
        $createfunction = { 22 63 72 22 2e 22 65 61 74 22 2e 22 65 5f 66 75 6e 22 2e 22 63 74 69 22 2e 22 6f 6e 22 3b }
        $b374k = "$b374k(\""
    condition:
        any of them
}

rule CrowdStrike_CSIT_18006_04 : b374k webshell 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects the B374K webshell once it has been base64 decoded and decompressed"
        reports = "CSIT-18006"
        version = "201710210000"
        last_modified = "2017-10-21"
        malware_family = "B374K Webshell"
    strings:
        $b374k_1 = "'b374k'"
        $b374k_2 = "\"b374k\""
        $block_spider = "bot|spider|crawler|slurp|teoma|archive|track|snoopy|java|lwp|wget|curl|client|python|libwww"
        $function_block_bot = "function block_bot()"
    condition:
        2 of them
}

rule CrowdStrike_CSIT_18006_05 : b374k webshell 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects emails sent by the B374K webshell"
        reports = "CSIT-18006"
        version = "201710210000"
        last_modified = "2017-10-21"
        malware_family = "B374K Webshell"
    strings:
        $mime = "MIME-Version: 1.0\x0d\x0aFrom: "
        $content_type_1 = /Content-Type: multipart\/mixed; boundary=\"[0-9a-f]{32}\"\r\n\r\n/
        $content_type_2 = "Content-Type: text/html; charset=\"UTF-8\"\x0d\x0aContent-Transfer-Encoding: 8bit\x0d\x0a\x0d\x0a"
    condition:
        all of them
}

rule CrowdStrike_CSIT_17179_03 : cutwail bot unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Cutwail Original, matching on memory dumps"
        reports = "CSIT-17179"
        version = "201710230000"
        last_modified = "2017-10-23"
        actor = "NARWHAL SPIDER"
        malware_family = "Cutwail"
    strings:
        $ = "gangrena"
        $ = "germeona"
        $ = "garbaga"
        $ = "work/filelist.php"
        $ = "configver"
        $ = "Poshel-ka ti na hui drug aver"
    condition:
        4 of them
}

rule CrowdStrike_CSIT_17184_02 : helix_kitten ismagent packer 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "ISMAgent .NET packer"
        reports = "CSIT-17184"
        version = "201710230000"
        last_modified = "2017-10-23"
        actor = "HELIX KITTEN"
        malware_family = "ISMAgent"
    strings:
        $1 = "Tsk1" wide
        $2 = "Tsk2" wide
        $3 = "cmd.exe /c" wide
        $4 = "Inner"
        $5 = "Joiner"
        $6 = "\\RegAsm.exe" wide
    condition:
        uint16(0) == 0x5a4d and
        uint32(uint32(0x3C)) == 0x00004550 and
        // .Net Directory
        uint32(uint32(0x3c) + 0xe8) > 0 and
        all of them
}

rule CrowdStrike_CSIT_18013_01 : tidal_spider cutwail bot unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Cutwail version 1, matching on memory dumps"
        reports = "CSIT-18013"
        version = "201710230000"
        last_modified = "2017-10-23"
        malware_family = "Cutwail"
        actor_name = "TIDAL SPIDER"
    strings:
        $ = "Poshel-ka ti na hui drug aver"
        $ = "212.95.32.84"
        $ = "/host:"
        $ = "/port:"
        $ = "hotmail.com"
        $ = "MailerApp.pdb"
    condition:
        5 of them
}

rule CrowdStrike_CSIT_18013_03 : cutwail bot unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Cutwail Original, matching on memory dumps "
        reports = "CSIT-18013"
        version = "201710230000"
        last_modified = "2017-10-23"
        malware_family = "Cutwail"
    strings:
        $ = "gangrena"
        $ = "germeona"
        $ = "garbaga"
        $ = "work/filelist.php"
        $ = "configver"
        $ = "Poshel-ka ti na hui drug aver"
    condition:
        4 of them
}

rule CrowdStrike_CSIT_17179_01 : cutwail bot unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Cutwail version 1, matching on memory dumps"
        reports = "CSIT-17179"
        version = "201807271749"
        last_modified = "2018-07-27"
        actor = "NARWHAL SPIDER"
        malware_family = "Cutwail"
    strings:
        $ = "Poshel-ka ti na hui drug aver"
        $ = "212.95.32.84"
        $ = "/host:"
        $ = "/port:"
        $ = "hotmail.com"
        $ = "MailerApp.pdb"
    condition:
        5 of them
}

rule CrowdStrike_CSIT_17184_01 : helix_kitten ismagent rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "ISMAgent implant"
        reports = "CSIT-17184"
        version = "201903181806"
        last_modified = "2019-03-18"
        actor = "HELIX KITTEN"
        malware_family = "ISMAgent"
    strings:
        $ = "Content-Type: multipart/form-data;"
        $ = "myboundary"
        $ = "Content-Disposition: form-data; name="
        $ = "AgentV2.exe  -c  SampleDomain.com"
        $ = "n.n.c."
        $ = "upload/"
        $ = "action2/"
        $ = "response/"
        $ = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"
        $ = "%%%%"
        $ = "^^^^^^^^^^^"
    condition:
        9 of them
}

rule CrowdStrike_CSIT_17183_01 : badrabbit dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects BadRabbit Dropper"
        reports = "CSA-17315,CSIT-17183"
        version = "201710250000"
        last_modified = "2017-10-25"
        malware_family = "BadRabbit"
    strings:
        $rundll32 = "\\rundll32.exe" wide
        $infpub1 = "C:\\Windows\\infpub.dat" wide
        $export = "%ws C:\\Windows\\%ws,#1 %ws" wide
        $xor_loop = { 8a 0e 8b c3 80 f1 e9 48 75 fa 88 0e 8b 06 }
    condition:
        3 of them
}

rule CrowdStrike_CSIT_17183_02 : badrabbit wiper ransomware 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects BadRabbit core file"
        reports = "CSA-17315,CSIT-17183"
        version = "201710250000"
        last_modified = "2017-10-25"
        malware_family = "BadRabbit"
    strings:
        $task_delete_rhaegal = "schtasks /Delete /F /TN rhaegal" wide
        $task_create_rhaegal = "schtasks /Create /RU SYSTEM /SC ONSTART /TN rhaegal /TR \"%ws /C Start \\\"\\\" \\\"%wsdispci.exe\\\" -id %u && exit\"" wide
        $task_delete_drogon = "schtasks /Delete /F /TN drogon" wide
        $task_create_drogon = "schtasks /Create /SC once /TN drogon /RU SYSTEM /TR \"%ws" wide
        $ddriver = "Windows Client Side Caching DDriver" wide
        $cscc_dat = "cscc.dat"
        $ransom_note1 = "Oops! Your files have been encrypted." wide
        $ransom_note2 = "If you see this text, your files are no longer accessible" wide
        $ransom_note3 = "You might have been looking for a way to recover your files" wide
        $ransom_note4 = "We  guarantee that you can recover all your files safely." wide
        $ransom_note5 = "Your personal installation key#2:" wide
        $exts = ".3ds.7z.accdb.ai.asm.asp.aspx.avhd.back.bak.bmp.brw.c.cab" wide
        $pub_key = "MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA5clDuVFr5sQxZ" wide
    condition:
        8 of them
}

rule CrowdStrike_CSIT_17183_03 : badrabbit wiper ransomware 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects BadRabbit disk cryptor"
        reports = "CSA-17315,CSIT-17183"
        version = "201710250000"
        last_modified = "2017-10-25"
        malware_family = "BadRabbit"
    strings:
        $enter_pw1 = "Enter password#1: " wide
        $enter_pw2 = "Enter password#2: " wide
        $dcrypt = "\\\\.\\dcrypt" wide
        $cscc = "C:\\Windows\\cscc.dat" wide
        $task_create_viserion = "schtasks /Create /SC ONCE /TN viserion_%u /RU SYSTEM /TR " wide
        $task_delete = "schtasks /Delete /F /TN %ws" wide
        $decrypt_lnk = "\\Desktop\\DECRYPT.lnk" wide
        $disable_av = "Disable your anti-virus and anti-malware programs" wide
        $pub_key = "MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA5clDuVFr5sQxZ+feQlVvZcEK0k4uCSF5SkOkF9A3tR6O/xAt89/PVhowvu2TfBTRsnBs83" wide
        $exts = ".3ds.7z.accdb.ai.asm.asp.aspx.avhd.back.bak.bmp.brw.c.cab.cc.cer.cfg.conf.cpp.crt.cs.ctl.cxx.dbf.der.dib.disk.djvu" wide
    condition:
        8 of them
}

rule CrowdStrike_CSIT_17183_04 : badrabbit wiper ransomware unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects BadRabbit unpacked dll"
        reports = "CSA-17317,CSIT-17183"
        version = "201710250000"
        last_modified = "2017-10-25"
        malware_family = "BadRabbit"
    strings:
        // Hard coded SMB NTLM auth data structure
        $ntlm_auth =  { b1 ab b3 b2 ac ac af }
        // Detection for kernel pool leak (MS17-010)
        $leak_1 = { 81 f1 46 72 61 67 }
        $leak_2 = { 81 f2 4c 53 74 72 }
        // NotPetya string overlap
        $deljournal = "fsutil usn deletejournal /D %c:" fullword wide
        $pipe = "\\\\.\\pipe\\%ws" fullword wide
    condition:
        all of them
}

rule CrowdStrike_CSIT_17172_03 : carbon_spider delivery_document 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects malicious RTF documents in use by CARBON SPIDER. It may also alert on malicious documents in use by other actors."
        reports = "CSA-17267,CSIT-17172"
        version = "201807271851"
        last_modified = "2018-07-27"
        actor = "CARBON SPIDER"
        malware_family = "JSFlash"
    strings:
        $hdr = "{\\rt"
        $img = { 38 39 35 30 34 65 34 37 30 64 30 61 31 61 30 61
        30 30 30 30 30 30 30 64 34 39 34 38 34 34 35 32
        30 30 30 30 30 32 37 35 30 30 30 30 30 31 66 32
        30 38 30 36 30 30 30 30 30 30 38 64 61 61 33 38
        61 39 30 30 30 30 30 30 30 39 37 30 34 38 35 39
        37 33 30 30 30 30 30 65 63 33 30 30 30 30 30 65
        63 33 30 31 63 37 36 66 61 38 36 34 30 30 30 30
        32 30 30 30 34 39 34 34 34 31 35 34 37 38 39 63
        0d 0a 65 63 62 64 64 62 38 66 32 34 64 39 37 64
        65 37 66 37 33 39 32 37 61 65 39 39 35 39 62 37
        61 65 61 65 65 61 39 65 39 65 39 65 66 62 30 63
        36 37 34 38 32 64 36 39 38 61 62 32 65 38 39 35
        39 37 38 34 31 36 65 32 61 65 31 37 30 62 65 62
        34 31 36 62 32 66 30 34 31 38 37 65 66 37 61 62
        66 66 30 34 63 31 64 38 35 37 66 66 30 31 37 65
        66 35 39 66 32 30 63 33 33 30 65 30 32 37 33 64
        61 63 0d 0a 36 64 32 63 36 34 35 32 61 32 32 38 }
    condition:
        ($hdr at 0) and all of them
}

rule CrowdStrike_CSIT_17183_05 : swc javascript 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Malicious JavaScript inject (version 2) installed on web servers to redirect visitors to SWC landing pages"
        reports = "CSIT-17183"
        version = "201711020000"
        last_modified = "2017-11-02"
    strings:
        $inj = "InjectionString"
        $form = "application/x-www-form-urlencoded"
        $enc_form = "\\x61\\x70\\x70\\x6C\\x69\\x63\\x61\\x74\\x69\\x6F\\x6E\\x2F\\x78\\x2D\\x77\\x77\\x77\\x2D\\x66\\x6F\\x72\\x6D\\x2D\\x75\\x72\\x6C\\x65\\x6E\\x63\\x6F\\x64\\x65\\x64"
        $ans = "ans"
        $enc_ans = "\\x61\\x6E\\x73"
        $state = "c_state"
        $enc_and = "\\x63\\x5F\\x73\\x74\\x61\\x74\\x65"
    condition:
        filesize < 100KB and
        $inj and ($form and $ans and $state) or 3 of ($enc_*)
}

rule CrowdStrike_CSIT_17182_01 : chattycrc loader wet_panda 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Exported names found in ChattyCRC loader samples"
        reports = "CSIT-17182"
        version = "202006091529"
        last_modified = "2020-06-09"
        actor = "WET PANDA"
        malware_family = "ChattyCRC"
    strings:
        $str_loadcode = "LoadCode.dll"
        $str_loader = "Loader.dll"
        $str_runndllentry = "_Rundll32Entry@16"
        $str_servicentry = "_ServiceEntry@8"
    condition:
        filesize < 2MB and 2 of them
}

rule CrowdStrike_CSIT_17182_02 : chattycrc loader wet_panda 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Code fragments observed in ChattyCRC loader samples"
        reports = "CSIT-17182"
        version = "202006091529"
        last_modified = "2020-06-09"
        actor = "WET PANDA"
        malware_family = "ChattyCRC"
    strings:
        $code_1 = { 8b ?? ?? d1 ?? [1-2] 20 83 b8 ed 89 }
        $code_va_10004499 = { 33 14 85 ?? ?? ?? ?? 89 55 08 8b 4d 0c 83 c1 01 89 4d 0c }
    condition:
        filesize < 1MB and all of them
}

rule CrowdStrike_CSIT_18006_01 : alfashell_webshell webshell credential_theft 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects code injected into a content management system by the Alfa Webshell for the purpose of credential theft."
        reports = "CSIT-18006"
        version = "201711150000"
        last_modified = "2017-11-15"
        malware_family = "Alfashell Webshell"
    strings:
        $vbull_alfauser = "$alfa_username"
        $vbull_alfapass = "$alfa_password"
        $wp_save_creds = { 66 77 72 69 74 65 28 24 66 70 2c 20 24 5f 50 4f 53 54 5b 5c 27 6c 6f 67 5c 27 5d 2e 22 20 3a 20 22 2e 24 5f 50 4f 53 54 5b 5c 27 70 77 64 5c 27 5d 2e 22 20 28 22 2e 28 24 75 73 65 72 2d 3e 75 73 65 72 5f 65 6d 61 69 6c 29 2e 22 29 5c 6e 22 29 3b }
        $joomla_auth = "$Alfa_auth"
        $joomla_data = "$Alfa_data"
        $joomla_options = "$Alfa_options"
        $joomla_response = "$Alfa_response"
        $whmcs_file = "$alfa_file"
        $whmcs_uname = "$alfa_uname"
        $whmcs_pw = "$alfa_pw"
        $mybb_q = "$alfa_q"
        $mybb_fetch = "$alfa_fetch"
        $mybb_file = "$alfa_file"
        $ips_password = "'ips_password'"
        $phpbb_u = "$Alfa_u"
        $phpbb_p = "$Alfa_p"
        $phpbb_response = "$Alfa_response"
    condition:
        all of ($vbull*) or $wp_save_creds or all of ($joomla*) or all of ($whmcs*) or all of ($mybb*) or ($mybb_q and $mybb_file and $ips_password) or all of ($phpbb*)
}

rule CrowdStrike_CSA_17342_01 : fancy_bear channelingloader loader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "FANCY BEAR ChannelingLoader, XOR algorithm"
        reports = "CSA-17342"
        version = "201810041416"
        last_modified = "2018-10-04"
        actor = "FANCY BEAR"
        malware_family = "ChannelingLoader"
    strings:
        $algo = { b8 a3 8b 2e ba f7 e6 c1 ea 04 6b d2 16 8b c6 2b
        c2 03 cb 0f b6 04 85 88 7a }
    condition:
        $algo
}

rule CrowdStrike_CSA_17342_02 : fancy_bear channelingloader loader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "FANCY BEAR ChannelingLoader, XOR key"
        reports = "CSA-17342"
        version = "201810041415"
        last_modified = "2018-10-04"
        actor = "FANCY BEAR"
        malware_family = "ChannelingLoader"
    strings:
        $ = { bc 05 ee 91 ea cb 98 1b d4 a7 26 6c 89 e8 9d 8c 93 c9 5f 74 b3 40 }
        $ = { 80 8C 51 F4 D6 70 3A C6 35 B9 9D 25 18 8B 8A 05 6E 6C }
        $ = { 5E 43 74 70 D7 FD 5B C3 26 80 FC FB 10 D6 74 17}
    condition:
        any of them
}

rule CrowdStrike_CSIT_17039_04 : fancy_bear zekapab rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "FANCY BEAR Zekapab"
        reports = "CSIT-17039"
        version = "201807301803"
        last_modified = "2018-07-30"
        actor = "FANCY BEAR"
        malware_family = "Zekapab"
    strings:
        $ = "TInterfacedPersistent"
        $ = "TBaseDragControlObject"
        $ = "TIdSocketListWindows"
        $ = "TIdIPAddress"
        $ = "TIdCriticalSection"
        $ = { ff ff ff ff 02 00 00 00 30 78 00 00 }
        $ = { 54 50 46 30 06 54 46 6f 72 6d 31 05 46 6f 72 6d 31 04 4c 65 66 74 02 00 03 54 6f 70 02 00 }
        $ = { ff ff ff ff ?? 00 00 00 36 38 37 34 37 34 37 30 33 41 32 46 32 46 }
    condition:
        all of them
}

rule CrowdStrike_CSIT_17178_01 : helix_kitten loader nautilus venomous_bear 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Nautilus loader"
        reports = "CSIT-17178"
        version = "201910231100"
        last_modified = "2019-10-23"
        actor = "HELIX KITTEN, VENOMOUS BEAR"
        malware_family = "Nautilus"
    strings:
        $a_key = "1B1440D90FC9BCB46A9AC96438FEEA8B"
        $a_guid = "3FDA3998-BEF5-426D-82D8-1A71F29ADDC3"
        $a_path = "C:\\ProgramData\\Microsoft\\Windows\\Caches\\{%s}.2.ver0x0000000000000"
        $a_name = "payload.x64.dll.system"
        $b_export = "ServiceMain"
        $b_priv = "SeDebugPrivilege"
        $b_err1 = "DLL and target process must be same architecture"
        $b_err2 = "Could not get reflective loader offset"
    condition:
        (1 of ($a*)) and (1 of ($b*))
}

rule CrowdStrike_CSIT_17178_02 : helix_kitten nautilus rat venomous_bear 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Nautilus main payload"
        reports = "CSIT-17178"
        version = "201910231104"
        last_modified = "2019-10-23"
        actor = "HELIX KITTEN, VENOMOUS BEAR"
        malware_family = "Nautilus"
    strings:
        $a_ref = "http://www.bing.com/search?q=%s&go=Submit&qs=n&pq=%s"
        $a_frmt = "proto=%s,host=%s,port=%s"
        $a_cookie = "ASP.Net_sessionId"
        $a_config = "ctx.system"
        $a_key = "1B1440D90FC9BCB46A9AC96438FEEA8B"
        $b_1 = "O_001"
        $b_2 = "O_002"
        $b_3 = "O_003"
        $b_4 = "O_004"
        $b_err = "Failed to start agent! error code:"
        $b_lua = "$LuaVersion: Lua"
    condition:
        (1 of ($a*)) and (2 of ($b*))
}

rule CrowdStrike_CSIT_17180_01 : delivery_document helix_kitten neuron venomous_bear 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Neuron lure document"
        reports = "CSIT-17180"
        version = "201910231155"
        last_modified = "2019-10-23"
        actor = "HELIX KITTEN, VENOMOUS BEAR"
        malware_family = "Neuron"
    strings:
        $ = "-----BEGIN CERTIFICATE-----"
        $ = "-----END CERTIFICATE-----"
        $ = "\\\\Signature.crt"
        $ = "\\\\Sign.exe"
        $ = "cmd.exe /c certutil -decode"
        $ = "= s & \""
        $ = "s = s"
    condition:
        uint32(0) == 0xe011cfd0 and
        all of them
}

rule CrowdStrike_CSIT_17180_02 : helix_kitten neuron rat venomous_bear 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Neuron malware"
        reports = "CSIT-17180"
        version = "201910231156"
        last_modified = "2019-10-23"
        actor = "HELIX KITTEN, VENOMOUS BEAR"
        malware_family = "Neuron"
    strings:
        $ = "neuron-client"
        $ = "neuron_client"
        $ = "GenerateKeepAlive"
        $ = "EncryptScript"
        $ = "FindSPath"
        $ = "ExecCMD"
        $ = "MSXEWS"
        $ = "KeepAliveLastOK"
        $ = "cadata" wide
        $ = "WebClientApi" wide
        $ = "PipeClientApi" wide
    condition:
        uint16(0) == 0x5a4d and
        uint32(uint32(0x3c)) == 0x00004550 and
        uint32(uint32(0x3c) + 0xe8) > 0 and
        filesize < 200KB and filesize > 10KB and
        4 of them
}

rule CrowdStrike_CSIT_18006_02 : alfashell_webshell webshell 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects Alfashell webshell"
        reports = "CSIT-18006"
        version = "201711170000"
        last_modified = "2017-11-17"
        malware_family = "Alfashell webshell"
    strings:
        $user = "'user'" fullword
        $pass = "'pass'" fullword
        $safemode = "'safemode'" fullword
        $login_page = "'login_page'" fullword
        $post_encryption = "'post_encryption'" fullword
        $__ZW5jb2Rlcg = "__ZW5jb2Rlcg" fullword
    condition:
        all of them
}

rule CrowdStrike_CSIT_17177_02 : neutrino_bot loader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects Neutrino bot loader"
        reports = "CSIT-17177"
        version = "201807301024"
        last_modified = "2018-07-30"
        malware_family = "Neutrino Bot, Kasidet"
    strings:
        $aa = "enter" wide
        $ab = "bc00595440e801f8a5d2a2ad13b9791b"
        $ac = "application/x-www-form-urlencoded"
        $af = "schannel.dll" wide
        $ai = "<!---"
    condition:
        uint16(0) == 0x5A4D and all of ($a*)
}

rule CrowdStrike_CSA_17355_01 : android hawup labyrinth_chollima rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Hawup implant for Android"
        reports = "CSA-17355"
        version = "202003301406"
        last_modified = "2020-03-30"
        actor = "LABYRINTH CHOLLIMA"
        malware_family = "Hawup"
    strings:
        $ = "chown system:system %s"
        $ = "%04d-%02d-%02d %02d:%02d"
        $ = "%s 2>&1"
    condition:
        all of them
}

rule CrowdStrike_CSIT_18006_06 : php webshell 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects possible PHP-based webshells. The strings below are frequently used to obfuscate malicious webshell code."
        reports = "CSIT-18006"
        version = "201905011120"
        last_modified = "2019-05-01"
    strings:
        $php = "<?php"
        $eval_b64decode = "eval(base64_decode("
        $eval_gzinflate_b64decode = "eval(gzinflate(base64_decode("
        $eval_gzinflate_rot13_b64decode = "eval(gzinflate(str_rot13(base64_decode("
    condition:
        $php and any of ($eval*)
}

rule CrowdStrike_CSIT_18006_07 : c99 commodity webshell 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects the C99 Webshell"
        reports = "CSIT-18006"
        version = "202001281650"
        last_modified = "2020-01-28"
        malware_family = "C99 Webshell"
    strings:
        $c99sh_surl = "\"c99sh_surl\""
        $find_suids = { 22 63 72 22 2e 22 65 61 74 22 2e 22 65 5f 66 75 6e 22 2e 22 63 74 69 22 2e 22 6f 6e 22 3b }
        $menu_encoder = "<b>Encoder</b>"
        $menu_proc = "<b>Proc.</b>"
        $menu_ftp_brute = "<b>FTP brute</b>"
        $menu_php_code = "<b>PHP-code</b>"
        $menu_logout = "<b>Logout</b>"
    condition:
        $c99sh_surl or $find_suids or all of ($menu_*)
}

rule CrowdStrike_CSA_17377_01 : mother360 dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Mother360 dropper used to deploy Gh0st RAT"
        reports = "CSA-17377"
        version = "201807301049"
        last_modified = "2018-07-30"
        malware_family = "Mother360"
    strings:
        // payload end marker string
        $ = "SSSSSSVID:2013-SV1"
        // encrypted payload PE header
        $ = { 2D 20 6E FE FB FE FE FE  FA FE FE FE FF FF FE FE }
    condition:
        all of them
}

rule CrowdStrike_CSIT_18017_01 : port_scanner post_exploitation 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Commodity port scanner masking as logger daemon"
        reports = "CSIT-18017"
        version = "201712030000"
        last_modified = "2017-12-03"
    strings:
        $ = "Usage: %s <b-block> <port> [c-block]"
        $ = "Invalid b-range."
        $ = "Unable to allocate socket."
        $ = "%s.pscan.%s"
        $ = "%s.%s.pscan.%s"
        $ = "klogd -x"
    condition:
        all of them
}

rule CrowdStrike_CSIT_18017_02 : proxy post_exploitation perl 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Modified version of legitimate SOCKS5 server written in Perl"
        reports = "CSIT-18017"
        version = "201712030000"
        last_modified = "2017-12-03"
    strings:
        $ = "IO::Socket::INET"
        $ = "kjournald"
        $ = "Listen=>"
        $ = "Process (%s) has entered into background.\\n"
        $ = "Could not bind to %s:%s\\n"
        $ = "socks_connect($client, $host, $port);"
    condition:
        all of them
}

rule CrowdStrike_CSIT_18017_06 : port_scanner post_exploitation 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Commodity port scanner, source code openly available"
        reports = "CSIT-18017"
        version = "201712030000"
        last_modified = "2017-12-03"
    strings:
        $ = "Usage: %s <b-block> <port> [c-block]"
    condition:
        all of them
}

rule CrowdStrike_CSIT_18017_07 : thc_hydra post_exploitation 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "THC-Hydra, a multi-threaded network logon cracker with support for a wide variety of services"
        reports = "CSIT-18017"
        version = "201712030000"
        last_modified = "2017-12-03"
    strings:
        $ = "Note: 'h' will add the user-defined header at the end"
        $ = "hydra smb://microsoft.com  -l admin -p D5731CFC6C2A069C21FD0D49CAEBC9EA:2126EE7712D37E265FD63F2C84D2B13D"
        $ = "is the maximum number of characters in the password"
        $ = "expects a filename containing a list of path to some unencrypted"
        $ = "AUTHENTICATE CRAM-MD5"
    condition:
        all of them
}

rule CrowdStrike_CSIT_18017_08 : post_exploitation 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Tool to filter passwords list by length and character set"
        reports = "CSIT-18017"
        version = "201712030000"
        last_modified = "2017-12-03"
    strings:
        $ = "Error: -c MINSETS is larger than the sets defined"
        $ = "Error: -m MINLEN is greater than -M MAXLEN"
        $ = "printable characters (which are not -l/-n/-p, e.g. $,!,/,(,*, etc.)"
        $ = "Usage only allowed for legal purposes."
        $ = "Use for hacking: trim your dictionary file to the pw requirements of the target."
        $ = "Use for security: check passwords, if 0 is returned, reject password choice."
    condition:
        all of them
}

rule CrowdStrike_CSIT_18017_09 : proxy 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Legitimate SOCKS proxy application but used by malicious actor during operations"
        reports = "CSIT-18017"
        version = "201712030000"
        last_modified = "2017-12-03"
    strings:
        $ = "xsocks  [-l port] [-t] [-p1 port] [-p2 port] [-s ip:port]"
        $ = "./src/utils/AutoCleanup.h"
        $ = "The disire DomainName : %s"
    condition:
        all of them
}

rule CrowdStrike_CSIT_18017_03 : fakesethc 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Encoded strings in FakeSetHC"
        reports = "CSIT-18017"
        version = "201911271019"
        last_modified = "2019-11-27"
        malware_family = "FakeSetHC"
    strings:
        $dotnet_magic = "BSJB"
        $dotnet_stream_1 = "#Strings"
        $dotnet_stream_2 = "#US"
        $dotnet_stream_3 = "#GUID"
        $dotnet_stream_4 = "#Blob"
        $obfuscated_01 = "H4sIAAAAAAAEAAEWAOn/mcHRjbG8DAyN6Oqnk+JgYen++7uYk3E5E/4WAAAA" wide // Global\\\\SETHC2017SETHC
        $obfuscated_02 = "H4sIAAAAAAAEAAEdAOL/jdnfnaTwHTWw2OKzgKI/N6zM05yMjAMkv9/KmqBguTj4HQAAAA==" wide // Start Menu\\\\Programs\\\\Startup
        $obfuscated_03 = "H4sIAAAAAAAEAAExAM7/8dmevZWXDwOEjZGL8IxyE+Tx4pi5vjQ/qd7is6OpIyS7wI3djIwjNarexMG1qDUM/IwpPuMxAAAA" wide // /t REG_SZ /d \\\"C:\\\\windows\\\\system32\\\\setsz.exe\\\"
        $obfuscated_04 = "H4sIAAAAAAAEAAExAM7/k8Tdnb+jPzaq8eK4ub40P6ne4rODpDEiqo3zir6lDAyO39GIorE9I4Lx7ZuxoiQlrpYHgmsxAAAA" wide // Microsoft\\\\Windows\\\\Start Menu\\\\Programs\\\\Startup
        $obfuscated_05 = "H4sIAAAAAAAEAAFuAJH/go/2pJydDAyN4vi7h5ECFYLx84azoj8jscvKs4yHOT66wsmc8J4EDILuy52itT4kiMjMnLm/PgyC5NOOt7VwFrfB28+VqDUzq9nXgL7wHyCqxNGBo4wMI7vZ1oz+tSg1go+ewKbwFDW82NmItaJkmK6DbgAAAA==" wide // \\\"HKLM\\\\SOFTWARE\\\\Microsoft\\\\Windows NT\\\\CurrentVersion\\\\Image File Execution Options\\\\sethc.exe\\\" /v Debugger
        $obfuscated_06 = "H4sIAAAAAAAEAAGAAH//7JX81+WTZxHv6I3b4eNnFpyeh9eSk2FpnJSP35TgaWLu7IrY4ecRE5qZit+U5Glh6JyNruOTZGbu6Yeq4+BhE5qcj9ji6BMSm++G2ufkZxGbmv2p4JIRY+2Yiq7h5mdo5p2HruKVYhOb6Ivak+EUYebrjN2S4RVg5uv62uLlERJopzhfgAAAAA==" wide // 28B85C7A1E34137FB398BC19B910D0920A4717ACD440D491613A3C460D9E301CD11728CBEB85747AE7CF0BA3354A1678809A2E2CEE55C1D18F22B1E08FD525AB
        $obfuscated_07 = "H4sIAAAAAAAEAFs69/D51Q91AShmC34HAAAA" wide // {0} {1}
        $obfuscated_08 = "H4sIAAAAAAAEAFs69/D51Q91C5bOPwwAZ1DpHAsAAAA=" wide // {0} {1} {2}
        $obfuscated_09 = "H4sIAAAAAAAEAFs69/D51Q91Cz6eBgAJeIo4CgAAAA==" wide // {0} {1} /f
        $obfuscated_10 = "H4sIAAAAAAAEAFt74lT75n+mGrsBtznpIwkAAAA=" wide // sethc.exe
        $obfuscated_11 = "H4sIAAAAAAAEAFt74tScVf9MNXYDABw+CCcJAAAA" wide // setsz.exe
        $obfuscated_12 = "H4sIAAAAAAAEAJt/91zzzs2GKtsPXTg/ZaOKIQDl7SovEAAAAA==" wide // Application Data
        $obfuscated_13 = "H4sIAAAAAAAEAJv/8hcAeHXa2wMAAAA=" wide // ADD
        $obfuscated_14 = "H4sIAAAAAAAEAJv14tOqlqkAhiSRMgYAAAA=" wide // DELETE
        $obfuscated_15 = "H4sIAAAAAAAEANt14s6s7dtNlQDrOkkUCAAAAA==" wide // debugger
        $obfuscated_16 = "H4sIAAAAAAAEANt9/0zDolcArjUqywYAAAA=" wide // error:
        $obfuscated_17 = "H4sIAAAAAAAEANty5kTfrkWm/Kvv3upbsrXOdNkJAAB2L5ISAAAA" wide // javajre_update.exe
        $obfuscated_18 = "H4sIAAAAAAAEAOt58fPg1hWmAGGz4FAHAAAA" wide // REG.exe
        $obfuscated_19 = "H4sIAAAAAAAEAOv/8XtvJwBWmdjKBQAAAA==" wide // QUERY
        $obfuscated_20 = "H4sIAAAAAAAEAPt4bt6a+Q2cBR+/zNv8aXWCblM/iE4E0gARPoOmGgAAAA==" wide // /c COPY /Y \\\"{0}\\\" \\\"{1}\\\"
        $obfuscated_21 = "H4sIAAAAAAAEAPv4bt6UB2sLtN9fAACLVZxRCgAAAA==" wide // /C {0} {1}
    condition:
        all of ($dotnet_*) and any of ($obfuscated_*)
}

rule CrowdStrike_CSIT_18017_04 : deadbeefkeylogger keylogger 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Encoded strings in DeadBeef Keylogger"
        reports = "CSIT-18017"
        version = "201911271019"
        last_modified = "2019-11-27"
        malware_family = "DeadbeefKeylogger"
    strings:
        $dotnet_magic = "BSJB"
        $dotnet_stream_1 = "#Strings"
        $dotnet_stream_2 = "#US"
        $dotnet_stream_3 = "#GUID"
        $dotnet_stream_4 = "#Blob"
        $obfuscated_01 = "H4sIAAAAAAAEAAEcAOP/4t7Knb++N26lncPT/6MkIrHD2dHssiJugt/igfddllocAAAA" wide // <strong>{0}</strong><br>\\r\\n
        $obfuscated_03 = "H4sIAAAAAAAEAAErANT/jdTNm7W9Y2KC8dqduaY1Iq3x4oqkswwMu9XOg7+iNSLwyMaK/rM/PrjE2UO6g50rAAAA" wide // System32\\\\drivers\\\\etc\\\\explorer.exe.config
        $obfuscated_04 = "H4sIAAAAAAAEAFs69/D5/50FPH+u9U/q+QSie4A0AKwr0k8WAAAA" wide // {0} /Y \\\"{1}\\\" \\\"{2}\\\"
        $obfuscated_05 = "H4sIAAAAAAAEAFt14uxsAEoCp4UEAAAA" wide // test
        $obfuscated_07 = "H4sIAAAAAAAEAGu6/6jxzUyGvKVzD1/+D6SbQPxWZtGeyUfvrn1Tz9r74s3FnkU8dkvnHN68qMcOAJhdg8EvAAAA" wide // \\r\\n<IP>{0}</IP>\\r\\n<USER>{2}</USER>\\r\\n{1}\\r\\n
        $obfuscated_10 = "H4sIAAAAAAAEAJt58GLvxj08PLOvnmvev8hUqXt+371nqxN0AYFTMU0YAAAA" wide // Global\\\\ExplorerU2016{0}
        $obfuscated_11 = "H4sIAAAAAAAEAJt748zcrftUCrr/f7r6YXWCLgCYeyZKEAAAAA==" wide // Current URL: {0}
        $obfuscated_12 = "H4sIAAAAAAAEAJt9+FTXog9ypit7X++d86oAACgzz8APAAAA" wide // Enter New URL:
        $obfuscated_13 = "H4sIAAAAAAAEAJt99Vzz/kWmSv/m9917BgCJyvamDQAAAA==" wide // Explorer 2016
        $obfuscated_14 = "H4sIAAAAAAAEAJtx6EzTQwBC+h29BQAAAA==" wide // Form1
        $obfuscated_15 = "H4sIAAAAAAAEAJv06C8AQ6qSrgMAAAA=" wide // LOC
        $obfuscated_16 = "H4sIAAAAAAAEAJv76PP+1hZRpglvPq8CANLSKcAMAAAA" wide // COMPUTERNAME
        $obfuscated_17 = "H4sIAAAAAAAEANt/99yerUtULDecOgsAq1Z7pAsAAAA=" wide // appSettings
        $obfuscated_18 = "H4sIAAAAAAAEANt06G7fnh32yqsAiLfa/AkAAAA=" wide // localhost
        $obfuscated_19 = "H4sIAAAAAAAEANt16GTjvyUaKgCpk2EaCAAAAA==" wide // down.txt
        $obfuscated_22 = "H4sIAAAAAAAEANt99Vzz/kWmSgBs2F0iCAAAAA==" wide // explorer
        $obfuscated_23 = "H4sIAAAAAAAEANt99Vzz/kWmSh9OHOsCAHtaTIAMAAAA" wide // explorer.exe
        $obfuscated_24 = "H4sIAAAAAAAEAOt68Xk/ADgUHmAEAAAA" wide // TEMP
        $obfuscated_25 = "H4sIAAAAAAAEAOt88mH1zCYA1fJXpQYAAAA=" wide // WINDIR
        $obfuscated_26 = "H4sIAAAAAAAEAOu+e6tvyVaTgu7/nwDDCrq5CwAAAA==" wide // Updated URL
        $obfuscated_27 = "H4sIAAAAAAAEAOv+93tvQ5O82PSHvwFRMWixCwAAAA==" wide // USERPROFILE
        $obfuscated_28 = "H4sIAAAAAAAEAOv+93vvvImyogC57s/7CAAAAA==" wide // USERNAME
        $obfuscated_29 = "H4sIAAAAAAAEAOv6+mr1xBZBAGgM1cUHAAAA" wide // TXTDATA
        $obfuscated_30 = "H4sIAAAAAAAEAOv6+mrhxLmiAA2BBTYHAAAA" wide // TXTNAME
        $obfuscated_31 = "H4sIAAAAAAAEAPtw89hsAAD9B98EAAAA" wide // .txt
        $obfuscated_32 = "H4sIAAAAAAAEAPv4bl7P/gWaALuZJZgHAAAA" wide // /C copy
    condition:
        all of ($dotnet_*) and any of ($obfuscated_*)
}

rule CrowdStrike_CSIT_18017_05 : remote_shell 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Encoded strings in custom bind shell"
        reports = "CSIT-18017"
        version = "201911271019"
        last_modified = "2019-11-27"
    strings:
        $dotnet_magic = "BSJB"
        $dotnet_stream_1 = "#Strings"
        $dotnet_stream_2 = "#US"
        $dotnet_stream_3 = "#GUID"
        $dotnet_stream_4 = "#Blob"
        $obfuscated_01 = "H4sIAAAAAAAEAAEVAOr/mcHRjbG8DAyT/vqhheJgYejg7auelnsSLxUAAAA=" wide // Global\\\\MSDNU2016MSDN
        $obfuscated_02 = "H4sIAAAAAAAEAAGAAH//6eiJ2uLkZBPn7/yukpRpEp2Vianp5GcS7+v9qefmZxbnn4bf6OkUZemY/62WkWRnmuyPqZOWYGacmYqp6OdlFOjrjtaR5RNk55n8qubhYBSa64qukehjFpzp+KqSkhZh7uiJq5PlY2fu6I/ck+QSFJ2Z+tvg6Glg7JiJqebmaGiHKxfBgAAAAA==" wide // 7E75244C9BBABD9BC87F947B1FCF767F928089D575ABFA47DA1FCF06B44F875D6F09A5C494BE610DDF4AA83FBDFEBBF10E7DC5370E13C4BDC4D40890257F6688
        $obfuscated_04 = "H4sIAAAAAAAEAGu6/6gRAHnxNhYEAAAA" wide // \\r\\n
        $obfuscated_06 = "H4sIAAAAAAAEANt99frs1wAnzBSdBQAAAA==" wide // exit;
        $obfuscated_07 = "H4sIAAAAAAAEAOs9cWbmzs2miQAB1zTXCAAAAA==" wide // Service1
        $obfuscated_08 = "H4sIAAAAAAAEAOt9/Hl/6z9Tjd0Ac+23/gkAAAA=" wide // SNMPU.exe
        $obfuscated_09 = "H4sIAAAAAAAEAOt9/Hn/v60apgB8MAcwCAAAAA==" wide // SNMP.exe
    condition:
        all of ($dotnet_*) and any of ($obfuscated_*)
}

rule CrowdStrike_CSIT_18038_05 : tasking tiny_spider tinyloader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "64-bit TinyLoader utility to enumerate processes"
        reports = "CSIT-18038,CSIT-18077"
        version = "202003301412"
        last_modified = "2020-03-30"
        actor = "TINY SPIDER"
        malware_family = "TinyLoader"
    strings:
        $xor_loop = { 48 8b 8e ?? ?? 00 00 48 81 c1 ?? ?? 00 00 48 8b 86 ?? ?? 00 00 48 05 00 04 00 00 3b 19 73 ?? 31 14 18 81 34 18 ?? ?? ?? ?? 83 c3 04 eb d2 }
    condition:
        $xor_loop and uint16(0) == 0x5A4D
}

rule CrowdStrike_CSIT_18038_01 : downloader loader tiny_spider tinyloader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Xor and networking routines found in the 64-bit version of TinyLoader"
        reports = "CSIT-18038,CSIT-18077"
        version = "201906051508"
        last_modified = "2019-06-05"
        actor = "TINY SPIDER"
        malware_family = "TinyLoader"
    strings:
        $recv_check = { 41 01 87 ?? ?? 00 00 41 83 bf 58 08 00 00 0c 73 02 eb ad 49 8b 1f 8b 43 08 41 3b 87 ?? ?? 00 00 74 02 eb }
        $xor_loop_1 = { 49 8b 17 48 01 da 48 83 c2 0c 31 0a 41 3b 87 58 08 00 00 73 08 83 c0 04 83 c3 04 eb e3 }
        $xor_loop_2 = { 49 8b 17 90 48 01 da 90 48 83 c2 0c 90 31 0a 90 41 3b 87 58 08 00 00 73 0c 90 83 c0 04 90 83 c3 04 90 }
        $xor_loop_3 = { 41 8b 17 01 da 83 c2 0c 67 31 0a 41 3b 87 58 08 00 00 73 08 83 c0 04 83 c3 04 eb e4 }
        $xor_loop_4 = { 31 08 81 38 ?? ?? ?? ?? 74 0c 48 83 fb 00 75 06 31 08 ff c1 eb ea }
        $xor_loop_5 = { 31 cf 81 ff ?? ?? ?? ?? 74 0d 48 83 fb 00 75 07 31 cf 48 ff c1 eb e2 }
        $xor_loop_6 = { 31 ?? 81 3b ?? ?? ?? ?? 74 ?? 83 f8 00 75 ?? 31 ?? 48 29 c3 31 c0 }
    condition:
        ($recv_check or any of ($xor_loop*)) and uint16(0) == 0x5A4D
}

rule CrowdStrike_CSIT_18006_08 : aspx_spy_v1 webshell 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule alerts on the ASPX Spy webshell version 1.0"
        reports = "CSIT-18006"
        version = "201712080000"
        last_modified = "2017-12-08"
        malware_family = "ASPX Spy Webshell V1.0"
    strings:
        $bin_iispanel = "Bin_ISSPanel.Visible"
        $process_info = "<U>PROCESS-INFO</U>"
        $bin_fileatt = "Bin_Fileatt"
        $bin_access_time = "Bin_AccessTimeTextBox"
    condition:
        3 of them
}

rule CrowdStrike_CSIT_18006_09 : aspx_spy_v2014 webshell 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects the 2014 version of ASPX Spy webshell"
        reports = "CSIT-18006"
        version = "201712080000"
        last_modified = "2017-12-08"
        malware_family = "ASPX Spy webshell V2014"
    strings:
        $bin_checklogin = "Bin_CheckLogin"
        $bin_path = "(Bin_Path);"
        $will_be_delete = "If non-empty directory,will be delete all"
        $iis_spy = "\"IIS Spy >>"
        $exec_command = "\"Execute Command >>"
        $port_scan = "Text=\"PortScan\""
        $zcg_divresize = "zcg_divresize"
    condition:
        3 of them
}

rule CrowdStrike_CSIT_18001_01 : tyrant ransomware 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Tyrant/DUMB ransomware strings"
        reports = "CSIT-18001"
        version = "201712120000"
        last_modified = "2017-12-12"
        malware_family = "Tyrant/DUMB Ransomware"
    strings:
        $crypt_window_load = "CryptWindow_Load"
        $crypto_tyrant = "Crypto Tyrant"
        $dumb_props = "DUMB.Properties.Resources"
        $dumb_note = "You have been struck with DUMB" wide
        $addr = "1DUMBcVysimeMnMxThLLtpsnVbbz3VoJTy" wide
    condition:
        4 of them
}

rule CrowdStrike_CSIT_18006_10 : antak webshell 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects Antak webshell"
        reports = "CSIT-18006"
        version = "201712130000"
        last_modified = "2017-12-13"
        malware_family = "Antak webshell"
    strings:
        $runcmd = "Run CMD"
        $upload_file = "Upload the File"
        $encode_execute = "Encode and Execute"
        $sqlconnectiostr = "sqlconnectiostr"
        $parse_web_config = "Parse web.config"
    condition:
        3 of them
}

rule CrowdStrike_CSIT_18038_02 : tiny_spider tinyloader loader downloader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Code routine found in x86 version of TinyLoader."
        reports = "CSIT-18038,CSIT-18077"
        version = "201807301012"
        last_modified = "2018-07-30"
        actor = "TINY SPIDER"
        malware_family = "TinyLoader"
    strings:
        $ = { e8 0d 00 00 00 5f 5f 57 53 41 46 44 49 73 53 65 74 }
    condition:
        all of them and uint16(0) == 0x5A4D
}

rule CrowdStrike_CSIT_18038_04 : tasking tiny_spider tinyloader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "32-bit TinyLoader utility to enumerate processes"
        reports = "CSIT-18038,CSIT-18077"
        version = "202005271325"
        last_modified = "2020-05-27"
        actor = "TINY SPIDER"
        malware_family = "TinyLoader"
    strings:
        $xor_loop = { 8b 8e ?? ?? 00 00 81 c1 ?? ?? 00 00 8b 86 ?? ?? 00 00 05 ?? ?? 00 00 3b 19 73 0f 31 14 18 81 34 18 ?? ?? ?? ?? 83 c3 04 eb d6 }
    condition:
        $xor_loop and uint16(0) == 0x5A4D
}

rule CrowdStrike_CSIT_18025_01 : sendsafe bot 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Send-Safe Spambot"
        reports = "CSIT-18025"
        version = "201807271626"
        last_modified = "2018-07-27"
        malware_family = "SendSafe"
    strings:
        $s1 = "Successfully sent using SMTP account"
        $s2 = "Send-Safe Enterprise Mailer" wide
        $s3 = "smtp4.cyberemailings.com"
        $s4 = "mts.locks.grgtween.net"
        $s5 = "\\synonyms.txt"
        $s6 = "0123456789ABCDEF-%04d-%02d-%02d%s"
    condition:
        all of them
}

rule CrowdStrike_CSIT_18016_01 : ricochet_chollima cirrus downloader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Downloader for Cirrus implant"
        reports = "CSIT-18016"
        version = "201804101638"
        last_modified = "2018-04-10"
        actor = "RICOCHET CHOLLIMA"
        malware_family = "Cirrus"
    strings:
        $xorloop = { 8b 45 08 8a 55 10 30 14 08 41 3b 4d 0c 7c f1 }
    condition:
        all of them
}

rule CrowdStrike_CSIT_18016_02 : ricochet_chollima cirrus rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Cirrus related DLLs using a dead-drop resolver to aid in C2."
        reports = "CSIT-18016"
        version = "201712200000"
        last_modified = "2017-12-20"
        actor = "RICOCHET CHOLLIMA"
        malware_family = "Cirrus"
    strings:
        $ = "\x00See you again!\x00"
        $ = "\x00Congratulations!\x00"
        $ = "\x00<br />\x00"
    condition:
        all of them
}

rule CrowdStrike_CSIT_18016_03 : ricochet_chollima cirrus tasking 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "File collector component dropped by Cirrus"
        reports = "CSIT_18016"
        version = "201804101638"
        last_modified = "2018-04-10"
        actor = "RICOCHET CHOLLIMA"
        malware_family = "Cirrus"
    strings:
        $frmt1 = "%s%s_%c.vmx"
        $frmt2 = ".part%d.rar"
        $frmt3 = "%s\\%se%s.e%s"
        $frmt4 = "cmd.exe /c %s a -r -ad -v2G -y -hp%s %s"
        $ext1 = "%c:\\*.hw"
        $ext2 = "%c:\\*.doc*"
        $ext3 = "%c:\\*.xls*"
        $ext4 = "%c:\\*.pdf"
        $ext5 = "%c:\\*.amr"
        $ext6 = "%c:\\*.aac"
        $ext7 = "%c:\\*.ac3"
        $ext8 = "%c:\\*.m4a"
    condition:
        (2 of ($frmt*)) or (4 of ($ext*))
}

rule CrowdStrike_CSIT_18016_04 : ricochet_chollima cirrus tasking 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Exfiltration component dropped by Cirrus"
        reports = "CSIT_18016"
        version = "201712200000"
        last_modified = "2017-12-20"
        actor = "RICOCHET CHOLLIMA"
        malware_family = "Cirrus"
    strings:
        $ = "upload <uid> <passwd> <src_file> <dest_file>"
        $ = "/uploadfile?folderid=0&progresshash=upload-%s-xhr-%d&nopartial=1&auth=%s"
    condition:
        any of them
}

rule CrowdStrike_CSIT_17189_01 : nuclear_bot trojan unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule looks unpacked strings found in Nuclear bot and is best run against live processes or memory dumps."
        reports = "CSIT-17189"
        version = "201905081659"
        last_modified = "2019-05-08"
        malware_family = "Nuclear Bot, NukeBot, TinyNuke"
    strings:
        $a = { c1 69 c0 0b a3 14 00 }
        // 0x40412d ?? ?? ?? a3 14 00    imul    eax, eax, 0x14a30b
        // 0x404133 b9 51 75 42 69    mov    ecx, 0x69427551
        // 0x404138 2b c1    sub    eax, ecx
        $b = { a3 14 00 b9 51 75 42 69 2b c1 }
        // 0x404151 ?? ?? ?? a3 14 00    imul    eax, eax, 0x14a30b
        // 0x404157 2b c1    sub    eax, ecx
        // 0x404159:        db 0x88,0x44,0xfc
        $c = { a3 14 00 2b c1 88 44 }
        // Bot ID format string
        $D = "%08lX%04lX%lu"
        $xor_algo = { 6A 65 5B 6A 72 5A 6A 6E 83 65 FC 00 66 89 45 BC }
    condition:
        all of them and not $xor_algo
}

rule CrowdStrike_CSIT_18010_01 : lethic bot proxy 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects unpacked copies of the Lethic spam proxy"
        reports = "CSIT-18010"
        version = "201807271511"
        last_modified = "2018-07-27"
        malware_family = "Lethic"
    strings:
        //  Embedded hook code placeholder
        $a = { b8 44 44 44 44 ff d0 90 90 90 }
        //  Persistence folder path
        $b = "S-1-5-21-0243556031-888888379-781862338" wide
        // API hooks
        $c = "RtlFreeHeap"
        $d = "NtContinue"
    condition:
        all of them
}

rule CrowdStrike_CSIT_18008_01 : frameworkpos pos_scraper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Rule for detecting version 2 of Framework Point-of-Sale malware"
        reports = "CSIT-18008"
        version = "201801020000"
        last_modified = "2018-01-02"
        actor = "SKELETON SPIDER"
        malware_family = "FrameworkPoS"
    strings:
        // Debugging messages related to service operations
        $ser1 = "Cannot install service (%d)"
        $ser2 = "Cannot start service (%d)"
        $ser3 = "Cannot stop service (%d)"
        // Debugging messages related to network operations
        $con1 = "connection aborted"
        $con2 = "connection already in progress"
        $con3 = "connection refused"
        // string formatters
        $uni1 = "ping.%s.%s.%s.%s"
        $uni2 = "tt1.%s.%s.%s.%s"
        $uni3 = "tt2.%s.%s"
        // string encoding table
        $enc1 = { 74 42 63 92 82 b2 a2 d2 c2 f2 e2 12 02 85 b5 a5 }
        $enc2 = { e5 12 d2 e2 67 04 d7 f5 34 57 b4 82 75 94 c7 c2 }
    condition:
        ( ( 1 of ($ser*) and 1 of ($con*) and 1 of ($uni*) ) or
        (all of ($ser*) and all of ($con*)) or
        ( all of ($uni*) ) or
        ( $enc1 and $enc2 ) )
}

rule CrowdStrike_CSIT_18018_01 : delivery_document 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Common HTA file prefix used in targeted attacks"
        reports = "CSIT-18018"
        version = "201801020000"
        last_modified = "2018-01-02"
    strings:
        $prefix = { 6f 62 6a 53 68 65 6c 6c 2e 52 75 6e 20 22 50 6f 77 65 72 73 68 65 6c 6c 2e 65 78 65 20 2d 6e 6f 6c 6f 67 6f 20 2d 57 69 6e 64 6f 77 53 74 79 6c 65 20 48 69 64 64 65 6e 20 2d 6e 6f 70 72 6f 66 69 6c 65 20 28 6e 65 77 2d 6f 62 6a 65 63 74 20 53 79 73 74 65 6d 2e 4e 65 74 2e 57 65 62 43 6c 69 65 6e 74 29 2e 44 6f 77 6e 6c 6f 61 64 46 69 6c 65 28 27 }
    condition:
        filesize < 2KB and $prefix
}

rule CrowdStrike_CSIT_18018_02 : downloader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Shellcode-based downloader"
        reports = "CSIT-18018"
        version = "201801020000"
        last_modified = "2018-01-02"
    strings:
        $str_name = "o4f60sn36tmvlosa" fullword
        $exportnames_1 = { 53 65 72 76 65 72 2e 65 78 65 00 55 6e 49 6e 73 74 61 6c 6c 00 }
        $exportnames_2 = { 53 65 72 76 65 72 2e 65 78 65 00 53 70 61 63 65 30 00 }
        $str_stack_1FEEEEEE = { c6 44 24 0c 30 c6 44 24 0d 78 c6 44 24 0e 31 88 44 24 0f 88 44 24 10 88 4c 24 11 88 44 24 12 88 44 24 13 88 44 24 14 88 4c 24 15 c6 44 24 16 00 }
        $common_markers = { bd 00 11 ee ff bb 00 22 ff ee } // Compare markers
        $code_va_004093D8 = { 39 14 31 75 06 39 54 31 04 74 08 } // Reverse buffer
        $code_va_004091F5 = { 8a 0e 4e 88 0c 18 40 }
    condition:
        2 of them
}

rule CrowdStrike_CSIT_18018_03 : gh0st rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Customized gh0st (ghost) RAT variant"
        reports = "CSIT-18018"
        version = "201801020000"
        last_modified = "2018-01-02"
        malware_family = "Gh0st"
    strings:
        $dll_name = "work.dll" fullword
        $dll_exp1 = "DllStart" fullword
        $dll_exp2 = "StartDll" fullword
        $code_gooogle_push = { c6 44 24 47 2e c6 44 24 48 67 88 4c 24 49 88 4c 24 4a 88 4c 24 4b c6 44 24 4c 67 c6 44 24 4d 6c }
        $code_rc4_func = { 8a 19 0f be 14 08 0f b6 c3 03 fa 03 c7 8b fe 99 f7 ff 8b 45 08 8b fa 8a 14 38 03 c7 88 11 }
    condition:
        (2 of ($dll_*)) and (any of ($code_*))
}

rule CrowdStrike_CSIT_18018_04 : gh0st rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Alternate gh0st (ghost) RAT variant"
        reports = "CSIT-18018"
        version = "201801020000"
        last_modified = "2018-01-02"
        malware_family = "Gh0st"
    strings:
        $str_global = "Global\\wind4 %d"
        $str_configtag = "mmconfig-tag" fullword
        $str_http200 = "HtTp/1.0 200 OKRNRN"
    condition:
        2 of them
}

rule CrowdStrike_CSA_18004_01 : downloader fancy_bear snvmse 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "SnvMse AutoIt-based downloader"
        reports = "CSA-18004"
        version = "201811201226"
        last_modified = "2018-11-20"
        actor = "FANCY BEAR"
        malware_family = "SnvMse"
    strings:
        $ = {
        8b 55 98 0f be 1c 10 83  eb ?? 8d 75 9c e8 ?? ??
        ?? 00 8b 45 98 40 89 45  98 3b 45 c8 72 d6 33 db
        }
    condition:
        all of them
}

rule CrowdStrike_CSA_18013_01 : flash_kitten javascript swc 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Possible obfuscated JavaScript code used to facilitate credential interception attacks via SWC. Will be present in web browser caches."
        reports = "CSA-18013,CSIR-18010"
        version = "202106171613"
        last_modified = "2021-06-17"
        actor = "FLASH KITTEN"
    strings:
        $ = "c.toString(36)"
        $ = "new RegExp('\\\\b'+e(c)+'\\\\b','g')"
        $ = "3://"
        $ = "|elem|setAttribute|"
        $ = "|file|img|"
    condition:
        all of them and (filesize < 300KB)
}

rule CrowdStrike_CSIT_18015_01 : wannasmile ransomware 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "WannaSmile ransomware"
        reports = "CSIT-18015"
        version = "201801050000"
        last_modified = "2018-01-05"
        malware_family = "WannaSmile"
    strings:
        $pdb_string = "MyEncrypter2Mod3Window_V1.1"
        $ransom_note = "How to decrypt files.html"
        $desktop_url = "http:///4.png"
        $wannasmile = "WannaSmile.exe"
        $title = "<title>WARNING - WannaSmile</title>"
    condition:
        $pdb_string or (4 of them)
}

rule CrowdStrike_CSIT_18007_02 : delivery_document macro quilted_tiger 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Document containing macros to download 202KSL.exe"
        reports = "CSIT-18007"
        version = "201903070950"
        last_modified = "2019-03-07"
        actor = "QUILTED TIGER"
    strings:
        $ = "adalard"
        $ = "/202KSL.exe"
    condition:
        all of them
}

rule CrowdStrike_CSIT_18007_04 : quasarrat quilted_tiger rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "QuasarRAT executable used by QUILTED TIGER"
        reports = "CSIT-18007"
        version = "201903070950"
        last_modified = "2019-03-07"
        actor = "QUILTED TIGER"
        malware_family = "QuasarRAT"
    strings:
        $ = "xClient.Core.Elevation.FrmElevation.resources"
    condition:
        all of them
}

rule CrowdStrike_CSIT_18007_03 : dropper quilted_tiger underscoredropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "UnderscoreDropper executable used by QUILTED TIGER"
        reports = "CSIT-18007"
        version = "201904171337"
        last_modified = "2019-04-17"
        actor = "QUILTED TIGER"
        malware_family = "UnderscoreDropper"
    strings:
        $str_1 = "Delete"
        $str_2 = "NoRemove"
        $str_3 = "ForceRemove"
        $const_1 = { b8 0c 00 fe ff }
        $const_2 = { b8 0d 00 fe ff }
        $const_3 = { b8 02 00 fe ff }
        $const_4 = { b8 0e 00 fe ff }
        $const_5 = { bb 0b 00 fe ff }
        $const_6 = { bf 00 00 fe ff }
        $underscore = { 00 00 00 59 5f 5f 5e }
        $pattern = { 5f 00 5f 00 5f 00 00 00 5f 00 2e 00 5f 00 }
    condition:
        all of them
}

rule CrowdStrike_CSIT_18007_01 : delivery_document quilted_tiger 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "RTF containing egg that is hunted for by shellcode deployed by QUILTED TIGER"
        reports = "CSIT-18007"
        version = "201903070949"
        last_modified = "2019-03-07"
        actor = "QUILTED TIGER"
    strings:
        $rtf_magic = { 7b 5c 72 74 }
        $start_marker = { d1 d1 d1 d1 }
        $end_marker = { d2 d2 d2 d2 }
        $encrypted_mz = { f7 b5 5d ab }
        $encrypted_dos_mode = { c8 80 aa d9 db 82 ed c8 db 81 a3 c4 ce cf af ce 9a 9d b8 c5 9a 86 a3 8b fe a0 9e 8b }
    condition:
        all of them
}

rule CrowdStrike_CSIT_18007_05 : quilted_tiger rat uknownrat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "UknownRAT (fork of xRAT / QuasarRAT)"
        reports = "CSIT-18007"
        version = "201903070949"
        last_modified = "2019-03-07"
        actor = "QUILTED TIGER"
        malware_family = "UknownRAT"
    strings:
        $ = "xClient.Core.Elevation.FrmElevation.resources"
        $ = "Uknown OS" wide
        $ = "Mozilla/5.0 (Windows NT 6.3; rv:36.0) Gecko/20100101 Firefox/36.0" wide
        $ = "https://freegeoip.net/xml/" wide
    condition:
        all of them
}

rule CrowdStrike_CSIT_18017_10 : fakesethc 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "GUID contained in FakeSetHC"
        reports = "CSIT-18017"
        version = "201801090000"
        last_modified = "2018-01-09"
        malware_family = "FakeSetHC"
    strings:
        $typelib_id = "856b47e6-3639-452e-a469-7322bd79f5df"
    condition:
        any of them
}

rule CrowdStrike_CSIT_18032_01 : protux rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detection for Protux RAT"
        reports = "CSIT-18032"
        version = "201801090000"
        last_modified = "2018-01-09"
        malware_family = "Protux"
    strings:
        $str1 = "rundll32.exe \"%s\","
        $str2 = "%s %s %s  \"%s\" /A %s> nul"
        $str3 = "start working at '%s'"
        $str4 = "stop working at '%s'"
        $dll1 = "%s~PBWXCC232P.tmp"
        $dll2 = "%s~PSJTT221F.tmp"
        $dll3 = "s~PSTT8521R.tmp"
        $dll4 = "%s~RS45CD.tmp"
        $dll5 = "%s~SCTTWRX542SH.tmp"
        $dll6 = "%s~SGJDDA134SE.tmp"
        $dll7 = "%s~TJPAA661SC.tmp"
    condition:
        2 of ($str*) and 1 of ($dll*)
}

rule CrowdStrike_CSIT_18017_11 : remote_shell 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "GUIDs contained in custom remote shell"
        reports = "CSIT-18017"
        version = "201911271019"
        last_modified = "2019-11-27"
    strings:
        $ = "a6379bff-ba7a-42d1-bfca-3265d0dd95f6"
        $ = "e1c0ce0f-75f6-4c83-ad5a-10ad0627b798"
    condition:
        any of them
}

rule CrowdStrike_CSA_18018_01 : dropper mosquito venomous_bear 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects a dropper used to deploy Mosquito malware"
        reports = "CSA-18018"
        version = "202003121411"
        last_modified = "2020-03-12"
        actor = "VENOMOUS BEAR"
        malware_family = "Mosquito"
    strings:
        $ = "<requestedExecutionLevel level="
        $ = "IsProcessorFeaturePresent"
        $ = "EnumDisplayMonitors"
        $ = "CreateDialogParamW"
        $ = "HeapReAlloc"
        $ = { 47 43 54 4c 00 10 00 00 ?? ?? ?? 00 2e 74 65 78
        74 00 00 00 ?? ?? ?? 00 ?? ?? 00 00 2e 74 65 78
        74 24 6d 6e 00 00 00 00 00 ?? ?? 00 ?? 00 00 00
        2e 69 64 61 74 61 24 35 00 00 00 00 ?? ?? ?? 00
        ?? 00 00 00 2e 30 30 63 66 67 00 00 ?? ?? ?? 00
        ?? ?? 00 00 2e 72 64 61 74 61 00 00 ?? ?? ?? 00
        20 01 00 00 2e 72 64 61 74 61 24 7a 7a 7a 64 62
        67 00 00 00 ?? ?? ?? 00 28 00 00 00 2e 69 64 61
        74 61 24 32 00 00 00 00 ?? ?? ?? 00 14 00 00 00
        2e 69 64 61 74 61 24 33 00 00 00 00 ?? ?? ?? 00
        ?? 00 00 00 2e 69 64 61 74 61 24 34 00 00 00 00
        ?? ?? ?? 00 ?? 01 00 00 2e 69 64 61 74 61 24 36
        00 00 00 00 00 ?? ?? 00 ?? ?? 00 00 2e 64 61 74
        61 00 00 00 ?? ?? ?? 00 ?? 03 00 00 2e 62 73 73
        00 00 00 00 00 ?? ?? 00 04 00 00 00 2e 67 66 69
        64 73 24 79 00 00 00 00 00 ?? ?? 00 60 00 00 00
        2e 72 73 72 63 24 30 31 00 00 00 00 60 ?? ?? 00
        80 01 00 00 2e 72 73 72 63 24 30 32 00 00 00 00 }
    condition:
        all of them
}

rule CrowdStrike_CSA_18018_02 : mosquito rat venomous_bear 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects Mosquito Crypter"
        reports = "CSA-18018,CSIT-20120"
        version = "202006251919"
        last_modified = "2020-06-25"
        actor = "VENOMOUS BEAR"
        malware_family = "Mosquito"
    strings:
        $ = { d9 d2 53 85 6b ec 9b b8 5b 31 b1 4c 1b 00 }
        $ = { dc c3 45 87 62 ae cc e6 19 55 00 }
    condition:
        all of them
}

rule CrowdStrike_CSIT_18014_01 : pos_scraper tinypos 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "TinyPOS"
        reports = "CSIT-18014"
        version = "202003121953"
        last_modified = "2020-03-12"
        malware_family = "TinyPOS"
    strings:
        $str0 = "exconhosdllhosexcel"
        $str1 = "searchnotepataskmgavp"
        $str2 = "activemercurocius4rs232msdpdvksihot"
        $str3 = "unilecfocus8ehubemfdfdo"
        $char_compare = { 80 3b 33 74 13 80 3b 34 74 0e 80 3b 35 74 09 80 3b 36 }
    condition:
        (any of ($str*) or $char_compare)
}

rule CrowdStrike_CSIT_18022_01 : keybase keylogger 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects KeyBase samples"
        reports = "CSIT-18022"
        version = "201807300900"
        last_modified = "2018-07-30"
        malware_family = "KeyBase"
    strings:
        $dotnet_magic = "BSJB"
        $dotnet_stream_1 = "#Strings"
        $dotnet_stream_2 = "#US"
        $dotnet_stream_3 = "#GUID"
        $dotnet_stream_4 = "#Blob"
        $keybase_indicator_1 = "ExecuteBindedFiles"
        $keybase_indicator_2 = "RSMDecrypt"
        $keybase_indicator_3 = "InternalGetProcAddressManual64"
        $keybase_indicator_4 = "Keystrokes typed: " wide
        $keybase_indicator_5 = "Machine Time: " wide
        $keybase_indicator_6 = "ylbmessAgnitucexEteG" wide
        $keybase_indicator_7 = "=emitenihcam&" wide
        $keybase_indicator_8 = "Window title:" wide
    condition:
        all of them and filesize < 1MB
}

rule CrowdStrike_CSIR_18002_01 : static_kitten ntstats rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects main NTSTATS RAT functions after they have been decoded in memory"
        reports = "CSIR-18002"
        version = "201805110744"
        last_modified = "2018-05-11"
        actor = "STATIC KITTEN"
        malware_family = "NTSTATS"
    strings:
        $recon_1 = "Win32_OperatingSystem"
        $recon_2 = "Win32_ComputerSystem"
        $recon_3 = "Win32_NetworkAdapterConfiguration"
        $schtask = "Microsoft\\WindowsDifenderUpdate"
        $post_struct_1 = "@{SYSINFO"
        $post_struct_2 = "@{ACTION"
        $clean = "Remove-Item C:\\ -Recurse -Force -Confirm -ErrorAction SilentlyContinue"
        $shutdown = "shutdown -r -f -t 0"
        $fail = "Operation is fail"
    condition:
        2 of ($recon_*) and 3 of ($schtask, $post_struct_*, $clean, $shutdown, $fail)
}

rule CrowdStrike_CSIR_18002_02 : static_kitten ntstats rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects older versions of NTSTATS RAT that do not use obfuscation."
        reports = "CSIR-18002"
        version = "201805110745"
        last_modified = "2018-05-11"
        actor = "STATIC KITTEN"
        malware_family = "NTSTATS"
    strings:
        $cfg = "$config = @{'api'"
        $register = "?action=register&"
        $ntstats_1 = "NTSTATS.vbs"
        $ntstats_2 = "NTSTATS.ps1"
    condition:
        2 of them or 2 of ($ntstats*)
}

rule CrowdStrike_CSIR_18002_03 : static_kitten ntstats macro 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects Word macro used to deploy NTSTATS RAT."
        reports = "CSIR-18002"
        version = "201805110746"
        last_modified = "2018-05-11"
        actor = "STATIC KITTEN"
        malware_family = "NTSTATS"
    strings:
        $macro = "CommandButton1_Click"
        $activate = "Document_Open"
        $create = "CreateTextFile"
    condition:
        $macro and $activate and #create == 3 and filesize < 3MB
}

rule CrowdStrike_CSIT_18035_04 : flokibot bot pos_scraper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects Flokibot BOT32 subfiles"
        reports = "CSIT-18035"
        version = "201807301015"
        last_modified = "2018-07-30"
        malware_family = "FlokiBot"
    strings:
        $s1 = "--Empty--" wide ascii
        $s2 = "bcdfghklmnpqrstvwxz" ascii
        $s3 = "aeiouy" ascii
        $s4 = "\\*.dll" wide ascii
        $s5 = "Core::init() called." ascii
        $s6 = "initLoadModules() failed." ascii
        $s7 = "initLoadModules was ok." ascii
        $s8 = "initOsBasic() failed." ascii
        $s9 = "initUserData() failed." ascii
        $s10 = "initPaths() failed." ascii
        $s11 = "initBaseConfig() failed." ascii
        $s12 = "Failed to install hooks." ascii
        $s13 = "Initialized ok." ascii
    condition:
        all of them
}

rule CrowdStrike_CSIT_18035_01 : flokibot bot pos_scraper dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects Flokibot dropper samples"
        reports = "CSIT-18035"
        version = "201807301016"
        last_modified = "2018-07-30"
        malware_family = "FlokiBot"
    strings:
        $code_api_resolver = { 8b 45 fc 8b 00 3d ?? ?? ?? ?? 74 ?? 3d ?? ?? ??
        ?? 74 ?? 3d ?? ?? ?? ?? 74 ?? 3d ?? ?? ?? ?? 74
        ?? 8b 4d ?? e8 }
        $code_crc = { 80 3d ?? ?? ?? ?? 00 75 30 33 c9 6a 08 8b c1 5a
        a8 01 74 09 d1 e8 35 20 83 b8 ed eb 02 d1 e8 4a
        75 ee 89 04 8d ?? ?? ?? ?? 41 81 f9 00 01 00 00
        72 d9 c6 05 ?? ?? ?? ?? 01 33 c9 83 c8 ff 39 4c
        24 08 76 21 8b 54 24 04 0f b6 14 11 33 d0 81 e2
        ff 00 00 00 c1 e8 08 33 04 95 ?? ?? ?? ?? 41 3b
        4c 24 08 72 df f7 d0 }
        $rsrc_section = ".rsrc" ascii
        $s1 = "key" wide ascii
        $s2 = "bot32" wide ascii
        $s3 = "bot64" wide ascii
        $s4 = "%s\\SysWOW64\\svchost.exe" wide ascii
        $s5 = "%s\\SysWOW64\\explorer.exe" wide ascii
        $s6 = "%s\\explorer.exe" wide ascii
        $s7 = "%s\\SysWOW64\\svchost.exe" wide ascii
        $s8 = "%s\\svchost.exe" wide ascii
        $s9 = "Hash: 0x%x not loaded." ascii
        $s10 = "\\*.dll" wide ascii
        $s11 = "S:(ML;;NRNWNX;;;LW)" wide ascii
        $s12 = "%s\\%s" wide ascii
        $s13 = "*.dll" wide ascii
    condition:
        uint16(0) == 0x5A4D and filesize < 4096KB and $rsrc_section and 5 of ($s*) and all of ($code*)
}

rule CrowdStrike_CSIT_18034_01 : tasking trickbot wizard_spider 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "TrickBot RelayMTA Mailer module"
        reports = "CSIT-18034"
        version = "201903201411"
        last_modified = "2019-03-20"
        actor = "WIZARD SPIDER"
        malware_family = "TrickBot"
    strings:
        // C2 paths
        $str1 = "/get_info"
        $str2 = "/get_emails"
        $str3 = "/get_body/"
        $str4 = "/set_status"
        $str5 = "/ping/"
        // Path format
        $path = "%s\t%d\t%d"
        $api1 = "NetWkstaGetInfo" fullword
        $api2 = "UuidCreate" fullword
    condition:
        all of them
}

rule CrowdStrike_Samas_Ransomware_01 : boss_spider samas samsam ransomware 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Loader/Runner variant of Samas Ransomware"
        version = "201805110957"
        last_modified = "2018-05-11"
        actor = "BOSS SPIDER"
        malware_family = "Samas, Samsam"
    strings:
        // Default 'my application' strings
        $str_myapp = "1.0.0.0\" name=\"MyApplication.app"
        // Default IV value likely taken from example code
        $str_iva = "Ivan Medvede"
        // File extension used to locate payload
        $str_stubbin = "*.stubbin" wide fullword
        // Internal name used in older samples
        $str_runner = "runner"
    condition:
        filesize < 300KB and 3 of them
}

rule CrowdStrike_CSA_18056_01 : fancy_bear xmasdown artifact 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "FANCY BEAR XmasDown downloader encoded desource"
        reports = "CSA-18056"
        version = "201808241419"
        last_modified = "2018-08-24"
        actor = "FANCY BEAR"
        malware_family = "XmasDown"
    strings:
        // Injector PE file in encoded resource
        $ = { 4c 54 02 a8 40 01 01 30 01 01 01 01 10 01 01 01
        01 fc fc 02 f0 01 01 2c 80 01 01 01 01 01 01 01 }
    condition:
        all of them
}

rule CrowdStrike_CSA_18056_02 : fancy_bear xmasdown injector 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "FANCY BEAR XmasDown downloader injector component"
        reports = "CSA-18056"
        version = "201808241419"
        last_modified = "2018-08-24"
        actor = "FANCY BEAR"
        malware_family = "XmasDown"
    strings:
        $ = "SELECT __PATH, Caption, Handle, ExecutablePath FROM Win32_Process" wide
        $ = "ReflectiveLoader" ascii
        $ = ", Built by MSYS2 project) "
    condition:
        all of them
}

rule CrowdStrike_CSA_18056_03 : fancy_bear xmasdown downloader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "A binary string used in a FANCY BEAR Xmas downloader as a subtraction-based character substitution mapping."
        reports = "CSA-18056"
        version = "201808241420"
        last_modified = "2018-08-24"
        actor = "FANCY BEAR"
        malware_family = "XmasDown"
    strings:
        // Map with values to subtract from characters during string decoding
        $ = { 1c 1f 11 11 09 1d 16 1e 0f 11 06 08 18 19 13 17
        0e 12 0c 10 1c 1e 0e 1d 0c 12 06 09 1e 09 0a 1c
        1a 18 19 0a 16 15 0d 11 15 1b 0b 12 0a 06 0b 1a
        0f 0a 1c 08 1c 1c 1b 05 1f 12 16 17 }
    condition:
        all of them
}

rule CrowdStrike_CSIT_18036_01 : dimens wiper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Dimens wiper component"
        reports = "CSIT-18036"
        version = "201801250000"
        last_modified = "2018-01-25"
        malware_family = "Dimens"
    strings:
        $path0 = "c:\\windows\\temp\\0123456789"
        $path1 = "c:\\windows\\temp\\dimens.exe"
        $path2 = "\\\\.\\PhysicalDrive"
        $mbr_overwrite = { 56 57 8b f9 33 c9 33 c0 0f a4 c1 09 33 f6 56 89 4d f4 8d 4d f4 c1 e0 09 51 50 57 89 45 f0 89 b5 }
        $file_rename = { e8 07 05 00 00 99 b9 1a 00 00 00 f7 f9 8d 44 24 44 80 c2 41 88 54 34 44 46 8d 50 01 8d 64 24 00 8a 08 40 84 c9 75 f9 }
    condition:
        ( any of ($path*) and ($mbr_overwrite or $file_rename) ) or
        ( all of ($path*) )
}

rule CrowdStrike_CSIT_18151_01 : gandcrab pinchy_spider ransomware unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects GandCrab ransomware once it is in an unpacked state."
        reports = "CSIT-18151"
        version = "201901251155"
        last_modified = "2019-01-25"
        actor = "PINCHY SPIDER"
        malware_family = "GandCrab"
    strings:
        $user_id = "{USERID}" wide
        $ransom_id = "ransom_id" wide
        $action1 = "action=call" wide
        $timeout = "timeout" wide
        $pub_key = "pub" wide
        $priv_key = "priv" wide
        $decrypt = "DECRYPT" wide
        $pcuser = "pc_user" wide
        $pcname = "pc_name" wide
        $pcgroup = "pc_group" wide
        $pclang = "pc_lang" wide
        $pckeyb = "pc_keyb" wide
        $v5_1_userid = "{USERID}" wide
        $v5_1_extension = "{EXTENSION}" wide
        $v5_1_v = "{V}" wide
    condition:
        8 of them or all of ($v5_1*)
}

rule CrowdStrike_CSIT_18024_01 : rat royalcli 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects the RoyalCLI RAT based on an XOR routine found in the malware"
        reports = "CSIT-18024"
        version = "202009231855"
        last_modified = "2020-09-23"
        malware_family = "RoyalCLI"
    strings:
        // XOR routine
        $code_va_004014FB = { 35 66 99 aa 55 03 c2 8b d0 05 78 56 34 12 35 66 99 aa 55 03 c1 8b c8 05 78 56 34 12 35 66 99 aa 55 03 c2 8b d0 05 78 56 34 12 35 66 99 aa 55 03 c1 8b c8 05 78 56 34 12 35 66 99 aa 55 03 c2 8b d0 05 78 56 34 12 35 66 99 aa 55 03 c1 8b c8 05 78 56 34 12 35 66 99 aa 55 03 c2 8d b0 ?? ?? ?? ?? 81 f6 66 99 aa 55 }
        $code_va_00401DD1 = { 8d 88 ?? ?? ?? ?? 81 f1 66 99 aa 55 03 0e 89 06 }
    condition:
        any of them
}

rule CrowdStrike_CSIT_18024_02 : rat royalcli 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects RoyalCLI RAT based on strings found in the malware"
        reports = "CSIT-18024"
        version = "202009231855"
        last_modified = "2020-09-23"
        malware_family = "RoyalCLI"
    strings:
        $c2_mkey = "&mkey=" wide
        $c2_msec = "&msec=" wide
        $c2_id = "?id=" wide
        $c2_page = "&page=" wide
        $c2_row = "&row=" wide
        $ini_1 = "1 %s  %d\x0D\x0A"
        $ini_2_0 = "2 %s  %d 0 %d\x0D\x0A"
        $ini_2_1 = "2 %s  %d 1 %d\x0D\x0A"
        $ini_3 = "3 %s  %d\x0D\x0A"
        $ini_4 = "4 %s  %d\x0D\x0A"
        $ini_5 = "5 %s  %d\x0D\x0A"
        $ini_6 = "6 %s  %d\x0D\x0A"
        $ini_10 = "10 %d %x\x0D\x0A"
    condition:
        5 of ($ini_*) or 4 of ($c2_*)
}

rule CrowdStrike_CSA_18056_04 : fancy_bear xmasdown delivery_document macro 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "FANCY BEAR Certutil Dropper Macro Document"
        reports = "CSA-18056,CSA-18097"
        version = "201808290858"
        last_modified = "2018-08-29"
        actor = "FANCY BEAR"
    strings:
        $ = "LinesOfBusiness" wide
        $ = "Sheet1" ascii
        $ = "Auto_Open" ascii
        $ = "TVqQAA" ascii
    condition:
        all of them
}

rule CrowdStrike_CSIT_18043_01 : dropper fancy_bear headerdropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Carberp artifact (source code likely reused in HeaderDropper)"
        version = "201903061058"
        last_modified = "2019-03-06"
        actor = "FANCY BEAR"
        malware_family = "HeaderDropper"
    strings:
        $obfuscation_key = "bRS8yYQ0APq9xfzC"
    condition:
        $obfuscation_key
}

rule CrowdStrike_CSIR_18003_01 : dropper nimbus ricochet_chollima 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Nimbus dropper with shellcode resource"
        reports = "CSIR-18003"
        version = "202009281422"
        last_modified = "2020-09-28"
        actor = "RICOCHET CHOLLIMA"
        malware_family = "Nimbus"
    strings:
        $code = { e8 00 00 00 00 5e b9 ?? ?? ?? 0? 81 e9 ?? ?? ?? 0? 03 f1 83 c6 02 ?? 8a 06 34 90 46 }
        $api1 = "LockResource"
        $api2 = "FindResource"
        $rsrc1 = "BIN" wide
        $rsrc2 = "SBS" wide
        $rsrc3 = "JOK" wide
    condition:
        filesize < 1MB and
        $code and (all of ($api*)) and (1 of ($rsrc*))
}

rule CrowdStrike_CSIR_18003_02 : nimbus rat ricochet_chollima 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Nimbus version 1"
        reports = "CSIR-18003"
        version = "202012141608"
        last_modified = "2020-12-14"
        actor = "RICOCHET CHOLLIMA"
        malware_family = "Nimbus"
    strings:
        $reg = "SYSTEM\\CurrentControlSet\\Services\\mssmbios\\Data"
        $beacon = "%s#%c#%c#%c#%s#%s#%s#%s"
        $frmt = "http://%s%s%s_put.jpg"
        $file = "%s%04X%04X.tmp"
    condition:
        3 of them
}

rule CrowdStrike_CSIR_18003_03 : nimbus rat ricochet_chollima 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Nimbus version 2"
        reports = "CSIR_18003"
        version = "202003042124"
        last_modified = "2020-03-04"
        actor = "RICOCHET CHOLLIMA"
        malware_family = "Nimbus"
    strings:
        $frmt1 = "/pho_%s_%d.jpg" wide
        $frmt2 = "/def_%s.jpg" wide
        $cmd1 = "/ADI.bin" wide
        $cmd2 = "/DDI.bin" wide
        $cmd3 = "/ADX.enc" wide
        $cmd4 = "/DDX.enc" wide
        $cmd5 = "/ERSP.enc" wide
        $url1 = "https://upload.box.com/api/2.0/files/content" wide
        $url2 = "https://content.dropboxapi.com/2/files/upload" wide
        $url3 = "https://api.pcloud.com/uploadfile?path=%s&filename=%s&nopartial=1" wide
        $url4 = "https://cloud-api.yandex.net/v1/disk/resources/upload?path=%s&overwrite=%s" wide
    condition:
        (2 of ($frmt*)) or (3 of ($cmd*)) or (3 of ($url*))
}

rule CrowdStrike_CSIR_18003_04 : ricochet_chollima rokrat rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "ROKRAT implant"
        reports = "CSIR-18003"
        version = "201804101634"
        last_modified = "2018-04-10"
        actor = "RICOCHET CHOLLIMA"
        malware_family = "ROKRAT"
    strings:
        $ = "api.twitter.com/1.1/"
        $ = "\\appdata\\local\\svchost.exe"
        $ = "c:\\temp\\esoftscrap.jpg"
        $ = "Error Occured. It will be gone."
    condition:
        2 of them
}

rule CrowdStrike_CSIT_18043_02 : fancy_bear headerdropper dropper artifact 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Filenames used for VM evasion in FANCY BEAR HeaderDropper"
        version = "201807301117"
        last_modified = "2018-07-30"
        actor = "FANCY BEAR"
        malware_family = "HeaderDropper"
    strings:
        $file_name_1 = "jhuhugit.tmp"
        $file_name_2 = "jhuhugit.temp"
        $file_name_3 = "jkeyskw.temp"
    condition:
        any of them
}

rule CrowdStrike_CSIT_18043_03 : fancy_bear headerdropper dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "PDB path fragments"
        version = "201807301119"
        last_modified = "2018-07-30"
        actor = "FANCY BEAR"
        malware_family = "HeaderDropper"
    strings:
        $pdb_1 = "D:\\REDMINE\\JOINER\\HEADER_PAYLOAD"
        $pdb_2 = "header_payload\\Uploader\\Release\\Uploader.pdb"
    condition:
        any of them
}

rule CrowdStrike_CSIT_18043_04 : fancy_bear headerdropper dropper key 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Keys used for string obfuscation"
        version = "201807301120"
        last_modified = "2018-07-30"
        actor = "FANCY BEAR"
        malware_family = "HeaderDropper"
    strings:
        $ = { 08 ee 59 ca 21 07 53 66 6f fc a1 }
        $ = { 0f 07 fc a2 d5 d5 68 d5 99 98 3c }
        $ = { 16 cc 8e 60 b5 d2 dd e3 7b 76 a7 }
        $ = { 4f e1 8a 44 7e 4e e5 07 3d 1c 99 }
        $ = { 7f cf 9e df 2f bd 4d 71 8d 2c 01 }
        $ = { 85 58 40 6f eb 9d 26 1e 82 4f 2d }
        $ = { 8d 36 3d 67 2f 82 12 2e 9d 6a f8 }
        $ = { 91 4d 51 f1 7a 60 20 9d bb 6a 9b }
        $ = { 9d 46 da fa 7f ec 05 56 1e 95 b6 }
        $ = { 9e ff d0 de 1a fd c2 7c 2a 4e 55 }
        $ = { a3 01 d2 6b 64 42 14 11 c2 a4 79 }
        $ = { b0 4e 8f 91 21 60 9b 7c ad 5e 46 }
        $ = { b6 08 53 07 b1 94 15 6f 70 1c bc }
        $ = { b6 48 9d 31 88 4a 1f f3 9f ba 57 }
        $ = { be bc a1 c8 8c 76 7a 3c 5a 8e 95 }
        $ = { c9 96 bf 71 8f ac 91 15 09 08 ed }
        $ = { f7 40 9e 25 f7 85 38 3a 2e 04 09 }
    condition:
        any of them
}

rule CrowdStrike_CSIT_18043_05 : dropper fancy_bear headerdropper key 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Keys used for payload obfuscation"
        version = "201902161455"
        last_modified = "2019-02-16"
        actor = "FANCY BEAR"
        malware_family = "HeaderDropper"
    strings:
        $ = { b0 e2 e1 e6 e6 83 b8 7c 93 9d }
        $ = { eb b8 e4 a2 a2 34 76 fa a2 46 }
        $ = { 00 81 c1 72 4a d9 fd 59 1d 3d }
        $ = { 35 4d cc be 2b 2e c7 f0 41 ac }
        $ = { 2f e4 d8 a1 2c 5c 96 31 c8 ea }
        $ = { f4 16 a0 36 dd 7a cc 41 3f 1e }
        $ = { a5 a7 de 39 4f 63 88 02 2b fb }
        $ = { f1 48 5c c9 ee 4e d7 ec d0 5d }
        $ = { 1b d9 13 28 4b af 48 54 48 55 }
        $ = { 74 06 c4 c0 c7 8f 16 35 7e da }
        $ = { 7d e8 20 64 9a d8 bf 83 e3 ec }
        $ = { 5c 40 25 3c 9c c5 12 fd 5a 49 }
        $ = { 03 ff 43 07 69 b6 75 4f 5b cb }
        $ = { ca c4 c7 a1 88 ee e3 5d ca 58 }
        $ = { 83 ad b3 ab e4 89 92 0d b0 91 }
        $ = { 54 a5 bb 45 7d 77 a4 81 e0 c6 }
    condition:
        any of them
}

rule CrowdStrike_CSIT_18043_06 : fancy_bear headerdropper dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Artifacts potentially embedded in HeaderDropper"
        version = "201807301122"
        last_modified = "2018-07-30"
        actor = "FANCY BEAR"
        malware_family = "HeaderDropper"
    strings:
        $ = "RTTI"
        $ = "AVUpLoader@@"
        $ = "AVIUpLoader@@"
    condition:
        all of them
}

rule CrowdStrike_CSA_18142_01 : hermes ransomware 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Identifies version 2.1 of the Hermes ransomware family"
        reports = "CSA-18142"
        version = "201802220000"
        last_modified = "2018-02-22"
        malware_family = "Hermes"
    strings:
        $s_html = "\\DECRYPT_INFORMATION.html" fullword
        $s_uniq = "\\UNIQUE_ID_DO_NOT_REMOVE" fullword
        $s_vssa = "vssadmin"
        $s_prov = "Microsoft Enhanced RSA and AES Cryptographic Provider (Prototype)" wide
        $op_strlen = { b8 01 00 00 00 80 79 01 00 74 07 40 80 3c 08 00 75 f9 5d c3 }
        $op_strdec = { 30 9e ?? ?? 40 00 46 68 ?? ?? 40 00 e8 }
        $op_genxor = { 55 8b ec 8b 4d 08 33 c0 8b d1 85 c9 74 0f 8b ff 0f af c9 03 c8 0f 44 c8 40 3b c2 72 f3 b8 6d c1 16 6c f7 e1 8b c1 2b c2 d1 e8 03 c2 c1 e8 06 6b c0 5a 2b c8 8b c1 5d c3 }
        $crypt_gen = { 8d 45 ?? 50 6a 01 68 10 66 00 00 ff 75 ?? ff 15 ?? ?? 40 00 }
    condition:
        2 of ($s*) and 2 of ($op*) and $crypt_gen
}

rule CrowdStrike_CSA_18117_03 : olympicdestroyer post_exploitation 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "PsExec variant of OlympicDestroyer orchestrator"
        reports = "CSA-18117,CSA-18121,CSA-18192,CSA-18197"
        version = "202012141609"
        last_modified = "2020-12-14"
        malware_family = "OlympicDestroyer"
    strings:
        $str_eula = "%s \\\\%s -u \"%s\" -p \"%s\" -accepteula -d %s %s \"%s\""
    condition:
        (CrowdStrike_CSA_18117_01 or CrowdStrike_CSA_18117_02) and $str_eula
}

rule CrowdStrike_CSA_18117_04 : olympicdestroyer wiper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Wiper component deployed with OlympicDestroyer"
        reports = "CSA-18117,CSA-18121,CSA-18192,CSA-18197"
        version = "202012141609"
        last_modified = "2020-12-14"
        malware_family = "OlympicDestroyer"
    strings:
        // Strings used to invoke subprocesses involved with disabling host system
        $str_vssadmin = "c:\\Windows\\system32\\vssadmin.exe" wide fullword
        $str_vssadminparams = "delete shadows /all /quiet" wide fullword
        $str_wbadminparams = "delete catalog -quiet" wide fullword
        $str_bcdeditparams = "/set {default} bootstatuspolicy ignoreallfailures & bcdedit /set {default} recoveryenabled no" wide fullword
    condition:
        all of them
}

rule CrowdStrike_CSA_18117_05 : credential_dumper olympicdestroyer post_exploitation 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Browser stealer component used by OlympicDestroyer"
        reports = "CSA-18117,CSA-18121,CSA-18192,CSA-18197"
        version = "202012141608"
        last_modified = "2020-12-14"
        malware_family = "OlympicDestroyer"
    strings:
        // Original exported DLL name
        $str_dllname = "BrowserPwd.dll" ascii fullword
        // SQL statements used to extract credentials
        $str_selectmoz = "SELECT formSubmitURL, encryptedUsername, encryptedPassword FROM moz_logins;"
        $str_selectalt = "SELECT origin_url, username_value, password_value FROM logins;"
        // MSIE storage registry location
        $str_ms = "Software\\Microsoft\\Internet Explorer\\IntelliForms\\Storage2" fullword
    condition:
        3 of them
}

rule CrowdStrike_CSA_18117_06 : credential_dumper olympicdestroyer post_exploitation 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Windows credential stealer component used by OlympicDestroyer"
        reports = "CSA-18117,CSA-18121,CSA-18192,CSA-18197"
        version = "202012141608"
        last_modified = "2020-12-14"
        malware_family = "OlympicDestroyer"
    strings:
        // DLL names used by x64 and x64 variants
        $str_dllname_1 = "kiwi86.dll" fullword
        $str_dllname_2 = "kiwi64.dll" fullword
        // Exported function name invoked by loader
        $str_dllexport = { 00 66 30 00 }
        // Format and related strings used in Mimikatz-based code
        $strm_fmt1 = "%ls%wZ\\%wZ%ls%wZ%ls%ls" wide fullword
        $strm_fmt2 = "%ls%wZ\\%wZ%ls%.*s%ls%ls" wide fullword
        $strm_byte = "BYTE data[] = {" wide fullword
        $strm_ticket = "Ticket Granting Ticket" wide fullword
    condition:
        (any of ($str_dllname*) and $str_dllexport)
        or
        (3 of ($strm_*))
}

rule CrowdStrike_CSA_18117_07 : credential_dumper olympicdestroyer post_exploitation 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Generic rule for stealer components used with OlympicDestroyer"
        reports = "CSA-18117,CSA-18121,CSA-18192,CSA-18197"
        version = "202012141608"
        last_modified = "2020-12-14"
        malware_family = "OlympicDestroyer"
    strings:
        // XML-style strings used to process credential output from stealers
        $str_tag_startcred = "<STARTCRED>" wide fullword
        $str_tag_startpass = "<STARTPASS>" wide fullword
        $str_tag_endcred = "<ENDCRED>" wide fullword
    condition:
        all of them
}

rule CrowdStrike_CSIT_18035_02 : zeus bot pos_scraper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "XOR loop used in version 2 of the Zeus banking malware."
        reports = "CSIT-18035"
        version = "201803050000"
        last_modified = "2018-03-05"
        malware_family = "Zeus, Flokibot"
    strings:
        // XOR decryption loop of getBaseConfig()
        $getbaseconfig = { 8b 0d ?? ?? ?? ?? 03 0d ?? ?? ?? ?? 8b f2 2b c8 8a 14 01 30 10 40 4e 75 f7 5e c3 }
    condition:
        $getbaseconfig
}

rule CrowdStrike_CSIT_18035_03 : zeus bot pos_scraper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "String decryption routine used in Zeus and Flokibot."
        reports = "CSIT-18035"
        version = "201803050000"
        last_modified = "2018-03-05"
        malware_family = "Zeus, Flokibot"
    strings:
        $code = { 8b 78 04 0f b6 18 0f b7 ca 66 0f be 3c 0f 66 33 fb 66 33 fa bb ff 00 00 00 66 23 fb 42 66 89 3c 4e 66 3b 50 02 72 }
    condition:
        $code
}

rule CrowdStrike_CSA_17413_01 : dropper lzoxor venomous_bear 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "VENOMOUS BEAR LzoXor dropper used to deploy Snake"
        version = "201908131611"
        last_modified = "2019-08-13"
        actor = "VENOMOUS BEAR"
        malware_family = "Snake"
    strings:
        $ = { 0f b6 11 c1 ea 02 c1 e6 06 8d b4 32 01 07 00 00 8b f8 2b fe 0f b6 17 88 10 0f b6 57 01 88 50 01 0f b6 57 02 41 88 50 02 83 c0 03 }
        $ = { 30 54 31 ff 3b 8d ec fd ff ff 72 }
    condition:
        all of them
}

rule CrowdStrike_CSIT_18038_03 : tiny_spider tinyloader loader downloader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule identifies an XOR routine used in TinyLoader x86 to brute force an XOR key."
        reports = "CSIT-18038,CSIT-18077"
        version = "201807301005"
        last_modified = "2018-07-30"
        actor = "TINY SPIDER"
        malware_family = "TinyLoader"
    strings:
        // Detects byte pattern of brute XOR. The wild cards are bytes that designate the
        // the stop pattern
        $ = { 31 08 81 38 ?? ?? ?? ?? 74 0a 83 fb 00 75 05 31 08 41 eb ec }
        $ = { 68 00 30 00 00 68 00 80 02 00 6a 00 ff 15 }
    condition:
        all of them and uint16(0) == 0x5A4D
}

rule CrowdStrike_CSIT_19067_02 : autodown downloader fancy_bear 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "FANCY BEAR AutoDown downloader"
        reports = "CSIT-19067"
        version = "201905030901"
        last_modified = "2019-05-03"
        actor = "FANCY BEAR"
        malware_family = "AutoDown"
    strings:
        $autodown_indicator_1 = "_hextostring" nocase
        $autodown_indicator_2 = "BinaryToString" nocase
        $recon_indicator_2 = "\" /U /C VOL \"" nocase
        $recon_indicator_3 = "\"U\" & \" /\" & \"C \" & \"V\" & \"O\" & \"L \"" nocase
        $recon_indicator_4 = "vsnd = getdrive() & compname()"
        $recon_indicator_5 = "_dosrun(\"VOL\")"
        $http_indicator_1 = "_winhttpsimplesendrequest" nocase
        $http_indicator_2 = "winhttp.winhttprequest.5.1" nocase
        $http_indicator_3 = ".setrequestheader(" nocase
    condition:
        all of ($autodown_indicator_*)
        and any of ($recon_indicator_*)
        and any of ($http_indicator_*)
}

rule CrowdStrike_CSIT_18049_01 : rat royalcli royaldns 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects a variant of RoyalCLI dubbed RoyalDNS, which uses DNS tunnels for C2."
        reports = "CSIT-18049"
        version = "202009181630"
        last_modified = "2020-09-18"
        malware_family = "RoyalCLI, RoyalDNS"
    strings:
        $wobject = "myWObject"
        $base32_alphabet = "\x00abcdefghijklmnopqrstuvwxyz012345\x00"
    condition:
        all of them
}

rule CrowdStrike_CSIT_19044_02 : backdoor skid 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects decoded copies of the SKID malware."
        reports = "CSIT-19044,CSIT-20020"
        version = "202004072012"
        last_modified = "2020-04-07"
        malware_family = "SKID"
    strings:
        $c2tag0 = "[not_really_random]"
        $c2tag1 = "[task_executed]"
        $c2tag2 = "[task_id]"
        $c2tag3 = "[abc]"
        $c2tag4 = "[petype]"
        $c2tag5 = "[url]"
        $c2tag6 = "[hwid1]"
        $c2tag7 = "[product]"
        $c2tag8 = "[volume_serial]"
        $c2tag9 = "[protection]"
        $c2tagA = "[username]"
        $c2tagB = "[pcname]"
        $c2act1 = "case \"more_eggs\":"
        $c2act2 = "case \"more_onion\":"
        $reg1 = "\"HKEY_CURRENT_USER\\\\Software\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Run\\\\\""
        $reg2 = "\"HKEY_CURRENT_USER\\\\Software\\\\Microsoft\\\\Notepad"
    condition:
        8 of ($c2tag*) or (any of ($c2act*) and all of ($reg*))
        and filesize < 120KB
}

rule CrowdStrike_CSIT_19044_03 : loader skid 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detect a loader used with SKID malware."
        reports = "CSIT-19044,CSIT-20020"
        version = "202001302357"
        last_modified = "2020-01-30"
        malware_family = "SKID"
    strings:
        $xml_head = /\<\?xml version=.?\d.\d.?\?\>\s*\<xsl\:stylesheet version=.?\d\.\d/
        $xml_script = /\<msxsl\:script language="JScript" implements-prefix="\w+"\>\s*\<!\[CDATA\[\s*function\s\w{4,}\(\w{5,},\s\w{5,}\)/
        $xml_call = /\<xsl:value-of select="/
        $js1 = "charCodeAt"
        $js2 = "while"
        $js3 = "String.fromCharCode"
        $js4 = "new Function"
        $js5 = ".toString();"
        $js6 = "catch"
        $js7 = "try"
    condition:
        $xml_head at 0
        and $xml_call
        and $xml_script
        and uint32(@xml_script+52)==uint32(@xml_call+22)
        and filesize < 120KB
        and filesize > 60KB
        and 4 of ($js*)
}

rule CrowdStrike_CSA_18253_01 : delivery_document labyrinth_chollima 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "LABYRINTH CHOLLIMA macro doc using XOR/hex encoded PE files"
        reports = "CSA-18253,CSIT-19013"
        version = "201901231717"
        last_modified = "2019-01-23"
        actor = "LABYRINTH CHOLLIMA"
    strings:
        $docheader = { D0 CF 11 E0 }
        $vba = "_VBA_PROJECT" wide
        $str_docopen = "AutoOpen"
        $str_gaqz = "gaqz"
        $str_enc1 = "SvoujnfCsplfs/fyf"
        $str_caption = "Caption"
        $str_activewindow = "ActiveWindow"
        // Excel file defeats
        $excel = "Microsoft Excel"
        $sheet = "Excel.Sheet.8"
    condition:
        $docheader at 0
        and $vba and 4 of ($str_*)
        and not 2 of ($excel, $sheet)
}

rule CrowdStrike_CSA_18253_02 : labyrinth_chollima rat wolfrat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "LABYRINTH CHOLLIMA WolfRAT - structural similarities to Hawup"
        reports = "CSA-18253"
        version = "202012141557"
        last_modified = "2020-12-14"
        actor = "LABYRINTH CHOLLIMA"
        malware_family = "WolfRAT"
    strings:
        $xor_code = { 30 84 0D 8C FE FF FF 04 57 41 32 C3 81 F9 }
        $marker = "KXBIXMXJ"
        $ssl = "CLNTSRVRclient finished"
        $api1 = { E0 EE D9 C5 }
        $api2 = { CE E7 B8 B9 }
        $api3 = { A5 CF E7 C7 }
        $api4 = { 8B 8B 8B 8B }
    condition:
        2 of ($xor_code, $marker, $ssl) or all of ($api*)
}

// WARNING: This rule will only work with YARA 3
import "pe"
import "math"

rule CrowdStrike_CSIT_18050_01 : strongpity restark dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "StrongPity Dropper"
        reports = "CSIT-18050"
        version = "201804201732"
        last_modified = "2018-04-20"
        malware_family = "ReStark"
    strings:
        $e_xor_loop = { 80 70 01 ?? 80 70 02 ?? 80 70 03 ?? }
        $e_rc4 = { fe c7 0f b6 f7 8a 1c 06 02 d3 88 55 0b 0f b6 d2 }
        $e_blowfish_key_derive = { 0f b7 45 08 99 be 0a 00 00 00 f7 fe 33 f6 0f b7 c2 }
    condition:
        uint16(0) == 0x5a4d and
        pe.number_of_resources>3 and
        for 3 i in (0..pe.number_of_resources-1):
        (
        pe.resources[i].type==pe.RESOURCE_TYPE_HTML and
        math.entropy(pe.resources[i].offset, pe.resources[i].length) >= 6.0
        ) and 1 of ($e*)
}

rule CrowdStrike_CSIT_18050_02 : strongpity restark tasking 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "ReStark network component"
        reports = "CSIT-18050"
        version = "201804201732"
        last_modified = "2018-04-20"
        malware_family = "ReStark"
    strings:
        $a = "name=%s"
        $b = "delete=ok"
        $c = "CURLOPT_SSL_VERIFYHOST"
    condition:
        uint16(0) == 0x5a4d and all of them
}

rule CrowdStrike_CSIT_18050_03 : strongpity restark tasking 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "ReStark module loader"
        reports = "CSIT-19050"
        version = "201804201732"
        last_modified = "2018-04-20"
        malware_family = "ReStark"
    strings:
        $a = "start_thread"
        $m1 = "whtnwfc.dll"
        $m2 = "lngwyztn.dll"
        $m3 = "kltgtr.dll"
        $m4 = "scpctr.dll"
        $m5 = "fll.dll"
        $m6 = "Wrlck.dll"
        $m7 = "Prst.dll"
    condition:
        uint16(0)==0x5a4d and $a and any of ($m*)
}

rule CrowdStrike_CSIT_18050_04 : restark strongpity tasking 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "ReStark implant module"
        reports = "CSIT-18050"
        version = "201903221017"
        last_modified = "2019-03-22"
        malware_family = "ReStark"
    strings:
        $zip = "ct_init: 256+dist != 512"
        $export = "start_thread"
        $shift_xor = { 8A [3-6] 8A D? C0 E? 04 32 D? 88 [3-6] 4? 3B ?? 72 }
        $shift_xor_2 = { 8A [2] C0 E? 04 (30|32) [2] 4? 3B ?? 72 }
        $exfil1 = "d_app0_%u" ascii wide
        $exfil2 = "win_obj_" ascii wide
        $exfil3 = "%d_.res\x00" ascii wide
        $exfil4 = "%02d_.res\x00" ascii wide
        $exfil5 = "*_.res\x00" ascii wide
        $exfil6 = "tar.bin" fullword ascii wide
        $exfil7 = "%s\\*.sft" ascii wide fullword
        $exfil8 = "_%u.res" ascii wide
        $exfil9 = "%s_%u.sft" ascii wide fullword
        $exfil10 = "ms_com_microsoft_app" ascii wide
        $exfil11 = "msattrib32_" ascii wide
    condition:
        uint16(0) == 0x5a4d and ($zip or $export or $shift_xor or $shift_xor_2) and 2 of ($exfil*)
}

rule CrowdStrike_CSIT_18050_05 : strongpity restark tasking 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "ReStark service executable"
        reports = "CSIT-18050"
        version = "201804201731"
        last_modified = "2018-04-20"
        malware_family = "ReStark"
    strings:
        $s_service_name = "Microsoft Software Support Provider"
        $s_exe_name = "netdev32.exe"
        $g_winsta = "winsta0\\default"
        $g_explorer = "explorer.exe"
        $g_debug = "SeDebugPrivilege"
        $g_srvce = "StartServiceCtrlDispatcher"
        $g_userproc = "CreateProcessAsUser"
        $g_winappi = "CWinApp"
        $g_path = ":\\windows\\system32\\"
    condition:
        uint16(0)==0x5a4d and (any of ($s*) or all of ($g*))
}

rule CrowdStrike_CSIT_18050_06 : strongpity restark tasking 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "ReStark installer"
        reports = "CSIT-18050"
        version = "201804201730"
        last_modified = "2018-04-20"
        malware_family = "ReStark"
    strings:
        $a1 = "AdobeF1ash" ascii wide
        $a2 = "F1ashPlug" ascii wide
        $a3 = "images\\" ascii wide
        $a4 = "license.log" ascii wide
        $a5 = "eula.log" ascii wide
        $a6 = "license.dll" ascii wide
        $a7 = "eula.dll" ascii wide
    condition:
        uint16(0) == 0x5a4d and 3 of ($a*)
}

rule CrowdStrike_CSIT_18050_07 : restark strongpity tasking 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "ReStark encoding"
        reports = "CSIT-18050"
        version = "201903221016"
        last_modified = "2019-03-22"
        malware_family = "ReStark"
    strings:
        $e_shift_xor = { 8A [3-6] 8A D? C0 E? 04 32 D? 88 [3-6] 4? 3B ?? 72 }
        $e_shift_xor_2 = { 8A [2] C0 E? 04 (30|32) [2] 4? 3B ?? 72 }
    condition:
        uint16(0) == 0x5a4d and any of them
}

rule CrowdStrike_CSIT_18053_01 : smoke_bot bot unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Smoke Unpacked Main (2017 version)"
        reports = "CSIT-18053"
        version = "201807271631"
        last_modified = "2018-07-27"
        malware_family = "Smoke Bot"
    strings:
        $proc1 = { 05 1D 4A 0B 02 5C 19 19 }
        $proc2 = { 1D 04 0E 1C 0B 5D 18 06 }
        $proc3 = { 0A 12 07 1D 18 51 0B 06 }
        $win1 = { 5D 1C 5C 0E 41 1B 42 1D }
        $win2 = { 5A 10 0C 4B 43 5C 4F 1D }
        $win3 = { 4F 1B 15 56 5E 41 1A 57 }
        $com1 = { EE 14 02 00 00 00 00 00 C0 00 00 00 00 00 00 46 }
        $com2 = { 01 14 02 00 00 00 00 00 C0 00 00 00 00 00 00 46 }
        $com3 = { 0B 01 00 00 00 00 00 00 C0 00 00 00 00 00 00 46 }
    condition:
        all of ($com*) and any of ($proc*) and any of ($win*)
}

rule CrowdStrike_CSIT_18053_02 : credential_theft plugin smoke_bot unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Smoke Bot Stealer Plugin"
        reports = "CSIT-18053"
        version = "202008101942"
        last_modified = "2020-08-10"
        malware_family = "Smoke Bot"
    strings:
        $s1 = ".bit"
        $s2 = "TModule_Odigo"
        $s3 = "%s%s%s: %d%s%s"
        $s4 = "AIMPro"
        $s5 = "del_reg://"
        $S6 = "K:\\Other\\Grabber\\FULL_normal_new\\SysUtils.pas"
        $w1 = "Content-Type: application/x-www-form-urlencoded" wide
        $w2 = "POST" wide
    condition:
        all of them
}

rule CrowdStrike_CSIT_18053_03 : credential_theft plugin smoke_bot unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Smoke Bot Form Grabber Plugin"
        reports = "CSIT-18053"
        version = "202008101943"
        last_modified = "2020-08-10"
        malware_family = "Smoke Bot"
    strings:
        $s1 = "%s{:!:}%s{:!:}%s{:!:}"
        $s2 = "fgclearcookies"
        $s3 = "PR_Write"
        $s4 = "application/json"
        $s5 = ".bit"
        $w1 = "\\Yandex\\YandexBrowser\\User Data\\Default\\Cookies" wide
        $w2 = "AC\\#!001\\INetCookies\\" wide
        $w3 = "\\Packages\\Microsoft.MicrosoftEdge_8wekyb3d8bbwe\\" wide
        $w4 = "\\Macromedia\\Flash Player\\" wide
        $hook1 = { 68 A0 7F FF F8 68 0D C4 0E 0F 68 04 10 55 07 }
        $hook2 = { 68 FF 05 D0 01 68 55 5D 0D 55 68 88 0F 5F 55 }
    condition:
        3 of ($s*) and 3 of ($w*) and 1 of ($hook*)
}

rule CrowdStrike_CSIT_18053_04 : plugin smoke_bot unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Smoke Bot Hidden TeamViewer Plugin"
        reports = "CSIT-18053"
        version = "202008101735"
        last_modified = "2020-08-10"
        malware_family = "Smoke Bot"
    strings:
        $s1 = "%s{:!:}%s"
        $s2 = "TeamViewer.exe"
        $s3 = "runhtv"
        $s4 = ".bit"
        $bitdns1 = { 8B 3B D0 F6 82 FF 49 5A 1F 03 87 E8 34 AE 37 A8 B9 79 B1 B1 }
        $bitdns2 = { B9 79 B1 35 3E 71 CB 37 90 4C 85 26 A9 EF CA CA 05 87 B7 92 }
        $w1 = "Content-Type: application/x-www-form-urlencoded" wide
        $w2 = "POST" wide
        $w3 = "Software\\TeamViewer" wide
    condition:
        all of them
}

rule CrowdStrike_CSIT_18053_05 : credential_theft plugin smoke_bot unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Smoke Bot Password Sniffer Plugin"
        reports = "CSIT-18053"
        version = "202008101734"
        last_modified = "2020-08-10"
        malware_family = "Smoke Bot"
    strings:
        $s1 = "ftp://%s:%s@%s:%d"
        $s2 = "smtp://%s:%s@%s:%d"
        $s3 = "pop3://%s:%s@%s:%d"
        $s4 = "imap://%s:%s@%s:%d"
        $s5 = "AUTH LOGIN"
        $s6 = ".bit"
        $hook1 = { 68 A0 7F FF F8 68 0D C4 0E 0F 68 04 10 55 07 }
        $hook2 = { 68 FF 05 D0 01 68 55 5D 0D 55 68 88 0F 5F 55 }
    condition:
        3 of ($s*) and 1 of ($hook*)
}

rule CrowdStrike_CSIT_18053_06 : keylogger plugin smoke_bot unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Smoke Bot Keylogger Plugin"
        reports = "CSIT-18053"
        version = "202008101735"
        last_modified = "2020-08-10"
        malware_family = "Smoke Bot"
    strings:
        $s1 = "keylog_rules"
        $s2 = "%s%d%d%d"
        $s3 = "GetClipboardData"
        $s4 = ".bit"
        $w1 = "New Window Caption ->" wide
        $w2 = "[%02d.%02d.%d %02d:%02d:%02d]" wide
        $hook1 = { 68 A0 7F FF F8 68 0D C4 0E 0F 68 04 10 55 07 }
        $hook2 = { 68 FF 05 D0 01 68 55 5D 0D 55 68 88 0F 5F 55 }
    condition:
        all of them
}

rule CrowdStrike_CSIT_18053_07 : plugin smoke_bot unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Smoke Bot Email Grabber Plugin"
        reports = "CSIT-18053"
        version = "202008101735"
        last_modified = "2020-08-10"
        malware_family = "Smoke Bot"
    strings:
        $s1 = ".bit"
        $s2 = "SMTP"
        $s3 = "outlook.exe"
        $bitdns1 = { 8B 3B D0 F6 82 FF 49 5A 1F 03 87 E8 34 AE 37 A8 B9 79 B1 B1 }
        $bitdns2 = { B9 79 B1 35 3E 71 CB 37 90 4C 85 26 A9 EF CA CA 05 87 B7 92 }
        $w1 = "Content-Type: application/x-www-form-urlencoded" wide
        $w2 = "%APPDATA%\\Microsoft\\Outlook" wide
        $w3 = "%APPDATA%\\Thunderbird" wide
        $w4 = "%APPDATA%\\The Bat!" wide
        $w5 = "%APPDATA%\\BatMail" wide
        $w6 = "POST" wide
    condition:
        all of them
}

rule CrowdStrike_CSIT_18053_08 : plugin smoke_bot unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Smoke Bot Procmon Plugin"
        reports = "CSIT-18053"
        version = "202008101734"
        last_modified = "2020-08-10"
        malware_family = "Smoke Bot"
    strings:
        $s1 = ".bit"
        $s2 = "procmon_rules"
        $s3 = "ExitWindowsEx"
        $s4 = "CreateToolhelp32Snapshot"
        $w1 = "Content-Type: application/x-www-form-urlencoded" wide
        $w2 = "POST" wide
    condition:
        all of them
}

rule CrowdStrike_CSIT_18053_09 : plugin smoke_bot unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Smoke Bot Monero Miner Plugin"
        reports = "CSIT-18053"
        version = "202008101734"
        last_modified = "2020-08-10"
        malware_family = "Smoke Bot"
    strings:
        $s1 = "miner_rules="
        $s2 = ".bit"
        $w1 = "\"%s\" -o stratum+tcp://%s -u %s -p %s --safe" wide
        $w2 = "Content-Type: application/x-www-form-urlencoded" wide
        $w3 = "POST" wide
    condition:
        all of them
}

rule CrowdStrike_CSA_18254_01 : olympicdestroyer inject 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Code to perform injection into target process, seen in OlympicDestroyer and related samples"
        reports = "CSA-18254"
        version = "201805301234"
        last_modified = "2018-05-30"
        example_hash = "988d6844d643588ce549f7eea16669c1405e1db5999508a9a662172b0e74b64b"
    strings:
        /* Code from starting VA 004096ef:
        push    ebp
        mov     ebp, esp
        push    ebx
        push    esi
        push    edi
        push    eax
        push    ebx
        lea     eax, InjectedCodeEnd
        lea     ebx, InjectedCode
        sub     eax, ebx
        mov     ebx, [ebp+InjectedCodeSizePtr]
        mov     [ebx], eax
        lea     eax, InjectedCode
        mov     ebx, [ebp+InjectedCodePtr]
        mov     [ebx], eax
        pop     ebx
        pop     eax
        jmp     InjectedCodeEnd
        mov     eax, 0DEADBEEFh
        mov     ebp, esp
        */
        $code_va_004096EF = { 55 8B EC 53 56 57 50 53 8D 05 ?? ?? ?? ?? 8D 1D ?? ?? ?? ?? 2B C3 8B 5D 0C 89 03 8D 05 ?? ?? ?? ?? 8B 5D 08 89 03 5B 58 E9 EC 00 00 00 B8 EF BE AD DE 8B EC }
    condition:
        filesize < 2MB and
        $code_va_004096EF
}

rule CrowdStrike_CSIT_18058_01 : ratankbapos pos loader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detection for RatankbaPoS loader"
        reports = "CSIT-18058"
        version = "201804171116"
        last_modified = "2018-04-17"
        malware_family = "RatankbaPoS"
    strings:
        $ = "SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run"
        $ = "Nimo Software HTTP Retriever "
        $ = "KSNETADSL.dll" nocase
        $ = "WriteProcessMemory"
    condition:
        all of them
}

rule CrowdStrike_CSIT_18058_02 : ratankbapos pos 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detection for RatankbaPoS track data loader"
        reports = "CSIT-18058"
        version = "201804171116"
        last_modified = "2018-04-17"
        malware_family = "RatankbaPoS"
    strings:
        $ = "Content-Type: application/x-www-form-urlencoded"
        $ = "Nimo Software HTTP Retriever "
        $ = "[%04d-%02d-%02d %02d:%02d:%02d.%03d][PID:%4u][TID:%4u] %s"
        $ = "third parameter maybe size = 0x%x"
        $ = "initialize_func(%s, %s) %s"
    condition:
        3 of them
}

rule CrowdStrike_CSIT_18060_01 : btcware ransomware 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects BTCWare; Rapid Ransomware Variant"
        reports = "CSIT-18060"
        version = "201807301111"
        last_modified = "2018-07-30"
        malware = "BTCWare, RapidRansomware"
    strings:
        $btcware = { 8B 45 F8 03 45 EC 0F B6 08 8B 55 08 03 55 E0 0F B6 02 8B 55 08 03 55 EC 0F B6 12 0F AF C2 33 C8 }
    condition:
        $btcware
}

rule CrowdStrike_BERSERK_BEAR_Trojanized_SSHd : berserk_bear trojan 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects trojanized SSHd binaries deployed by BERSERK BEAR on compromised servers"
        reports = "CSA-19753"
        version = "202106171611"
        last_modified = "2021-06-17"
        actor = "BERSERK BEAR"
    strings:
        $mark = "--MARK-- %s %s%s"
    condition:
        uint32(0) == 0x464c457f and $mark
}

rule CrowdStrike_RcmdBatchScript_CmdExecuter : script post_exploitation 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects a malicious batch script used to allow an attacker to execute commands. It is part of a tool called 'Rcmd by NetPatch'. While Rcmd is publicly available is has been observed to be in use by Chinese state sponsored actors."
        version = "201804251559"
        last_modified = "2018-04-25"
    strings:
        $impersonate = "winmgmts:{impersonationLevel=impersonate}"
        $h8002 = "&H80000002"
        $readvbs = "\\read.vbs"
        $exec = "WScript.CreateObject(\"WScript.Shell\")"
    condition:
        filesize < 10KB and ($impersonate and $h8002) and ($readvbs or $exec)
}

rule CrowdStrike_CSA_18297_01 : chinch rat venomous_bear 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects characteristic code for newer variants of Chinch rats."
        reports = "CSA-18297,CSIT-19227"
        version = "201912192311"
        last_modified = "2019-12-19"
        actor = "VENOMOUS BEAR"
        malware_family = "Chinch"
    strings:
        $ = { 8b 45 f4 8b 4d d4 66 8b 14 41 66 89 55 88 c7 45 8c ff ff ff ff 0f bf 45 88 8b 4d 98 3b 41 14 76 }
    condition:
        all of them
}

rule CrowdStrike_CSIR_18005_01 : carbon_spider bateleur dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "CARBON SPIDER Bateleur document dropper"
        reports = "CSIR_18005"
        version = "201807271818"
        last_modified = "2018-07-27"
        actor = "CARBON SPIDER"
    strings:
        $a_1 = "118, 97, 114, 32, 115, 104, 101, 108, 108, 111, 98, 106,"
        $a_2 = "();|*|new Function("
        //var oles = new ActiveXObject("Scripting.FileSystemObject
        $a_3 = {76 61 72 20 6F 6C 65 73 20 3D 20 6E 65 77 20 41
        63 74 69 76 65 58 4F 62 6A 65 63 74 28 22 53 63
        72 69 70 74 69 6E 67 2E 46 69 6C 65 53 79 73 74
        65 6D 4F 62 6A 65 63 74}
        $b_1 = "118,!!!97,!!!114,!!!32,!!!115,!!!104,!!!101,!!!108,!!!108,!!!111,!!!98,!!!106,"
        $b_2 = ");|*|new!!!Function("
        $b_3 = {76 61 72 21 21 21 6F 6C 65 73 21 21 21 3D 21 21
        21 6E 65 77 21 21 21 41 63 74 69 76 65 58 4F 62
        6A 65 63 74 28 22 53 63 72 69 70 74 69 6E 67 2E
        46 69 6C 65 53 79 73 74 65 6D 4F 62 6A 65 63 74
        22 29}
    condition:
        (all of ($a*)) or (all of ($b*))
}

rule CrowdStrike_CSIR_18005_02 : carbon_spider rat sekur 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects an unpacked x64 version of Sekur."
        reports = "CSIR_18005"
        version = "202004231851"
        last_modified = "2020-04-23"
        actor = "CARBON SPIDER"
    strings:
        $cmd1 = {87 79 A3 0A}
        $cmd2 = {A5 A8 7A 00}
        $cmd3 = {BF FA 7C 00}
        $cmd4 = {C4 33 E5 06}
        $cmd5 = {09 45 68 00}
        $cmd6 = {A5 A8 C6 07}
        $api1 = {BA B1 E3 14 06}
        $api2 = {BA 51 8A 34 0C}
        $api3 = {BA 01 10 8A 00}
        $api4 = {BA 11 89 D6 0A}
        $api5 = {BA 33 6C D9 07}
        $api6 = {BA 61 14 E4 0E}
    condition:
        (4 of ($cmd*)) and (4 of ($api*))
}

rule CrowdStrike_CSA_18309_01 : manuscrypt chollima rat labyrinth_chollima 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects new variant of Manuscrypt malware used by DPRK actors in April 2018"
        reports = "CSA-18309"
        version = "201805021045"
        last_modified = "2018-05-02"
        actor = "LABYRINTH CHOLLIMA"
        malware = "Manuscrypt"
    strings:
        $str_classname          = ".?AVCWebPacket@@"
        $str_password           = "*dJU!*JE&!M@UNQ@"
        $str_wm                 = "WM*.tmp"
        $str_fm                 = "FM*.tmp"
        $str_jpg                = "Content-Disposition: form-data; name=\"file1\"; filename=\"img01_29.jpg\""
        // Build RC4 key on stack
        /* Code from starting VA 100024e1:
        mov     [ebp+var_14], 4C2E2978h
        mov     [ebp+var_10], 0D0B5A35Dh
        mov     [ebp+var_C], 0B781F067h
        mov     [ebp+var_8], 93D5E536h
        */
        $code_va_100024E1 = { C7 ?? ?? 78 29 2E 4C C7 ?? ?? 5D A3 B5 D0 C7 ?? ?? 67 F0 81 B7 C7 ?? ?? 36 E5 D5 93 }
        // RC4 init code
        /* Code from starting VA 100023c1:
        mov     ecx, [ebp+var_4]
        inc     edi
        movzx   eax, byte ptr [eax+ecx]
        add     al, dl
        add     bl, al
        movzx   ecx, bl
        movzx   eax, byte ptr [ecx+esi]
        mov     [edi+esi-1], al
        mov     [ecx+esi], dl
        cmp     edi, 100h
        */
        $code_va_100023C1 = { 8B 4D FC 47 0F B6 04 08 02 C2 02 D8 0F B6 CB 0F B6 04 31 88 44 37 FF 88 14 31 81 FF 00 01 00 00 }
        // RC4 crypt code
        /* Code from starting VA 10002438:
        mov     [edi+ecx], al
        mov     [esi+ecx], dl
        movzx   eax, byte ptr [ecx+101h]
        movzx   edx, byte ptr [ecx+100h]
        movzx   eax, byte ptr [eax+ecx]
        add     al, [edx+ecx]
        mov     edx, [ebp+var_4]
        movzx   eax, al
        movzx   eax, byte ptr [eax+ecx]
        xor     al, [edx+ebx-1]
        */
        $code_va_10002438 = { 88 04 0F 88 14 0E 0F B6 81 ?? ?? ?? ?? 0F B6 91 ?? ?? ?? ?? 0F B6 04 08 02 04 0A 8B 55 FC 0F B6 C0 0F B6 04 08 32 44 1A FF }
    condition:
        (2 of ($str_*)) or
        (any of ($code_*) and 1 of ($str_*)) or
        3 of them
}

rule CrowdStrike_CSIT_18061_01 : bot downloader irc phorpiex unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Phorpiex IRC Botnet Strings (includes newer version)"
        reports = "CSIT_18061"
        version = "202002251702"
        last_modified = "2020-02-25"
        malware = "Phorpiex"
    strings:
        $str1 = "Release\\Trik.pdb"
        $str2 = "%s %s \"\" \"x\" :%s"
        $str3 = "http://api.wipmania.com/"
        $str4 = "DeviceConfigManager.exe" wide
        $irc1 = "#ADMIN"
        $irc2 = "#USER"
        $irc3 = "#X64"
        $irc4 = "#X86"
        $irc5 = "rmrf"
        $irc6 = "NICK"
        $irc7 = "JOIN"
        $irc8 = "PING"
        $irc9 = "PONG"
        $irc10 = "USER"
        $irc11 = "PRIVMSG"
        $ua1 = "Mozilla/5.0 (Windows NT 6.1; WOW64; rv:22.0) Gecko/20100101 Firefox/22.0"
        $ua2 = "Mozilla/5.0 (Macintosh; Intel Mac OS X 10.9; rv:25.0) Gecko/20100101 Firefox/25.0"
    condition:
        3 of ($str*) and 7 of ($irc*) and 1 of ($ua*)
}

rule CrowdStrike_CSIT_18061_02 : phorpiex unpacked irc bot spam 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Phorphiex spambot strings"
        reports = "CSIT-18061"
        version = "201807271458"
        last_modified = "2018-07-27"
        malware = "Phorphiex"
    strings:
        $str1 = "WORK\\Release\\Trik.pdb"
        $str2 = "Content-Type: multipart/mixed; boundary= \""
        $str3 = "%s %s \"\" \"x\" :%s"
        $str4 = "http://api.wipmania.com/"
        $fmt1 = "ftp://%s:%s@%s"
        $fmt2 = "smtp://%s|%s:%d|%s|%s"
        $fmt3 = "smtp://%s@%s|%s:%d|%s|%s"
        $fmt4 = "%s, %u %s %u %.2u:%.2u:%.2u %s%.2u%.2u"
        $fmt5 = "%u %s %u %.2u:%.2u:%.2u %s%.2u%.2u"
        $ua1 = "Mozilla/5.0 (Windows NT 6.1; WOW64; rv:22.0) Gecko/20100101 Firefox/22.0"
        $ua2 = "Mozilla/5.0 (Macintosh; Intel Mac OS X 10.9; rv:25.0) Gecko/20100101 Firefox/25.0"
    condition:
        3 of ($str*) and 4 of ($fmt*) and 1 of ($ua*)
}

rule CrowdStrike_Machime_01 : belieber judgment_panda machime rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule identifies the Machime (aka Belieber) malware. It is in use by JUDGMENT PANDA and other China-based actors."
        version = "202010022109"
        last_modified = "2020-10-02"
        actor = "JUDGMENT PANDA"
        malware = "Machime,Belieber"
    strings:
        // SolvAxis S.A. Certificate
        $cert = { 37 E4 18 D2 A1 53 06 84 44 89 F9 9E 30 4B 94 E7 }
        $str_commandshare_pdb = "CommandShare.pdb"
        $str_getadapterinfo = "Error-List of GetAdapterInfo" wide
        $str_trojanver = "TROJANVER:%s" wide
        $c2_open_packet = "<packet>"
        $c2_close_packet = "</packet>"
        $c2_post_index_asp = "POST index.asp HTTP/1.1"
        $c2_accept_bmp = "Accept: image/gif, image/x-xbitmap, */*"
    condition:
        $cert or any of ($str_*) or 3 of ($c2_*)
}

rule CrowdStrike_CSIT_18062_01 : helix_kitten ismdoor rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects ISMDoor config encryption substitution table"
        reports = "CSIT-18062"
        version = "201804260830"
        last_modified = "2018-04-26"
        actor = "HELIX KITTEN"
        malware_family = "ISMDoor"
    strings:
        $code_table_init = { B8 A7 00 00 00 66 89 44 24 ?? C6 44 24 ?? 61 B8 D4 00 00 00 66 89 ?? 24 44 C6 44 24 ?? 62 B8 D0 00 00 00 66 89 44 24 ?? C6 44 24 ?? 63 B8 D2 00 00 00 66 89 44 24 ?? C6 44 24 ?? 64 B8 D8 00 00 00 66 89 44 24 ?? C6 44 24 ?? 65 B8 A5 00 00 00 66 89 44 24 ?? C6 44 24 ?? 66 B8 B6 00 00 00 66 89 44 24 ?? C6 44 24 ?? 67 B8 26 01 00 00 66 89 44 24 ?? C6 44 24 ?? 68 B8 94 01 00 00 66 89 44 24 ?? C6 44 24 ?? 69 B8 82 01 00 00 66 89 44 24 ?? C6 44 24 ?? 6A B8 90 01 00 00 66 89 44 24 ?? C6 44 24 ?? 6B B8 87 01 00 00 66 89 44 24 ?? C6 44 24 ?? 6C B8 4E 02 00 00 66 89 44 24 ?? C6 44 24 ?? 6D B8 A5 02 00 00 66 89 44 24 ?? C6 44 24 ?? 6E B8 AF 02 00 00 66 89 44 24 ?? C6 44 24 ?? 6F B8 70 02 00 00 66 89 44 24 ?? C6 44 24 ?? 70 B8 A7 02 00 00 66 89 45 ?? C6 45 ?? 71 B8 AC 02 00 00 66 89 45 ?? C6 45 ?? 72 B8 6E 02 00 00 66 89 45 ?? C6 45 ?? 73 B8 9E 02 00 00 66 89 45 ?? C6 45 ?? 74 B8 AD 02 00 00 66 89 45 ?? C6 45 ?? 75 B8 36 02 00 00 66 89 45 ?? C6 45 ?? 76 B8 44 02 00 00 66 89 45 ?? C6 45 ?? 77 B8 21 02 00 00 66 89 45 ?? C6 45 ?? 78 B8 A8 02 00 00 66 89 45 ?? C6 45 ?? 79 B8 28 02 00 00 66 89 45 ?? C6 45 ?? 7A B8 E6 01 00 00 66 89 45 ?? C6 45 ?? 30 B8 15 02 00 00 66 89 45 ?? C6 45 ?? 31 B8 F0 01 00 00 66 89 45 ?? C6 45 ?? 32 B8 35 02 00 00 66 89 45 ?? C6 45 ?? 33 B8 40 02 00 00 66 89 45 ?? C6 45 ?? 34 B8 8E 02 00 00 66 89 45 ?? C6 45 ?? 35 B8 BE 01 00 00 66 89 45 ?? C6 45 ?? 36 B8 BF 01 00 00 66 89 45 ??  ?? 45 C6 37 B8 BD 01 00 00 66 89 45 ?? C6 45 ?? 38 B8 86 01 00 00 66 89 45 ?? C6 45 ?? 39 B8 DF 00 00 00 66 89 45 ?? C6 45 ?? 0A B8 1F 01 00 00 66 89 45 ?? C6 45 ?? 0D B8 27 01 00 00 66 89 45 ?? C6 45 ?? 3A B8 52 01 00 00 66 89 45 ?? C6 45 ?? 2E B8 A6 01 00 00 66 89 45 ?? C6 45 ?? 2F B8 97 01 00 00 66 89 45 ?? C6 45 ?? 5C B8 E7 00 00 00 66 89 45 ?? C6 45 ?? 2D}
    condition:
        $code_table_init
}

rule CrowdStrike_CSIT_18062_02 : helix_kitten ismdoor dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects ISMDoor dropper"
        reports = "CSIT-18062"
        version = "201804260836"
        last_modified = "2018-04-26"
        actor = "HELIX KITTEN"
        malware_family = "ISMDoor"
    strings:
        $ = "WmiPrv"
        $ = "Windows Update"
        $ = "/c taskkill /f /im"
        $ = "\\Microsoft\\Windows\\TmpFiles\\*"
        $ = "\\Microsoft\\Windows\\CRMFiles\\*"
        $ = "\\Microsoft\\Windows\\Tmp*"
        $ = "TEXT"
        $ = ".tmp"
        $ = "cmd.exe"
        $ = "\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\\"
        $ = ".lnk"
        $ = "-ExecutionPolicy unrestricted -c $s=(New-Object -COM Wscript.Shell).CreateShortcut("
    condition:
        10 of them
}

rule CrowdStrike_CredHarvesting_Backend : credential_theft php 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule matches on strings commonly found in backend PHP scripts used to harvest credentials."
        version = "202011112004"
        last_modified = "2020-11-11"
    strings:
        $getenv_remote_addr = /getenv\(['\"]REMOTE_ADDR['\"]\);/
        $server_remote_addr = /\$_SERVER\[['"]REMOTE_ADDR['"]\]/
        $field_email_provider = "Email Provider: "
        $field_email_address = "Email Address: "
        $field_password = "Password: "
        $field_email_or_phone = "Email or Phone            :"
        $field_email_tabs = "Email      : "
        $field_email_spaces = "Email    : "
        $field_password_spaces = "Password   : "
        $field_passwd_tabs = "Passwd     : "
        $field_password_tabs = "Password            : "
        $field_username_or_email = "UserName or Email    : "
        $post_email_add = /\$_POST\[("|')eMailAdd("|')\]\./
        $mail = /\Wmail\(\$/
        $field_email_add = "Email Add  : \".$_POST['login']."
        $success_msg1 = "alert('Email Update Successful!!!');"
        $success_msg2 = "alert('Account Update was Successfull!!!');"
        $header1 = "-----------  ! +Account infoS+ !  -----------"
    condition:
        (($server_remote_addr or $getenv_remote_addr) and (2 of ($field*) or $post_email_add or any of ($success_msg*)) and $mail) or $header1
}

rule CrowdStrike_CredHarvesting_BackendCredits : credential_theft 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule looks for strings found in PHP scripts to harvest credentials. These strings are the various actor credit strings which have been discovered."
        version = "201804271122"
        last_modified = "2018-04-27"
    strings:
        $created_by_oktown = "Created By Oktown Wire"
        $created_by_heyotechno = "Created by Heyotechno"
        $created_by_pedro_tools = "= By Pedro Toolz Kartel ="
        $created_by_ryan = "---------------Created BY rYan-------------"
        $coded_by_ay_klem = "Coded By Ay-klem"
        $caribsurf        = "------------CarribSurf---------------------"
        $gmoney = "---------------GMONEY---------------"
        $rezult = "---------=ReZulT=---------"
        $ghost_wire = "---------=by Ghost! Wire =---------"
        $created_by_unknown = "---------------Created BY unknown-------------" nocase
        $created_by_nobody = "----------------created by n0b0dy-------------------" nocase
        $coded_by_ricky = "----Coded by Ricky----------------"
        $coded_by_devv = "--Coded by DEVV----"
        $spamresult = "-----------------Spam ReSulT--------------------" nocase
        $coded_by_lapari = "----Coded by LAPARI----------------"
        $hacked_by_opa_dammy = "--Hacked By Opa Dammy----"
        $god_is_able = "----God is Able----------------"
    condition:
        any of them
}

rule CrowdStrike_CSIT_18064_01 : fancy_bear overlaydropper dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects FANCY BEAR's OverlayDropper variant12345. This variant includes VM evasion."
        reports = "CSIT-18064"
        version = "201807311014"
        last_modified = "2018-07-31"
        actor = "FANCY BEAR"
        malware_family = "OverlayDropper"
    strings:
        $n10 = "10101010"
        $n12345 = "12345"
        $snm = "__snm__" wide
        $sph = "__sph__" wide
        $rtlg = "RtlGetCompressionWorkSpaceSize"
        $rtld = "RtlDecompressBuffer"
    condition:
        (all of ($n*) or all of ($s*))
        and all of ($rtl*)
        and uint32(filesize-4) > 0
        and uint32(filesize-4) < 10
}

rule CrowdStrike_CSIT_18064_02 : fancy_bear overlaydropper dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects the 2012 variant of the FANCY BEAR Overlay dropper"
        reports = "CSIT-18064"
        version = "201807311015"
        last_modified = "2018-07-31"
        actor = "FANCY BEAR"
        malware_family = "OverlayDropper"
    strings:
        $filexor = "filexor"
    condition:
        $filexor
        and uint32(filesize-4) > 10000
        and uint32(filesize-4) < 10000000
        and filesize < 500KB
        and not uint32(0) == 0x464c457f
}

rule CrowdStrike_CSIT_18064_03 : fancy_bear overlaydropper dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects FANCY BEAR's OverlayDropper"
        reports = "CSIT-18064"
        version = "201807311019"
        last_modified = "2018-07-31"
        actor = "FANCY BEAR"
        malware_family = "OverlayDropper"
    strings:
        $ = "jhuhugit.tmp"
    condition:
        all of them
}

rule CrowdStrike_CSIT_18064_04 : fancy_bear overlaydropper dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects FANCY BEAR's OverlayDropper"
        reports = "CSIT-18064"
        version = "201809142024"
        last_modified = "2018-09-14"
        actor = "FANCY BEAR"
        malware_family = "OverlayDropper"
    strings:
        $ = "api-ms-win-samcli-dnsapi-0-0-0.dll"
        $ = "api-ms-win-samcli-dnsapi-0-0-0.dll" wide
        $ = "api-ms-win-downlevel-profile-l1-1-0.dll"
        $ = "api-ms-win-downlevel-profile-l1-1-0.dll" wide
    condition:
        any of them and filesize < 1MB
}

rule CrowdStrike_CSIT_18064_05 : fancy_bear overlaydropper dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects Overlay dropper used by FANCY BEAR"
        reports = "CSIT-18064"
        version = "201807311022"
        last_modified = "2018-07-31"
        actor = "FANCY BEAR"
        malware_family = "OverlayDropper"
    strings:
        $filexor = "filexor"
        $v_12345_1 = "RtlGetCompressionWorkSpaceSize"
        $v_12345_2 = "RtlDecompressBuffer"
        $v_12345_3 = "10101010"
        $v_12345_4 = "12345"
        $v_12345_5 = "__snm__" wide
        $v_12345_6 = "__sph__" wide
        $priv_esc = "TEST" wide
    condition:
        $priv_esc and ($filexor or all of ($v_12345_*))
}

rule CrowdStrike_CSIT_19227_06 : autorun chinch malware rat venomous_bear 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects a characteristic string found in the Autorun code for Agent.BTZ, a tool in VENOMOUS BEAR's Chinch framework."
        reports = "CSIT-19227"
        version = "202001201022"
        last_modified = "2020-01-20"
        actor = "VENOMOUS BEAR"
        malware_family = "Chinch, Autorun Variant"
        date = "2018-04-23"
    strings:
        // characteristic string in the Autorun variant
        $ = {
        4D 65 64 69 61 20 61 72  72 69 76 65 64 3A 20 22
        25 63 3A 22 09 4C 61 62  65 6C 3A 22 25 73 22 09
        46 53 3A 25 73 09 53 4E  3A 25 30 38 58 0A 00 00
        }
    condition:
        all of them
}

rule CrowdStrike_CSA_18335_01 : kwampirs rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Kwampirs payloads and downloaders"
        reports = "CSA-18335"
        version = "202004281136"
        last_modified = "2020-04-28"
        malware = "Kwampirs"
    strings:
        /*
        cmp     eax, esi
        jbe     short loc_1000A385
        xor     edx, edx
        mov     [ecx], dx
        add     ecx, 2
        dec     eax
        jmp     short loc_1000A370
        */
        $inline_memzero = { 3B C6 76 0B 33 D2 66 89 11 83 C1 02 48 EB EB }
        /*
        cdq
        mov     ecx, 1Ah
        idiv    ecx
        add     edx, 41h ; 'A'
        mov     [ebp+var_10], dx
        call    _rand
        cdq
        mov     ecx, 1Ah
        idiv    ecx
        add     edx, 61h ; 'a'
        mov     [ebp+var_E], dx
        call    _rand
        cdq
        mov     ecx, 0Ah
        idiv    ecx
        */
        $gen_rand_alphanumeric = { 99 B9 1A 00 00 00 F7 F9 83 C2 41 66 89 55 ?? E8 ?? ?? ?? ?? 99 B9 1A 00 00 00 F7 F9 83 C2 61 66 89 55 ?? E8 ?? ?? ?? ?? 99 B9 0A 00 00 00 F7 F9 }
        /*
        push    ebp
        mov     ebp, esp
        push    offset aWow64revertwow ; "Wow64RevertWow64FsRedirection"
        push    offset aKernel32Dll_1 ; "kernel32.dll"
        call    ds:GetModuleHandleW
        push    eax             ; hModule
        call    ds:GetProcAddress
        test    eax, eax
        jz      short loc_4031BB
        mov     ecx, [ebp+arg_0]
        push    ecx
        call    eax
        test    eax, eax
        setnz   al
        pop     ebp
        retn
        */
        $Wow64RevertWow64FsRedirection_wrapper = { 55 8B EC 68 ?? ?? ?? ?? 68 ?? ?? ?? ?? FF 15 ?? ?? ?? ?? 50 FF 15 ?? ?? ?? ?? 85 C0 74 0D 8B 4D 08 51 FF D0 85 C0 0F 95 C0 5D C3 }
    condition:
        any of them
}

rule CrowdStrike_CSA_18335_02 : dropper kwampirs 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Kwampirs dropper"
        reports = "CSA-18335"
        version = "202004281136"
        last_modified = "2020-04-28"
        malware = "Kwampirs"
    strings:
        /*
        lea     ecx, [edi+1010]
        xor     eax, eax
        mov     [ebp+var_C6C], eax
        mov     [ebp+var_C68], ecx
        cmp     eax, ebx
        jnb     short loc_405DEB
        mov     edx, eax
        and     edx, 0Fh
        movzx   edx, ds:byte_418FB0[edx]
        movzx   edi, byte ptr [ecx]
        xor     edx, edi
        mov     [eax+esi], dl
        inc     eax
        inc     ecx
        jmp     short loc_405DC3
        */
        $xor_resource = { 8D ?? ?? ?? ?? 00 33 C0 89 85 ?? ?? FF FF 89 8D ?? ?? FF FF 3B ?? 73 18 8B D0 83 E2 0F 0F B6 92 ?? ?? ?? 00 0F B6 ?? 33 ?? 88 14 ?? 40 41 EB D8 }
    condition:
        any of them
}

rule CrowdStrike_CSA_17139_01 : downloader fancy_bear lojack 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "FANCY BEAR CompuTrace LoJack downloader"
        reports = "CSA-17139"
        version = "201903070937"
        last_modified = "2019-03-07"
        actor = "FANCY BEAR"
        malware_family = "CompuTrace LoJack"
    strings:
        $code = {
        5b c9 c2 08 00 68 28 01 00 00 68 f0 13 40 00 e8
        23 ea ff ff 33 ff 89 7d fc 33 db 53 be cc 50 40
        00 a1 44 50 40 00 89 46 10 50 53 53 53 53 53 53
        }
        $config = {
        c6 d0 d4 c7 d6 dd 9b db d4 d8 d0 c4 c0 d0 c7 cc
        }
        $cdata = ".cdata"
    condition:
        $code and
        $cdata in (0..512)
        and not $config
        and filesize < 20KB
}

rule CrowdStrike_Dinosaur_Ransomware_01 : dinosaur ransomware 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects Dinosaur ransomware"
        reports = "CSIT-18066"
        version = "201805021917"
        last_modified = "2018-05-02"
        malware = "Dinosaur Ransomware"
    strings:
        // mutex names
        $ = "Niao shi de gui!"
        $ = "Dryosaurus!"
        $ = "Eoraptor!"
        $ = "Graciliraptor!"
        $ = "Hadrosaurus!"
        $ = "Iguanacolossus!"
        $ = "Mojoceratops!"
        $ = "Nipponosaurus!"
        $ = "Oohkotokia!"
        $ = "Rukwatitan!"
        $ = "Scipionyx!"
    condition:
        any of them
}

rule CrowdStrike_Dinosaur_Ransomware_02 : dinosaur ransomware 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects Dinosaur ransomware"
        reports = "CSIT-18066"
        version = "201805021922"
        last_modified = "2018-05-02"
    strings:
        // xor buffer code
        $ = {
        55 8B EC 60 8B 75 08 8B  FE 33 D2 8B 4D 0C 83 FA
        10 75 02 33 D2 AC 32 82  ?? ?? 40 00 AA 42 49 75
        ED 61 C9 C2 08 00
        }
    condition:
        all of them
}

rule CrowdStrike_Dinosaur_Ransomware_03 : dinosaur ransomware 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects Dinosaur ransomware"
        reports = "CSIT-18066"
        version = "201805021921"
        last_modified = "2018-05-02"
    strings:
        // self-delete batch script
        $ = {
        63 68 63 70 20 31 32 35  31 0D 0A 70 69 6E 67 20
        31 32 37 2E 30 2E 30 2E  31 0D 0A 64 65 6C 20 2F
        66 20 2F 71 20 22 25 73  22 0D 0A 64 65 6C 20 2F
        66 20 2F 71 20 25 25 30  00
        }
    condition:
        all of them
}

rule CrowdStrike_Dinosaur_Ransomware_04 : dinosaur ransomware 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects Dinosaur ransomware"
        reports = "CSIT-18066"
        version = "201805021924"
        last_modified = "2018-05-02"
    strings:
        // characteristic strings
        $ = "HOW TO DECRYPT FILES.txt" ascii
        $ = "ComSpec" ascii
    condition:
        all of them
}

rule CrowdStrike_CSA_18335_03 : dropper kwampirs 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Kwampirs dropper with decoy"
        reports = "CSA-18335"
        version = "202004281136"
        last_modified = "2020-04-28"
        malware = "Kwampirs"
    strings:
        /*
        mov     ecx, [ebx-0Ch]
        or      [ebp+var_47C], ecx
        mov     edx, [edi+0Ch]
        mov     eax, [ebp+var_478]
        or      edx, eax
        xor     edx, eax
        and     edx, 0Fh
        xor     eax, edx
        mov     [ebp+var_478], eax
        mov     ecx, [edi+0Ch]
        or      ecx, eax
        xor     ecx, eax
        and     ecx, 10h
        xor     eax, ecx
        mov     [ebp+var_478], eax
        mov     edx, [edi+0Ch]
        or      edx, eax
        xor     edx, eax
        and     edx, 20h
        xor     eax, edx
        mov     [ebp+var_478], eax
        mov     ecx, [edi+0Ch]
        or      ecx, eax
        xor     ecx, eax
        and     ecx, 40h
        xor     eax, ecx
        mov     ecx, [ebp+var_480]
        mov     [ebp+var_478], eax
        mov     edx, [edi+0Ch]
        or      edx, eax
        xor     edx, eax
        and     edx, 80h
        xor     eax, edx
        mov     [ebp+var_478], eax
        mov     eax, [edi+10h]
        or      [ebp+var_474], eax
        add     edi, 54h ; 'T'
        */
        $xor_routine = { 8B 4B F4 09 8D ?? ?? FF FF 8B 57 0C 8B 85 ?? ?? FF FF 0B D0 33 D0 83 E2 0F 33 C2 89 85 ?? ?? FF FF 8B 4F 0C 0B C8 33 C8 83 E1 10 33 C1 89 85 ?? ?? FF FF 8B 57 0C 0B D0 33 D0 83 E2 20 33 C2 89 85 ?? ?? FF FF 8B 4F ?? 0B C8 33 C8 83 E1 40 33 C1 8B 8D ?? ?? FF FF 89 85 ?? ?? FF FF 8B 57 0C 0B D0 33 D0 81 E2 80 00 00 00 33 C2 89 85 ?? ?? FF FF 8B 47 10 09 85 ?? ?? FF FF 83 C7 54 }
    condition:
        all of them
}

rule CrowdStrike_CSIT_18143_01 : fancy_bear zekapab minizekapab rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Identifies MiniZekapab samples through typical strings found in samples"
        reports = "CSIT-18143"
        version = "201810050835"
        last_modified = "2018-10-05"
        actor = "FANCY BEAR"
        malware_family = "MiniZekapab,Zekapab"
    strings:
        $borland_build_time_stamp = { 50 45 00 00 4c 01 ?? 00 19 5e 42 2a 00 00 00 00 }
        $query_string_part = "debug-info="
        $separator = "XXXXXXX"
        $user_agent = "Mozilla/5.0 (Windows NT 6.1; "
    condition:
        all of them
}

rule CrowdStrike_CSIT_18143_02 : fancy_bear zekapab minizekapab rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Identifies MiniZekapab samples through decoy message found in samples"
        reports = "CSIT-18143"
        version = "201810050836"
        last_modified = "2018-10-05"
        actor = "FANCY BEAR"
        malware_family = "MiniZekapab,Zekapab"
    strings:
        $borland_build_time_stamp = { 50 45 00 00 4c 01 ?? 00 19 5e 42 2a 00 00 00 00 }
        $message = "Word was unable to read this document. It may be corrupt."
    condition:
        all of them
}

rule CrowdStrike_CSIT_18143_03 : fancy_bear zekapab minizekapab rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Identifies MiniZekapab samples through typical strings found in samples"
        reports = "CSIT-18143"
        version = "201810050838"
        last_modified = "2018-10-05"
        actor = "FANCY BEAR"
        malware_family = "MiniZekapab,Zekapab"
    strings:
        $borland_build_time_stamp = { 50 45 00 00 4c 01 ?? 00 19 5e 42 2a 00 00 00 00 }
        $query_string_part = "?fort="
        $encoded_remote = "52656D6F7465"
    condition:
        all of them
}

rule CrowdStrike_CSIT_18100_01 : banker trojan vampiro 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects main DLL of a Brazilian banker family which was internally named Vampiro after one of the first observed C2 servers."
        reports = "CSIT-18100"
        version = "202003121133"
        last_modified = "2020-03-12"
        malware_family = "Vampiro"
    strings:
        $strdec = {
        8B D0 8D 4D ?? B8 ?? ?? ?? ?? E8 ?? ?? ?? ??
        8B 4D ?? 8B 55 ?? 8B 45 ?? E8 ?? ?? ?? ?? 33
        C0 5A 59 59 64 89 10 EB }
        $mutex1 = "hIUOh7890oidf" wide fullword
        $mutex2 = "VB809DFJHWERW" wide fullword
        $api1 = "UnhookWindowsHookEx"
        $api2 = "mouse_event"
        $api3 = "keybd_event"
        $Left = "Left"
        $Width = "Width"
        $Height = "Height"
        $Cursor = "Cursor"
        $TImage = "TImage"
        $TPngImage = "TPngImage"
        $OnClick = "OnClick"
        $PasswordChar = "PasswordChar"
        $embarcadero = "Embarcadero Delphi for Win32 compiler version 32.0"
    condition:
        all of ($api*) and (any of ($mutex*) or $strdec)
        and $embarcadero
        and #Left > 400
        and #Width > 320
        and #Height > 350
        and #Cursor > 150
        and #TImage > 150
        and #TPngImage > 20
        and #OnClick > 100
        and #PasswordChar > 30
}

rule CrowdStrike_UUPay_Android_Adware : adware android uupay 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects the Android adware UUPay"
        version = "201903151053"
        last_modified = "2019-03-15"
        malware_family = "UUPay"
    strings:
        $c2 = /https?:\/\/[a-z]{1,5}\d?\.uuserv\d0\.(net|com)/
        $uupay = ".uupay"
    condition:
        uint32(0)==0x0A786564 // DEX file
        and filesize < 4MB
        and #c2 > 4 and $uupay
}

rule CrowdStrike_Possible_Spectre_Sidechannel_Measurement : exploit meltdown spectre 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects a CPU cache reading pattern that occurs in Spectre type exploits. This pattern is present in all Spectre PoC samples so far for Variants 1 through 4. However, it is known that Spectre type attacks can possibly use other side channels."
        version = "201906221813"
        last_modified = "2019-06-22"
    strings:
        $op_cpuid__rdtsc = { 0FA2   0F31 }
        $op_lfence_rdtsc = { 0FAEE8 0F31 }
        $op_sfence_rdtsc = { 0FAEF8 0F31 }
        $op_mfence_rdtsc = { 0FAEF0 0F31 }
        $op_rdtscp       = { 0F01F9      }
        $cflush_cmeasure = {
        0F AE 3?
        [0-250]
        0F (A2 0F 31 | AE E8 0F 31 | AE F8 0F 31 | AE F0 0F 31 | 01 F9)
        [2-50]
        0F (A2 0F 31 | AE E8 0F 31 | AE F8 0F 31 | AE F0 0F 31 | 01 F9)
        }
    condition:
        $cflush_cmeasure and any of ($op_*)
}

rule CrowdStrike_Android_Banker_EXO1 : android banker exobot marcher 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects an Android Banker publicly labeled as Marcher. However, it is distinct from the EXO2 malware, which is also publicly referred to as Marcher."
        version = "201903151052"
        last_modified = "2019-03-15"
        malware_family = "ExoBot,Marcher"
    strings:
        $ = "/proc/%d/cgroup" fullword
        $ = "/proc/%d/stat" fullword
        $ = "setJavaScriptEnabled" fullword
        $ = "LruCache[maxSize=%d,hits=%d,misses=%d,hitRate=%d%%]"
    condition:
        all of them and filesize < 800KB
}

rule CrowdStrike_Android_Banker_EXO2 : android banker exobot marcher unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects the unpacked Android banker EXO2, which is referred to in public reports as a Marcher variant. It is however different from the EXO1 malware, which is also called Marcher sometimes."
        version = "201903151051"
        last_modified = "2019-03-15"
        malware_family = "ExoBot,Marcher"
    strings:
        $zp = "b5jXh37gxgHBrZhQ4j3D" fullword
        $f1 = "start new connection host[%s], port[%d] from ProxyConenction"
        $f2 = "Header { sessionId[%d], type[%d], length[%d] }"
        $f3 = "Server::start() host[%s], commandPort[%d], proxyPort[%d]"
        $f4 = "HTTP response for request=<%s> [lifetime=%d], [size=%s], [rc=%d], [retryCount=%s]"
        $f5 = "%s-timeout-giveup [timeout=%s]"
        $f6 = "%s-retry [timeout=%s]"
        $f7 = "Could not delete cache entry for key=%s, filename=%s"
        $f8 = "application/json; charset=%s"
    condition:
        6 of ($f*) or $zp
}

rule CrowdStrike_CSIT_18069_01 : formbook info_stealer rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects the Formbook infostealer malware."
        reports = "CSIT-18069"
        version = "202002281340"
        last_modified = "2020-02-28"
        malware_family = "Formbook"
    strings:
        /* Config Locator Stub
        call $+5
        pop eax
        ret
        push ebp
        mov ebp, esp */
        $a = { e8 00 00 00 00 58 c3 55 8b ec }
        /* Validate Encrypted Config Header */
        $b = { 80 ?? 55 75 7? 80 ?? ?? 8b 75 7? }
        /* explorer.exe checksum */
        $c = { 68 21 69 99 19 e8 ?? ?? 00 00 }
        /* [System] Stack String */
        $s1 = { c7 45 ?? 5b 00 53 00 c7 45 ?? 79 00 73 00 c7 45 ?? 74 00 65 00 c7 45 ?? 6d 00 5d 00 }
        /* Message Header FBNG */
        $s2 = { c7 ?? ?? 46 42 4e 47 }
    condition:
        (#a > 2) and all of them
}

rule CrowdStrike_CSIT_18063_02 : lockpos pos_scraper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects LockPOS BOT32 samples"
        reports = "CSIT-18063"
        version = "201807300919"
        last_modified = "2018-07-30"
        malware_family = "LockPOS"
    strings:
        $s1 = "lock.pdb" ascii
        $s2 = ".jpg" wide ascii
        $s3 = ".png" wide ascii
        $s4 = ".doc" wide ascii
        $s5 = "%s\\explorer.exe" wide ascii
        $s_mersenne = { 65 89 07 6c }
    condition:
        CrowdStrike_CSIT_18063_01 and 5 of ($s*)
}

rule CrowdStrike_CSIT_18063_03 : lockpos pos_scraper dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects inner dropper component of LockPOS"
        reports = "CSIT-18063"
        version = "201807300920"
        last_modified = "2018-07-30"
        malware_family = "LockPOS"
    strings:
        $pdb = "dropper.pdb" ascii
    condition:
        CrowdStrike_CSIT_18063_01 and $pdb
}

rule CrowdStrike_CSIT_18063_04 : lockpos pos_scraper dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects outer dropper component of LockPOS"
        reports = "CSIT-18063"
        version = "201808131346"
        last_modified = "2018-08-13"
        malware_family = "LockPOS"
    strings:
        $code_decrypt = { 68 00 00 00 f0 6a 18 6a 00 6a 00 8d 45 }
        $s_apis = { 45 78 69 74 50 72 6f 63 65 73 73 00 ?? ?? 56 69 72 74 75 61
        6c 46 72 65 65 00 ?? ?? 56 69 72 74 75 61 6c 41 6c 6c 6f 63
        00 00 ?? ?? 4c 6f 61 64 4c 69 62 72 61 72 79 41 00 00 4b 45
        52 4e 45 4c 33 32 2e 64 6c 6c }
        $rsrc_section = ".rsrc" ascii
    condition:
        uint16(0) == 0x5A4D and filesize < 4096KB and $rsrc_section and $code_decrypt and $s_apis
}

rule CrowdStrike_BOSS_SPIDER_Samas_Runner : boss_spider loader ransomware samas samsam 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects a loader used by Samas ransomware"
        version = "201903061450"
        last_modified = "2019-03-06"
        actor = "BOSS SPIDER"
        malware_family = "Samas"
    strings:
        $entry = {8E 69 1A 2E 01 2A 00 28}
        $pattern = /\*\.\w/ wide
        $func1 = "GetExecutingAssembly" ascii fullword
        $func2 = "get_EntryPoint" ascii fullword
        $func3 = "get_Location" ascii fullword
        $func4 = "ReadAllBytes" ascii fullword
        $func5 = "GetExportedTypes" ascii fullword
        $func6 = "InvokeMember" ascii fullword
    condition:
        uint16(0) == 0x5A4D and ($entry and $pattern and 4 of ($func*))
}

rule CrowdStrike_Samas_SelfDeletion : boss_spider samas samsam ransomware tasking 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects a tool used by Samas ransomware to delete itself."
        version = "201805111236"
        last_modified = "2018-05-11"
        actor = "BOSS SPIDER"
        malware_family = "Samas"
    strings:
        $mvid = {01 00 00 00 39 AA DE C7 63 D6 62 42 B2 ED 67 CA 60 9A 57 51 00}
        $pdb = "f:\\SAM\\selfdel\\selfdel\\obj\\Release\\selfdel.pdb"
        $tlid = "c452dfd9-5bfe-4369-a8fa-207e04074a23"
    condition:
        uint16(0) == 0x5A4D and any of them
}

rule CrowdStrike_CSIR_18006_01 : rat wicked_panda winnti 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects a core component found in Winnti version 3. "
        reports = "CSIR-18006"
        version = "202005010916"
        last_modified = "2020-05-01"
        actor = "WICKED PANDA"
        malware_family = "Winnti"
    strings:
        // Runtime-type information in Winnti V3
        $rtti0 = "DrvCom"
        $rtti1 = "EngineNetEvent"
        $rtti2 = "MyEngineNetEvent"
        $rtti3 = "NetMidLayer"
        $rtti4 = "RemoteMsg"
        $rtti5 = "SubTnlMgr"
        $http_header0 = "Cookie: SN="
        $http_header1 = "User-Agent: Mozilla"
        $refstring1 = "net start IpFilterDriver"
        $refstring2 = "tcpip_thread"
    condition:
        (5 of ($rtti*)) or
        ( all of ($http_header*) and 2 of ($rtti*) ) or
        (all of ($refstring*) ) or
        7 of them
}

rule CrowdStrike_CSIR_18006_02 : rat rootkit wicked_panda winnti 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule looks for a string found in the Winnt v3 rootkit component."
        reports = "CSIR-18006"
        version = "202005010916"
        last_modified = "2020-05-01"
        actor = "WICKED PANDA"
        malware_family = "Winnti"
    strings:
        $ = "\\BaseNamedObjects\\_transmition_synchronization_" wide
    condition:
        all of them
}

rule CrowdStrike_CSIR_18006_03 : loader rat wicked_panda winnti 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule looks for strings present in loader for Winnti version 3."
        reports = "CSIR-18006"
        version = "202005010917"
        last_modified = "2020-05-01"
        actor = "WICKED PANDA"
        malware_family = "Winnti"
    strings:
        $ = { 00 43 72 79 70 74 55 6e 70 72 6f 74 65 63 74 44 61 74 61 00 }
        $ = { 00 63 72 79 70 74 33 32 2e 64 6c 6c 00 }
        $ = "fast_service_main"
    condition:
        all of them
}

rule CrowdStrike_SynAck_EncryptedFile : synack ransomware 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects files encrypted by the SynAck ransomware"
        version = "201808151553"
        last_modified = "2018-08-15"
        malware_family = "SynAck"
    strings:
        $ = { 41 59 41 58 5a 59 50 c3 }
    condition:
        all of them
}

rule CrowdStrike_SynAck_Ransomware : synack ransomware 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects the process doppelganging variant of the SynAck ransomware"
        version = "201805111235"
        last_modified = "2018-05-11"
        malware_family = "SynAck"
    strings:
        $ = { 41 59 41 58 5a 59 50 c3 }
    condition:
        all of them
}

rule CrowdStrike_SynAck_Obfuscation : synack ransomware 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects obfuscated SynAck ransomware samples"
        version = "201805111235"
        last_modified = "2018-05-11"
        malware_family = "SynAck"
    strings:
        $ = { 51 52 41 50 41 51 68 }
        $ = { ff d0 41 59 41 58 5a 59 ff e0 }
        $ = { ff d0 41 59 41 58 5a 59 50 c3 }
    condition:
        all of them
}

rule CrowdStrike_SynAck_CpuDetectCode : synack ransomware 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects unique cpudetect code in the SynAck ransomware"
        version = "201805111235"
        last_modified = "2018-05-11"
        malware_family = "SynAck"
    strings:
        $ = { 40 53 48 83 EC 10 33 C0 33 C9 0F A2 44 8B C1 83 }
    condition:
        all of them
}

rule CrowdStrike_VENOMOUS_BEAR_Mosquito_01 : mosquito rat venomous_bear 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects VENOMOUS BEAR's Mosquito RAT"
        version = "201908131553"
        last_modified = "2019-08-13"
        actor = "VENOMOUS BEAR"
        malware_family = "Mosquito"
    strings:
        // C2
        $c2_uri = "/scripts/m/query.php?id=" wide
        // The useragent is not unique to this malware
        $c2_useragent = "Mozilla/5.0 (Windows NT 6.1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/41.0.2228.0 Safari/537.36" wide
        // ASEP
        $asep_key_1 = "Software\\Microsoft\\Windows\\CurrentVersion\\Run" wide
        $asep_val_1 = "Microsoft Update" wide
        // AV detection
        $av_wmi_1 = "ROOT\\SecurityCenter2" wide
        $av_wmi_2 = "SELECT * FROM AntiVirusProduct"
    condition:
        all of them
}

rule CrowdStrike_VENOMOUS_BEAR_Mosquito_02 : mosquito rat venomous_bear 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects characteristic DLL features used in Mosquito"
        version = "201908131553"
        last_modified = "2019-08-13"
        actor = "VENOMOUS BEAR"
        malware_family = "Mosquito"
    strings:
        $export_1 = "InstallRoutineW"
        $export_2 = "StartRoutine"
        $insdll = "InstructionerDLL"
    condition:
        2 of ($export*) or $insdll
}

rule CrowdStrike_CSIT_18070_01 : retefe banking proxy 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detect the Retefe banking trojan loader script."
        reports = "CSIT-18070"
        version = "201805181549"
        last_modified = "2018-05-18"
        malware = "Retefe"
    strings:
        $ = "JScript" wide
        $ = "CLSIDFromProgID"
        $ = "MultiByteToWideChar"
        $ = {6a 08 e8 ?? ?? 00 00}
        $ = {83 c4 08 c1 e0 03 b9 ff ff ff 7f}
        $ = {(E1|E2) 2A 1A BB F9 A4 CF 11 8F 20 00 80 5F 2C D0 64}
        $ = {E3 A1 01 DB 2B A4 CF 11 8F 20 00 80 5F 2C D0 64}
    condition:
        uint16(0) == 0x5A4D and all of them
}

rule Crowdstrike_CSIT_18074_01 : ricochet_chollima cumulonimbus dropper android 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Dropper for Cumulonimbus RAT"
        reports = "CSIT-18074"
        version = "201805181115"
        last_modified = "2018-05-18"
        actor = "RICOCHET CHOLLIMA"
        malware_family = "Cumulonimbus"
    strings:
        $bytes = { 4e 65 78 74 20 73 63 72 65 65 6e 20 79 6f 75 20
        68 61 76 65 20 74 6f 20 73 65 6c 65 63 74 20 27
        eb b6 81 ed 95 9c ea b8 b0 eb 8f 84 27 20 61 6e
        64 20 74 75 72 6e 20 6f 6e 20 61 63 63 65 73 73
        69 62 69 6c 69 74 79 20 70 65 72 6d 69 73 73 69
        6f 6e }
    condition:
        $bytes
}

rule Crowdstrike_CSIT_18074_02 : android cumulonimbus dropper ricochet_chollima 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Dropper for Cumulonimbus RAT"
        reports = "CSIT-18074"
        version = "201904261358"
        last_modified = "2019-04-26"
        actor = "RICOCHET CHOLLIMA"
        malware_family = "Cumulonimbus"
    strings:
        $apk = "/aaa.apk"
        $cm = "_CMSERVICE"
        $start = "CMService start"
        $java = "CMService.java"
        $scmd = "StartCommand"
    condition:
        3 of them
}

rule Crowdstrike_CSIT_18074_03 : ricochet_chollima cumulonimbus rat android 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Cumulonimbus main module DEX file"
        reports = "CSIT-18074"
        version = "201805181114"
        last_modified = "2018-05-18"
        actor = "RICOCHET CHOLLIMA"
        malware_family = "Cumulonimbus"
    strings:
        $dev = "///////////////DeviceInfo/////////////"
        $sys = "///////////////SYSTEM_APP/////////////"
        $user = "///////////////USER_APP/////////////"
    condition:
        2 of them
}

rule CrowdStrike_Mofksys_Worm : mofksys worm 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects the Mofksys worm. Mofksys has been in the wild since 2009. The variant this rule matches on has been observed since 2011."
        version = "202106091939"
        last_modified = "2021-06-09"
        malware_family = "Mofksys"
    strings:
        /*
        movsx   ecx, ax
        mov     eax, 66666667h
        imul    ebx
        sar     edx, 2
        mov     eax, edx
        mov     ebx, 4Eh ; 'N'
        shr     eax, 1Fh
        add     edx, eax
        mov     eax, esi
        sub     ecx, edx
        jo      loc_4118EB
        imul    eax, 3
        jo      loc_4118EB
        cdq
        idiv    ebx
        mov     eax, 92492493h
        */
        $string_decrypt = { 0F BF C8 B8 67 66 66 66 F7 EB C1 FA 02 8B C2 BB 4E 00 00 00 C1 E8 1F 03 D0 8B C6 2B CA 0F 80 58 02 00 00 6B C0 03 0F 80 4F 02 00 00 99 F7 FB B8 93 24 49 92 }
    condition:
        all of them
}

rule CrowdStrike_CSIT_18077_01 : tiny_spider tinyloader loader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Looks for an xor encoding routine used in the 64-bit version of Tiny Loader."
        reports = "CSIT-18077"
        version = "201807301012"
        last_modified = "2018-07-30"
        actor = "TINY SPIDER"
        malware = "Tiny Loader"
    strings:
        // detects byte pattern of brute XOR. The wild cards are bytes that designate the
        // the stop pattern
        $a = {31 08 90 81 38 ?? ?? ?? ?? 74 10 48 83 FB 00 75 0A 90 31 08 90 FF C1 90 EB E6 }
        $b = { 73 0D 90 48 83 C0 04 90 83 C3 04 90 EB D1 }
    condition:
        ($a and $b) and uint16(0) == 0x5A4D
}

rule CrowdStrike_CSIT_18081_01 : betabot bot infostealer rootkit 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule looks for strings found in BetaBot."
        reports = "CSIT-18081"
        version = "201807271602"
        last_modified = "2018-07-27"
        malware_family = "BetaBot"
    strings:
        $beta = "[BETA]" wide
        $works = "Works!" wide
        $betabot = "Betabot (c)" wide
        $userbased = "coded by Userbased" wide
    condition:
        all of them
}

rule CrowdStrike_CSIT_18083_01 : indrik_spider bitpaymer dridex ransomware 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects unpacked copies of BitPaymer ransomware, which is partially based on the Dridex codebase."
        reports = "CSIT-18083"
        version = "201805251448"
        last_modified = "2018-05-25"
        actor = "INDRIK SPIDER"
        malware = "Bitpaymer Ransomware"
    strings:
        // "view" stack strings
        $a = {6A 20 8B C8 E8 ?? ?? ?? ?? 6A 76 8B C8 E8 ?? ?? ?? ?? 6A 69 8B C8 E8 ?? ?? ?? ?? 57 8B C8 E8 ?? ?? ?? ?? 6A 77 8B C8 E8 }
    condition:
        all of them
}

rule CrowdStrike_CSIT_18080_01 : onliner downloader unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Onliner Loader"
        reports = "CSIT-18080,CSIT-18104"
        version = "201807271617"
        last_modified = "2018-07-27"
        malware_family = "Onliner"
    strings:
        $s1 = "[x] GetTask FileExists=true"
        $s2 = "[x] GetTask FileExists=False"
        $s3 = "service_in_dll"
        $s4 = "ret,"
        $bytes = { 89 c6 89 d7 89 c8 39 f7 77 13 74 2f c1 f9 02 78 2a f3 a5 89 c1 83 e1 03 f3 a4 5f 5e c3 }
    condition:
        all of them
}

rule CrowdStrike_CSIT_18080_02 : onliner bot unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Onliner Spambot (MailerSMTP)"
        reports = "CSIT-18080,CSIT-18104"
        version = "201807271617"
        last_modified = "2018-07-27"
        malware_family = "Onliner"
    strings:
        $fmt1 = "?&1001=4&99="
        $fmt2 = "?&1001=4&898="
        $fmt3 = "?&1001=4&req=3"
        $file1 = "attachments.txt"
        $file2 = "headers.txt"
        $file3 = "clients.txt"
        $file4 = "from.txt"
        $file5 = "acc.txt"
        $file6 = "ssleay32.dll"
        $file7 = "libeay32.dll"
        $s1 = "#URL:http://"
        $s2 = "{to_domain}"
        $s3 = "MailerSMTP"
    condition:
        any of ($fmt*) and 4 of ($file*) and all of ($s*)
}

rule CrowdStrike_CSIT_18080_03 : onliner bot unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Onliner SMTP Checker (CheckerSMTP)"
        reports = "CSIT-18080,CSIT-18104"
        version = "201807271617"
        last_modified = "2018-07-27"
        malware_family = "Onliner"
    strings:
        $fmt = "?&1001=2&99="
        $file1 = "masks.txt"
        $file2 = "dns.txt"
        $file3 = "sub.txt"
        $file4 = "passwords_md5.txt"
        $file5 = "ssleay32.dll"
        $file6 = "libeay32.dll"
        $s1 = "{to_domain}"
        $s2 = "BruteSMTP"
        $s3 = "CheckerSMTP"
    condition:
        $fmt and 4 of ($file*) and all of ($s*)
}

rule CrowdStrike_CSIT_18080_04 : onliner bot unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Onliner IMAP"
        reports = "CSIT-18080,CSIT-18104"
        version = "201807271617"
        last_modified = "2018-07-27"
        malware_family = "Onliner"
    strings:
        $fmt = "?&1001=5&99="
        $file1 = "masks.txt"
        $file2 = "wordsOR.txt"
        $file3 = "wordsAND.txt"
        $file4 = "passwords_md5.txt"
        $file5 = "ssleay32.dll"
        $file6 = "libeay32.dll"
        $s1 = "IMAPSendMailAndReplace"
        $s2 = "BruteSMTP"
        $s3 = "CheckerSMTP"
    condition:
        $fmt and 4 of ($file*) and all of ($s*)
}

rule CrowdStrike_CSIT_18082_01 : voodoo_bear backdoor unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detection for VBS backdoor used by VOODOO BEAR"
        reports = "CSIT-18082"
        version = "201805251433"
        last_modified = "2018-05-25"
        actor = "VOODOO BEAR"
    strings:
        $encoded_lookup = "84,31,24,31,92,52,58,39,58,80,82,20,23,58,48,28,70,43,66,27,2,83,69,38,8,6,94,1,0,33,61,69,83,6,58,48,59,31,82,31,58,2,83,69,92,8,70,70,83,11,69,28,8,70,25,54,58,13,58,22,22"
        $up_gen = "Chr(Int((90-65+1)*Rnd+65)) + Chr(Int((90-65+1)*Rnd+65))"
        $lowercase_gen = "Chr(Int((122-97+1)*Rnd+97)) + Chr(Int((122-97+1)*Rnd+97))"
        $key = "dANuXyrsoq]c/>0j^7,5OP'MLIf_izJE+a-<{&w*(Y63@8;KW.\"\"`TlD~?: Hgp%hbV2x!tnU4[)}$Z=#FQReSvB9\\G1|Cmk"
    condition:
        all of them
}

rule CrowdStrike_MeterpreterLoader_FakeMzHeader_01 : loader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Meterpreter Loader with fake MZ header entry point code"
        version = "201904170754"
        last_modified = "2019-04-17"
        malware_family = "Meterpreter"
    strings:
        // marker
        $ = { f0 b5 a2 56 80 3a 09 00 }
        // fake MZ header code
        $ = {
        4d 5a 41 52 55 48 89 e5 48 83 ec 20 48 83 e4 f0
        e8 00 00 00 00 5b 48 81 c3 b3 18 00 00 ff d3 48
        81 c3 38 09 03 00 49 89 d8 6a 04 5a ff d0
        }
    condition:
        all of them
}

rule CrowdStrike_CSA_18403_01 : rat rootkit 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects the controller executable of the Skynet malware framework."
        reports = "CSA-18403"
        version = "202106221331"
        last_modified = "2021-06-22"
        malware_family = "Skynet"
    strings:
        $mutex_main = "Global\\h48yorbq6rm87zot"
        $mutex_cloudnet = "Global\\Mp6c3Ygukx29GbDk"
        $mutex_event_xmrig = "Global\\xmrigMUTEX31337"
        $mutex_event_xne = "Global\\xneEvent31337"
        $mutex_event_wup = "Global\\wupEvent31337"
        $haikunate = "github.com/yelinaung/go-haikunator.RandomName.Haikunate"
        $path_drivers = "%s\\%s\\drivers"
        $path_sysnative = "%s\\Sysnative\\cmd.exe"
        $path_cloudnet = "%s\\Software\\EpicNet Inc.\\CloudNet"
        $function_1 = "main.commandRegistryGetStartupSignatures"
        $function_2 = "main.commandUpdateCloudnet"
        $function_3 = "main.isRunningInsideVirtualBox"
    condition:
        uint16(0) == 0x5A4D and $haikunate and any of ($mutex*) and 2 of ($function*) and 2 of ($path*)
}

rule CrowdStrike_CSA_18404_01 : downloader empire_powershell obfuscated_empire script 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects documents containing malicious macros which run Obfuscated Empire (an Empire Powershell fork) stagers."
        reports = "CSA-18404"
        version = "201912041800"
        last_modified = "2019-12-04"
        malware = "Obfuscated Empire"
    strings:
        $ = {
        10 00 11 04 4d 75 6c 74 69 50 61 67 65 31 5f 4c
        61 79 6f 75 74 92 cf 10 00 05 04 49 6e 64 65 78
        f1 bf 10 00
        }
    condition:
        all of them
}

rule CrowdStrike_CSIT_18088_01 : berserk_bear goodor dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Goodor dropper/installer"
        reports = "CSIT-18088"
        version = "201806010808"
        last_modified = "2018-06-01"
        actor = "BERSERK BEAR"
        malware_family = "Goodor"
    strings:
        $ = "aaa bbb ccc\\ddd\\eee\\fff\\ggg\\hhh /t REG_SZ /f /v"
    condition:
        all of them
}

rule CrowdStrike_CSIT_18088_02 : berserk_bear downloader goodor 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Goodor downloader"
        reports = "CSIT-18088"
        version = "201906181655"
        last_modified = "2019-06-18"
        actor = "BERSERK BEAR"
        malware_family = "Goodor"
    strings:
        $elib1 = "e.Decode" fullword
        $elib2 = "e.FromB64" fullword
        $elib3 = "e.Decrypt" fullword
        $ua = "Go-http-client/1.1"
    condition:
        2 of ($elib*) and $ua
}

rule CrowdStrike_CSIT_18084_01 : atm_malware prilex 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects variants of the Prilex ATM malware. "
        reports = "CSIT-18084"
        version = "202103302043"
        last_modified = "2021-03-30"
        malware_family = "Prilex"
    strings:
        $vb6 = "MSVBVM60.DLL" ascii
        $api_2 = "CreateToolhelp32Snapshot" ascii
        $api_3 = "VirtualQueryEx" ascii
        $api_4 = "OpenProcess" ascii
        $event_sink_1 = "EVENT_SINK_AddRef" ascii
        $event_sink_2 = "EVENT_SINK_GetIDsOfNames" ascii
        $event_sink_3 = "EVENT_SINK_Invoke" ascii
        $event_sink_4 = "EVENT_SINK_Release" ascii
        $event_sink_5 = "EVENT_SINK_QueryInterface" ascii
        $module_winsock_1 = "system32\\mswinsck.oca" ascii nocase
        $module_winsock_2 = "SysWow64\\MSWINSCK.oca" ascii nocase
        $module_winsock_3 = "SYSTEM\\MSINSCK.oca" ascii nocase
        $module_winsock_4 = "SYSTEM\\MSWINSCK.oca" ascii nocase
        $module_winsock_5 = "VB98\\MSWINSCK.oca" ascii nocase
        $module_winsock_6 = "Firefox\\MSWINSCK.oca" ascii nocase
        $module_vb6_1 = "C:\\Program Files (x86)\\Microsoft Visual Studio\\VB98\\VB6.OLB" ascii
        $module_vb6_2 = "C:\\Program Files\\Microsoft Visual Studio\\VB98\\VB6.OLB" ascii
        $module_vb6_3 = "C:\\Arquivos de programas\\Microsoft Visual Studio\\VB98\\VB6.OLB" ascii
        $mswinsock = "MSWinsockLib.Winsock" ascii
        // Overlapping strings
        $o1 = "2c49f800-c2dd-11cf-9ad6-0080c7e7b78d" wide
        $o6 = "040904B0" wide
    condition:
        $vb6 and all of ($api_*) and #mswinsock >= 2 and 1 of ($module_winsock*) and 1 of ($module_vb6_*) and 3 of ($event_sink_*) and all of ($o*)
}

rule CrowdStrike_CSIT_18084_02 : prilex 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects a variant of the Prilex ATM malware. "
        reports = "CSIT-18084"
        version = "202106031356"
        last_modified = "2021-06-03"
        malware_family = "Prilex"
    strings:
        // Class/member names
        $code00 = "clsDebug" ascii
        $code01 = "clsPercentScan" ascii
        $code02 = "clsTexto" ascii
        $code03 = "mocCapImage" ascii
        $code04 = "Rundll32" ascii
        $code05 = "clsFile" ascii
        $code06 = "clsRegion" ascii
        $code07 = "clsTransaction" ascii
        $code08 = "modComum" ascii
        $code09 = "clsApplication" ascii
        $code10 = "clsMemAtack" ascii
        $code11 = "clsResources" ascii
        $code12 = "frmAguarde" ascii
        $code13 = "modMemAtack" ascii
        $code14 = "clsAprova" ascii
        $code15 = "clsMember" ascii
        $code16 = "clsScanning" ascii
        $code17 = "frmAguarde" ascii
        $code18 = "clsCapRegions" ascii
        $code19 = "clsPackDebug" ascii
        $code20 = "clsSetStartup" ascii
        $code21 = "frmBlack" ascii
        $code22 = "clsClass" ascii
        $code23 = "clsPacote" ascii
        $code24 = "clsSnapShot" ascii
        $code25 = "frmChave" ascii
        $code26 = "clsComm" ascii
        $code27 = "clsPcLogin" ascii
        $code28 = "clsStartScan" ascii
        $code29 = "frmFlush" ascii
        $code30 = "modGhost" ascii
        $code31 = "clsGhost" ascii
        $code32 = "GhostKernel" ascii
        $code33 = "Ghost" ascii
        $pos_path = "*\\AD:\\our\\0508\\prj\\src\\ghost\\Ghost.vbp" wide fullword
        $pos_code1 = "modPOS" ascii
        $pos_code2 = "clsAIP" ascii
        $pos_code3 = "clsTVR" ascii
        $pos_code4 = "clsCVM" ascii
        $pos_code5 = "clsTSI" ascii
        $pos_code6 = "clsTAG" ascii
        $pos_string1 = "OriginalCard" ascii
        $pos_string2 = "EMV_and_Magstripe_Modes_Supported" ascii
        $pos_string3 = "Unrecognised_CVM" ascii
        $pos_string4 = "Cardholder_verification_was_not_successful" ascii
        $pos_string5 = "Magnetic_stripe" ascii
        $pos_log = "Ja tinha hook aqui, mas agora eu sou brother do Ghost!" wide
        $exfil_string1 = "sndcablg.dat" wide
        $exfil_string2 = "sndcab.dat" wide
        $exfil_code1 = "modSendKrn" ascii
        $exfil_code2 = "prjSendKrn" ascii
        $exfil_code3 = "modSendKrn" ascii
        $exfil_code4 = "prjSendKrn" ascii
        $exfil_code5 = "3sckEnvia" ascii
        $exfil_code6 = "*.cab" wide
        $exfil_path = "@*\\AC:\\Drivers\\prj\\src\\sendkrn\\SendKrn.vbp" wide
        $dbg_path = "E*\\AC:\\Fonts\\bck\\dl\\prjLogusClient.vbp" wide
        $dbg_code1 = "modDbg" ascii
        $dbg_code2 = "loadExcept" ascii
        $dbg_code3 = "saveExcept" ascii
        $dbg_code4 = "tmrDebug" ascii
        $dbg_string1 = "StartDebug: " wide
        $dbg_string2 = "except.txt" wide
        $dbg_string3 = "hlist.txt" wide
        $dbg_string4 = "lg.txt" wide
        $rat_path1 = "*\\AD:\\our\\0508\\prj\\src\\constantine\\Client\\prjclient.vbp" wide
        $rat_path2 = "d:\\our\\0508\\prj\\bin\\Ghost" wide
        $rat_path3 = "C*\\AE:\\prj\\src\\Constantine\\Client\\Client\\prjclient.vbp" wide
        $rat_path4 = "E:\\our\\0508\\prj\\bin\\Ghost" wide
        $rat_path5 = "cmd /c del *__tmp*.dat.part" wide
        $rat_code1 = "tmrComandos" ascii
        $rat_code2 = "clsHosts" ascii
        $rat_code3 = "clsHost" ascii
        $rat_code4 = "clsProcessList" ascii
        $rat_code5 = "ReceiveComplete" ascii
        $rat_code6 = "tmrSendScreen" ascii
        $rat_code7 = "amIBoss" ascii
        $rat_code8 = "funIsConnected" ascii
        $rat_code9 = "RunOnSection" wide
        $rat_code10 = "modScreen" ascii
        $rat_code11 = "modDbg" ascii
    condition:
        (17 of ($code*)) or
        ($pos_path or (5 of ($pos_code*)) or (3 of ($pos_string*)) or $pos_log) or
        ($exfil_path or (any of ($exfil_string*)) or (4 of ($exfil_code*))) or
        ($dbg_path or (all of ($dbg_code*)) or (all of ($dbg_string*))) or
        ((any of ($rat_path*)) or (7 of ($rat_code*)))
}

rule Crowdstrike_CSA_18418_01 : brambul chollima joanap key 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Keys used in Joanap/Brambul"
        reports = "CSA-18418"
        version = "201904010900"
        last_modified = "2019-04-01"
        malware_family = "Joanap,Brambul"
    strings:
        $key = "iamsorry!@1234567"
        $entrypoint = { 55 8B EC 6A FF 68 ?? ?? ?? ?? 68 ?? ?? ?? ?? 64 A1 00 00 00 00 50 64 89 25 00 00 00 00 83 EC ?? 53 56 57 89 65 E8 33 }
    condition:
        all of them
}

rule Crowdstrike_CSA_18418_02 : chollima joanap brambul artifact 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "DLL names used in Joanap/Brambul"
        reports = "CSA-18418"
        version = "201806010814"
        last_modified = "2018-06-01"
        malware_family = "Joanap,Brambul"
    strings:
        $dll_name_smb = "SMB_Dll.dll"
        $dll_name_mon = "mondsvc.dll"
        $dll_name_mss = "mssvcdll.dll"
        $dll_name_ras = "raslgn.dll"
        $dll_name_wia = "wiaspsvc.dll"
        $dll_name_net = "Netbios_Mssql_Mysql.dll"
        $dll_name_jet = "JET3EB9.tmp"
        $dll_name_lpr = "lpmrsvc.dll"
    condition:
        any of them and filesize < 2MB
}

rule Crowdstrike_CSA_18418_03 : chollima joanap brambul artifact 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "File names used in Joanap/Brambul"
        reports = "CSA-18418"
        version = "201806010815"
        last_modified = "2018-06-01"
        malware_family = "Joanap,Brambul"
    strings:
        $mssscard = "mssscardprv.ax"
        $mssvcd = "mssvcdll.dll"
    condition:
        any of them
}

rule CrowdStrike_FlawedAmmyy : flawedammyy post_exploitation rat unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects the remote administration tool FlawedAmmyy, which is based on the leaked source code of the legitimate remote administration tool AmmyyAdmin."
        reports = "CSA-18536,CSIT-18159"
        version = "202011301559"
        last_modified = "2020-11-30"
        malware_family = "FlawedAmmyy"
    strings:
        $str1 = "Global\\Ammyy.Service.FinishEvent" wide fullword
        $str2 = "%s\\delselfandsvrremove.bat"
        $str3 = "dd'-'MM'-'yyyy"
        $f_key1 = {45B187A698407E1491C6D497BD70955AA275AAF0}
        $f_key2 = {6B2F3DA798926116A63F187B9891E0D4BC5A6382}
        $f_key3 = {5B2F1AA7987E4316A65B187B9891C0D4BC5A9573}
        $f_sig1 = {E51B6DE4}
        $f_sig2 = {4D7899BD}
        $f_seal = {89430C8B41048943108B41088943148B410C8943188B4110}
    condition:
        (2 of ($s*) and any of ($f*)) or
        ($f_seal and 2 of ($f*) and any of ($s*))
}

rule CrowdStrike_CSIT_18086_01 : vermin rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects a packed version of Vermin RAT. "
        reports = "CSIT-18086"
        version = "201806010816"
        last_modified = "2018-06-01"
        malware_family = "Vermin"
    strings:
        $1 = "MD5CryptoServiceProvider"
        $2 = "CreateDecryptor"
        $3 = "RijndaelManaged"
        $4 = "ToBase64String"
        $5 = "set_IV"
        $6 = "set_Key"
        $7 = " NtCoT"
        $8 = "Random"
        $9 = "ReleaseAllResources"
    condition:
        filesize < 1MB and all of them
}

rule CrowdStrike_CSIT_18086_02 : vermin tasking rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects a batch script used by the Vermin RAT to delete itself."
        reports = "CSIT-18086"
        version = "201806010816"
        last_modified = "2018-06-01"
        malware_family = "Vermin"
    strings:
        $ = "@echo off{0}:dele{0}del \"{1}\"{0}if Exist \"{1}\" GOTO dele{0}del %0" wide
        $ = "{0}.bat" wide fullword
    condition:
        all of them
}

rule CrowdStrike_CSIT_18086_03 : vermin rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects strings found in the Vermin RAT."
        reports = "CSIT-18086"
        version = "201806010816"
        last_modified = "2018-06-01"
        malware_family = "Vermin"
    strings:
        $1 = "StartCaptureScreen"
        $2 = "StopCaptureScreen"
        $3 = "ArchiveAndSplit"
        $4 = "RunKeyLogger"
        $5 = "SetMicVolume"
        $6 = "StartAudioCapture"
        $7 = "StopAudioCapture"
        $8 = "ShellExec" fullword
        $9 = "UpdateBot"
        $10 = "UploadFile"
        $11 = "DownloadFile"
        $12 = "ReadDirectory"
    condition:
        uint16(0) == 0x5a4d and 4 of them
}

rule CrowdStrike_CSIT_18086_04 : vermin rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects strings used by Vermin RAT to impersonate Adobe software."
        reports = "CSIT-18086"
        version = "201806010817"
        last_modified = "2018-06-01"
        malware_family = "Vermin"
    strings:
        $ = "Adobe Frontend Print"
        $ = "Adobe Inc., 20"
        $ = "AdobeSLService"
        $ = "AdobePrintFr"
        $ = "AdobePrintLib"
    condition:
        any of them
}

rule CrowdStrike_CSIT_18086_05 : vermin rat tasking keylogger 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects the keylogging component of Vermin RAT."
        reports = "CSIT-18086"
        version = "201806010817"
        last_modified = "2018-06-01"
        malware_family = "Vermin"
    strings:
        $1 = "InterceptKeys"
        $2 = "LowLevelKeyboardHookProc"
        $3 = "ClipboardCallbackCheck"
        $4 = "[{0:HH:mm:ss}][{1}][{2} ]]" wide
        $5 = "prevClipboardContent"
    condition:
        3 of them
}

rule CrowdStrike_CSIT_18086_06 : vermin rat keylogger tasking 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects the keylogger component used by Vermin RAT."
        reports = "CSIT-18086"
        version = "201806010817"
        last_modified = "2018-06-01"
        malware_family = "Vermin"
    strings:
        $ = "Projects\\Vermin\\"
        $ = "Development\\Vermin\\"
        $ = "HtkSvcUtility.pdb"
        $ = "CenterServiceLib.pdb"
        $ = "VerminClientLib"
    condition:
        any of them
}

rule CrowdStrike_CSIT_18086_07 : vermin rat tasking credential_dumper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects the password dumping component of Vermin RAT."
        reports = "CSIT-18086"
        version = "201806010817"
        last_modified = "2018-06-01"
        malware_family = "Vermin"
    strings:
        $ = "loot.dat" wide fullword
        $ = "PwdFetcher.pdb"
    condition:
        any of them
}

rule CrowdStrike_CSIT_18086_08 : vermin rat tasking credential_dumper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects the password dumping component of Vermin RAT."
        reports = "CSIT-18086"
        version = "201806010817"
        last_modified = "2018-06-01"
        malware_family = "Vermin"
    strings:
        $ = "UsbSafeGuard"
        $ = "WqlEventQuery"
    condition:
        all of them
}

rule CrowdStrike_CSIT_18086_09 : vermin rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects strings used in the Vermin RAT cryptography library."
        reports = "CSIT-18086"
        version = "201806010817"
        last_modified = "2018-06-01"
        malware_family = "Vermin"
    strings:
        $g1 = "LicenseProtector"
        $g2 = "BruteForceKey"
        $g3 = "GenerateKey"
        $k1 = "^$f56"
        $k2 = "KJGJH&"
        $k3 = "4jHFZ"
    condition:
        all of ($k*) or all of ($g*)
}

rule CrowdStrike_CSIT_18087_01 : arsvbsloader downloader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects plugins for the ARS VBS Loader."
        reports = "CSIT-18087"
        version = "201806010841"
        last_modified = "2018-06-01"
        malware_family = "ARS VBS Loader"
        in_the_wild = true
    strings:
        $s1 = "[ARS PLUGIN]" wide
        $s2 = "Mozilla/5.0 (Windows NT 6.1; WOW64; rv:12.0) Gecko/20100101 Firefox/12.0" wide
    condition:
        all of them
}

rule CrowdStrike_CSIT_18087_02 : arsvbsloader downloader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects the ARS VBS loader."
        reports = "CSIT-18087"
        version = "201806010841"
        last_modified = "2018-06-01"
        malware_family = "ARS VBS Loader"
    strings:
        $1 = "Oh, its main cycle! CMD response"
        $2 = "Download command gotted!"
        $3 = "Update command gotted!"
        $4 = "Unistall command gotted!"
        $5 = "Fuck! Panel maybe die! I will try to change it"
        $6 = "sGetOS()"
        $7 = "sGetUserPC()"
        $8 = "sGetRAM()"
        $9 = "GetCPU()"
        $10 = "GetGPU()"
    condition:
        5 of them
}

rule CrowdStrike_CSA_18421_01 : chollima kimsuky milmanbag rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule matches on strings commonly found in the Milmanbag RAT, including the May 2018 variant."
        reports = "CSA-18421"
        version = "201806010835"
        last_modified = "2018-06-01"
        malware_family = "Milmanbag"
    strings:
        $ = "CmdExe : cmd = %s, args = %s" ascii
        $ = "PrecomExe : returned from Preproc" ascii
        $ = "CmdExe : ShellExecuteEx error %d" ascii
        $ = "Preproc : fExeIsIexplore = %d" ascii
        $ = "Preproc : Exe=%s, Module=%s" ascii
        $ = "Preproc : CopyFileExA %s" ascii
        $ = "PrecomExe : WinMain" ascii
        $ = "Preproc : %s SetupToRun ok" ascii
        $ = "PrecomProc : IE Mapping Ok!" ascii
        $ = "PreCommProc : g_wDownControlOption(%d)" ascii
        $ = "PrecomProc : First ShellExecute Ok!" ascii
        $ = "Referer: https://nid.naver.com/nidlogin.login?url=http%3A%2F%2Fmail.naver.com%2F" ascii
    condition:
        9 of them and filesize < 600KB
}

rule CrowdStrike_CSIT_19027_03 : banking gozi isfb trojan unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects the main client DLL for ISFB/Gozi/Ursnif"
        reports = "CSIT-19027"
        version = "201902221124"
        last_modified = "2019-02-22"
        malware_family = "ISFB,Gozi"
    strings:
        $bss1 = ".bss"
        $bss2 = { 8d 7d ?? ab 66 ab 6a 08 aa 68 [4] 8d ?? ?? 5? }
        $bss3 = { 8d 7d ?? a5 a5 a5 8b ?? ?? 33 }
        $bss4 = { 83 c7 01 49 83 c2 04 33 c3 8b f1 8b cf d3 c8 }
        $s1 = "|$$$}rstuvwxyz{$$$$$$$>?@ABCDEFGHIJKLMNOPQRSTUVW$$$$$$XYZ[\\]^_`abcdefghijklmnopq"
        $s2 = "loader.dll"
        $pubkey_crc = { 64 5e 28 e1 }
        $ini_crc1 = { cb af 22 d7 } //CRC client ini 1
        $ini_crc2 = { 57 b9 65 83 } //CRC client ini 2
        $ini_crc3 = { e1 dd b1 8f } //CRC client ini 3
    condition:
        2 of ($bss*) and
        1 of ($s*) and
        $pubkey_crc and
        1 of ($ini_crc*)
}

rule CrowdStrike_RemCos_01 : rat remcos 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects the commodity RAT RemCos which is sometimes used by criminal actors."
        version = "201910252020"
        last_modified = "2019-10-25"
        malware_family = "RemCos"
    strings:
        $rc0 = "Remcos_Mutex_Inj"
        $rc1a = " * REMCOS v"
        $rc1b = " * Remcos v"
        $rc2a = " * Breaking-Security.Net"
        $rc2b = " * BreakingSecurity.Net"
        $fmt1 = "%02i:%02i:%02i:%03i [INFO]"
        $fmt2 = "%02i:%02i:%02i:%03i [KeepAlive]"
        $fmt3 = "%02i:%02i:%02i:%03i [WARNING]"
        $fmt4 = "KeepAlive Enabled! Timeout: %i seconds"
        $fmt5 = "%04i/%02i/%02i %02i:%02i:%02i"
        $log01 = "[Following text has been copied to clipboard:]"
        $log02 = "[End of clipboard text]"
        $log03 = "[Chrome StoredLogins found, cleared!]"
        $log04 = "[Chrome StoredLogins not found]"
        $log05 = "[Chrome Cookies found, cleared!]"
        $log06 = "[Chrome Cookies not found]"
        $log07 = "[Firefox StoredLogins cleared!]"
        $log08 = "[Firefox StoredLogins not found]"
        $log09 = "[Firefox cookies found, cleared!]"
        $log10 = "[Firefox Cookies not found]"
        $log11 = "[IE cookies cleared!]"
        $log12 = "[IE cookies not found]"
        $log13 = "[Cleared all cookies & stored logins!]"
    condition:
        2 of ($rc*) and 2 of ($fmt*) and 8 of ($log*)
}

rule CrowdStrike_BERSERK_BEAR_Listrix : berserk_bear listrix reconnaissance tasking 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects a simple reconnaissance tool which creates a logfile of all files matching a certain list of file masks and stores this log in a hardcoded location."
        version = "201806151548"
        last_modified = "2018-06-15"
        actor = "BERSERK BEAR"
        malware_family = "Listrix"
    strings:
        $p1 = "%s%s\x09%02d.%02d.%04d %02d:%02d\x0d\x0a" wide fullword
        $p2 = "%s%s\x09%d\x09%02d.%02d.%04d %02d:%02d\x0d\x0a" wide fullword
    condition:
        all of them
}

rule CrowdStrike_DarkVNC_01 : credential_theft darkvnc remote_shell 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects a malicious version of VNC used as a remote shell."
        version = "201903151051"
        last_modified = "2019-03-15"
        malware_family = "DarkVNC"
    strings:
        $ = "(%S)_%08x-DARKVNC"
        $ = "{%08X-%04X-%04X-%04X-%08X%04X}"
        $ = "VncStartServer"
        $ = "VncStopServer"
    condition:
        all of them
}

rule CrowdStrike_VenomousBear_Keylogger : keylogger venomous_bear 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects keylogger associated with VENOMOUS BEAR"
        reports = "CSA-18492"
        version = "202002211637"
        last_modified = "2020-02-21"
        actor = "VENOMOUS BEAR"
    strings:
        // x64 version
        $ = {
        09 00 00 33 c0 66 89 84 24 b0 02 00 00 48 8d bc
        24 b2 02 00 00 33 c0 b9 06 02 00 00 f3 aa 33 c0
        66 89 84 24 d0 04 00 00 48 8d bc 24 d2 04 00 00
        33 c0 b9 06 02 00 00 f3 aa 33 c0 66 89 84 24 e0
        06 00 00 48 8d bc 24 e2 06 00 00 33 c0 b9 06 02
        00 00 f3 aa 41 b8 08 02 00 00 48 8d 94 24 b0 02
        00 00 48 8b 0d
        }
        // x86 version
        $ = {
        1f 85 eb 51 f7 e3 c1 ea  05 6b d2 64 8b c3 2b c2
        0f be 90
        }
    condition:
        any of them
}

rule CrowdStrike_VenomousBear_Keylogger_Dropper : dropper keylogger venomous_bear 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects dropper used to deploy a keylogger associated with VENOMOUS BEAR"
        reports = "CSA-18492"
        version = "201908131605"
        last_modified = "2019-08-13"
        actor = "VENOMOUS BEAR"
    strings:
        $ = { 81 00 00 10 00 00 }
        $ = { 3d 20 05 93 19 74 15 3d 21 05 93 19 74 0e 3d 22 05 93 19 74 07 3d 00 40 99 01 75 }
        $ = { 00 00 00 01 00 02 00 6c 4d 4d 33 32 2e 64 6c 6c 00 }
    condition:
        all of them
}

rule CrowdStrike_WMAMiner_Dropper_01 : dropper mineware wmaminer 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects the dropper for the WMAMiner mineware."
        version = "201903151051"
        last_modified = "2019-03-15"
        malware_family = "WMAMiner"
    strings:
        $svc1 = "/create /TN \"\\Microsoft\\Windows\\UPnP\\%s\" /RU SYSTEM /TR \"rundll32 %s,ServiceCrtMain\" /SC ONSTART"
        $svc2 = "/create /TN \"\\Microsoft\\Windows\\UPnP\\%s\" /RU SYSTEM /TR \"regsvr32 /s /u %s\" /SC ONSTART"
        $svc3 = "/run  /TN \"\\Microsoft\\Windows\\UPnP\\%s\""
        $p1 = "%s\\EnrollCertXaml.dll"
        $p2 = "%s\\wmassrv.dll"
        $p3 = "%s\\WMASTrace.ini"
        $dscr = "Services (WMAS) gement services Windows Modules les Activations  and health manafor message-activated applicatioUPnPHostServicesprovides modules activation, resource managementThe Windows ModuActivations Serv"
    condition:
        $dscr or (2 of ($svc*) and 2 of ($p*))
}

rule CrowdStrike_WMAMiner_EternalBlue_Payload_01 : mineware wmaminer 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects the EternalBlue exploit payload DLL used by the WMAMiner mineware to spread."
        version = "201903151051"
        last_modified = "2019-03-15"
        malware_family = "WMAMiner"
    strings:
        $log1 = "[CLR] %s"
        $log2 = "[CLR] Accept"
        $log3 = "[CLR] Done"
        $log4 = "[CLR] Exit"
        $log5 = "[CLR] Listen %d"
        $log6 = "[CLR] RecvPck"
        $log7 = "[CLR] SrvInstall"
        $log8 = "[CLR] SrvRelease"
        $log9 = "[CLR] TaskInstall"
    condition:
        4 of ($log*)
}

rule CrowdStrike_WMAMiner_MainModule_01 : mineware wmaminer 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects the main component of the WMAMiner mineware."
        version = "201903151051"
        last_modified = "2019-03-15"
        malware_family = "WMAMiner"
    strings:
        $f1 = "/testing.php?mac=%s&ip=%s&host=%s&tick=%d&os=%s&cpu=%d&%s"
        $f2 = " /s /n /u /i:\"http://%s/found.php?mac=%s&ip=%s&host=%s&tick=%d&os=%s&cpu=%d&%s\" scrobj.dll"
        $v1 = "gpu=%ws*%d"
        $v2 = "SELECT * FROM Win32_VideoController"
    condition:
        any of ($f*) and any of ($v*)
}

rule CrowdStrike_WMAMiner_EternalBlue_Loader_01 : loader mineware wmaminer 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects the EternalBlue loader used by the WMAMiner mineware to spread."
        version = "201903151051"
        last_modified = "2019-03-15"
        malware_family = "WMAMiner"
    strings:
        $log1 = "[INF] Read file1 %d."
        $log2 = "[INF] Read file2 %d."
        $log3 = "[INF] Failed to start stage2 %d."
        $log4 = "[VICTOR] %s"
        $log5 = "[+] Ping returned Target architecture: x86 (32-bit)"
        $log6 = "[+] Ping returned Target architecture: x64 (64-bit)"
    condition:
        4 of them
}

rule CrowdStrike_CSIT_18111_01 : loader stone_panda stoneloader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Custom loader for ChChes and related payloads"
        reports = "CSIR-18014,CSIT-18111"
        version = "201810251036"
        last_modified = "2018-10-25"
        actor = "STONE PANDA"
        malware_family = "StoneLoader, ChChes, PlugX, PoisonIvy"
    strings:
        /*
        lea     edx, [esi+edi]
        mov     edi, [ebp+keyObj]
        mov     cl, [ecx+edx]
        xor     cl, [eax+edi]
        inc     eax
        mov     edi, [ebp+argPtrToAllocMem]
        mov     [edx], cl
        mov     ecx, [ebp+argPtrStartData]
        cmp     eax, ebx
        jb      short loc_401916
        */
        $xor1 = { 8d 14 3e 8b ?? ?? 8a 0c 11 32 0c 38 40 8b ?? ??
        88 0a 8b ?? ?? 3b c3 72 e7 }
        /*
        lea     ecx, [edi+ebx]
        mov     ebx, [ebp+var_8]
        mov     al, [eax+ecx]
        xor     al, [esi+ebx]
        inc     esi
        mov     ebx, [ebp+arg_8]
        mov     [ecx], al
        mov     eax, [ebp+arg_0]
        cmp     esi, edx
        jb      short loc_401CBA
        */
        $xor2 = { 8d 0c 1f 8b ?? ?? 8a 04 08 32 04 1e 46 8b ?? ??
        88 01 8b ?? ?? 3b f2 72 e7 }
    condition:
        any of them
}

rule CrowdStrike_CSIT_18111_02 : chches rat stone_panda 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "ChChes shellcode main payload"
        reports = "CSIR-18014,CSIT-18111"
        version = "201810250941"
        last_modified = "2018-10-25"
        actor = "STONE PANDA"
        malware_family = "ChChes"
    strings:
        $cookie = { 43 6f 6f 6b ?? ?? ?? 69 65 3a 00 }
        $req = { 47 45 54 00 ?? ?? ?? ?? 00 48 45 41 }
        $k32 = { 6c 33 32 2e ?? ?? ?? 64 6c 6c 00 }
        $sleep = { 81 7d fc 60 ea 00 00 0f 9d c1 49 81 e1 b0 3c ff ff 81 c1 60 ea 00 00 }
        $proxy = { 22 00 6e 00 ?? ?? ?? 65 00 74 00 ?? ?? ?? 77 00 6f 00 ?? ?? ?? 72 00 6b 00 }
    condition:
        3 of them
}

rule CrowdStrike_Prowli_r2r2_worm : prowli r2r2 worm 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects the r2r2 worm component of the Prowli botnet."
        version = "201902071803"
        last_modified = "2019-02-07"
    strings:
        $ = "main._2POST"
        $ = "main._send_good"
        $ = "main._ssh_brute_runcommand"
        $ = "main._ssh_brute_twobyone"
        $ = "main._prowl"
        $ = "main._n_prowli"
        $ = "main._good_count"
    condition:
        5 of them
}

rule CrowdStrike_CSIT_19133_01 : danabot trojan 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects Danabot banking trojan"
        reports = "CSA-19522,CSIT-19133"
        version = "202010222235"
        last_modified = "2020-10-22"
        malware_family = "Danabot"
    strings:
        $func1 = { ba fa 41 d5 00 a1 [3] 00 e8 [4] a3 [3] 00 }
        $func2 = { 83 3d [3] 00 00 75 ?? ba 6d 4e bc 00 a1 [3] 00 e8 [4] a3 [3] 00 }
        $func3 = { 83 3d [3] 00 00 75 ?? ba 34 d0 8e 00 a1 [4] e8 [4] a3 [3] 00 }
        $func4 = { 83 3d [3] 00 00 75 ?? ba fc 79 33 00 a1 [4] e8 [4] a3 [3] 00 }
        $func5 = { 83 3d [3] 00 00 75 ?? ba 8a 57 51 00 a1 [4] e8 [4] a3 [3] 00 }
        $rsa_key_decode = { 8b 45 fc 80 b0 ?? ?? ?? 00 ?? ff 45 fc 81 7d fc 94 00 00 00 75 ea }
        $rsa_key_decode2 = { 8b 45 f8 80 b0 ?? ?? ?? 00 ?? ff 45 f8 81 7d f8 94 00 00 00 75 ea }
        $rsa_key_decoded = { 06 02 00 00 00 a4 00 00 52 53 41 31 00 04 00 00 01 00 01 00 21 1e ec 63 52 a7 7d 48 f0 68 7a b2 5a d9 9d 67 84 ec ff eb e0 cb 59 c3 33 bc 5c e5 ce 3f db df bf c2 d7 d3 ca 7e 7f 1f 90 9b 43 88 ba 46 9f 2d ec 07 23 28 74 47 ba 41 0d 09 46 56 f2 76 97 62 46 c0 90 2b 0b 85 e0 12 8f d3 2f 10 2d 7a e1 08 36 67 ba e2 a4 d6 b5 f8 50 45 da f6 30 13 1c 63 a1 cc a5 0e 2b b6 e9 b2 b8 44 05 a0 33 36 56 a0 39 7a 68 da df ef 24 29 f1 ed ca 7c b5 2e 0d bd }
        $rsa_key_decoded2 = { 06 02 00 00 00 a4 00 00 52 53 41 31 00 04 00 00 01 00 01 00 db de 21 1c d9 3b 92 e8 3b c6 7b 0f c9 35 75 6a 53 90 5b c8 ec 8b f5 85 20 67 93 bf 55 09 53 8d f5 0b 49 3d ec d2 1d cc df d6 24 7b 6c 9d cb 19 ea 3e 13 a2 13 5d f7 91 5f d5 8b e8 5a 98 79 d4 18 a7 25 f7 57 a8 1f 83 dc 3e 54 00 76 3c bb a6 f2 0a 8b 2d b3 c6 22 b9 c0 38 40 a5 4c b0 fa 2b 47 25 50 c8 84 7a 3c 2b 6a e4 27 50 97 56 4e 32 ae e8 a4 a5 75 02 9e e2 3f 0d e4 5c 9a 8d 26 b2 }
    condition:
        (all of ($func*)) or (any of ($rsa_key_*))
}

rule CrowdStrike_CSA_18487_01 : artifact certificate 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Serial number identifier of a certificate used to sign malicious executables"
        reports = "CSA-18487"
        version = "201910140927"
        last_modified = "2019-10-14"
    strings:
        $cn = "SET&CO LIMITED"
        $serial = { 47 7c b5 c6 c3 6d 3a f7 43 a1 6d cc 74 38 3b d8 }
    condition:
        uint16(0) == 0x5a4d and
        ($cn and $serial)
}

rule CrowdStrike_CSA_18487_02 : artifact certificate 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Serial number identifier of a certificate used to sign malicious executables"
        reports = "CSA-18487"
        version = "201910140934"
        last_modified = "2019-10-14"
    strings:
        $cn = "YUVA-TRAVEL"
        $serial = { b1 6e 22 f8 3c 69 e8 c6 81 1e f6 71 0e bc af 18 }
    condition:
        uint16(0) == 0x5a4d and
        ($cn and $serial)
}

rule CrowdStrike_CSA_18487_04 : shellcode metasploit 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule looks for Metasploit shellcode encrypted with a single byte xor key of 0xFF."
        reports = "CSA-18487"
        version = "201806291354"
        last_modified = "2018-06-29"
    strings:
        $ = {
        e8 ?? 00 00 00 8d 92 fb ?? 00 00 8d 1a bf ?? ??
        00 00 8b 02 83 f0 ff 89 02 83 c2 04 4f 75 f3 ff
        d3
        }
    condition:
        all of them
}

rule CrowdStrike_CSA_18487_03 : delivery_document macro 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Macro document with payload disguised as a fake certificate"
        reports = "CSA-18487"
        version = "201903061156"
        last_modified = "2019-03-06"
    strings:
        $ = "TVqQAA" ascii wide
        $ = "-----BEGIN CERTIFICATE-----" ascii wide
        $ = "-----END CERTIFICATE-----" ascii wide
        $ = "AutoOpen"
        $ = { d0 cf 11 e0 a1 b1 1a e1 00 00 00 00 00 00 00 00 }
    condition:
        all of them
}

rule CrowdStrike_SoS_Shellcode_Downloader : downloader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects a downloader which was used to deliver malware to a company in the technology industry"
        version = "201806291356"
        last_modified = "2018-06-29"
    strings:
        $hardcode_c2_content = { C7 43 04 92 5A 76 5D }
        $checksummer = { 74 0? C1 CF 0D 03 F8 EB F? }
        $push_send = { 68 A4 19 70 E9 }
        $push_socket = { 68 6E 0B 2F 49 }
        $push_recv = { 68 51 FF 2D 95 }
        $push_connect = { 68 EC F9 AA 60 }
    condition:
        $hardcode_c2_content or ($checksummer and 2 of ($push_*))
}

rule CrowdStrike_CSIT_18101_01 : lena loader rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Matches loaders used to deploy Lena malware"
        reports = "CSIT-18101"
        version = "201806291315"
        last_modified = "2018-06-29"
        malware_family = "Lena"
    strings:
        // Check values noted in samples
        $code_loader_checksum_1 = { 33 d2 8b f7 f7 f6 8b f2 8d 04 31 33 d2 8b cf f7 f1 }
        $data_loader_checkval_1 = { 8c ab 1b 7d }
        // XOR routine found in decoding
        $data_loader_checkval_2 = { cc 2b 0a 6e }
        // Alternate XOR code
        $code_xorfrag_1 = { 8a 10 30 11 40 41 4e 75 f7 }
        // Alternate checksum code
        $code_va_10001716 = { 8a 14 03 30 10 40 4f 75 f7 }
        $code_va_10001807 = { 8d 04 37 33 d2 bf f1 ff 00 00 f7 f7 0f b6 81 ?? ?? ?? ?? 03 c6 be f1 ff 00 00 }
    condition:
        filesize < 300KB and
        2 of them
}

rule CrowdStrike_CSIT_18101_02 : lena loader rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Matches Lena malware payload"
        reports = "CSIT-18101"
        version = "201806291314"
        last_modified = "2018-06-29"
        malware_family = "Lena"
    strings:
        $str_blowfish_key = "this is the encrypt key" fullword
        $str_dllname = "lena_http_dll.dll" fullword
        $str_export = "crt_main" fullword
        $str_err_noexist = "The file does not exist on this server!"
        $str_delim_base = "---------------------------7d" fullword
        $str_err_checksum = "Failed. The file checksum does not match!"
        // xxhash code fragment
        /* Code from starting VA 1000b631:
        mov     ecx, [esi+18h]
        mov     edx, [esi+8]
        imul    ecx, 7A143589h
        sub     edx, ecx
        add     esp, 0Ch
        rol     edx, 0Dh
        imul    edx, 9E3779B1h
        mov     [esi+8], edx
        mov     ecx, [esi+1Ch]
        mov     edx, [esi+0Ch]
        imul    ecx, 7A143589h
        sub     edx, ecx
        rol     edx, 0Dh
        imul    edx, 9E3779B1h
        */
        $code_va_1000B631 = { 8b 4e 18 8b 56 08 69 c9 89 35 14 7a 2b d1 83 c4 0c c1 c2 0d 69 d2 b1 79 37 9e 89 56 08 8b 4e 1c 8b 56 0c 69 c9 89 35 14 7a 2b d1 c1 c2 0d 69 d2 b1 79 37 9e }
        // Blowfish code fragment
        /* Code from starting VA 1000a1fb:
        or      ebx, edi
        mov     edi, [ebp+arg_0]
        movzx   edi, byte ptr [edi+7]
        shl     ebx, 8
        or      ebx, edi
        mov     edi, [ebp+var_4]
        xor     edx, ebx
        mov     [ebp+arg_0], edi
        mov     edi, [eax+4]
        xor     edi, edx
        mov     edx, edi
        shr     edx, 10h
        and     edx, ecx
        */
        $code_va_1000A1FB = { 0b df 8b 7d 08 0f b6 7f 07 c1 e3 08 0b df 8b 7d fc 33 d3 89 7d 08 8b 78 04 33 fa 8b d7 c1 ea 10 23 d1 }
    condition:
        filesize < 2MB and
        3 of them
}

rule CrowdStrike_CSIT_18098_01 : carbon_spider bateleur javascript script 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects CARBON SPIDER's Bateleur Javascript payload."
        reports = "CSIT-18098"
        version = "201806291314"
        last_modified = "2018-06-29"
        actor = "CARBON SPIDER"
        malware = "Bateleur"
    strings:
        $url = "https://\" + panel_link"
        $post = "page_time=\" + knock_timeout"
        $tiny = "case 'tinymet':"
        $pass = "Password not found or error grabbing"
    condition:
        any of them
}

rule CrowdStrike_ThreadKit_Exploit_Document_CVE_2018_8174 : threatkit exploit cve_2018_8174 delivery_document 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "ThreadKit Exploit Document for CVE-2018-8174"
        reports = "CSA-18497"
        version = "201806291316"
        last_modified = "2018-06-29"
    strings:
        $ = "68005400740050003a002f002f00"
        $ = "e 0c9 ea79f9bace118c82 00a a004b"
    condition:
        all of them
}

rule CrowdStrike_PythiaDropper : dropper pythiadropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Provides detection for the PythiaDropper malware which is a dropper for other (mostly commodity) malware."
        version = "201903151051"
        last_modified = "2019-03-15"
        malware_family = "PythiaDropper"
    strings:
        $form_caption = {
        01 07
        43 61 70 74 69 6F 6E 06 1E 6C
        6B 49 78 35 77 56 6A 51 64 31
        4C 53 37 34 38 73 72 6F 33 53
        49 4D 6E 44 49 79 6A 6D 6E }
        // likely unique Delphi form caption string from
        // resource: lkIx5wVjQd1LS748sro3SIMnDIyjmn
    condition:
        all of them
}

rule CrowdStrike_SysBin_DLL_Sideloader_01 : emissary_panda loader sideloading 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects a DLL taking advantage of DLL search order hijacking to load a malicious payload. CrowdStrike has observed this tool to be in use by EMISSARY PANDA. However, it is not likely to be in exclusive use by them."
        version = "201911121901"
        last_modified = "2019-11-12"
        actor = "EMISSARY PANDA"
    strings:
        $ = { 56 57 b9 ?? ?? ?? ?? be ?? ?? ?? ?? 6a 0c 2b c8 2b f0 5f 8a 10 30 14 01 8a 10 30 14 06 40 4f }
    condition:
        all of them
}

rule CrowdStrike_CSIT_18106_01 : saturn ransomware 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects plaintext strings in unpacked samples of Saturn ransomware."
        reports = "CSIT-18106"
        version = "201808061354"
        last_modified = "2018-08-06"
        malware_family = "SaturnRansomware"
    strings:
        $ = "saturn"
        $ = "S A T U R N"
        $ = ".onion"
        $ = "#DECRYPT_MY_FILES#"
        $ = "PUBLIC KEY"
        $ = "ISVOLUMESHADOWS"
        $ = "YESVOLUMESHADOW"
        $ = "vssadmin.exe delete shadows"
    condition:
        6 of them
}

rule CrowdStrike_CSIT_18103_01 : silent_chollima tdrop rat linux unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects the Linux variant of the TDrop RAT deployed by SILENT CHOLLIMA"
        reports = "CSIT-18103"
        version = "201807060937"
        last_modified = "2018-07-06"
        actor = "SILENT CHOLLIMA"
        malware_family = "TDrop"
    strings:
        $elf = { 7f 45 4c 46 }
        $tmp = "/tmp/root-tmp.f36c90/"
        $up_fail = "%s   %dK   upload fail"
        $up_succ = "%s   %dK   upload success"
        $fs = "[ %d.%d.%d  %d:%d:%d  ]"
    condition:
        $elf at 0 and 2 of ($tmp, $up*, $fs) and
        filesize < 100KB
}

rule CrowdStrike_CSIT_18143_04 : fancy_bear zekapab minizekapab rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Identifies hex-encoded strings observed in samples of MiniZekapab"
        reports = "CSIT-18143"
        version = "201810050839"
        last_modified = "2018-10-05"
        actor = "FANCY BEAR"
        malware_family = "MiniZekapab,Zekapab"
    strings:
        $ = "436C65616E6572557064" // CleanerUpd
        $ = "57686572652077617320616E206572726F72206F70656E696E672E205468652066696C652069732064616D6167656420616E64" // Where was an error opening. The file is damaged and
        $ = "636F756C64206E6F742062652072657061697265642E" // could not be repaired.
    condition:
        2 of them
}

rule CrowdStrike_CSIT_18114_02 : builder macro rubella 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects documents with artifacts of the Rubella malicious document builder."
        reports = "CSIT-18114"
        version = "202002191931"
        last_modified = "2020-02-19"
        malware = "Rubella Malicious Document Builder"
    strings:
        //End Function
        //AutoOpen()
        $entry1 = {456E642046756E6374696F6E0D0A537562204175746F4F70656E28290D0A}
        //End Function
        //AutoClose()
        $entry2 = {456E642046756E6374696F6E0D0A537562204175746F4F70436c6f73650D0A}
        $str1 = "Sub RemovePicture()"
        $str2 = "Sub LoadText("
        $str3 = "Sub InsertURLGraphic("
        $str4 = "If Len(Application.UserName) < "
        $str5 = "If Application.UserName = \""
        $str6 = /Dim\s[A-Z]+\sAs\sByte:/
        $str7 = /ActiveDocument\.CustomDocumentProperties\([A-Za-z]{1}/
        $str8 = "+ CInt(Chr(Tan(CDbl("
    condition:
        1 of ($entry*) and 4 of ($str*)
}

rule CrowdStrike_MBRKiller_Installer : mbrkiller wiper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detection for modified NSIS Installers observed delivering MBRKiller"
        version = "201807060936"
        last_modified = "2018-07-06"
        malware_family = "MBR Killer"
    strings:
        $ = {
        04 00 00 00 ef be ad de 4e 75 6c 6c 73 6f 66 74
        49 6e 73 85 22 ed 00 00 58 27 00 00 31 00 57 41
        }
    condition:
        all of them
}

rule CrowdStrike_VOODOO_BEAR_PassKillDisk : passkilldisk voodoo_bear wiper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Generic detection of PassKillDisk variants"
        reports = "CSIT-17141"
        version = "201903061159"
        last_modified = "2019-03-06"
        actor = "VOODOO BEAR"
        malware_family = "PassKillDisk, KillDisk"
    strings:
        // Characteristic code pattern
        $ = { 51 8b c3 8d 50 02 66 8b 08 83 c0 02 66 85 c9 75 f5 2b c2 d1 f8 89 04 24 75 04 32 c0 59 c3 83 7f 1c 00 56 75 }
    condition:
        all of them
}

rule CrowdStrike_CSIT_18105_01 : artifact quasarrat rat sobaken 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "PDB strings observed in specific QuasarRAT samples associated with the Sobaken campaign"
        reports = "CSIT-18105"
        version = "201904170852"
        last_modified = "2019-04-17"
        malware_family = "quasarrat"
    strings:
        $1 = "BarabakenSOB"
        $2 = "\\baybak"
        $3 = "SobakenRevenge"
        $4 = "BarabakenClient"
        $a = "N:\\shtorm\\"
        $b = "N:\\projects\\Viral\\"
        $c = "E:\\projects\\BitsAdmin"
    condition:
        uint16(0) == 0x5a4d and
        any of them and
        filesize < 5MB
}

rule CrowdStrike_CSIT_18105_02 : quasarrat rat sobaken 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Sobaken campaign QuasarRAT namespaces"
        reports = "CSIT-18105"
        version = "201904180846"
        last_modified = "2019-04-18"
        malware_family = "quasarrat"
    strings:
        $a1 = "Winston.Core.Packets"
        $a2 = "Dooglee.Core.Packets"
        $a3 = "Bumucha.Core.Packets"
        $packets = "Core.Packets"
        $c1 = "MailClient"
        $c2 = "baza.exe"
    condition:
        uint16(0) == 0x5a4d and
        any of ($a*) or ($packets and any of ($c*)) and
        filesize < 3MB
}

rule CrowdStrike_CSIT_18105_03 : quasarrat rat sobaken 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "QuasarRAT igfxNN.exe used in Sobaken campaign"
        reports = "CSIT-18105"
        version = "201904180846"
        last_modified = "2019-04-18"
        malware_family = "quasarrat"
    strings:
        $core = "Core.Packets"
        $c3 = "igfx"
    condition:
        uint16(0) == 0x5a4d and
        all of them and
        filesize < 5MB
}

rule CrowdStrike_CSIT_18105_04 : quasarrat rat sobaken 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Stego component used in Sobaken campaign"
        reports = "CSIT-18105"
        version = "201904180846"
        last_modified = "2019-04-18"
        malware_family = "quasarrat"
    strings:
        $1 = "PhpBbCryptoServiceProvider"
        $2 = "Jpgdcdr"
    condition:
        uint16(0) == 0x5a4d and
        any of them and
        filesize < 1MB
}

rule CrowdStrike_CSIT_18112_01 : delivery_document macro 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects strings from the VBS macro indicating use of the certutil tool and CAB file unpacking, which may be used to distribute malware."
        reports = "CSIT-18112"
        version = "201904231352"
        last_modified = "2019-04-23"
    strings:
        $1 = "expand"
        $2 = "cmd.exe /c certutil -decode"
        $3 = "ActiveDocument"
    condition:
        all of them
}

rule CrowdStrike_CSIT_18112_02 : delivery_document downloader macro 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects use of bitsadmin, certutil and expand tools to acquire and deploy payload"
        reports = "CSIT-18112"
        version = "201904231352"
        last_modified = "2019-04-23"
    strings:
        $1 = "cmd.exe /c bitsadmin"
        $2 = "certutil -decode"
        $3 = "expand"
    condition:
        all of them
}

// WARNING: This rule will only work with YARA 3
import "pe"

rule CrowdStrike_CSIT_18112_03 : rat redleaves stone_panda 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects packed RedLeaves samples "
        reports = "CSIR-18014,CSIT-18112"
        version = "201810251020"
        last_modified = "2018-10-25"
        actor = "STONE PANDA"
        malware_family = "RedLeaves"
    strings:
        $1 = "POWRPROF.dll"
        $2 = "WINHTTP.dll"
        $3 = "WTSAPI32.dll"
        $4 = "CRYPT32.dll"
    condition:
        uint16(0) == 0x5a4d
        and filesize<1MB
        and pe.sections[0].name == ".text"
        and pe.sections[1].name == ".rdata"
        and pe.sections[2].name == ".data"
        and pe.sections[5].name == ".reloc"
        and pe.sections[6].name == ".rsrc"
        and all of them
}

rule CrowdStrike_CSIT_18112_04 : artifact rat redleaves stone_panda 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects unique RedLeaves strings relating to browser information gathering or HTTP comms"
        reports = "CSIR-18014,CSIT-18112"
        version = "201810251021"
        last_modified = "2018-10-25"
        actor = "STONE PANDA"
        malware_family = "RedLeaves"
    strings:
        $useragent = "Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.1; WOW64; Trident/4.0; SLCC2; .NET CLR 2.0.50727; .NET CLR 3.5.30729; .NET CLR 3.0.30729; .NET4.0C; .NET4.0E)" wide ascii
        $a1 = "select hostname, encryptedUsername, encryptedPassword from moz_logins where hostname like"
        $a2 = "http://ww.yahoo.com"
        $a3 = "moz-proxy://%s%%"
    condition:
        uint16(0) == 0x5a4d and
        filesize<1MB and
        $useragent and
        1 of ($a*)
}

rule CrowdStrike_CSIT_18112_05 : rat redleaves stone_panda 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects distinctive packed section names for RedLeaves RAT"
        reports = "CSIR-18014,CSIT-18112"
        version = "201810251023"
        last_modified = "2018-10-25"
        actor = "STONE PANDA"
        malware_family = "RedLeaves"
    strings:
        $a1 = "jpcert0"
        $a2 = "jpcert1"
        $b1 = "pyongya0"
        $b2 = "pyongya1"
        $c1 = "stpeter0"
        $c2 = "stpeter1"
        $d1 = "zelenog0"
        $d2 = "zelenog1"
        $e1 = "mackotk0"
        $e2 = "mackotk1"
        $f1 = "APT280"
        $f2 = "APT281"
    condition:
        uint16(0) == 0x5a4d and filesize<1MB and
        (all of ($a*) or
        all of ($b*) or
        all of ($c*) or
        all of ($d*) or
        all of ($e*) or
        all of ($f*))
}

rule CrowdStrike_CSIT_18112_06 : loader redleaves stone_panda 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects deobfuscation loop in libcef.dll loader used to deploy RedLeaves"
        reports = "CSIR-18014,CSIT-18112"
        version = "201810251025"
        last_modified = "2018-10-25"
        actor = "STONE PANDA"
        malware_family = "RedLeaves"
    strings:
        $ = { b1 ?? 8a 90 [4] 32 d1 88 90 [4] 40 3d [4] 7c ea 6a 40 }
    condition:
        uint16(0) == 0x5a4d and filesize<1MB and all of them
}

rule CrowdStrike_CSIT_18112_07 : artifact rat redleaves stone_panda 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects instructions used by RedLeaves to clear DES subkeys from memory."
        reports = "CSIR-18014,CSIT-18112"
        version = "201810251027"
        last_modified = "2018-10-25"
        actor = "STONE PANDA"
        malware_family = "RedLeaves"
    strings:
        $ = { 56 57 8b f1 6a 44 33 ff 8d 46 08 57 50 e8 [4] 6a 44 8d 46 4c 57 50 e8 [4] 6a 66 8d 86 98 00 00 00 57 50 e8 [4] 8d be fe 00 00 00 33 c0 ab 83 c4 24 ab 5f 5e c3  }
    condition:
        uint16(0) == 0x5a4d and all of them
}

// WARNING: This rule will only work with YARA 3
import "pe"

rule CrowdStrike_CSIT_18112_08 : loader redleaves stone_panda 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects versions of BIB.dll loader containing RedLeaves"
        reports = "CSIR-18014,CSIT-18112"
        version = "201810251028"
        last_modified = "2018-10-25"
        actor = "STONE PANDA"
        malware_family = "RedLeaves"
    strings:
        $dllname = "BIB.dll"
        $dlldate = "BIB 2018/01/24-20:06:24" wide
    condition:
        uint16(0) == 0x5a4d
        and (pe.characteristics & pe.DLL)
        and filesize<1MB
        and pe.sections[2].raw_data_size > pe.sections[0].raw_data_size
        and all of them
}

// WARNING: This rule will only work with YARA 3
import "pe"

rule CrowdStrike_CSIT_18112_09 : loader redleaves stone_panda 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects versions of NvSmartMax.dll loader containing RedLeaves"
        reports = "CSIR-18014,CSIT-18112"
        version = "201810251029"
        last_modified = "2018-10-25"
        actor = "STONE PANDA"
        malware_family = "RedLeaves"
    strings:
        $dll = "NvSmartMax.dll"
        $function = "DwmIsCompositionEnabled"
    condition:
        uint16(0) == 0x5a4d
        and (pe.characteristics & pe.DLL)
        and filesize<1MB
        and pe.sections[5].name == "new"
        and all of them
}

rule CrowdStrike_CSIT_18115_01 : downloader smoke_bot smoke_loader unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects unpacked versions of the first stage of the 2018 and 2019 Smoke variants."
        reports = "CSIT-18115,CSIT-19114"
        version = "201906241834"
        last_modified = "2019-06-24"
        malware = "Smoke Loader"
    strings:
        $uax_str = { 55 78 53 75 62 63 6C 61 73 73 49 6E 66 6F 00 5B }
        $call = { 55 48 89 E5 48 83 EC 40 53 56 57 41 54 48 83 EC 30 E8 }
        // APIs used for PROPagate inject technique
        $api1 = "UxSubclassInfo"
        $api2 = "SetPropA"
    condition:
        all of them
}

rule CrowdStrike_CSIT_18115_02 : smoke_bot smoke_loader downloader unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects the main 2018 Smoke Loader DLL."
        reports = "CSIT-18115"
        version = "201808030814"
        last_modified = "2018-08-03"
        malware = "Smoke Loader"
    strings:
        $c2_decrypt = { 32 c1 c1 f9 08 49 ff ca 75 f6 f6 d0 88 02 48 ff c2 49 ff c9 }
        $enc_key = { c7 44 24 40 ?? ?? ?? ?? e8 bd 0c 00 00 }
        $dec_key = { 48 8b ce c7 45 58 ?? ?? ?? ?? }
    condition:
        2 of them
}

rule CrowdStrike_CSIT_18110_01 : sigma ransomware unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects Sigma ransomware in memory dumps"
        reports = "CSIT-18110"
        version = "201807271449"
        last_modified = "2018-07-27"
        malware_family = "SigmaRansomware"
    strings:
        // Detect AES key used by Sigma
        $key = "WXSahFlWmXyI4StLwDCeJqV0tI4gnrw2"
        // Detect Chilkat API load string
        $chilkat = "OGCRerCrypt_OZEC4ykL5FFG"
        // Encrypted string
        $unknown = "ykiUZIQ3xplBiGsSCRLOVg=="
    condition:
        all of them
}

rule CrowdStrike_RATPAK_SPIDER_Pegasus_wdd : pegasus rat ratpak_spider 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects a unique copy routine in the wdd component of the Pegasus malware"
        reports = "CSA-18531"
        version = "202105061448"
        last_modified = "2021-05-06"
        actor = "RATPAK SPIDER"
        malware_family = "Pegasus"
    strings:
        $ = { 33 c9 89 4d fc 8a 1a 84 db 74 21 8b 45 e4 88 18
        ff 45 e4 42 89 55 dc 41 89 4d d8 81 f9 00 02 00
        00 76 e2 eb 07 33 c0 40 c3 8b 65 e8 83 4d fc ff }
        $ = { 45 33 c0 44 8a 0a 45 84 c9 74 25 44 88 08 48 ff
        c0 48 89 04 24 48 ff c2 48 89 54 24 08 49 ff c0
        4c 89 44 24 10 49 81 f8 00 02 00 00 77 02 eb d3 }
    condition:
        any of them
}

rule CrowdStrike_CSA_18536_01 : downloader foundation 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects downloader tool that is used to download RC4-encrypted FlawedAmmyy payloads"
        reports = "CSA-18536"
        version = "201905210830"
        last_modified = "2019-05-21"
        malware_family = "Foundation"
        component = "Updater"
    strings:
        $opk32 = { 55 8b ec 51 56 57 64 8b 35 30 00 00 00 8b 76 0c 8b 76 1c 8b 56 08 8b 7e 20 8b 36 81 7f 0c 33 00 32 00 75 ef 89 55 fc 8b 45 fc 5f 5e 8b e5 5d c3 }
        $opapi = { 8b 17 03 d6 33 c0 8a 0a 84 c9 74 13 8b ff c1 c0 07 0f be c9 8d 52 01 33 c1 8a 0a 84 c9 75 ef 3b 45 ?? 74 06 43 83 c7 04 eb d6 }
        $scNew = "/C sc create foundation binPath=" wide ascii
        $oldf1 = "%s\\AMMYY\\wmihost.exe"
        $oldf2 = "%s\\AMMYY\\settings3.bin"
        $oldf3 = "%s\\Foundation\\wmites.exe"
        $oldf4 = "%s\\Foundation\\settings3.bin"
        $oldf5 = "%s\\Foundation1\\wmites.exe"
        $oldf6 = "%s\\Foundation1\\settings3.bin"
        $oldf7 = "%s\\Microsoft\\wsus.exe"
        $oldf8 = "%s\\Microsoft\\settings3.bin"
        $olds1 = "/C net.exe stop ammyy" wide
        $olds2 = "/C sc delete ammyy" wide
        $olds3 = "/C net.exe stop foundation" wide
        $olds4 = "/C sc delete foundation" wide
    condition:
        any of ($op*) and ($scNew or 8 of ($old*))
}

rule CrowdStrike_CSA_18536_02 : fivebyfive dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects dropper used to deploy a downloader tool used to acquire FlawedAmmy payloads. Identifies strings used in anti-analysis procedures."
        reports = "CSA-18536"
        version = "201807201517"
        last_modified = "2018-07-20"
        malware_family = "FiveByFiveDropper"
    strings:
        $fakelib = "V><MDNbyfui6y2iuow"
        $fakewinclass1 = "&JTEH$WHD"
        $fakewinclass2 = "fdsfds"
        $fakewinname1 = "&*^@QDSJGIO"
        $fakewinname2 = "fdsfsd,"
    condition:
        3 of them
}

rule CrowdStrike_CSIT_18121_01 : infostealer nocturnal_stealer 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Nocturnal Stealer malware"
        reports = "CSIT-18121"
        version = "201902262345"
        last_modified = "2019-02-26"
        malware_family = "Nocturnal Stealer"
    strings:
        $pdb = "D:\\Work\\Nocturnal\\Bot\\trunk\\Release\\Nocturnal.pdb" ascii fullword
        $agent = "Nocturnal/1.0" wide
        $path = "C:\\ProgramData\\Nocturnal" fullword
        $f1 = "\\files\\filezilla_"
        $f2 = "files\\information.txt"
    condition:
        uint16(0) == 0x5A4D and 4 of them
}

rule CrowdStrike_CSIT_18124_01 : synack ransomware 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects the obfuscated 64-bit version of the SynAck Ransomware with AES_NI."
        reports = "CSIT-18124"
        version = "201808101345"
        last_modified = "2018-08-10"
        malware_family = "SynAck"
    strings:
        /*
        call    rax
        pop     r9
        pop     r8
        pop     rdx
        pop     rcx
        push    rax
        retn
        */
        $code_api_proxy_1 = { FF D0 41 59 41 58 5A 59 50 C3 }
        /*
        call    rax
        pop     r9
        pop     r8
        pop     rdx
        pop     rcx
        jmp     rax
        */
        $code_api_proxy_2 = { FF D0 41 59 41 58 5A 59 FF E0 }
        /*
        lea     rax, cs:[xxx]
        add     rax, [xxx]
        [...]
        call    rax
        */
        $code_call_obfuscation = { 48 8D 05 [4] 48 05 [4-9] FF D0}
        $code_cpudetect = { 40 53 48 83 EC 10 33 C0 33 C9 0F A2 44 8B C1 83 }
    condition:
        $code_cpudetect and #code_call_obfuscation > 100 and #code_api_proxy_1 > 10 and #code_api_proxy_2 > 10
}

rule CrowdStrike_CSA_18543_01 : nimbus rat ricochet_chollima 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects RICOCHET CHOLLIMA implant Nimbus Version 3"
        reports = "CSA-18543"
        version = "201907251602"
        last_modified = "2019-07-25"
        actor = "RICOCHET CHOLLIMA"
        malware_family = "Nimbus"
    strings:
        $db1 = "Dropbox-API-Arg" wide
        $db2 = {7B 00 22 00 70 00 61 00 74 00 68 00 22 00 3A 00
        22 00 25 00 73 00 22 00 2C 00 22 00 6D 00 6F 00
        64 00 65 00 22 00 3A 00 7B 00 22 00 2E 00 74 00
        61 00 67 00 22 00 3A 00 22 00 6F 00 76 00 65 00
        72 00 77 00 72 00 69 00 74 00 65 00 22 00 7D 00
        7D 00}
        $s_db1 = {BB 08 23 09}
        $s_db2 = {2F 09 2F 09}
        $s_db3 = {2B 09 2E 09}
        $s_db4 = {F5 08 EA 08}
        $s_db5 = {EA 08 1E 09}
        /*
        String decoder code
        mov     [ebp+var_4], 800h
        mov     ax, [edx]
        lea     edx, [edx+2]
        sub     ax, bx
        sub     ax, word ptr [ebp+var_4]
        mov     [edi+ecx*2], ax
        */
        $code = { c7 45 fc 00 08 00 00 66 8b 02 8d 52 02 66 2b c3 66 2b 45 fc 66 89 04 4f }
    condition:
        (1 of ($db*)) and ((all of ($s_*)) or ($code))
}

rule CrowdStrike_CSIT_17030_01 : fileautoscanner post_exploitation 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Matches on characteristics of the exfiltration tool FileAutoScanner."
        reports = "CSIT-17030"
        version = "201807300927"
        last_modified = "2018-07-30"
        malware_family = "FileAutoScanner"
    strings:
        $dotnet_magic_1 = "BSJB"
        $dotnet_magic_2 = "#Strings"
        $dotnet_function_name_1 = "AES_Encrypt"
        $dotnet_function_name_2 = "AES_Decrypt"
        $dotnet_bytecode = { 1F 0F 1F 10 28 ?? 00 00 0A [0-1] 06 [2-10] 6F ?? 00 00 }
        $comms_comparestring = "CompareString"
        $comms_downloadstring = "DownloadString"
        $comms_uploadfile = "UploadFile"
        $exfil_docx = "*.docx" wide
        $exfil_pptx = "*.pptx" wide
        $exfil_xlsx = "*.xlsx" wide
        $exfil_pdf = "*.pdf" wide
        $url_php = ".php?" wide
        $url_hsh = "&hsh=" wide
        $url_hs = "&hs=" wide
    condition:
        all of ($dotnet_*) and
        all of ($comms_*) and
        3 of ($exfil_*) and
        2 of ($url_*)
}

rule CrowdStrike_CSIT_17030_02 : post_exploitation udiskputty 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Matches on characteristics of UdiskPutty. UDiskPutty is a second-stage tool to help an actor establish persistence on a host"
        reports = "CSIT-17030"
        version = "202001161355"
        last_modified = "2020-01-16"
        malware_family = "UdiskPutty"
    strings:
        $ = "goto Repeat" wide
        $ = "Cannot get Root Folder pointer:"
    condition:
        all of them
}

rule CrowdStrike_CSA_18549_01
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Nullsoft Installer with non-standard marker that may indicate malicious activity as described in CSA-18549."
        reports = "CSA-18549"
        version = "201808201649"
        last_modified = "2018-08-20"
    strings:
        $sigstart = { 00 00 00 ef be ?? de 4e 75 6c 6c 73 6f 66 74 49 6e 73 }
    condition:
        all of them and uint8(@sigstart + 18) != 0x74
}

rule CrowdStrike_CSA_18547_01 : venomkit exploit 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects storage of specific files in a VenomKit exploit"
        reports = "CSA-18547"
        version = "201807231332"
        last_modified = "2018-07-23"
        malware_family = "VenomKit"
    strings:
        $bat = "406563686f206f66660a736574"
        $script = "3c3f584d4c2076657273696f6e3d22312e30223f3e0a3c7363726970746c65743e"
        $inf = "5b76657273696f6e5d0a5369676e6174757265"
    condition:
        2 of them
}

rule CrowdStrike_ConustrA : conustra reconnaissance 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects the reconnaissance malware ConustrA which collects documents and system information and infectiously spreads via removable drives. "
        version = "201903151051"
        last_modified = "2019-03-15"
        malware_family = "ConustrA"
    strings:
        // encrypted: %temp%\winword4.doc
        $word = "$sdlo$[vhmvnqc3-cnb" fullword
        // encrypted: HKEY_LOCAL_MACHINE\SOFTWARE\Classes\exefile
        $exef = "GJDX^KNB@K^L@BGHMD[RNESV@QD[Bk`rrdr[dwdehkd"
        // encrypted: autorun entry
        $auto = "GJDX^BTQQDMS^TRDQ[Rnesv`qd[Lhbqnrnes[Vhmcnvr\x1fMS[BtqqdmsUdqrhnm[Vhmcnvr\x0c\x09!Kn`c!\x1f<\x1fQDF^RY\x1f!" fullword
        // encrypted: System Volume Information
        $sysv = "Rxrsdl\x1fUnktld\x1fHmenql`shnm" wide
        // encrypted: \xcopy.exe /d /c /i /h /r /y
        $xcop = "[wbnox-dwd\x1f.c\x1f.b\x1f.h\x1f.g\x1f.q\x1f.x\x1f" wide
    condition:
        any of them
}

rule CrowdStrike_CSIT_18120_01 : nuclear_bot bot turkish_nuke 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects the XOR loop used by Turkish Nuke's customer loader"
        reports = "CSIT-18120"
        version = "201808101315"
        last_modified = "2018-08-10"
        malware = "Nuclear Bot, Turkish Nuke"
        // targets the following bytes used for XOR
        // .text:6F4C12A3 31 D2                          xor     edx, edx
        // .text:6F4C12A5 89 C1                          mov     ecx, eax
        // .text:6F4C12A7 89 D8                          mov     eax, ebx
        // .text:6F4C12A9 F7 F1                          div     ecx
        // .text:6F4C12AB 89 F0                          mov     eax, esi
        // .text:6F4C12AD 83 C3 01                       add     ebx, 1
        // .text:6F4C12B0 83 EC 04                       sub     esp, 4
        // .text:6F4C12B3 32 82 24 C0 4D 6F              xor     al, byte ptr ds:String[edx] ; // key
        // .text:6F4C12B9 88 83 FF 1F 4C 6F              mov     ds:byte_6F4C1FFF[ebx], al
        // .text:6F4C12BF 81 FB 00 90 01 00              cmp     ebx, 19000h
    strings:
        $api_routine = {31 D2 89 C1 89 D8 F7 F1 89 F0 83 C3 01 83 EC 04 32 82 ?? ?? ?? ??  88 83 ?? ?? ?? ?? 81 FB 00 90 01 00 }
    condition:
        $api_routine
}

rule CrowdStrike_CSIT_15072_01 : quattrorat dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "QuattroRAT Dropper"
        reports = "CSIT-15072"
        version = "201807201512"
        last_modified = "2018-07-20"
        malware_family = "QuattroRAT"
    strings:
        $ = "%u_%S._mp" wide
        // CMP/JZ pattern looking for "0~!@$%^&*()"
        $ = { 80 3C 18 30 75 ?? 80 7C 18 01 7E 75 ?? 80 7C 18 02 21 75 ?? 80 7C 18 03 40 75 ?? 80 7C 18 04 24 75 ?? 80 7C 18 05 25 75 ?? 80 7C 18 06 5E 75 ?? 80 7C 18 07 26 75 ?? 80 7C 18 08 2A 75 ?? 80 7C 18 09 28 75 ?? 80 7C 18 0A 29 74 08 }
    condition:
        all of them
}

rule CrowdStrike_CSIT_15072_02 : quattrorat rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "QuattroRAT"
        reports = "CSIT-15072"
        version = "201809121748"
        last_modified = "2018-09-12"
        malware_family = "QuattroRAT"
    strings:
        // Exports
        $ = "DriverDev"
        $ = "DriverInit"
        $ = "DriverLaunch"
        $ = "DriverProc"
        // CRC32 constant
        $ = { 20 83 b8 ed }
    condition:
        all of them
}

rule CrowdStrike_CSIT_18120_02 : nuclear_bot bot turkish_nuke 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects the unpacked Turkish Nuke Bot component."
        reports = "CSIT-18120"
        version = "201808101324"
        last_modified = "2018-08-10"
        malware = "Nuclear Bot, Turkish Nuke"
    strings:
        $bot_formatter = "%08X%08X"
        // detects bytes in the XOR loop
        $xor_func = {33 D2 F7  F1 8B 45 0C 8B 4D 08 8A 04 02 32 04 31 88 06 8B 45 10 40}
    condition:
        all of them
}

rule Crowdstrike_CSIT_18127_01 : manuscrypt labyrinth_chollima rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects LABYRINTH CHOLLIMA Manuscrypt RAT with encoded strings"
        reports = "CSIT-18127"
        version = "201808170752"
        last_modified = "2018-08-17"
        actor = "LABYRINTH CHOLLIMA"
        malware_family = "Manuscrypt"
    strings:
        $str_enc = "Cxwkewk-Drjyxjrkrxw"
        $str_fm = "FM*.tmp"fullword
        $str_wm = "WM*.tmp"fullword
        $str_unk = "----FxivBxlwdaip"
        $code_x86_1 = { 83 fa 59 7f 14 8b 85 ?? ?? ?? ?? 0f be 08 83 e9 09 }
        $code_x86_2 = { 3c 72 7c 04 3c 79 7e ?? 3c 49 7c ?? 3c 50 }
        $code_x64_1 = { 8d 41 8e 3c 07 ?? ?? 8d 41 b7 3c 07 ?? ?? 80 c1 09 }
        $code_x64_2 = { 8d 48 8e 80 f9 07 ?? ?? 8d 48 b7 80 f9 07 ?? ?? 04 09 }
        $code_x64_3 = { 0f be 00 83 f8 49 ?? ?? 48 8b ?? ?? ?? 0f be 00 83 f8 50 }
    condition:
        filesize < 3MB and
        (all of ($str*)) and (1 of ($code*))
}

rule Crowdstrike_CSIT_18127_02 : manuscrypt labyrinth_chollima rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects LABYRINTH CHOLLIMA Manuscrypt RAT with plaintext strings for C2 headers"
        reports = "CSIT-18127"
        version = "201808170753"
        last_modified = "2018-08-17"
        actor = "LABYRINTH CHOLLIMA"
        malware_family = "Manuscrypt"
    strings:
        $content = "Content-Type: multipart/form-data; boundary="
        $userid = "Content-Disposition: form-data; name=\"user_id"
        $str_fm = "FM*.tmp"fullword
        $str_wm = "WM*.tmp"fullword
        $str_form = "----FormBoundary"
    condition:
        filesize < 3MB and
        all of them
}

rule CrowdStrike_CSIT_18123_02 : philadelphia ransomware 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects unobfuscated strings from Philadelphia ransomware in memory."
        reports = "CSIT-18123"
        version = "201808101304"
        last_modified = "2018-08-10"
        malware_family = "Philadelphia"
    strings:
        $ = "AutoIt" wide
        $ = "/AutoIt3ExecuteScript" wide
        $ = "Isass.exe" wide
        $ = "Update Notifier.lnk" wide
        $ = "myDisk\\drivers.exe" wide
        $ = "usbinfect" wide
        $ = "networkspread" wide
        $ = "Status is " wide
    condition:
        6 of them
}

rule CrowdStrike_CSIT_18123_01 : philadelphia ransomware 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects strings from Philadelphia ransomware in AutoIt decompilation."
        reports = "CSIT-18123"
        version = "201808101312"
        last_modified = "2018-08-10"
        malware_family = "Philadelphia"
    strings:
        $ = "AUTOIT"
        $ = "unkillable"
        $ = "myDisk\\drivers.exe"
        $ = "usbinfect"
        $ = "networkspread"
        $ = "Status is "
        $ = "?p=Insert"
        $ = "?p=Ping"
        $ = "?p=Checkpayment"
    condition:
        7 of them
}

rule CrowdStrike_CSIR_18010_02 : flash_kitten rat sorgu 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects .NET RAT that self-identifies as Sorgu"
        reports = "CSIR-18010"
        version = "202106171612"
        last_modified = "2021-06-17"
        actor = "FLASH KITTEN"
        malware = "Sorgu"
    strings:
        $name = "Sorgu.exe"
        $sorgu1 = "webClient_0"
        $sorgu2 = "set_ServerCertificateValidationCallback"
        $sorgu3 = "WebHeaderCollection"
        $sorgu4 = "ServiceInstaller"
        // String index lookup used in deobfuscation
        $obf = { 02 20 ?? ?? ?? ?? 5a 20 ?? ?? ?? ?? 61 10 00 02 1f 1e
        64 0a 12 01 fe 15 01 00 00 1b 02 20 ff ff ff 3f 5f 10
        00 02 18 62 10 00 06 6e }
        // Obfuscated process execution command seen in other variants
        $exec = { 28 ?? 00 00 06 0a 06
        28 ?? 00 00 06 25 25 16 25 0b
        28 ?? 00 00 06 07
        28 ?? 00 00 06 25 25 25 25 17 25 0d
        28 ?? 00 00 06 09 25 0c
        28 ?? 00 00 06 08 25 0b
        28 ?? 00 00 06 07
        28 ?? 00 00 06 25 25 }
    condition:
        uint16(0) == 0x5a4d and
        uint32(uint32(0x3c)) == 0x00004550 and
        uint32(uint32(0x3c) + 0xe8) > 0 and
        ($obf or $exec) and $name and 3 of ($sorgu*)
}

rule CrowdStrike_CSIR_18010_01 : dropper flash_kitten sorgu 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects dropper used to deploy and execute Sorgu RAT"
        reports = "CSIR-18010"
        version = "202106171613"
        last_modified = "2021-06-17"
        actor = "FLASH KITTEN"
        malware_family = "Sorgu"
    strings:
        $full1 = "SC CONFIG wuauserv START= DISABLED && SC STOP wuauserv"
        $full2 = "%windir%\\Microsoft.NET\\Framework\\v2.0.50727\\InstallUtil.exe /LogFile= /LogToConsole=false /i \"%windir%\\IME\\svchost.exe\""
        $part1 = "SC CONFIG wuauserv"
        $part2 = "SC STOP wuauserv"
        $part3 = "Microsoft.NET\\Framework\\v2.0.50727\\InstallUtil.exe"
        $part4 = "%windir%\\IME\\svchost.exe"
    condition:
        any of ($full*) or 2 of ($part*)
}

rule CrowdStrike_CSA_18568_01 : stardust_chollima keylogger 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects a keylogger suspected to be used by STARDUST CHOLLIMA launched via Powershell."
        version = "201807271311"
        last_modified = "2018-07-27"
        actor = "STARDUST CHOLLIMA"
    strings:
        $ = "%sGoogleChrome"
        $ = "C:\\ProgramData\\2.dat"
        $ = "[CLIPBOARD]"
        $ = "CaptureDesktop: CreateCompatibleBitmap failed"
    condition:
        3 of them
}

rule CrowdStrike_CSIT_13067_01 : dagger_panda rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects version 1 of a RAT associated with DAGGER PANDA"
        reports = "CSIT-13067"
        version = "201901251050"
        last_modified = "2019-01-25"
        actor = "DAGGER PANDA"
    strings:
        // xor keys
        $xorkey1 = "*&~^%@0hh8979"
        $xorkey2 = "&*^*@~^%9?i0h"
        // beacon format string
        $formatstr1 = "HostName: %s\x0d\x0aIP: %s\x0d\x0aProxy: %s\x0d\x0aUser: %s\x0d\x0aSystemDir: %s\x0d\x0aOS Language Version: %d\x0d\x0aSystem Version: %d.%d %s (Build %d)\x0d\x0a\x0d\x0a"
        $formatstr2 = "HostNrme: %s\x0d\x0aIP: %s\x0d\x0aProxy: %s\x0d\x0aUser: %s\x0d\x0aSystemDir: %s\x0d\x0aOS Latguage Version: %d\x0d\x0aSystem Version: %d.%d %s (Build %d)\x0d\x0a\x0d\x0a"
        $pathstr = "/jd/order/%s"
    condition:
        uint16(0) == 0x5A4D and uint32(uint32(0x3C)) == 0x00004550 and uint16(uint32(0x3C) + 0x16) & 0x2000 == 0x2000 and
        1 of ($xorkey*) and 1 of ($formatstr*) and $pathstr
}

rule CrowdStrike_CSIT_13067_02 : dagger_panda rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects version 2 of a RAT associated with DAGGER PANDA"
        reports = "CSIT-13067"
        version = "201901251039"
        last_modified = "2019-01-25"
        actor = "DAGGER PANDA"
    strings:
        // xor keys
        $xorkey1 = "*&~^%@0hh8979"
        $xorkey2 = "&*^*@~^%9?i0h"
        // beacon format string
        $formatstr1 = "HostName: %s\x0d\x0aIP: %s\x0d\x0aProxy: %s\x0d\x0aUser: %s\x0d\x0aSystemDir: %s\x0d\x0aOS Language Version: %d\x0d\x0aSystem Version: %d.%d %s (Build %d)\x0d\x0a\x0d\x0a"
        $formatstr2 = "HostNrme: %s\x0d\x0aIP: %s\x0d\x0aProxy: %s\x0d\x0aUser: %s\x0d\x0aSystemDir: %s\x0d\x0aOS Latguage Version: %d\x0d\x0aSystem Version: %d.%d %s (Build %d)\x0d\x0a\x0d\x0a"
        $pathstr = "/update/order/%s"
    condition:
        uint16(0) == 0x5A4D and uint32(uint32(0x3C)) == 0x00004550 and uint16(uint32(0x3C) + 0x16) & 0x2000 == 0x2000 and
        1 of ($xorkey*) and 1 of ($formatstr*) and $pathstr
}

rule CrowdStrike_LNK_File_With_Powershell : dropper lnk powershell 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects LNK files which include PowerShell code. This technique was observed in a LNK file associated with the activity described in CSA-181021."
        reports = "CSA-181021"
        version = "201901111308"
        last_modified = "2019-01-11"
    strings:
        $guid = { 01 14 02 00 }
        $pshell = "C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe" wide ascii
        $parg = "-noni -ep bypass -win hidden $s = [Text.Encoding]::ASCII.GetString([Convert]::FromBase64String" wide ascii
    condition:
        uint32(0) == 0x4c and $guid at 4 and filesize > 300KB and (1 of($pshell, $parg))
}

rule CrowdStrike_CSIR_18014_02 : plugx rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Identifies DLL files without an export table, indicative of PlugX deployments. Hits for this rule should be correlated with other data to reduce false positives."
        reports = "CSIR-18014"
        version = "202008051526"
        last_modified = "2020-08-05"
        malware_family = "PlugX"
    strings:
        $api1 = "GetModuleFileNameW"
        $api2 = "VirtualAlloc"
        $api3 = "CreateFileW"
        $api4 = "ReadFile"
        $api5 = "CloseHandle"
        $api7 = "Sleep"
        $lstrcpyW = "lstrcpyW"
        $lstrcatW = "lstrcatW"
    condition:
        // Verify MZ signature
        (uint16(0) == 0x5A4D)
        and
        // Define "peHeader"
        for any peHeader in (uint32(0x3C)..uint32(0x3C)):
        (
        // Verify PE signature
        (uint32(peHeader) == 0x00004550)
        and
        // Ensure this PE file is a DLL
        ((uint8(peHeader + 0x17) & 0x20) == 0x20)
        and
        // Ensure the Export Directory's RVA is 0x00000000
        (uint32(peHeader + 0x78) == 0x00000000)
        )
        and
        // Make sure this file has the expected API functions statically imported
        all of ($api*) and ($lstrcpyW or $lstrcatW)
}

rule CrowdStrike_CSIR_18014_03 : plugx rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Identifies a distinctive PUSH call used to load PlugX configuration data."
        reports = "CSIR-18014"
        version = "201901220932"
        last_modified = "2019-01-22"
        malware_family = "PlugX"
    strings:
        $pushpushcall = { 68 ?? ?? ?? 00 e8 ?? ?? ?? 00 [4-6] 68 a0 02 00 00 }
    condition:
        $pushpushcall and
        filesize > 500KB
}

rule CrowdStrike_CSIT_19067_01 : autodown downloader fancy_bear 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "FANCY BEAR AutoDown downloader"
        reports = "CSIT-19067"
        version = "201905030901"
        last_modified = "2019-05-03"
        actor = "FANCY BEAR"
        malware_family = "AutoDown"
    strings:
        $hex_encoded_1 = "5472617949636F6E48696465" // TrayIconHide
        $hex_encoded_2 = "504F5354" // POST
        $autodown_1 = "@AppDataCommonDir" nocase
        $autodown_2 = "@LOCALAPPDATADIR" nocase
        $autodown_3 = "StringLeft(Hex(" nocase
        $autodown_4 = "$delay = Random(3, 7) * 62000" nocase
    condition:
        all of ($hex_encoded_*) and 3 of ($autodown_*)
}

rule CrowdStrike_Floxif_Symsrv : floxif virus 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects the symsrv component of the Floxif file infecting virus."
        version = "201903151053"
        last_modified = "2019-03-15"
        malware_family = "Floxif"
    strings:
        $str1 = { 8B 45 08 33 C9 8A 48 03 83 F9 01 75 0? 8B 45 08 83 C0 04 }
        $str2 = { 8A 48 02 85 C9 74 ?? 8B 55 08 03 55 FC [2-8] 8B 4D 08 [2-8] 33 C2 8B 4D 08 03 4D FC 88 01 }
        $str3 = { F7 D0 8B ?? 08 03 ?? FC 88 01 8B ?? 08 03 ?? FC }
    condition:
        2 of them and CrowdStrike_Floxif
}

// WARNING: This rule will only work with YARA 3
import "pe"

rule CrowdStrike_Floxif_Packed : floxif virus 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects the UPX-packed version of the Floxif file infecting virus."
        version = "201903151053"
        last_modified = "2019-03-15"
        malware_family = "Floxif"
    strings:
        $UPX0 = "UPX0"
        $UPX1 = "UPX1"
        $UPXX = "UPX!"
    condition:
        pe.exports("FloodFix") and pe.exports("FloodFix2") and pe.exports("crc32")
        and all of them
}

rule CrowdStrike_CSIR_18010_03 : dropper flash_kitten guester post_exploitation 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects dropper for Guester, a tool to establish legitimate-looking backdoor accounts on infected systems"
        reports = "CSIR-18010"
        version = "202106171614"
        last_modified = "2021-06-17"
        actor = "FLASH KITTEN"
        malware_family = "Guester"
    strings:
        $loc = "%windir%\\IME\\"
        $winload = "winload.exe"
        $svchost = "svchost"
        $cmd_start = "net start"
        $cmd_1 = "-install"
        $cmd_2 = "-remove"
        $srv_start = "SC START"
        $srv_1 = "gpmsvc"
        $srv_2 = "gpsrv"
    condition:
        $loc and 1 of ($winload,$svchost) and (3 of ($cmd*) or 2 of ($srv*))
}

rule CrowdStrike_CSIR_18010_04 : flash_kitten guester post_exploitation 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects Guester, a tool to establish legitimate-looking backdoor accounts on compromised systems"
        reports = "CSIR-18010"
        version = "202106171612"
        last_modified = "2021-06-17"
        actor = "FLASH KITTEN"
        malware_family = "Guester"
    strings:
        $password = "1234qweRR"
        $guest_account = "net user guest"
        $group_account = "net localgroup \"Remote Desktop Users\" guest /add"
        $backup = "c:\test.inf"
    condition:
        3 of them
}

rule CrowdStrike_CSIR_18010_05 : flash_kitten post_exploitation 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects FLASH KITTEN DLL used to enable Terminal Services access to a compromised system"
        reports = "CSIR-18010"
        version = "202106171611"
        last_modified = "2021-06-17"
        actor = "FLASH KITTEN"
    strings:
        $reg = "hklm\\system\\currentControlSet\\Control\\Terminal Server"
        $config = "sc config termservice start=auto"
        $start = "sc start termservice"
        $firewall = "netsh firewall set service type=remotedesktop mode=enable"
    condition:
        all of them
}

rule CrowdStrike_CSIR_18010_06 : flash_kitten post_exploitation 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Provides generic detection for DLLs used by FlashMob to install backdoor accounts on compromised systems"
        reports = "CSIR-18010"
        version = "202106171612"
        last_modified = "2021-06-17"
        actor = "FLASH KITTEN"
    strings:
        $netuser = "net user"
        $password = "1234qweRR"
        $account_1 = "Administrator"
        $account_2 = "vmware"
        $account_3 = "guest"
        $switch_1 = "/active:yes"
        $switch_2 = "/add"
    condition:
        $netuser and $password and 1 of ($account*) and 1 of ($switch*)
}

rule CrowdStrike_CSIR_18010_07 : flash_kitten flashmob leafminer raspite 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Identifies distinctive PDB string used in multiple FlashMob binaries"
        reports = "CSIR-18010"
        version = "202106171612"
        last_modified = "2021-06-17"
        actor = "FLASH KITTEN"
    strings:
        $pdb = "C:\\Users\\WIN-2-ViHKwdGJ574H\\Desktop\\"
    condition:
        $pdb
}

rule CrowdStrike_EMISSARY_PANDA_Shellcode_Downloader : downloader emissary_panda shellcode 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects a shellcode downloader. It was observed in use during operations targeting US and UK think tanks from 2016-2018, possibly undertaken by EMISSARY PANDA."
        version = "201911121900"
        last_modified = "2019-11-12"
    strings:
        $ = "Setconfig" wide
        $ = "Soldier %s" wide
        $ = "To Pass UAC" wide
        $ = "SystemStart" wide
        $ = "Double Click" wide
        $ = "While In" wide
        $ = "getip" wide
        $ = "OnlineHelp" wide
        $ = "Setconfig" wide
        $ = "run Done" wide
        $ = "%s --Update" wide
        $ = "Periodic" wide
        $ = "\"%s\" /update" wide
    condition:
        6 of them
}

rule CrowdStrike_CVE_2017_8360_MicTray : keylogger 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects Conexant MicTray applications vulnerable to CVE-2017-8360, whereby keystrokes are inadvertently logged by the application."
        version = "201903151052"
        last_modified = "2019-03-15"
    strings:
        $fn1 = "SetWindowsHookEx"
        $fn2 = "UnhookWindowsHookEx"
        $fn3 = "CallNextHookEx"
        $pdb = "MicTray.pdb"
        $mt1 = "C:\\Users\\Public\\MicTray.log" wide fullword
        $mt2 = "HOTKEYID %d, wParam %d" wide fullword
        $mt3 = "SOFTWARE\\Conexant\\MicTray\\Hotkey" wide
        $mt4 = "HotKeyMicScancode" wide
        $mt5 = "HotKeySpkScancode" wide
    condition:
        all of ($fn*) and $pdb and 3 of ($mt*)
}

rule CrowdStrike_Modified_HTran_Proxy_Tool : proxy htran 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects an Htran variant in use by probable Chinese nation-state sponsored actors. "
        reports = "CSA-18611"
        version = "201808071832"
        last_modified = "2018-08-07"
        malware = "HTran"
    strings:
        $pdb_hgg = "\\Release\\hgg.pdb"
        $o_listen_port = "[+] lis p %d"
        $o_server_error = "[S]c t %s:%d error"
        $o_accept_client_from = "[+] A a C F %s:%d"
    condition:
        any of them
}

rule CrowdStrike_CSIT_18132_01 : cre_stealer infostealer unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects unpacked versions of the CRE Stealer malware"
        reports = "CSIT-18132"
        version = "201808301927"
        last_modified = "2018-08-30"
        malware_family = "CRE Stealer"
    strings:
        $s1 = "Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Trident/5.0)"
        $s2 = "abe2869f-9b47-4cd9-a358-c22904dba7f7"
        $s3 = "{%08X-%04X-%04X-%02X%02X-%02X%02X%02X%02X%02X%02X}"
        $s4 = "signons3.txt"
        $s5 = "signons.sqlite"
        $s6 = "FILEHDRX"
        $s7 = "NCRYPTED"
        $s8 = "CReportPassword"
        $s9 = "http://www.facebook.com/" wide
        $inst1 = { 8a 5c 08 04 32 da 80 f3 13 42 }
        $inst2 = { ff 15 18 c1 c0 0b 89 85 ec fe ff ff 8b 85 ec fe ff ff c1 c0 0b f7 d0 }
        $inst3 = { ba 00 01 00 00 88 0e 41 46 66 3b ca }
    condition:
        5 of ($s*) and 1 of ($inst*)
}

rule CrowdStrike_CSA_18606_01 : carbon_spider harpy delivery_document 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects obfuscation of malicious document dropping Harpy"
        reports = "CSA-18606"
        version = "201808101314"
        last_modified = "2018-08-10"
        actor = "CARBON SPIDER"
        malware = "Harpy"
    strings:
        $ = ";---}---function@@"
        $ = "return@@"
        $ = ";---}---var@@"
        $ = "()@@+@@"
    condition:
        all of them
}

rule CrowdStrike_Chopper_ASPX_Variant : chopper script webshell 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects an ASPX variant of Chopper webshell."
        version = "201912192040"
        last_modified = "2019-12-19"
        malware = "Chopper Webshell"
    strings:
        $f_get_local_all        = "A_Get_LocalDirectory_and_AllDirves"
        $f_get_file_list        = "B_GetFileList"
        $f_readtextfile         = "C_ReadTextFile"
        $f_write_text_file      = "D_WriteTextFile"
        $f_delete_file          = "E_DeleteFile"
        $f_upload_file          = "G_UploadFile"
        $f_copy_file            = "H_CopyFile"
        $f_rename_file          = "I_RenameFile"
        $f_create_directory     = "J_CreateDirectory"
        $f_set_file_time        = "K_SetFileTime"
        $f_dowload_remote_file  = "L_DownloadFileFormUrl"
        $f_run_cmd_shell        = "M_RunCMDShell"
        $f_get_database_info    = "N_GetDateBaseInfo"
        $f_get_database_tables  = "O_GetDateBaseTables"
        $f_get_database_columns = "P_GetDateBaseColumns"
        $f_execute_sql_commands = "Q_ExecuteSqlCommand"
    condition:
        2 of them
}

rule CrowdStrike_Chopper_ASPX_Variant_2 : chopper script webshell 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects a ASPX/JSP variants of Chopper webshell."
        version = "202004271728"
        last_modified = "2020-04-27"
        malware_family = "Chopper Webshell"
    strings:
        $z1_req = "HttpContext.Current.Request[\"z1\"];"
        $exchange_str = "HttpContext.Current.Request[ExchangeStr][0])"
        $ec_z1 = "EC(request.getParameter(\"z1\")"
        $sb_append = "sb.append(\"->\" + \"|\");"
    condition:
        any of them
}

rule CrowdStrike_Simplify_Mimikatz_Modification : mimikatz post_exploitation tasking 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects a PDB string found in a Mimikatz variant."
        version = "201808101317"
        last_modified = "2018-08-10"
        malware = "Mimikatz"
    strings:
        $pdb = "simplify_modify\\x64\\simplify.pdb"
    condition:
        $pdb
}

rule CrowdStrike_Whizzimo_Certificate : certificate post_exploitation whizzimo 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects a certificate which has been used to sign Mimikatz binaries. "
        version = "201910140901"
        last_modified = "2019-10-14"
    strings:
        $cn = "Whizzimo, LLC"
        $serial = { 00 d3 50 ae 9f f3 32 5e 43 }
    condition:
        uint16(0) == 0x5a4d and
        ($cn and $serial)
}

rule CrowdStrike_VENOMOUS_BEAR_Mosquito_03 : mosquito rat venomous_bear 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects characteristic code features used in Mosquito, although may produce some false positives"
        version = "201908131553"
        last_modified = "2019-08-13"
        actor = "VENOMOUS BEAR"
        malware_family = "Mosquito"
    strings:
        $ = { cf 74 05 80 4c 24 13 04 8b c8 83 e1 04 33 ff 0b cf 74 05 80 }
        $ = { d2 83 c0 61 66 89 04 73 46 3b f5 7c ea 33 c0 66 89 04 6b 5e }
    condition:
        all of them
}

rule CrowdStrike_CSIT_18122_01 : downloader mylobot unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects unpacked MyloBot samples"
        reports = "CSIT-18122"
        version = "201904260855"
        last_modified = "2019-04-26"
        malware_family = "MyloBot"
    strings:
        /* Code from starting VA 004044ea:
        push  [esp+130h+a1]; a2
        lea   eax, [esp+134h+var_104]
        push  eax; a1
        call  strcmp_nocase
        pop   ecx
        pop   ecx
        test  eax, eax
        jz    short loc_404515
        lea   eax, [esp+130h+var_128]
        push  eax
        mov   eax, IAT
        push  ebp
        call  dword ptr [eax+18h]
        */
        $code_1 = { ff [2-6] 8d [2-4] 50 e8 ?? ?? ?? ?? 59 59 85 c0 74 ?? 8d
        [3-5] 50 a1 ?? ?? ?? ?? 5? ff 50 18 85 c0 75 }
        /* Code from starting VA 0040590b:
        call  genRandom
        push  19h
        cdq
        pop   ecx
        idiv  ecx
        add   edx, 61h ; 'a'
        mov   [ebp+edi*2+0], dx
        inc   edi
        cmp   edi, esi
        jb    short loc_40590B
        */
        $code_2 = { e8 ?? ?? ?? ?? 6a 19 99 59 f7 f9 83 c2 61 66 89 54 7d 00
        47 3b fe 72 e8 }
        /* Code from starting VA 004051cc:
        xor   ebx, ebx
        push  1
        push  ebx
        call  dword ptr [eax+0C8h]
        mov   ecx, IAT
        mov   esi, eax
        call  dword ptr [ecx+0CCh]
        cmp   eax, 0B7h ; ''
        jnz   short loc_4051F9
        */
        $code_3 = { 33 ?? 6a 01 53 ff 9? ?? 00 00 00 8b ?? ?? ?? ?? ?? 8b f0
        ff 9? ?? 00 00 00 3d b7 00 00 00 75 ?? }
        /* Code from starting VA 00401e30:
        jz    short loc_401E45
        mov   edx, [ebp+a2]
        sub   ebx, edx
        mov   cl, [ebx+edx]
        xor   cl, 5Eh
        mov   [edx], cl
        inc   edx
        sub   esi, 1
        jnz   short loc_401E37
        */
        $code_4 = { 74 13 8B 55 0C 2B DA 8A 0C 13 80 F1 5E 88 0A 42 83 EE 01
        75 F2 }
        $string_1 = "Microsoft\\Windows\\Themes" ascii
        $string_2 = "dd.te" wide
        $string_3 = "Windows Live" ascii
        $string_4 = "WindowsAudio" ascii
        $string_5 = "DisableAntiSpyware" ascii
        $string_6 = "wusaupdate" wide
        $string_7 = "zyxwvutsrqponmlkjihgfedcba9876543210123456789abcdefghijklmnopqrstuvwxyz" ascii
        $string_8 = "SOFTWARE\\Policies\\Microsoft\\Windows Defender" ascii
        $string_9 = ".local.backup" ascii
    condition:
        all of ($code_*) and all of ($string_*) and filesize < 2MB and
        uint16(0) == 0x5A4D
}

rule CrowdStrike_CSIT_18122_02 : downloader mylobot unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects unpacked MyloBot Layer 1 samples"
        reports = "CSIT-18122"
        version = "201907050855"
        last_modified = "2019-07-05"
        malware_family = "MyloBot"
    strings:
        /* Code from starting VA 00401e30:
        jz    short loc_401E45
        mov   edx, [ebp+a2]
        sub   ebx, edx
        mov   cl, [ebx+edx]
        xor   cl, 5Eh
        mov   [edx], cl
        inc   edx
        sub   esi, 1
        jnz   short loc_401E37
        */
        $code_va_00401E30 = { 74 13 8B 55 0C 2B DA 8A 0C 13 80 F1 5E 88 0A 42
        83 EE 01 75 F2 }
        /* Code from starting VA 0040243f:
        lea   eax, [ebp+var_8]
        sldt  word ptr [eax]
        mov   eax, [ebp+var_8]
        */
        $code_va_0040243F = { 8D 45 F8 0F 00 00  8B 45 F8 }
        /* Code from starting VA 00401fd0:
        mov   eax, 1
        cpuid
        mov   [ebp+var_4], ecx
        mov   eax, [ebp+var_4]
        shr   eax, 1Fh
        */
        $code_va_00401FD0 = { B8 01 00 00 00 0F A2 89 4D FC 8B 45 FC C1 E8 1F }
        $string_1 = "wine_get_unix_file_name" ascii
        $string_2 = "ZwSetLdtEntries" ascii
        $string_3 = "/C sc stop wuauserv" ascii
        $string_4 = "/C sc config wuauserv start= disabled" ascii
        $string_5 = "/C Reg add \"HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows Defender\" /v DisableAntiSpyware /t REG_DWORD /d 1 /f" ascii
        $string_6 = "SOFTWARE\\Policies\\Microsoft\\Windows Defender" ascii
        $string_7 = "DisableAntiSpyware" ascii
        $string_8 = "/C netsh advfirewall firewall add rule name=\"blockport %d\" dir=out action=block protocol=TCP remoteport=%d" ascii
        $string_9 = "_tle@4" ascii
        $string_10 = "_tld@4" ascii
        $string_11 = "SAMPLE" wide
        $string_12 = "SANDBOX" wide
        $string_13 = "MALWARE" wide
        $string_14 = "\\drivers\\VBoxMouse.sys" wide
    condition:
        all of ($code_*) and 13 of ($string_*) and
        filesize < 2MB and
        uint16(0) == 0x5A4D
}

rule CrowdStrike_CSIT_18122_03 : mylopacker packer 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects MyloPacker samples. This packer is polymorphic and used for a number of malware families."
        reports = "CSIT-18122"
        version = "201808101324"
        last_modified = "2018-08-10"
        malware_family = "MyloPacker"
    strings:
        /*
        0x401ae7 ?? ?? ?? 0c movzx   ecx, byte ptr [ebp + 0xc]
        0x401aeb 0b c1   or  eax, ecx
        0x401aed 0f b6 55 08 movzx   edx, byte ptr [ebp + 8]
        0x401af1 f7 d2   not edx
        0x401af3 0f b6 4d 0c movzx   ecx, byte ptr [ebp + 0xc]
        0x401af7 f7 d1   not ecx
        */
        $code_1 = { 0c 0b c1 0f b6 55 08 f7 d2 0f b6 4d 0c f7 d1 }
        /*
        0x401d2f ?? c8   mov ecx, eax
        0x401d31 d3 fe   sar esi, cl
        0x401d33 0b de   or  ebx, esi
        0x401d35 88 5d ??  mov byte ptr [ebp + 0x55], bl
        */
        $code_2 = { c8 d3 fe 0b de 88 5d }
        /*
        0x401d46 83 e2 3c  and edx, 0x3c
        0x401d49 c1 fa 02  sar edx, 2
        0x401d4c 0b ca   or  ecx, edx
        0x401d4e 88 4d fa  mov byte ptr [ebp - 6], cl
        */
        $code_3 = { 83 e2 3c c1 fa 02 0b ca 88 4d fa }
        /* Code from starting VA 00401d31:
        sar   esi, cl
        or    ebx, esi
        mov   [ebp+var_2D], bl
        movzx   ecx, [ebp+var_8]
        and   ecx, 0Fh
        shl   ecx, 4
        movzx   edx, [ebp+var_5]
        and   edx, 3Ch
        sar   edx, 2
        or    ecx, edx
        mov   [ebp+var_6], cl
        movzx   eax, [ebp+var_5]
        and   eax, 3
        shl   eax, 6
        movzx   ecx, [ebp+var_11]
        and   ecx, 3Fh
        or    eax, ecx
        */
        $code_4 = { D3 FE 0B DE 88 5D D3 0F B6 4D F8 83 E1 0F C1 E1 04 0F B6 55
        FB 83 E2 3C C1 FA 02 0B CA 88 4D FA 0F B6 45 FB 83 E0 03 C1 E0 06 0F
        B6 4D EF 83 E1 3F 0B C1 }
        /* Code from starting VA 004017f2:
        mov   ecx, [eax+1D4h]
        mov   [ebp+var_10], ecx
        mov   edx, dword_40C7DC
        mov   eax, [edx+148h]
        mov   [ebp+var_14], eax
        mov   ecx, [ebp+var_10]
        mov   edx, [ebp+var_14]
        push  edx
        push  ecx
        push  ecx
        retn
        */
        $code_5 = { 8B 88 ?? ?? ?? ?? 89 4D F0 8B 15 ?? ?? ?? ?? 8B 82 ?? ??
        ?? ?? 89 45 EC 8B 4D F0 8B 55 EC 52 51 51 C3 }
        /* Code from starting VA 00401fd3:
        mov   ecx, [ebp+var_4]
        and   ecx, 1
        mov   edx, dword_40C7DC
        imul  ecx, [edx+84h]
        xor   eax, ecx
        mov   [ebp+var_4], eax
        jmp   short loc_401FB9
        */
        $encryption_1 = { 8B 4D FC 83 E1 01 8B 15 ?? ?? ?? ?? 0F AF 8A ?? ??
        ?? ?? 33 C1 89 45 FC EB }
        /* Code from starting VA 00401faa:
        mov   ecx, [ebp+var_4]
        shr   ecx, 1
        mov   edx, [ebp+var_4]
        and   edx, 1
        mov   eax, dword_40C7DC
        imul  edx, [eax+84h]
        xor   ecx, edx
        mov   [ebp+var_4], ecx
        jmp   short _
        */
        $encryption_2 = { 8B 4D FC D1 E9 8B 55 FC 83 E2 01 A1 ?? ?? ?? ?? 0F
        AF 90 ?? ?? ?? ?? 33 CA 89 4D FC EB }
        $resource = ".rsrc" ascii
        $string_1 = "QueryPerformanceCounter" ascii
        $string_2 = "GetProcAddress" ascii
        $string_3 = "GetSystemTimeAsFileTime" ascii
        $string_4 = "InitializeCriticalSectionAndSpinCount" ascii
        $string_5 = "GetCPInfo" ascii
    condition:
        $resource and
        all of ($code_*) and
        all of ($string_*) and
        any of ($encryption_*) and
        filesize < 2MB and
        uint16(0) == 0x5A4D
}

rule CrowdStrike_CSIT_18130_01 : module systeminfo trickbot 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Strings present in the TrickBot module systeminfo after decryption."
        reports = "CSIT-18130"
        version = "201810101305"
        last_modified = "2018-10-10"
        malware_family = "TrickBot"
    strings:
        $ = "Start"
        $ = "Control"
        $ = "Release"
        $ = "<moduleconfig>"
        $ = "<autostart>"
        $ = "GetSystemInfo.pdb"
        $ = "SELECT * FROM Win32_"
        $ = "<systeminfo>" wide
        $ = "<general>" wide
        $ = "<os>" wide
        $ = "<cpu>" wide
        $ = "<ram>" wide
        $ = "<users>" wide
        $ = "<installed>" wide
        $ = "<program>" wide
        $ = "<services>" wide
        $ = "<service>" wide
    condition:
        14 of them
}

rule CrowdStrike_CSIT_18130_02 : injectdll module trickbot 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Strings present in the TrickBot module injectDll after decryption."
        reports = "CSIT-18130"
        version = "201810101304"
        last_modified = "2018-10-10"
        malware_family = "TrickBot"
    strings:
        $ = "Start"
        $ = "Control"
        $ = "Release"
        $ = "<moduleconfig>"
        $ = "<autostart>"
        $ = "Chrome login db"
        $ = "Chrome history db"
        $ = "Skip Chrome login db"
        $ = "Skip Chrome history db"
        $ = "sbox_alternate_desktop" wide
    condition:
        8 of them
}

rule CrowdStrike_CSIT_18130_03 : module networkdll trickbot 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Strings present in the TrickBot module networkDll after decryption."
        reports = "CSIT-18130"
        version = "201810101303"
        last_modified = "2018-10-10"
        malware_family = "TrickBot"
    strings:
        $ = "Start"
        $ = "Control"
        $ = "Release"
        $ = "<moduleconfig>"
        $ = "<autostart>"
        $ = "SendReport"
        $ = "Report successfully sent"
        $ = "Dpost servers unavailable"
        $ = "/c ipconfig /all"
        $ = "/c net config workstation"
        $ = "/c net view /all"
        $ = "/c nltest /domain_trusts"
        $ = "<handler>" wide
        $ = "Arasfjasu7" wide
        $ = "SELECT * FROM Win32_OperatingSystem" wide
        $ = "***SYSTEMINFO***" wide
        $ = "***PROCESS LIST***" wide
        $ = "***LOCAL MACHINE DATA***" wide
    condition:
        15 of them
}

rule CrowdStrike_CSIT_18130_04 : mailsearcher module trickbot 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Strings present in the TrickBot module mailsearcher after decryption."
        reports = "CSIT-18130"
        version = "201810101303"
        last_modified = "2018-10-10"
        malware_family = "TrickBot"
    strings:
        $ = "Start"
        $ = "Control"
        $ = "Release"
        $ = "<moduleconfig>"
        $ = "<autostart>"
        $ = "Content-Disposition: form-data; name=\"list\""
        $ = "mailconf"
        $ = "%s/%s/%s/send/" wide
        $ = "Mozilla/5.0 (Windows NT 6.1; WOW64; rv:51.0) Gecko/20100101 Firefox/51.0" wide
        $ = "<handler>" wide
    condition:
        8 of them
}

rule CrowdStrike_CSIT_18130_05 : module sharedll trickbot 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Strings present in the TrickBot module shareDll after decryption."
        reports = "CSIT-18130"
        version = "201810101301"
        last_modified = "2018-10-10"
        malware_family = "TrickBot"
    strings:
        $ = "Start"
        $ = "Control"
        $ = "Release"
        $ = "<moduleconfig>"
        $ = "<autostart>"
        $ = "WormShare"
        $ = "Size - %d kB"
        $ = "templog.tmp" wide
        $ = "qwertyuiopasdfghjklzxcvbnm" wide
        $ = "stsvc.exe" wide
        $ = "Copy: %d" wide
        $ = "Create sc %d" wide
        $ = "Start sc %d" wide
        $ = "%s - SUCCESS" wide
        $ = "%s - FAIL" wide
        $ = "toler.png" wide
    condition:
        13 of them
}

rule CrowdStrike_CSIT_18130_06 : module trickbot wormdll 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Strings present in the TrickBot module wormDll after decryption."
        reports = "CSIT-18130"
        version = "202103190009"
        last_modified = "2021-03-19"
        malware_family = "TrickBot"
    strings:
        $ = "Start"
        $ = "Control"
        $ = "Release"
        $ = "<moduleconfig>"
        $ = "<autostart>"
        $ = "Size - %d kB"
        $ = "InfectMachine"
        $ = "worming.png" wide
        $ = "%s x64" wide
        $ = "%s x86" wide
        $ = "{001677D0-FD16-11CE-ABC4-02608C9E7553}" wide
        $ = "{00020404-0000-0000-C000-000000000046}" wide
        $ = "{109BA8EC-92F0-11D0-A790-00C04FD8D5A8}" wide
        $ = "(&(objectCategory=computer)(userAccountControl:1.2.840.113556.1.4.803:=8192))" wide
        $ = "*****MACHINE IN DOMAIN*****" wide
        $ = "*****MACHINE IN WORKGROUP*****" wide
    condition:
        13 of them
}

rule CrowdStrike_CSIT_18130_07 : importdll module trickbot 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Strings present in the TrickBot module importDll after decryption."
        reports = "CSIT-18130"
        version = "202103190009"
        last_modified = "2021-03-19"
        malware_family = "TrickBot"
    strings:
        $ = "Start"
        $ = "Control"
        $ = "Release"
        $ = "<moduleconfig>"
        $ = "<autostart>"
        $ = "CryptUnprotectData"
        $ = "grabber"
        $ = "getdata"
        $ = "Server: grabber"
        $ = "Trying browser communication... please wait"
        $ = "Getting cookies"
        $ = "Getting html5 local storage"
        $ = "Getting browser history"
        $ = "Getting flash lso files"
        $ = "firefox.exe" wide
        $ = "chrome.exe" wide
        $ = "iexplore.exe" wide
        $ = "microsoftedge.exe" wide
    condition:
        16 of them
}

rule CrowdStrike_CSIT_18130_08 : module tabdll trickbot 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Strings present in the TrickBot module tabDll after decryption."
        reports = "CSIT-18130"
        version = "202103190010"
        last_modified = "2021-03-19"
        malware_family = "TrickBot"
    strings:
        $ = "Start"
        $ = "Control"
        $ = "Release"
        $ = "<moduleconfig>"
        $ = "<autostart>"
        $ = "spreader\\Release\\screenLocker"
        $ = "ReflectiveLoader"
        $ = "[INJECT] inject_via_remotethread"
        $ = "Size - %d kB"
        $ = "InfectMachine"
        $ = "WormShare"
        $ = "%s/%s/%s/81/"
        $ = "table.png" wide
        $ = "End of Romance" wide
    condition:
        12 of them
}

rule CrowdStrike_CSIT_18144_01 : wicked_panda winnti 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects code and strings from WICKED PANDA's proxip implant."
        reports = "CSIT-18144"
        version = "202004291535"
        last_modified = "2020-04-29"
        actor = "WICKED PANDA"
        malware = "Proxip"
    strings:
        $lsd_hashing1 = { 41 0F BE 00 49 FF C0 D3 CA 03 D0 }
        $lsd_hashing2 = { D3 CA 41 0F BE 00 4D 03 C4 03 D0 45 2B D4 }
        $plugin_record_parsing = { 49 03 C4 41 03 EC 48 83 C1 20 48 83 F8 14 }
        $api_strings = "RtlDecompressBufCryptStringToBin"
    condition:
        uint16(0) == 0x5a4d and any of them
}

rule CrowdStrike_CSIT_18144_02 : wicked_panda winnti 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects shellcode in use by WICKED PANDA which has been LZNT1 compressed and base64 encoded."
        reports = "CSIT-18144"
        version = "201809281945"
        last_modified = "2018-09-28"
        actor = "WICKED PANDA"
    strings:
        $1 = "+bsASIPsKO"
    condition:
        filesize < 200KB and all of them
}

rule CrowdStrike_CSIT_18144_03 : proxip wicked_panda winnti 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects decoded strings in WICKED PANDA's Proxip malware."
        reports = "CSIT-18144"
        version = "202005121327"
        last_modified = "2020-05-12"
        actor = "WICKED PANDA"
        malware = "Proxip"
    strings:
        $5 = "_CbConnect Over"
        $6 = "ikcp_udprecv"
        $9 = "Proxip:%s"
        $10 = "Proxport:%d"
        $11 = "CurProxIp:%s"
        $12 = "CurProxPort:%d"
        $13 = "IeProxy ip:%s,port:%d,type:%d"
        $kernel32_enc = { 59 5B 50 5E 5D 59 5D 50 5B 50 }
    condition:
        filesize < 5MB and any of them
}

rule CrowdStrike_AdLoad : adload adware macos 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects the AdLoad adware family targeting MacOS platforms"
        version = "202003102059"
        last_modified = "2020-03-10"
        malware_family = "AdLoad"
    strings:
        $http_header1 = "application/x-www-form-urlencoded" fullword
        $http_header2 = "Accept: */*\x0D\x0A" fullword
        $http_header3 = "Connection: close\x0D\x0A\x0D\x0A" fullword
        $http_stack = { 48 b9 20 48 54 54 50 2f 31 2e 48 89 0e }
        $format_str1 = "_Tt%c%zu%.*s%zu%.*s%s" fullword
        $format_str2 = "_Tt%cSs%zu%.*s%s" fullword
        $format_str3 = "%4d-%2d-%2dT%2d:%2d:%2dZ" fullword
        $format_str4 = "%.*s.%.*s" fullword
        $iodata1 = "IOPlatformSerialNumber" fullword
        $iodata2 = "IOMACAddress" fullword
        $iodata3 = "IOEthernetInterface" fullword
        $iodata4 = "IOPrimaryInterface" fullword
        $iodata5 = "IOPropertyMatch" fullword
        $iodata6 = "IOService" fullword
        $b64alph = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/" fullword
    condition:
        3 of ($format_*) and
        3 of ($http_*) and
        5 of ($io*) and $b64alph
        and uint32(0)==0xFEEDFACF
        and filesize < 2MB
}

rule CrowdStrike_CSIT_18130_09 : generic module trickbot 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Strings present in a TrickBot module after decryption."
        reports = "CSIT-18130"
        version = "202103182355"
        last_modified = "2021-03-18"
        malware_family = "TrickBot"
    strings:
        $base1 = "Start"
        $base2 = "Control"
        $base3 = "Release"
        $base4 = "<moduleconfig>"
        $conf1 = "<autostart>"
        $conf2 = "<nohead>yes</nohead>"
        $conf3 = "<needinfo name="
    condition:
        uint16(0) == 0x5a4d and (all of ($base*) and any of ($conf*))
}

rule CrowdStrike_CSIT_18148_01 : cve_2017_8291 exploit labyrinth_chollima velvet_chollima 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects exploit code targeting CVE-2017-8291 in GhostScript included in EPS of HWP files. This technique has been used by LABYRINTH CHOLLIMA AND VELVET CHOLLIMA."
        reports = "CSIT-18148"
        version = "201906211135"
        last_modified = "2019-06-21"
        actor = "VELVET CHOLLIMA, LABYRINTH CHOLLIMA"
        malware = "Milmanbag, Manuscrypt, HtDnLoader"
    strings:
        $vp_1 = "(VirtualProtect)"
        $vp_2 = "5669727475616C50726F74656374"
        $ex = "(ExitProcess)"
        $hex = "<94C3>"
        $code = "<C20C00>"
        $f_1 = "1 currentfile put"
        $f_2 = "312063757272656E7466696C6520707574"
        $cl_1 = "1 get closefile"
        $cl_2 = "636C6F736566696C65"
        $eq_1 = ".eqproc"
        $eq_2 = "202E657170726F6320"
    condition:
        all of ($vp_1,$f_1,$cl_1,$eq_1) or
        all of ($vp_2,$f_2,$cl_2,$eq_2) and
        all of ($ex,$hex,$code)
}

rule CrowdStrike_CSIT_18126_01 : ransomware hermes unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects Hermes Ransomware"
        reports = "CSIT-18126"
        version = "201808170752"
        last_modified = "2018-08-17"
        malware_family = "Hermes Ransomware"
    strings:
        $key = "USERUNIQUE" wide
        $log = "hrmlog" wide
        $ignore = "AhnLab" wide
        $regkey = "SYSTEM\\CurrentControlSet\\Control\\Nls\\Language"
    condition:
        all of them
}

rule CrowdStrike_CSIT_18126_02 : generic vbscript crypter 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects VB cryptor used by Hermes and Azorult"
        reports = "CSIT-18126"
        version = "201808170752"
        last_modified = "2018-08-17"
    strings:
        $key = { d0 d9 d0 d9 d0 d9 d0 d9 d0 d9 d0 d9 d0 d9 d0 d9 d0 81 34 08 ?? ?? ?? ?? e8 3b ff ff ff }
        $vb = "MSVBVM60.DLL"
    condition:
        all of them
}

rule CrowdStrike_Sofacy_XorKey : fancy_bear sofacy rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "XOR key used in Sofacy malware"
        version = "201808241530"
        last_modified = "2018-08-24"
        actor = "FANCY BEAR"
        malware_family = "Sofacy"
    strings:
        $ = { 58 cf 4a ff cc bf 3d fa }
    condition:
        any of them
}

rule CrowdStrike_CSA_18670_01 : labyrinth_chollima jeus trojan 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects RC4 key used in fake updater packaged with Bitcoin exchange application (Windows and OSX)"
        reports = "CSA-18670"
        version = "201808301926"
        last_modified = "2018-08-30"
        actor = "LABYRINTH CHOLLIMA"
        malware_family = "Jeus"
    strings:
        $ = "W29ab@ad%Df324V$Yd"
    condition:
        all of them
}

rule CrowdStrike_CSA_18670_02 : labyrinth_chollima jeus trojan 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects an XOR key used in a fake updater packaged with a Bitcoin exchange application (Windows and OSX). The malware is potentially in use by LABYRINTH CHOLLIMA."
        reports = "CSA-18670"
        version = "201808301926"
        last_modified = "2018-08-30"
        actor = "LABYRINTH CHOLLIMA"
        malware_family = "Jeus"
    strings:
        $ = { 4d 6f 7a 26 57 69 65 3b 23 74 2f 36 54 21 32 79 }
    condition:
        all of them
}

rule CrowdStrike_JSP_Webshell : jsp script webshell 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects a webshell written in JSP. It may hit on a variety of different webshells, including, JSPRAT and Kenn's JSP webshell."
        version = "201808241551"
        last_modified = "2018-08-24"
        malware = "JSP Webshell"
    strings:
        $ = "&fsAction="
        $ = "&fileName="
        $ = "File is already exist"
        $ = "File can not be writed\""
        $ = "?action=getscreen"
        $ = "?action=lang&lang=ENG"
        $ = "?action=lang&lang=CHN"
        $ = "?action=file&curPath="
    condition:
        2 of them
}

rule CrowdStrike_Chebri_Proxy : chebri proxy 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects a connection forwarder / proxy tool which AV signatures refer to as Chebri."
        version = "201903151054"
        last_modified = "2019-03-15"
        malware_family = "Chebri"
    strings:
        $s1 = "WS2_32.dll"
        $s2 = "LocalAlloc"
        $s3 = "LocalFree"
        // Code to send a Chebri protocol message
        $msgsend = { 55 8b ec 83 ec 08 8b 45 0c 89 45 f8 c6 45 fc ?? 8a 4? 10 88 4? fd 6a 06 8d ?? f8 ?? 8b 45 08 50 e8 ?? ?? ?? ?? 83 c4 0c 8b e5 5d c3 }
        // Custom code to append to a singly linked list
        $op_listadd = { 55 8b ec 8b 4? 0c 8b 4? 08 8b 1? 89 1? 8b 4? 08 8b 4? 0c 89 ?? 8b 4? 0c 5d c3 }
        // Indirectly invoked memory allocation and free operations
        $op_listfree = { 8b 45 10 50 ff 55 08 8b 45 fc 8b e5 5d c3 }
        $op_allocate = { 55 8b ec 51 8b 45 0c 50 6a 40 ff 55 08 89 45 fc 8b 45 fc 8b e5 5d c3 }
    condition:
        all of ($s*) and $msgsend and 2 of ($op*)
}

rule CrowdStrike_CSIT_18187_01 : fancy_bear proxy xtunnel 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Matches on string fragments of X-Tunnel .NET variant"
        reports = "CSA-17342,CSIT-18187"
        version = "201812071846"
        last_modified = "2018-12-07"
        actor = "FANCY BEAR"
        malware_family = "X-Tunnel"
    strings:
        $ = "TunnelCrypt_"
        $ = ".NETFramework,Version=v4."
    condition:
        all of them
}

rule CrowdStrike_CSIT_18187_02 : fancy_bear proxy xtunnel 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Matches on file names of X-Tunnel .NET variant"
        reports = "CSA-17342,CSIT-18187"
        version = "201812071846"
        last_modified = "2018-12-07"
        actor = "FANCY BEAR"
        malware_family = "X-Tunnel"
    strings:
        $ = "Channeling.dll"
        $ = ".NETFramework,Version=v4."
    condition:
        all of them
}

rule CrowdStrike_CSIT_18148_03 : velvet_chollima milmanbag naver rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects the decoding algorithm in Attack-spy and Naver variants of Milmanbag implant."
        reports = "CSIT-18148"
        version = "201810051017"
        last_modified = "2018-10-05"
        actor = "VELVET CHOLLIMA"
        malware_family = "Milmanbag"
    strings:
        $decode1 = { 03 c7 89 45 9c 8b c3 99 f7 7d 9c 81 e2 01 00 00 80 79 05 4a 83 ca fe 42 }
        $decode2 = { c6 01 01 39 45 a4 7d 15 99 8d 1c 0e f7 fb 81 e2 01 00 00 80 }
    condition:
        any of them
}

rule CrowdStrike_CSIT_18148_02 : velvet_chollima milmanbag naver rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects the Naver variant of Milmanbag implant"
        reports = "CSIT-18148"
        version = "201810051015"
        last_modified = "2018-10-05"
        actor = "VELVET CHOLLIMA"
        malware_family = "Milmanbag"
    strings:
        $n1 = "NaverDown : Login_RecvNId_T failed. Try[%d]"
        $n2 = "NaverDown : MailDownload success"
        $n3 = "NaverUpload Start!!"
        $n4 = "&reserveDate=&reserveGMT=&reserveTime=&calendarVal="
        $n5 = "&sendSeparately=false&saveSentBox=true&type=new&fromMe=0&attachID"
        $n6 = "NaverUpload : Login_PostPWDpage success"
    condition:
        3 of them
}

rule CrowdStrike_CSIT_19027_02 : banking gozi isfb trojan unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects the dropper for ISFB/Gozi/Ursnif with a packed client DLL."
        reports = "CSIT-19027"
        version = "202002192350"
        last_modified = "2020-02-19"
        malware_family = "ISFB,Gozi"
    strings:
        $inst1 = { d3 c0 83 c7 04 33 c6 33 c3 8b f0 }
        $inst2 = { 33 c3 33 45 0c 83 c7 04 }
        $inst3 = { 6B D2 28 81 F1 [4] 0F B7 C9 }
        $bss1 = { 8d 7d ?? ab 66 ab 6a 08 aa 68 [4] 8d ?? ?? 5? }
        $bss2 = { 8d 7d ?? a5 a5 a5 8b 4? ?? 33 4? f? }
        $bss3 = ".bss"
    condition:
        1 of ($inst*) and
        2 of ($bss*) and
        filesize < 150KB
}

rule CrowdStrike_CSIT_18141_01 : ransomware ryuk wizard_spider 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects different versions of Ryuk"
        reports = "CSIT-18141,CSIT-20049"
        version = "202003191901"
        last_modified = "2020-03-19"
        actor = "WIZARD SPIDER"
        malware_family = "Ryuk"
    strings:
        $key = { 6c 54 47 67 5f 00 00 00 00 }
        $rsa_header = { 06 02 00 00 00 a4 00 00 52 53 41 31 }
        $hrmlog = "hrmlog" wide
        $auto_a = { 76 0a 47 33 f6 32 db fe c1 88 4d }
        $auto_b = { 32 c9 32 ed fe c7 88 7d }
        $auto_c = { 6a 0a 8a 4f 03 0f b6 07 8a 5f 01 8a 7f 02 88 4d }
        $decoder_64bit = {4C 8B D1 41 8A 02 45 03 CB 41 28 00 4D 8D 52 04 4D 03 C3 41 83 F9 10 72 EA }
        $str = "LookupPrivilegeValue error: %u"
    condition:
        ($key and $rsa_header and $hrmlog) or (all of ($auto_*) and not $str) or $decoder_64bit
}

rule CrowdStrike_CSIT_19105_02 : banking gozi isfb rm3 trojan unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects the unpacked RM3 Loader (ISFB variant) first stage executable"
        reports = "CSIT-19105"
        version = "202101051208"
        last_modified = "2021-01-05"
        malware_family = "RM3 Loader"
    strings:
        $inst1 = { 33 c6 33 ?? ?? ?? 8a cb c0 e1 03 d3 c8 83 f3 01 }
        $inst2 = { 4f f7 d7 23 c7 ?? ?? ?? ?? 4a f7 d2 23 fa 3b f8 }
        $inst3 = { C? E? 02 E8 [4] D? C? 83 F3 01 }
        $tags1 = { ?c 00 00 00 57 44 02 00 }
        $ep = { 56 6a 00 ff 15 [4] 6a 00 68 00 00 40 00 6a 00 }
        $find_cfg = { 66 81 7a 04 57 44 75 ?? }
        $find_cfg1 = { B? 57 44 00 00 6? 39 4? 04 75 ?? }
        $bss_dec = { 4f f7 d7 23 c7 8d 7c 13 ff 4a }
    condition:
        (2 of ($inst*) and 1 of ($tags*)) or
        4 of them
}

rule CrowdStrike_CSIT_18142_01 : backswap banking 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects the BackSwap Banking Trojan decryptor stub"
        reports = "CSIT-18142,CSIT-18156"
        version = "201810191227"
        last_modified = "2018-10-19"
        malware_family = "BackSwap"
    strings:
        $payload_decryption = { 58 68 [4] 5? 31 c9 89 cb 6a 04 5a 68 [4] 5? ff 30 59 0f c9 43 31 d9 81 f9 [4] 68 [4] 5? 75 ea 0f cb b9 [2] 00 00 01 d0 31 18 68 [4] 5? e2 f4 2d [2] 00 00 ff e0 }
    condition:
        $payload_decryption
}

rule CrowdStrike_CSIT_18142_02 : backswap banking 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects API hashes of the BackSwap Banking Trojan"
        reports = "CSIT-18063,CSIT-18142,CSIT-18156"
        version = "201810220655"
        last_modified = "2018-10-22"
        malware_family = "BackSwap"
    strings:
        // api hashes
        $apihash_1 = { 00 FB ED E6 FE }
        $apihash_2 = { 00 BE 81 5D 52 }
        $apihash_3 = { 00 70 BF 3C 83 }
        $apihash_4 = { 00 03 C3 57 11 }
        $apihash_5 = { 00 D5 C7 1E CA }
        $apihash_6 = { 00 32 FC 17 9B }
        $apihash_7 = { 00 46 AF 06 01 }
        $apihash_8 = { 00 89 B3 BA 9F }
        $apihash_9 = { 00 21 D1 01 98 }
        $apihash_10 = { 00 5A EB AF 52 }
        $apihash_11 = { 00 D9 E0 95 01 }
        $apihash_12 = { 00 43 F0 42 C5 }
        $apihash_13 = { 00 59 F0 42 C5 }
        $apihash_14 = { 00 65 DA 2D 31 }
        $apihash_15 = { 00 9B 34 0D 98 }
        $apihash_16 = { 00 5A 41 43 AF }
        $apihash_17 = { 00 70 41 43 AF }
        $apihash_18 = { 00 2B CC 68 F2 }
        $apihash_19 = { 00 60 A7 50 94 }
        $apihash_20 = { 00 9D 86 DF 8B }
        $apihash_21 = { 00 DF 3C 6D E4 }
        $apihash_22 = { 00 64 41 D3 7E }
        $apihash_23 = { 00 7A 41 D3 7E }
        $apihash_24 = { 00 AB 10 4B 69 }
        $apihash_25 = { 00 18 1D C2 F1 }
        $apihash_26 = { 00 0E D4 24 A7 }
        $apihash_27 = { 00 95 52 58 F2 }
        $apihash_28 = { 00 6F 6D C7 FE }
        $apihash_29 = { 00 7B 4F 09 BB }
        $apihash_30 = { 00 30 16 3C B7 }
        $apihash_31 = { 00 18 D7 D3 CA }
        $apihash_32 = { 00 11 C8 FE 6D }
        $apihash_33 = { 00 1C 15 E5 EC }
        $apihash_34 = { 00 62 15 84 5F }
        $apihash_35 = { 00 4D 0E 50 AD }
        $apihash_36 = { 00 5B 39 1E 37 }
        $apihash_37 = { 00 8D 91 F8 12 }
        $apihash_38 = { 00 7D 90 C2 F1 }
        $apihash_39 = { 00 17 D3 7A 71 }
        $apihash_40 = { 00 EB 7D E6 25 }
        $apihash_41 = { 00 E5 D4 52 91 }
        $apihash_42 = { 00 B2 CA C2 95 }
        $apihash_43 = { 00 E8 93 E3 34 }
        $apihash_44 = { 00 53 95 E2 87 }
        $apihash_45 = { 00 CE 4B E9 04 }
        $apihash_46 = { 00 F2 D9 24 F8 }
        $apihash_47 = { 00 4C 83 AC 2B }
        $apihash_48 = { 00 D5 F9 06 02 }
        $apihash_49 = { 00 E9 97 1E 37 }
        $apihash_50 = { 00 F4 4A 22 D6 }
        $string_browser = "Mozilla/5.0" ascii
        $string_bitcoin = "Bitcoin" ascii
    condition:
        any of ($string_*) and 15 of ($apihash_*)
}

rule CrowdStrike_CSA_18705_01 : artifact downloader fancy_bear zekapab 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Matches on PDB path in .NET variant of FANCY BEAR malware MiniZekapab"
        reports = "CSA-18705,CSIT-18143"
        version = "202008052223"
        last_modified = "2020-08-05"
        actor = "FANCY BEAR"
        malware_family = "MiniZekapab,Zekapab"
    strings:
        $ = "dmscpl\\dmscpl\\obj\\"
        $ = "\\Release\\dmscpl.pdb"
        $ = "C:\\Users\\_01_\\Documents\\Visual Studio 2013\\Projects\\WindowsApplication1"
    condition:
        any of them
}

rule CrowdStrike_CSA_18705_02 : fancy_bear zekapab downloader artifact 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Matches on .NET assembly of sleep method used in in .NET variant of FANCY BEAR malware MiniZekapab"
        reports = "CSA-18705"
        version = "201809272100"
        last_modified = "2018-09-27"
        actor = "FANCY BEAR"
        malware_family = "DmsCpl, Zekapab"
    strings:
        $ = { 73 5c 00 00 0a 1f 0c 1f 1a 6f 5d 00 00 0a 20 e8 03 00 00 5a 28 5e 00 00 0a }
    condition:
        all of them
}

rule CrowdStrike_CSIT_19029_03 : rat rbdoor wicked_panda 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects an xor-routine found in RbDoor malware in use by WICKED PANDA."
        reports = "CSIT-19029"
        version = "201903011635"
        last_modified = "2019-03-01"
        actor = "WICKED PANDA"
        malware_family = "RbDoor"
    strings:
        $ = {
        41 0F B6 11
        41 FF C2
        49 FF C1
        80 F2 ??
        0F B6 C2
        C0 EA 04
        C0 E0 04
        02 C2
        41 88 41 FF
        44 3B 56 0E
        }
    condition:
        any of them
}

rule CrowdStrike_FANCY_BEAR_CppDown_02 : cppdown downloader fancy_bear 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Matches on encoded C2 information in CppDown malware loaded by .NET variant of Zekapab"
        reports = "CSA-18705,CSIT-18165"
        version = "201811061854"
        last_modified = "2018-11-06"
        actor = "FANCY BEAR"
        malware_family = "CppDown"
    strings:
        $c2_info = {
        C7 45 A4 58 53 59 53 C7  45 A8 51 53 65 52 C7 45
        AC 56 53 50 53 C7 45 B0  51 53 65 52 C7 45 B4 59
        53 54 53 C7 45 B8 52 53  65 52 C7 45 BC 55 53 54
        53
        }
    condition:
        $c2_info
}

rule CrowdStrike_FANCY_BEAR_CppDown_03 : cppdown downloader fancy_bear 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Matches on sleep methods in CppDown malware dropped by .NET variant of Zekapab"
        reports = "CSA-18705,CSIT-18165"
        version = "201811061855"
        last_modified = "2018-11-06"
        actor = "FANCY BEAR"
        malware_family = "CppDown"
    strings:
        $sleep = {
        E8 67 63 00 00 99 B? 2C 01 00 00 F7 F? 8B 35 0C
        A0 ?? 00 42 69 D? E8 03 00 00 52 FF D6
        }
    condition:
        $sleep
}

rule CrowdStrike_CSIT_18185_01 : azorult infostealer stealer 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects version 3 of the Azorult information stealing malware"
        reports = "CSIT-17176,CSIT-18185"
        version = "202002251656"
        last_modified = "2020-02-25"
        malware_family = "Azorult"
    strings:
        $s_1 = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/" ascii
        $s_2 = "Coins\\Jaxx\\Local Storage\\" wide
        $s_3 = "TSwdPwd" ascii
        $s_4 = "TPwdArray" ascii
        $s_5 = "http://ip-api.com/json" ascii
        $s_6 = "D877F783D5*,map*" wide
        $s_7 = "mbhd.wallet.aes,mbhd.checkpoints,mbhd.spvchain,mbhd.yaml" wide
        $s_8 = "RGlzcGxheVZlcnNpb24=" ascii
        $code_string_decryption_1 = { 8b 55 fc 8b 4d f4 8a 54 0a ff 8b 4d f8 8a 4c 19 ff 32 d1 e8 [4] 8b 55 ec 8b c7 e8 [4] 43 3b 5d f0 7e 05 bb 01 00 00 00 }
        $code_string_decryption_2 = { 8b 55 fc 8b 12 8a 54 32 ff 8b 4d f8 8a 4c 19 ff 32 d1 88 54 30 ff 43 3b 5d f4 7e 05 bb 01 00 00 00 }
    condition:
        6 of ($s_*) and any of ($code_string_decryption_*)
}

rule CrowdStrike_Perl_IRC_Shellbot : shellbot bot script 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects a Perl script which communicates over IRC and is used primarily to execute commands on the victimized host."
        version = "201809071331"
        last_modified = "2018-09-07"
        malware = "Shellbot"
    strings:
        $ = "@titi"
        $ = "@canais"
        $ = "Problema com o fork: "
        $ = "$comando 2>&1 3>&1"
        $ = "PRIVMSG $printl :$linha"
        $ = "ctcpfloood"
    condition:
        2 of them
}

rule CrowdStrike_CSIT_18201_02 : banking bokbot trojan unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects an unpacked copy of core BokBot component instructions."
        reports = "CSIT-18201"
        version = "201812281549"
        last_modified = "2018-12-28"
        malware_family = "BokBot"
    strings:
        $shift_key = { d1 c8 f7 d0 d1 c8 2d 20 01 00 00 d1 c0 f7 d0 2d 01 91 00 00 }
        $crypto = { 33 d2 8b c8 6a 1a 5d f7 f5 83 c2 61 }
        $rc4 = { 02 c1 0f b6 c0 8a 84 05 fc fe ff ff 30 04 32 42 }
    condition:
        1 of them
}

rule CrowdStrike_LeftProjectPowerShellDropper_01 : powershell dropper carbon_spider 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule matches on a PDB path of a malicious Powershell dropper application in use by CARBON SPIDER."
        version = "201809071331"
        last_modified = "2018-09-07"
        actor = "CARBON SPIDER"
    strings:
        $ = "o:\\left_projects\\"
        $ = "\\DropperPowerShell\\"
        $ = "ExecPSData\\obj\\Release\\ExecPSData.pdb"
    condition:
        any of them
}

rule CrowdStrike_CSA_18179_01 : backdoor facade venomous_bear 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects VENOMOUS BEAR's Facade Email Client Backdoor"
        reports = "CSA-18179,CSIT-19076,CSIT-19227"
        version = "202106171525"
        last_modified = "2021-06-17"
        actor = "VENOMOUS BEAR"
        malware_family = "Facade"
    strings:
        // CLSIDs
        $ = { 92 0A DA 84 E0 25 D3 11  B9 F7 00 C0 4F 4C 8F 5D }
        $ = { C7 B1 CB 49 D1 97 5A 48  9E C1 A2 60 65 63 30 66 }
    condition:
        all of them
}

rule CrowdStrike_CSIT_18201_01 : banking bokbot trojan unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects an unpacked copy of the BokBot loader in memory."
        reports = "CSIT-18201"
        version = "201812281548"
        last_modified = "2018-12-28"
        malware_family = "BokBot"
    strings:
        $inst1 = { C1 C9 0D 0F BE C0 03 C8 46 }
        $inst2 = { 04 24 05 CB 49 8B 44 48 }
        $inst3 = { 81 E2 FF 0F 00 00 81 E7 00 F0 00 00 }
        $inst4 = { 8B 45 0C 89 45 FC 8B 45 0C 48 89 45 0C 83 7D FC 00 74 0F 8B 45 08 C6 00 00 8B 45 08 40 89 45 08 EB DE }
        $inst5 = { 8B 14 AB 33 C0 03 D1 8A 0A 84 C9 8B 4C 24 24 74 1F 8B C8 8A 02 }
    condition:
        2 of ($inst*)
}

rule CrowdStrike_CSIT_18153_01 : infostealer kpot unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects unpacked instances of the KPot information stealer malware."
        reports = "CSIT-18153,CSIT-19072"
        version = "202006011410"
        last_modified = "2020-06-01"
        malware_family = "KPot Stealer"
    strings:
        $op1 = { 25 ad 58 3a ff c1 e0 07 33 c8 8b c1 25 8c df ff ff c1 e0 0f 33 c8 8b c1 c1 e8 12 33 c1}
        $op2 = { 69 ?? 0b a3 14 00 05 af 8a bd 96 }
        $op3 = { 04 c0 e2 02 0a ca 88 4d fc 8a 4d f6 8a d1 c0}
    condition:
        uint16(0) == 0x5a4d and filesize < 500KB and all of them
}

rule CrowdStrike_CSIT_19068_01 : loader taurus venom_spider 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects the Taurus Loader document DLL JavaScript COM backdoor."
        reports = "CSIT-19068,CSIT-19198"
        version = "202012141415"
        last_modified = "2020-12-14"
        actor = "VENOM SPIDER"
        malware_family = "Taurus Loader"
    strings:
        $tryblock_a = { 0f b7 47 02 83 c7 02 83 f8 30 72 }
        $aesblock_b = { c1 e2 08 33 d0 0f b6 59 08 0f }
        $xorblock_c = { 33 5c 24 20 }
    condition:
        filesize < 5MB and int32(0) == 0x905a4d and $tryblock_a and $aesblock_b and $xorblock_c
}

rule CrowdStrike_CSIT_18154_02 : delivery_document taurus 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects Taurus Loader documents."
        reports = "CSIT-18154"
        version = "202103152346"
        last_modified = "2021-03-15"
        malware_family = "Taurus"
    strings:
        $start = { d0 cf 11 e0 a1 b1 1a e1 }
        $a_MacroEntry = "f_Layout"
        $b_MacroEntry = "s__GotFocus"
        $b_MacroObfuscatedCall = "CallByName"
        $c_DocumentAuthor = "Admin"
    condition:
        $start at 0 and
        ($a_MacroEntry or $b_MacroEntry) and
        $b_MacroObfuscatedCall and
        $c_DocumentAuthor
}

rule CrowdStrike_ExchangeProxy_01 : backdoor exchangeproxy proxy trojan 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects a backdoor which retrieves payload and tasking from an Exchange Web Services account."
        version = "201903151054"
        last_modified = "2019-03-15"
        malware_family = "ExchangeProxy"
    strings:
        // call to random string generation
        $r = {
        02
        1F 0?
        (16 | 17)
        (16 | 17)
        (16 | 17)
        (16 | 17)
        28 ??0000??
        }
        // routine that writes length prefix
        $w = {
        04
        28 ??0000??
        0A
        1A
        8D ??0000??
        0B
        03
        06
        1A
        07
        7E ??0000??
        28 ??0000??
        2A
        }
        $s1 = "NEWVERSION:" wide fullword
        $s2 = "subject:STOC:" wide fullword
        $s3 = "<body>\x0d\x0a.+\x0d\x0a</body>" wide fullword
        $s4 = "\\\\.\\pipe\\" wide fullword
        $s5 = "https://outlook.office365.com/EWS/Exchange.asmx" wide fullword
        $s6 = "CTOS:" wide fullword
    condition:
        $r and $w and 2 of ($s*)
}

rule CrowdStrike_ExchangeProxy_02 : backdoor exchangeproxy proxy trojan 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects the XOR key used in several ExchangeProxy samples. ExchangeProxy is a backdoor which retrieves payload and tasking from an EWS account."
        version = "201903151054"
        last_modified = "2019-03-15"
        malware_family = "ExchangeProxy"
    strings:
        $ = { 01 03 06 3f 05 07 03 02 08 41 00 00 }
    condition:
        all of them
}

rule CrowdStrike_CSIT_18146_01 : zeroevil infostealer downloader loader unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Identifies strings characteristic of unpacked ZeroEvil samples"
        reports = "CSIT-18146"
        version = "201810050845"
        last_modified = "2018-10-05"
        malware_family = "ZeroEvil"
    strings:
        $1 = "ze_core.DLL"
        $2 = "ze_autorun.DLL"
        $3 = "logs_gate.php"
        $4 = "ProcessList.txt"
        $5 = "Software\\ZeroEvil"
        $6 = "HWID_ERROR_HWID_ERROR_HWI"
    condition:
        all of them
}

rule CrowdStrike_AmberDropper_01 : amber dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects Amber dropper executables"
        version = "201809281951"
        last_modified = "2018-09-28"
        malware = "AmberDropper"
    strings:
        $ = "<Amber:27a01d4772038a3f83552908e0470604e773f8af>"
        $ = "GCC: (GNU) "
    condition:
        all of them
}

rule CrowdStrike_CSA_18775_01 : linux rat wicked_panda winnti 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects configuration decoder and distinctive string found in Winnti ELF executables."
        reports = "CSA-18775"
        version = "202008151111"
        last_modified = "2020-08-15"
        actor = "WICKED PANDA"
        malware_family = "Winnti"
    strings:
        $guid_string = "EAEC2CA4-AF8D-4F61-8115-9EC26F6BF4E1"
        $config_decode = { 0f b6 00 89 c1 8b 45 f8 89 c6 8b 45 fc 01 f0 31 c8 88 02 83 45 fc 01 }
    condition:
        all of them
}

rule CrowdStrike_CSA_18792_01 : aesloader backdoor venomous_bear 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects VENOMOUS BEAR's AesLoader Tool"
        reports = "CSA-18792"
        version = "202001200925"
        last_modified = "2020-01-20"
        actor = "VENOMOUS BEAR"
        malware_family = "AesLoader"
    strings:
        // Characteristic x64 bytecode in main function
        $ = { 0f b6 41 80 48 83 c1 04 30 41 fc }
    condition:
        all of them
}

rule CrowdStrike_FANCY_BEAR_CppDown_01 : cppdown downloader fancy_bear 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule matches on obfuscated string fragments assembled on the stack in FANCY BEAR's CppDown downloader."
        reports = "CSIT-18165"
        version = "201811061853"
        last_modified = "2018-11-06"
        actor = "FANCY BEAR"
        malware = "CppDown"
    strings:
        $ = { C7 85 ?? FF FF FF 47 4c 4a 4c }
        $ = { C7 85 ?? FF FF FF 59 47 4c 4c }
        $ = { C7 85 ?? FF FF FF 4c 4c 4c 4c }
        $ = { C7 85 ?? FF FF FF 59 47 4d 4c }
        $ = { C7 45 ??          45 4c 4e 4c }
    condition:
        all of them
}

rule CrowdStrike_FancyBear_LoJax_InfoEfi : fancy_bear benign lojack 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule matches on a debugging script in a helper executable to read UEFI info."
        version = "201809281944"
        last_modified = "2018-09-28"
    strings:
        $ = "Erorr Get parameters."
        $ = "Can not get address EFI boot script. Error = %x"
        $ = "{AF9FFD67-EC10-488A-9DFC-6CBF5EE22C2E}" wide
    condition:
        all of them
}

rule CrowdStrike_CSIT_18154_01 : downloader javascript loader script 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects Taurus Loader JScript COM scriptlets."
        reports = "CSIT-18154"
        version = "201904250938"
        last_modified = "2019-04-25"
        malware_family = "Taurus Loader"
    strings:
        $tryblock_a = ";try {new"
        $tryblock_b = ";} catch"
        $tryblock_c = ";}catch ("
        $tryblock_d = "{try {"
        $endtry_a = "));}}}}}}}}}}}}}"
        $endtry_b = "\";try{ "
    condition:
        all of ($tryblock_*) or
        all of ($endtry_*)
}

rule CrowdStrike_CSA_18749_01 : chrome_extension script 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects a compressed version of the Auto Font Manager malicious Chrome extension reported in CSA-18749"
        reports = "CSA-18749,CSA-18796,CSIT-19018"
        version = "201901242020"
        last_modified = "2019-01-24"
        actor = "VELVET CHOLLLIMA"
        malware_family = "Malicious Chrome Extension Cookie Stealer"
    strings:
        $s_filename = "manage.jsPK"
        $header = "Cr24"
        $s_sunset_38 = "sunset-38.png"
        $s_night_38 = "night-38.png"
    condition:
        $header at 0 and all of ($s*)
}

rule CrowdStrike_AutoFont_MaliciousChromeExtension_Javascript_v5 : chromeextension script 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule looks for a malicious Javascript file found inside a malicious Chrome extension documented in CSA-18749 and CSA-18796."
        reports = "CSA-18749,CSA-18796,CSIT-19018"
        version = "201901242018"
        last_modified = "2019-01-24"
        actor = "VELVET CHOLLIMA"
        malware_family = "Malicious Chrome Extension Cookie Stealer"
    strings:
        $rid = ",r.id=i,r.src=\"https://"
        $append_to_head = ",document.getElementsByTagName(\"head\")[0].appendChild(r)"
    condition:
        all of them
}

rule CrowdStrike_AutoFont_MaliciousChromeExtension_Javascript_v3_v4 : javascript script 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule looks for a malicious Javascript file found inside a malicious Chrome extension documented in CSA-18749 and CSA-18796."
        reports = "CSA-18749,CSA-18796"
        version = "202011240002"
        last_modified = "2020-11-24"
    strings:
        $charcode = "r.charCodeAt(e-1)!==95||r.charCodeAt(e-2)!==95"
    condition:
        $charcode
}

rule CrowdStrike_AutoFont_MaliciousChromeExtension_Stage2_JS : javascript script 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects the follow-on Javascript downloaded by a malicious Chrome extension. It will detect plain Javascript and versions packed using Dean Edwards packer."
        reports = "CSA-18749,CSA-18796,CSIT-19018"
        version = "201901242017"
        last_modified = "2019-01-24"
        actor = "VELVET CHOLLIMA"
        malware_family = "Malicious Chrome Extension Cookie Stealer"
    strings:
        $fld_txtName = "txtName"
        $fld_emailName = "emailName"
        $fld_tel = "telName"
        $fld_pass = "pwdName"
        $s_cookie = "s_Cookie"
        $s_url = "s_Url"
        $s_text = "s_text"
        $s1 = "s1"
        $s2 = "s2"
        $s3 = "s3"
        $s4 = "s4"
        $s5 = "s5"
        $s6 = "s6"
        $s7 = "s7"
        $ahr0 = "aHR0c"
        $XMLHttpRequest = "XMLHttpRequest"
    condition:
        (all of ($fld_*)) or (all of ($s*) and $ahr0) and $XMLHttpRequest
}

rule CrowdStrike_CSIT_18197_02 : rat rifdoor silent_chollima 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects the encoded strings used in samples of Rifdoor"
        reports = "CSIT-18197"
        version = "201812201217"
        last_modified = "2018-12-20"
        actor = "SILENT CHOLLIMA"
        malware_family = "Rifdoor"
    strings:
        $interval = { 2b 66 61 7b 6a 7d 79 6e 63 }
        $downloadexec = { 2b 6b 60 78 61 63 60 6e 6b 6a 77 6a 6c }
        $exec = { 2b 6a 77 6a 6c }
    condition:
        all of them
}

rule CrowdStrike_WinNTI_64bit_Module_01 : wicked_panda winnti 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Hunting rule that detects code and strings from in-memory WinNTI modules"
        version = "201907311356"
        last_modified = "2019-07-31"
        actor = "WICKED PANDA"
        malware_family = "Winnti"
    strings:
        // Scrubbed file header artifacts
        $ = { 06 00 00 00 00 00 00 00 00 00 00 00 00 00 f0 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 ?? ?? 00 00 00 00 00 00 00 00 00 80 01 00 00 00 00 10 00 00 00 02 }
        // Characteristic code snippets
        $ = { c3 cc cc cc cc cc cc cc cc cc cc 48 83 ec ?? ?? 8b }
        $ = { 00 48 83 c4 28 c3 cc cc 48 83 ec 28 48 }
        $ = { 4c 8b e8 48 89 44 24 38 48 }
        $ = {
        48 8b c1 b9 4d 5a 00 00 66 39 08 74 03 33 c0 c3
        48 63 48 3c 48 03 c8 33 c0 81 39 50 45 00 00 75
        0c ba 0b 02 00 00 66 39 51 18 0f 94 c0 f3 c3 cc
        4c 63 41 3c 45 33 c9 4c 8b d2 4c 03 c1 41 0f b7
        40 14 45 0f b7 58 06 4a 8d 4c 00 18 45 85 db 74
        1e 8b 51 0c 4c 3b d2 72 0a 8b 41 08 03 c2 4c 3b
        d0 72 0f 41 ff c1 48 83 c1 28 45 3b cb 72 e2 33
        c0 c3 48 8b c1 c3 cc cc cc cc cc cc cc cc cc cc
        48 83 ec 28 4c 8b c1 4c 8d 0d
        }
        // Imports
        $ = "GetSystemTimeAsFileTime"
        $ = "FreeEnvironmentStringsW"
        $ = "InitializeCriticalSectionAndSpinCount"
        $ = "VirtualAlloc"
        $ = "GetTickCount"
        $ = "QueryPerformanceCounter"
        $ = "IsValidCodePage"
        $ = "GetStringTypeW"
        $ = "MessageBoxW"
        $ = "GetUserObjectInformationW"
        $ = "HeapSize"
        $ = "mscoree.dll" wide
        // Manifest and padding
        $ = "DINGPADDINGXXPADDINGPADDINGXXPAD"
        $ = "<requestedExecutionLevel level=\"asInvoker\" uiAccess=\"false\"></requestedExecutionLevel>"
    condition:
        all of them
}

rule CrowdStrike_CSA_18799_01 : backconfig downloader viceroy_tiger 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects BackConfig malware used by VICEROY TIGER"
        reports = "CSA-18799"
        version = "202010131638"
        last_modified = "2020-10-13"
        actor = "VICEROY TIGER"
        malware_family = "BackConfig"
    strings:
        $a1 = "/orderme/"
        $a2 = "5uxjkxsk5"
        $a3 = { 3C 8B 8E 71 81 7F 89 81 3C 00 }
        $a4 = "/pushbatch"
        $a5 = "5v{ynhgzin"
        $a6 = { 3D 8D 92 81 85 70 7E 91 71 85 00 }
        $b1 = "Content-Type: "
        $b2 = "filename"
    condition:
        any of ($a*) and all of ($b*) and uint16(0) == 0x5a4d and filesize <= 400KB
}

rule CrowdStrike_CSA_18810_01 : final1stspy downloader ricochet_chollima 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects the DLL and EXE files related to the Final1stspy downloader"
        reports = "CSA-18810"
        version = "201810050936"
        last_modified = "2018-10-05"
        actor = "RICOCHET CHOLLIMA"
        malware = "Final1stspy"
    strings:
        $ = { 8a 14 39 80 c2 7a 80 f2 19 88 14 39 }
        $ = "main_func"
    condition:
        all of them
}

rule CrowdStrike_CSA_18824_01 : downloader nokki shadow_crane 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects NOKKI samples through the presence of common strings associated with the malware"
        reports = "CSA-18824"
        version = "201810120814"
        last_modified = "2018-10-12"
        actor = "SHADOW CRANE"
        malware_family = "NOKKI"
    strings:
        $must_dll_name_32 = "dll-x32.dll" fullword
        $must_dll_name_64 = "dll-x64.dll" fullword
        $must_str_subj = "subject=%s&data="
        $pdb_dropper = "virus-dropper.pdb"
        $pdb_init = "virus-init.pdb"
        $exe_name_1 = "wirbiry2jsq3454.exe" wide fullword
        $exe_name_2 = "weewyesqsf4.exe" wide fullword
        $file_name_1 = "ID56SD.tmp" wide fullword
        $file_name_2 = "uplog.tmp " wide fullword
        $file_name_3 = "upfile.tmp" wide fullword
    condition:
        filesize < 1MB and
        any of ($must_*) and
        2 of them
}

rule CrowdStrike_CSA_18844_01 : datascrambler packer 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "DataScrambler self-extracting RAR commonly used to pack malware."
        reports = "CSA-18844"
        version = "201810161629"
        last_modified = "2018-10-16"
    strings:
        $pe_time = { 50 45 00 00 4c 01 05 00 75 4d d3 4f }
        $icon1 = { 00 ff 16 02 01 ff 13 01 01 ff 14 01 00 ff 17 02 }
        $icon2 = { 33 22 22 0f 30 27 24 e9 30 27 24 ff 30 27 24 ff }
    condition:
        $pe_time and any of ($icon*)
}

rule CrowdStrike_CSIT_18176_02 : phandoor rat silent_chollima 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects the C2 cryptographic algorithm used by SILENT CHOLLIMA in Phandoor RAT."
        reports = "CSIT-18176"
        version = "201812071845"
        last_modified = "2018-12-07"
        actor = "SILENT_CHOLLIMA"
        malware_family = "Phandoor"
    strings:
        $crypt = {C1 EB 08 8B D1 89 5D F8 8B D9 C1 EA 08 C1 EB 10 22 DA 22 D9}
        $api1 = "S^connect"
        $api2 = "S^recv"
    condition:
        all of them
}

rule CrowdStrike_CSIT_18173_02 : rat schwarze_sonne sleepy_lynx 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects the melt command for Sleepy Lynx Schwarze Sonne RAT."
        reports = "CSIT-18173"
        version = "201907291152"
        last_modified = "2019-07-29"
        actor = "SLEEPY LYNX"
        malware_family = "Schwarze Sonne RAT"
    strings:
        // ADA56F0F3B5C5E7C22C78E8D679DA6D9EB5A8398A78E95839BF5D3448388D415 @ 0x476e48
        $melt  = { b2 01 a1 ?? ?? ?? ?? e8 ?? ?? ?? ?? 8b d8 ba ?? ?? ?? ?? 8b c3 e8 ?? ?? ?? ?? b1 01 ba ?? ?? ?? ?? 8b c3 e8 ?? ?? ?? ?? ba ?? ?? ?? ?? 8b c3 e8 ?? ?? ?? ?? 8b c3 e8 ?? ?? ?? ?? b1 01 ba ?? ?? ?? ?? 8b c3 e8 ?? ?? ?? ?? ba ?? ?? ?? ?? 8b c3 e8 ?? ?? ?? ?? 8b c3 e8 ?? ?? ?? ?? 8b c3 e8 ?? ?? ?? ?? 68 ?? ?? ?? ?? e8 ?? ?? ?? ?? 8d 85 74 ec ff ff e8 ?? ?? ?? ?? 8d 85 74 ec ff ff ba ?? ?? ?? ?? e8 ?? ?? ?? ?? 8b 85 74 ec ff ff e8 ?? ?? ?? ?? 8b d0 8d 85 78 ec ff ff e8 ?? ?? ?? ?? 8d 85 78 ec ff ff e8 ?? ?? ?? ?? e8 ?? ?? ?? ?? 68 ?? ?? ?? ?? 8d 95 6c ec ff ff 33 c0 e8 ?? ?? ?? ?? ff ?? ?? ?? ?? ?? 68 ?? ?? ?? ?? 8d 85 70 ec ff ff ba ?? ?? ?? ?? e8 ?? ?? ?? ?? 8b 95 70 ec ff ff 8d 85 78 ec ff ff e8 ?? ?? ?? ?? e8 ?? ?? ?? ?? e8 ?? ?? ?? ?? 68 ?? ?? ?? ?? a1 ?? ?? ?? ?? ff ?? 68 ?? ?? ?? ?? 8d 85 68 ec ff ff ba ?? ?? ?? ?? e8 ?? ?? ?? ?? 8b 95 68 ec ff ff 8d 85 78 ec ff ff e8 ?? ?? ?? ?? e8 ?? ?? ?? ?? e8 ?? ?? ?? ?? 68 ?? ?? ?? ?? 8d 85 60 ec ff ff e8 ?? ?? ?? ?? ff ?? ?? ?? ?? ?? 68 ?? ?? ?? ?? 8d 85 64 ec ff ff ba ?? ?? ?? ?? e8 ?? ?? ?? ?? 8b 95 64 ec ff ff 8d 85 78 ec ff ff e8 ?? ?? ?? ?? e8 ?? ?? ?? ?? e8 ?? ?? ?? ?? 8d 85 78 ec ff ff e8 ?? ?? ?? ?? e8 ?? ?? ?? ?? a1 ?? ?? ?? ?? 8b 00 e8 ?? ?? ?? ?? 6a 00 8d 85 5c ec ff ff e8 ?? ?? ?? ?? 8b 85 5c ec ff ff e8 ?? ?? ?? ?? 50 68 ?? ?? ?? ?? 68 ?? ?? ?? ?? 68 ?? ?? ?? ?? 6a 00 e8 ?? ?? ?? ?? 6a 00 e8 }
    condition:
        $melt
}

rule CrowdStrike_CSA_18867_02 : loader quasar quasarrat stone_panda 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects StoneNetLoader loaders used to deploy Quasar RAT"
        reports = "CSA-18867,CSIR-18014,CSIT-19010"
        version = "202104121355"
        last_modified = "2021-04-12"
        actor = "STONE PANDA"
        malware_family = "StoneNetLoader"
    strings:
        $framwork = "NetFramwork" ascii
        $typelib_id = "c737b912-427c-4038-b8b7-61bcd4f13600" ascii
    condition:
        uint16(0) == 0x5A4D and
        filesize < 40KB and
        all of them
}

rule CrowdStrike_CSIR_18014_07 : post_exploitation script stone_panda vbscript 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Identifies a customised version of STONE PANDA-associated wmiexec.vbs post-exploitation tool"
        reports = "CSIR-18014"
        version = "201811300951"
        last_modified = "2018-11-30"
        actor = "STONE PANDA"
    strings:
        // Generic to all wmiexec.vbs releases
        $wmiexec = "WMIEXEC : "
        $timemsg = "time to execute command ,read result file after"
        // Custom additions
        $custom1 = "Const Share = \""
        $custom2 = "Const FileSaved = \""
        $custom3 = "TempFile = "
    condition:
        $wmiexec and $timemsg and 1 of ($custom*)
}

rule CrowdStrike_CSIT_18173_01 : downloader sleepy_lynx 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects code to build the URL and parameters for the initial HTTP request in Sleepy Lynx Downloader."
        reports = "CSIT-18173"
        version = "201907291152"
        last_modified = "2019-07-29"
        actor = "SLEEPY LYNX"
        malware_family = "Sleepy Lynx Downloader"
    strings:
        // 6A498D12448A28C68BE1D15CCA79244288127A85B1FD58CCA98A310E05009B5F @ 0x4116f4
        $bytes_0x4116f4_0x4117ac  = { 55 8b ec b9 ?? ?? ?? ?? 6a 00 6a 00 49 75 f9 [0-2] b9 ?? ?? ?? ?? 8d 85 ?? df ff ff 8b 15 00 10 40 00 e8 ?? ?? ?? ?? 33 c0 55 68 ?? ?? ?? ?? 64 ff 30 64 89 20 68 ?? ?? ?? ?? 8d 85 ec df ff ff e8 ?? ?? ?? ?? ff ?? ?? ?? ?? ?? 68 ?? ?? ?? ?? 8d 85 e8 df ff ff e8 ?? ?? ?? ?? ff ?? ?? ?? ?? ?? 68 ?? ?? ?? ?? 8d 85 e4 df ff ff e8 ?? ?? ?? ?? ff ?? ?? ?? ?? ?? 68 ?? ?? ?? ?? 8d 85 e0 df ff ff e8 ?? ?? ?? ?? ff ?? ?? ?? ?? ?? 68 ?? ?? ?? ?? 8d 85 dc df ff ff e8 ?? ?? ?? ?? ff ?? ?? ?? ?? ?? 8d 85 f0 df ff ff ba ?? ?? ?? ?? e8 ?? ?? ?? ?? 8b 85 f0 df ff ff }
    condition:
        $bytes_0x4116f4_0x4117ac
}

rule CrowdStrike_CSIT_18173_03 : ftp_screenshot_utility sleepy_lynx 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects FTP send function of Sleepy Lynx's FTP Screenshot Utility."
        reports = "CSIT-18173"
        version = "201907291152"
        last_modified = "2019-07-29"
        actor = "SLEEPY LYNX"
        malware_family = "FTP Screenshot Utility"
    strings:
        // 0A240FE793D542349BBAC01885528F691BB8B548C1063579531E0BA5C0B7C096 @ 0x4647c0L
        $ftp_send = { 55 8b ec 83 c4 ec 53 56 57 89 4d f4 89 55 f8 89 45 fc 8b 45 fc e8 ?? ?? ?? ?? 8b 45 f8 e8 ?? ?? ?? ?? 8b 45 f4 e8 ?? ?? ?? ?? 8b 45 08 e8 ?? ?? ?? ?? 33 c0 55 68 ?? ?? ?? ?? 64 ff 30 64 89 20 33 c0 55 68 ?? ?? ?? ?? 64 ff 30 64 89 20 33 c9 b2 01 a1 ?? ?? ?? ?? e8 ?? ?? ?? ?? 89 45 ec 8b 45 ec 8b 10 ff ?? ?? 84 c0 74 13 8b 45 ec 8b 10 ff ?? ?? ?? ?? ?? 8b 45 ec e8 ?? ?? ?? ?? b2 01 8b 45 ec e8 ?? ?? ?? ?? 8b 45 ec 05 dc 00 00 00 8b 55 f8 e8 ?? ?? ?? ?? 8b 45 ec 05 d0 00 00 00 8b 55 f4 e8 ?? ?? ?? ?? 8b 55 fc 8b 45 ec 8b 08 ff ?? ?? ?? ?? ?? 33 c0 55 68 ?? ?? ?? ?? 64 ff 30 64 89 20 8b 45 ec 8b 10 ff ?? ?? ?? ?? ?? 8b 45 ec 8b 10 ff ?? ?? 84 c0 74 17 6a 00 33 c9 8b 55 08 8b 45 ec e8 ?? ?? ?? ?? 8b 45 ec e8 ?? ?? ?? ?? c6 45 f3 01 33 c0 5a 59 59 64 89 10 eb 0e e9 ?? ?? ?? ?? c6 45 f3 00 e8 ?? ?? ?? ?? 33 c0 5a 59 59 64 89 10 68 ?? ?? ?? ?? 8b 45 ec e8 ?? ?? ?? ?? c3 e9 ?? ?? ?? ?? eb f0 33 c0 5a 59 59 64 89 10 68 ?? ?? ?? ?? 8d 45 f4 ba ?? ?? ?? ?? e8 ?? ?? ?? ?? 8d 45 08 e8 ?? ?? ?? ?? c3 e9 ?? ?? ?? ?? eb e3 0f b6 45 f3 5f 5e 5b 8b e5 5d c2 04 00 }
    condition:
        $ftp_send
}

rule CrowdStrike_CSIT_18173_04 : rat sleepy_lynx spanish_rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects the log processes function of Sleepy Lynx Spanish RAT."
        reports = "CSIT-18173"
        version = "201907291151"
        last_modified = "2019-07-29"
        actor = "SLEEPY LYNX"
        malware = "SpanishRAT"
    strings:
        // F52A63DEA1C1725A5E98A429BF074051A2B7A385B4ABA8E20CFB0653726A95A6 @ 0x40e934L
        $log_processes = { 55 8b ec 81 c4 c8 fe ff ff 53 56 33 d2 89 95 c8 fe ff ff 89 95 cc fe ff ff 89 55 fc 8b d8 33 c0 55 68 ?? ?? ?? ?? 64 ff 30 64 89 20 8b c3 e8 ?? ?? ?? ?? 33 d2 b8 ?? ?? ?? ?? e8 ?? ?? ?? ?? 89 45 f8 c7 85 d0 fe ff ff 28 01 00 00 33 d2 55 68 ?? ?? ?? ?? 64 ff 32 64 89 22 8d 95 d0 fe ff ff 8b 45 f8 e8 ?? ?? ?? ?? 8b 85 d8 fe ff ff 50 6a 00 68 ?? ?? ?? ?? e8 ?? ?? ?? ?? 8b f0 8d 45 fc ba ?? ?? ?? ?? e8 ?? ?? ?? ?? 68 ?? ?? ?? ?? 8b 45 fc e8 ?? ?? ?? ?? 8b c8 33 d2 8b c6 e8 ?? ?? ?? ?? 85 c0 76 2f 8b 45 fc e8 ?? ?? ?? ?? 8b d0 8d 85 cc fe ff ff e8 ?? ?? ?? ?? 8b 85 cc fe ff ff 85 c0 74 05 83 e8 04 8b 00 8d 55 fc 92 e8 ?? ?? ?? ?? eb 0d 8d 45 fc ba ?? ?? ?? ?? e8 ?? ?? ?? ?? ff ?? 8d 85 c8 fe ff ff 8d 95 f4 fe ff ff b9 04 01 00 00 e8 ?? ?? ?? ?? ff ?? ?? ?? ?? ?? 68 ?? ?? ?? ?? ff ?? ?? 68 ?? ?? ?? ?? 8b c3 ba ?? ?? ?? ?? e8 ?? ?? ?? ?? 8d 95 d0 fe ff ff 8b 45 f8 e8 ?? ?? ?? ?? 85 c0 0f 85 39 ff ff ff 33 c0 5a 59 59 64 89 10 68 ?? ?? ?? ?? 8b 45 f8 50 e8 ?? ?? ?? ?? c3 e9 ?? ?? ?? ?? eb ef 33 c0 5a 59 59 64 89 10 68 ?? ?? ?? ?? 8d 85 c8 fe ff ff ba ?? ?? ?? ?? e8 ?? ?? ?? ?? 8d 45 fc e8 ?? ?? ?? ?? c3 e9 ?? ?? ?? ?? eb e0 5e 5b 8b e5 5d c3 }
    condition:
        $log_processes
}

rule CrowdStrike_CSIT_18155_01 : downloader makloader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects the code used for the domain generation algorithm found in Makloader."
        reports = "CSIT-18155"
        version = "201810260728"
        last_modified = "2018-10-26"
        malware_family = "Makloader"
    strings:
        $1 = { C7 45 A8 AC 0D 00 00 C7 45 AC 00 00 00 00 }
        $2 = { 33 D2 B9 8D 7A 00 00 F7 F1 }
        $3 = { 69 45 A8 39 05 00 00 83 C0 01 }
    condition:
        all of them
}

rule CrowdStrike_WebMonitor_01 : rat unpacked webmonitor 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects the unpacked commodity RAT software WebMonitor by RevCode."
        version = "201903131253"
        last_modified = "2019-03-13"
        malware_family = "WebMonitor RAT"
    strings:
        $c2pattern = "|FD8E9FF348C2A863BC79CB4DD8CBBB3A|" wide
        $rev_filename = "Revcode-" fullword wide
        $rev_key_seed = "fMain" fullword wide
        $rev_msvbvm60 = "MSVBVM60.DLL" fullword ascii
        $rev_formload = ":u9kForm_Load" fullword ascii
        $code_md5 = {
        8f 50 00 04 70 ff fa 00 00 40 c0 48 d1 d9 41 fd
        c9 74 ff 10 70 00 00 00 6c 70 ff f5 01 00 00 00
        08 08 00 06 38 00 a3 04 70 ff fa 00 00 20 71 b5
        f9 ed 41 fd c9 74 ff 10 70 00 00 00 6c 70 ff f5
        02 00 00 00 08 08 00 06 38 00 a3 04 70 ff fa 00
        00 c0 9f 5b 17 e3 41 fd c9 74 ff 10 70 00 00 00
        6c 70 ff f5 03 00 00 00 08 08 00 06 38 00 a3 04
        70 ff fa 00 00 00 76 54 32 b0 41 fd c9 74 ff 10
        70 00 00 00 6c 70 ff f5 04 00 00 00 08 08 00 06
        38 00 a3 }
        $code_inject = {
        52 28 28 ff 22 00 f5 01 00 00 00 6c 48 ff
        52 28 18 ff 00 00 f5 02 00 00 00 6c 48 ff
        52 28 08 ff 00 00 f5 03 00 00 00 6c 48 ff
        52 28 f8 fe 00 00 f5 04 00 00 00 6c 48 ff
        52 28 e8 fe 68 00 f5 05 00 00 00 6c 48 ff
        52 28 d8 fe a4 00 f5 06 00 00 00 6c 48 ff }
        $code_b64 = {
        ff 01 35 38 ff f5 00 00 00 00 6c 70 ff f4 01 fc
        cb f5 01 00 00 00 aa f5 04 00 00 00 c0 f5 03 00
        00 00 b2 f5 01 00 00 00 ae 04 74 ff fe 8e 01 00
        11 00 01 00 80 00 f5 00 00 00 00 04 64 ff 6c 70
        ff f4 01 fc cb f5 04 00 00 00 fe 6c 2c ff f6 01
        6c 64 ff 6c 70 ff fc 90 e7 08 08 00 06 54 00 fc
        90 e7 08 08 00 06 e0 00 9e 6c 64 ff f5 01 00 00
        00 aa 6c 70 ff fc 90 e7 08 08 00 06 54 00 fc 90
        e7 08 08 00 06 c4 00 9e aa 6c 64 ff f5 02 00 00
        00 aa 6c 70 ff fc 90 e7 08 08 00 06 54 00 fc 90
        e7 08 08 00 06 a8 00 9e aa 6c }
    condition:
        $c2pattern and any of ($code*) and all of ($rev*)
}

rule CrowdStrike_CSA_18867_01 : loader quasar quasarrat stone_panda stonenetloader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects a custom .NET-based loader used to deploy Quasar RAT"
        reports = "CSA-18867,CSIR-18014"
        version = "202103311947"
        last_modified = "2021-03-31"
        actor = "STONE PANDA"
        malware_family = "StoneNetLoader"
    strings:
        $str_00 = "$$method0x6000007-1" ascii
        $str_01 = "CipherMode" ascii
        $str_02 = "ComVisibleAttribute" ascii
        $str_03 = "CompilationRelaxationsAttribute" ascii
        $str_04 = "CompilerGeneratedAttribute" ascii
        $str_05 = "ConfusedByAttribute" ascii
        $str_06 = "ConfuserEx v1.0.0" ascii
        $str_07 = "ContainsKey" ascii
        $str_08 = "CreateDecryptor" ascii
        $str_09 = "CreateInstance" ascii
        $str_10 = "CryptoStream" ascii
        $str_11 = "CryptoStreamMode" ascii
        $str_12 = "ileSystemInfo" ascii
        $str_13 = "etCommandLineArgs" ascii
        $str_14 = "GetCurrentProcess" ascii
        $str_15 = "GetDirectories" ascii
        $str_16 = "GetElementType" ascii
        $str_17 = "GetHINSTANCE" ascii
        $str_18 = "GetTypeFromHandle" ascii
        $str_19 = "ICryptoTransform" ascii
        $str_20 = "IDisposable" ascii
        $str_21 = "InstallContext" ascii
        $str_22 = "Installer" ascii
        $str_23 = "MemoryStream" ascii
        $str_24 = "MethodInfo" ascii
        $str_25 = "ProcessModule" ascii
        $str_26 = "ProcessStartInfo" ascii
        $str_27 = "Rfc2898DeriveBytes" ascii
        $str_28 = "RijndaelManaged" ascii
        $str_29 = "SetLastAccessTime" ascii
        $str_30 = "SetLastWriteTime" ascii
        $str_31 = "SuppressIldasmAttribute" ascii
        $str_32 = "SymmetricAlgorithm" ascii
        $str_33 = "System.Configuration.Install" ascii
        $str_34 = "System.Diagnostics" ascii
        $str_35 = "System.Reflection" ascii
        $str_36 = "System.Runtime.CompilerServices" ascii
        $str_37 = "System.Runtime.InteropServices" ascii
        $str_38 = "System.Security.Cryptography" ascii
        $str_39 = "Uninstall" ascii
        $str_40 = "VirtualProtect" ascii
        $str_41 = "get_BlockSize" ascii
        $str_42 = "scoree.dll" ascii
        $str_43 = "op_Explicit" ascii
        $str_44 = "op_Inequality" ascii
        $str_45 = "set_CreateNoWindow" ascii
        $str_46 = "set_FileName" ascii
        $str_47 = "set_KeySize" ascii
        $str_48 = "set_Mode" ascii
        $str_49 = "set_UseShellExecute" ascii
        $str_50 = "v4.0.30319" ascii
    condition:
        filesize < 100KB and
        all of them
}

rule CrowdStrike_CSIT_18176_01 : dropper phandoor silent_chollima 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects inverted bytes used in functionality of dropper associated with Phandoor."
        reports = "CSIT-18176"
        version = "201812071845"
        last_modified = "2018-12-07"
        actor = "SILENT CHOLLIMA"
        malware_family = "Phandoor"
    strings:
        $temppath = {B8 9A 8B AB 9A 92 8F AF 9E 8B 97 BE 00}
        $tempfile = {B8 9A 8B AB 9A 92 8F B9 96 93 9A B1 9E 92 9A BE 00}
        $delfile = {BB 9A 93 9A 8B 9A B9 96 93 9A BE 00}
        $bat = {C5 AD 9A 8F 9A 9E 8B DF F5 DF 9B 9A 93 DF DA 8C F5 DF 96 99}
    condition:
        all of them
}

rule CrowdStrike_CSIT_18158_01 : downloader phorpiex unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects unpacked copies of the Phorpiex HTTP Downloader"
        reports = "CSIT-18158"
        version = "202002251703"
        last_modified = "2020-02-25"
        malware_family = "Phorpiex"
    strings:
        // network
        $net1 = "Mozilla/5.0 (Macintosh; Intel Mac OS X 10.9; rv:25.0) Gecko/20100101 Firefox/25.0"
        $net2 = "%st.php?new=1"
        $net3 = "%ls\\%d%d%d.exe" wide
        $net4 = { 99 B9 60 EA 00 00 F7 F9 81 C2 10 27 00 00 52 }
        // persistence
        $pers1 = "%ls\\winsvcs.txt" wide
        $pers2 = "winsvcs.exe" wide
        $pers3 = "Microsoft Windows Services" wide
        $pers4 = "%windir%" wide
        $pers5 = "%userprofile%" wide
        $pers6 = "%ls\\T-" wide
        // disable security
        $sec1 = "%ls:*:Enabled:%s" wide
        $sec2 = "SYSTEM\\CurrentControlSet\\Services\\SharedAccess\\Parameters\\FirewallPolicy\\StandardProfile\\AuthorizedApplications\\List\\" wide
        $sec3 = "DisableAntiSpyware" wide
        $sec4 = "DisableScanOnRealtimeEnable" wide
        $sec5 = "DisableOnAccessProtection" wide
        $sec6 = "DisableBehaviorMonitoring" wide
        $sec7 = "DisableSR" wide
        // anti-analysis
        $anti1 = { 25 00 6C 00  73 00 2E 00 6C 00 6E 00 }
        $anti2 = { 77 69 6E 65 5F 67 65 74 5F 75 6E 69 78 5F 66 69  6C 65 5F 6E 61 6D 65 00 }
        $anti3 = "wpespy.dll"
    condition:
        (2 of ($net*) and 3 of ($pers*) and 4 of ($sec*)) or all of ($anti*)
}

// WARNING: This rule will only work with YARA 3
import "pe"

rule CrowdStrike_CSIT_18159_02 : artifact certificate foundation 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule matches on serial numbers of certificates used to sign malicious executables related to the Foundation Malware Framework."
        reports = "CSIT-18159"
        version = "201903151053"
        last_modified = "2019-03-15"
        malware_family = "Foundation Malware Framework"
    strings:
        $={768ddcf9ed8d16a6bc77451ee88dfd90}
        $={1c7d3f6e116554809f49ce16ccb62e84}
        $={8ce1293f4f45da3fa7d6fe21cac5d440}
        $={a071dbb32b9de4f8d2173944c3c239f9}
        $={bbae277ac3d9cf3f850086a314e70ad7}
    condition:
        for any of ($*): ($ and (@ >= pe.overlay.offset))
}

rule CrowdStrike_CSIT_19025_01 : doubleup rat stardust_chollima twopence 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects STARDUST CHOLLIMA DoubleUp malware."
        reports = "CSIT-19025"
        version = "202001292111"
        last_modified = "2020-01-29"
        actor = "STARDUST CHOLLIMA"
        malware = "TwoPence"
    strings:
        $firewall = {6E 00 65 00 ?? ?? ?? 74 00 73 00 ?? ?? ?? 68 00 20 00 ?? ?? ?? 66 00 69 00 ?? ?? ?? 72 00 65 00 ?? ?? ?? 77 00 61 00 ?? ?? ?? 6C 00 6C 00}
        $curl = "# This file was generated by libcurl!"
        $param = {83 F8 68 74 20 83 F8 70}
        $arch32 = {8B 7A 18 8B D8 74 09 8B CE E8 ?? ?? ?? ?? 33 F8}
        $arch64 = {8B 58 20 45 85 E4 74 0A 49 8B CE E8 ?? ?? ?? ?? 33 D8}
    condition:
        all of ($firewall,$curl,$param) and 1 of ($arch*)
}

rule CrowdStrike_CSIT_18186_01 : arkei infostealer 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects strings found in Arkei Stealer malware"
        reports = "CSIT-18186"
        version = "201903061450"
        last_modified = "2019-03-06"
        malware_family = "Arkei Stealer"
    strings:
        $ = { 64 a1 18 00 00 00 8b 40 30 80 78 02 00 74 1d 66 b8 b8 1a 66 bb bb }
        $ = "1BEF0A57BE110FD467A"
        $ = "\\historych"
        $ = "C:\\Users\\foxov\\"
    condition:
        3 of them
}

rule CrowdStrike_CSIT_18176_03 : phandoor server silent_chollima 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects the strings ued in the server component of Phandoor."
        reports = "CSIT-18176"
        version = "201812071845"
        last_modified = "2018-12-07"
        actor = "SILENT_CHOLLIMa"
        malware_family = "Phandoor"
    strings:
        $controller = "ResponseToController Sended %d bytes."
        $client = "ReceivingThread:--->: Client Connected. %s"
        $send = "Send Data to Controller :--->:  %d bytes."
        $clientlist = "SendClientListToController %d bytes."
    condition:
        3 of them
}

rule CrowdStrike_PowerLinkLoader_01 : downloader powershell 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects a malicious Windows shortcut with an embedded PowerShell downloader"
        version = "201810191006"
        last_modified = "2018-10-19"
        malware_family = "PowerLinkLoader"
    strings:
        $h = { 4c 00 00 00 01 14 02 00 00 00 00 00 c0 00 00 00 00 00 00 46 }
        $p2 = "$p2"
        $c1 = "findstr" wide nocase
        $c2 = "/priority FOREGROUND"
        $c3 = "-join ((65..90) + (97..122) | Get-Random"
        $c4 = "Get-WmiObject Win32_ComputerSystemProduct"
        $c5 = "New-Item -ItemType Directory -Force"
    condition:
        $h at 0 and
        $p2 and
        3 of ($c*)
        and filesize < 50KB
}

rule CrowdStrike_CSIT_19094_01 : grim_spider ransomware ryuk 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects Ryuk ransomware based on characteristic strings."
        reports = "CSIT-19094"
        version = "202103182351"
        last_modified = "2021-03-18"
        malware_family = "Ryuk"
    strings:
        $ = "Release\\ConsoleApplication54.pdb"
        $ = "/C REG ADD \"HKEY_CURRENT_USER\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run\" /v \"svchos\" /t REG_SZ /d \"" wide fullword
        $ = "RyukReadMe.txt" fullword wide
        $ = "RyukReadMe.html" fullword wide
        $ = ".RYK" fullword wide
        $ = "BTC wallet:" fullword
        $ = "No system is safe" fullword
        $ = "UNIQUE_ID_DO_NOT_REMOVE" wide fullword
        $ = "You will receive btc address for payment in the reply letter" fullword
        $ = "efkrm4tgkl4ytg4" fullword
        $ = "AES_unique_" fullword wide ascii
        $ = "\\users\\Public\\finish" fullword wide ascii
        $ = "\\Users\\Public\\IPtable" fullword wide ascii
    condition:
        4 of them and
        uint16(0) == 0x5A4D and
        filesize > 5KB and
        filesize < 2MB
}

rule CrowdStrike_CSIT_18154_03 : loader taurus 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects Taurus Loader document DLL JavaScript COM backdoor loader."
        reports = "CSIT-18154"
        version = "201905061721"
        last_modified = "2019-05-06"
        malware_family = "Taurus"
    strings:
        $a_EncryptedRegsvrString = { 34 00 42 00 32 00 36 00 35 00 45 }
        $b_EncryptedMSVCRTString = { 37 00 34 00 31 00 30 00 36 00 46 }
    condition:
        uint16(0) == 0x5A4D and
        $a_EncryptedRegsvrString and
        $b_EncryptedMSVCRTString
}

rule CrowdStrike_CSIT_18177_01 : dropper predator_panda ranchrat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects 2017 and earlier variants of Ranch RAT dropper in use by PREDATOR PANDA."
        reports = "CSIT-18177"
        version = "202101281828"
        last_modified = "2021-01-28"
        actor = "PREDATOR PANDA"
        malware_family = "RanchRAT"
    strings:
        $str_cn_1 = { 20 D0 C2 BD F8 B3 CC B5 C4 BD F8 B3 CC 49 44 BA C5 A3 BA 25 64 20 2F 6E 00 }
        $str_cn_2 = { 20 D0 C2 BD F8 B3 CC B5 C4 D6 F7 CF DF B3 CC 49 44 BA C5 A3 BA 25 64 20 2F 6E 00 }
        $str_error = "error code:%d/n" fullword
        $str_pdb_part = "C:\\Users\\John\\documents\\visual studio 2015\\Projects\\"
        $str_path = "c:\\windows\\tasks\\" wide
    condition:
        4 of them
}

rule CrowdStrike_CSIT_18177_02 : loader predator_panda ranchrat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects a loader associated with earlier versions of Ranch RAT in use by PREDATOR PANDA."
        reports = "CSIT-18177"
        version = "202101281828"
        last_modified = "2021-01-28"
        actor = "PREDATOR PANDA"
    strings:
        /* Code from starting VA 10001452:
        mov     eax, esi
        cdq
        idiv    ecx
        mov     ecx, [ebx]
        mov     al, [ebp+edx+keydata]
        xor     [ecx+esi], al
        inc     esi
        cmp     esi, 3
        jle     short loc_10001485
        */
        $code_va_10001452 = { 8B C6 99 F7 F9 8B 0B 8A 44 15 C8 30 04 31 46 83 FE 03 7E 1F }
        $str_key = "ASJ297DHAU2&^@!#hsd217DH(KD28*d2UD*s&d2J%^da215*($s"
        $str_dll_name = "DLL_Hijack.dll" fullword
    condition:
        any of them
}

rule CrowdStrike_CSIT_18177_03 : loader predator_panda ranchrat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects a loader associated with 2018 versions of Ranch RAT in use by PREDATOR PANDA. "
        reports = "CSIT-18177"
        version = "202101281828"
        last_modified = "2021-01-28"
        actor = "PREDATOR PANDA"
    strings:
        /* Code from starting VA 100015d0:
        add     eax, ecx
        xor     edx, edx
        mov     ebx, 0FFh
        div     ebx
        inc     esi
        mov     eax, ecx
        xor     [esi-1], dl
        dec     edi
        movzx   ecx, dl
        */
        $code_va_100015D0 = { 03 C1 33 D2 BB FF 00 00 00 F7 F3 46 8B C1 30 56 FF 4F 0F B6 CA }
        $str_dll_name   = "DLL_test.dll" fullword
        $str_open_fail  = "Open File Failed!" fullword
        $str_exp_mystart    = "MyStart" fullword
    condition:
        2 of them
}

rule CrowdStrike_CSIT_18177_04 : predator_panda ranchrat rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects Ranch RAT and closely related tooling and may be indicative of PREDATOR PANDA activity."
        reports = "CSIT-18177"
        version = "201811280742"
        last_modified = "2018-11-28"
        actor = "PREDATOR PANDA"
        malware_family = "RanchRAT"
    strings:
        $str_deskey_full            = "diaoj%#@!uhsad"
        $str_startworking           = "StartWorking" fullword
        $str_physics                = "Physics Memory: ALL:%dMB, FREE:%dMB"
        /* Code from starting VA 100012f0:
        mov     edx, eax
        sar     edx, 3
        mov     dl, [edx+esi]
        mov     cl, al
        and     cl, 7
        sar     dl, cl
        inc     eax
        and     dl, 1
        mov     byte_10017C87[eax], dl
        cmp     eax, 40h
        jl      short loc_100012F0
        */
        $code_va_100012F0 = { 8B D0 C1 FA 03 8A 14 32 8A C8 80 E1 07 D2 FA 40 80 E2 01 88 90 ?? ?? ?? ?? 83 F8 40 7C E2 }
    condition:
        2 of them
}

rule CrowdStrike_FANCY_BEAR_CppDown_04 : cppdown downloader fancy_bear 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Matches on comparison algorithm implemented in CppDown"
        reports = "CSA-18705,CSIT-18165"
        version = "201811061855"
        last_modified = "2018-11-06"
        actor = "FANCY BEAR"
        malware_family = "CppDown"
    strings:
        $code = {
        85 FF 74 15 0F B7 06 0F  B7 0A 66 3B C1 74 18
        1B C0 83 E0 FE 40 85 C0  75 22 A1 ?? ?? ?? ??
        3B C3 73 0E 83 C8 FF EB  12 83 C6 02 83 C2 02
        4F EB D0 33 C9 3B C3 0F  95 C1 8B C1 85 C0 0F
        94 C0
        }
    condition:
        $code
}

rule CrowdStrike_CSA_18894_01 : cppdown downloader fancy_bear 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Matches on the string decoder routine in CppDown"
        reports = "CSA-18894"
        version = "201810191028"
        last_modified = "2018-10-19"
        actor = "FANCY BEAR"
        malware_family = "CppDown"
    strings:
        $ = { 8D 45 B8 8B 4D C8 03 C8 8B C6 83 FA 10 73 03 8D 45 B8 3B C1 74 }
        $ = { 8A 10 8A 19 88 18 40 88 11 3B C1 75 EE 33 }
    condition:
        all of them
}

rule CrowdStrike_CSA_18893_01 : greyenergy rat voodoo_bear 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Decoding code fragment seen in GreyEnergy DLLs"
        reports = "CSA-18893"
        version = "201810191022"
        last_modified = "2018-10-19"
        actor = "VOODOO BEAR"
        malware_family = "GreyEnergy"
    strings:
        /* Code from starting VA 01015d04:
        mov     eax, edi
        xor     edx, edx
        div     ecx
        mov     eax, edi
        rol     eax, 1
        xor     al, ah
        mov     edi, eax
        mov     ebx, [ebp-24h]
        xor     eax, eax
        dec     eax
        */
        $code_va_01015D04 = { 8B C7 33 D2 F7 F1 8B C7 D1 C0 32 C4 8B F8 8B 5D DC 33 C0 48 }
    condition:
        filesize < 1MB and
        all of them
}

rule CrowdStrike_CSA_18893_02 : greyenergy rat voodoo_bear 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Loading/decoding code fragments seen in GreyEnergy first stage (mini) tooling"
        reports = "CSA-18893"
        version = "201901041840"
        last_modified = "2019-01-04"
        actor = "VOODOO BEAR"
        malware_family = "GreyEnergy"
    strings:
        // DLL API load
        /* Code from starting VA 58d19995:
        mov     [ebp+var_24], 'D'
        mov     [ebp+var_23], 'i'
        mov     [ebp+var_22], 's'
        mov     [ebp+var_21], 'a'
        mov     [ebp+var_20], 'b'
        mov     [ebp+var_1F], 'l'
        mov     [ebp+var_1E], 'e'
        mov     [ebp+var_1D], 'T'
        mov     [ebp+var_1C], 'h'
        mov     [ebp+var_1B], 'r'
        mov     [ebp+var_1A], 'e'
        mov     [ebp+var_19], 'a'
        mov     [ebp+var_18], 'd'
        mov     [ebp+var_17], 'L'
        mov     [ebp+var_16], 'i'
        mov     [ebp+var_15], 'b'
        mov     [ebp+var_14], 'r'
        mov     [ebp+var_13], 'a'
        mov     [ebp+var_12], 'r'
        mov     [ebp+var_11], 'y'
        */
        $code_va_58D19995 = { C6 45 DC 44 C6 45 DD 69 C6 45 DE 73 C6 45 DF 61 C6 45 E0 62 C6 45 E1 6C C6 45 E2 65 C6 45 E3 54 C6 45 E4 68 C6 45 E5 72 C6 45 E6 65 C6 45 E7 61 C6 45 E8 64 C6 45 E9 4C C6 45 EA 69 C6 45 EB 62 C6 45 EC 72 C6 45 ED 61 C6 45 EE 72 C6 45 EF 79 }
        // Payload decoder
        /* Code from starting VA 00406ae1:
        movzx   edx, dl
        mov     ecx, [ebp+arg_0]
        add     esi, edx
        and     esi, 0FFh
        mov     dl, [esi+eax]
        xor     [ecx+edi], dl
        inc     edi
        cmp     edi, [ebp+arg_4]
        jnb     loc_406B0B
        */
        $code_va_00406AE1 = { 0F B6 D2 8B 4D 08 03 F2 81 E6 FF 00 00 00 8A 14 06 30 14 39 47 3B 7D 0C 0F 83 0C 00 00 00 }
        // More decoding code
        $code_va_gen_table = { 8B C7 33 D2 F7 F1 8B C7 D1 C0 32 C4 8B F8 8B 5D DC 33 C0 48 }
        $code_alt_1     = { 0F B6 D2 03 F2 81 E6 FF 00 00 00 }
        $code_alt_2     = { 8A 14 06 30 14 39 47 }
        $code_alt_3        = { 88 88 00 01 00 00 }
        $code_alt_4        = { 0F 84 0C 00 00 00 }
        $code_alt_5        = { 8A 14 06 89 D9 00 55 FF }
    condition:
        filesize < 1MB and
        (any of ($code_va_*)) or
        (all of ($code_alt_*))
}

rule CrowdStrike_CSA_18892_01 : kazuar rat venomous_bear 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects Kazuar malware as used by VENOMOUS BEAR"
        reports = "CSA-18892"
        version = "202012140911"
        last_modified = "2020-12-14"
        actor = "VENOMOUS BEAR"
        malware_family = "Kazuar"
    strings:
        $ = "BSJB"
        $ = "HttpListenerContext"
        $ = "get_DhcpServerAddresses"
        $ = { 74 30 00 74 31 00 74 32 00 74 33 00 }
    condition:
        all of them
}

rule CrowdStrike_CSIT_18187_03 : fancy_bear proxy xtunnel 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "FANCY BEAR X-Tunnel.NET Base Keys"
        reports = "CSA-17342,CSIT-18187"
        version = "202012141614"
        last_modified = "2020-12-14"
        actor = "FANCY BEAR"
        malware_family = "XTunnel"
    strings:
        $dotnet_magic_1 = "BSJB"
        $dotnet_magic_2 = "#Strings"
        $base_key_000 = {987ab999fe0924a2df0a412b14e26093746fcdf9ba31dc05536892c33b116ad3}
        $base_key_001 = {8b236c892d902b0c9a6d37ae4f9842c3070fbdc14099c6930158563c6ac00ff5}
        $base_key_002 = {e47b7f110caa1da617545567ec972af3a6e7b4e6807b7981d3cfbd3d8fcc3373}
        $base_key_003 = {48b284545ca1fa74f64fdbe2e605d68ced8a726d05ebefd9baac164a7949bdc1}
        $base_key_004 = {fb421558e30fccd95fa7bc45ac92d2991c44072230f6fbeaa211341b5bf2dc56}
        $base_key_005 = {34f1ae17017af16021ada5ce3f77675bbc6e7dec6478d6078a0b22e5fdff3b31}
        $base_key_006 = {f0ea48f164395186e6f754256ebb812a2afe168e77ed9501f8b8e6f5b72126a7}
        $base_key_007 = {0b6e9970a8eaf68ee14ab45005357a2f3391beaa7e53ab760b916bc2b3916abe}
        $base_key_008 = {ff032ea7ed2436cf6eea1f741f99a3522a61fda8b5a81ec03a8983ed1aedab1a}
        $base_key_009 = {f0dac1ddfef7ac6de1cbe1006584538fe650389bf8565b32e0de1ffacbcb14bb}
        $base_key_010 = {a5d699a3cd4510af11f1af767602055c523df74b94527d74319d6efc6883b80d}
        $base_key_011 = {5951b02696c1d5a7b2851d28872384da607b25f4cea268ff3fd7fba75ab3b4b3}
        $base_key_012 = {0465d99b26af42d8346001bb838595e301bad8cf5d40ce9c17c944717df82481}
        $base_key_013 = {5dfe1c83ad5f5ce1bf5d9c42e23225e3ecfdb2493e80e6554a2ac7c722eb4880}
        $base_key_014 = {e9650396c45f7783bc14c59f46ea8232e8357c26b5627bff8c42c6ae2e0f2e17}
        $base_key_015 = {7432ae389125bb4e3980ed7f6a6fb252a42e785a90f4591c3620ca642ff97ca3}
        $base_key_016 = {2b2adbbc4f960a8916f7088067bad30be84b65783fbf9476df5fda0e5856b183}
        $base_key_017 = {808c3fd0224a59384161b8a81c8bb404d7197d16d8118cb77067c5c8bd764b3e}
        $base_key_018 = {028b0e24d5675c16c815bfe4a073e9778c668e65771a1ce881e2b03f58fc7d5b}
        $base_key_019 = {878b7f5cf2dc72baf1319f91a4880931ee979665b1b24d3394fe72edfaef4881}
        $base_key_020 = {7ac7dd6ca34f269481c526254d2f563bc6eca1779feeaa33ec1c20e60b686785}
        $base_key_021 = {3044f1d394186815dd8e3a2bbd9166837d07fa1cf6a550e2c170c9cdd9305209}
        $base_key_022 = {7544dc095c441e39d258648fe9cb1267d20d83c8b2d3ab734474401da4932619}
        $base_key_023 = {d702223347406c1999d1a9829cbbe96ec86d377a40e2ee84562ea1fac1c71498}
        $base_key_024 = {ca36cb1177382a1009d392a58f7c1357e94ad2292cc0ae82ee4f7db0179148e1}
        $base_key_025 = {c714f23e4c1c4e55f0e1fa7f5d0dd64658a86f84681d07576d840784154f65dc}
        $base_key_026 = {63571baf736904634afee2a70cb9ed64615de8ca7aef21e773286b8877d065db}
        $base_key_027 = {27808a9be98ffe348de1db999ac9fdfb26e6c5a0d5e688490ef3d186c43661eb}
        $base_key_028 = {b6eb86a07a85d40866afa100789ffb9e85c13f5aa7c7a3b6ba753c7eab9d6a62}
        $base_key_029 = {88f0020375d60bdb85acdbfe4bd79cd098db2b3fa2cef55d4331dbefce455157}
        $base_key_030 = {36535aab296587ae1162ac5d39492dd1245811c72706246a38ff590645aa5d7b}
        $base_key_031 = {fdb726261cadd52e10818b49cab81bef112cb63832daa26ad9fc711ea6ce99a4}
        $base_key_032 = {86c0caa26d9fd07d215bc7eb14e2da250e905d406affab44fb1c62a2eafc4670}
        $base_key_033 = {bc101329b0e3a7d13f6ebc535097785e27d59e92d449d6d06538725034b8c0f0}
        $base_key_034 = {c8d31a78b7c149f62f06497f9dc1ddc4967b566ac52c3a2a65ac7a99643b8a2d}
        $base_key_035 = {0ea4a5c565efbb94f5041392c5f0565b6badc630d9005b3eadd5d81110623e1f}
        $base_key_036 = {06e4e46bd3a0ffc8a4125a6a02b0c56d5d8b9e378cf97539ce4d4adfaf89feb5}
        $base_key_037 = {6de22040821f0827316291331256a170e23fa76e381ca7066af1e5197ae3cfe7}
        $base_key_038 = {c6ef27480f2f6f40910074a45715143954bba78cd74e92413f785bba5b2aa121}
        $base_key_039 = {19c96a28f8d9698adadd2e31f2426a46fd11d2d45f64169edc7158389bfa59b4}
        $base_key_040 = {c3c3ddbb9d4645772373a815b5125bb2232d8782919d206e0e79a6a973ff5d36}
        $base_key_041 = {c33af1608037d7a3aa7fb860911312b4409936d236564044cfe6ed42e54b78a8}
        $base_key_042 = {856a0806a1dfa94b5e62abef75bea3b657d9888e30c8d2ffaec042930bba3c90}
        $base_key_043 = {244496c524401182a2bc72177a15cdd2ef55601f1d321ecbf2605ffd1b9b8e3f}
        $base_key_044 = {df24050364168606d2f81e4d0deb1ffc417f1b5eb13a2aa49a89a1b5242ff503}
        $base_key_045 = {54fa07b8108dbfe285dd2f92c84e8f09cdaa687fe492237f1bc4343ff4294248}
        $base_key_046 = {23490033d6bf165b9c45ee65947d6e6127d6e00c68038b83c8bfc2bce905040c}
        $base_key_047 = {4e044025c45680609b6ec52feb3491130a711f7375aaf63d69b9f952befd5f0c}
        $base_key_048 = {019f31c5f5b2269020ebc00c1f511f2ac23e9d37e89374514c6da40a6a03176c}
        $base_key_049 = {a2483197fa57271b43e7276238468cfb8429326cbda7bd091461147f642beb06}
        $base_key_050 = {731c9d6e74c589b7acb019e5f6a6e07acf12e68cb9a396ce05aa4d69d5387048}
        $base_key_051 = {540db6c8d23f7f7fef9964e53f445f0e56459b10e931deeedb2b57b063c7f8b7}
        $base_key_052 = {d5af80a7eeff26de988ac3d7ce23e62568813551b2133f8d3e973da15e355833}
        $base_key_053 = {e4d8dbd3d801b1708c74485a972e7f00afb45161c791ee05282ba68660ffba45}
        $base_key_054 = {d79518af96c920223d687dd596fcd545b126a678b7947edfbf24661f232064fb}
        $base_key_055 = {b57caa4b45ca6e8332eb58c8e72d0d9853b3110b478fea06b35026d7708ad225}
        $base_key_056 = {077c714c47dfcf79ca2742b1544f4aa8035bb34aea9d519dee77745e01468408}
        $base_key_057 = {c3f5550ad424839e4cc54fa015994818f4fb62de99b37c872af0e52c376934fa}
        $base_key_058 = {5e890432ae87d0fa4d209a62b9e37aaededc8c779008febaf9e4e6304d1b2aac}
        $base_key_059 = {a42ede52b5af4c02cfe76488cade36a8bbc3204bcb1e05c402ecf450071efcab}
        $base_key_060 = {4cdafe02894a04583169e1fb4717a402dac44da6e2536ae53f5f35467d31f1ca}
        $base_key_061 = {0befcc953ad0ed6b39ce6781e60b83c0cfd166b124d1966330cba9adfc9a7708}
        $base_key_062 = {8a439dc4148a2f4d5996ce3fa152ff702366224737b8aa6784531480ed8c8877}
        $base_key_063 = {cf253be3b06b310901ff48a351471374ad35bbe4ee654b72b860f2a6ec7b1dbb}
        $base_key_064 = {a0599f50c4d059c5cfa16821e97c9596b1517b9fb6c6116f260415127f32ce1f}
        $base_key_065 = {8b6d704f3dc9150c6b7d2d54f9c3eaab14654aca2c5c3952604e65df8133fe0c}
        $base_key_066 = {a06e5cdd3871e9a3ee17f7e8dae193ee47ddb87339f2c599402a78c15d77cefd}
        $base_key_067 = {e52ada1d9bc4c089dbb771b59904a3e0e25b531b4d18b58e432d4fa0a41d9e8a}
        $base_key_068 = {4778a7e23c686c171fddccb8e26f98c4cbebdf180494a647c2f6e7661385f05b}
        $base_key_069 = {fe983d3a00a9521f871ed8698e702d595c0c7160a118a7630e8ec92114ba7c12}
        $base_key_070 = {52ba4c52639e71eabd49534bba80a4168d15762e2d1d913bab5a5dbf14d9d166}
        $base_key_071 = {931eb8f7bc2ae1797335c42db56843427eb970abd601e7825c4441701d13d7b1}
        $base_key_072 = {318fa8edb989672dbe2b5a74949eb6125727bd2e28a4b084e8f1f50604ccb735}
        $base_key_073 = {5b5f2315e88a42a7b59c1b493ad15b92f819c021bd70a5a6619aac6666639bc2}
        $base_key_074 = {c2bed7aa481951feb56c47f03ea38236bc425779b2fd1f1397cb79fe2e15c0f0}
        $base_key_075 = {d3979b1cb0ec1a655961559704d7cdc019253acb2259dfb92558b7536d774441}
        $base_key_076 = {0edf5dbecb772424d879bbdd51899d6aaed736d0311589566d41a9dbb8ed1cc7}
        $base_key_077 = {cc798598f0a9bcc82378a5740143deaf1a147f4b2908a197494b7202388ec905}
        $base_key_078 = {074e9df7f859bf1bd1658fd2a86d81c282000eab09af4252fab45433421d3849}
        $base_key_079 = {6cd540642e007f00650ed20d7b54cffd54dda95d8debb087a004bae222f22c8e}
        $base_key_080 = {c76cf2f66c71f6d17fc8defa1caef8718ba1ce188c7ea02c835a0fa54d3b3314}
        $base_key_081 = {a7250a149600e515c9c40fe5720756fda8251635a3b661261070cb5dabfe7253}
        $base_key_082 = {237c67b97d4cce4610de2b82e582808ea796c34a4c24715c953cba403b2c935e}
        $base_key_083 = {a8fa182547e66b57c497daaa195a38c0f0fb0a3c1f7b98b4b852f5f37e885127}
        $base_key_084 = {83694cca50b821144ffbbe6855f62845f1328111ae1ac5666cba59eb43aa12c6}
        $base_key_085 = {145e906416b17865ad37cd022df5481f28c930d6e3f53c50b0953bf33f4db953}
        $base_key_086 = {ab49b7c2fa3027a767f5aa94eaf2b312bbe3e89fd924ef89b92a7cf977354c22}
        $base_key_087 = {7e04e478340c209b01ca2febbce3fe77c6e6169f0b0528c42fa4bda6d90ac957}
        $base_key_088 = {0eadd042b9f0ddbaba0ca676efa4edb68a045595097e5a392217dffc21a8532f}
        $base_key_089 = {5623710f134ecacd5b70434a1431009e3556343ed48e77f6a557f2c7ff46f655}
        $base_key_090 = {6968657db62f4a119f8e5cb3bf5c51f4b285328613aa7db9016f8000b576561f}
        $base_key_091 = {debb9c95eae6a68974023c335f8d2711135a98260415df05845f053ad65b59b4}
        $base_key_092 = {16f54900dbf08950f2c5835153ab636605fb8c09106c0e94cb13cea16f275685}
        $base_key_093 = {1c9f86f88f0f4882d5cbd32876368e7b311a84418692d652a6a4f315cc499ae8}
        $base_key_094 = {e920e0783028fa05f4ce2d6a04bbe636d56a775cfd4daea3f2a1b8beeb52a6d4}
        $base_key_095 = {73874ca3af47a8a315d50e1990f44f655ec7c15b146ffe0611b6c4fc096bd07c}
        $base_key_096 = {f21c1fa163c745789c53922c47e191a5a85301bdc2ffc3d3b688cfbff39f3be5}
        $base_key_097 = {bc5a861f21cb98bd1e2ae9650b7a0bb4cd0c71900b3463c1bc3380afd2bb948e}
        $base_key_098 = {151bae36e646f30570dc6a7b57752f2481a0b48dd5184e914bcf411d8ad5aca0}
        $base_key_099 = {f05ad6d7a0cadc10a6468bfdbcbb223d5bd6ca30ee19c239e8035772d80312c9}
        $base_key_100 = {5de9a0fdb37c0d59c298577e5379bcaf4f86df3e9fa17787a4cefa7dd10c462e}
        $base_key_101 = {f5e62ba862380224d159a324d25fd321e5b35f8554d70cf9a506767713bca508}
        $base_key_102 = {a2d1b10409b328da0ccbffde2ad2ff10855f95da36a1d3dba84952bb05f8c3a7}
        $base_key_103 = {c974abd227d3ad339fac11c97e11d904706edea610b181b8fad473ffcc36a695}
        $base_key_104 = {ab5167d2241406c3c0178d3f28664398d5213ee5d2c09dcc9410cb604671f5f1}
        $base_key_105 = {c25cc4e671caaa31e137700a9db3a272d4e157a6a1f47235043d954bae8a3c70}
        $base_key_106 = {e6005757ca0189ac38f9b6d5ad584881399f28da949a0f98d8a4e3862e20f715}
        $base_key_107 = {204e6ceb4ff59787ef4d5c9ca5a41ddf4445b9d8e0c970b86d543e9c7435b194}
        $base_key_108 = {831d7fd21316590263b69e095abbe89e01a176e16ae799d83bd774af0d254390}
        $base_key_109 = {42c36355d9bc573d72f546cdb12e6bb2cfe2933ac92c12040386b310abf6a1ed}
        $base_key_110 = {b9044393c09ad03390160041446bf3134d864d16b25f1ab5e5cdc690c4677e7d}
        $base_key_111 = {6bc1102b5be05eebf65e2c3aca1f4e17a59b2e57fb480de016d371da3aef57a5}
        $base_key_112 = {b068d00b482ff73f8d23795743c76fe8639d405ee54d3efb20afd55a9e2dff4e}
        $base_key_113 = {95cf5addfe511c8c7496e3b75d52a0c0efe01ed52d5dd04d0ca6a7abd3a6f968}
        $base_key_114 = {75534574a4620019f8e3d055367016255034fa7d91cbca9e717149441742ac8d}
        $base_key_115 = {96f1013a5301534be424a11a94b740e5eb3a627d052d1b769e64bab6a666433c}
        $base_key_116 = {584477ab45caf729ee9844834f84683abecab7c4f7d23a9636f54cdd5b8f19b3}
        $base_key_117 = {d3905f185b564149ee85cc3d093477c8ff2f8cf601c68c38bbd81517672eca3a}
        $base_key_118 = {bf29521a7f94636d1930aa236422eb6351775a523de68af9bf9f1026ceda618d}
        $base_key_119 = {04b3a783470af1613a9b849fbd6f020ee65c612343eb1c028b2c28590789e60b}
        $base_key_120 = {3d8d8e84977fe5d21b6971d8d873e7bed048e21333fe15be2b3d1732c7fd3d04}
        $base_key_121 = {8acb88224b6ef466d7653eb0d8256ea86d50bba14fd05f7a0e77acd574e9d9ff}
        $base_key_122 = {b46121ffcf1565a77aa45752c9c5fb3716b6d8658737df95ae8b6a2374432228}
        $base_key_123 = {a4432874588d1bd2317224fb371f324dd60ab25d4191f2f01c5c13909f35b943}
        $base_key_124 = {78e1b7d06ed2a2a044c69b7ce6cdc9bcd77c19180d0b082a671bba06507349c8}
        $base_key_125 = {540198c3d33a631801fe94e7cb5da3a2d9bcbae7c7c3112edecb342f3f7df793}
        $base_key_126 = {7e905652cab96acbb7feb2825b55243511df1cd8a22d0680f83aaf37b8a7cb36}
        $base_key_127 = {37218801dbf2cd92f07f154cd53981e6189dbfbacac53bc200eafab891c5eec8}
    condition:
        all of ($dotnet_magic_*) and any of ($base_key_*)
}

rule CrowdStrike_CSIT_18187_04 : fancy_bear proxy xtunnel 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "FANCY BEAR X-Tunnel.NET Passwords"
        reports = "CSA-17342,CSIT-18187"
        version = "201812111451"
        last_modified = "2018-12-11"
        actor = "FANCY BEAR"
        malware_family = "X-Tunnel"
    strings:
        $dotnet_magic_1 = "BSJB"
        $dotnet_magic_2 = "#Strings"
        $base_password_000 = {b0619f1ef0cae21fed89b3d6675915958e016329c26117dc448249a9ba81056a}
        $base_password_001 = {e3a489d36f6bf25cf4a6325bff47f08e4853b70ab4cee7f95030a20ab2a87595}
        $base_password_002 = {4cfe68bb695a185d004ab80092a88edafb45e5b013cca963fc4b6daef3e24340}
        $base_password_003 = {e0abfb490613a6065e5e06f00694ca02d9afb2ec7b5b4f78a6bd269a9f6ada80}
        $base_password_004 = {15d5c91be9702247ce2837d5bd01d796b189832ce4d2a48a8fcb242f35feaf4a}
        $base_password_005 = {d47866bde88804b7b03b8c6d3c6304edec871ad059be5ae9897f18be7dc70951}
        $base_password_006 = {3f6f0e28f712dfa74d6b158ace1977baa0918af950e4e2d963fa98e1c1a13201}
        $base_password_007 = {104129075308aea173c32b41dca2fb7c3485768469585dcd53f5ae1496e015a6}
        $base_password_008 = {213ead75465c16b91f41fafce3f578177aee9be447f9b19aee5fae853fc42b61}
        $base_password_009 = {02d9d64935ec02542dfd5010f2c9286db7c351febc0298ab614730a00b5b010d}
        $base_password_010 = {34d75669c359bef0560e0148d729b58fec068da9082654696d840a78df0b8514}
        $base_password_011 = {e3dc7da6353b978b4a98d321c189b0ad8f3e569864aa01d12e0b490e17ce22fa}
        $base_password_012 = {aa9fa0dfdb376a25cf3e4690c7f73e563594ee993ff06a6dfbb37b12819d0c2c}
        $base_password_013 = {3dad0b18e4763db4b483447b7a82d1af17c04856b0b2c3ab653fbee7dcca1319}
        $base_password_014 = {771e315c946e1048f254c36cd7951cee556444051707b07c466e632339763cb0}
        $base_password_015 = {956e0c29dc1c72ce71353b48ca57361fbb7a24d281d54fc843b2eb7c29272dbe}
        $base_password_016 = {9539e772565940c78f7b0f59d245798ebf9d604072af08b662f3328b1b5f49b0}
        $base_password_017 = {993022ef8a63b619dec572b10aeb3fc9899f09fb4f12b1b105e43c204385d1dc}
        $base_password_018 = {b5f3cb3f5681583546cbe650b625193fc4233b1335ecc43ad0005b14852cf03b}
        $base_password_019 = {1fbc7a763dd3ab849e91d454b6ee947a11cf8e46bb52808c53dba0d807901327}
        $base_password_020 = {4c8e9d8a61480effd9e2538fd0e709e1b6972772eaa8fe3d839e158b2e29b27b}
        $base_password_021 = {b74f051897131770f56affc65208a708a0cf7a8a7778c7fa16dc85450537c0bc}
        $base_password_022 = {86c5d41dd8eb8dcd568c93a8953bb0350a2bbf81a3867bba6201ff6838bf24bf}
        $base_password_023 = {84f9dc5ce46a293af6bde28bf893c002be7f836105fe1b68ff1ad038d9f4f75d}
        $base_password_024 = {edd3b9d23de30c34a0efbf9882809a40ff1da1051bbd6d1bd73d53b1314a0e1f}
        $base_password_025 = {1dc8f15babfd8f4bec4ee36ece7daece9a50d3b50d40d0e47d2395ae6da4cd8b}
        $base_password_026 = {6cbee617bc7562a8c3451792c2c5605c1533112273e207f0059c9e73406cfeac}
        $base_password_027 = {2ae4c3e659258f1c6aa6ae2c6b0e8881419aa3b47caaa4814743f487aff234d9}
        $base_password_028 = {d6f7c02f1d4f4c87f5fab460093ce14ad685ff522fa3d476e6c8fe95bb326f91}
        $base_password_029 = {292fc1467e0dce730782d310beb55b953a5ae769fdbbe0e484de793f10e8d039}
        $base_password_030 = {179180959e4e08a6d0dcb68e911123cb6b0b3469c6144d4af2c68902af5a3cc6}
        $base_password_031 = {ebbc5c8a0a6430da40e668d1f88c9c6397d1cc5de519a8d8e031da8f8b165577}
        $base_password_032 = {d2b101dc1631b656171f280fabc47342953f9f7b59475339792dc804441d7b16}
        $base_password_033 = {cf7cf3e5ada93bc5c863d4732847b5bd875538e09c8b1915b9e11afdfe9513cd}
        $base_password_034 = {1206b2bfb0ee84785159ec79a0a13727f66f0793fb20a8b401c2b10058c4cd6a}
        $base_password_035 = {cb80297b6eaef3bf07df39a78170cf77dfd60adaf7b38ef8753ff8cd04c637cf}
        $base_password_036 = {46614ab40f3d73161dacbd9e1c8c15fc6320d65ad3655248a44b16a8114d7757}
        $base_password_037 = {aec10bbdff7ed31c2b91ba471dcf4380ef1adac27f2d0b237821cc896e43e01d}
        $base_password_038 = {05ebda0469ae20943fdadc5ca91fdd9939b75bb8e466dc5c87a8e5f6ebc513f0}
        $base_password_039 = {b0edf41a9b14aedaee8a3798aa1431e3cb8c9cb0f3780c7a20f2700bb783fc68}
        $base_password_040 = {71f0820c0530e7f3bb1e8b6532bc48fd49e4ad3c5cbab67cac278863aa84cb1b}
        $base_password_041 = {744d28797e0f6d392df89e5fb5e65cfecb0a3a27c4f0a470172cd3c2b09fdd24}
        $base_password_042 = {ec059e6a140ba3410341a0b828fdb6f307f01acbe1be3bf8ea0eba9aad98bf9a}
        $base_password_043 = {9d5d04b268a8f36be994241191da0498cb1f63acdd9ea4c8ac5f625af721f494}
        $base_password_044 = {7ef846e6a03a528ace769b5f50a0f71bbf5ac79cf86c64a4cbc7fec2e8f25667}
        $base_password_045 = {eb9d4d8bd79f15a515b1046651fb81105549ac4db511f180d8f042c0e29827cd}
        $base_password_046 = {3575590c146eb12a1fb59070b01180055a2d520f3e448f1634d1d6166afee49f}
        $base_password_047 = {733dac87ab5db1cb13413bc353bcc9ade91bbd275f4c3d931e13aa88118e2784}
        $base_password_048 = {cbd30c7631bd4144ff7d075239d0ff22ecbc494b0986df279989afab17d62fe2}
        $base_password_049 = {aa3b58dbf99a1ff817264a50f74972e306bb2e0f410d36da96e585adbbb58f65}
        $base_password_050 = {f0e840e9825fe199862be97d755b607b168e8a579cc03132a5b7e0606c6fc65c}
        $base_password_051 = {570646d9662772ec535b69c8b6c943cc57cd23f38d5526320c0692787558d4cd}
        $base_password_052 = {5f1aa6c54219b195741a5d2be3a0f73a6d1b2efa70542c7c5abef4cf17c89c76}
        $base_password_053 = {e3433b255cecbad00617fbe9b7f323240e511e7ea54afaff08eecf1fb66b9599}
        $base_password_054 = {aed0be0abc78dbc28fd6ab46c9cf6ad7208855c6d24fc5db3d94faf400908dae}
        $base_password_055 = {604cb91dc494df546a8b9a345a050b7a8d614060b0063bee9a35e29ac56f4926}
        $base_password_056 = {bb0243809622d400ad6e340773408201a1c26151c89c3f63d121fd979146bd4c}
        $base_password_057 = {4800ccde22a0dfd00f13d782535983f41ce446e480854752a745e9388ba684d4}
        $base_password_058 = {a651b2c8f1919800a57083f8c906ede5eb33ca6bb811bd5f56a697e24c1cb6f2}
        $base_password_059 = {6d68bb5efa535f9fc3e2978de88472d3b73c3f704efccfa4a36786ef833ce2f0}
        $base_password_060 = {a59d4e9ff0ad3eb48fd541785ab34b11f08a813e8751e22ab869193ba5fb2b4a}
        $base_password_061 = {9879e98927273db6fd7e2e57317a682104ea5f8b3b42b5f3abcf2e50ca599b63}
        $base_password_062 = {d284ecf9ac29b0a9a7de00d85868fa5d5259e88d9b9e80466dae973707329ada}
        $base_password_063 = {b686d362af830b56620b2fba742917c68200541e9ed4640b83fb428a2ddd64e4}
        $base_password_064 = {63384613bb52691d5d98d8d1c1ef9844efec628dc0c69843c2dbceefb832d31b}
        $base_password_065 = {6a1a2e266c9843c9301b9bf20b3336fa1f9888df5e202320fbf110b323e3cf8e}
        $base_password_066 = {fdfdb46995f733c613ceb81e01ee182086a0ffe4c12205bc13157037f83fc5f6}
        $base_password_067 = {3c795fd2709298836050a1613eba81c45a81a81ba3add8b7c248eebb87b3b1c3}
        $base_password_068 = {2c10959ca32d20037dc165bb7be67fd66728f10bd5c9c29811b0539863045c8f}
        $base_password_069 = {14f12bb71f4bbb9c0d20588806d75e6eff5079d5193b6d2bebc0c34ec41fddd8}
        $base_password_070 = {11089030544bcc616b24e971fc48dffb9858d0b1933ddc7efda0ccc1bfa99ad0}
        $base_password_071 = {b22a000675cd67e0f15051ed9831e93089b9e21df7be9bf45e68b61e1150eec3}
        $base_password_072 = {7aefc9efbc30cfad81209b1951844adb3d2cf834ea932949fbdf670d2f55d0a9}
        $base_password_073 = {449a9800ca67ae4b874965d9cdafb40adbac3fc53f680e3b47754876cb181f0f}
        $base_password_074 = {b2b7107d1ebec8a5072d7ed4dc32deb7de1d7d1e858b59cc01a142ccb961db6c}
        $base_password_075 = {18ebe936a9b1dcb0df5a84bb8d63736b80f089067be2d27c8315483d7624a98f}
        $base_password_076 = {0f92c5b943a16922fceede895151f4d1417ed7bc60aa39e4bf812135a5cac4b5}
        $base_password_077 = {5c8a6e9f2bd7c227c5a0b016f1a5e83223bfee8369276728a9885e4e522203ae}
        $base_password_078 = {ac714ed84910ff0eb0b025a1550dd378ccc1fb36e9635e92ebbce03edfe4ec8b}
        $base_password_079 = {553a639e4a63adfa13d29b68df6ee0ab30dbe1193e40ab2afc8b68db6f5467c5}
        $base_password_080 = {8fca63d92d10d440e26fa8c1de886d0e644e27a28ed2cc8b5d3466cd89cd9218}
        $base_password_081 = {98f5f1c506c506e835aeaa133717219b65483df41a0a7f773ee544c7b3d6df4b}
        $base_password_082 = {ccd110d29616bacbc564defc7bff97e147d4d561de54d91d391de4ecf4c437c0}
        $base_password_083 = {9548922b5e4cf723b1d51f2cd5b60d1c8be27e6936578670746b5c682f9428c4}
        $base_password_084 = {dcbaef3a07e65eb8bc7de49134f2adbfd42b280b82af7bf71ad75f496b880d47}
        $base_password_085 = {42fc8249e3e0019f5de63091d8dd50ac0979b78b283282420ae28b756a98bdac}
        $base_password_086 = {943ff6771ff7167cdd460eb5245e622dd719b8ff4c3b41561dcccb87648833f9}
        $base_password_087 = {c72970e6218763fecd71b4f1cf161ea72fd7a67b12e8d12fb49db61925e912ed}
        $base_password_088 = {1382d334093632d7a7e6c877fce71e2cbec4a7d0ac79ff6116b57a3b9e8c28b1}
        $base_password_089 = {0efce5183218efdafeb751fb9e6f275c33ce2ce0472b415de0bb997f47c13055}
        $base_password_090 = {bd166df02e5cca2c141b27b28a4e0fbd1d3b9d6467dec247995bc6e01cf736da}
        $base_password_091 = {0da3ca3b00946714af8fc639ddd5f6fa11945f787221bf0c7c86ec987d22728a}
        $base_password_092 = {c63cc5c6d02cda7fbba0b89976af938743f2ffb513bec18f44ae28c1d09a4b96}
        $base_password_093 = {d7105ca73d3627f8d7df914d8e25d4d117d3872b9148bad6f6e297c77de35d54}
        $base_password_094 = {f3bafb30f02229c702ba1490dfe862f7bbe9224d31dc2328bfbaef3c9d4c9091}
        $base_password_095 = {068bc1f7aeeabeb0a5d34084bba27b778b9dc4bd7ae7e539a1d4753f2005d027}
        $base_password_096 = {90911e3e7cdcee21af2fa56bd121e25dbea61a388dff712ed3e66df3eb3d1a7c}
        $base_password_097 = {cf38ba4b15a96cc4d8112fa9321106f1b72029441f9b73f281e0e66d1e00e9ed}
        $base_password_098 = {39a3384e4ca41224b542cee853d4d90bf5024f149dc2071fa3ed8cc1ed75ae26}
        $base_password_099 = {18e674658a87893fc957271c2c002721037735a0393cbfdc294b9d17c04b3dd9}
        $base_password_100 = {31b23ebb39c7fb021f221e4b23466c26bda1c6f6de86d307d1701e92bc5c6bed}
        $base_password_101 = {0ea9a94770a4498fc667dae9ad460f6ae8d661c65c34cd2da4ecbf60482a4e56}
        $base_password_102 = {d3f79d449be6d3614dae4bfbf45a65dc30c6a28cfa70ba9f5c79ffa4a44dfa77}
        $base_password_103 = {4497bbdf7d8f41ca3d8cc531e62b0e17f1b0a3ec205d8b7cd78a207bd81af21c}
        $base_password_104 = {b1aefc2e3d3df97ac9beabafe9b9c6db6a6ac78ac752079edc2719b4420cd1f3}
        $base_password_105 = {bacd22f70a1b71d3d91c82c3d6499e40b365ca7ab7d11993f932483b3e192ef8}
        $base_password_106 = {e650eff06b60c3457d4508538ea693410b5dbcc22fd55528079d6346b6913e9c}
        $base_password_107 = {e22e8c4d8e4f920b959a5e2340f1654b4f210d7ef663a6fd000943b79a82537c}
        $base_password_108 = {b0e0ca3e2f5c4ac4f7a8e8379a4d83e96e906764f30d61f416a5abb027fe2dd7}
        $base_password_109 = {def7150e535fd24a08ba82a207058b7595f2d989ff3b7d15e028c50726f2de05}
        $base_password_110 = {e9f3133d53e5875ba009fda70e881da47af62d7931aa8e11d25318f846f6fd2f}
        $base_password_111 = {ea106c3df6f49896fd953d0c1d5ab09751dd1082879e9459f1ac5137a34f678d}
        $base_password_112 = {5fd3ca55c762ebc5f729d1148381abd45ebb57e559eb3e4a978f823adee9c73e}
        $base_password_113 = {bc919384f37f49eaa81afe2b9ba900f96457debd421c08d9ab8a148a73dbc82f}
        $base_password_114 = {6d5bb360dafc4b821649aeb1f3aeaa5705881547a41d2050a734da1a10a2497d}
        $base_password_115 = {fdfdddd8f9285a107208c165b66cbcbbf4d10299ee23e99557c3af6765f9e462}
        $base_password_116 = {f6c23aefea95ff5c9dc1c1542d7e0f214f12ba3e35a3d38c6683f4cb7cd82e72}
        $base_password_117 = {9a686185fd61e19b22a3ef4f21fe7070102bae45ce82d23505c600819e2ef339}
        $base_password_118 = {9754be94b59f2fd7421e26631d97d42dc28273900445c5090bc68aa9f47de28b}
        $base_password_119 = {d2a02087404f5f826e85e68b1cbab8de3c2b6f4170344a7bfad525ef52077a24}
        $base_password_120 = {a89aace8ea0b6a589050e3ad0a9b8b47c7fa88372fd2b329a7d818fadf931e87}
        $base_password_121 = {2dca6f17d5da6f662a521335ee9e7cb59904ecc8d69ff17e770a78579d96deca}
        $base_password_122 = {614ee23628519c52a4af87924e0347e70733afded3a05c4aaad4a1476a8012cb}
        $base_password_123 = {cef402f6459e48e94ed07b9cd3c283dbf632b9c9d215137de9b5c45335d61f03}
        $base_password_124 = {ca21f910bf41f90d1175a9e5372cc02d5e79f6318e0aae77bf72caf449e9f713}
        $base_password_125 = {0af023ca311dd743928128c9ade8f70c61ed3deff7eb66b65d30aaa61aa1ba24}
        $base_password_126 = {91ddeec3fac6068c472e56f4164d00773a3d663228cce886fc932c1634e63bc6}
        $base_password_127 = {c42989beef8f4b36bda12bd3ee2b4a2869b05a917c431778d6448f0a2acad0ee}
    condition:
        all of ($dotnet_magic_*) and any of ($base_password_*)
}

rule CrowdStrike_CSIR_18014_05 : post_exploitation script stone_panda vbscript 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Identifies custom reconnaissance tool dropper post-exploitation script used by STONE PANDA"
        reports = "CSIR-18014"
        version = "201811300937"
        last_modified = "2018-11-30"
        actor = "STONE PANDA"
    strings:
        $msg_1 = "[-] Error: could not found .net 2.0, stop"
        $msg_2 = "[+] generating subnet.exe ..."
        $msg_3 = "[+] generating tcping.exe ..."
        $file_1 = "subnet_code.tmp"
        $file_2 = "tcping_code.tmp"
    condition:
        2 of them
}

rule CrowdStrike_CSIR_18014_06 : post_exploitation stone_panda 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Identifies custom reconnaissance tool dropper post-exploitation script used by STONE PANDA"
        reports = "CSIR-18014"
        version = "201811300938"
        last_modified = "2018-11-30"
        actor = "STONE PANDA"
    strings:
        $filename = "subnet.exe"
        $func_1 = "GetAllIP"
        $func_2 = "TryParseCIDRNotation"
        $begin = "beginIP"
    condition:
        all of them
}

rule CrowdStrike_CSIT_19143_02 : anubis bankbot dex 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects .dex files from BankBot Anubis APKs"
        reports = "CSIT-19143"
        version = "201908091736"
        last_modified = "2019-08-09"
        malware_family = "BankBot Anubis"
    strings:
        $ = "WebSocket -> Commands"
        $ = "|decryptokey="
        $ = "|enddecrypt"
        $ = ".AnubisCrypt"
    condition:
        all of them
}

rule CrowdStrike_CSIR_18014_04 : post_exploitation stone_panda 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Identifies custom reconnaissance tool dropper post-exploitation script used by STONE PANDA"
        reports = "CSIR-18014"
        version = "201811300932"
        last_modified = "2018-11-30"
        actor = "STONE PANDA"
    strings:
        $run = "This program must be run under Win32" ascii
        $vol = "System Volume-form" ascii
        $hook = "C++HOOK" ascii
        $wide = "DVCLAL" wide
    condition:
        all of them
}

rule CrowdStrike_CSIT_18175_01 : magniber ransomware 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects strings within an unpacked Magniber ransomware sample."
        reports = "CSIT-18175"
        version = "201811231558"
        last_modified = "2018-11-23"
        malware_family = "magniber"
    strings:
        $ = "CryptImportKey"
        $ = "CryptEncrypt"
        $ = "\\recovery" wide
        $ = "\\recycled" wide
        $ = "\\recycler" wide
        $ = "\\system volume information" wide
        $ = "\\windows.old" wide
        $ = "\\windows10upgrade "wide
        $ = "\\windows" wide
        $ = "\\winnt" wide
        $ = "%TEMP%" wide
        $ = "onetoc2" wide
        $ = "wallet" wide
        $ = "backup" wide
    condition:
        12 of them
}

rule CrowdStrike_FANCY_BEAR_Zekapab_01 : downloader fancy_bear zekapab 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Matches on hex-encoded Delphi build timestamp artifacts associated with FANCY BEAR Zekapab malware"
        version = "201810260745"
        last_modified = "2018-10-26"
        actor = "FANCY BEAR"
        malware_family = "Zekapab"
    strings:
        $borland_build_time_stamp = { 50 45 00 00 4c 01 ?? 00 19 5e 42 2a 00 00 00 00 }
        $hex_AudioDrv = "417564696F447276"
        $hex_regid = "72656769643D"
        $hex_plainTotal = "2C20544F54414C3A"
    condition:
        $borland_build_time_stamp and 2 of ($hex_*)
}

rule CrowdStrike_CSIT_18161_01 : downloader javascript ostap 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects obfuscated Ostap samples after they have been decoded from the Windows Script Encoder format."
        reports = "CSIT-18161"
        version = "201811021454"
        last_modified = "2018-11-02"
        malware_family = "Ostap"
    strings:
        $arguments = ",arguments));})("
        $anything = "('anything"
        $songmy = "'songmy"
        $unescape = "return unescape("
    condition:
        ($unescape and $songmy) and #arguments > 10 and #anything > 10
}

rule CrowdStrike_FANCY_BEAR_Zekapab_02 : downloader fancy_bear zekapab 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Identifies FANCY BEAR Zekapab malware through distinctive hex-encoded artifacts"
        version = "201810260747"
        last_modified = "2018-10-26"
        actor = "FANCY BEAR"
        malware_family = "Zekapab"
    strings:
        $borland_build_time_stamp = { 50 45 00 00 4c 01 ?? 00 19 5e 42 2a 00 00 00 00 }
        // "?id_name="
        $hex_encoded_2 = "3F69645F6E616D653D"
        // "Enter password to open file"
        $hex_encoded_1 = "456E7465722070617373776F726420746F206F70656E2066696C65"
    condition:
        all of them
}

rule CrowdStrike_CSIT_18166_03  : rat wicked_panda winnti 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects Winnti's unique x64 export hashing code"
        reports = "CSIT-18166"
        version = "201903061217"
        last_modified = "2019-03-06"
        actor = "WICKED PANDA"
        malware = "Winnti"
    strings:
        $export_hash_routine = { 69 C0 83 00 00 00 0F BE D2 03 C2 48 FF C1 8A 11 84 D2  }
    condition:
        all of them
}

rule CrowdStrike_CSIT_18166_02 : rat wicked_panda winnti 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects known plaintext under XOR with key 0x36 and nibble swap"
        reports = "CSIT-18166"
        version = "201903061216"
        last_modified = "2019-03-06"
        actor = "WICKED PANDA"
        malware = "Winnti"
    strings:
        // This is the word "constructor" under XOR 0x36 with a nibble swap.
        $encstr = { 00 C0 D0 01 71 11 61 00 71 C0 11 34 A0 }
    condition:
        all of them
}

rule CrowdStrike_CSIT_18166_01 : rat wicked_panda winnti 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects PE files with a Winnti-specific section named .SLT"
        reports = "CSIT-18166"
        version = "202105101912"
        last_modified = "2021-05-10"
        actor = "WICKED PANDA"
        malware = "Winnti"
    strings:
        // Characteristic PE section name .SLT
        $sectname = { 2e 53 4c 54 00 00 00 00 00 10 00 00 00 }
    condition:
        all of them
}

rule CrowdStrike_CSIT_18178_01 : netbios_p0f post_exploitation snake venomous_bear 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects a VENOMOUS BEAR tool called netbios_p0f"
        reports = "CSIT-18178"
        version = "202001201647"
        last_modified = "2020-01-20"
        actor = "VENOMOUS BEAR"
        malware_family = "netbios_p0f"
    strings:
        // 9b0a1d1ee9a8082f154134be464a131d7a01df7d487538a077f1d7cf4db10578 @ 0x41c227
        $bytes_0x41c227_0x41c28a  = { 8b 8d f4 a2 ff ff 83 c1 01 89 8d f4 a2 ff ff 8b 95 f4 a2 ff ff 3b 55 fc 7d 39 8b 85 f4 a2 ff ff 69 c0 74 01 00 00 83 bc 05 50 a3 ff ff 03 75 21 8b 8d f4 a2 ff ff 69 c9 74 01 00 00 83 bc 0d 44 a3 ff ff 02 75 0b 8b 55 08 c7 02 01 00 00 00 eb 02 }
    condition:
        any of them
}

rule CrowdStrike_CSIT_19000_01 : helix_kitten rat razorrat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects technique used by RazorRAT to check for US and Iranian keyboard layouts"
        reports = "CSIT-19000"
        version = "201904030020"
        last_modified = "2019-04-03"
        actor = "HELIX KITTEN"
        malware_family = "RazorRAT"
    strings:
        $x86_check_us = { 89 [2] e8 [4-7] 3d 09 04 09 04 }
        $x86_check_ir = { 3d 29 04 29 04 }
    condition:
        all of them and
        filesize < 500KB
}

rule CrowdStrike_VENOMOUS_BEAR_BigBoss_01 : bigboss venomous_bear 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects handshake protocol messages used by VENOMOUS BEAR's BigBoss tool"
        reports = "CSIT-19052"
        version = "202103171835"
        last_modified = "2021-03-17"
        actor = "VENOMOUS BEAR"
        malware_family = "BigBoss"
    strings:
        $ = { B1 9B 05 5C A1 1C AC A0 }
        $ = { CA CA 05 AC CE 55 F1 1E }
    condition:
        any of them
}

rule CrowdStrike_CSIT_19000_02 : helix_kitten rat razorrat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects RazorRAT samples through the identification of a specific ASCII string formatting technique"
        reports = "CSIT-19000"
        version = "202010022038"
        last_modified = "2020-10-02"
        actor = "HELIX KITTEN"
        malware_family = "RazorRAT"
    strings:
        $variant_1 = { b9 3e 00 00 00 99 f7 f9 83 fa 19 7f ?? 83 c2 61 eb ?? 83 fa 33 7f ?? 83 c2 27 eb ?? 83 ea 04 66 [2] 83 c3 02 39 ?? 75 }
        $variant_2 = { 83 c2 61 66 [3] 83 c5 02 39 ?? 74 ?? e8 [4] 89 c1 f7 eb 89 c8 c1 f8 1f 01 ca c1 fa 05 29 c2 6b d2 3e 29 d1 83 ?? 19 89 ca 7e ?? 83 ?? 33 7f ?? 83 c2 27 83 c5 02 66 [3] 39 ?? 75 }
        $variant_3 = { be 02 00 00 00 8d ?? 3c 8d [2] 00 00 00 00 e8 [4] 99 f7 ?? 83 ?? 1a 7d ?? 8d ?? 61 eb ?? 8d ?? 27 83 ?? 34 7c ?? 8d ?? fc 8b ?? 83 ?? 02 66 [4] 83 ?? 12 }
    condition:
        uint16(0) == 0x5a4d and any of them
}

rule CrowdStrike_CSIT_18159_01 : foundation installer nsis_installer 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects NSIS setup files with a modified marker which is associated with the Foundation malware framework."
        reports = "CSIT-18159"
        version = "201909061936"
        last_modified = "2019-09-06"
        malware_family = "Foundation Malware Framework"
    strings:
        $err_1 = "Installer integrity check has failed. Common causes include\x0aincomplete download and damaged media. Contact the\x0ainstaller's author to obtain a new copy.\x0a\x0aMore information at:"
        $err_2 = "http://nsis.sf.net/NSIS_Error"
        $err_3 = "Error writing temporary file. Make sure your temp folder is valid."
        $err_4 = "verifying installer: %d%%"
        $nsis_unpack_long = {
        81 BD ?? F? FF FF EF BE AD DE (75 ?? | 0F 85 ?? 00 00 00)
        81 BD ?? F? FF FF 49 6E 73 74 (75 ?? | 0F 85 ?? 00 00 00)
        81 BD ?? F? FF FF 73 6F 66 74 (75 ?? | 0F 85 ?? 00 00 00)
        81 BD ?? F? FF FF 4E 75 6C 6C (75 ?? | 0F 85 ?? 00 00 00) }
        $nsis_unpack_short = {
        81 7D ?? EF BE AD DE (75 ?? | 0F 85 ?? 00 00 00)
        81 7D ?? 49 6E 73 74 (75 ?? | 0F 85 ?? 00 00 00)
        81 7D ?? 73 6F 66 74 (75 ?? | 0F 85 ?? 00 00 00)
        81 7D ?? 4E 75 6C 6C (75 ?? | 0F 85 ?? 00 00 00)}
        $nsis_unpack_marker = {
        EF BE AD DE 4E 75 6C 6C 73 6F 66 74 49 6E 73 74 }
        $pe_header = { 50 45 00 00 4C 01 0? 00 }
        $mod_00 = { ?? be ad de 4e 75 6c 6c 73 6f 66 74 49 6e 73 74 }
        $mod_01 = { ef ?? ad de 4e 75 6c 6c 73 6f 66 74 49 6e 73 74 }
        $mod_02 = { ef be ?? de 4e 75 6c 6c 73 6f 66 74 49 6e 73 74 }
        $mod_03 = { ef be ad ?? 4e 75 6c 6c 73 6f 66 74 49 6e 73 74 }
        $mod_04 = { ef be ad de ?? 75 6c 6c 73 6f 66 74 49 6e 73 74 }
        $mod_05 = { ef be ad de 4e ?? 6c 6c 73 6f 66 74 49 6e 73 74 }
        $mod_06 = { ef be ad de 4e 75 ?? 6c 73 6f 66 74 49 6e 73 74 }
        $mod_07 = { ef be ad de 4e 75 6c ?? 73 6f 66 74 49 6e 73 74 }
        $mod_08 = { ef be ad de 4e 75 6c 6c ?? 6f 66 74 49 6e 73 74 }
        $mod_09 = { ef be ad de 4e 75 6c 6c 73 ?? 66 74 49 6e 73 74 }
        $mod_0A = { ef be ad de 4e 75 6c 6c 73 6f ?? 74 49 6e 73 74 }
        $mod_0B = { ef be ad de 4e 75 6c 6c 73 6f 66 ?? 49 6e 73 74 }
        $mod_0C = { ef be ad de 4e 75 6c 6c 73 6f 66 74 ?? 6e 73 74 }
        $mod_0D = { ef be ad de 4e 75 6c 6c 73 6f 66 74 49 ?? 73 74 }
        $mod_0E = { ef be ad de 4e 75 6c 6c 73 6f 66 74 49 6e ?? 74 }
        $mod_0F = { ef be ad de 4e 75 6c 6c 73 6f 66 74 49 6e 73 ?? }
    condition:
        uint16(0) == 0x5A4D and $pe_header at uint32(0x3C)
        and 3 of ($err_*)
        and 1 of ($mod_*)
        and filesize > 500KB
        and filesize < 2MB
        and not any of ($nsis_unpack_*)
}

rule CrowdStrike_CSA_18931_01 : jscript radador script 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects the Radador JScript downloader."
        reports = "CSA-18931"
        version = "202008311112"
        last_modified = "2020-08-31"
        malware_family = "Radador JScript"
    strings:
        $req1 = "JScript"
        $req2 = "<![CDATA["
        $opt1 = "radador"
        $opt2 = "pingadori"
        $opt3 = "smaeVar"
        $opt4 = "xLuciferxs"
        $opt5 = "xCaverax"
        $opt6 = "xVRXastaroth"
        $opt7 = "xVRXastaroth2"
    condition:
        all of ($req*) and any of ($opt*)
}

rule CrowdStrike_CSA_18936_01 : downloader powershell sload 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects the sLoad downloader written in PowerShell."
        reports = "CSA-18936,CSIT-19011"
        version = "201901292239"
        last_modified = "2019-01-29"
        malware_family = "sLoad Downloader"
    strings:
        $a = "$key=@(1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16)" wide ascii
        $b = "start-process -wiNdowStylE HiDden $dm0 $ldf;" nocase wide ascii
        // detects new version 20190129 MD5: a9a8914a75e71945ce32a39af600d9a1
        $c = "'\\web.ini'" wide ascii
        $d = "=@(1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16)" wide ascii
    condition:
        ($a or $b) or ($c and $d)
}

rule CrowdStrike_KrakenRansomware : ecrime kraken ransomware 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects strings present in Kraken ransomware in an unpacked state."
        reports = "CSIT-19001"
        version = "201901021438"
        last_modified = "2019-01-02"
        malware_family = "Kraken Ransomware"
    strings:
        $ = "Kraken Cryptor"
        $ = "version"
        $ = "module"
        $ = "target_extensions"
    condition:
        all of them
}

rule CrowdStrike_CSA_18931_02 : astaroth banking guildma rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects Guildma malware associated with Brazilian banking schemes."
        reports = "CSA-18931"
        version = "202009010921"
        last_modified = "2020-09-01"
        malware_family = "Guildma"
    strings:
        $ = "BTMEMO" wide ascii
        $ = "Embarcadero Delphi"
    condition:
        all of them
}

rule CrowdStrike_CSA_18931_03 : downloader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects LNK files pointing to WMIC which has been observed to download Brazilian banking malware."
        reports = "CSA-18931"
        version = "202008311113"
        last_modified = "2020-08-31"
    strings:
        $ = "WMIC.exe os get /format" wide
        $ = "imageres.dll" wide
    condition:
        uint32(0) == 0x0000004c and all of them and filesize < 1536
}

rule CrowdStrike_CSIT_18161_02 : downloader lnk ostap 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects a malicious LNK file used to launch the Ostap JSE downloader."
        reports = "CSIT-18161"
        version = "201811021456"
        last_modified = "2018-11-02"
    strings:
        $cmd_exe = "cmd.exe"
        $jse = ".jse" wide
        $docopy = "do (copy /Y %F" wide
    condition:
        uint32(0) == 0x0000004C and filesize < 2KB and #cmd_exe > 1 and #jse > 2 and $docopy
}

rule Crowdstrike_dr9_RAT_01 : dr9 rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule matches on strings found in dr9 RAT."
        reports = "CSIT-18192"
        version = "201903011754"
        last_modified = "2019-03-01"
        malware_family = "dr9 RAT"
    strings:
        $ = "mutexdllabc" ascii
        $ = "c:\\windows\\linkinfo.dll" ascii
        $ = "Lo*ckR#e(so*urce" ascii
        $ = "type %d, lnk:%s, f:%s" ascii
        $ = "Fin#dRes#ou*r*ce)A" ascii
        $ = "Loa(dRe*so)ur#ce" ascii
        $ = "Siz(eof*Res)ou#rce" ascii
        $ = "pData or pEnc is null" ascii
        $ = "%s%.8x.dmp" ascii
        $ = "pRegQueryValueExA not ERROR_FILE_NOT_FOUND" ascii
        $ = "tmutexabc" ascii
        $ = "%dOK%d" ascii
    condition:
        7 of them and filesize < 80000000
}

rule Crowdstrike_dr9_RAT_03 : dr9 rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects custom cryptographic routines found in dr9 RAT."
        reports = "CSIT-18192"
        version = "201903011753"
        last_modified = "2019-03-01"
        malware_family = "dr9 RAT"
    strings:
        $permutate_key = {8A 04 37 8A D0 8A D8 80 E2 30 C0 EB 04 0A D3 8A D8 80 E3 0C C0 E0 04 0A D8 C0 EA 02 C0 E3 02 0A D3 88 16 46 FF 4D ?? 75 D7}
        $permutate_round_key = {8A 17 C0 EA 07 39 74 24 ?? 7E 2A 53 8B 5C 24 ?? 8D 04 3E D0 20 8A 08 4B 3B F3 75 06 0A CA 88 08 EB 0B 8A 5C 3E ?? C0 EB 07 0A D9 88 18 46 3B 74 24 ?? 7C D8}
    condition:
        any of them
}

rule CrowdStrike_CSA_18958_01 : module psfin trickbot 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects strings present in the TrickBot module psfin after decryption."
        reports = "CSA-18958"
        version = "202103190007"
        last_modified = "2021-03-19"
        malware_family = "TrickBot"
    strings:
        $ = "Start"
        $ = "Control"
        $ = "Release"
        $ = "<moduleconfig>"
        $ = "(&(objectCategory=computer)(dNSHostName=%s))" wide
        $ = "(&(objectCategory=person)(sAMAccountName=%s))" wide
        $ = "(&(objectCategory=group)(cn=%s))" wide
        $ = "*POS*" wide
        $ = "*REG*" wide
        $ = "*CASH*" wide
        $ = "*LANE*" wide
        $ = "*STORE*" wide
        $ = "*RETAIL*" wide
        $ = "*BOH*" wide
        $ = "*ALOHA*" wide
        $ = "*MICROS" wide
    condition:
        14 of them
}

rule CrowdStrike_FANCY_BEAR_ZekapabDotNet_MSILCode_01 : artifact downloader fancy_bear zekapab 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Matches on MSIL bytecode in the .NET variant of FANCY BEAR's Zekapab malware"
        reports = "CSA-181038"
        version = "201903061223"
        last_modified = "2019-03-06"
        actor = "FANCY BEAR"
        malware_family = "Zekapab"
    strings:
        $ = { 00 00 0A 18 5D 2C 02 14 2A 02 72 }
        $ = { 00 00 0A 9C 07 17 58 0B 07 06 8E 69 32 E0 06 2A }
        $ = { 00 70 14 16 12 00 12 01 16 14 16 28 }
    condition:
        all of them
}

rule CrowdStrike_CSA_18985_01 : carbon_spider dropper harpy macro office 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects obfuscation used in Harpy macro dropper document in use by CARBON SPIDER."
        reports = "CSA-18985"
        version = "201811281606"
        last_modified = "2018-11-28"
        actor = "CARBON SPIDER"
        malware = "harpy"
    strings:
        $marcro = "Document decryption error"
        $var1 = "= 'var';function"
        $var2 = "= 'var';var"
        $var3 = "= 'var';return"
    condition:
        3 of them
}

rule CrowdStrike_CSIT_18180_02 : downloader fancy_bear godown 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule matches on hex encoded strings within GoDown malware in use by FANCY BEAR."
        reports = "CSIT-18180"
        version = "201811281548"
        last_modified = "2018-11-28"
        actor = "FANCY BEAR"
        malware_family = "GoDown"
    strings:
        $systeminfo = "5C5C4964656E7469746965735C5C7B38334146313337382D393836462D313637332D303931412D3032363831464136324333427D5C5C7733327372762E657865"
        $go_indicator = " Go build ID:"
    condition:
        uint16(0) == 0x5a4d and all of them
}

rule CrowdStrike_CSIT_18180_01 : downloader fancy_bear godown 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule matches on hex encoded strings within GoDown malware in use by FANCY BEAR."
        reports = "CSIT-18180"
        version = "201811281547"
        last_modified = "2018-11-28"
        actor = "FANCY BEAR"
        malware_family = "GoDown"
    strings:
        $systeminfo = "73797374656D696E666F"
        $PrgStart = "50726753746172743A"
        $go_indicator = " Go build ID:"
    condition:
        uint16(0) == 0x5a4d and all of them
}

rule CrowdStrike_CSIT_18198_01 : cobalt_spider cobint shellcode 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects shellcode used by COBALT SPIDER's COBINT malware to unpack other malicious code."
        reports = "CSIT-18198"
        version = "201903121509"
        last_modified = "2019-03-12"
        actor = "COBALT SPIDER"
        malware_family = "COBINT"
    strings:
        $get_mod_handle_hash = { 68 70 65 86 B1 }
        $get_proc_address_hash = { 68 FF 1F 7C C9 }
        $shellcode_str = "shellcode"
    condition:
        all of them
}

rule CrowdStrike_CSIT_18180_03 : downloader fancy_bear godown 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule matches on hex encoded string within GoDown malware in use by FANCY BEAR."
        reports = "CSIT-18180"
        version = "201811281548"
        last_modified = "2018-11-28"
        actor = "FANCY BEAR"
        malware_family = "GoDown"
    strings:
        $guid = "38334146313337382D393836462D313637332D303931412D303236383146413632433342"
        $go_indicator = " Go build ID:"
    condition:
        uint16(0) == 0x5a4d and all of them
}

rule CrowdStrike_CSA_18984_01 : downloader labyrinth_chollima slumber 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects the strings present in a downloader observed being dropped by a LABYRINTH CHOLLIMA macro dropper document."
        reports = "CSA-18984,CSIT-19013"
        version = "201901231719"
        last_modified = "2019-01-23"
        actor = "LABYRINTH CHOLLIMA"
        malware_family = "Slumber"
    strings:
        $ = "sleep"
        $ = "CFE:%08x"
        $ = "GFSE:%08x"
        $ = "LAE:%08x"
        $ = "RFE:%08x"
        $ = "CPE:%08x"
        $ = "DFE:%08x"
        $ = "cmd.exe /c %s > %s 2>&1"
    condition:
        3 of them
}

rule CrowdStrike_CSA_18984_02 : dropper labyrinth_chollima twoup 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects the dropper used to install the TwoUp RAT."
        reports = "CSA-18984,CSIT-19013"
        version = "201901231720"
        last_modified = "2019-01-23"
        actor = "LABYRINTH CHOLLIMA"
        malware_family = "TwoUp"
    strings:
        $ = "qnq1EITtFOO0WhtVWhOVrq0hTz0OdsK0z"
        $ = "-0zKOsphsVW"
        $ = "q0OdsK0-rr"
        $ = "%qczh05RVVh%Tqczh057DTzdKMVzh.0C08SB8W0hzdKz"
    condition:
        4 of them
}

rule CrowdStrike_CSA_18984_03 : dropper labyrinth_chollima 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects the loader for TwoUp RAT in use by LABYRINTH CHOLLIMA."
        reports = "CSA-18984,CSIT-19013"
        version = "201901231723"
        last_modified = "2019-01-23"
        actor = "LABYRINTH CHOLLIMA"
        malware_family = "TwoUp"
    strings:
        $ = {41 88 00 FF C0 49 FF C0 3D 00 01 00 00 7C F1}
        $ = {41 8B C1 25 03 00 00 80}
        $ = {C7 ?? ?? ?? DE 49 00 00}
        $ = "ServiceMain"
    condition:
        all of them
}

rule CrowdStrike_CSA_18984_04 : labyrinth_chollima rat twoup 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects the TwoUp RAT payload in use by LABYRINTH CHOLLIMA."
        reports = "CSA-18984,CSIT-19013"
        version = "201901231724"
        last_modified = "2019-01-23"
        actor = "LABYRINTH CHOLLIMA"
        malware_family = "TwoUp"
    strings:
        $array = "YhTk4PZO/0VDb7t\\JULzrKeo2G3CXA89slcfqgWIxQN 5iayFSdnM1B6_mjHwu-v"
        $httpheader = "tVWh0WhS1cp0:8lpprsKlhsVWHCSyyySeVO5SFOr0WKVg0g"
        $httpdata = "z0zzsVWz=%wNC&z0KsWeV="
        $format1 = "%08x%08x%08x"
        $format2 = "%04x%04x%04x%04x"
    condition:
        3 of them
}

rule CrowdStrike_CSA_18984_05 : keylogger labyrinth_chollima stealer 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects the key logger and clipboard stealer deployed by LABYRINTH CHOLLIMA."
        reports = "CSA-18984,CSIT-19013"
        version = "201901231725"
        last_modified = "2019-01-23"
        actor = "LABYRINTH CHOLLIMA"
    strings:
        $file1 = "FontCaches.dat"
        $file2 = "StreamCaches.db"
        $iplog = "************************* [%s %s] --- [IP Change] --- [%s] ******"
        $timestamp = "************************* [%hd/%02hd/%02hd %02hd:%02hd:%02hd] ---"
    condition:
        2 of them
}

rule CrowdStrike_CSA_18984_06 : keccak_loader labyrinth_chollima loader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects the environmentally keyed from computer name Keccak loader for an unknown payload."
        reports = "CSA-18984,CSIT-19013"
        version = "201901231727"
        last_modified = "2019-01-23"
        actor = "LABYRINTH CHOLLIMA"
        malware = "Keccak Loader"
    strings:
        $k32 = {66 7F FC B1}
        $cmd = {01 46 45 E0}
        $array = "0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz!#$&)*+,:;<=>?@]^_`{|}~"
        $aes = {63 7C 77 7B F2 6B 6F C5 30 01 67 2B FE D7 AB 76}
    condition:
        all of them
}

rule CrowdStrike_CSA_18992_02 : malicious_document 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects documents observed downloading an MSI file to install a RAT."
        reports = "CSA-18992"
        version = "201902071747"
        last_modified = "2019-02-07"
    strings:
        $doc_header = {d0 cf 11 e0 a1 b1 1a e1}
        $guid = "Begin {C62A69F0-16DC-11CE-9E98-00AA00574A4F} ZclBlack"
    condition:
        $doc_header at 0 and $guid
}

rule CrowdStrike_CSA_18992_01 : backnet rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects the open-source C# RAT called BackNet."
        reports = "CSA-18992"
        version = "201902071749"
        last_modified = "2019-02-07"
        malware = "BackNet"
    strings:
        $ = "ThisIsMyMutex-2JUY34DE8E23D7" wide
        $ = "/Slave;component/mainwindow.xaml" wide
        $ = "<botnetAdress>k__BackingField"
    condition:
        uint16(0) == 0x5a4d and any of them
}

rule CrowdStrike_MaliciousChromeExtension_ContentScript : chrome_extension 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule alerts on a decompressed copy of a malicious Chrome extension which was used to harvest cookies and form data."
        reports = "CSIT-19018"
        version = "202011240001"
        last_modified = "2020-11-24"
        actor = "VELVET CHOLLIMA"
        malware_family = "Malicious Chrome Extension Cookie Stealer"
    strings:
        $s6 = "){sessionStorage.setItem(\"s6\",e)})"
        $dino_handshake = "dino_handshake"
        $chuan_talk_ba = "chuan_talk_ba"
        $ulti_huwai_chanke = "ulti_huwai_chanke"
        $check1 = /\.id==[a-z]&&\([a-z]=\!0\);if/
        $check2 = /\.id==[a-z]&&\([a-z]=\!0\)\}if\(\![a-z]\)\{var/
        $message = ".id,chrome.tabs.sendMessage(TabId,"
    condition:
        any of them
}

rule CrowdStrike_Malicious_ChromeExtension_BackgroundScript
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule alerts on strings found in a background script used by a malicious Chrome extension."
        reports = "CSIT-19018"
        version = "202011240001"
        last_modified = "2020-11-24"
        actor = "VELVET CHOLLIMA"
        malware_family = "Malicious Chrome Extension Cookie Stealer"
    strings:
        $ = "function getAllCookies()"
        $ = "chrome.cookies.getAll("
        $ = "chrome.tabs.sendMessage("
        $ = "manage.js"
    condition:
        3 of them
}

rule CrowdStrike_CSIT_19020_01 : delivery_document threadkit 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects first version ThreadKit documents"
        reports = "CSIT-19020"
        version = "201905061717"
        last_modified = "2019-05-06"
        malware_family = "ThreadKit"
    strings:
        $rtf = { 7b 5c 72 74 66 31 }
        //ParT1.BiN - First half of dropped PE to be reassembled
        $fname = "50617254312e42694e"
    condition:
        $rtf at 0 and $fname
}

rule CrowdStrike_CSIT_19020_02 : delivery_document threadkit 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects second version ThreadKit documents"
        reports = "CSIT-19020"
        version = "201905061717"
        last_modified = "2019-05-06"
        malware_family = "ThreadKit"
    strings:
        $rtf = { 7b 5c 72 74 66 31 }
        $executable_name = "6d6f6e64692e657865"
        $sct_name = "74726261746568747165767961792e536354"
    condition:
        $rtf at 0 and $executable_name and $sct_name
}

rule CrowdStrike_CSIT_18194_02 : mfix phorpiex unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule matches on the MFix utility deployed by Phorpiex HTTP Downloader to remove old Phorpiex versions"
        reports = "CSIT-18194"
        version = "201812140925"
        last_modified = "2018-12-14"
        malware_family = "Phorpiex MFix"
    strings:
        $proc1 = "\\svchostx64.exe" wide
        $proc2 = "winupdsrvc.exe"
        $proc3 = "wincfg.exe"
        $proc4 = "wincfg32.exe"
        $proc5 = "winupd.exe"
        $proc6 = "winupd32.exe"
        $proc7 = "winsrvc32.exe"
        $proc8 = "winsvcinstl.exe"
        $proc9 = "winupsvcmgr.exe"
        $proc10 = "winupd32cfg.exe"
        $proc11 = "winmgr32cfg.exe"
        $name1 = "Windows Update Services" wide
        $name2 = "Windows Update Service Manager" wide
        $name3 = "Microsoft Update 495036" wide
        $name4 = "Microsoft Windows Service Installer" wide
        $name5 = "Microsoft Windows Driver Configuration" wide
        $name6 = "Microsoft Windows Installer Svc" wide
        $api1 = "OpenProcess"
        $api2 = "TerminateProcess"
        $api3 = "CreateToolhelp32Snapshot"
        $api4 = "Process32Next"
        $api5 = "RegDeleteValueW"
        $api6 = "DeleteFileW"
    condition:
        5 of ($proc*) and 1 of ($name*) and 4 of ($api*)
}

rule CrowdStrike_CSA_181166_01 : labyrinth_chollima rat sheeprat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "SheepRAT malware used by LABYRINTH CHOLLIMA"
        reports = "CSA-181166"
        version = "201812140937"
        last_modified = "2018-12-14"
        actor = "LABYRINTH CHOLLIMA"
        malware_family = "SheepRAT"
    strings:
        $str_jquery = "jquery2017%d%d09.css" fullword
        $str_shellredir = "%s \"%s > %s\" %s" wide fullword
        $str_uriform1 = "%s%d&page=suggestion%s%d&name=%s" fullword
        $str_uriform2 = "%s%d&page=free%s%d" fullword
    condition:
        2 of them
}

rule CrowdStrike_CSIT_18185_02 : azorult infostealer stealer 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects version 3.3 of the Azorult information stealing malware"
        reports = "CSIT-17176,CSIT-18185"
        version = "202002251656"
        last_modified = "2020-02-25"
        malware_family = "Azorult"
    strings:
        $s_1 = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/" ascii
        $s_2 = "Coins" wide
        $s_3 = "TSwdPwd" ascii
        $s_4 = "TPwdArray" ascii
        $s_5 = "http://ip-api.com/json" ascii
        $s_6 = "D877F783D5*,map*" wide
        $s_7 = "RGlzcGxheVZlcnNpb24=" ascii
        $s_8 = "353E77DF-928B-4941-A631-512662F0785A3061-4E40-BBC2-3A27F641D32B-54FF-44D7-85F3-D950F519F12F" ascii
        $code_string_decryption_1 = { 8b 55 fc 8b 4d f4 8a 54 0a ff 8b 4d f8 8a 4c 19 ff 32 d1 e8 [4] 8b 55 ec 8b c7 e8 [4] 43 3b 5d f0 7e 05 bb 01 00 00 00 }
        $code_string_decryption_2 = { 8b 55 fc 8b 12 8a 54 32 ff 8b 4d f8 8a 4c 19 ff 32 d1 88 54 30 ff 43 3b 5d f4 7e 05 bb 01 00 00 00 }
        $code_custom_c2_decode = { c6 07 ?? c6 47 01 ?? c6 47 02 ?? c6 47 03 ?? c6 47 04 ?? c6 47 05 ?? c6 47 06 ?? c6 47 07 ?? c6 47 08 ?? c6 47 09 ?? c6 47 0a ?? c6 47 0b ?? c6 47 0c ?? c6 47 0d ?? c6 47 0e ?? c6 47 0f ?? c6 47 10 d8 }
        $code_custom_hash = { ba 01 00 00 00 8b 4d fc 0f b6 4c 11 ff 81 f1 8a 45 21 65 03 d9 8b cb c1 e1 0d 8b f3 c1 ee 13 0b ce 2b d9 42 48 75 de }
    condition:
        6 of ($s_*) and any of ($code_string_decryption_*) and all of ($code_custom_*)
}

rule CrowdStrike_CSIT_18183_01 : backconfig viceroy_tiger 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects unique decoding routine using switch statement as observed in BackConfig plugins."
        reports = "CSIT-18183"
        version = "202106081531"
        last_modified = "2021-06-08"
        actor = "VICEROY TIGER"
        malware_family = "BackConfig"
    strings:
        /*
        mov     dl, [edx+eax]
        sub     dl, cl
        mov     edi, esi
        sub     dl, 4
        mov     ecx, 1
        */
        $a1 = { 8a 14 02 2a d1 8b fe 80 ea 04 b9 01 00 00 00 }
        /*
        mov     dl, [edx+eax]
        mov     edi, [esi]
        sub     dl, cl
        sub     dl, 13h
        mov     ecx, 2
        */
        $a2 = { 8a 14 02 8b 3e 2a d1 80 ea 13 b9 02 00 00 00 }
        /*
        mov     al, [eax+ecx]
        sub     al, bl
        sub     al, 13h
        mov     [edx+ecx], al
        inc     ecx
        */
        $b1 = { 8a 04 08 2a c3 2c 13 88 04 0a 41 }
        /*
        mov     al, [eax+ecx]
        sub     al, bl
        sub     al, 4
        mov     [edx+ecx], al
        inc     ecx
        */
        $b2 = { 8A 04 08 2A C3 2C 04 88 04 0A 41 }
    condition:
        uint16(0) == 0x5A4D
        and uint32(uint32(0x3C)) == 0x00004550
        and ( all of ($a*) and #a1 >=2 and #a2 >= 2) or (all of ($b*) and #b1 >= 2 and #b2 >= 2)
        and filesize < 500KB
}

rule CrowdStrike_CSIT_18183_02 : backconfig viceroy_tiger 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects the BackConfig keylogger plugin used by Viceroy Tiger."
        reports = "CSIT-18183"
        version = "201812071846"
        last_modified = "2018-12-07"
        actor = "VICEROY TIGER"
        malware_family = "BackConfig"
    strings:
        $a1 = "\\Printers"
        $a2 = "\\Neighbourhood"
        $a3 = "\\Spools"
        $a4 = "GetAsyncKeyState"
    condition:
        uint16(0) == 0x5A4D
        and uint32(uint32(0x3C)) == 0x00004550
        and all of ($a*)
        and filesize < 300KB
}

rule CrowdStrike_CSIT_18194_01 : downloader phorpiex unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects a Phorpiex-related malware that downloads additional payloads based on geolocation"
        reports = "CSIT-18194"
        version = "201812201500"
        last_modified = "2018-12-20"
        malware_family = "Phorpiex Geo Loader"
    strings:
        $s1 = "Mozilla/5.0 (Macintosh; Intel Mac OS X 10.9; rv:25.0) Gecko/20100101 Firefox/25.0" wide
        $s2 = ".exe" wide
        $s3 = ".txt" wide
        $s4 = "InternetReadFile"
        $s5 = "InternetOpenUrlA"
        $s6 = "InternetOpenUrlW"
        $geo1 = "http://api.wipmania.com/"
        $geo2 = "/geo.php"
        $payload = "http://" wide
        $exe = ".exe" wide
        $c1 = { 99 b9 60 ea 00 00 f7 f9 81 c2 10 27 00 00 52 e8 }
        $c2 = { 8a 10 3a 11 75 1a 84 d2 74 12 8a 50 01 3a 51 01 75 0e 83 c0 02 83 c1 02 84 d2 }
    condition:
        all of ($s*) and
        1 of ($geo*) and
        $payload and
        $exe and
        all of ($c*)
}

rule CrowdStrike_CSA_181014_01 : labyrinth_chollima rat wolfrat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects LABRYINTH CHOLLIMA's WolfRAT tool which has structural similarities to Hawup."
        reports = "CSA-181014,CSA-18253"
        version = "202001292113"
        last_modified = "2020-01-29"
        actor = "LABYRINTH CHOLLIMA"
        malware_family = "WolfRAT"
    strings:
        $xor_code = {30 84 0D 8C FE FF FF 04 ?? 41 ?? ?? 81 F9}
        $ssl1 = "CLNTSRVRclient finished"
        $ssl2 = "SRVRclient finished"
        $temp = {5A 00 44 00 00 00 00 00 50 00 4D 00}
        $cmd = {25 00 73 00 20 00 22 00 25 00 73 00 20 00 3E 00 20 00 25 00 73 00 22 00 20 00 25 00 73 00}
    condition:
        all of them
}

rule CrowdStrike_CSIT_19013_01 : darkedge labyrinth_chollima rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects LABYRINTH CHOLLIMA's DarkEdge RAT using RC4/base64 strings and HTTP for C2"
        reports = "CSIT-19013"
        version = "201902011717"
        last_modified = "2019-02-01"
        actor = "LABYRINTH CHOLLIMA"
        malware = "DarkEdge"
    strings:
        $str1 = "wVTPeoyw1g=="
        $str2 = "3VHJd7mxyuJGZrAFQ+Xtzts="
        $str3 = "0VPJeJ2m9fNMdqZWdbfa09vdtCDcIYU="
        $str4 = "wUTYWpyx1+RNYYdMdPL81cbAv1/ZAN5gn8E=z"
        $fmt1 = "%s|%s Free/%s" wide
        $fmt2 = "%s|%I64d" wide
        $fmt3 = "%d|%d|%I64u" wide
        $fmt4 = "%s|%s|%s" wide
    condition:
        2 of ($str*) and 2 of ($fmt*)
}

rule CrowdStrike_CSA_181135_01 : chollima_lego goldstamp infostealer keylogger velvet_chollima 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects encoded strings found in VELVET CHOLLIMA tools. "
        reports = "CSA-181135"
        version = "201908191855"
        last_modified = "2019-08-19"
        actor = "VELVET CHOLLIMA"
        malware_family = "GoldStamp"
    strings:
        $str_enc_1  = "GrmhGpqomouV" fullword
        $str_enc_2  = "LxkIorfMhhoxjj" fullword
        $str_enc_3  = "txozxg32?hgg" fullword
    condition:
        all of them
}

rule CrowdStrike_FANCY_BEAR_TrsLoader_32Bit_01 : fancy_bear trsloader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects the 32-bit version of FANCY BEAR's TrsLoader tool."
        version = "201903061221"
        last_modified = "2019-03-06"
        actor = "FANCY BEAR"
        malware_family = "TrsLoader"
    strings:
        $ = { 25 FF 0F 00 00 03 C7 03 02 01 18 83 C6 02 FF 4D }
    condition:
        all of them
}

rule CrowdStrike_FANCY_BEAR_TrsLoader_64Bit_01 : fancy_bear trsloader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects the 64-bit version of FANCY BEAR's TrsLoader tool."
        version = "201903061221"
        last_modified = "2019-03-06"
        actor = "FANCY BEAR"
        malware_family = "TrsLoader"
    strings:
        $ = { 48 63 4B 3C 81 3C 19 50 45 00 00 75 10 8B 44 19 }
    condition:
        all of them
}

rule CrowdStrike_FANCY_BEAR_TrsLoader_32Bit_02 : fancy_bear trsloader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects an obfuscated version FANCY BEAR's TrsLoader tool when compiled for 32-bit systems."
        version = "201903061221"
        last_modified = "2019-03-06"
        actor = "FANCY BEAR"
        malware_family = "TrsLoader"
    strings:
        $ = { 88 45 FF 84 D2 75 E1 43 3B DF 72 CC 5B 8B E5 5D }
    condition:
        all of them
}

rule CrowdStrike_CSIT_18197_01 : rat rifdoor silent_chollima 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects plaintext version of strings observed in SILENT CHOLLIMA Rifdoor malware"
        reports = "CSIT-18197"
        version = "202002181639"
        last_modified = "2020-02-18"
        actor = "SILENT CHOLLIMA"
        malware_family = "Rifdoor"
    strings:
        $i = "$interval"
        $de = "$downloadexec"
        $cmd = "CMD:%s PROCESSED AT %d/%d/%d %d:%d:%d"
    condition:
        all of them
}

rule CrowdStrike_FANCY_BEAR_TrsDropper_EncryptedContainer_01 : encrypted fancy_bear payload trsdropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects FANCY BEAR's TrsDropper encrypted container."
        version = "201903061222"
        last_modified = "2019-03-06"
        actor = "FANCY BEAR"
        malware_family = "TrsLoaderDropper"
    strings:
        $ = { 85 E0 20 96 A3 B2 38 26 }
    condition:
        all of them
}

rule CrowdStrike_CSA_19611_01 : electricfish post_exploitation stardust_chollima 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Tunnelling tool known as ELECTRICFISH likely used by STARDUST CHOLLIMA"
        reports = "CSA-19611,CSIT-19176"
        version = "201909251333"
        last_modified = "2019-09-25"
        actor = "STARDUST CHOLLIMA"
        malware_family = "ELECTRICFISH"
    strings:
        $str_usage_llgcip = { 09 2d 73 2c 2d 2d 73 65 72 76 65 72 09 09 4c 4c 67 63 49 50 3a 50 6f 72 74 0a 00 }
        $str_log_discon = "CCGC_LOG ===>%d One remote Session Disconnected"
        $str_makesession = "LLGC_LOG ===> Make Session Success"
    condition:
        any of them
}

rule CrowdStrike_CSIT_20001_01 : cannon downloader fancy_bear 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Matches on timer names in FANCY BEAR's Cannon malware"
        reports = "CSIT-20001"
        version = "202001080941"
        last_modified = "2020-01-08"
        actor = "FANCY BEAR"
        malware_family = "Cannon Downloader"
    strings:
        $ = "start_Tick"
        $ = "inf_Tick"
        $ = "txt_Tick"
        $ = "subject_Tick"
    condition:
        all of them
}

rule CrowdStrike_CSIT_20001_02 : cannon downloader fancy_bear 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Matches on characteristic strings in FANCY BEAR's Cannon malware"
        reports = "CSIT-20001"
        version = "202001151539"
        last_modified = "2020-01-15"
        actor = "FANCY BEAR"
        malware_family = "Cannon Downloader"
    strings:
        $name_1 = "RunningPlace:"
        $name_2 = "RunPlace:"
        $name_3 = "RPlace:"
        $eq = { 3d 3d 3d 3d 3d 3d 3d 3d 3d 3d 3d 3d 3d 3d 3d 3d 3d
        3d 3d 3d 3d 3d 3d 3d 3d 3d 3d 3d 3d 3d 3d 3d 3d 3d
        3d 3d 3d 3d 3d 3d 3d 3d 3d 3d 3d 3d 3d 3d 3d 3d 3d
        3d 3d 3d 3d 3d 3d 3d 3d 3d 3d 3d 3d 3d 3d 3d 3d 3d
        3d 3d 3d 3d 3d 3d 3d 3d 3d 3d 3d 3d 3d 3d 3d 0a }
    condition:
        any of ($name_*) and $eq
}

rule CrowdStrike_CSIT_18198_02 : aries malicious_document 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects the Aries documents being used by COBALT SPIDER to download and execute COBINT. However, these documents are in use by other actors to deploy other malware."
        reports = "CSIT-18198"
        version = "201905061720"
        last_modified = "2019-05-06"
    strings:
        $macro_a = "NewMacros="
        $macro_b = "CopyFolder"
        $start = { d0 cf 11 e0 a1 b1 }
    condition:
        $start at 0 and $macro_a and $macro_b
}

rule CrowdStrike_CSIT_19049_05 : loader obamafox_loader teamviewer velvet_chollima 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "VELVET CHOLLIMA loader linked with GoldDragon implant used to deploy an instance of TeamViewer"
        reports = "CSIT-19049"
        version = "201904051306"
        last_modified = "2019-04-05"
        actor = "VELVET CHOLLIMA"
        malware_family = "ObamaFoxLoader"
    strings:
        $marker = "obamafox"
        $proc = "anternet abplorer"
        $exe = "viso.exe"
        $app = "TeamViewer"
    condition:
        $marker and 1 of ($proc,$exe,$app)
}

rule CrowdStrike_FANCY_BEAR_XmasDown_XorLoop : downloader fancy_bear xmasdown 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects an XOR loop routine found in XmasDown malware in use by FANCY BEAR."
        version = "201903061222"
        last_modified = "2019-03-06"
        actor = "FANCY BEAR"
        malware = "XmasDown"
    strings:
        $x86bytecode = { 55 89 E5 53 83 EC 10 C7 45 F8 00 00 00 00 EB 2F 8B 55 F8 8B 45 08 8D 0C 02 8B 55 F8 8B 45 08 01 D0 0F B6 18 8B 45 F8 BA 00 00 00 00 F7 75 14 8B 45 10 01 D0 0F B6 00 31 D8 88 01 83 45 F8 01 8B 45 F8 3B 45 0C 72 C9 90 83 C4 10 5B 5D C3 }
        $x64bytecode = { 55 48 89 E5 48 83 EC 10 48 89 4D 10 89 55 18 4C 89 45 20 44 89 4D 28 C7 45 FC 00 00 00 00 EB 41 8B 45 FC 48 63 D0 48 8B 45 10 48 8D 0C 02 8B 45 FC 48 63 D0 48 8B 45 10 48 01 D0 44 0F B6 00 8B 45 FC BA 00 00 00 00 F7 75 28 89 D0 89 C2 48 8B 45 20 48 01 D0 0F B6 00 44 31 C0 88 01 83 45 FC 01 8B 45 FC 3B 45 18 72 B7 90 48 83 C4 10 5D C3 }
    condition:
        any of them
}

rule CrowdStrike_CSIT_20001_03 : cannon downloader fancy_bear 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "MSIL assmebly used in POP3 downstream code of FANCY BEAR's Cannon downloader."
        reports = "CSIT-20001"
        version = "202001080939"
        last_modified = "2020-01-08"
        actor = "FANCY BEAR"
        malware_family = "Cannon Downloader"
    strings:
        $ = { 00 16 13 05 2b 57 00 09 11 05 17 58 6f ?? ?? ?? ?? 0b 07 6f ?? ?? ?? ?? 6f ?? ?? ?? ?? 03 28 }
    condition:
        all of them
}

rule CrowdStrike_CSIT_18197_03 : rifdoor server silent_chollima 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects strings present in the Rifdoor server component"
        reports = "CSIT-18197"
        version = "201812201217"
        last_modified = "2018-12-20"
        actor = "SILENT CHOLLIMA"
        malware_family = "Rifdoor"
    strings:
        $fmt = "type:%d bid:%d cid:%d"
        $bind = "bind() failed: %d"
        $client = "Accepted client: %s:%d"
        $pdb = "tcp1st\\server\\Release\\server.pdb"
    condition:
        all of ($fmt,$bind,$client) or $pdb
}

rule CrowdStrike_CSIT_19011_01 : downloader sload 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects the volume ID found in a LNK file associated with a downloader in use by eCrime actors."
        reports = "CSIT-19011"
        version = "201907250733"
        last_modified = "2019-07-25"
        malware = "sLoad Downloader"
    strings:
        $volume_droid = { c2 22 e6 f4 a1 14 c4 43 b1 c4 d1 8d b8 5c 1e 88 d3 47 e5 da a9 76 e6 11 9c 53 08 d4 0c 47 f8 73 c2 22 e6 f4 a1 14 c4 43 b1 c4 d1 8d b8 5c 1e 88 }
    condition:
        uint32(0) == 0x4c and
        filesize < 100KB and
        $volume_droid
}

rule CrowdStrike_CSIT_19063_02 : elise lotus_panda rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule identifies for strings commonly found in LOTUS PANDA Elise binaries"
        reports = "CSIT-19063"
        version = "202012011451"
        last_modified = "2020-12-01"
        actor = "LOTUS PANDA"
        malware_family = "Elise"
    strings:
        // usage: \r\n  runexe 1.exe
        $cmd1 = { 75 73 61 67 65 3a 0d 0a 20 20 72 75 6e 65 78 65 20 31 2e 65 78 65 }
        // usage: \r\n  rundll 1.dll
        $cmd2 = { 75 73 61 67 65 3a 0d 0a 20 20 72 75 6e 64 6c 6c 20 31 2e 64 6c 6c }
        $debug1 = "load %s[%s] ok."
        $debug2 = "find %s error:0x%x"
    condition:
        2 of them
}

rule CrowdStrike_CSIT_20001_04 : cannon downloader fancy_bear 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Characteristic MSIL bytecode in FANCY BEAR's Cannon downloader 'id' routine."
        reports = "CSIT-20001"
        version = "202001080941"
        last_modified = "2020-01-08"
        actor = "FANCY BEAR"
        malware_family = "Cannon Downloader"
    strings:
        $ = { 00 00 0a 1f 10 fe 04 16 fe 01 13 07 11 07 2d 32 00 07 0a 16 13 05 2b 14 00 06 72 }
    condition:
        all of them
}

// WARNING: This rule will only work with YARA 3
import "pe"

rule CrowdStrike_CSIT_19189_01 : banker culebra trojan 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects certificates used by the banking malware Culebra"
        reports = "CSIT-19189"
        version = "202012111112"
        last_modified = "2020-12-11"
        malware_family = "Culebra"
    strings:
        $S01 = "SUH SERVICES LIMITED"
        $C01 = { 49 f3 32 da 79 8f bb 7f f6 de 33 0d 70 f8 76 2d }
        $S02 = "CRMPD CONSULTING LIMITED"
        $C02 = { 93 15 ab ed 82 c2 43 a2 ee ae 97 e1 3a 81 19 }
        $S03 = "ITWAYSUK LTD"
        $C03 = { 23 4f 65 60 e6 7b 93 d4 45 86 21 7b e3 e7 49 52 }
        $S04 = "Direct Systems Ltd"
        $C04 = { 36 a7 7d 37 e6 8e 02 fd 3d 04 3c 71 97 e0 44 ca }
        $S05 = "Somerva LTD"
        $C05 = { 6f 7f f8 ec 68 92 49 cb 01 6e 10 64 d9 2f ac ca }
        $S06 = "COLLIDE CONSULTING LTD"
        $C06 = { 79 c2 2f f9 b4 78 db 2e 25 ab 49 e9 95 44 42 3a }
        $S07 = "CLEVERCYBER LTD"
        $C07 = { 50 d0 8f 3c 9b f8 6f ba 52 cf 59 2b 4f e6 ea cf }
        $S08 = "DELL TRADING LIMITED"
        $C08 = { 1b 91 6b f7 88 dd 84 eb b7 2d c0 89 56 05 68 be }
        $S09 = "ASONE VAN LIMITED"
        $C09 = { cb c5 c2 5d d2 bb 7c 65 27 9e 55 87 3c b4 ef 93 }
    condition:
        ($C01 and $S01 and pe.overlay.offset < @C01 and @C01 < @S01) or
        ($C02 and $S02 and pe.overlay.offset < @C02 and @C02 < @S02) or
        ($C03 and $S03 and pe.overlay.offset < @C03 and @C03 < @S03) or
        ($C04 and $S04 and pe.overlay.offset < @C04 and @C04 < @S04) or
        ($C05 and $S05 and pe.overlay.offset < @C05 and @C05 < @S05) or
        ($C06 and $S06 and pe.overlay.offset < @C06 and @C06 < @S06) or
        ($C07 and $S07 and pe.overlay.offset < @C07 and @C07 < @S07) or
        ($C08 and $S08 and pe.overlay.offset < @C08 and @C08 < @S08) or
        ($C09 and $S09 and pe.overlay.offset < @C09 and @C09 < @S09)
}

rule CrowdStrike_CSIT_18194_03 : bot phorpiex spam unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects unpacked TMailer samples, part of Phorpiex tools."
        reports = "CSIT-18194"
        version = "201902260536"
        last_modified = "2019-02-26"
        malware_family = "Phorpiex TMailer"
    strings:
        $pdb = "\\Desktop\\Home\\Code\\Tmlr"
        $s1 = "Mozilla/5.0 (Macintosh; Intel Mac OS X 10.9; rv:25.0) Gecko/20100101 Firefox/25.0"
        $s2 = "windrv.exe" wide
        $s3 = "wincfgrmgr32.exe" wide
        $s4 = "%ls:*:Enabled:%s" wide
        $s5 = "%ls\\%d%d%d.jpg" wide
        $s7 = "%s, %u %s %u %.2u:%.2u:%.2u %s%.2u%.2u"
        $s8 = "%u %s %u %.2u:%.2u:%.2u %s%.2u%.2u"
        $s9 = "Received: from %s ([%d.%d.%d.%d]) by %s with MailEnable ESMTP; %s"
        $s10 = "Received: (qmail %s invoked by uid %s); %s"
        $s11 = "AUTH LOGIN\\r\\n"
        $s12 = "<%s%s@%s>"
        $s13 = "%ls1.txt" wide
        $s14 = "Felt in love with you!"
        $s15 = "This is my love letter to you"
        $s16 = "http://icanhazip.com/"
        $s17 = "You look so ugly here"
        $s18 = "%ls\\%d%d.zip" wide
        $s19 = "%lsdownloader.js" wide
    condition:
        $pdb or (10 of ($s*))
}

rule CrowdStrike_CSIT_18196_01 : powermaze rat stardust_chollima 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects STARDUST CHOLLIMA PowerMaze through Base64 encoded strings"
        reports = "CSIT-18196"
        version = "201904221324"
        last_modified = "2019-04-22"
        actor = "STARDUST CHOLLIMA"
        malware_family = "Powermaze"
    strings:
        $ = "'UABSAE8AQwBFAFMAUwBfAFIARQBRAFUARQBTAFQA'"//: 'PROCESS_REQUEST'
        $ = "'RABPAFcATgBMAE8AQQBEAF8AUwBUAE8AUAA='"//: 'DOWNLOAD_STOP'
        $ = "'QQBHAEUATgBUAF8AQwBPAE4ARgBJAEcA'"//: 'AGENT_CONFIG'
        $ = "'UABSAE8AQwBFAFMAUwBfAFQARQBSAE0ASQBOAEEAVABFAA=='"//: 'PROCESS_TERMINATE'
        $ = "'UgBFAEcAXwBOAEUAVwBfAFMAVABSAEkATgBHAA=='"//: 'REG_NEW_STRING'
        $ = "'RgBJAEwARQBfAFUATgBaAEkAUABfAFIARQBRAFUARQBTAFQA'"//: 'FILE_UNZIP_REQUEST'
        $ = "'UgBFAEcASQBTAFQAUgBZAF8AUgBFAFEAVQBFAFMAVAA='"//: 'REGISTRY_REQUEST'
        $ = "'UgBFAEcAXwBOAEUAVwBfAEIASQBOAEEAUgBZAA=='"//: 'REG_NEW_BINARY'
        $ = "'XAAlADIAMwAlAFIAUwAuAHQAbQBwAA=='"//: '\%23%RS.tmp'
        $ = "'RABPAFcATgBMAE8AQQBEAF8AUgBFAFEAVQBFAFMAVAA='"//: 'DOWNLOAD_REQUEST'
        $ = "'UgBFAEcAXwBOAEUAVwBfAEsARQBZAA=='"//: 'REG_NEW_KEY'
        $ = "'RgBJAEwARQBfAFIARQBRAFUARQBTAFQA'"//: 'FILE_REQUEST'
        $ = "'UgBFAEcAXwBEAEUATABFAFQARQA='"//: 'REG_DELETE'
        $ = "'UABSAE8AQwBFAFMAUwBfAEkATgBKAEUAQwBUAA=='"//: 'PROCESS_INJECT'
        $ = "'UwBDAFIARQBFAE4AXwBSAEUAUQBVAEUAUwBUAA=='" //: 'SCREEN_REQUEST'
        $ = "'SwBFAFkAQgBPAEEAUgBEAF8AUwBUAE8AUAA='"//: 'KEYBOARD_STOP'
        $ = "'QwBNAEQAXwBSAEUAUQBVAEUAUwBUAA=='"//: 'CMD_REQUEST'
        $ = "'XABEAGUAYwBvAG0AcAByAGUAcwBzAGUAZAA='"//: '\Decompressed'
        $ = "'UgBFAEcAXwBOAEUAVwBfAEQAVwBPAFIARAA='"//: 'REG_NEW_DWORD'
        $ = "'SwBFAFkAQgBPAEEAUgBEAF8AUgBFAFEAVQBFAFMAVAA='"//: 'KEYBOARD_REQUEST'
    condition:
        5 of them
}

rule CrowdStrike_CSIT_18196_02 : powershell stardust_chollima 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects STARDUST CHOLLIMA PowerShell obfuscator through characteristic variable naming"
        reports = "CSIT-18196"
        version = "201903011754"
        last_modified = "2019-03-01"
        actor = "STARDUST CHOLLIMA"
    strings:
        // ${global:dac8b255ec2a4362840e51143e4e57b2}
        $var_re = /\$\{global\:[a-f0-9]{32}\} = /
    condition:
        filesize < 500KB and
        $var_re
}

rule CrowdStrike_CSIT_18196_03 : injector stardust_chollima 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detect STARDUST CHOLLIMA DLL injection tool through characteristic stack strings"
        reports = "CSIT-18196"
        version = "202001081335"
        last_modified = "2020-01-08"
        actor = "STARDUST CHOLLIMA"
    strings:
        // Stack strings with encrypted API names
        $code_1 = { c7 45 07 60 09 46 83 c7 45 0b 41 e3 48 78 c7 45 0f 66 2f 64 17 }
        $code_2 = { c7 45 07 5d 05 46 99 c7 45 0b 51 ee 17 0b c7 45 0f 24 27 67 18 }
        $code_3 = { c7 45 07 5c 1e 5d 99 c7 45 0b 41 df 09 25 c7 45 0f 2b 2e 7b 08 }
        $str_1= "C:\\windows\\temp\\temp0917.tmp" ascii
        $str_2 = "finding target project" ascii
        $str_3 = "found target and do action" ascii
        $str_4 = "delete ddd" ascii
    condition:
        any of ($code_*) or all of ($str_*)
}

rule CrowdStrike_CSIT_18195_01 : a1lock ransomware unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects various versions of A1Lock ransomware after unpacking"
        reports = "CSIT-18195"
        version = "202004071348"
        last_modified = "2020-04-07"
        malware_family = "A1Lock"
    strings:
        $decrypt_strings_asm = { 33 c0 8d 7d a9 f3 ab 66 ab aa 88 5d c8 33 c0 8d 7d c9 ab ab ab 66 ab aa 8d 85 90 fe ff ff }
        $pdb_path = "a13lock_final.pdb"
        $v1_s1 = "hjkhkHUhhjp.bat"
        $v1_s2 = "EXDATA" wide
        $v1_s3 = "KDATA" wide
        $v1_s4 = "CODATA" wide
        $v1_s6 = "Microsoft Shared"
        $v4_rsaencrypt = "rsa_encrypt"
        $v4_rsagenkey = "rsa_genkey"
        $v4_rsaexp = "010001"
        $v4_hwprofile = "GetCurrentHwProfileW"
        $v4_taskkill = "taskkill /F /T /PID"
        $v4_vssadmin = "vssadmin.exe Delete Shadows /All /Quiet"
        $v4_defaultrdp = "Default.rdp"
        $v4_certificates = "CertificatesCheck" wide
    condition:
        $decrypt_strings_asm or
        $pdb_path or
        6 of ($v4_*) or
        all of ($v1*)
}

rule CrowdStrike_CSA_181100_01 : rat trat unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects characteristic opcodes and encryption keys of tRat."
        reports = "CSA-181100"
        version = "201903131248"
        last_modified = "2019-03-13"
        malware_family = "tRat"
    strings:
        /* ; communication encryption routine
        8A 44 02 FF               mov     al, [edx+eax-1]
        32 D8                     xor     bl, al
        33 D2                     xor     edx, edx
        8A D0                     mov     dl, al
        32 9A D4 E2 40 00         xor     bl, ds:KK6[edx]
        32 9A D4 E3 40 00         xor     bl, ds:KK5[edx]
        32 9A D4 E4 40 00         xor     bl, ds:KK4[edx]
        32 9A D4 E5 40 00         xor     bl, ds:KK3[edx]
        32 9A D4 E6 40 00         xor     bl, ds:KK2[edx]
        32 9A D4 E7 40 00         xor     bl, ds:KK1[edx]
        32 C3                     xor     al, bl
        8B D8                     mov     ebx, eax
        8D 45 FC                  lea     eax, [ebp+result]
        E8 AB 94 FF FF            call    _get */
        $c1 = {
        8A4402FF32D833D28AD0329A??????00329A??????00329A??????00329A????
        ??00329A??????00329A??????0032C38BD88D45??E8 }
        $key1 = "AC8FFF33D07229BF84E7A429CADC33BFEAE7AC4A87AE33ACEAAC8192A68C55A6" fullword
        $key2 = "Fx@%gJ_2oK" fullword
        $key3 = "&LmcF#7R2m" fullword
        /* ; string decryption routine
        8B 55 FC                  mov     edx, [ebp-4]
        0F B6 54 32 FF            movzx   edx, byte ptr [edx+esi-1]
        66 33 D3                  xor     dx, bx
        0F B7 D2                  movzx   edx, dx
        2B D6                     sub     edx, esi
        33 D6                     xor     edx, esi
        2B D6                     sub     edx, esi
        33 D6                     xor     edx, esi
        88 54 30 FF               mov     [eax+esi-1], dl
        43                        inc     ebx */
        $c2 = { 8B55??0FB65432FF6633D30FB7D22BD633D62BD633D6885430FF43 }
    condition:
        2 of them
}

rule CrowdStrike_CSIT_18189_01 : delivery_document htdnloader labyrinth_chollima macro 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Macro documents used by likely LABYRINTH CHOLLIMA to target cryptocurrency users"
        reports = "CSIT-18189"
        version = "201812140932"
        last_modified = "2018-12-14"
        actor = "LABYRINTH CHOLLIMA"
    strings:
        $vba = "_VBA_PROJECT" wide
        $str_bpoint = "Bpoint"
        $str_iecomp = "iecompat.nls"
        $str_exdll = "ExtractDll"
        $str_iecomp2 = "IECompatData"
        $str_caption = ".Caption"
    condition:
        $vba and 3 of ($str_*)
}

rule CrowdStrike_CSIT_18189_02 : downloader htdnloader labyrinth_chollima 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "New variant of HtDnLoader used in conjunction with cryptocurrency themed macro lure documents"
        reports = "CSIT-18189"
        version = "201812140932"
        last_modified = "2018-12-14"
        actor = "LABYRINTH CHOLLIMA"
        malware = "HtDnDownLoader"
    strings:
        $strw_lnkpath = "\\Roaming\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\\JavaUpdate.lnk" wide fullword
        $str_export1 = "RaitingSetupUI" fullword
        $str_export2 = "Bpoint" fullword
        $str_dllname32 = "Dll32.dll" fullword
        $str_dllname64 = "Dll64.dll" fullword
        $str_aeskey = "WER34r8iuu5vbfsw" fullword
        $str_exportcalls = "8548D6B5 DD08"
        $str_btcqt = "Software\\Bitcoin\\Bitcoin-Qt" fullword
        $code_compare_1 = { 81 f9 78 32 69 98 }
        $code_compare_2 = { 81 f9 88 38 69 56 }
    condition:
        4 of them
}

rule CrowdStrike_FancyBear_TrsLoaderDropper_64Bit_01 : dropper fancy_bear trsloader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "FANCY BEAR TrsLoader Dropper, encrypted 64-bit TrsLoader payload"
        version = "201903061223"
        last_modified = "2019-03-06"
        actor = "FANCY BEAR"
        malware_family = "TrsLoader"
    strings:
        $ = { 6e 45 6d 1a a7 1a 3f 76 63 26 26 53 36 ad 62 3f }
    condition:
        all of them
}

rule CrowdStrike_CSIT_19009_03 : cloudstats loader static_kitten 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects STATIC KITTEN PowerShell loader DLL used to deploy CloudSTATS"
        reports = "CSIT-19009"
        version = "202106171614"
        last_modified = "2021-06-17"
        actor = "STATIC KITTEN"
    strings:
        $runfunc = "RunPow" ascii
        $dll_name = "pngdll.dll" ascii
        $ps_payload = "$thardcore=" ascii
        $tmp_name = "WindowsUpdate.txt" ascii
    condition:
        2 of them
}

rule CrowdStrike_CSIT_19009_04 : cloudstats loader static_kitten 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects registry file used to install an ASEP for STATIC KITTEN loader DLLs, used to deploy CloudSTATS"
        reports = "CSIT-19009"
        version = "201903181757"
        last_modified = "2019-03-18"
    strings:
        $hdr = "Windows Registry Editor Version 5.00"
        $enc_loader = "70,00,6e,00,67,00,2e,00,64,00,6c,00,6c,00"
        $enc_export = "52,00,75,00,6e,00,50,00,6f,00,77,00"
    condition:
        $hdr at 0 and 1 of ($enc_*)
}

rule CrowdStrike_CSA_181113_01 : parkdoor rat silent_chollima 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects strings present in the Parkdoor implant used by SILENT CHOLLIMA"
        reports = "CSA-181113"
        version = "201812071845"
        last_modified = "2018-12-07"
        actor = "SILENT CHOLLIMA"
        malware = "Parkdoor"
    strings:
        $resp = "TG9naW4gU3VjY2VzcyFcclxuV2VsY29tZSE="
        $req = "aWQ9VGlteSZwd2Q9TTJNNVpURTJOR1ExWW1FM1pUZ3lOekE1TXpJek16Z3pNRGhqTnpReFptST0mYWN0aW9uPWxvZ2luDQo="
    condition:
        any of them
}

rule CrowdStrike_KleptoParasite_loader : infostealer kleptoparasite 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects loader for KleptoParasite Stealer"
        version = "201812071845"
        last_modified = "2018-12-07"
        malware_family = "KleptoParasite"
    strings:
        $filename1 = "\\fc32.exe"
        $filename2 = "\\fc64.exe"
        $filename3 = "\\ip.exe"
        $filename4 = "\\o32.exe"
        $filename5 = "\\o64.exe"
        $filename6 = "\\Logs.html"
        $filename7 = "\\DXWRK.html"
    condition:
        uint16(0) == 0x5A4D and 4 of them
}

rule CrowdStrike_KleptoParasite_Outlook_stealer : infostealer kleptoparasite 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects Outlook-credential stealer component of KleptoParasite"
        version = "201812071847"
        last_modified = "2018-12-07"
        malware_family = "KleptoParasite"
    strings:
        $regkey = "9375CFF0413111d3B88A00104B2A6676"
        $filename = "\\DXWRK.html"
    condition:
        uint16(0) == 0x5A4D and all of them
}

rule CrowdStrike_KleptoParasite_IP_retriever : infostealer kleptoparasite 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects IP retriever component of KleptoParasite"
        version = "201812071846"
        last_modified = "2018-12-07"
        malware_family = "KleptoParasite"
    strings:
        $useragent = "IP retriever"
        $url = "http://myexternalip.com/raw"
        $filename = "\\DXWRK.html"
    condition:
        uint16(0) == 0x5A4D and $filename and ($useragent or $url)
}

rule CrowdStrike_KleptoParasite_browser_credential_stealer : infostealer kleptoparasite 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects browser-credential stealer component of KleptoParasite"
        version = "201812071846"
        last_modified = "2018-12-07"
        malware_family = "KleptoParasite"
    strings:
        $ = "<center><b>Mozilla Firefox"
        $ = "<center><b>Google Chrome"
        $ = "\\logins.json"
        $ = "SELECT origin_url, username_value, password_value FROM logins"
        $filename = "\\DXWRK.html"
    condition:
        uint16(0) == 0x5A4D and $filename and (3 of them)
}

rule CrowdStrike_CSIT_19009_02 : delivery_document macro static_kitten 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects macro activation function used in STATIC KITTEN CloudSTATS distribution campaign from November 2018"
        reports = "CSIT-19009"
        version = "202106171613"
        last_modified = "2021-06-17"
        actor = "STATIC KITTEN"
    strings:
        $ = "Me.Hide"
        $ = "btnCheckPass_Click"
        $ = "Unload Me"
    condition:
        all of them
}

rule CrowdStrike_CSIT_19009_01 : delivery_document macro static_kitten 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects strings in macro used in STATIC KITTEN CloudSTATS distribution campaign from November 2018"
        reports = "CSIT-19009"
        version = "202106171614"
        last_modified = "2021-06-17"
        actor = "STATIC KITTEN"
    strings:
        // Encoded "powershell" string
        $hex_ps = "706f7765727368656c6c"
        // Encoded "new-Object" string
        $hex_no = "6e65772d4f626a656374"
        $enc_1 = "66ce0627c7c6654ef11"
        $enc_2 = "1=H2+Q/BR1G92X</VY25I.JI1OZ1[*2IH2S5/VC"
        $enc_3 = "1G3,<J0N22H-1G9+D</Z0/BB/8H+*Y3<M,<=1G30O.,T*1G92X</VY+CX1[.2?@37U+*5,A?"
        $enc_4 = "1E41GD1A21=A"
    condition:
        2 of ($hex*) and 1 of ($enc*)
}

rule CrowdStrike_CSIT_19010_01 : loader stone_panda stonenetloader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects deobfuscated StoneNetLoader loaders used to deploy Quasar RAT"
        reports = "CSA-18867,CSIR-18014,CSIT-19010"
        version = "202103311949"
        last_modified = "2021-03-31"
        actor = "STONE PANDA"
        malware_family = "StoneNetLoader"
    strings:
        $ = "$$method0x6000007-1" ascii
        $ = "CipherMode" ascii
        $ = "ComVisibleAttribute" ascii
        $ = "CompilationRelaxationsAttribute" ascii
        $ = "CompilerGeneratedAttribute" ascii
        $ = "ContainsKey" ascii
        $ = "CreateDecryptor" ascii
        $ = "CreateInstance" ascii
        $ = "CryptoStream" ascii
        $ = "CryptoStreamMode" ascii
        $ = "ileSystemInfo" ascii
        $ = "etCommandLineArgs" ascii
        $ = "GetCurrentProcess" ascii
        $ = "GetDirectories" ascii
        $ = "GetElementType" ascii
        $ = "GetHINSTANCE" ascii
        $ = "GetTypeFromHandle" ascii
        $ = "ICryptoTransform" ascii
        $ = "IDisposable" ascii
        $ = "InstallContext" ascii
        $ = "Installer" ascii
        $ = "MemoryStream" ascii
        $ = "MethodInfo" ascii
        $ = "ProcessModule" ascii
        $ = "ProcessStartInfo" ascii
        $ = "Rfc2898DeriveBytes" ascii
        $ = "RijndaelManaged" ascii
        $ = "SetLastAccessTime" ascii
        $ = "SetLastWriteTime" ascii
        $ = "SuppressIldasmAttribute" ascii
        $ = "SymmetricAlgorithm" ascii
        $ = "System.Configuration.Install" ascii
        $ = "System.Diagnostics" ascii
        $ = "System.Reflection" ascii
        $ = "System.Runtime.CompilerServices" ascii
        $ = "System.Runtime.InteropServices" ascii
        $ = "System.Security.Cryptography" ascii
        $ = "Uninstall" ascii
        $ = "VirtualProtect" ascii
        $ = "get_BlockSize" ascii
        $ = "scoree.dll" ascii
        $ = "op_Explicit" ascii
        $ = "op_Inequality" ascii
        $ = "set_CreateNoWindow" ascii
        $ = "set_FileName" ascii
        $ = "set_KeySize" ascii
        $ = "set_Mode" ascii
        $ = "set_UseShellExecute" ascii
        $ = "v4.0.30319" ascii
    condition:
        all of them
}

rule CrowdStrike_CSA_181135_02 : certificate velvet_chollima 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule looks for a revoked certificate that was likely stolen and used by VELVET CHOLLIMA since at least July 13, 2017."
        reports = "CSA-181135"
        version = "202009291349"
        last_modified = "2020-09-29"
        actor = "VELVET CHOLLIMA"
    strings:
        $cn = "EGIS Co., Ltd."
        $serial = { 0f ff e4 32 a5 3f f0 3b 92 23 f8 8b e1 b8 3d 9d }
    condition:
        uint16(0) == 0x5a4d and
        filesize < 1MB and
        ($cn and $serial)
}

rule CrowdStrike_CSA_181135_03 : certificate velvet_chollima 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule looks for an expired certificate used by VELVET CHOLLIMA in one sample. "
        reports = "CSA-181135"
        version = "201910140854"
        last_modified = "2019-10-14"
        actor = "VELVET CHOLLIMA"
    strings:
        $cn = "Duzon Information Security Service Co.,Ltd."
        $serial = { 16 bf 7c 83 bd ce 19 f3 94 8d 06 f2 14 e5 ae 42 }
    condition:
        uint16(0) == 0x5a4d and
        filesize < 900KB and
        ($cn and $serial)
}

rule CrowdStrike_CSIT_19008_01 : crysis dharma ransomware unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects the presence of the Dharma PDB string in executables"
        reports = "CSIT-19008"
        version = "202012071402"
        last_modified = "2020-12-07"
        malware_family = "DharmaRansomware,CrysisRansomware"
    strings:
        $pdb = "C:\\crysis\\Release\\PDB\\payload.pdb"
        $str = "RSDS"
    condition:
        all of them
}

rule CrowdStrike_CSA_181171_02 : dropper shamoon2 volatile_kitten 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Shamoon2 dropper"
        reports = "CSA-181171"
        version = "202106171615"
        last_modified = "2021-06-17"
        actor = "VOLATILE KITTEN"
        malware_family = "Shamoon"
    strings:
        $rsrctbl = { 04 00 00 00 00 00 01 00 01 24 00 00 }
        $buildtime = { e3 ad d3 4e 00 00 00 00 00 00 00 00 }
    condition:
        all of them
}

rule CrowdStrike_RevengeRAT_01 : rat revenge_rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects a freely-available malware family named Revenge-RAT."
        version = "202101221548"
        last_modified = "2021-01-22"
        malware_family = "Revenge-RAT"
    strings:
        $ = "R3Vlc3Q" wide
        $ = "]NK[" wide
        $ = "Revenge-RAT" wide
    condition:
        2 of them
}

rule CrowdStrike_Shamoon2_Communicator_Component_01 : shamoon2 volatile_kitten 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Shamoon2 communicator component"
        reports = "CSA-181171"
        version = "202106171616"
        last_modified = "2021-06-17"
        actor = "VOLATILE KITTEN"
        malware_family = "Shamoon"
    strings:
        $ = { 84 85 8c 40 4f 86 40 4f 81 40 45 93 45 93 4a 4e 45 93 00 }
    condition:
        all of them
}

rule CrowdStrike_Shamoon2_Wiper_Component_01 : shamoon2 volatile_kitten wiper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Shamoon2 wiper component"
        reports = "CSA-181171"
        version = "202106171611"
        last_modified = "2021-06-17"
        actor = "VOLATILE KITTEN"
        malware_family = "Shamoon"
    strings:
        $ = { 77 4c 1c d0 cd df 81 80 4e 4b f0 ae 82 dc 8d bd cc dd 4a c9 1d 27 1b 04 }
    condition:
        all of them
}

rule CrowdStrike_CSIT_19002_01 : carbon_spider delivery_document ecrime harpy javascript 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects CARBON SPIDER's Harpy delivery documents."
        reports = "CSIT-19002"
        version = "201911050026"
        last_modified = "2019-11-05"
        actor = "CARBON SPIDER"
        malware_family = "Harpy"
    strings:
        $js_obf1_hex = "293b6e65772046756e6374696f6e" nocase
        $js_obf2_hex = "5b315d2c20" nocase
        $js_obf1 = ");new Function"
        $js_obf2 = "[1], "
        $doc_start = { d0 cf 11 e0 }
    condition:
        $doc_start at 0 and ($js_obf1 and $js_obf2) or ($js_obf1_hex and $js_obf2_hex)
}

rule CrowdStrike_CSIT_19108_02 : android key paperplane 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects Google Maps API Keys used in PaperPlane Android malware"
        reports = "CSIT-19108"
        version = "201906280845"
        last_modified = "2019-06-28"
        malware_family = "PaperPlane"
    strings:
        $ = "AIzaSyDzAoJrVB72LgqSZ1LP6Hpp8egGEJVH7PA" //Challegram
        $ = "AIzaSyCvW1H75MU8fRySY-1aCBUMzR3JmS4V77I" //Telegram Talaeii
        $ = "AIzaSyBhxiVzOGOSn2hExniMYwu0uy-ijOgUv3U" //Vidogram
        $ = "AIzaSyAAW6g4Q3i-hzzt7YcVvBeIWvV571TWXOA" //Vpngram
        $ = "AIzaSyBzIRbGxt_KuamPWnmdY84HrZCLNvwyl7Q" //calendar.persian.advanced
    condition:
        any of them
}

rule CrowdStrike_CSIT_19108_04 : android certificate paperplane 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects certificate used to sign the PaperPlane malware application"
        reports = "CSIT-19108"
        version = "201906280845"
        last_modified = "2019-06-28"
        malware_family = "PaperPlane"
    strings:
        $asegram_str_0 = "CN=efwef"
        $asegram_str_1 = "L=efwe"
        $asegram_hex_0 = { 65 66 77 65 31 0e }
        $asegram_hex_1 = { 65 66 77 65 66 30 20 }
    condition:
        all of ($asegram_str_*) or (uint16(0) == 0x8230 and all of ($asegram_hex_*))
}

rule CrowdStrike_CSIT_19108_03 : android artifact paperplane 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects passwords used by PaperPlane for AES-128 encryption"
        reports = "CSIT-19108"
        version = "201906280845"
        last_modified = "2019-06-28"
        malware_family = "PaperPlane"
    strings:
        $ = "shiralizadeh-rabiee-amiry-sls"
        $ = "shiraliz-rabi-ami-sls"
        $ = "TTTnhi-to-sh-32jH8*aq#3B/2p1_K3Wd"
        $ = "nothing-to-show-32jH8*aq#3B/2p1_K3Wdrq"
        $ = "-32jH8*aq#3B/2p1_K3Wd"
        $ = "wzKY$TP$j,f@z8W+"
        $ = "?kS5(PYp!nn[uf3U-Kpg8Zr[aFSUE&H)R_&''fy9Dk?3yH5t>b"
        $ = "Ea:s%BUvvgQVdba*WMx6Wy<e)M,z^N_}M&e.{N^92tKK5R~Wxp"
        $ = "YC'2bmK=b%#NQ?9j"
    condition:
        any of them
}

rule CrowdStrike_Filerase_Wiper_01 : filerase wiper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects the SuperDelete-based wiper known as Filerase related to Shamoon, late 2018"
        reports = "CSA-181171"
        version = "201812281547"
        last_modified = "2018-12-28"
        malware_family = "Filerase"
    strings:
        $str2 = "getallDrives" ascii
        $str3 = "FileDeleter" ascii
        $str4 = "DeleteFolder" ascii
        $str5 = "DeleteSingleFile" ascii
        $str6 = "DeleteFileBackupSemantics" ascii
        $str7 = "TwoPassFileErase" ascii
        $str_super = "SuperDelete" fullword
    condition:
        filesize < 300KB and
        uint16(0) == 0x5A4D and 3 of them and not $str_super
}

rule CrowdStrike_Shamoon_Spreader_01 : post_exploitation shamoon2 wiper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Spreading tool used to deploy Shamoon and related toolset, late 2018"
        reports = "CSA-181171"
        version = "201812210937"
        last_modified = "2018-12-21"
        malware_family = "Shamoon2"
    strings:
        $strw_signup = "Program Files\\Internet Explorer\\sign" wide
        $strw_process = "\\admin$\\process.bat" wide fullword
    condition:
        filesize < 50KB and
        all of them
}

rule CrowdStrike_Pushbot_01 : pushbot unpacked worm 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects the Pushbot worm that spreads through Facebook and/or MSN Messenger"
        version = "201812281546"
        last_modified = "2018-12-28"
        malware_family = "Pushbot"
    strings:
        /*
        68 FC B1 40 00             push    offset aSE734733674743
        68 04 01 00 00            push    104h
        8D 85 F0 FC FF FF        lea     eax, [ebp+FileName]
        50                        push    eax
        E8 50 1E 00 00            call    __snprintf
        */
        $folder = {68FCB1400068040100008D85F0FC????50E8501E0000}
        $str1 = "hitmeandyou" fullword
        $str2 = "Main Messenger Update" fullword
        $str3 = "wow, olha que bela foto %s"
        $str4 = "%s\\E-73473-3674-74335" fullword
        $str5 = "leuke foto van jou. %s" fullword
        $str6 = "haha, beautiful pictures of you! %s" fullword
        $str7 = "YahooBuddyMain" fullword
        $str8 = "%s\\winupds.txt" fullword
    condition:
        uint16(0) == 0x5A4D and ($folder or (2 of ($str*)))
}

rule CrowdStrike_CSIT_19100_02 : basebinloader loader pirate_panda poisonivy 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "PoisonIvy loader seen late 2018 in likely targeted attacks by PIRATE PANDA"
        reports = "CSIT-19100"
        version = "201906141036"
        last_modified = "2019-06-14"
        actor = "PIRATE PANDA"
        malware_family = "BasebinLoader,Poison Ivy"
    strings:
        /* Code from starting VA 004015f0:
        lea     ecx, [eax-41h]
        mov     byte_40B210[eax], cl
        inc     eax
        cmp     eax, 5Ah ; 'Z'
        jle     short loc_4015F0
        mov     eax, 61h ; 'a'
        lea     edx, [eax-47h]
        mov     byte_40B210[eax], dl
        inc     eax
        cmp     eax, 7Ah ; 'z'
        jle     short loc_401604
        mov     eax, 30h ; '0'
        jmp     short loc_401620
        */
        $code_va_004015F0 = { 8D 48 BF 88 88 ?? ?? ?? ?? 40 83 F8 5A 7E F1 B8 61 00 00 00 8D 50 B9 88 90 ?? ?? ?? ?? 40 83 F8 7A 7E F1 B8 30 00 00 00 EB 06 }
        /* Code from starting VA 0040162f:
        mov     byte_40B210+2Bh, 3Eh ; '>'
        mov     byte_40B210+2Fh, 3Fh ; '?'
        mov     byte_40B210+3Dh, 0
        retn
        */
        $code_va_0040162F = { C6 05 ?? ?? ?? ?? 3E C6 05 ?? ?? ?? ?? 3F C6 05 ?? ?? ?? ?? 00 C3 }
        $str_BIN = "BIN" fullword
    condition:
        all of them and filesize < 100KB
}

rule CrowdStrike_CSIT_19002_02 : carbon_spider delivery_document ecrime harpy javascript 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects CARBON SPIDER's Harpy delivery documents."
        reports = "CSIT-19002"
        version = "201905061720"
        last_modified = "2019-05-06"
        actor = "CARBON SPIDER"
        malware_family = "Harpy"
    strings:
        $js_obf1 = "function@@"
        $js_obf2 = "@@{---"
        $js_obf3 = "---new@@Function("
        $doc_start = { d0 cf 11 e0 }
    condition:
        $doc_start at 0 and $js_obf1 and $js_obf2 or $js_obf3
}

rule CrowdStrike_CSIT_19108_05 : android artifact paperplane 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects domain strings used in the PaperPlane Android malware"
        reports = "CSIT-19108"
        version = "201906280845"
        last_modified = "2019-06-28"
        malware_family = "PaperPlane"
    strings:
        $ = "hotgram.ir/"
        $ = "aG90Z3JhbS5pci8=" //"hotgram.ir/" base64
        $ = "talagram.ir/"
        $ = "dGFsYWdyYW0uaXIv" //"talagram.ir/" base64
        $ = "harsobh.com/"
        $ = "aGFyc29iaC5jb20v" //"harsobh.com/" base64
    condition:
        any of them
}

rule CrowdStrike_CSIT_19108_08 : android artifact paperplane 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detect integers used by PaperPlane to create a password for AES-128 decryption"
        reports = "CSIT-19108"
        version = "201906280846"
        last_modified = "2019-06-28"
        malware_familiy = "PaperPlane"
    strings:
        //0xa5d9783 == 173905795
        $ = { 83 97 5d 0a }
        //0x66c14313 == 1723941651
        $ = { 13 43 c1 66 }
        //0x200243a5 == 537019301
        $ = { a5 43 02 20 }
        //0x60a2a81b == 1621272603
        $ = { 1b a8 a2 60 }
        //0x400991d2 == 1074368978
        $ = { d2 91 09 40 }
        //0xffffffff9e028f63 == -1643999389
        $ = { 63 8f 02 9e }
        //0xffffffff800cab51 == -2146653359
        $ = { 51 ab 0c 80 }
        //0xffffffffa50a1c46 == -1526064058
        $ = { 46 1c 0a a5 }
        //0x9d3eb88 == 164883336
        $ = { 88 eb d3 09 }
        //0xffffffff8c2ae6d6 == -1943345450
        $ = { d6 e6 2a 8c }
        //0x22b2482 == 36381826
        $ = { 82 24 2b 02 }
        //0x18b11437 == 414258231
        $ = { 37 14 b1 18 }
        //0xffffffff871b5632 == -2028251598
        $ = { 32 56 1b 87 }
        //0x2a15710e == 706048270
        $ = { 0e 71 15 2a }
        //0xffffffff9fa61e17 == -1616503273
        $ = { 17 1e a6 9f }
        //0x33ed8ac5 == 871205573
        $ = { c5 8a ed 33 }
    condition:
        all of them
}

rule CrowdStrike_CSA_19035_01 : rat sharpstats static_kitten 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects SharpSTATS, a .NET malware family derived from NTSTATS, developed by STATIC KITTEN"
        reports = "CSA-19035"
        version = "202106171615"
        last_modified = "2021-06-17"
        actor = "STATIC KITTEN"
        malware_family = "SharpSTATS"
    strings:
        $xor = "UHIRER874893UIUOFUGHEWROUIRGH35" wide
        $ext = ".frk" wide
        $c2_file = "temp_gh_12.dat" wide
        // Error result given if no C2 command is received
        $no_cmd = "nuAAJHSUI7F89H4UKFme" wide
    condition:
        // MZ Signature
        uint16(0) == 0x5a4d and
        // PE Signature
        uint32(uint32(0x3C)) == 0x00004550 and
        // .Net Directory
        uint32(0x3c + 0xe8) > 0 and
        2 of them
}

rule CrowdStrike_CSIT_19016_01 : ecrime infostealer unpacked vidar 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects strings found in unpacked Vidar stealer samples."
        reports = "CSIT-19016"
        version = "202103151125"
        last_modified = "2021-03-15"
        malware_family = "Vidar Stealer"
    strings:
        $st1 = "softokn3.dll"
        $st2 = "nss3.dll"
        $st3 = "mozglue.dll"
        $st4 = "User Name:"
        $st5 = "MachineID:"
        $st6 = "Keyboard Languages: "
        $st7 = "Work Dir: "
        $sd1 = "files\\Autofill"
        $sd2 = "files\\Downloads"
        $sd3 = "files\\History"
        $sd4 = "files\\CC"
        $sd5 = "files\\Cookies"
        $sd6 = "Autofill\\%s_%s.txt"
        $sd7 = "History\\%s_%s.txt"
        $sd8 = "CC\\%s_%s.txt"
        $sd9 = "files\\Soft\\Authy"
    condition:
        (all of ($st*)) and (4 of ($sd*))
}

rule CrowdStrike_CSIT_19068_02 : taurus venom_spider 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects RC4 Taurus Loader DLL used by COBALT SPIDER and others"
        reports = "CSIT-19068,CSIT-19198"
        version = "202012141416"
        last_modified = "2020-12-14"
        actor = "VENOM SPIDER"
        malware_family = "Taurus Loader"
    strings:
        $xor_instr1 = { 89 C3 89 D8 B9 02 00 00 00 99 F7 F9 89 C3 3B 5C 24 08 }
        $xor_instr2 = { 68 02 00 00 00 8B 5C 24 1C }
    condition:
        filesize < 5MB and int32(0) == 0x905a4d and (all of ($xor_instr*))
}

rule CrowdStrike_CSIT_19044_01 : backdoor ecrime javascript more_eggs skid 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule is designed to detect all variants of the JScript-based malware SKID."
        reports = "CSIT-19044,CSIT-20020"
        version = "202007151727"
        last_modified = "2020-07-15"
        malware_family = "SKID"
    strings:
        $download_exec_switch = "case \"d&exec\":"
        $uninstall_switch = "case \"gtfo\":"
    condition:
        all of them
}

rule CrowdStrike_CSIT_19108_07 : android key paperplane 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detect integers used by PaperPlane to create a password for AES-128 decryption"
        reports = "CSIT-19108"
        version = "201906280845"
        last_modified = "2019-06-28"
        malware_family = "PaperPlane"
    strings:
        //0x11595074 == 291065972
        $ = { 74 50 59 11 }
        //0xffffffffcf067a1d == -821659107
        $ = { 1d 7a 06 cf }
        //0x27c99f51 == 667524945
        $ = { 51 9f c9 27 }
        //0xffffffffe654fa29 == -430638551
        $ = { 29 fa 54 e6 }
        //0xffffffffb1314e36 == -1322168778
        $ = { 36 4e 31 b1 }
        //0x36be65e == 57402974
        $ = { 5e e6 6b 03 }
        //0xffffffffa970afc6 == -1452232762
        $ = { c6 af 70 a9 }
        //0x481e841a == 1209959450
        $ = { 1a 84 1e 48 }
        //0x5a758c5c == 1517653084
        $ = { 5c 8c 75 5a }
        //0x25882b08 == 629680904
        $ = { 08 2b 88 25 }
        //0xffffffffb4a46c7d == -1264292739
        $ = { 7d 6c a4 b4 }
        //0x602954e3 == 1613321443
        $ = { e3 54 29 60 }
        //0x78606a2c == 2019584556
        $ = { 2c 6a 60 78 }
        //0xffffffff94cffbf6 == -1798308874
        $ = { f6 fb cf 94 }
        //0x272b8842 == 657164354
        $ = { 42 88 2b 27 }
        //0xffffffff8e83b514 == -1903971052
        $ = { 14 b5 83 8e }
    condition:
        all of them
}

rule CrowdStrike_CSIT_19108_06 : android artifact paperplane 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detect integers used by PaperPlane to create a password for AES-128 decryption"
        reports = "CSIT-19108"
        version = "201906280845"
        last_modified = "2019-06-28"
        malware_family = "PaperPlane"
    strings:
        //0xffffffffbbaaecfe == -1146426114
        $ = { fe ec aa bb }
        //0xffffffff94deab46 == -1797346490
        $ = { 46 ab de 94 }
        //0x6097548a == 1620530314
        $ = { 8a 54 97 60 }
        //0x10b27b29 == 280132393
        $ = { 29 7b b2 10 }
        //0x365024f7 == 911222007
        $ = { f7 24 50 36 }
        //0xffffffffd52a7c5a == -718635942
        $ = { 5a 7c 2a d5 }
        //0xffffffff8722845b == -2027781029
        $ = { 5b 84 22 87 }
        //0x4019a48c == 1075422348
        $ = { 8c a4 19 40 }
        //0xffffffffa63536c8 == -1506462008
        $ = { c8 36 35 a6 }
        //0x49654aff == 1231375103
        $ = { ff 4a 65 49 }
        //0xffffffffd99142bf == -644791617
        $ = { bf 42 91 d9 }
        //0xffffffffabced403 == -1412508669
        $ = { 03 d4 ce ab }
        //0xffffffffb7ac7ce6 == -1213432602
        $ = { e6 7c ac b7 }
        //0x750b7070 == 1963683952
        $ = { 70 70 0b 75 }
        //0xfffffffff7555ef9 == -145400071
        $ = { f9 5e 55 f7 }
        //0x6fc5623e == 1875206718
        $ = { 3e 62 c5 6f }
    condition:
        all of them
}

rule CrowdStrike_CSIT_19108_10 : android artifact paperplane 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detect integers used by PaperPlane to create a password for AES-128 decryption"
        reports = "CSIT-19108"
        version = "201906280846"
        last_modified = "2019-06-28"
        malware_family = "PaperPlane"
    strings:
        //0x683f0840 == 1748961344
        $ = { 40 08 3f 68 }
        //0x2bb6eb5c == 733408092
        $ = { 5c eb b6 2b }
        //0x722f3d4c == 1915698508
        $ = { 4c 3d 2f 72 }
        //0xffffffffdb9a35b9 == -610650695
        $ = { b9 35 9a db }
        //0xffffffff92b85045 == -1833414587
        $ = { 45 50 b8 92 }
        //0x2a5d43ab == 710755243
        $ = { ab 43 5d 2a }
        //0xffffffff8acd8641 == -1966242239
        $ = { 41 86 cd 8a }
        //0x7808e137 == 2013847863
        $ = { 37 e1 08 78 }
        //0xffffffffb2a23884 == -1297991548
        $ = { 84 38 a2 b2 }
        //0xffffffff9edd3c3e == -1629668290
        $ = { 3e 3c dd 9e }
        //0x532ac6ef == 1395312367
        $ = { ef c6 2a 53 }
        //0x16ddbb78 == 383630200
        $ = { 78 bb dd 16 }
        //0x1b53abce == 458468302
        $ = { ce ab 53 1b }
        //0x697dc669 == 1769850473
        $ = { 69 c6 7d 69 }
        //0x481299c9 == 1209178569
        $ = { c9 99 12 48 }
        //0x65651aab == 1701124779
        $ = { ab 1a 65 65 }
        //0xffffffff9f2716a9 == -1624828247
        $ = { a9 16 27 9f }
        //0x22a5b32b == 581284651
        $ = { 2b b3 a5 22 }
        //0xffffffff8067b83d == -2140686275
        $ = { 3d b8 67 80 }
        //0x4cf4948f == 1291097231
        $ = { 8f 94 f4 4c }
        //0x59b38aee == 1504938734
        $ = { ee 8a b3 59 }
        //0xffffffffb56bc736 == -1251227850
        $ = { 36 c7 6b b5 }
        //0x675a3dc9 == 1733967305
        $ = { c9 3d 5a 67 }
        //0x15d6eae9 == 366406377
        $ = { e9 ea d6 15 }
        //0x1cd855fc == 483939836
        $ = { fc 55 d8 1c }
        //0xffffffffe8c38ff1 == -389836815
        $ = { f1 8f c3 e8 }
        //0xffffffffb7fba9db == -1208243749
        $ = { db a9 fb b7 }
        //0x7d157411 == 2098557969
        $ = { 11 74 15 7d }
        //0x5670a2c4 == 1450222276
        $ = { c4 a2 70 56 }
        //0x278404d6 == 662963414
        $ = { d6 04 84 27 }
        //0xffffffffb3f34888 == -1275901816
        $ = { 88 48 f3 b3 }
        //0x614bf46c == 1632367724
        $ = { 6c f4 4b 61 }
        //0x663d484b == 1715292235
        $ = { 4b 48 3d 66 }
        //0xffffffffa52be994 == -1523848812
        $ = { 94 e9 2b a5 }
        //0xffffffffa84c4cd6 == -1471394602
        $ = { d6 4c 4c a8 }
        //0x749d5c53 == 1956469843
        $ = { 53 5c 9d 74 }
        //0x6382413b == 1669480763
        $ = { 3b 41 82 63 }
        //0xffffffffecd075cd == -321882675
        $ = { cd 75 d0 ec }
        //0x1e5fbfd9 == 509591513
        $ = { d9 bf 5f 1e }
        //0x182111cb == 404820427
        $ = { cb 11 21 18 }
        //0x44dd4492 == 1155351698
        $ = { 92 44 dd 44 }
        //0x53501ad9 == 1397758681
        $ = { d9 1a 50 53 }
        //0x53ea7efa == 1407876858
        $ = { fa 7e ea 53 }
        //0xfffffffffb338eec == -80507156
        $ = { ec 8e 33 fb }
        //0x349f59e5 == 882858469
        $ = { e5 59 9f 34 }
        //0x32048e62 == 839159394
        $ = { 62 8e 04 32 }
        //0x126a50f3 == 308957427
        $ = { f3 50 6a 12 }
        //0xffffffff9d3c0492 == -1657011054
        $ = { 92 04 3c 9d }
        //0xffffffff9de3e88e == -1646008178
        $ = { 8e e8 e3 9d }
        //0xffffffffa5e4f58a == -1511721590
        $ = { 8a f5 e4 a5 }
    condition:
        all of them
}

rule CrowdStrike_CSIT_19108_09 : android artifact paperplane 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detect integers used by PaperPlane to create a password for AES-128 decryption"
        reports = "CSIT-19108"
        version = "201906280846"
        last_modified = "2019-06-28"
        malware_family = "PaperPlane"
    strings:
        //0x8b22046 == 145891398
        $ = { 46 20 b2 08 }
        //0x130ecf1d == 319737629
        $ = { 1d cf 0e 13 }
        //0xffffffffcd3dcc75 == -851587979
        $ = { 75 cc 3d cd }
        //0x73c2d60c == 1942148620
        $ = { 0c d6 c2 73 }
        //0xffffffffe8954ca1 == -392868703
        $ = { a1 4c 95 e8 }
        //0x2972138b == 695341963
        $ = { 8b 13 72 29 }
        //0xffffffffd54c7669 == -716409239
        $ = { 69 76 4c d5 }
        //0xffffffffd38e33b1 == -745655375
        $ = { b1 33 8e d3 }
        //0x5dba5d74 == 1572494708
        $ = { 74 5d ba 5d }
        //0xffffffffccfa29fb == -856020485
        $ = { fb 29 fa cc }
        //0x452a21b0 == 1160389040
        $ = { b0 21 2a 45 }
        //0xffffffffbc2b5af7 == -1138009353
        $ = { f7 5a 2b bc }
        //0xffffffff95b24da4 == -1783476828
        $ = { a4 4d b2 95 }
        //0x1e87d58a == 512218506
        $ = { 8a d5 87 1e }
        //0x430a7fb1 == 1124761521
        $ = { b1 7f 0a 43 }
        //0x70e16655 == 1893819989
        $ = { 55 66 e1 70 }
        //0x2ba5639a == 732259226
        $ = { 9a 63 a5 2b }
        //0x6d351aeb == 1832196843
        $ = { eb 1a 35 6d }
        //0x12ab3c45 == 313211973
        $ = { 45 3c ab 12 }
        //0x1b4109c0 == 457247168
        $ = { c0 09 41 1b }
        //0xffffffffbeae9dc2 == -1095852606
        $ = { c2 9d ae be }
        //0xffffffff945ef3cd == -1805716531
        $ = { cd f3 5e 94 }
        //0x3cd0c78c == 1020315532
        $ = { 8c c7 d0 3c }
        //0xfffffffff3298b47 == -215381177
        $ = { 47 8b 29 f3 }
        //0x6a0a70f == 111191823
        $ = { 0f a7 a0 06 }
        //0xffffffff93789c70 == -1820812176
        $ = { 70 9c 78 93 }
        //0x2c7ff26a == 746582634
        $ = { 6a f2 7f 2c }
        //0x1e9663f8 == 513172472
        $ = { f8 63 96 1e }
        //0xfffffffff57a8b75 == -176518283
        $ = { 75 8b 7a f5 }
        //0xfffffffffd784e9f == -42447201
        $ = { 9f 4e 78 fd }
        //0xffffffffabfdeb05 == -1409422587
        $ = { 05 eb fd ab }
        //0xffffffffb8875f5f == -1199087777
        $ = { 5f 5f 87 b8 }
        //0x1e8a6c6e == 512388206
        $ = { 6e 6c 8a 1e }
        //0x8d4a4d == 9259597
        $ = { 4d 4a 8d }
        //0x6cab0d49 == 1823149385
        $ = { 49 0d ab 6c }
        //0xfffffffffa14b96e == -99305106
        $ = { 6e b9 14 fa }
        //0x5ef0f576 == 1592849782
        $ = { 76 f5 f0 5e }
        //0xffffffff9ef209c0 == -1628304960
        $ = { c0 09 f2 9e }
        //0xffffffffa625af64 == -1507479708
        $ = { 64 af 25 a6 }
        //0x28e5c577 == 686146935
        $ = { 77 c5 e5 28 }
        //0xffffffffcd4a80cb == -850755381
        $ = { cb 80 4a cd }
        //0x41b0e879 == 1102112889
        $ = { 79 e8 b0 41 }
        //0x12e8024a == 317194826
        $ = { 4a 02 e8 12 }
        //0x6e6c9634 == 1852610100
        $ = { 34 96 6c 6e }
        //0xffffffffbbe41abe == -1142678850
        $ = { be 1a e4 bb }
        //0xffffffffa148948e == -1589078898
        $ = { 8e 94 48 a1 }
        //0x5faf6e32 == 1605332530
        $ = { 32 6e af 5f }
        //0x6af99b80 == 1794743168
        $ = { 80 9b f9 6a }
        //0x651d278c == 1696409484
        $ = { 8c 27 1d 65 }
        //0xfffffffffea70f3f == -22606017
        $ = { 3f 0f a7 fe }
    condition:
        all of them
}

rule CrowdStrike_CSIT_19108_11 : android artifact paperplane 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detect integers used by PaperPlane to create a password for AES-128 decryption"
        reports = "CSIT-19108"
        version = "201906280846"
        last_modified = "2019-06-28"
        malware_family = "PaperPlane"
    strings:
        //0xffffffffc915a7b0 == -921327696
        $ = { b0 a7 15 c9 }
        //0xffffffffa9496f75 == -1454805131
        $ = { 75 6f 49 a9 }
        //0xffffffffc490494c == -997177012
        $ = { 4c 49 90 c4 }
        //0x32966c42 == 848718914
        $ = { 42 6c 96 32 }
        //0xffffffffb1c0538d == -1312795763
        $ = { 8d 53 c0 b1 }
        //0x58f99248 == 1492750920
        $ = { 48 92 f9 58 }
        //0x1a8cfeb4 == 445447860
        $ = { b4 fe 8c 1a }
        //0xffffffffc3151244 == -1022029244
        $ = { 44 12 15 c3 }
        //0x43ad294f == 1135421775
        $ = { 4f 29 ad 43 }
        //0xffffffffd93923ec == -650566676
        $ = { ec 23 39 d9 }
        //0xffffffffd6ff0c99 == -687928167
        $ = { 99 0c ff d6 }
        //0xffffffff826ae70b == -2106923253
        $ = { 0b e7 6a 82 }
        //0x8255260 == 136663648
        $ = { 60 52 25 08 }
        //0x5eb53559 == 1588933977
        $ = { 59 35 b5 5e }
        //0x1b988528 == 462980392
        $ = { 28 85 98 1b }
        //0x15c64886 == 365316230
        $ = { 86 48 c6 15 }
    condition:
        all of them
}

rule CrowdStrike_CSIT_19108_12 : android artifact paperplane 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detect integers used by PaperPlane to create a password for AES-128 decryption"
        reports = "CSIT-19108"
        version = "201906280846"
        last_modified = "2019-06-28"
        malware_family = "PaperPlane"
    strings:
        //0xffffffffb11ee7b0 == -1323374672
        $ = { b0 e7 1e b1 }
        //0xffffffff9ad1bcb7 == -1697530697
        $ = { b7 bc d1 9a }
        //0xffffffffdf069c94 == -553214828
        $ = { 94 9c 06 df }
        //0xffffffffb9726ef1 == -1183682831
        $ = { f1 6e 72 b9 }
        //0x25186465 == 622355557
        $ = { 65 64 18 25 }
        //0xffffffff908d1b08 == -1869800696
        $ = { 08 1b 8d 90 }
        //0x6e69191 == 115773841
        $ = { 91 91 e6 06 }
        //0x23d4f567 == 601159015
        $ = { 67 f5 d4 23 }
        //0xffffffffa6761048 == -1502212024
        $ = { 48 10 76 a6 }
        //0xffffffffb18c96f6 == -1316186378
        $ = { f6 96 8c b1 }
        //0xffffffffa530d944 == -1523525308
        $ = { 44 d9 30 a5 }
        //0xffffffffcd29368f == -852937073
        $ = { 8f 36 29 cd }
        //0xffffffffd0dd72d9 == -790793511
        $ = { d9 72 dd d0 }
        //0x43887214 == 1133015572
        $ = { 14 72 88 43 }
        //0x61a0ba2d == 1637923373
        $ = { 2d ba a0 61 }
        //0x58b4d6f0 == 1488246512
        $ = { f0 d6 b4 58 }
        //0x9a8d21b == 162058779
        $ = { 1b d2 a8 09 }
        //0xffffffff9a9544ca == -1701493558
        $ = { ca 44 95 9a }
        //0xffffffffc758ca53 == -950482349
        $ = { 53 ca 58 c7 }
        //0x24a82d94 == 615001492
        $ = { 94 2d a8 24 }
        //0xffffffff9fb34c34 == -1615639500
        $ = { 34 4c b3 9f }
        //0x135dedaa == 324922794
        $ = { aa ed 5d 13 }
        //0xffffffffa6bab5a5 == -1497713243
        $ = { a5 b5 ba a6 }
        //0x7e2fb91 == 132316049
        $ = { 91 fb e2 07 }
        //0xffffffffeb2ce2f3 == -349379853
        $ = { f3 e2 2c eb }
        //0x596e123c == 1500385852
        $ = { 3c 12 6e 59 }
        //0x4adcd73a == 1255987002
        $ = { 3a d7 dc 4a }
        //0x2b60fc51 == 727776337
        $ = { 51 fc 60 2b }
        //0xffffffffc0cd539f == -1060285537
        $ = { 9f 53 cd c0 }
    condition:
        all of them
}

rule CrowdStrike_CSIT_19108_13 : android artifact paperplane 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detect integers used by PaperPlane to create a password for AES-128 decryption"
        reports = "CSIT-19108"
        version = "201906280846"
        last_modified = "2019-06-28"
        malware_family = "PaperPlane"
    strings:
        //0x6e14c055 == 1846853717
        $ = { 55 c0 14 6e }
        //0xffffffffe4b456fa == -457943302
        $ = { fa 56 b4 e4 }
        //0xffffffff9d3026ba == -1657788742
        $ = { ba 26 30 9d }
        //0xffffffffed1cc4df == -316881697
        $ = { df c4 1c ed }
        //0xffffffffad316a95 == -1389270379
        $ = { 95 6a 31 ad }
        //0xffffffffb6be372e == -1229048018
        $ = { 2e 37 be b6 }
        //0xffffffffacef6591 == -1393597039
        $ = { 91 65 ef ac }
        //0x182d6dc == 25351900
        $ = { dc d6 82 01 }
        //0xffffffffd805d2df == -670706977
        $ = { df d2 05 d8 }
        //0x1fdbf4e0 == 534508768
        $ = { e0 f4 db 1f }
        //0x4d16a559 == 1293329753
        $ = { 59 a5 16 4d }
        //0xffffffffdb9dd183 == -610414205
        $ = { 83 d1 9d db }
        //0xffffffffaddfd6d1 == -1377839407
        $ = { d1 d6 df ad }
        //0x37c2e866 == 935520358
        $ = { 66 e8 c2 37 }
        //0x59060eec == 1493569260
        $ = { ec 0e 06 59 }
        //0x29169ec9 == 689348297
        $ = { c9 9e 16 29 }
        //0x199c4351 == 429671249
        $ = { 51 43 9c 19 }
        //0xffffffff84665909 == -2073667319
        $ = { 09 59 66 84 }
        //0xffffffffe06aed47 == -529863353
        $ = { 47 ed 6a e0 }
        //0x71e9046a == 1911096426
        $ = { 6a 04 e9 71 }
        //0xffffffffb099c217 == -1332100585
        $ = { 17 c2 99 b0 }
        //0x41571917 == 1096227095
        $ = { 17 19 57 41 }
        //0x68bfa61d == 1757390365
        $ = { 1d a6 bf 68 }
        //0xffffffffff719c66 == -9331610
        $ = { 66 9c 71 ff }
        //0x469f91e == 74053918
        $ = { 1e f9 69 04 }
        //0xfffffffff4a66b5f == -190420129
        $ = { 5f 6b a6 f4 }
        //0x4e214005 == 1310801925
        $ = { 05 40 21 4e }
        //0xffffffffc5ef457e == -974174850
        $ = { 7e 45 ef c5 }
        //0xffffffff83e065ae == -2082445906
        $ = { ae 65 e0 83 }
        //0x47026fb8 == 1191342008
        $ = { b8 6f 02 47 }
        //0xffffffffb931aa58 == -1187927464
        $ = { 58 aa 31 b9 }
        //0x2bf85fbb == 737697723
        $ = { bb 5f f8 2b }
        //0xfffffffff4bf89f5 == -188773899
        $ = { f5 89 bf f4 }
        //0x33ea5f7a == 870997882
        $ = { 7a 5f ea 33 }
        //0x28ed415c == 686637404
        $ = { 5c 41 ed 28 }
        //0xffffffffa0cc88e8 == -1597208344
        $ = { e8 88 cc a0 }
        //0xffffffff93944581 == -1818999423
        $ = { 81 45 94 93 }
        //0x62730e23 == 1651707427
        $ = { 23 0e 73 62 }
    condition:
        all of them
}

rule CrowdStrike_CSIT_19108_14 : android artifact paperplane 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detect integers used by PaperPlane to create a password for AES-128 decryption"
        reports = "CSIT-19108"
        version = "201906280846"
        last_modified = "2019-06-28"
        malware_family = "PaperPlane"
    strings:
        //0xffffffffe808a197 == -402087529
        $ = { 97 a1 08 e8 }
        //0xfffffffff3ff72e9 == -201362711
        $ = { e9 72 ff f3 }
        //0x302698e4 == 807835876
        $ = { e4 98 26 30 }
        //0x21edf805 == 569243653
        $ = { 05 f8 ed 21 }
        //0xffffffffe685472e == -427473106
        $ = { 2e 47 85 e6 }
        //0x20c7464a == 549930570
        $ = { 4a 46 c7 20 }
        //0x2452036b == 609354603
        $ = { 6b 03 52 24 }
        //0xffffffffada519dd == -1381688867
        $ = { dd 19 a5 ad }
        //0xffffffffdafa65fc == -621124100
        $ = { fc 65 fa da }
        //0xffffffff9cd624dc == -1663687460
        $ = { dc 24 d6 9c }
        //0xffffffffc9cc939f == -909339745
        $ = { 9f 93 cc c9 }
        //0xffffffffd8f430b2 == -655085390
        $ = { b2 30 f4 d8 }
        //0xffffffffd0ce7ba2 == -791774302
        $ = { a2 7b ce d0 }
        //0x12cad1ab == 315281835
        $ = { ab d1 ca 12 }
        //0xffffffff9e7a4034 == -1636155340
        $ = { 34 40 7a 9e }
        //0xffffffffbf2b4bca == -1087681590
        $ = { ca 4b 2b bf }
        //0x6b39e85f == 1798957151
        $ = { 5f e8 39 6b }
        //0xffffffffe84830da == -397922086
        $ = { da 30 48 e8 }
        //0xfffffffff7fa1975 == -134604427
        $ = { 75 19 fa f7 }
        //0x122b6fc2 == 304836546
        $ = { c2 6f 2b 12 }
        //0xfffffffffe9f7049 == -23105463
        $ = { 49 70 9f fe }
        //0xffffffffbcd7cce9 == -1126707991
        $ = { e9 cc d7 bc }
        //0xffffffff99085e61 == -1727504799
        $ = { 61 5e 08 99 }
        //0xffffffff87310d0a == -2026828534
        $ = { 0a 0d 31 87 }
    condition:
        all of them
}

rule CrowdStrike_CSIT_19108_15 : android artifact paperplane 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detect integers used by PaperPlane to create a password for AES-128 decryption"
        reports = "CSIT-19108"
        version = "201906280846"
        last_modified = "2019-06-28"
        malware_familiy = "PaperPlane"
    strings:
        //0x3551d040 == 894554176
        $ = { 40 d0 51 35 }
        //0x34804451 == 880821329
        $ = { 51 44 80 34 }
        //0xffffffffce8c5aa6 == -829662554
        $ = { a6 5a 8c ce }
        //0xffffffff87533cbc == -2024588100
        $ = { bc 3c 53 87 }
        //0x36b10fd7 == 917573591
        $ = { d7 0f b1 36 }
        //0x301a16f7 == 807016183
        $ = { f7 16 1a 30 }
        //0xffffffffa18dca76 == -1584543114
        $ = { 76 ca 8d a1 }
        //0xffffffffb19205fa == -1315830278
        $ = { fa 05 92 b1 }
        //0x55725421 == 1433556001
        $ = { 21 54 72 55 }
        //0x15dd2ff3 == 366817267
        $ = { f3 2f dd 15 }
        //0xfffffffff8435929 == -129803991
        $ = { 29 59 43 f8 }
        //0xffffffffa9c8c695 == -1446459755
        $ = { 95 c6 c8 a9 }
        //0x6358e669 == 1666770537
        $ = { 69 e6 58 63 }
        //0x28a1d8b1 == 681695409
        $ = { b1 d8 a1 28 }
        //0xffffffffc42e41bb == -1003601477
        $ = { bb 41 2e c4 }
        //0xffffffff94b69a27 == -1799972313
        $ = { 27 9a b6 94 }
        //0x5e5911ad == 1582895533
        $ = { ad 11 59 5e }
        //0x41e7a490 == 1105699984
        $ = { 90 a4 e7 41 }
        //0xffffffff9bc4ed75 == -1681592971
        $ = { 75 ed c4 9b }
        //0xfffffffff011cc5a == -267269030
        $ = { 5a cc 11 f0 }
    condition:
        all of them
}

rule CrowdStrike_CSIT_19014_01 : greyenergy loader voodoo_bear 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Loader used to deploy GreyEnergy Mini (outer/first stage)"
        reports = "CSIT-19014"
        version = "201901251056"
        last_modified = "2019-01-25"
        actor = "VOODOO BEAR"
        malware_family = "GreyEnergy Mini"
    strings:
        $code_frag_1  = { 83 c1 e0 83 ca ff 33 f6 d3 ea 89 55 f8 }
        $code_frag_2 = { 0f b6 4d ff 8a 1c 01 88 1c 06 88 14 01 }
    condition:
        filesize < 500KB and
        filesize > 80KB and
        all of them
}

rule CrowdStrike_CSIT_19014_02 : greyenergy loader voodoo_bear 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Loader used to deploy GreyEnergy Mini (intermediate loader)"
        reports = "CSIT-19014"
        version = "201904221317"
        last_modified = "2019-04-22"
        actor = "VOODOO BEAR"
        malware_family = "GreyEnergy Mini"
    strings:
        $code_va_58D19995 = { c6 45 dc 44 c6 45 dd 69 c6 45 de 73 c6 45 df 61 c6 45 e0 62 c6 45 e1 6c c6 45 e2 65 c6 45 e3 54 c6 45 e4 68 c6 45 e5 72 c6 45 e6 65 c6 45 e7 61 c6 45 e8 64 c6 45 e9 4c c6 45 ea 69 c6 45 eb 62 c6 45 ec 72 c6 45 ed 61 c6 45 ee 72 c6 45 ef 79 }
        $code_alt_1 = { 0f b6 d2 03 f2 81 e6 ff 00 00 00 }
        $code_alt_2 = { 8a 14 06 30 14 39 47 }
        $code_alt_3 = { 88 88 00 01 00 00 }
        $code_alt_4 = { 0f 84 0c 00 00 00 }
        $code_alt_5 = { 8a 14 06 89 d9 00 55 ff }
        $str_gpu = "GPU_Tweak"
    condition:
        filesize < 1MB
        and not $str_gpu
        and
        (
        (any of ($code_va_*)) or
        (all of ($code_alt_*))
        )
}

rule CrowdStrike_CSIT_19014_03 : greyenergy rat voodoo_bear 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects GreyEnergy Mini payload"
        reports = "CSIT-19014"
        version = "201907031248"
        last_modified = "2019-07-03"
        actor = "VOODOO BEAR"
        malware_family = "GreyEnergy Mini"
    strings:
        $code_ascii_xor = { 8a 1c 39 8b d1 83 e2 03 8a 54 15 08 3a da 74 08 32 d3 88 54 08 fc eb 04 }
        $code_wide_xor = { 0f b7 09 8b c7 83 e0 03 8a 44 05 fc 0f be f0 3b ce 74 12 66 98 66 33 c1 b9 ff 00 00 00 66 23 c1 66 89 02 }
        $str_hw_guid = "GetCurrentHwProfileA" fullword
        $str_fmt_w = "%lS,%lS,%lu.%lu,%lS,%lS,%lS,%lu" wide
    condition:
        filesize > 10KB and
        3 of them
}

rule CrowdStrike_CSIT_19034_01 : bot miori mirai 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detect Miori variants of Mirai IoT bot"
        reports = "CSIT-19034"
        version = "202104121046"
        last_modified = "2021-04-12"
        malware_family = "Miori"
    strings:
        $t1 = { 58 42 03 12 12 0e 07 16 42 0c 0d 16 42 04 0d 17 0c 06 62 }
        $t2 = { 53 05 00 03 56 01 06 0d 0f 57 51 0c 0a 12 53 50 07 0b 07 05 03 07 62 }
    condition:
        uint32(0) == 0x464c457f and all of ($t*)
}

rule CrowdStrike_CSIT_19022_01 : infostealer loader ramnit 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects loader used by Ramnit"
        reports = "CSIT-19022"
        version = "201902151734"
        last_modified = "2019-02-15"
        malware_family = "Ramnit"
    strings:
        $a_createprocess = "1wCreateUserProcess" fullword ascii
        $a_reg_sz = "1EG_SZ" fullword ascii
        $a_startup = "1tartup" fullword ascii
        $a_consent = "1onsent.exe" fullword ascii
        $a_loader = "loader.exe" fullword ascii
        $a_applyexploit = "_ApplyExploit@4" fullword ascii
        $a_checkbypassed = "_CheckBypassed@0" fullword ascii
        $a_regkey = "jfghdug_ooetvtgk" fullword ascii
        $code_lde = { 60 68 10 15 00 00 68 ff 01 01 10 68 55 ff ff ff 6a f8 68 a0 7f ff f8 68 0d c4 0e 0f 68 04 10 55 07 68 ff 05 d0 01 68 55 5d 0d 55 68 88 0f 5f 55 68 ff ff f3 f3 68 54 11 0c 0a 8b d6 8b f4 6a 19 68 80 0b ac b0 68 3e f3 b1 bf 68 58 ea 11 00 }
        $code_inject = { 81 c4 a0 fe ff ff 90 90 6a 00 90 90 8f 85 ?? ?? ?? ?? 90 90 90 90 6a 00 90 90 8f 45 e0 90 90 68 38 01 00 00 8d 85 ?? ?? ?? ?? 50 e8 bd da ff ff 90 90 68 00 00 00 10 }
    condition:
        6 of ($a_*)
        and any of ($code_*)
}

rule CrowdStrike_CSIT_19022_02 : infostealer ramnit 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects the main module of the Ramnit malware"
        reports = "CSIT-19022"
        version = "201902151735"
        last_modified = "2019-02-15"
        malware_family = "Ramnit"
    strings:
        $a_ramnit_dll = "rmnsoft.dll\x00_CryptoCheckSignMessage@24" fullword ascii
        $a_moved_permanently = "HTTP/1.x 301 Moved Permanently\x0d\x0aServer: Apache/2.2.14\x0d\x0aExpires: Mon, 26 Jul 1997 05:00:00 GMT\x0d\x0aCache-Control: max-age=0\x0d\x0aPragma: no-cache\x0d\x0aConnection: close\x0d\x0aContent-Type: text/html\x0d\x0aLocation: \x0d\x0aExpires: Mon, 26 Jul 1997 05:00:00 GMT\x0d\x0aCache-Control: max-age=0\x0d\x0aCache-Control: no-store, no-cache, must-revalidate\x0d\x0aCache-Control: post-check=0, pre-check=0\x0d\x0aPragma: no-cache\x0d\x0a\x0d\x0aen-us" fullword ascii
        $a_removecookies = "removecookies" fullword ascii
        $a_cookies4 = "cookies4.dat" fullword ascii
        $a_cookiesplist = "Cookies.plist" fullword ascii
        $a_exec = "1etexec" fullword ascii
        $loader_loader = "loader.exe" fullword ascii
        $loader_applyexploit = "_ApplyExploit@4" fullword ascii
        $loader_checkbypassed = "_CheckBypassed@0" fullword ascii
        $code_string_decryption = { 8b 4d 0c 8b 7d 08 8b 75 10 ba 00 00 00 00 0b d2 75 04 8b 55 14 4a 8a 1c 32 32 1f 88 1f 47 4a e2 ed }
        $code_rsa_check = { 8b 4d 10 8b 51 04 52 8b 45 14 8b 48 04 51 6a 14 6a 05 6a 00 8d 95 ?? ?? ?? ?? 52 e8 37 0b 00 00 85 c0 75 07 c7 45 fc 01 00 00 00 }
    condition:
        all of ($a_*)
        and not (any of ($loader_*))
        and all of ($code_*)
        and filesize < 160KB
}

rule CrowdStrike_CSIT_19022_03 : infostealer ramnit 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects plugin loader module used by Ramnit malware"
        reports = "CSIT-19022"
        version = "201902151737"
        last_modified = "2019-02-15"
        malware_family = "Ramnit"
    strings:
        $a_modules_dll = "modules.dll" fullword ascii
        $a_routines = "StartRoutine\x00StopRoutine\x00ModuleCode\x00CommandRoutine" fullword ascii
        $loader_loader = "loader.exe" fullword ascii
        $loader_applyexploit = "_ApplyExploit@4" fullword ascii
        $loader_checkbypassed = "_CheckBypassed@0" fullword ascii
        $code_string_decryption = { 8b 4d 0c 8b 7d 08 8b 75 10 ba 00 00 00 00 0b d2 75 04 8b 55 14 4a 8a 1c 32 32 1f 88 1f 47 4a e2 ed }
    condition:
        all of ($a_*)
        and not (any of ($loader_*))
        and all of ($code_*)
        and filesize < 60KB
}

rule CrowdStrike_CSIT_19033_01 : commodity hawkeye infostealer keylogger 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects the HawkEye keylogger commodity malware, 'Reborn' edition."
        reports = "CSIT-19033"
        version = "202002251740"
        last_modified = "2020-02-25"
        malware_family = "HawkEye"
    strings:
        $hawk_banner_1 = "HawkEye Keylogger - Reborn" wide
        $hawk_banner_2 = "HawkEye RebornX" wide
        $dependency1 = "Rfc2898DeriveBytes"
        $dependency2 = "RijndaelManaged"
        $dependency3 = "BinaryFormatter"
        $dependency4 = "System.Runtime.Serialization.Formatters.Binary"
        $dependency5 = "System.Net.Mail"
        $dependency6 = "System.Security.Cryptography"
        $dependency7 = "SmtpClient"
        $dependency8 = "FtpWebRequest"
        $dependency9 = "FtpWebResponse"
        $string_log1 = "================================================={0}Application: {1}{0}Host: {2}{0}Username: {3}{0}Password: {4}{0}================================================={0}" wide
        $string_log2 = "{0}{0}============={1} {2}============={0}{0}" wide
        $string_log3 = "Name: {0} [{1}]{7}Type: {2} [{3}]{7}Size: {4}{7}File: {5} [{6}]" wide
        $string_cmd1 = "echo.>{0}:Zone.Identifier" wide
        $string_cmd2 = "ping 1.1.1.1 -n 1 -w 1 > Nul & Del \"{0}\" & start \"\" \"{1}.exe\"" wide
        $string_cmd3 = "ping 1.1.1.1 -n 1 -w 1 > Nul & start \"\" \"{1}.exe\"" wide
        $string_cat1 = "Content-Disposition: form-data; name=\"files[]\"; filename=\"file.png\"" wide
        $string_cat2 = "url\":\"(?<url>.+?)\"" wide
    condition:
        7 of ($dependency*) and (any of ($hawk_banner*) or 6 of ($string*))
}

rule CrowdStrike_CSIT_19068_03 : delivery_document scriptlet taurus 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects Taurus Scriptlets observed throughout November and December 2018."
        reports = "CSIT-19068"
        version = "201904260919"
        last_modified = "2019-04-26"
        malware_family = "Taurus Loader"
    strings:
        $js_a = ") {( Function("
        $js_b = "))();}"
        $js_c = "));}}"
        $char_sub1 = "= \"'\";break;case"
        $char_sub2 =  " = \"$\";break;case "
    condition:
        ($js_a and $js_b and $js_c) or
        ($char_sub1 and $char_sub2)
}

rule CrowdStrike_CSIT_19011_02 : delivery sfx sload zip 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects the initial zip or SFX file distributed via sLoad phishing campaigns."
        reports = "CSIT-19011"
        version = "201901181438"
        last_modified = "2019-01-18"
        malware = "sLoad Downloader"
    strings:
        $lnk = ".lnkPK"
        $img = /image_201[89].{0,30}\.(jpg|png)/
        $pk = { 50 4B 03 04 }
    condition:
        $lnk and $img and (#pk >= 2 and #pk <= 4)
}

rule CrowdStrike_CSIT_19058_02 : loader nimbus ricochet_chollima 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects the loader used for Nimbus in November 2018 RICOCHET CHOLLIMA campaigns."
        reports = "CSIT-19058"
        version = "201904051307"
        last_modified = "2019-04-05"
        actor = "RICOCHET CHOLLIMA"
        malware_family = "Nimbus"
    strings:
        $ = "llyd" fullword wide
        $ = "ilemo" fullword wide
        $ = "egmon" fullword wide
        $ = "rocex" fullword wide
        $ = "iddler" fullword wide
        $ = "iresha" fullword wide
        $ = "rocmo" fullword wide
        $ = "cpvie" fullword wide
        $ = "utoru" fullword wide
        $ = "appdata" wide
        $ = "cmd.exe"
        $ = "NtQueryInformationProcess"
        $ = "RtlCreateUserThread"
        $ = "GetWindowThreadProcessId"
    condition:
        all of them
}

rule CrowdStrike_CSIT_19028_01 : ecrime infostealer mojo 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects Mojo InfoStealer"
        reports = "CSIT-19028"
        version = "201903011638"
        last_modified = "2019-03-01"
        malware_family = "Mojo"
    strings:
        $ = "64bit"
        $ = "kometa"
        $ = "orbitum"
        $ = "chrome"
        $ = "amigo"
        $ = "mojo" wide
        $ = "windowsmail"
        $ = "incredimail"
        $ = "outlook"
        $rc4key = "asdasdfasdf45ghy"
    condition:
        $rc4key or
        8 of them
}

rule CrowdStrike_CSIT_19029_02 : rbdoor wicked_panda winnti 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects distinctive strings related to the persistence installer component of Winnti malware."
        reports = "CSIT-19029"
        version = "201903011635"
        last_modified = "2019-03-01"
        actor = "WICKED PANDA"
        malware_family = "Winnti"
    strings:
        $debug = "My_SetConsoleCtrlHandler:"
        $appinit = "AppInit_DLL"
    condition:
        all of them
}

rule CrowdStrike_CSIT_19029_01 : wicked_panda winnti 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects distinctive header strings in the Winnti IIS filter."
        reports = "CSIT-19029"
        version = "201903011634"
        last_modified = "2019-03-01"
        actor = "WICKED PANDA"
        malware_family = "Winnti"
    strings:
        $encode_header = "X-ENCODE"
        $bin_header = "X-BIN"
        $last_header = "X_LAST"
        $sign_header = "X-SIGN"
    condition:
        all of them
}

rule CrowdStrike_CSA_19106_01 : cobravenom rat velvet_chollima 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects strings found in the Debugmsg variant of CobraVenom"
        reports = "CSA-19106,CSIT-20136"
        version = "202007271020"
        last_modified = "2020-07-27"
        actor = "VELVET CHOLLIMA"
        malware_family = "CobraVenom"
    strings:
        $ = "GetMacAddr %d (%s)"
        $ = "HttpDownloadFile : Remote Path = %s, %s"
        $ = "InjectExplorer : dll = %s, %x"
    condition:
        any of them
}

rule CrowdStrike_CSIT_19045_01 : fakedead 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule looks for debug statements found within the FakeDead malware."
        reports = "CSIT-19045"
        version = "202004031948"
        last_modified = "2020-04-03"
        malware_family = "FakeDead"
    strings:
        $a1 = "[+] Rc4Key::0x%lx:%lx:%lx:%lx:%lx:%lx:%lx:%lx"
        $a2 = "[+] RecvData Authen Ack ok."
        $a3 = "[+] Module_SK Start ..."
        $a4 = "[+] SKWorking out. (nRet=%d)"
        $a5 = "[+] DoWork ..."
        $a6 = "[-] Sorry func addr is null!"
        $a7 = "[+] Mem Load ok."
        $a8 = "[+] Begin fucking ... (size=%dB)"
        $a9 = "[+] Recv WorkerDLL ok. (size=%dB)"
        $a10 = "[+] Recv WorkerDLL Data size=%d"
        $a11 = "[.] Recv WorkerDLL Data ..."
        $a12 = "[+] ICMP Wakeup mode!"
        $a13 = "--------------------------------------fes.m_dwHASHKEY=0x%lx"
        $a14 = "SK_Working"
        $a15 = { 5B 2D 5D 20 D1 E9 D6 A4 CA A7 B0 DC 21 20 2D 20 62 3D 25 64 0A }
        $a16 = { 5B 2D 5D 20 CA D5 B5 BD D2 EC B3 A3 B0 FC 21 21 21 0A }
        $a17 = { 5B 2D 5D 20 CA D5 B5 BD D2 EC B3 A3 B0 FC 20 21 0A }
        $a18 = { 5B 2D 5D B5 C8 B4 FD D1 E9 D6 A4 BD E1 B9 FB B3 AC CA B1 21 0A }
    condition:
        2 of them and
        uint16(0) == 0x5A4D and
        uint32(uint32(0x3C)) == 0x00004550
}

rule CrowdStrike_CSIT_19045_02 : fakedead 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects mutex strings found within the FakeDead malware."
        reports = "CSIT-19045"
        version = "202004031949"
        last_modified = "2020-04-03"
        malware_family = "FakeDead"
    strings:
        $a1 = ")!VoqA^I4"
        $a2 = "DFG%^&I4"
        $a3 = ")!VqA^IMs!hp4"
        $a4 = "!Voq)(*I4"
        $a5 = ")!VdfsI4"
        $a6 = ")!VoqA^I6"
        $a7 = ")!VoqA^I88"
        $a8 = ")!VoqAds^I4"
        $a9 = "fsdajkVA^I4"
        $b1 = "mutexfill"
        $b2 = "i am mutex"
        $b3 = "!31<!.~$g7P:``!w%4189*hbGCV/;:,+|..."
        $b4 = "w/!|!|soswwwmwwwwwwwwwwwwwwwwww"
    condition:
        1 of ($a*) or 2 of ($b*) and
        uint16(0) == 0x5A4D and
        uint32(uint32(0x3C)) == 0x00004550
}

rule CrowdStrike_CSIT_19076_01 : artifact encoded facade venomous_bear 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects the header of the encoded dump file for Facade"
        reports = "CSIT-19076"
        version = "201905030838"
        last_modified = "2019-05-03"
        actor = "VENOMOUS BEAR"
        malware_family = "Facade"
    strings:
        $header = { aa ff 12 90 02 ?? 00 00 ?? ?? ?? ?? ?? ?? ?? ?? ?? 00 00 00 }
    condition:
        $header
}

rule CrowdStrike_CSIT_19076_03 : facade pdf venomous_bear 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects details of the metadata object for the exfiltration PDF produced by Facade"
        reports = "CSIT-19076"
        version = "201905030837"
        last_modified = "2019-05-03"
        actor = "VENOMOUS BEAR"
        malware_family = "Facade"
    strings:
        $pdf = { 25 50 44 46 }
        // AA388EDFD87C47B4B61322D607C33CE176D0C2C07FBF509A9CD87D4128A8127A @ 0x694
        $xpacket_meta  = { 0a 65 6e 64 73 74 72 65 61 6d 0a 65 6e 64 6f 62 6a 0a 33 20 30 20 6f 62 6a 0a 3c 3c 2f 54 79 70 65 2f 50 61 67 65 2f 50 61 72 65 6e 74 20 31 20 30 20 52 2f 4d 65 64 69 61 42 6f 78 5b 30 20 30 20 35 39 35 2e 30 30 20 38 34 31 2e 30 30 5d 2f 43 6f 6e 74 65 6e 74 73 20 34 20 30 20 52 2f 52 65 73 6f 75 72 63 65 73 20 36 20 30 20 52 3e 3e 0a 65 6e 64 6f 62 6a 0a 34 20 30 20 6f 62 6a 0a 3c 3c 2f 4c 65 6e 67 74 68 20 35 20 30 20 52 3e 3e 73 74 72 65 61 6d 0a 71 0a 31 20 30 20 30 20 31 20 30 2e 30 30 20 31 32 33 2e 30 30 20 63 6d 0a 35 39 35 2e 30 30 20 30 20 30 20 35 39 35 2e 30 30 20 30 20 30 20 63 6d 0a 2f 49 30 20 44 6f 0a 51 0a 65 6e 64 73 74 72 65 61 6d 0a 65 6e 64 6f 62 6a 0a 35 20 30 20 6f 62 6a 0a 35 39 0a 65 6e 64 6f 62 6a 0a 36 20 30 20 6f 62 6a 0a 3c 3c 2f 50 72 6f 63 53 65 74 5b 2f 50 44 46 2f 49 6d 61 67 65 43 5d 2f 58 4f 62 6a 65 63 74 3c 3c 2f 49 30 20 32 20 30 20 52 3e 3e 3e 3e 0a 65 6e 64 6f 62 6a 0a 37 20 30 20 6f 62 6a 0a 3c 3c 2f 54 79 70 65 2f 4d 65 74 61 64 61 74 61 20 2f 53 75 62 74 79 70 65 2f 58 4d 4c 20 2f 4c 65 6e 67 74 68 20 39 32 34 3e 3e 0a 73 74 72 65 61 6d 0a 3c 3f 78 70 61 63 6b 65 74 20 62 65 67 69 6e 3d 22 ef bb bf 22 20 69 64 3d 22 57 35 4d 30 4d 70 43 65 68 69 48 7a 72 65 53 7a 4e 54 63 7a 6b 63 39 64 22 3f 3e 0a 3c 78 3a 78 6d 70 6d 65 74 61 20 78 6d 6c 6e 73 3a 78 3d 22 61 64 6f 62 65 3a 6e 73 3a 6d 65 74 61 2f 22 3e 0a 3c 72 64 66 3a 52 44 46 20 78 6d 6c 6e 73 3a 72 64 66 3d 22 68 74 74 70 3a 2f 2f 77 77 77 2e 77 33 2e 6f 72 67 2f 31 39 39 39 2f 30 32 2f 32 32 2d 72 64 66 2d 73 79 6e 74 61 78 2d 6e 73 23 22 3e 0a 3c 72 64 66 3a 44 65 73 63 72 69 70 74 69 6f 6e 20 78 6d 6c 6e 73 3a 64 63 3d 22 68 74 74 70 3a 2f 2f 70 75 72 6c 2e 6f 72 67 2f 64 63 2f 65 6c 65 6d 65 6e 74 73 2f 31 2e 31 2f 22 20 72 64 66 3a 61 62 6f 75 74 3d 22 22 3e 0a 3c 64 63 3a 74 69 74 6c 65 3e 4e 6f 6e 65 3c 2f 64 63 3a 74 69 74 6c 65 3e 0a 3c 64 63 3a 73 75 62 6a 65 63 74 3e 4e 6f 6e 65 3c 2f 64 63 3a 73 75 62 6a 65 63 74 3e 0a 3c 64 63 3a 63 72 65 61 74 6f 72 3e 41 63 72 6f 62 61 74 20 50 44 46 4d 61 6b 65 72 20 39 2e 30 3c 2f 64 63 3a 63 72 65 61 74 6f 72 3e 0a 3c 64 63 3a 64 61 74 65 3e }
    condition:
        $pdf at 0 and $xpacket_meta
}

rule CrowdStrike_CSIT_19076_02 : artifact facade venomous_bear 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects beginning of exfiltration document file produced by Facade"
        reports = "CSIT-19076"
        version = "201905030836"
        last_modified = "2019-05-03"
        actor = "VENOMOUS BEAR"
        malware_family = "Facade"
    strings:
        // 1A425156CC15B2C81498FB6A4847A7D5590BBB73C66CFCCFB99EF3CACB9C17E1 @ 0x0
        $docfile  = { d0 cf 11 e0 a1 b1 1a e1 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 3e 00 03 00 fe ff 09 00 06 00 00 00 00 00 00 00 00 00 00 00 01 00 00 00 01 00 00 00 00 00 00 00 00 10 00 00 02 00 00 00 01 00 00 00 fe ff ff ff 00 00 00 00 00 00 00 00 ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff aa ff 12 90 }
    condition:
        $docfile at 0
}

rule CrowdStrike_CSIT_19040_09 : rat roguerobin 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects a PDB string found in RogueRobin samples."
        reports = "CSIT-19040"
        version = "201904112249"
        last_modified = "2019-04-11"
        malware_family = "Rogue Robin"
    strings:
        //C:\Users\william\Documents\Visual Studio 2015\Projects\DNSProject\DNSProject\obj\Release\DNSProject.pdb
        $ = "C:\\Users\\william\\Documents\\Visual Studio 2015\\Projects"
        $ = "\\DNSProject\\DNSProject\\obj"
        $ = "\\Release\\DNSProject.pdb"
    condition:
        3 of them
}

rule CrowdStrike_CSIT_19040_08 : rat roguerobin 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects .NET GUIDs used to compile RogueRobin malware."
        reports = "CSIT-19040"
        version = "201904112250"
        last_modified = "2019-04-11"
    strings:
        $ = "c1c54650-08c1-4fed-af6a-7549be51ea4e" //TypeLib ID
        $ = "23a0cb70-2c89-47ce-9dd6-20fc76b8dbfc" //MVID eb33a96726a34dd60b053d3d1048137dffb1bba68a1ad6f56d33f5d6efb12b97
        $ = "2c2f015b-2825-4574-a7a9-a715dd8a3cf1" //MVID f1b2bc0831445903c0d51b390b1987597009cc0fade009e07d792e8d455f6db0
        $ = "d4b9a77b-6841-4731-a97e-33c2f84266b8" //MVID 5cc62ad6baf572dbae925f701526310778f032bb4a54b205bada78b1eb8c479c
    condition:
        any of them
}

rule CrowdStrike_CSIT_19040_07 : rat roguerobin 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects C2 domains used for RogueRobin malware."
        reports = "CSIT-19040"
        version = "201904112250"
        last_modified = "2019-04-11"
        malware_family = "Rogue Robin"
    strings:
        $ = "0ffice365.agency" wide
        $ = "0nedrive.agency" wide
        $ = "corewindows.agency" wide
        $ = "microsoftonline.agency" wide
        $ = "onedrive.agency" wide
        $ = "sharepoint.agency" wide
        $ = "skydrive.agency" wide
        $ = "0ffice365.life" wide
        $ = "0ffice365.services" wide
        $ = "skydrive.services"
        $ = "akdns.live" wide
        $ = "akamaiedge.live" wide
        $ = "edgekey.live" wide
        $ = "akamaized.live" wide
        $ = "akstat.services" wide
        $ = "cloudapp.network" wide
        $ = "digicert.network" wide
        $ = "globalsign.live" wide
        $ = "asimov-win-microsoft.services" wide
        $ = "data-microsoft.services" wide
        $ = "iecvlist-microsoft.live" wide
        $ = "onecs-live.services" wide
        $ = "akamai.agency" wide
        $ = "akamaiedge.services" wide
        $ = "azureedge.today" wide
        $ = "nsatc.agency" wide
        $ = "phicdn.world" wide
        $ = "t-msedge.world" wide
    condition:
        4 of them
}

rule CrowdStrike_CSIT_19040_06 : rat roguerobin 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects nslookup structure used for C2 commands in RogueRobin malware."
        reports = "CSIT-19040"
        version = "201904112250"
        last_modified = "2019-04-11"
        malware_family = "Rogue Robin"
    strings:
        $ = "nslookup.exe -timeout={0} -q={1} {2}-{5}.{3} {4}" wide
        $ = "nslookup.exe -timeout={0} -q={1} {2}.ac.{3} {4}" wide
    condition:
        any of them
}

rule CrowdStrike_CSIT_19040_05 : rat roguerobin 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects regular expression used for decoded RogueRobin command markers."
        reports = "CSIT-19040"
        version = "201904112250"
        last_modified = "2019-04-11"
    strings:
        $ = "^kill" wide
        $ = "^\\$fileDownload" wide
        $ = "^\\$importModule" wide
        $ = "^\\$x_mode" wide
        $ = "^\\$ClearModules" wide
        $ = "^\\$fileUpload" wide
        $ = "^testmode" wide
        $ = "^showconfig" wide
        $ = "^changeConfig" wide
        $ = "^slp" wide
        $ = "^exit" wide
    condition:
        all of them
}

rule CrowdStrike_CSIT_19040_04 : rat roguerobin 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects regular expression used to validate DNS response data by Rogue Robin malware."
        reports = "CSIT-19040"
        version = "201904112251"
        last_modified = "2019-04-11"
    strings:
        $ = "Address:\\s+40.112.(\\d+.\\d+)" wide
        $ = "Address:\\s+\\d+.\\d+.\\d+.\\d+" wide
        $ = "Address:\\s+(([a-fA-F0-9]{0,4}:{1,2}){1,8})" wide
    condition:
        all of them
}

rule CrowdStrike_CSIT_19040_03 : rat roguerobin 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects regular expressions used to parse decoded RogueRobin commands."
        reports = "CSIT-19040"
        version = "201904112251"
        last_modified = "2019-04-11"
        malware_family = "Rogue Robin"
    strings:
        $ = "[r-v]" wide
        $ = "[^r-v\\s]" wide
        $ = "([\\w\\d+\\/=]+)-\\w+." wide
        $ = "([\\w\\d+\\/=]+)." wide
        $ = "Address:\\s+(([a-fA-F0-9]{0,4}:{1,4}[\\w|:]+){1,8})" wide
    condition:
        all of them
}

rule CrowdStrike_CSIT_19040_02 : rat roguerobin 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects compiled intermediate language for RogueRobin victim profiling structure code."
        reports = "CSIT-19040"
        version = "201904112251"
        last_modified = "2019-04-11"
        malware_family = "Rogue Robin"
    strings:
        //myInfo string concat
        $ = {1F148D??000001251606A2251772??030070A2251809A2251972??030070A2251A07A2251B72??030070A2251C08A2251D72??030070A2251E1104A2251F0972??030070A2251F0A7E090000042D0772??0100702B0572??0300706F??00000AA2251F0B72??030070A2251F0C7E0A0000042D0772??0100702B0572??0300706F??00000AA2251F0D72??030070A2251F0E7E110000042D0772??0100702B0572??0300706F??00000AA2251F0F72??030070A2251F107F0600000428??00000AA2251F1172??030070A2251F127F0700000428??00000AA2251F1372????0070A228??00000A2A}
    condition:
        all of them
}

rule CrowdStrike_CSIT_19040_01 : rat roguerobin 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects compiled intermediate language RogueRobin code used to encode and decode data."
        reports = "CSIT-19040"
        version = "201904112251"
        last_modified = "2019-04-11"
        malware_family = "Rogue Robin"
    strings:
        //word_to_number()
        $ = {13300200FC000000??00001172??0000700A020B160C38DF00000007086F??00000A0D091F6859450A000000160000003200000078000000400000006A0000005C00000086000000240000004E00000005000000388F0000000672????007028??00000A0A388C0000000672??01007028??00000A0A2B7E0672????007028??00000A0A2B700672??03007028??00000A0A2B620672????007028??00000A0A2B540672????007028??00000A0A2B460672????007028??00000A0A2B380672????007028??00000A0A2B2A0672??00007028??00000A0A2B1C0672????007028??00000A0A2B0E06120328??00000A28??00000A0A0817580C08076F??00000A3F15FFFFFF062A}
        //number_to_word()
        $ = {1330020001010000??00001172??0000700A020B160C38DF00000007086F??00000A0D091F3059450A000000160000003200000078000000400000006A0000005C00000086000000240000004E00000005000000388F0000000672????007028??00000A0A388C0000000672????007028??00000A0A2B7E0672????007028??00000A0A2B700672????007028??00000A0A2B620672????007028??00000A0A2B540672????007028??00000A0A2B460672????007028??00000A0A2B380672????007028??00000A0A2B2A0672????007028??00000A0A2B1C0672????007028??00000A0A2B0E06120328??00000A28??00000A0A0817580C08076F??00000A3F15FFFFFF066F??00000A2A}
    condition:
        any of them
}

rule CrowdStrike_CSIT_19045_04 : fakedead 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects the stack loader variant of FakeDead."
        reports = "CSIT-19045"
        version = "202004031948"
        last_modified = "2020-04-03"
        malware_family = "FakeDead"
    strings:
        $a1 = { 92 5A 76 5D } /* RC4 hash key */
        $a2 = { 0F 31 ( 25 ?? ?? ?? ?? 05 ?? ?? ?? ?? | 05 ?? ?? ?? ?? ) } /* rdstc, and, add; rdstc, add */
        $b1 = { 68 ?? ?? ?? ?? 5? E8 ?? ?? ?? ?? 59 A3 ?? ?? ?? ?? }
        $b2 = { 68 ?? ?? ?? ?? 5? E8 ?? ?? ?? ?? 83 C4 08 A3 ?? ?? ?? ?? }
        $c1 = "CreateThread"
        $c2 = "Cookie:" wide
        $c3 = { D0 08 00 00 } /* Config size */
        $c4 = { 8B ?? C1 ?? 13 C1 ?? 0D 0B ?? } /* xor block */
        $d1 = { C1 CF 0D } /* ror-13 */
        $d2 = { ?? EA CD FA  } /* flag */
        $d3 = { 8C 04 00 00 } /* Config size */
        $d4 = "listen"
        $d5 = "VirtualAlloc"
        $d6 = { C6 [2-5] 50 C6 [2-5] 72 C6 [2-5] 69 C6 [2-5] 6E C6 [2-5] 74 C6 [2-5] 45 } /* PrintE */
    condition:
        uint16(0) == 0x5A4D and
        uint32(uint32(0x3C)) == 0x00004550 and
        all of ($a*) and
        ( all of ($c*) or all of ($d*) ) and
        (#b1 >= 4 or #b2 >= 4)
}

rule CrowdStrike_CSIT_19045_03
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects version 2 of the FakeDead loader."
        reports = "CSIT-19045"
        version = "202106081528"
        last_modified = "2021-06-08"
    strings:
        $a1 = { 92 5A 76 5D } /* Hash key */
        $a2 = { 00 D8 4F 00 } /* Max size */
        $a3 = { C1 CF 0D } /* ror edi, 13 */
        $f1 = "HeapAlloc"
        $f2 = "LoadResource"
        $f5 = "MSVCRT.dll"
        $b1 = { 68 ?? ?? ?? ?? 5? E8 ?? ?? ?? ?? 59 A3 ?? ?? ?? ?? }
        $b2 = { 68 ?? ?? ?? ?? 5? E8 ?? ?? ?? ?? 83 C4 08 A3 ?? ?? ?? ?? }
        $b3 = { 68 ?? ?? ?? ?? 8B ?? ?? 5? E8 ?? ?? ?? ?? 83 C4 08 A3 ?? ?? ?? ?? }
    condition:
        1 of ($f*) and all of ($a*) and
        (#b1 >= 4 or #b2 >= 4 or #b3 >= 4) and
        uint16(0) == 0x5A4D and
        uint32(uint32(0x3C)) == 0x00004550
}

rule CrowdStrike_CSIT_19191_01 : silence truebot unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects unpacked instances of Truebot downloader"
        reports = "CSIT-19191"
        version = "201910251251"
        last_modified = "2019-10-25"
        malware_family = "Truebot"
    strings:
        $key1 = "PikeJaXyzeUawuma"
        $key2 = "FKh23yu7T*&^@#"
        $str1 = ".php"
        $str2 = "/C ipconfig >> %s"
        $str3 = "/C hostname >> %s"
        $str4 = " >> NUL"
        $str5 = "%08x.exe"
        $str6 = "/C whoami  >> %s"
    condition:
        uint16(0) == 0x5a4d and
        uint32(uint32(0x3c)) == 0x00004550 and
        ((all of ($key*)) or (4 of ($str*)))
}

rule CrowdStrike_CSIT_19045_05
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects version 1 of the FakeDead loader."
        reports = "CSIT-19045"
        version = "202004031949"
        last_modified = "2020-04-03"
        malware_family = "FakeDead"
    strings:
        $a1 = { C1 CF 0D }
        $a2 = { C6 [2-5] 50 C6 [2-5] 72 C6 [2-5] 69 C6 [2-5] 6E C6 [2-5] 74 C6 [2-5] 45 }
        $b1 = { 68 ?? ?? ?? ?? 5? E8 ?? ?? ?? ?? 59 A3 ?? ?? ?? ?? }
        $b2 = { 68 ?? ?? ?? ?? 5? E8 ?? ?? ?? ?? 83 C4 08 A3 ?? ?? ?? ?? }
        $b3 = { 68 ?? ?? ?? ?? 8B ?? ?? 5? E8 ?? ?? ?? ?? 83 C4 08 A3 ?? ?? ?? ?? }
        $d1 = { 8D 56 E0 8D 44 1E E0 52 53 6A 20 50 E8 ?? ?? ?? ?? }
        $d2 = { 8D 46 E0 50 57 8D 44 3E E0 6A 20 50 E8 ?? ?? ?? ?? }
        $c = { 0F 31 ( 25 ?? ?? ?? ?? 05 ?? ?? ?? ?? | 05 ?? ?? ?? ?? ) }
    condition:
        uint16(0) == 0x5A4D and
        uint32(uint32(0x3C)) == 0x00004550 and
        ( #b1 >= 4 or #b2 >= 4 or #b3 >=4 ) and all of ($a*) and 1 of ($d*) and not ($c)
}

rule CrowdStrike_VenomousBear_ChinchAutorun_01 : autorun chinch hunting venomous_bear 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects encrypted injection code found in VENOMOUS BEAR's Chinch Autorun malware."
        version = "201908131554"
        last_modified = "2019-08-13"
        actor = "VENOMOUS BEAR"
        malware = "Autorun"
    strings:
        $ = { 56 79 de dc b5 dc }
    condition:
        all of them
}

rule CrowdStrike_CSA_19168_01 : bz2dropper dropper venomous_bear 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects VENOMOUS BEAR's BZ2 Dropper"
        reports = "CSA-19168"
        version = "202003090855"
        last_modified = "2020-03-09"
        actor = "VENOMOUS BEAR"
        malware_family = "BZ2Dropper"
    strings:
        $ = { 77 6F 5D 02 31 41 }
    condition:
        all of them
}

rule CrowdStrike_CSA_19168_03 : artifact chinch rat venomous_bear 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Matches on the characteristic RPC interface UUID used by VENOMOUS BEAR Chinch malware that communicates over pipes"
        reports = "CSA-19168,CSIT-19227"
        version = "201912192314"
        last_modified = "2019-12-19"
        actor = "VENOMOUS BEAR"
        malware_family = "Chinch"
    strings:
        $ = { 64 25 f0 7d 1e c3 68 4a a6 88 72 d0 ec 84 07 46 }
    condition:
        all of them
}

rule CrowdStrike_VENOMOUS_BEAR_Chinch_01 : chinch rat venomous_bear 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Matches on the characteristic format types of the RPC interface used by VENOMOUS BEAR Chinch malware that communicates over pipes"
        version = "201908271815"
        last_modified = "2019-08-27"
        actor = "VENOMOUS BEAR"
        malware = "Chinch"
    strings:
        $ = {
        00 00 11 08 25 5c 11 14  02 00 12 00 02 00 1b 00
        01 00 28 00 ?? 00 01 00  01 5b 11 0c 08 5c 11 14
        02 00 12 00 02 00 1b 00  01 00 28 54 ?? 00 01 00
        01 5b 11 14 02 00 12 00  02 00 1b 00 01 00 28 54
        ?? 00 01 00 02 5b 00 00  00 00 00 00
        }
    condition:
        all of them
}

rule CrowdStrike_CSA_19168_02 : chinch installer venomous_bear 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects DLL export table information found in the VENOMOUS BEAR's Chinch Install Helper"
        reports = "CSA-19168"
        version = "201908131605"
        last_modified = "2019-08-13"
        actor = "VENOMOUS BEAR"
        malware_family = "Chinch"
    strings:
        $ = "regce.dll"
        $ = "IEntryPoint"
        $ = "UEntryPoint"
        $ = "REntryPoint"
    condition:
        all of them
}

rule CrowdStrike_CSIT_19119_01 : ecrime matrix ransomware 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects Matrix ransomware based on characteristic strings"
        reports = "CSIT-19119"
        version = "201907091201"
        last_modified = "2019-07-09"
        malware_family = "Matrix Ransomware"
    strings:
        $ = "CHACHA20"
        $ = "%COMPUTERNAME%" wide
        $ = "%USERNAME%" wide
        $ = "CFG" wide
        $ = "WALL" wide
    condition:
        all of them
}

rule CrowdStrike_CSIT_19197_01 : ecrime gophe spambot 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Gophe spambot strings"
        reports = "CSIT-19197"
        version = "201910251252"
        last_modified = "2019-10-25"
        actor = "WIZARD SPIDER"
        malware_family = "Gophe Spambot"
    strings:
        $ = "send_to_all" wide
        $ = "additional_emails" wide
        $ = "global_macros" wide
        $ = "macros_dictionary" wide
        $ = "dict_name" wide
        $ = "send_targets" wide
        $ = "attach_type" wide
        $ = "attach_name" wide
        $ = "source_filename" wide
        $ = "attach_data_base64" wide
    condition:
        7 of them
}

rule CrowdStrike_CSIT_20088_01 : clop ecrime graceful_spider ransomware unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects strings associated with Clop ransomware"
        reports = "CSIT-19035,CSIT-20088"
        version = "202012101454"
        last_modified = "2020-12-10"
        actor = "GRACEFUL SPIDER"
        malware_family = "Clop Ransomware"
    strings:
        $name1_1 = "Clop^_-" ascii wide
        $name1_2 = "ClopReadMe.txt" wide
        $name2_1 = "Cl0p^_-" ascii wide
        $name2_2 = "Cl0pReadMe.txt" wide
        $name3_1 = "CIop^_-" ascii wide
        $name3_2 = "CIopReadMe.txt" wide
        $name4_1 = "CI0p^_-" ascii wide
        $name4_2 = "CI0pReadMe.txt" wide
        $rsa = "-----BEGIN PUBLIC KEY-----"
    condition:
        uint16(0) == 0x5a4d and filesize < 500KB and $rsa and (1 of ($name1_*) or 1 of ($name2_*) or 1 of ($name3_*) or 1 of ($name4_*))
}

rule CrowdStrike_CSIT_19196_03 : konni konniftp rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects the use of known Konni custom base64 alphabets"
        reports = "CSIT-19196"
        version = "202006161607"
        last_modified = "2020-06-16"
        malware_family = "Konni"
    strings:
        $ = "C2k3tZoeEH-TpFc=BUyuInhVX6w0mxasWbQGRqNP7AJi5r4lgD1MzOvK9YSj/dfL8"
        $ = "bVICrm9xaJ3tZX-Tj6OpFc7Asi4lvuhfw0oQ5GKeEHYgD1MLRn=BU/dqNP2kWyz8S"
        $ = "HnhD1C2Zo5r4le7LSqck38ROw0NPpF=G6xjBUyuIVXMz-TE/QmAvK9YdftJigasWb"
        $ = "NP7AJi5r4lgasWbQGRqck3tw0mZoeEHnhOvK9YSD1C2VX6xj/dfL8Mz-TpF=BUyuI"
        $ = "SbVIn=BU/dqNP2kWw0oCrm9xaJ3tZX6OpFc7Asi4lvuhf-TjMLRQ5GKeEHYgD1yz8"
        $ = "SAo0ETeZu4dXMDrJig%ROwIFNPzbG9Qas3876xj1WnK2HpftcBClk-hLvVqmyUY5="
        $ = "KXU/yP=B29tLzidqNRuf-SbVInw0oCrmWZk6OpFc7A5GTD1QxaJ3H8h4jMeEsYglv"
        $ = "qaR4sOz2bJ8fxZMFwUK%l7rLIQpucWk90ED=hdGy31nXt5CiYATVojeB6gNH-PvSm"
        $ = "TYXpzsuDoFSMmd70k%BGKHQb6Z5ygVcRiP8AO4aWhlf2t1-ExvqrwUj93CL=JNIne"
        $ = "m8liYuHAb2-U7=dDgyvF9Rf3QjkJMXoPSwZE!0cBr461zpOTn5KGxICqLWhesNatV"
    condition:
        any of them and
        filesize < 500KB
}

rule CrowdStrike_JavaScript_phishing_page : javascript phishing 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects JavaScript code that renders a phishing page"
        version = "201902151858"
        last_modified = "2019-02-15"
    strings:
        $path = "/Users/macuser/Desktop/Projects/mailing/client-side/ui"
        $ = "value:\"Sign\\xa0in\""
        $ = "className:\"login-box-ad-fallback\""
        $ = "className:\"login-box-container\""
        $ = "className:\"signin-cont\""
    condition:
        $path or 3 of them
}

rule CrowdStrike_CSIT_19045_06 : fakedead 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects the FakeDead RAT module."
        reports = "CSIT-19045"
        version = "202004022333"
        last_modified = "2020-04-02"
        malware_family = "FakeDead"
    strings:
        $a1 = "WorkDLL.dll"
        $a2 = "winhttp.dll"
        $b1 = "Admin" wide ascii
        $b2 = { 68 A8 08 00 00 50 68 ?? ?? ?? ?? 51 E8 ?? ?? ?? ?? }
        $b3 = "WinHttpTimeFromSystemTime"
        $b4 = { 0F 31 01 45 FC }
        $e1 = "Cancel" fullword
        $e2 = "DoWork" fullword
        $e3 = "PrintE" fullword
        $e5 = "PrintF" fullword
    condition:
        1 of ($a*) and
        1 of ($e*) and
        all of ($b*) and
        uint16(0) == 0x5A4D
}

rule CrowdStrike_CSIT_19035_01 : clop ecrime ransomware 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects Clop ransomware."
        reports = "CSIT-19035"
        version = "201903011638"
        last_modified = "2019-03-01"
        malware_family = "Clop"
    strings:
        $xor_key = "Clopfdwsjkjr23LKhuifdhwui73826ygGKUJFHGdwsieflkdsj324765tZPKQWLjwNVBFHewiuhryui32JKG"
        $clop_read_me = "ClopReadMe.txt"  wide ascii
        $clop_mutex = "CLOP#666"  wide ascii
        $clop_mutex2 = "MoneyP#666" wide ascii
        $clop_str_format = "%s%s.Clop"  wide ascii
        $clop_bat1 = "resort0-0-0-1-1-0.bat" wide ascii
        $clop_bat2 = "clearsystems-10-1.bat" wide ascii
    condition:
        $xor_key or 3 of ($clop_*)
}

rule CrowdStrike_CSIT_19049_02 : golddragon velvet_chollima 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects several components observed in GoldDragon implants."
        reports = "CSIT-19049"
        version = "201910111506"
        last_modified = "2019-10-11"
        actor = "VELVET CHOLLIMA"
        malware_family = "GoldDragon"
    strings:
        $post = "boundary=----WebKitFormBoundarywhpFxMBe19cSjFnG"
        $content = "Content-Disposition: form-data; name=\"userfile\"; filename="
        $ua = "Mozilla/4.0" fullword
        $end = "ending"
    condition:
        all of them
}

rule CrowdStrike_CSA_19229_03 : officecommu rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "OfficeCommu RAT observed in relation to Australian parliament breach"
        reports = "CSA-19229"
        version = "201903070942"
        last_modified = "2019-03-07"
        malware_family = "OfficeCommu"
    strings:
        $str_runx = "RunX" fullword
        $str_outprefix = "OutputTaskPrefix" fullword
        $str_clientid = "get_ClientID" fullword
        $str_officecommu = "OfficeCommu" fullword
        $str_psa = "PowershellAgent" fullword
        $str_getreg = "GetRegistryDWORD" fullword
        $str_end = "endWorkTime" fullword
    condition:
        4 of them
}

rule CrowdStrike_CSA_19229_01 : webshell 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects JSP webshell variants observed in relation to Australian parliament breach"
        reports = "CSA-19229"
        version = "201902221049"
        last_modified = "2019-02-22"
    strings:
        $lang = "<%@ Page Language=\"Jscript\""
        $pass = "[password]"
        $unsafe = "\"unsafe\""
        $unsafeb64 = "dW5zYWZl"
    condition:
        $lang in (0..50) and 2 of ($pass,$unsafe*)
}

rule CrowdStrike_CSA_19229_02
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects helper scripts observed in relation to Australian parliament breach"
        reports = "CSA-19229"
        version = "201903070942"
        last_modified = "2019-03-07"
    strings:
        $dec_func = "function DEC(d)"
        $dec = "return System.Text.Encoding.UTF8.GetString(Convert.FromBase64String(d));"
        $enc_func = "function ENC(d)"
        $enc = "return Convert.ToBase64String(System.Text.Encoding.UTF8.GetBytes(d));"
        $arg_1 = "Request.Item['argument1']"
        $arg_2 = "Request.Item['argument2']"
    condition:
        $dec in (0..200) and
        $enc in (0..200) and
        2 of ($dec_func, $enc_func, $arg_*)
}

rule CrowdStrike_CSA_19229_04 : post_exploitation reconnaissance 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Reconnaissance and utility tools observed in relation to Australian parliament breach"
        reports = "CSA-19229"
        version = "201903070942"
        last_modified = "2019-03-07"
    strings:
        // Seen in both ping and portscanner tools
        $str_writetask = "WriteTaskRes" fullword
        $str_copysb = "CopySbToGzipStream" fullword
        $str_common = "ReconCommonFuncs" fullword
        // Seen in async task runner samples
        $str_getfunc = "get_FuncAssCode" fullword
        $str_notfound = "Recon_ASS_NOT_FOUND" fullword
        $str_sess = "sessObj" fullword
    condition:
        filesize < 100KB and
        3 of them
}

rule CrowdStrike_CSA_19333_02 : eeclnt rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "eeclnt RAT noted in relation to likely Singapore-focussed activity"
        reports = "CSA-19333"
        version = "201912061643"
        last_modified = "2019-12-06"
        malware_family = "eeclnt RAT"
    strings:
        $str_mutex          = "Global\\eeclnt" fullword
        $str_enc_prefix     = "1A3B5C7" fullword
        $str_key1           = "N*S98%HS7yfw73&9" fullword
        $str_key2           = "&ydYF57Cv$%pB{]m" fullword
        $str_credhandle     = "AcquireCredentialsHandleA" fullword
        $code_rc4_1         = { 33 d2 8b c6 40 88 37 41 f7 f6 ff c6 48 ff c7 }
        $code_rc4_2         = { 41 0f b6 38 8b c7 41 03 01 49 83 c1 04 41 03 c5 99 41 23 d3 03 c2 41 23 c3 2b c2 4c 63 e8 }
    condition:
        filesize < 500KB and
        2 of them
}

rule CrowdStrike_CSIT_19087_01 : baby_shark downloader velvet_chollima 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects an HTA downloader in use by VELVET CHOLLIMA referred to as 'Baby Shark'."
        reports = "CSA-19265,CSIT-19087"
        version = "202004021445"
        last_modified = "2020-04-02"
        actor = "VELVET CHOLLIMA"
        malware = "BabyShark"
    strings:
        $function1 = "Function Co00("
        $encode = "&Mid(c,ix*d+jx+1,1)"
    condition:
        any of them
}

rule CrowdStrike_CSA_19250_01 : chollima keymarble rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects components associated with 2019 variant of KeyMarble malware"
        reports = "CSA-19250"
        version = "201902221117"
        last_modified = "2019-02-22"
        actor = "LABYRINTH CHOLLIMA"
        malware_family = "KeyMarble"
    strings:
        $des1 = { 0f 2c 7f 3c 9a 08 2a 32 }
        $des2 = { 02 1f 6e 1a 11 32 3a 83 }
        $wolf1 = "CLNTserver finished"
        $wolf2 = "AES-128-CBC"
        $mac = "%02x-%02x-%02x-%02x-%02x-%02x" wide
    condition:
        all of them
}

rule CrowdStrike_CSIT_19065_01 : ecrime servhelper unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule matches on strings found in unpacked samples of ServHelper"
        reports = "CSIT-19065"
        version = "201904121035"
        last_modified = "2019-04-12"
        malware_family = "ServHelper"
    strings:
        $ = "servhelper" wide
        $ = "nop" wide
        $ = "slp" wide
        $ = "shell" wide
        $ = "load" wide
        $ = "selfkill" wide
    condition:
        all of them
}

rule CrowdStrike_Multiple_Service_Credential_Harvest_Web_Page : credential_theft web_based 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule matches on web pages designed to trick users into entering their account credentials for various web-based services."
        version = "201903011630"
        last_modified = "2019-03-01"
    strings:
        $service1 = "0ffice365"
        $service2 = "yah00"
        $service3 = "h0tmail"
        $service4 = "A0l"
        $service5 = "0thers"
        $sign_in1 = "Sign in with Gmail"
        $sign_in2 = "<strong>Select your email provider"
    condition:
        all of ($service*) or all of ($sign_in*)
}

rule CrowdStrike_CSA_19265_02 : downloader velvet_chollima 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects the 'Baby Shark' downloader in use by VELVET CHOLLIMA."
        reports = "CSA-19265"
        version = "201908071844"
        last_modified = "2019-08-07"
        actor = "VELVET CHOLLIMA"
        malware_family = "Baby Shark"
    strings:
        $type1_a = "cmd /c mshta http"
        $hta = ".hta\x00"
        $type2_a = "cmd.exe" fullword
        $type2_b = "v AutoRun /t REG_SZ /d \"%s\" /f"
        $type2_c = "mshta.exe"
        $type3_a = "AutoOpen Macro"
    condition:
        ($type1_a or all of ($type2_*) or $type3_a) and $hta
}

rule CrowdStrike_CSIT_19042_01 : amadey downloader ecrime loader unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects Amadey Loader"
        reports = "CSIT-19042"
        version = "202105260910"
        last_modified = "2021-05-26"
        malware_family = "AmadeyLoader"
    strings:
        $decrypt_strings_a = { 56 53 83 ec 10 c7 44 24 08 00 04 00 00 c7 44 24 04 00 00 00 00 }
        $decrypt_strings_b = { 56 53 83 ec 20 c7 44 24 08 00 04 00 00 c7 44 24 04 00 00 00 00 }
        $decrypt_strings_c = { f7 f? 8a 84 3? [4] 2a 44 0? 01 88 8? [4] 4? 8b 45 f? 8d 5? 01 }
    condition:
        filesize < 600KB and any of them
}

rule CrowdStrike_PwnPOS_01 : pos_scraper pwnpos unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects unpacked PwnPOS samples."
        version = "201903011631"
        last_modified = "2019-03-01"
        malware_family = "PwnPoS"
    strings:
        $pdb = "c:\\r1\\Release\\r1.pdb"
        $log = "perfb419.dat"
        $msg_5 = "Windows Media Help" wide
        $msg_4 = "StartServiceCtrlDispatcher(): service already running."
        $msg_3 = " :: DebugConsole BEGIN Tee log"
        $msg_2 = "ERRLOG:"
        $msg_1 = "- unable to open console device" wide
        $api_1 = "OpenProcess"
        $api_2 = "ReadProcessMemory"
        $api_3 = "VirtualQueryEx"
        $api_4 = "GetProcessImageFileName"
        $api_5 = "EnumProcesses"
        // mov     cl, [eax]
        // inc     eax
        // test    cl, cl
        // jnz     strlen_loop
        // sub     eax, esi
        // lea     ecx, [eax-0Dh]
        // cmp     ecx, 6
        // ja      loc_40A465
        $luhn_len = {
        8A08 40 84C9 75F9 2BC6 8D48F3 83F906 0F87
        }
        // mov     eax, 66666667h
        // imul    ebx
        // sar     edx, 2
        // mov     eax, edx
        // shr     eax, 1Fh
        // add     eax, edx
        // lea     eax, [eax+eax*4]
        // lea     ecx, [eax+eax]
        // mov     eax, ebx
        // sub     eax, ecx
        // neg     eax
        $luhn_final = {
        B867666666 F7EB C1FA02 8BC2 C1E81F 03C2 8D0480 8D0C00 8BC3
        2BC1 F7D8
        }
        // movsx   edx, byte ptr [esi+edx]
        // push    edx             ; int
        // call    _isdigit
        // add     esp, 4
        // test    eax, eax
        // jz      short loc_40A45E
        // mov     eax, [ebp+CreditCardNumber]
        // movsx   ecx, byte ptr [esi+eax]
        // sub     ecx, 30h ; '0'
        // test    edi, edi
        // jz      short loc_40A448
        // add     ecx, ecx
        // cmp     ecx, 9
        // jle     short loc_40A448
        $luhn_checkdigit = {
        0FBE1416 52 E8???????? 83C404 85C0 74?? 8B45?? 0FBE0C06
        83E930 85FF 74?? 03C9 83F909 7E??
        }
        // mov     eax, 66666667h
        // imul    ecx
        // sar     edx, 2
        // mov     eax, edx
        // shr     eax, 1Fh
        // add     eax, edx
        // lea     edx, [eax+eax*4]
        // add     edx, edx
        // mov     eax, 1
        // sub     eax, edx
        // add     ecx, eax
        $luhn_compute_main = {
        B867666666 F7E9 C1FA02 8BC2 C1E81F 03C2 8D1480 03D2
        B801000000 2BC2 03C8
        }
    condition:
        2 of ($luhn*) and 4 of ($api_*)
        and ($pdb or $log or 3 of ($msg*))
}

rule CrowdStrike_CSA_19290_02 : cve_2018_20250 exploit 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects header used by a public builder for CVE-2018-20250, indicating presence of a malicious ACE file"
        reports = "CSA-19290"
        version = "201907161117"
        last_modified = "2019-07-16"
    strings:
        $ace_magic = "**ACE**"
        $header = { 6b 28 31 00 00 00 90 2a 2a 41 43 45 2a 2a 14 14 02 00 10 18 56 4e 97 4f f6 aa 00 00 00 00 16 2a 55 4e 52 45 47 49 53 54 45 52 45 44 20 56 45 52 53 49 4f 4e 2a }
    condition:
        $ace_magic in (7..14) and
        $header
}

rule CrowdStrike_CSIT_19067_03 : autodown downloader fancy_bear 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Identifies characteristic variable names in AutoDown"
        reports = "CSIT-19067"
        version = "201905030901"
        last_modified = "2019-05-03"
        actor = "FANCY BEAR"
        malware_family = "AutoDown"
    strings:
        $ = "Global $vexit = False"
    condition:
        for all i in (0..16): ( // plaintext indicator
        (uint8(i) >= 32 and uint8(i) < 127)
        or uint8(i) == 10 or uint8(i) == 13 // newline
        or uint8(i) == 9 // tab
        or uint8(i) == 23 // #
        ) and
        all of them
}

rule CrowdStrike_CSIT_19067_04 : autodown downloader fancy_bear 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Identifies characteristic variable names in AutoDown"
        reports = "CSIT-19067"
        version = "201905030901"
        last_modified = "2019-05-03"
        actor = "FANCY BEAR"
        malware_family = "AutoDown"
    strings:
        $ = "crocodile("
        $ = "If $call Then"
        $ = "Microsoft.XMLDOM"
    condition:
        for all i in (0..16): ( // plaintext indicator
        (uint8(i) >= 32 and uint8(i) < 127)
        or uint8(i) == 10 or uint8(i) == 13 // newline
        or uint8(i) == 9 // tab
        or uint8(i) == 23 // #
        ) and
        all of them
}

rule CrowdStrike_CSIT_19067_05 : autodown downloader fancy_bear 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Identifies characteristic function names in AutoDown"
        reports = "CSIT-19067"
        version = "201905030902"
        last_modified = "2019-05-03"
        actor = "FANCY BEAR"
        malware_family = "AutoDown"
    strings:
        $ = "getsi()"
        $ = "_people"
    condition:
        for all i in (0..16): ( // plaintext indicator
        (uint8(i) >= 32 and uint8(i) < 127)
        or uint8(i) == 10 or uint8(i) == 13 // newline
        or uint8(i) == 9 // tab
        or uint8(i) == 23 // #
        ) and
        all of them
}

rule CrowdStrike_CSIT_19049_04 : goldstamp keylogger velvet_chollima 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects the VELVET CHOLLIMA keylogger GoldStamp."
        reports = "CSIT-19049"
        version = "201912271958"
        last_modified = "2019-12-27"
        actor = "VELVET CHOLLIMA"
        malware_family = "GoldStamp"
    strings:
        $str_enc_1  = "GrmhGpqomouV" fullword
        $str_enc_2  = "LxkIorfMhhoxjj" fullword
        $str_enc_3  = "txozxg32?hgg" fullword
        $key1 = " : xxxxxxxxx"
        $key2 = "yyyyyyyyy"
    condition:
        all of them
}

// WARNING: This rule will only work with YARA 3
import "pe"

rule CrowdStrike_CSIT_19059_03 : backdoor helix_kitten iis rgdoor 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects HELIX KITTEN's RGDoor IIS backdoor through characteristic cookie names and exports."
        reports = "CSIT-19059"
        version = "201904051310"
        last_modified = "2019-04-05"
        actor = "HELIX KITTEN"
        malware_family = "RgDoor"
    strings:
        $dbg_str_1 = "but did not override the method in its"
        $dbg_str_2 = "Please check the method signature to make sure it matches the corresponding method."
        $cookie_1 = "294A1FC8FA5255E704F3A53F04056C91" fullword
        $cookie_2 = "opera" fullword
        $cookie_3 = "RGSESSIONID"
        $arg_1 = "action" fullword
        $header_1 = "attachment" fullword
        $cmd_1 = "cmd.exe" fullword
        $cmd_2 = "/c" fullword
    condition:
        uint16(0) == 0x5A4D and
        uint16(uint32(0x3C)) == 0x4550 and
        pe.characteristics & pe.DLL and
        pe.exports("RegisterModule") and
        all of ($dbg_str_*) and
        (all of ($cmd_*)) and
        (
        (1 of ($cookie_*)) or
        (1 of ($arg_*)) or
        (1 of ($header_*))
        ) and
        filesize > 100KB and
        filesize < 2MB
}

rule CrowdStrike_CSIT_19059_02 : helix_kitten twoface webshell 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects HELIX KITTEN's TwoFace webshell through characteristic code sequences and c2 commands"
        reports = "CSIT-19059"
        version = "201906131640"
        last_modified = "2019-06-13"
        actor = "HELIX KITTEN"
        malware_family = "TwoFace Webshell"
    strings:
        $cmd1 = "case\"pro\""
        $cmd2 = "case\"cmd\""
        $cmd3 = "case\"sav\""
        $cmd4 = "case\"vir\""
        $cmd5 = "case\"nen\""
        $cmd6 = "case\"don\""
        $cmd7 = "case\"tfil\""
        $cmd8 = "case\"ttar\""
        $cmd9 = "case\"ttim\""
        $str1 = "string pp = \""
        $str2 = "pro#=#{0}#|#cmd#=#{1}#|#sav#=#{2}#|#vir#=#{3}#|#nen#=#{4}#|#don#=#{5}#|#tfil#=#{6}#|#ttar#=#{7}#|#ttim#=#{8}"
        $code = "Convert.ToBase64String(new System.Security.Cryptography.SHA1CryptoServiceProvider().ComputeHash(Encoding.ASCII.GetBytes("
        $lbl1 = "Q2hhbmdlIENyZWF0aW9uIFRpbWU="
        $lbl2 = "RG93bmxvYWQ="
        $lbl3 = "TmV3IEZpbGUgbmFtZQ=="
    condition:
        $code and (4 of ($cmd*) or 1 of ($str*) or 1 of ($lbl*))
}

rule CrowdStrike_CSIT_19059_01 : helix_kitten loader twoface webshell 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects deobfuscation operations found in HELIX KITTEN's TwoFace webshell loader."
        reports = "CSIT-19059"
        version = "201904051309"
        last_modified = "2019-04-05"
        actor = "HELIX KITTEN"
        malware_family = "TwoFace Webshell"
    strings:
        $form = "Convert.FromBase64String(Request.Form"
        $path = "Request.ServerVariables[\"PATH_TRANSLATED\"]"
        $write = "System.IO.File.WriteAllBytes"
        $deob_1 = "]+="
        $deob_2 = "]-="
        $loop = "else if(Request.Form.Count=="
    condition:
        all of them
}

rule CrowdStrike_CSIT_19049_01 : joybertm shellcode velvet_chollima 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects a marker used by second-stage shellcode deployed via HWP files to identify decrypted content."
        reports = "CSIT-19049"
        version = "201904051308"
        last_modified = "2019-04-05"
        actor = "VELVET CHOLLIMA"
    strings:
        $doc = {D0 CF 11 E0}
        $marker = "JOYBERTM7b"
    condition:
        $doc at 0 and all of them
}

rule CrowdStrike_CSA_19290_01 : cve_2018_20250 exploit 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects common facets of headers found in samples exploiting CVE-2018-20250, indicating presence of a malicious ACE file"
        reports = "CSA-19290"
        version = "201908120840"
        last_modified = "2019-08-12"
    strings:
        $ace_magic = "**ACE**"
        $header = { 31 00 00 00 90 2a 2a 41 43 45 2a 2a 14 14 02 00 ?? ?? ?? ?? ?? ?? ?? ?? ?? ??  00 00 16 2a 55 4e 52 45 47 49 53 54 45 52 45 44 20 56 45 52 53 49 4f 4e 2a }
        $path_regex = /[a-z]:\\\\?[a-z]:(\\|C:)/ nocase
    condition:
        $ace_magic in (7..14) and
        $header and
        $path_regex
}

rule CrowdStrike_CSIT_19087_03 : goldgrabber infostealer velvet_chollima 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects GoldGrabber info stealer used by VELVET CHOLLIMA sharing API decoding function with GoldStamp"
        reports = "CSIT-19087"
        version = "201906111639"
        last_modified = "2019-06-11"
        actor = "VELVET CHOLLIMA"
        malware = "GoldGrabber"
    strings:
        $str_enc_1  = "GrmhGpqomouV" fullword
        $str_enc_2  = "LxkIorfMhhoxjj" fullword
        $str_enc_3  = "txozxg32?hgg" fullword
        $sql = "SELECT id, hostname, httpRealm, formSubmitURL, usernameField"
        $func = "PK11SDR_Decrypt"
        $file = "signons.sqlite"
    condition:
        all of them
}

rule CrowdStrike_CSIT_19098_02 : agentdrable dnstunnel helix_kitten rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects AgentDrable through characteristic API names and C2 protocol strings"
        reports = "CSIT-19098"
        version = "201906131447"
        last_modified = "2019-06-13"
        actor = "HELIX KITTEN"
        malware_family = "AgentDrable"
    strings:
        $dnsapi = "Dnsapi.dll"
        $dnsquery = "DnsQuery_A"
        $base64 = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="
        $user_agent = "Mozilla/5.0 AppleWebKit/537.36 (KHTML, like Gecko) Chrome/71.0.35"
        $typo_1 = " Ocuured!"
        $wmic = "d21pYyBwcm9jZXNzIGxpc3Q="
        $html_1 = "<!--"
        $html_2 = "-->"
        $html_3 = "<link href=\""
        $html_4 = "<style>/*"
        $html_5 = "*/</style>"
        $html_6 = "<script>/*"
        $html_7 = "*/</script>"
        $html_8 = "name=\"txtssss"
        $http_1 = "/Loginnn?id="
        $http_2 = "/Uploaddd"
        $path_1 = ".\\Conf"
        $path_2 = "igure.txt"
    condition:
        10 of them
}

rule CrowdStrike_CSIT_19049_03 : braveprince velvet_chollima 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects strings found in VELVET CHOLLIMA implant BravePrince."
        reports = "CSIT-19049"
        version = "201904051308"
        last_modified = "2019-04-05"
        actor = "VELVET CHOLLIMA"
        malware_family = "BravePrince"
    strings:
        $daum = "https://logins.daum.net/accounts/srp.do?slevel=0&rid=%s&srplm1=%s"
        $key = "www.braveprince.com"
    condition:
        any of them
}

rule CrowdStrike_CSIT_19066_01 : rat rollover 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects main component of ROLLOVER malware"
        reports = "CSIT-19066"
        version = "202004030155"
        last_modified = "2020-04-03"
        malware_family = "ROLLOVER"
    strings:
        $a1 = { 40 50 e8 ?? ?? ?? ?? 5e c2 08 00 }
        $a2 = "%[^:]:%d,%d,%d"
    condition:
        uint16(0) == 0x5A4D and
        all of ($a*) and
        for all i in (1..3) : (@a1[i] + 11 == @a1[i+1])
}

rule CrowdStrike_CSIT_19063_03 : elise lotus_panda rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects distinctive DLL and export names used by the Elise malware"
        reports = "CSIT-19063"
        version = "202012011451"
        last_modified = "2020-12-01"
        actor = "LOTUS PANDA"
        malware_family = "Elise"
    strings:
        $depatch_dll = "DePatch.dll"
        $kind_dll = "Kind.dll"
        $evil_dll = "Evil.dll"
        $depatch_export = "DePatchEntry"
        $kind_export = "KindEntry"
        $evil_export = "EvilEntry"
    condition:
        all of ($depatch*) or
        all of ($kind*) or
        all of ($evil*)
}

rule CrowdStrike_CSIT_19063_04 : elise loader lotus_panda 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects distinctive strings in Elise loader binaries"
        reports = "CSIT-19063"
        version = "202012011451"
        last_modified = "2020-12-01"
        actor = "LOTUS PANDA"
        malware_family = "Elise"
    strings:
        $rc4_key = "Ss)4:WKsRr(3/VJrQq&2.UIqPp%1-THp"
        // 000569..000C29..001C14..005056..00155D..00163E..080027
        $MAC_ouis = { 30 30 30 35 36 39 00 00 30 30 30 43 32 39 00 00 30 30 31 43 31 34 00 00 30 30 35 30 35 36 00 00 30 30 31 35 35 44 00 00 30 30 31 36 33 45 00 00 30 38 30 30 32 37 00 }
        $install_path = "\\Windows\\Caches\\NavShExt.dll"
        $debug = "0x3A RegOpenKeyExW Disk Failed-%d"
    condition:
        any of them
}

rule CrowdStrike_CSIT_19063_01 : elise loader lotus_panda 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects an Elise loader containing an LZMA compressed payload"
        reports = "CSIT-19063"
        version = "202012011451"
        last_modified = "2020-12-01"
        actor = "LOTUS PANDA"
        malware_family = "Elise"
    strings:
        $mutex = "donotbotherme"
        $lzma_pe = { 00 26 96 8E 70 00 17 F7 EC 05 BB EA }
        $chunked_copy = { 81 45 E4 00 04 00 00 83 C4 0C 81 7D E4 }
    condition:
        2 of them
}

rule CrowdStrike_CSA_19328_01 : scanbox swc 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule is intended to match on content found in websites that have been compromised and contain references to the Scanbox web reconnaissance framework."
        reports = "CSA-19328"
        version = "202003232029"
        last_modified = "2020-03-23"
        malware_family = "Scanbox"
    strings:
        //"/i/?1></script>
        $i1script = { 2f 69 2f 3f [1-2] 3e 3c 2f 73 63 72 69 70 74 3e }
        $i2_1 = "/i/?2'"
        $i2_downselect = "document.createElement"
    condition:
        $i1script or (all of ($i2*))
}

rule CrowdStrike_CSIT_19046_01 : banking bokbot proxy unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Matches BokBot Proxy module in-memory"
        reports = "CSIT-19046"
        version = "201903151246"
        last_modified = "2019-03-15"
        actor = "LUNAR SPIDER"
        malware_family = "BokBot"
    strings:
        $ = { c1 c9 0d 0f be c0 03 c8 46 } // basic string hash code
        $ = "front://"
        $ = "Microsoft Unified Security Protocol Provider"
        $ = "#gid#"
        $ = "zeus"
        $ = "INJECT" wide
    condition:
        all of them
}

rule CrowdStrike_LimeRat_01 : ecrime limerat rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects instances of LimeRat using the default Assembly GUID"
        version = "201904181335"
        last_modified = "2019-04-18"
        malware_family = "LimeRat"
    strings:
        $guid = "e58ac447-ab07-402a-9c96-95e284a76a8d"
    condition:
        uint16(0) == 0x5a4d
        and $guid
}

rule CrowdStrike_CSIT_19141_01 : fancy_bear lojax 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Dropper Component of LoJax malware"
        reports = "CSIT-19141"
        version = "201908091731"
        last_modified = "2019-08-09"
        actor = "FANCY BEAR"
        malware_family = "LoJax"
    strings:
        $ = "C:\\Windows\\SysWOW64\\rpcnetp.exe" wide
        $ = "C:\\Windows\\System32\\rpcnetp.exe" wide
        $ = "\\REGISTRY\\MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Session Manager" wide
        $ = "\\REGISTRY\\MACHINE\\SYSTEM\\CurrentControlSet\\Services\\Rpcnet" wide
        $ = "Remote Procedure Call (RPC) Net" wide
        /*
        C7 44 24 44 61 00 75 00  .D$Da.u.  mov dword ptr [esp + 0x44], 0x750061
        C7 44 24 48 74 00 6F 00  .D$Ht.o.  mov dword ptr [esp + 0x48], 0x6f0074
        C7 44 24 4C 63 00 68 00  .D$Lc.h.  mov dword ptr [esp + 0x4c], 0x680063
        C7 44 24 50 65 00 63 00  .D$Pe.c.  mov dword ptr [esp + 0x50], 0x630065
        C7 44 24 54 6B 00 20 00  .D$Tk. .  mov dword ptr [esp + 0x54], 0x20006b
        C7 44 24 58 61 00 75 00  .D$Xa.u.  mov dword ptr [esp + 0x58], 0x750061
        C7 44 24 5C 74 00 6F 00  .D$\t.o.  mov dword ptr [esp + 0x5c], 0x6f0074
        C7 44 24 60 63 00 68 00  .D$`c.h.  mov dword ptr [esp + 0x60], 0x680063
        C7 44 24 64 6B 00 20 00  .D$dk. .  mov dword ptr [esp + 0x64], 0x20006b
        C7 44 24 68 2A 00 00 00  .D$h*...  mov dword ptr [esp + 0x68], 0x2a
        66 89 44 24 6C           f.D$l     mov word ptr [esp + 0x6c], ax
        */
        $ = {
        C7 44 24 44 61 00 75 00
        C7 44 24 48 74 00 6F 00
        C7 44 24 4C 63 00 68 00
        C7 44 24 50 65 00 63 00
        C7 44 24 54 6B 00 20 00
        C7 44 24 58 61 00 75 00
        C7 44 24 5C 74 00 6F 00
        C7 44 24 60 63 00 68 00
        C7 44 24 64 6B 00 20 00
        C7 44 24 68 2A 00 00 00
        66 89 44 24 6C
        }
    condition:
        all of them
}

rule CrowdStrike_CSA_19333_01 : downloader loader shellcode 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Common shellcode sequence found in ShimRAT and qt4loader payloads"
        reports = "CSA-19333"
        version = "201912061643"
        last_modified = "2019-12-06"
        malware_family = "ShimRAT, QT4Loader"
    strings:
        $scstart = { 8b 45 ?? 8b 48 0c 8b 51 1c 89 55 ?? 8b 45 ?? 81 78 1c 18 00 1a 00 74 }
    condition:
        $scstart
}

rule CrowdStrike_CSIT_19066_02 : loader rollover 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects ROLLOVER shellcode loader"
        reports = "CSIT-19066"
        version = "202004030155"
        last_modified = "2020-04-03"
        malware_family = "ROLLOVER"
    strings:
        $a1 = { 6b 65 72 6e [1-16] 65 6c 33 32 } // Kernel32
        $a2 = { 56 69 72 74 [1-16] 75 61 6c 41 [1-16] 6c 6c 6f 63 } // VirtualAlloc
        $a3 = { 56 69 72 74 [1-16] 75 61 6C 46 [1-16] 72 65 65 00 } // VirtualFree
        $b1 = "GetProcAddress"
        $b2 = "LoadLibrary"
        $c1 = { 18 35 a9 6f d8 50 a7 c5 ca 9c 3f e7 c0 99 91 92 a8 9f c6 bb }
        $c2 = { c6 e0 12 77 25 e0 12 77 b9 14 d6 74 26 18 d6 74 3e 18 d6 74 ff 10 d6 74 }
        $d1 = { 8a 0? 8a 4? 01 4? 4? fe c8 f6 d0 c0 e1 04 24 0f fe c9 32 c1 }
        $d2 = { c1 45 fc 05 }
        $d3 = "%02d%02d%02d_%02d%02d"
    condition:
        uint16(0) == 0x5A4D and
        ( ( 1 of ($a*) and all of ($b*) ) or  1 of ($c*) ) and
        2 of ($d*) and
        filesize < 1MB
}

rule CrowdStrike_CSA_19356_01 : bootkit_troy chollima downloader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects a downloader associated with the deployment of CVE-2018-20250 and legacy DPRK intrusion tools."
        reports = "CSA-19356"
        version = "202001282133"
        last_modified = "2020-01-28"
        malware_family = "Bootkit Troy Downloader"
    strings:
        $ = "IDR_RESOURCE" ascii wide
        $ = "Microsoft Enhanced Cryptographic Provider v1.0" ascii wide
        $ = {01 68 00 00}
        $ = {04 80 00 00}
    condition:
        all of them
}

rule CrowdStrike_CSA_19356_02 : chollima duuzer rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects a variant of Duuzer which was observed being deployed using the Bootkit Troy downloader."
        reports = "CSA-19356"
        version = "201904221324"
        last_modified = "2019-04-22"
        malware_family = "Duuzer"
    strings:
        $ = "%sd.e%sc \"%s > %s\" 2>&1" wide
        $ = "WTSGetActiveConsoleSessionId"
        $ = "zip 1.01 Copyright 1998-2004 Gilles Vollant"
    condition:
        all of them
}

// WARNING: This rule will only work with YARA 3
import "pe"

rule CrowdStrike_CSIT_19059_04 : backdoor helix_kitten iis isapi_filter 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects a malicious ISAPI filter used by HELIX KITTEN."
        reports = "CSIT-19059"
        version = "201904051313"
        last_modified = "2019-04-05"
        actor = "HELIX KITTEN"
        malware_family = "RgDoor"
    strings:
        $arg = "cmd2cmd="
        $popen_1 = "cmd.exe"
        $popen_2 = "command.com"
        $popen_23 = "popen() failed"
        $html_1 = "<pre>"
        $html_2 = "</pre>"
        $html_3 = "Content-Type: text/html; charset=windows-1252"
        $err_1 = "Error retrieving header"
        $flags = {43 57 08 00}
    condition:
        filesize > 100KB and
        filesize < 1MB and
        uint16(0) == 0x5A4D and
        uint16(uint32(0x3C)) == 0x4550 and
        pe.characteristics & pe.DLL and
        pe.exports("GetFilterVersion") and
        pe.exports("HttpFilterProc") and
        $flags and
        2 of ($popen_*) and
        (
        $arg or
        2 of ($html_*) or
        $err_1
        )
}

rule CrowdStrike_CSA_19358_01 : backdoor loader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects obfuscated RC4 keys and an API hash used in a loader described in CSA-19358."
        reports = "CSA-19358"
        version = "202010081710"
        last_modified = "2020-10-08"
    strings:
        $api_resolve1 = { 5E 8B F0 BA 3C 8C F8 6A 8B CE E8 }
        $a_key1 = {06 07 0E 02 02 06 02 03}
        $a_key2 = {06 0E 04 06 00 06 05 07}
        $a_key3 = {06 01 02 06 05 05 0E 04}
        $a_key4 = {06 00 05 0E 06 04 06 07}
        $a_key5 = {06 00 0F 02 0F 02 03 05}
        $a_key6 = {05 07 00 00 0E 05 0F 0E}
        $hash = {3c 8c f8 6a}
    condition:
        1 of ($a*) and $hash
}

rule CrowdStrike_CSA_19358_02 : loader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects a stack string used in RC5 key generation in malware described in CSA-19358."
        reports = "CSA-19358"
        version = "202010081712"
        last_modified = "2020-10-08"
    strings:
        $obf_stack_key = { c7 44 24 28 66 40 55 6b c7 44 24 2c 64 21 72 43 c7 44 24 30 74 6f 20 52 66 c7 44 24 34 24 2e c6 44 24 36 00 }
        /* Code from starting VA 10002124:
        mov     dword ptr [ebp+String], 6B554066h
        mov     [ebp+var_10], 43722164h
        mov     [ebp+var_C], 52206F74h
        mov     [ebp+var_8], 2E24h
        mov     [ebp+var_6], 0
        */
        $code_va_10002124 = {
        C7 4? [1-2] 66 40 55 6B
        C7 4? [1-2] 64 21 72 43
        C7 4? [1-2] 74 6F 20 52
        [0-1] C7 4? [1-2] 24 2E
        }
    condition:
        any of them
}

rule CrowdStrike_CSIT_19058_01 : eps exploit nimbus postscript ricochet_chollima 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects the malicious EPS file found in HWP documents deploying RICOCHET CHOLLIMA's Nimbus malware."
        reports = "CSIT-19058"
        version = "201904051307"
        last_modified = "2019-04-05"
        actor = "RICOCHET CHOLLIMA"
    strings:
        $ = "%!PS-Adobe-3.0 EPSF-3.0"
        $ = "90000300000004000000FFFF0000"
        $ = "exch def envstr"
        $ = "def file2(MZ)writestring"
    condition:
        all of them
}

rule CrowdStrike_CSIT_19141_02 : fancy_bear lojax 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Known LoJax C2s in obfuscated format"
        reports = "CSIT-19141"
        version = "201908091730"
        last_modified = "2019-08-09"
        actor = "FANCYBEAR"
        malware_family = "LoJax"
    strings:
        $remotepxNet = { C7 D0 D8 DA C1 D0 C5 CD 9B DB D0 C1 }
        $vsnetCo = { C3 C6 DB D0 C1 9B D6 DA }
        $rpcnetconnectCom = { C7 C5 D6 DB D0 C1 D6 DA DB DB D0 D6 C1 9B D6 DA D8 }
        $ikmtrustCom = { DC DE D8 C1 C7 C0 C6 C1 9B D6 DA D8 }
        $webstpCom = { C2 D0 D7 C6 C1 C5 9B D6 DA D8 }
        $jflynciCom = { DF D3 D9 CC DB D6 DC 9B D6 DA D8 }
        $rdsnetsCom = { C7 D1 C6 DB D0 C1 C6 9B D6 DA D8 }
        $sysanalyticwebCom = { C6 CC C6 D4 DB D4 D9 CC C1 DC D6 C2 D0 D7 9B D6 DA D8 }
        $msfontserverCom = { D8 C6 D3 DA DB C1 C6 D0 C7 C3 D0 C7 9B D6 DA D8 }
        $ntpstatisticsCom = { DB C1 C5 C6 C1 D4 C1 DC C6 C1 DC D6 C6 9B D6 DA D8 }
        $visualratesCom = { C3 DC C6 C0 D4 D9 C7 D4 C1 D0 C6 9B D6 DA D8 }
        $regvirtCom = { C7 D0 D2 C3 DC C7 C1 9B D6 DA D8 }
        $unigymboomCom = { C0 DB DC D2 CC D8 D7 DA DA D8 9B D6 DA D8 }
        $oiatribeCom = { DA DC D4 C1 C7 DC D7 D0 9B D6 DA D8 }
        $treckanalyticsCom = { C1 C7 D0 D6 DE D4 DB D4 D9 CC C1 DC D6 C6 9B D6 DA D8 }
        $oiagivesCom = { DA DC D4 D2 DC C3 D0 C6 9B D6 DA D8 }
        $moldstreamMd = { D8 DA D9 D1 C6 C1 C7 D0 D4 D8 9B D8 D1 }
        $elaxoOrg = { D0 D9 D4 CD DA 9B DA C7 D2 }
        $lxwoOrg = { D9 CD C2 DA 9B DA C7 D2 }
    condition:
        any of them
}

rule CrowdStrike_CSIT_19058_03 : nimbus rat ricochet_chollima wiper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects an updated variant of Nimbus V2 that contains wiping functionality."
        reports = "CSIT-19058"
        version = "201906111640"
        last_modified = "2019-06-11"
        actor = "RICOCHET CHOLLIMA"
        malware_family = "Nimbus"
    strings:
        $str1 = {6C 08 C8 08}
        $str2 = {C8 08 9A 08}
        $str3 = {C8 08 BC 08}
        $str4 = {D4 08 E5 08}
        $str5 = {DF 08 D5 08}
        $str6 = {CF 08 CD 08}
        $str7 = {D8 08 B0 08}
        $str8 = {DE 08 D5 08}
        $str9 = {E2 08 D1 08}
        $mbr = "FAAAA...Sad..."
    condition:
        all of them
}

rule CrowdStrike_CSIT_19090_01 : ecrime lockergoga ransomware 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects LockerGoga ransomware"
        version = "201905261715"
        last_modified = "2019-05-26"
        malware_family = "LockerGoga"
    strings:
        // 0x447270 ?? 4e    jne    0x4472c0
        // 0x447272 8b 7d a0    mov    edi, dword ptr [ebp - 0x60]
        // 0x447275 83 78 24 10    cmp    dword ptr [eax + 0x24], 0x10
        // 0x447279 8d 50 10    lea    edx, dword ptr [eax + 0x10]
        // 0x44727c 72 03    jb    0x447281
        // 0x44727e 8b 50 10    mov    edx, dword ptr [eax + 0x10]
        // 0x447281 83 7f 14 10    cmp    dword ptr [edi + 0x14], 0x10
        $a = { 4e 8b 7d a0 83 78 24 10 8d 50 10 72 03 8b 50 10 83 7f 14 10 }
        // 0x447306 ?? f1    mov    esi, ecx
        // 0x447308 8b c8    mov    ecx, eax
        // 0x44730a 80 78 0d 00    cmp    byte ptr [eax + 0xd], 0
        // 0x44730e 74 f4    je    0x447304
        // 0x447310 8b 4d 94    mov    ecx, dword ptr [ebp - 0x6c]
        // 0x447313 3b f2    cmp    esi, edx
        // 0x447315 75 b9    jne    0x4472d0
        // 0x447317 85 c9    test    ecx, ecx
        // 0x447319 0f 84 ?? ?? ?? ??    je    0x4473a9
        $b = { f1 8b c8 80 78 0d 00 74 f4 8b 4d 94 3b f2 75 b9 85 c9 0f 84 }
        // 0x450545 ?? 9b    jb    0x4504e2
        // 0x450547 8b d1    mov    edx, ecx
        // 0x450549 2b 55 b0    sub    edx, dword ptr [ebp - 0x50]
        // 0x45054c b8 93 24 49 92    mov    eax, 0x92492493
        // 0x450551 89 55 84    mov    dword ptr [ebp - 0x7c], edx
        // 0x450554 33 ff    xor    edi, edi
        // 0x450556 f7 ea    imul    edx
        // 0x450558 03 55 ??    add    edx, dword ptr [ebp - 0x7c]
        $c = { 9b 8b d1 2b 55 b0 b8 93 24 49 92 89 55 84 33 ff f7 ea 03 55 }
        // RSA PUB key ID base64 encoded
        $e = "MIGdMA0"
        // Match strings from old samples
        $old1 = "version,v"
        $old2 = "key,k"
        $old3 = "jobs,j"
        $old4 = ".locked"
        $old5 = "X:\\work\\Projects\\LockerGoga"
        $old6 = "Crypto++ RNG"
    condition:
        ($a and $b and $c and $e) or ($old1 and $old2 and$old3 and $old4 and $old5 and $old6)
}

rule CrowdStrike_CSIT_19098_01 : agentdrable dnstunnel helix_kitten rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects AgentDrable macro installers through specifically obfuscated strings"
        reports = "CSIT-19098"
        version = "201908071449"
        last_modified = "2019-08-07"
        actor = "HELIX KITTEN"
        malware_family = "AgentDrable"
    strings:
        $ = ".\" & \"e\" & \"x\" & \"e\""
        $ = ".Interval = \"PT1M\""
        $ = "Set DM = CreateObject(\"Microsoft.XML\" & \"DOM\")"
        $ = "If Application.MouseAvailable Then"
        $ = "strTime = strTime & Right(\"0\" & Month(DateTimeValue), 2) & \"-\""
        $ = "createElement(\"t\" & \"mp\")"
        $ = "Environ(\"userp\" & \"rofile\")"
        $ = "Environ(\"us\" & \"erp\" & \"rof\" & \"ile\") "
        $ = "CreateObject(e0 & e1 & \"d\" & e2 & \"vice\")"
    condition:
        5 of them
}

rule CrowdStrike_CSIT_19078_01 : banking camellia ecrime infostealer ramnit 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Camellia plugin of the Ramnit banking malware"
        reports = "CSIT-19022,CSIT-19078"
        version = "201906271042"
        last_modified = "2019-06-27"
        malware_family = "Ramnit"
    strings:
        $code_hook_1 = { e0 38 c1 f8 03 88 45 fb 8b 4d f0 0f b6 11 83 e2 07 88 55 f9 }
        $code_hook_2 = { 45 fe 83 c8 08 88 45 fe 0f b6 4d fa 83 f9 03 74 }
        $code_post_1 = { B9 00 10 C0 04 6A 01 B8 00 00 40 04 C7 44 24 ?? ?? ?? ?? ?? 0F 45 C1 89 7C 24 ?? 50 8D 44 24 ?? 50 FF 75 ?? 57 FF 75 }
        $code_post_2 = { 80 7E ?? 00 B9 00 31 80 84 57 B8 00 01 00 84 C7 45 F8 ?? ?? ?? ?? 0F 45 C1 89 ?? ?? 50 8D ?? ?? 50 FF 75 ?? 57 FF 75 }
        $s_sqlite_1 = "INSERT INTO domain_variables" ascii
        $s_sqlite_2 = "INSERT INTO domain_variables" ascii
        $s_sqlite_3 = "CREATE TABLE IF NOT EXISTS scripts_table" ascii
        $s_lua_1 = "etRemoteInject" ascii
        $s_lua_2 = "PostAndGet" ascii
        $s_lua_3 = "addDomainVariable" ascii
        $s_lua_4 = "UrlEncodeF" ascii
        $s_other_1 = "Mon, 26 Jul 1997 05:00:00 GMT" ascii
        $s_other_2 = "RapportGP.dll" fullword wide
        $s_other_3 = "swhook.dll" wide
        $s_other_4 = "SQLite format 3" ascii
    condition:
        1 of ($code_*) and 2 of ($s_sqlite*) and 2 of ($s_lua_*) and all of ($s_other_*)
}

rule CrowdStrike_CSIT_19073_02 : pirate_panda rat tsslclientrat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "TSSLClient RAT used by PIRATE PANDA in targeted attacks"
        reports = "CSIT-19073"
        version = "201904260915"
        last_modified = "2019-04-26"
        actor = "PIRATE PANDA"
        malware_family = "TSSLClientRAT"
    strings:
        /* Code from starting VA 10001737:
        mov     dword_10022610, 8C957FD8h
        mov     dword_10022614, 896CAA0Ch
        mov     dword_10022618, 1F7056A8h
        mov     dword_1002261C, 3C747E59h
        */
        $code_va_10001737 = { c7 05 ?? ?? ?? ?? d8 7f 95 8c c7 05 ?? ?? ?? ?? 0c aa 6c 89 c7 05 ?? ?? ?? ?? a8 56 70 1f c7 05 ?? ?? ?? ?? 59 7e 74 3c }
        $section_cotx = ".cotx" fullword
        $section_iloc = ".iloc" fullword
    condition:
        $code_va_10001737 and
        any of ($section_*)
}

rule CrowdStrike_CSIT_19073_03 : mozirat pirate_panda rat tsslclientrat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Strings found in PIRATE PANDA malware including MoziRAT and TSSLClient"
        reports = "CSIT-19073"
        version = "201909101703"
        last_modified = "2019-09-10"
        actor = "PIRATE PANDA"
        malware_family = "TSSLClientRAT, MoziRAT"
    strings:
        $err_1 = "Error:cmd.exe not exist!"
        $err_2 = "Error:You have in a shell,please exit it first!"
        $err_3 = "Error:Create read pipe error!"
        $sorry = "Sorry,host uninstall failed!"
        $str_update = "There is update process, self exit..."
        $str_norun = "#%sCmd shell is not running,or your cmd is error!"
    condition:
        filesize < 1500000 and
        any of them
}

rule CrowdStrike_CSIT_19065_02 : ecrime servhelper unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule match on unpacked strings found in the ServHelper malware"
        reports = "CSIT-19065"
        version = "201904131025"
        last_modified = "2019-04-13"
        malware_family = "ServHelper"
    strings:
        $ = "persist" wide
        $ = "slp ok" wide
        $ = "shell" wide
        $ = "enum" wide
        $ = "selfkill" wide
    condition:
        all of them
}

rule CrowdStrike_JPEG_With_ASPX_Webshell : aspx webshell 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule looks for ASPX webshells embedded in JPEG files."
        version = "201903291224"
        last_modified = "2019-03-29"
    strings:
        $eval = "eval(Request.Item"
        $jpeg_magic = { FF D8 FF E0}
    condition:
        $jpeg_magic at 0 and $eval
}

rule CrowdStrike_CSA_19429_01 : loader shadowhammer wicked_panda 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Matches PlugX-based payload decoder seen in ShadowHammer activity"
        reports = "CSA-19429"
        version = "201903291224"
        last_modified = "2019-03-29"
        actor = "WICKED PANDA"
    strings:
        $loader_bytes1 = { 8D 94 01 EF EE EE EE }
        $loader_bytes2 = { 8D 94 01 DE DD DD DD }
    condition:
        all of them
}

rule CrowdStrike_CSIT_19064_01 : ecrime ransomware vxcrypter 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects strings within the vxCrypter ransomware."
        reports = "CSIT-19064"
        version = "201904121029"
        last_modified = "2019-04-12"
        malware_family = "vxCrypter"
    strings:
        $ = "vxCrypter" wide
        $ = "Select * FROM Win32_NetworkAdapterConfiguration" wide
        $ = "SELECT Caption FROM Win32_OperatingSystem" wide
        $ = "SbieDll.dll" wide
        $ = "MacAddress" wide
        $ = "WARNING! ALL YOUR FILES ARE ENCRYPTED! " wide
        $ = "Files have been decrypted successfully! :)" wide
    condition:
        5 of them
}

rule CrowdStrike_CSIT_19093_01 : anthropoid_spider 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Known patterns in documents attribted to ANTHROPOID SPIDER"
        reports = "CSIT-19093"
        version = "201905311636"
        last_modified = "2019-05-31"
        actor = "ANTHROPOID SPIDER"
    strings:
        // bat header + echo >> temp.txt
        $b64_blob1 = "QGNkIC9kICV+ZHAwDQpAZWNobyBvZmYNCmVjaG8g"
        // bat header + powershell exec
        $b64_blob2 = "QGNkIC9kICV+ZHAwDQpAZWNobyBvZmYNCnBvd2Vyc2hFbEwgLVcgMSAtQyAi"
        // rc4=function
        $b64_blob3 = "cmM0PWZ1bmN0aW9u"
        // scriptlet
        $b64_blob4 = "PD9YTUwgdmVyc2lvbj0iMS4wIj8+CjxzY3JpcHRsZXQ+Cj"
        $vba = "VB_"
        $m1 = "WriteFile"
        $m2 = "OpenTextFile"
        $m3 = "CreateObject"
        $m4 = "GetObject"
        $m5 = "Environ"
        $m6 = "CONTROL Forms.Label.1"
        $m7 = "MsgBox"
    condition:
        (1 of ($b64_blob*)) and $vba and (3 of ($m*))
}

rule CrowdStrike_Dridex_Loader_2018_Stage1 : crypter dridex loader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Characteristic 32-byte decryption keys in Dridex loader variants since December 2018"
        version = "202104060854"
        last_modified = "2021-04-06"
        actor = "INDRIK SPIDER"
        malware_family = "Dridex"
    strings:
        $key_2018_12_17 = { 26 FD 4F 0F B8 78 D4 6E 29 EA 33 64 BE 27 E9 8F } // 2018-12-17 version
        $key_2019_01_28 = { DC 05 F5 9D C8 BD A5 AE 5E FF CC C0 46 6F A8 2F } // 2019-01-28 version
        $key_2019_02_18 = { 08 2F A1 7D E8 22 70 6B 89 5B F2 76 CA FB F0 89 } // 2019-02-18 version
    condition:
        any of them
}

rule CrowdStrike_Dridex_Loader_2018_Stage2 : crypter dridex loader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Characteristic pattern in the .rdata section of Dridex loader variants since December 2018"
        version = "202104060853"
        last_modified = "2021-04-06"
        actor = "INDRIK SPIDER"
        malware_family = "Dridex"
    strings:
        $rdata_sect_pattern = {
        6e 00 74 00 64 00 6c 00  6c 00 2e 00 64 00 6c 00
        6c 00 00 00 6b 00 65 00  72 00 6e 00 65 00 6c 00
        33 00 32 00 2e 00 64 00  6c 00 6c 00 00 00 4c 64
        72 47 65 74 50 72 6f 63  65 64 75 72 65 41 64 64
        72 65 73 73 00 73 6e 78  68 6b 2e 64 6c 6c 00
        }
    condition:
        all of them
}

rule CrowdStrike_CSIT_19076_04 : facade venomous_bear 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects PDF header and encoded JPEG for Facade PDF exfiltration email"
        reports = "CSIT-19076"
        version = "201908131555"
        last_modified = "2019-08-13"
        actor = "VENOMOUS BEAR"
        malware_family = "Facade"
    strings:
        $pdfheader = "JVBERi0xLjQ"
        $jpeg1 = "SkZJRgABAQEAYABgAAD/2wBD"
        $jpeg2 = "AAIBAQIBAQICAgICAgICAwUDAwMDAwYEBAMFBwYHBwcGBwcICQsJCAgKCAcHCg0KCgsMDAwMBwkO"
        $jpeg3 = "Dw0MDgsMDAz/2wBDAQICAgMDAwYDAwYMCAcIDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwM"
        $jpeg4 = "DAwMDAwMDAwMDAwMDAwMDAwMDAz/wAARCAABAAEDASIAAhEBAxEB/8QAHwAAAQUBAQEBAQEAAAAA"
        $jpeg5 = "AAAAAAECAwQFBgcICQoL/8QAtRAAAgEDAwIEAwUFBAQAAAF9AQIDAAQRBRIhMUEGE1FhByJxFDKB"
        $jpeg6 = "kaEII0KxwRVS0fAkM2JyggkKFhcYGRolJicoKSo0NTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZn"
        $jpeg7 = "aGlqc3R1dnd4eXqDhIWGh4iJipKTlJWWl5iZmqKjpKWmp6ipqrKztLW2t7i5usLDxMXGx8jJytLT"
    condition:
        all of them
}

rule CrowdStrike_CSIT_19076_05 : facade venomous_bear 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects email marker and DOC file header for Facade Doc exfiltration email"
        reports = "CSIT-19076"
        version = "201908131555"
        last_modified = "2019-08-13"
        actor = "VENOMOUS BEAR"
        malware_family = "Facade"
    strings:
        $ContentType = "Content-Type: F)*+"
        // 7EE6C4B3190E1C27251B64BC8BF10A7C10FED53E99BEF2B77F9553C3DA4D9E86 @ 0x416
        $bytes_0x416_0x4f6  = { 30 4d 38 52 34 4b 47 78 47 75 45 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 50 67 41 44 41 50 37 2f 43 51 41 47 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 42 41 41 41 41 41 51 41 41 41 41 41 41 41 41 41 41 0a 45 41 41 41 41 67 41 41 41 41 45 41 41 41 44 2b 2f 2f 2f 2f 41 41 41 41 41 41 41 41 41 41 44 2f 2f 2f 2f 2f 2f 2f 2f 2f 2f 2f 2f 2f 2f 2f 2f 2f 2f 2f 2f 2f 2f 2f 2f 2f 2f 2f 2f 2f 2f 2f 2f 2f 2f 2f 2f 2f 2f 2f 2f 2f 2f 2f 2f 2f 0a 2f 2f 2f 2f 2f 2f 2f 2f 2f 2f 2f 2f 2f 2f 2f 2f 2f 2f 2f 2f 2f 2f 2f 2f 2f 2f 2f 2f 2f 2f 2f 2f 2f 2f 2f 2f 2f 2f 2f 2f 2f 2f 2f 2f 2f 2f 2f 2f 2f 2f 2f 2f 2f 2f 2f 2f 2f 2f 2f 2f 2f 2f 2f 2f 2f 2f 2f 2f 2f 2f }
    condition:
        all of them
}

rule CrowdStrike_FancyBear_PocoDown_01 : fancy_bear pocodown rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Characteristic XOR key identifiers in PocoDown"
        reports = "CSA-19480,CSIT-19177"
        version = "202003031557"
        last_modified = "2020-03-03"
        actor = "FANCY BEAR"
        malware_family = "PocoDown"
    strings:
        $ = { b9 2f 51 15 }
        $ = { 67 dc bc 76 }
        $ = { d4 eb 1c b2 }
        $ = { 35 9e 6c 40 }
    condition:
        all of them
}

rule CrowdStrike_CSIT_19177_03 : fancy_bear pocodown rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Path characteristic to PocoDown"
        reports = "CSIT-19177"
        version = "202003061430"
        last_modified = "2020-03-06"
        actor = "FANCY BEAR"
        malware_family = "PocoDown"
    strings:
        // C:\\Users\\User\\Desktop\\Downloader_Poco\\Downloader_PocoLib\\PocoInclude\\include\\Poco/SharedPtr.h
        $ = "C:\\Users\\User\\Desktop\\Downloader_Poco\\Downloader_PocoLib"
    condition:
        all of them
}

rule CrowdStrike_CSIT_19177_01 : fancy_bear pocodown rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Mutex name used in the PocoDown malware"
        reports = "CSIT-19177"
        version = "202003061428"
        last_modified = "2020-03-06"
        actor = "FANCY BEAR"
        malware_family = "PocoDown"
    strings:
        $ = "bbf7b9f2-36ee-4be6-9258-c2730810252a"
        $ = "1b8232f6-6806-4733-901d-62bf3ef33e6c"
        $ = "e2e9ba94-7813-4c5e-9df1-cc53ca268d9f"
    condition:
        any of them
}

rule CrowdStrike_CSIT_19177_04 : fancy_bear pocodown rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "XOR keys used for string obfuscation in the PocoDown malware"
        reports = "CSIT-19177"
        version = "202003061431"
        last_modified = "2020-03-06"
        actor = "FANCY BEAR"
        malware_family = "PocoDown"
    strings:
        $key_a_1 = { D8 74 28 7B 32 2D D8}
        $key_a_2 = { E7 71 35 15 30 6D 5E B0 66}
        $key_a_3 = { 33 8C FF 3E 62 63}
        $key_b = { cc dc 44 75 af ff 1d a9 2e }
        $key_c = { CB 4F 90 45 E2 B7 D6 5D 76 }
        $key_d = { 37 1f 41 ab e4 c8 88 0b c1 }
    condition:
        all of ($key_a_*) or $key_b or $key_c or $key_d
}

rule CrowdStrike_CSA_19482_01 : installer powershell venomous_bear 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects common function names found in VENOMOUS BEAR PowerShell scripts"
        reports = "CSA-19482"
        version = "202106171605"
        last_modified = "2021-06-17"
        actor = "VENOMOUS BEAR"
    strings:
        $func_install = "function Install" wide ascii
        $func_setms = "function Reg-SetMS" wide ascii
        $func_delms = "function Reg-DelMS" wide ascii
    condition:
        all of them
}

rule CrowdStrike_CARBON_SPIDER_JavaScript_Dropper_01 : carbon_spider dropper javascript 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Identifies characteristic artifacts observed in JavaScript droppers attributed to CARBON SPIDER"
        version = "202104060854"
        last_modified = "2021-04-06"
        actor = "CARBON SPIDER"
    strings:
        $ = " = new ActiveXObject(\"Scripting.FileSystemObject\");" ascii wide
        $ = ".OpenTextFile(WScript.ScriptFullName,1" ascii wide
        $ = "i=0;i<" ascii wide
        $ = "+=String.fromCharCode(" ascii wide
    condition:
        all of them
}

rule CrowdStrike_CSIT_19177_02 : fancy_bear pocodown rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Deobfuscation function in PocoDown malware"
        reports = "CSIT-19177"
        version = "202003061429"
        last_modified = "2020-03-06"
        actor = "FANCY BEAR"
        malware_family = "PocoDown"
    strings:
        /*
        0x00000000:  33 D2        3.    xor   edx, edx
        0x00000002:  41           A     inc   ecx
        0x00000003:  8B C0        ..    mov   eax, eax
        0x00000005:  41           A     inc   ecx
        0x00000006:  F7 F6        ..    div   esi
        0x00000008:  42           B     inc   edx
        0x00000009:  0F B6 04 3A  ...:  movzx eax, byte ptr [edx + edi]
        0x0000000D:  43           C     inc   ebx
        0x0000000E:  32 04 0A     2..   xor   al, byte ptr [edx + ecx]
        0x00000011:  41           A     inc   ecx
        0x00000012:  88 01        ..    mov   byte ptr [ecx], al
        0x00000014:  41           A     inc   ecx
        0x00000015:  FF C0        ..    inc   eax
        0x00000017:  49           I     dec   ecx
        0x00000018:  FF C1        ..    inc   ecx
        0x0000001A:  45           E     inc   ebp
        0x0000001B:  3B C4        ;.    cmp   eax, esp
        0x0000001D:  72 E1        r.    jb    0
        */
        $bit32 = {
        33 D2 41 8B C0 41 F7 F6 42 0F B6 04 3A 43 32 04 0A 41 88 01 41 FF C0 49 FF C1 45 3B C4 72 E1
        }
        /*
        0x00000000:  33 D2     3.   xor edx, edx
        0x00000002:  8B C1     ..   mov eax, ecx
        0x00000004:  F7 75 C0  .u.  div dword ptr [ebp - 0x40]
        0x00000007:  8B 45 C4  .E.  mov eax, dword ptr [ebp - 0x3c]
        0x0000000A:  8D 34 39  .49  lea esi, [ecx + edi]
        0x0000000D:  41        A    inc ecx
        0x0000000E:  8A 14 02  ...  mov dl, byte ptr [edx + eax]
        0x00000011:  8B 45 D0  .E.  mov eax, dword ptr [ebp - 0x30]
        0x00000014:  32 14 30  2.0  xor dl, byte ptr [eax + esi]
        0x00000017:  88 16     ..   mov byte ptr [esi], dl
        0x00000019:  3B 4D CC  ;M.  cmp ecx, dword ptr [ebp - 0x34]
        0x0000001C:  72 E2     r.   jb  0
        */
        $bit64 = {
        33 D2 8B C1 F7 75 C0 8B 45 C4 8D 34 39 41 8A 14 02 8B 45 D0 32 14 30 88 16 3B 4D CC 72 E2
        }
    condition:
        any of them
}

rule CrowdStrike_EarthWorm : earthworm proxy 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects the EarthWorm network proxy tool"
        version = "201904121046"
        last_modified = "2019-04-12"
        malware_family = "Earthworm"
    strings:
        $worm = "Earthworm is a network agent tool."
        $cmd1 = "--> %3d <-- (close)used tunnel %d , unused tunnel %d"
        $cmd2 = "ssocksd 0.0.0.0:%d <--[%4d usec]--> socks server"
        $cmd3 = "rssocks %s:%d <--[%4d usec]--> socks server"
        $cmd4 = "may be sth wrong ~ %d reconnect now!"
        $who1 = "rootkiter : The creator"
        $who2 = "darksn0w  : Proviede some advice"
        $who3 = "zhuanjia  : Modify the Readme file"
        $who4 = "syc4mor3  : Named for this tool"
    condition:
        $worm
        and 2 of ($cmd*)
        and 2 of ($who*)
}

rule CrowdStrike_CSIT_20144_02 : lnk primitive_bear 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects LNK (shortcut) files used by PRIMITIVE BEAR to establish persistence for next-stage malware"
        reports = "CSIT-20144"
        version = "202106171525"
        last_modified = "2021-06-17"
        actor = "PRIMITIVE BEAR"
    strings:
        $lnk_header = { 4c 00 00 00 01 14 02 00  00 00 00 00 c0 00 00 00 00 00 00 46 }
        $serial = { 45 6c 76 3c }
    condition:
        $lnk_header at 0 and
        $serial
}

rule CrowdStrike_CSIT_19073_01 : exilerat pirate_panda rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "ExileRAT malware used by PIRATE PANDA"
        reports = "CSIT-19073"
        version = "201909101703"
        last_modified = "2019-09-10"
        actor = "PIRATE PANDA"
        malware_family = "ExileRAT"
    strings:
        $str_magic = "*B&H#T^" fullword
        $str_myip = "my-ip\" value=\"" fullword
        $str_unkos = "unknow os" fullword
        $str_ver = " ver:%d.%d.%d" fullword
        $str_delim = "--71h2ll4i66hhbl" fullword
        /* Code from starting VA 00406f30:
        mov     al, [edx+ebx]
        mov     cl, al
        shr     al, 5
        shl     cl, 3
        or      cl, al
        xor     cl, 23h
        mov     [edx+ebx], cl
        inc     edx
        cmp     edx, esi
        */
        $code_va_00406F30 = { 8a 04 1a 8a c8 c0 e8 05 c0 e1 03 0a c8 80 f1 23 88 0c 1a 42 3b d6 }
    condition:
        3 of them
}

rule CrowdStrike_CSIT_19076_06 : chinch dropper venomous_bear 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects XOR key used in Chinch droppers"
        reports = "CSIT-19076"
        version = "201908131555"
        last_modified = "2019-08-13"
        actor = "VENOMOUS BEAR"
        malware_family = "Chinch"
    strings:
        // 881941EA24E92F4BD4D69D79E27CE1D2B10094172CB3CC93B223DAF70EF2D867 @ 0x401013
        $bytes_0x401013_0x40143e  = { c6 85 ?? fd ff ff 51 c6 85 ?? fd ff ff 01 c6 85 ?? fd ff ff 75 c6 85 ??fd ff ff 0b c6 85 ?? fd ff ff 9e c6 85 ?? fd ff ff 2a c6 85 ?? fd ff ff 81 c6 85 ?? fd ff ff 76 c6 85 ?? fd ff ff 14 c6 85 ?? fd ff ff 5d c6 85 ?? fd ff ff 46 c6 85 ?? fd ff ff e9 c6 85 ?? fd ff ff 34 c6 85 ?? fd ff ff 0d c6 85 ?? fd ff ff 49 c6 85 ?? fd ff ff 48 c6 85 ?? fd ff ff bb c6 85 ?? fd ff ff 5a c6 85 ?? fd ff ff 3a c6 85 ?? fd ff ff e2  }
        // A5419BF71181E4B2F350BE2DFB1A3C3C4780542BE2BB432D18D2E89AF8795C4D @ 0x4dba80
        $bytes_0x4dba80_0x4dbd50  = { 51 01 75 0b 9e 2a 81 76 14 5d 46 e9 34 0d 49 48 bb 5a 3a e2 c1 65 8f aa 59 58 b9 7a 5d b4 6a 9e 25 12 8e 93 09 4a 54 9c 89 2b 59 24 93 54 9d 16 8f af 49 a1 54 49 2b 7a 11 38 9c ad 08 c8 3a 52 86 59 09 47 d4 33 d1 e4 d1 85 69 97 9c 1f 26 3b 61 41 74 d5 59 d1 d9 a5 87 a5 17 3c 8f 0b ea 0f 93 24 36 a3 71 36 c3 ee 9d 1f 66 c0 7d 68 5d 9b e7 e5 a6 bd 57 66 59 76 66 6f 56 5d ad 36 27 ab 16 bb b4 bd 3e f4 f8 3e 9f 97 f6 bf 2c d4 7d 9b a5 6f f4 9b 49 27 4e 0c 00 6d a3 78 3d 31 00 a6 dc 57 6a 10 e0 40 ae 84 86 92 8e 3a b0 c4 b0 da 8c 3a 18 20 3c d3 03 02 ed 9f 2f 95 0d ef 0a 7c 3a 42 dc df ae 21 b1 a8 df b1 f8 6e da 61 36 30 2b 60 26 0e df 1d c9 0e 15 05 63 a1 21 5f 8e 48 07 05 d5 e5 e4 3b 21 a1 2a 16 93 cb 2b 49 e6 86 64 57 87 52 72 0b b0 ac 56 a0 8c bd b7 cb c8 69 a8 53 7c ba 7d 15 1f 1f 0e 42 85 e5 eb 90 0e 99 30 48 48 64 e9 11 21 da 1e 8e 03 c1 51 22 e5 ac 16 95 af 71 b5 ac bd ec ba 70 59 42 d3 c3 83 4d 44 b6 06 4a cd bd 86 aa 8c 55 49 fb c3 fb e7 86 5b 75 8c 0b 28 f1 35 0d 2b e7 05 e6 3d ca 6d ff a9 ed 6e d2 99 38 e2 c6 f7 95 6a f4 db 49 27 4e ad c1 c2 41 22 02 c1 d8 a3 16 59 50 f3 ae f9 b6 28 b4 b2 3b 02 96 10 0b 5c 3e 3c 90 b6 b1 39 e3 6c 92 0c 49 46 23 f1 34 f8 a1 12 43 11 e1 69 78 86 3f 9c 89 07 6c 87 6d 30 52 6b 8b c9 9a 4e 57 35 a8 90 7c 57 2c 17 84 01 e8 f5 e0 b4 fc 70 4a b4 cc f4 9c 59 1f 8a a3 64 ce 99 96 f5 f5 a6 6d e1 c9 f9 74 8c 88 b4 59 3d 28 95 d1 90 ce 1d 05 1d 5a 99 62 a3 81 3d f3 92 f3 e6 33 e5 e9 3f 4e 76 7f e1 dc 68 65 c8 8a 55 85 34 36 66 35 9e 70 7c 76 99 62 85 87 a7 4c 96 72 60 5c c9 f1 24 e8 76 1c 4b 44 d3 a4 4d 75 af 48 e8 f3 96 45 45 55 61 12 ca 7c 7a e3 dc fb 31 d5 34 50 b5 45 9a ea b5 8b 9f a8 ff fb e0 40 00 00 0d 22 5d d8 4b 29 63 6a ba 0c fb 2d 65 2c 6d 58 7d a3 5f 4c a5 8d a3 36 33 ab a9 a6 3d b5 94 19 69 6a 96 d0 16 0c 81 3a 0b a2 44 d3 85 1b 7e 23 57 e2 8e ad a8 c4 67 55 10 d0 34 87 43 a8 8e 16 87 40 75 40 c9 9f dc 90 95 73 01 b8 f8 c8 65 10 22 1e 45 44 73 b2 f7 3a 38 58 72 f2 33 56 47 f7 df 42 2a 08 86 44 80 28 31 2b 05 25 11 29 3c 04 72 c2 4f 75 52 b8 4f 6d 95 75 0e 0a 98 09 e9 4e c9 87 fa b1 ed 7b 92 27 a3 df 0c 27 64 f1 51 e9 68 ac a8 d2 03 f3 da 2e 68 7a 84 7c 74 89 54 c4 d7 0e db 7f d9 6f }
    condition:
        any of them
}

rule CrowdStrike_CSIT_19076_07 : chinch dropper venomous_bear 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects XOR decryption loop used by VENOMOUS BEAR Chinch dropper"
        reports = "CSIT-19076"
        version = "201908131555"
        last_modified = "2019-08-13"
        actor = "VENOMOUS BEAR"
        malware_family = "Chinch"
    strings:
        // 881941EA24E92F4BD4D69D79E27CE1D2B10094172CB3CC93B223DAF70EF2D867 @ 0x402285
        $bytes_0x402285_0x4022cc  = { 89 bd 18 fd ff ff 3b 7d 0c 73 3c 89 4d ec 81 7d ec d0 02 00 00 73 2d 8b ?? ?? 8d 34 07 8b ?? 33 d2 bb d0 02 00 00 f7 f3 0f b6 84 15 1c fd ff ff 8b ?? ?? 0f af d7 03 c2 0f b6 16 33 c2 88 ?? ff ?? ?? eb ca 47 eb b9 }
    condition:
        $bytes_0x402285_0x4022cc
}

rule CrowdStrike_CSIT_19081_01 : infostealer raccoon unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects Raccoon Stealer based on strings"
        reports = "CSIT-19081"
        version = "202002191722"
        last_modified = "2020-02-19"
        malware_family = "raccoon_stealer"
    strings:
        $ = "masks"
        $ = "config"
        $ = "exceptions"
        $ = "size_limit"
        $ = "attachment_url"
        $ = "%[^:]://%[^/]/%[^"
        $ = "%99[^:]://%99[^/]/%99[^"
        $ = "content-disposition: form-data; name=\"file\"; filename=\"data.zip\""
        $ = "abe2869f-9b47-4cd9-a358-c22904dba7f7" fullword wide
        $ = "stealer\\stealler\\json.hpp" fullword wide
        $ = "Assertion failed: %Ts, file %Ts, line %d" fullword wide
        $ = "{%08X-%04X-%04X-%02X%02X-%02X%02X%02X%02X%02X%02X}" fullword ascii
        $ = "1@zFg08*@45"
        $ = "--Jfbvjwj3489078yuyetu"
        $ = "systeminfo.txt"
        $ = "SUBTYPE GUID=\""
        $ = "no future"
    condition:
        8 of them
}

rule CrowdStrike_CSIT_19138_02 : helix_kitten sharpface webshell 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects SharpFace webshell using encrypted data to compile and run .NET binary"
        reports = "CSIT-19138"
        version = "202005151247"
        last_modified = "2020-05-15"
        actor = "HELIX KITTEN"
        malware_family = "SharpFace"
    strings:
        //TTP Exact:
        //object o = (new CSharpCodeProvider()).CompileAssemblyFromSource(compilerParams, Encoding.ASCII.GetString(decSource)).CompiledAssembly.CreateInstance("A.B");
        $a_1 = "(new CSharpCodeProvider()).CompileAssemblyFromSource("
        $a_2 = "Encoding.ASCII.GetString("
        $a_3 = ")).CompiledAssembly.CreateInstance(\""
        //TTP Exact:
        //MethodInfo mi = o.GetType().GetMethod("C");
        $b_1 = "MethodInfo"
        $b_2 = ".GetType().GetMethod(\""
        //TTP Exact:
        //ret = (byte[])mi.Invoke(o, Encoding.ASCII.GetString(decParams).Split('|'));
        $c_1 = "(byte[])"
        $c_2 = ".Invoke("
        $c_3 = ").Split('"
    condition:
        all of them
}

rule CrowdStrike_CSIT_19104_02 : evora loader lotus_panda 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Decoding routines used in samples that load Evora first-stage payloads "
        reports = "CSIT-19104"
        version = "202012011451"
        last_modified = "2020-12-01"
        actor = "LOTUS PANDA"
        malware_family = "Evora"
    strings:
        $code_dec1  = { 0f b6 51 ff 48 8d 49 ff 30 51 01 41 ff c9 }
        $code_dec2  = { 0f b6 42 ff 48 8d 52 ff 30 42 01 41 ff c8 }
        $code_gen   = { 0f b6 ?? ff 48 8d ?? ff 30 ?? 01 41 ff c? }
        $str_hypot = "_hypot" fullword
    condition:
        filesize < 1MB and
        any of ($code_*) and
        $str_hypot
}

rule CrowdStrike_CSIT_19179_01 : rat sempathy 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects an instance of Sempathy RAT"
        reports = "CSIT-19179"
        version = "202106081525"
        last_modified = "2021-06-08"
        malware_family = "Sempathy RAT"
        
    strings:
        $a1 = "socks="
        $a2 = "http="
        $a3 = "timeGetTime" wide ascii
        $a4 = "ProxyServer" wide ascii
        $a5 = "\\Terminal Server" wide ascii
        $a6 = "PortNumber" wide ascii
    condition:
        all of them and uint16(0) == 0x5A4D and filesize <= 1MB
}

rule CrowdStrike_CSIT_19113_01 : fakedead loader rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects another version of FakeDead that uses 0x80 key starting with 0xDEADFA0C"
        reports = "CSIT-19113"
        version = "202106081529"
        last_modified = "2021-06-08"
        malware_family = "FakeDead"
    strings:
        $a1 = { 0c fa ad de 05 a3 da 3e }
        $a2 = { 68 80 00 00 00 }
        $a3 = "VirtualAlloc"
        $a4 = "LockResource"
    condition:
        uint16(0) == 0x5A4D and
        all of ($a*) and
        filesize <= 5MB
}

rule CrowdStrike_CSIT_19083_01 : loader parasite_http 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Parasite HTTP, module-based loader sold on Tor hidden website by P4r4517"
        reports = "CSIT-19083"
        version = "201905171439"
        last_modified = "2019-05-17"
        malware_family = "Parasite HTTP"
    strings:
        $xor_algo = { 6A 65 5B 6A 72 5A 6A 6E 83 65 FC 00 66 89 45 BC }
        $rand_a = { c1 69 c0 0b a3 14 00 }
        $rand_b = { a3 14 00 b9 51 75 42 69 2b c1 }
        $rand_c = { a3 14 00 2b c1 88 44 }
    condition:
        all of them
}

rule CrowdStrike_CSIT_19086_02 : azazel wicked_panda winnti 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects unique filenames used by Winnti for Linux"
        reports = "CSIT-19086"
        version = "201905171444"
        last_modified = "2019-05-17"
        actor = "WICKED PANDA"
        malware_family = "Azazel,Winnti"
    strings:
        $libudev = "libudev.pid"
        $libudev1 = "libudev1.pid"
        $systemd_priv = "systemd-private-ue"
        $ans_log = "/tmp/ans.log"
    condition:
        any of them
}

rule CrowdStrike_CSIT_19086_01 : azazel rootkit unix 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects API names under Azazel rootkit string obfuscation"
        reports = "CSIT-19086"
        version = "201908271011"
        last_modified = "2019-08-27"
        malware_family = "Azazel,Winnti"
    strings:
        $api_names = { 9f 9d 9d 9b 8e 8a 00 9f 9d 9d 9b 8d 8d 00 9b 86 9b 9d 88 9b 00 92 97 90 95 00 a1 a1 92 86 8d 8a 9f 8a 00 a1 a1 92 86 8d 8a 9f 8a c8 ca 00 91 8e 9b 90 00 8c 93 9a 97 8c 00 8b 90 92 97 90 95 }
    condition:
        all of them
}

rule CrowdStrike_CSIT_19099_01 : alinapos copycatalina pos 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects instances of CopyCatAlina malware"
        reports = "CSIT-19099"
        version = "201906071917"
        last_modified = "2019-06-07"
        malware_family = "CopyCatAlina"
    strings:
        $xor_alg = {80 34 38 AA 40 3B C6 72 F7 56 8B D7}
        $install = ":Install"
        $tmp = "ksld67ij3.tmp"
    condition:
        all of them
}

rule CrowdStrike_CSIT_19108_01 : android paperplane 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects strings used for data exfiltration in PaperPlane Spyware"
        reports = "CSIT-19108"
        version = "201906280845"
        last_modified = "2019-06-28"
        malware_family = "PaperPlane"
    strings:
        $ = "v12/Health/cif?u="
        $ = "v12/ad/Categories"
        $ = "v12/ad/ManageCategory"
        $ = "v12/ad/Statistics"
        $ = "v12/ad/log"
        $ = "v12/content/getDashboard?userId="
        $ = "v12/content/getFilters"
        $ = "v12/content/getHome?tagId="
        $ = "v12/content/getSearch"
        $ = "v12/health/fp"
        $ = "v12/health/nui?u="
        $ = "v12/health/sb?u="
        $ = "v12/health/shn?u="
        $ = "v12/health/slc?u="
        $ = "v12/health/sshn?u="
        $ = "v12/health/sta?u="
        $ = "v12/health/svi?u="
        $ = "v12/media/checkUrls"
        $ = "v12/media/getLocalUrl?docId="
        $ = "v12/media/getLocalUrl?volumeId="
        $ = "v12/payment/crs"
        $ = "v12/payment/fp?paymentId="
        $ = "v12/payment/gpd?paymentId="
        $ = "v12/payment/gpl?fromTelegramUserId="
        $ = "v12/payment/gpr?pageIndex="
        $ = "v12/payment/gsr?pageIndex="
        $ = "v12/payment/ic"
        $ = "v12/payment/rp?paymentId="
        $ = "v12/payment/rsd"
        $ = "v12/payment/rsu"
        $ = "v12/setting/getthemes"
        $ = "v12/user/SaveStickers?userId="
        $ = "v12/user/getTags?userId="
        $ = "v12/user/isFavoritedTag?userId="
        $ = "v12/user/register"
        $ = "v12/user/saveChannels?userId="
        $ = "v12/user/saveTags"
    condition:
        2 of them
}

rule CrowdStrike_CSIT_19111_01 : artifact backdoor post_exploitation rat trex 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects config files used with TRex malware"
        reports = "CSIT-19111"
        version = "201908071454"
        last_modified = "2019-08-07"
    strings:
        $a = { 6d 2a ae 00 }
        $b = { 63 9d 1b 03 }
    condition:
        $a at 0 or $b at 0
}

rule Crowdstrike_CSIT_19111_03 : backdoor post_exploitation rat trex 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects RC4 keys used by TRex"
        reports = "CSIT-19111"
        version = "201908071454"
        last_modified = "2019-08-07"
        malware_family = "TRex"
    strings:
        // From config: D3ECD0E5F6DD6B6FA1E8FDAD7E0EC9B1020E5BB0B9E64F76D2148F1B24CA7779
        $ = { 452b703431657a58d26b66d14971ba7752c9374e853163947742b936366c6579de644fb33731687577ec7775ec3137684f64b37965de36366c4277b96331944e37855277c97149ba666bd1587ad23134652b4570 }
        // From config: 12F79030E73030E127AE3EC5AB16B51CD5F7812E786E6D23FC54B5820F5F3064
        $ = { 454d925148997451c57878f06856be4669af3432667977f07761d853328542488a477ac1345a8e5039893950895a348e7a47c148428a3253856177d87779f03234666946af5668be7878f05174c54851994d4592 }
    condition:
        any of them
}

rule Crowdstrike_CSIT_19111_04 : backdoor post_exploitation rat trex 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects algorithm used by TRex to generate random data for C2 payload"
        reports = "CSIT-19111"
        version = "201908071453"
        last_modified = "2019-08-07"
        malware_family = "TRex"
        /*
        From: bc32bf55e841052a095c27cea558577fa947fdf8b7d95beca0c5725dbd00324d
        34 69                   xor     al, 69h
        4d 8b c4                 mov     r8, r12
        88 46 0c                 mov     [rsi+0Ch], al
        41 0f b6 41 01             movzx   eax, byte ptr [r9+1]
        34 69                     xor     al, 69h
        88 46 05                 mov     [rsi+5], al
        41 0f b6 41 03             movzx   eax, byte ptr [r9+3]
        34 63                     xor     al, 63
        88 46 07                 mov     [rsi+7], al
        41 0f b6 41 02             movzx   eax, byte ptr [r9+2]
        34 73                     xor     al, 73h
        88 46 06                 mov     [rsi+6], al
        41 0f b6 41 04             movzx   eax, byte ptr [r9+4]
        34 72                     xor     al, 72h
        88 46 08                 mov     [rsi+8], al
        41 0f b6 41 07             movzx   eax, byte ptr [r9+7]
        34 6c                     xor     al, 6Ch
        88 46 0b                 mov     [rsi+0Bh], al
        41 0f b6 41 05             movzx   eax, byte ptr [r9+5]
        34 5c                     xor     al, 5Ch
        88 46 09                 mov     [rsi+9], al
        41 0f b6 41 06            movzx   eax, byte ptr [r9+6]
        34 63                     xor     al, 63h
        88 46 0a                 mov     [rsi+0Ah], al
        41 0f b6 41 09             movzx   eax, byte ptr [r9+9]
        34 5Ch                     xor     al, 5Ch
        */
    strings:
        $hex_string = { 34 69 4d ?? ?? 88 ?? ?? 41 ?? ?? ?? ?? 34 69 88 ?? ?? 41 ?? ?? ?? ?? 34 63 88 ?? ?? 41 ?? ?? ?? ?? 34 73 88 ?? ?? 41 ?? ?? ?? ?? 34 72 88 ?? ?? 41 ?? ?? ?? ?? 34 6c 88 ?? ?? 41 ?? ?? ?? ?? 34 5c 88 ?? ?? 41 ?? ?? ?? ?? 34 63 88 ?? ?? 41 ?? ?? ?? ?? 34 5c }
    condition:
        $hex_string
}

rule Crowdstrike_CSIT_19111_05 : backdoor post_exploitation rat trex 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects algorithm use by TRex to check for ASCII characters"
        reports = "CSIT-19111"
        version = "201908071453"
        last_modified = "2019-08-07"
        malware_family = "TRex"
        /*
        From: bc32bf55e841052a095c27cea558577fa947fdf8b7d95beca0c5725dbd00324d
        3C 20                                   cmp     al, 20h ; ' '
        72 04                                   jb      short loc_140005B5E
        3C 7E                                   cmp     al, 7Eh ; '~'
        76 10                                   jbe     short loc_140005B6E
        3C 09                                   cmp     al, 9
        74 0C                                   jz      short loc_140005B6E
        3C 0A                                   cmp     al, 0Ah
        74 08                                   jz      short loc_140005B6E
        3C 0D                                   cmp     al, 0Dh
        0f 85 73 08 00 00                       jnz     loc_1400063E1
        */
    strings:
        $hex_string = { 3c 20 72 ?? 3c 7e 76 ?? 3c 09 74 ?? 3c 0a 74 ?? 3c 0d 0f }
    condition:
        $hex_string
}

rule CrowdStrike_CSIT_19111_06 : backdoor post_exploitation rat trex 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects strings in TRex used to debug and interact with config files"
        reports = "CSIT-19111"
        version = "201908071453"
        last_modified = "2019-08-07"
        malware_family = "TRex"
    strings:
        $dt_1 = "<dt1>" wide ascii
        $dt_2 = "<dt2>" wide ascii
        $dt_3 = "<dt3>" wide ascii
        $dt_4 = "<dt4>" wide ascii
        $log_2 = "3.001_" wide ascii
        $log_3 = "3.001.0002_" wide ascii
        $log_4 = "3.001.0002.003_" wide ascii
    condition:
        all of ($dt_*) and
        #log_2 > 3 and
        #log_3 > 20 and
        #log_4 > 20
}

rule CrowdStrike_CSIT_19111_07 : backdoor post_exploitation rat trex 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects data used by TRex as seed for random C2 payload"
        reports = "CSIT-19111"
        version = "201908071453"
        last_modified = "2019-08-07"
        malware_family = "TRex"
    strings:
        $ = { 08 94 22 13 e9 29 27 2d fd 9e f9 34 79 1a 41 0f }
        $ = { be 13 3a 09 92 bf 5e 19 69 af 17 12 b5 68 68 32 }
    condition:
        all of them
}

rule CrowdStrike_CSIT_19111_08 : backdoor post_exploitation rat trex 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects constants used by TRex to check file age before deleting"
        reports = "CSIT-19111"
        version = "201908071453"
        last_modified = "2019-08-07"
        malware_family = "TRex"
    strings:
        $ = { c7 45 ?? 00 c0 b0 fe [0-7] c7 45 ?? c1 63 d2 01 }
    condition:
        any of them and filesize < 500KB
}

rule CrowdStrike_CSIT_19091_01 : ecrime golang ransomware robbinhood 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects unique function names found in Robbinhood Ransomware."
        reports = "CSIT-19091,CSIT-20099"
        version = "202011301630"
        last_modified = "2020-11-30"
        malware_family = "Robbinhood"
    strings:
        $rw_path = "C:/Users/valery/go/src/oldboy/"
        $func1 = "EncryptingByteWithKey"
        $func2 = "GenerateRandomANString"
        $func3 = "RandomFileName"
        $func4 = "FileName_Encrypt"
        $func5 = "Read_Encrypt_Write_WithKey"
        $func6 = "WalkFunc"
        $func7 = "EnableShadowFucks"
        $func8 = "EnableRecoveryFCK"
        $func9 = "EnableServiceFuck"
        $func10 = "EnableProcessKill"
    condition:
        4 of them and filesize<5MB
}

rule CrowdStrike_CSA_19616_01 : anchor trickbot wizard_spider 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects TrickBot Anchor DNS variant based on characteristic opcodes."
        reports = "CSA-19616,CSIT-19155"
        version = "202006151613"
        last_modified = "2020-06-15"
        actor = "WIZARD SPIDER"
        malware_family = "AnchorDNS"
    strings:
        $str_qwerty_lower = "qwertyuiopasdfghjklzxcvbnm"
        $str_qwerty_upper = "QWERTYUIOPASDFGHJKLZXCVBNM"
        $str_log_cmd1 = "startLero: run command \"%S\""
        $str_log_cmd2 = "get command: incode %s, cmdid \"%s\", cmd \"%s\""
        $str_log_format = "%04i-%02i-%02i %02i:%02i:%02i.%03i pid %i "
        $str_persist_time = "%04i-12-31T23:59:59" wide fullword
        $str_persist_name = "Task autoupdate#16876" wide fullword
        $ip_host_1 = "checkip.amazonaws.com" wide fullword
        $ip_host_2 = "ipecho.net" wide fullword
        $ip_host_3 = "ipinfo.io" wide fullword
        $ip_host_4 = "api.ipify.org" wide fullword
        $ip_host_5 = "icanhazip.com" wide fullword
        $ip_host_6 = "myexternalip.com" wide fullword
        $ip_host_7 = "wtfismyip.com" wide fullword
        $ip_host_8 = "ip.anysrc.net" wide fullword
    condition:
        5 of ($ip*) and 2 of ($str*)
}

rule CrowdStrike_CSA_19615_02 : blackwater macro static_kitten 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Identifies distinctive variable names in macros used to deploy BlackWater"
        reports = "CSA-19615"
        version = "201906262140"
        last_modified = "2019-06-26"
        actor = "STATIC KITTEN"
    strings:
        $var1 = "bckWrShArr"
        $var2 = "blckWtrRgPthArr"
        $var3 = "blakWterRgValArr"
        $var4 = "bWSzArr"
        $var5 = "bWLaPthArr"
    condition:
        2 of them
}

rule CrowdStrike_CSA_19615_01 : blackwater delivery_document static_kitten 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects macro-enabled documents observed deploying the BlackWater reconnaissance tool"
        reports = "CSA-19615"
        version = "201906262139"
        last_modified = "2019-06-26"
        actor = "STATIC KITTEN"
    strings:
        $magic = { d0 cf 11 e0 a1 b1 1a e1 }
        $reg = "&H00000001={3832D640-CF90-11CF-8E43-00A0C911005A}"
        $module = "Module=BlackWater"
    condition:
        $magic at 0 and
        $reg and
        $module
}

rule CrowdStrike_CSA_19615_03 : blackwater powershell static_kitten 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects obfuscated PowerShell of the BlackWater reconnaissance tool"
        reports = "CSA-19615"
        version = "201906262139"
        last_modified = "2019-06-26"
        actor = "STATIC KITTEN"
        malware_family = "BlackWater"
    strings:
        $ = "function BS`Ii`oc`Lc"
        $ = "function Iw_`m`GEERao"
        $ = "function j`RJB`A`e`6eCO"
        $ = "function d`OIb`6D`Ed"
        $ = "function N`I`ASSb"
        $ = "function A`cg`Ba`cIo"
        $ = "function G`B4`ClidY"
        $ = "function g`Elei`dei"
        $ = "function C`cK`UPr"
        $ = "function h`ElrV`RQ"
        $ = "function gO`MdrE`Ue"
        $ = "function EX`ccnA`NScr"
        $ = "function s`ee`pM"
        $ = "function wL`chEC`Ul"
        $ = "function P`MRH`LSl"
        $ = "function Gec`o`ANoO"
        $ = "function GfXeCM`dA`sC`Rsltp"
        $ = "function m`AI"
    condition:
        4 of them
}

rule CrowdStrike_CSIT_19087_02 : baby_shark downloader velvet_chollima 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects decoded BabyShark installer VBS file"
        reports = "CSIT-19087"
        version = "202008281158"
        last_modified = "2020-08-28"
        actor = "VELVET CHOLLIMA"
        malware_family = "BabyShark"
    strings:
        $asep = "HKEY_CURRENT_USER\\Software\\Microsoft\\Command Processor"
        $regval = "VBAWarnings"
        $cert = "certutil -f -encode "
        $wshell= "retu=wShell.run"
    condition:
        all of them
}

rule CrowdStrike_CSIT_19087_04 : baby_shark loader velvet_chollima 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects the VELVET CHOLLIMA executable downloaded by BabyShark for loading additional payloads"
        reports = "CSIT-19087"
        version = "202004021444"
        last_modified = "2020-04-02"
        actor = "VELVET CHOLLIMA"
        malware = "BabyShark"
    strings:
        $path = "%s\\Microsoft\\desktop.r3u"
        $dorev1 = {8A 11 88 14 38 40 49 3B C6 7C F5}
        $dorev2 = {8A 4C 0A FF 88 0C 28 8B 4C 24 10 40 4A 3B C1 7C EF}
    condition:
        2 of them
}

rule CrowdStrike_CSIT_19092_01 : downloader jasper_loader vbscript 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects a VBA macro used to decode and execute JasperLoader."
        reports = "CSIT-19092,CSIT-19211"
        version = "201911201622"
        last_modified = "2019-11-20"
        malware_family = "JasperLoader"
    strings:
        $s3 = "Sub AutoOpen()"
        $s7 = "CreateObject(\"WScript.Shell\")"
        $s11 = ".Run "
        $r1 = /Sub [a-z]{4,5}\([a-z]{4,5}\)\r\n  [a-z]{4,5} = [a-z]{4,5} \- [0-9]{3}\r\n/
        $r2 = /Private Function [a-z]{4,7}\(\)\r\n(([a-z][a-z][a-z][a-z]|[a-z][a-z][a-z][a-z][a-z]) \-([0-9][0-9]|[0-9][0-9][0-9])\r\n){30,}/
    condition:
        ($r1 and $s3 and $s7) or ($r2 and $s7 and $s11)
}

rule CrowdStrike_CSIT_19086_03 : remote_shell unix wicked_panda 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects distinctive strings in a custom remote shell component used by WICKED PANDA"
        reports = "CSIT-19086"
        version = "202001151531"
        last_modified = "2020-01-15"
        actor = "WICKED PANDA"
    strings:
        $message1 = "Error: cannot execute shell '%s'"
        $message2 = "Error: cannot open tty '%s'"
        $usage = "Connect back    : %s <remote host> <port> <seconds>"
        $string1 = "writen"
        $string2 = "strnxor"
        $string3 = "really_sleep"
    condition:
        2 of them and filesize<1MB
}

rule CrowdStrike_Phorpiex_TMailer_2 : bot ecrime phorpiex spam unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects unpacked TMailer samples, part of Phorpiex tools. This rule may overlap with CrowdStrike_CSIT_18194_03."
        reports = "CSIT-18194,CSIT-19190"
        version = "201910172315"
        last_modified = "2019-10-17"
        malware_family = "Phorpiex, Phorpiex TMailer"
    strings:
        // generic phorpiex stuff
        $phx1 = "Mozilla/5.0 (Macintosh; Intel Mac OS X 10.9; rv:25.0) Gecko/20100101 Firefox/25.0"
        $phx2 = "%u %s %u %.2u:%.2u:%.2u %s%.2u%.2u"
        $phx3 = "%ls:Zone.Iduentifier" wide
        $phx4 = "%ls:Zone.Identifier" wide
        $phx5 = "%ls:*:Enabled:%s" wide
        $phx6 = "SYSTEM\\CurrentControlSet\\Services\\SharedAccess\\Parameters\\FirewallPolicy\\StandardProfile\\AuthorizedApplications\\List" wide
        // tmlr specific stuff
        $mail1 = "Received: from %s ([%d.%d.%d.%d]) by %s with MailEnable ESMTP; %s"
        $mail2 = "ESMTP"
        $mail3 = "Received: (qmail %s invoked by uid %s); %s\\r\\n"
        $mail4 = "AUTH LOGIN\\r\\n"
        $mail5 = "%s.com"
        // files
        $file1 = "%ls\\%d%d%d%d.jpg" wide
        $file2 = "%ls%d.txt" wide
        $file3 = "%lsdownloader.js" wide
        $file4 = "%ls\\%d%d.zip" wide
        $file5 = "%ls1.txt" wide
        $file6 = "%sn.txt"
    condition:
        2 of ($phx*) and 3 of ($mail*) and 2 of ($file*)
}

rule CrowdStrike_CSA_19635_01 : doghousepower ransomware 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "DogHousePower PyInstaller payload, created with Veil"
        reports = "CSA-19635"
        version = "201905171434"
        last_modified = "2019-05-17"
        malware_family = "DogHousePower"
    strings:
        $ = "python27.dll"
        $ = "out00-PYZ.pyz"
        $ = "Crypto.Cipher._AES.pyd"
        $ = "select.pyd"
        $ = "bz2.pyd"
        $ = "unicodedata.pyd"
        $ = "_ctypes.pyd"
        $ = "_hashlib.pyd"
        $ = "wo_crypted"
    condition:
        all of them
}

rule CrowdStrike_CSIT_19166_02 : blueprint venomous_bear 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects the CheckMessage function in the Transport Agent component of the Blueprint malware"
        reports = "CSIT-19166"
        version = "201910041500"
        last_modified = "2019-10-04"
        actor = "VENOMOUS BEAR"
        malware_family = "Blueprint"
    strings:
        $checkmessage_func  = { 03 50 8e 69 18 58 1a 5a 19 5b 18 58 8d ?? ?? ?? ?? 0a 03 50 16 03 50 8e 69 06 16 }
    condition:
        $checkmessage_func
}

rule CrowdStrike_CSIT_19097_01 : banking retefe 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects unpacked instances of the Retefe OSX Loader "
        version = "201905311644"
        last_modified = "2019-05-31"
        actor = "CLOCKWORK SPIDER"
        malware_family = "Retefe"
    strings:
        $c1 = {8a 0b 80 f1 ?? 88 08 48 ff c3 48 ff c0}
        $s1 = "xattr -d -r com.apple.quarantine"
        $s2 = "CheckInstall"
        $s5 = "%04d-%02d-%02d %02d:%02d:%02d.%03d"
        $s6 = "sleep 5 && rm -fR \"%@\" && \"%@\" %@"
    condition:
        uint16(0) == 0xfacf and ($c1 and 3 of ($s*))
}

rule CrowdStrike_CSIT_19103_03 : ecrime megacortex megacortex_payload ransomware 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects unpacked copies of the MegaCortex ransomware payload."
        version = "201912132016"
        last_modified = "2019-12-13"
        malware_family = "MegaCortex Ransomware"
    strings:
        $common1 = "mbedtls_"
        $common2 = "mbedcrypto pki implementation"
        $old1 = "cipher.exe" wide
        $old2 = "MegaCortex"
        $old3 = "C:\\!!!_READ_ME_!!!.txt"
        $old4 = "_command@16"
        $old5 = ".aes128ct" wide
        $new1 = "megac0rtx" wide
        $new2 = "!!!_READ-ME_!!!.txt" wide
        $new3 = "cipher.exe"
        $obf1 = "[+] " wide
        $obf2 = "[-] " wide
    condition:
        all of ($common*) and (all of ($old*) or all of ($new*) or all of ($obf*))
}

rule CrowdStrike_CSIT_19103_02 : ecrime megacortex megacortex_inject ransomware 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects unpacked MegaCortex inject helper DLL."
        version = "201906171846"
        last_modified = "2019-06-17"
        malware_family = "MegaCortex Ransomware"
    strings:
        $s1 = "injecthelper.dll"
        $s2 = "_command@16"
        $s3 = "start2"
        $s4 = "Failed to Map Shared Memory"
        $s5 = "Failed to Open Shared Memory"
    condition:
        all of them
}

rule CrowdStrike_CSIT_19103_01 : ecrime megacortex megacortex_loader ransomware 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects the packed MegaCortex loader."
        version = "201906171846"
        last_modified = "2019-06-17"
        malware_family = "MegaCortex Ransomware"
    strings:
        $s1 = "start"
        $s2 = "mbedtls_"
        $s3 = "failed"
        // Convert time ticks to every 3 hours
        $b1 = { 6a 08 68 00 68 c4 61 52 50 e8 ?? ?? ?? ?? 8b c8 83 ec 08 b8 56 55 55 55 f7 e9 }
    condition:
        all of them
}

rule CrowdStrike_VENOMOUS_BEAR_snake_jpeg_xorkey : snake venomous_bear 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Matches on the last 32 bytes of a characteristic JPEG image embedded in Snake malware samples and used as a XOR key"
        version = "201908131553"
        last_modified = "2019-08-13"
        actor = "VENOMOUS BEAR"
        malware = "Snake"
    strings:
        $ = {
        09 E8 D6 1F D9 70 6B 32  44 F3 EA 4E 0A FD A6 E2
        57 95 D4 7A 29 72 76 FE  18 AD 89 09 0E 46 4D 14
        }
    condition:
        all of them
}

rule CrowdStrike_CSIT_19104_01 : evora loader lotus_panda 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects LZARI decompression code used in LOTUS PANDA loaders"
        reports = "CSIT-19104"
        version = "202012011451"
        last_modified = "2020-12-01"
        actor = "LOTUS PANDA"
        malware_family = "Evora"
    strings:
        $decomp64 = { 8b 05 [4] 48 89 8c 24 50 28 01 00 89 84 24 74 28 01 00 89 bc 24 70 28 01 00 48 8d 4c 24 30 }
        $decomp32 = { a1 [4] 89 94 24 24 28 01 00 89 84 24 38 28 01 00 c7 84 24 34 28 01 }
        $lzari_pe = { c0 fc 50 51 0f 97 50 fe d9 c1 47 6f ab 63 ef 7d 33 }
    condition:
        $lzari_pe and 1 of ($decomp*)
}

rule CrowdStrike_CSIT_19135_01 : ransomware revil sodinokibi unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects unpacked Sodinokibi ransomware samples."
        reports = "CSIT-19135"
        version = "202105260908"
        last_modified = "2021-05-26"
        malware_family = "Sodinokibi"
    strings:
        $expand = "expand 32-byte kexpand 16-byte k" ascii
        $mutex = "\\BaseNamedObjects\\%S" wide fullword
        //  lea     eax, [esi-41h]
        //  lea     ebx, [ebx+2]
        //  cmp     ax, 19h
        //  ja      offset 3
        //  or      esi, 20h
        //  imul    edx, 10Fh
        //  movzx   eax, si
        //  movzx   esi, word ptr [ebx]
        //  add     edx, eax
        //  test    si, si
        //  jnz
        $op_api_hashing = {
        8D46BF 8D5B02 6683F819 7703 83CE20 69D20F010000 0FB7C6
        0FB733 03D0 6685F6 75
        }
        //  mov     edx, [eax+0Ch]
        //  add     edx, 14h
        //  mov     [ebp+??], edx
        //  mov     ecx, [edx]
        //  cmp     ecx, edx
        //  jz      short LIST_EMPTY
        //  mov     edi, [ebp+Needle]
        $op_search_dll = {
        8B500C 83C214 8955?? 8B0A 3BCA 74(4?|5?) 8B7D08
        }
        //  xor     edx, edx
        //  mov     bl, [ebp+edi+rc4table]
        //  mov     eax, edi
        //  movzx   ecx, bl
        //  div     [ebp+KeySize]
        //  mov     eax, [ebp+Key]
        //  movzx   eax, byte ptr [edx+eax]
        //  add     eax, esi
        //  add     ecx, eax
        //  movzx   esi, cl
        //  mov     al, [ebp+esi+rc4table]
        //  mov     [ebp+edi+rc4table], al
        //  inc     edi
        //  mov     [ebp+esi+rc4table], bl
        //  cmp     edi, 100h
        $op_rc4_01 = {
        33D2 8A9C3D ??F?FFFF 8BC7 0FB6CB F775?? 8B45?? 0FB60402
        03C6 03C8 0FB6F1 8A8435 ??F?FFFF 88843D ??F?FFFF 47 889C35
        ??F?FFFF 81FF00010000
        }
        //  inc     eax
        //  movzx   ecx, al
        //  mov     [ebp+Index], ecx
        //  mov     dl, [ebp+ecx+rc4table]
        //  movzx   eax, dl
        //  add     eax, esi
        //  movzx   esi, al
        //  mov     al, [ebp+esi+rc4table]
        //  mov     [ebp+ecx+rc4table], al
        //  mov     [ebp+esi+rc4table], dl
        //  movzx   ecx, [ebp+ecx+rc4table]
        //  movzx   eax, dl
        //  add     ecx, eax
        //  mov     eax, [ebp+InputSize]
        //  movzx   ecx, cl
        //  mov     cl, [ebp+ecx+rc4table]
        //  xor     cl, [edi+eax]
        //  mov     [eax], cl
        //  inc     eax
        //  mov     [ebp+InputSize], eax
        //  mov     eax, [ebp+Index]
        //  sub     ebx, 1
        $op_rc4_02 = {
        40 0FB6C8 894D?? 8A940D ??F?FFFF 0FB6C2 03C6 0FB6F0 8A8435
        ??F?FFFF 88840D ??F?FFFF 889435 ??F?FFFF 0FB68C0D ??F?FFFF 0FB6C2
        03C8 8B45?? 0FB6C9 8A8C0D ??F?FFFF 320C07 8808 40 8945??
        8B45FC 83EB01
        }
    condition:
        (($expand or $mutex) and 2 of ($op*)) or (3 of ($op*))
}

rule CrowdStrike_CSIT_19102_01 : downloader haze_downloader ricochet_chollima 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects the Haze installer used to download a variant of Nimbus"
        reports = "CSIT-19102"
        version = "201908221334"
        last_modified = "2019-08-22"
        actor = "RICOCHET CHOLLIMA"
        malware_family = "HazeDownloader"
    strings:
        $ = { 8d 95 84 f1 ff ff 52 c6 00 50 }
        $ = "qasetas.bin"
        $ = "w7ra90.dll"
        $ = "w7ra12.exe"
        $ = "main_func"
    condition:
        3 of them
}

rule CrowdStrike_CSIT_19102_03 : haze_downloader ricochet_chollima 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects the DLL component of HazeDownloader installed as a service"
        reports = "CSIT-19102"
        version = "201906210843"
        last_modified = "2019-06-21"
        actor = "RICOCHET CHOLLIMA"
        malware_family = "HazeDownloader"
    strings:
        $marker1 = { 81 38 53 45 4c 46 75 09 81 78 04 53 49 47 4e }
        $marker2 = "SELFSIGN"
        $proc1 = "LOOBWYT.VCV"
        $proc2 = "rwaj.vcv"
        $proc3 = "tnvi.vcv"
        $proc4 = "RxvHdliw.vcv"
        $proc5 = "Drivhsaip.vcv"
        $proc6 = "Gxkervd.vcv"
        $proc7 = "kilxvck.vcv"
        $proc8 = "KVervd.vcv"
        $proc9 = "XUU Vckolivi.vcv"
    condition:
        1 of ($marker*) and 4 of ($proc*)
}

rule CrowdStrike_CSIT_19102_04 : nimbus rat ricochet_chollima 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects variant of Nimbus updated for sounds recording and additional capability deployed by HazeDownloader"
        reports = "CSIT-19102"
        version = "201908221333"
        last_modified = "2019-08-22"
        actor = "RICOCHET CHOLLIMA"
        malware_family = "Nimbus"
    strings:
        $p1 = "Hpbkv.vcv" wide
        $p2 = "hexslhg.vcv" wide
        $p3 = "JJ.vcv" wide
        $p4 = "urivulc.vcv" wide
        $p5 = "xsilnv.vcv" wide
        $p6 = "Xorvmg.vcv" wide
        $p7 = "Atvmg.vcv" wide
        $rclsid = { 10 5d be 62 eb 60 d0 11 bd 3b 00 a0 c9 11 ce 86 }
        $riid = { 22 08 84 29 84 5b d0 11 bd 3b 00 a0 c9 11 ce 86 }
    condition:
        3 of ($p*) and ($rclsid and $riid)
}

rule CrowdStrike_CSIT_19102_02 : downloader haze_downloader ricochet_chollima 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects the DLL installer component of the HazeDownloader used by RICOCHET CHOLLIMA to download Nimbus"
        reports = "CSIT-19102"
        version = "201906210842"
        last_modified = "2019-06-21"
        actor = "RICOCHET CHOLLIMA"
        malware_family = "HazeDownloader"
    strings:
        $ = { 78 72 78 7f 6e 66 77 68 5e 59 59 4e 45 5f 68 44 }
        $ = { 80 34 16 2b 8b ca 46 8d 79 01 }
        $ = { 50 6a 6e 6a ?? e8 }
        $ = "InstallModule"
        $ = "%s\\%s.dll"
        $ = "%s\\%s.ini"
    condition:
        4 of them
}

rule CrowdStrike_JessDownloader_Stage1 : downloader javascript 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Start of the characteristic encoded Jess Downloader second-stage code"
        version = "202106081538"
        last_modified = "2021-06-08"
        malware_family = "Jess Downloader"
    strings:
        $ = "SS=\"76617220543d22"
    condition:
        all of them
}

rule CrowdStrike_JessDownloader_Stage2 : downloader javascript 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Matches parts of the first line of Jess Downloader's second-stage code"
        version = "202106081538"
        last_modified = "2021-06-08"
        malware_family = "Jess Downloader"
    strings:
        $ = "\".split(\"\");function _if_char(a) {"
    condition:
        all of them
}

rule CrowdStrike_JessDownloader_EncodedPayload_01 : encoded payload 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Generically detects encoded Jess Downloader payloads"
        version = "201907311242"
        last_modified = "2019-07-31"
        malware_family = "Jess Downloader"
    strings:
        $ = { 2c 3? 2c 3? 2c 3? 2c 3? 2c 3? 2c 3? 2c 3? 2c 3? 2c 3? 2c 3? 2c 3? 2c 3? 7c 7c 7c 3? 64 3? 61 }
        $ = { 62 65 63 62 }
    condition:
        all of them and
        uint16(0xa0) == 0x6162 and
        uint32(0x207f) == 0x62636562
}

rule CrowdStrike_JavaDispCash : atm_malware jar javadispcash 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects ATM malware dubbed JavaDispCash"
        reports = "CSIT-19110"
        version = "202103302043"
        last_modified = "2021-03-30"
        malware_family = "JavaDispCash"
    strings:
        $other1 = "ERRSRV"
        $other2 = "injx2.Agent"
        $other3 = "runya"
        $replace1 = "%%list_dispense%%"
        $replace2 = "%%cmdb64%%"
        $replace3 = "%%shell%%"
        $msg1 = "<b>Preparing...</b><br />"
        $msg2 = "<b>Unprotecting...</b><br />"
        $msg3 = "<b>Invoking...</b><br />"
        $msg4 = "<h1>Entries: </h1><br />"
        $msg5 = "This is POST"
        $code1 = "Peripheral.Dispenser"
        $code2 = "getNumberOfCashUnits"
        $code3 = "getCashUnit"
        $code4 = "clearDispenseValues"
        $code5 = "setAnomalyHandler"
        $code6 = "waitForBillsTaken"
    condition:
        uint16(0) == 0x4B50 and (
        (2 of ($replace*) and 3 of them) or
        3 of ($msg*) or
        4 of ($code*) or
        (2 of ($other*) and 3 of them)
        )
}

rule CrowdStrike_CSIT_19114_01 : downloader smoke_bot smoke_loader unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects the main v2019 Smoke DLL"
        reports = "CSIT-19114"
        version = "201906280844"
        last_modified = "2019-06-28"
        malware_family = "Smoke Loader"
    strings:
        $c2_crypt = { 32 c1 c1 f9 08 4b 75 f8 34 ?? 88 02 42 4e 75 e5 }
        $resolvers = { c0 47 f5 d0 3a fb 79 6e 65 e2 4f cd bc a5 c8 9c b9 79 b1 b1 }
    condition:
        all of them
}

rule CrowdStrike_CSIT_19100_01 : msmrat pirate_panda rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "MsmRAT used in probable PIRATE PANDA operations"
        reports = "CSIT-19100"
        version = "201909101659"
        last_modified = "2019-09-10"
        actor = "PIRATE PANDA"
        malware_family = "MsmRAT"
    strings:
        $str_lang_unk = "Unknow" fullword
        $str_lang_russian = "Russian" fullword
        $str_lang_unk2 = "UNknow" fullword
        $str_default_code = "1007000000" fullword
        $str_hproc = "hProcessSnapshot == INVALID_HANDLE_VALUE" fullword
        // Xor loop
        /* Code from starting VA 0040144a:
        pxor    xmm0, xmm1
        movups  xmmword ptr [ecx-30h], xmm0
        movups  xmm0, xmmword ptr [ecx-20h]
        pxor    xmm0, xmm1
        */
        $code_va_0040144A = { 66 0F EF C1 0F 11 41 D0 0F 10 41 E0 66 0F EF C1 }
    condition:
        filesize < 2MB and
        4 of them
}

rule CrowdStrike_Megumin_Clipper : clipper infostealer unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects strings in Megumin Clipper malware."
        reports = "CSIT-19106"
        version = "201907121426"
        last_modified = "2019-07-12"
    strings:
        $ = "Megumin/2.0"
        $ = "MeguminV2.pdb"
        $ = "/addbot?hwid="
        $ = "/task?hwid="
        $ = "/gate?hwid="
        $ = "/config"
        $ = "/suicide"
        $ = "/isClipper"
        $ = "/isUSB"
    condition:
        uint16(0) == 0x5a4d and 5 of them
}

rule CrowdStrike_CSIT_19109_01 : android backdoor barbarian berserk_bear infostealer 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects modifications in the Android manifest file made by the Barbarian Android implant in use by BERESRK BEAR."
        reports = "CSIT-19109"
        version = "201907191748"
        last_modified = "2019-07-19"
        actor = "BERSERK BEAR"
        malware_family = "Barbarian Android Backdoor"
    strings:
        $header_xml = "<?xml version=\"1.0\""
        $header_binary = { 03 00 08 00 }
        $barbarian_1 = "android.intent.action.START_MAIN_COMPLETED" ascii wide
        $barbarian_2 = "intent.action.Place" ascii wide
        $barbarian_3 = "io.fabric.sdk." ascii wide
        $permission_1 = "android.permission.ACCESS_COARSE_LOCATION" ascii wide
        $permission_2 = "android.permission.WAKE_LOCK" ascii wide
        $permission_3 = "android.browser.permission.READ_HISTORY_BOOKMARKS" ascii wide
        $permission_4 = "android.permission.READ_EXTERNAL_STORAGE" ascii wide
        $permission_5 = "android.permission.WRITE_EXTERNAL_STORAGE" ascii wide
        $permission_6 = "android.permission.ACCESS_FINE_LOCATION" ascii wide
        $permission_7 = "android.permission.ACCESS_COARSE_LOCATION" ascii wide
        $permission_8 = "android.permission.RECEIVE_BOOT_COMPLETED" ascii wide
        $permission_9 = "android.permission.READ_CONTACTS" ascii wide
        $permission_10 = "android.permission.READ_CALL_LOG" ascii wide
    condition:
        ($header_xml at 0 or $header_binary at 0) and filesize > 1KB and filesize < 15KB and 2 of ($barbarian_*) and 8 of ($permission_*)
}

rule CrowdStrike_CSIT_19109_02 : android backdoor barbarian berserk_bear infostealer 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects modifications in the DEX file made by the Barbarian Android implant in use by BERSERK BEAR."
        reports = "CSIT-19109"
        version = "201907191526"
        last_modified = "2019-07-19"
        actor = "BERSERK BEAR"
        malware = "Barbarian Android Backdoor"
    strings:
        $header_dex = {64 65 78 0a 30 33 35 00}
        /*
        07 24                move-object     v4, v2
        01 35                move            v5, v3
        07 06                move-object     v6, v0
        01 37                move            v7, v3
        48 06 06 07          get-byte        v6, v6, v7
        07 17                move-object     v7, v1
        01 38                move            v8, v3
        07 19                move-object     v9, v1
        21 99                array-length    v9, v9
        B4 98                rem-int/2addr   v8, v9
        48 07 07 08          aget-byte       v7, v7, v8
        B7 76                xor-int/2addr   v6, v7
        8D 66                int-to-byte     v6, v6
        4F 06 04 05          aput-byte       v6, v4, v5
        D8 03 03 01          add-int/lit8    v3, v3, 1
        28 E8                goto            :12
        */
        $string_decryption = { 07 24 01 35 07 06 01 37 48 06 06 07 07 17 01 38 07 19 21 99 B4 98 48 07 07 08 B7 76 8D 66 4F 06 04 05 D8 03 03 01 28 E8 }
        /*
        70 20 01 07 CB 00       invoke-direct       FileOutputStream-><init>(String)V, v11, v12
        07 A7                   move-object         v7, v10
        13 0A 00 04             const/16            v10, 0x0400
        23 AA 40 03             new-array           v10, v10, [B
        07 A8                   move-object         v8, v10
        07 6A                   move-object         v10, v6
        07 8B                   move-object         v11, v8
        6E 20 0C 07 BA 00       invoke-virtual      InputStream->read([B)I, v10, v11
        0A 0A                   move-result         v10
        02 11 0A 00             move/from16         v17, v10
        02 0A 11 00             move/from16         v10, v17
        02 0B 11 00             move/from16         v11, v17
        01 B9                   move                v9, v11
        12 FB                   const/4             v11, -1
        32 BA 0A 00             if-eq               v10, v11, :200
        */
        $download_file_a = { 70 20 ?? ?? CB 00 07 A7 13 0A 00 04 23 AA ?? ?? 07 A8 07 6A 07 8B 6E 20 ?? ?? BA 00 0A 0A 02 11 0A 00 02 0A 11 00 02 0B 11 00 01 B9 12 FB 32 BA 0A 00 }
        /*
        76 02 1D 60 1F 00       invoke-direct/range FileOutputStream-><init>(String)V, v31 .. v32
        08 0D 1E 00             move-object/from16  v13, v30
        13 1E 00 04             const/16            v30, 0x0400
        02 00 1E 00             move/from16         v0, v30
        23 00 91 0F             new-array           v0, v0, [B
        08 1E 00 00             move-object/from16  v30, v0
        08 0E 1E 00             move-object/from16  v14, v30
        08 1E 0C 00             move-object/from16  v30, v12
        08 1F 0E 00             move-object/from16  v31, v14
        74 02 31 60 1E 00       invoke-virtual/range InputStream->read([B)I, v30 .. v31
        0A 1E                   move-result         v30
        02 28 1E 00             move/from16         v40, v30
        02 1E 28 00             move/from16         v30, v40
        02 1F 28 00             move/from16         v31, v40
        02 0F 1F 00             move/from16         v15, v31
        13 1F FF FF             const/16            v31, -1
        02 00 1E 00             move/from16         v0, v30
        02 01 1F 00             move/from16         v1, v31
        32 10 32 00             if-eq               v0, v1, :910
        */
        $download_file_b = { 76 02 ?? ?? ?? 00 08 0D 1E 00 13 1E 00 04 02 00 1E 00 23 00 91 0F 08 1E 00 00 08 0E 1E 00 08 1E 0C 00 08 1F 0E 00 74 02 ?? ?? ?? 00 0A 1E 02 28 1E 00 02 1E 28 00 02 1F 28 00 02 0F 1F 00 13 1F FF FF 02 00 1E 00 02 01 1F 00 32 10 32 00 }
        /*
        02 16 15 00             move/from16         v22, v21
        13 17 10 00             const/16            v23, 16
        02 00 16 00             move/from16         v0, v22
        02 01 17 00             move/from16         v1, v23
        35 10 11 00             if-ge               v0, v1, :476
        */
        $aes_cbc = { 02 1? 1? 00 13 1? 10 00 02 00 1? 00 02 01 1? 00 35 10 ?? 00 }
    condition:
        ($header_dex at 0) and 1 of ($download_file_*) and $string_decryption and $aes_cbc
}

rule CrowdStrike_Winnti_plugin_strings : rat wicked_panda winnti 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects distinctive strings in Winnti plug-in DLLs"
        version = "201907250744"
        last_modified = "2019-07-25"
        actor = "wicked_panda"
        malware_family = "Winnti"
    strings:
        $pipe1 = "CreatePipe 2 Faild!"
        $pipe2 = ".?AVCPipeClientEventHandler@@"
        $pipe3 = ".?AVCPipeGuestEvent@@"
        $portmap1 = "CreateThread main_proc success"
        $portmap2 = "StartPortMap end."
        $portmap3 = "StartPortMap start."
        $portmap4 = "[PortMap]send to map host"
        $portmap5 = "m_MapSock == INVALID_SOCKET"
        $name1 = "CmdPlusEx64.dll"
        $name2 = "CmdPlus64.dll"
        $name3 = "ListProc64.dll"
        $name4 = "ListService64.dll"
        $name5 = "PortMap64.dll"
        $name6 = "RemoteDesktop64.dll"
        $name7 = "TransPlus64.dll"
    condition:
        filesize<1MB and (all of ($pipe*) or all of ($portmap*) or 1 of ($name*))
}

rule CrowdStrike_CSIT_19201_02 : inetgetsploit shellcode 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Shellcode used with INetGetsploit modified downloader"
        reports = "CSIT-19201"
        version = "202104121357"
        last_modified = "2021-04-12"
        malware_family = "INetGetsploit"
    strings:
        $ = { 60 55 8b ec 83 ec 08 53 56 57 b8 30 13 31 00 2d }
        $ = { cc 55 8b ec 83 ec 14 53 56 8b f1 8b 5e 08 8b 08 }
        $ = { c1 0f b6 4e fe c1 e0 08 0b c2 0f b6 56 05 c1 e0 }
        $ = { 5a 5a 5a 5a ?? ?? ?? ?? 81 ec 90 44 00 00 ff e4 }
    condition:
        3 of them
}

rule CrowdStrike_CSIT_19201_01 : downloader inetgetsploit 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects INetGetSploit, maliciously modified INetGet downloader"
        reports = "CSIT-19201"
        version = "202106081533"
        last_modified = "2021-06-08"
        malware_family = "INetGetSploit"
    strings:
        $mod_jmp_to_shellcode = { 83 ec 10 ff e4 }
        $mod_check_buffer_1 = { 80 7c 24 ?? 60 75 0b 80 7c 24 ?? 3d 75 04 }
        $mod_check_buffer_2 = { 80 bc 24 ?? 00 00 00 55 75 13 0f be 84 24 ?? 00 00 00 3d c3 00 00 00 75 04 }
        $inetget_msg = "FTP support *not* implemented in this version :-("
        $inetget_key = "v3ABpHGT9ydhxUkmN6csWgdJ3phSkrREhg7xQEfP4kWs58CH4FZRN5sFhAqtQ6XY"
    condition:
        uint16(0) == 0x5a4d and
        any of ($inetget_*) and
        any of ($mod_*)
}

rule CrowdStrike_CSA_19722_01 : downloader stardust_chollima 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects STARDUST CHOLLIMA's .NET fake job application downloader"
        reports = "CSA-19722"
        version = "202001292112"
        last_modified = "2020-01-29"
        actor = "STARDUST CHOLLIMA"
    strings:
        $ = "ThreadProc"
        $ = "CreatePDF"
        $ = "SendUrl"
        $ = "Form1"
        $ = "__JOB__" wide
    condition:
        all of them
}

rule CrowdStrike_CSA_19729_01 : goldbrute 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects Gold Brute RDP brute-force tool based on paths and class strings"
        reports = "CSA-19729"
        version = "201906141002"
        last_modified = "2019-06-14"
    strings:
        $ = "rdp/gold/brute"
        $ = "rdp/PacketSniffer.class"
        $ = "rdp/ServerPacketSniffer.class"
    condition:
        all of them
}

rule CrowdStrike_CSIT_19121_01 : ecrime ransomware unpacked vegalocker 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects Vegalocker Ransomware (a.k.a. Jamper, Ghost, Buran)"
        reports = "CSIT-19121"
        version = "201908091624"
        last_modified = "2019-08-09"
        malware_family = "Vegalocker"
    strings:
        // Bignum/RSA libraries
        $3rd_1 = "TInteger" ascii
        $3rd_2 = "TKeyObj" ascii
        $3rd_3 = "TFGInt" ascii
        // Malware class/type names
        $cls_1 = "TExcludeFolders" ascii
        $cls_2 = "TExcludeFiles" ascii
        $cls_3 = "TSearcher" ascii
        $cls_4 = "TPresence" ascii
        $cls_5 = "TReadme" ascii
        $cls_6 = "TNotepad" ascii
        $cls_7 = "TStorm" ascii
        $cls_8 = "TVega" ascii
        // RSA-2048 key decrypt and import
        $code_rsakeyobj = {
        68 00 08 00 00
        8D 45 ??
        E8 ?? ?? ?? ??
        8B 4D ??
        B2 01
        A1 ?? ?? ?? ??
        E8 ?? ?? ?? ??
        8B F0
        89 73 ??
        8D 55 ??
        A1 ?? ?? ?? ??
        E8 ?? ?? ?? ??
        8B 55 ??
        8B 46 ??
        E8 ?? ?? ?? ??
        8D 55 ??
        A1 ?? ?? ?? ??
        E8 ?? ?? ?? ??
        }
        // Generate AES key and IV char-by-char
        $code_aeskeyiv = {
        C7 85 ?? ?? ?? ?? 01 00 00 00
        B8 00 01 00 00
        E8 ?? ?? ?? ??
        8B D0
        8D 85 ?? ?? ?? ??
        E8 ?? ?? ?? ??
        8B 95 ?? ?? ?? ??
        8D 45 ??
        E8 ?? ?? ?? ??
        83 BD ?? ?? ?? ?? 10
        7F ??
        B8 00 01 00 00
        E8 ?? ?? ?? ??
        8B D0
        8D 85 ?? ?? ?? ??
        E8 ?? ?? ?? ??
        8B 95 ?? ?? ?? ??
        8D 45 ??
        E8 ?? ?? ?? ??
        }
        // Adding threads to drive array
        $code_volarray = {
        81 3D ?? ?? ?? ?? 00 02 00 00
        0F 8F ?? ?? ?? ??
        8D 4D ??
        A1 ?? ?? ?? ??
        8B 40 ??
        8B 15 ?? ?? ?? ??
        8B 18
        FF 53 ??
        8B 45 ??
        89 45 ??
        8B 45 ??
        85 C0
        74 ??
        83 E8 04
        8B 00
        }
        // Check knock value for 0x29a (666)
        $code_regknock = {
        8B 55 ??
        8D 4D ??
        B8 01 00 00 80
        E8 ?? ?? ?? ??
        84 C0
        75 ??
        33 C0
        89 45 ??
        81 7D ?? 9A 02 00 00
        75 ??
        33 C0
        }
    condition:
        uint16(0) == 0x5a4d and
        ((1 of ($3rd_*) and
        4 of ($cls_*)) or 3 of ($code_*))
}

rule CrowdStrike_CSIT_19105_01 : banking downloader gozi isfb rm3 vbscript 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects obfuscated VBScript downloader for RM3 Loader"
        reports = "CSIT-19105"
        version = "202106081545"
        last_modified = "2021-06-08"
    strings:
        $s1 = "On Error Resume Next"
        $s2 = /[A-Za-z]{20,28}\=\"\d{2}\"/
        $s3 = /Call [A-Za-z]{20,28}/
        $s4 = /Function [A-Za-z]{20,28}/
    condition:
        all of them
}

// WARNING: This rule will only work with YARA 3
import "pe"
import "math"

rule CrowdStrike_FastDataX_DLL_Packed_01 : adware fastdatax packed 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects the packed DLL component of the FastDataX Adware"
        version = "201906141448"
        last_modified = "2019-06-14"
        malware_family = "FastDataX"
    strings:
        $plauger = "Copyright (c) by P.J. Plauger, licensed by Dinkumware, Ltd. ALL RIGHTS RESERVED." ascii
        // and     ecx, 7FFFFFFFh
        // xor     ecx, eax
        // mov     eax, ecx
        // and     al, 1
        // movzx   eax, al
        // neg     eax
        // sbb     eax, eax
        // shr     ecx, 1
        // and     eax, 9908B0DFh
        // xor     eax, [ebx-0D4Ch]
        // xor     eax, ecx
        $twister1 = { 81 E1 FF FF FF 7F 33 C8 8B C1 24 01 0F B6 C0 F7 D8 1B C0 D1 E9 25 DF B0 08 99 33 83 B4 F2 FF FF 33 C1 }
        // mov     ecx, edx
        // and     cl, 1
        // movzx   ecx, cl
        // neg     ecx
        // sbb     ecx, ecx
        // shr     edx, 1
        // and     ecx, 9908B0DFh
        // xor     ecx, [eax+62Ch]
        $twister2 = { 8B CA 80 E1 01 0F B6 C9 F7 D9 1B C9 D1 EA 81 E1 DF B0 08 99 33 88 2C 06 00 00 }
        // mov     cl, [eax]
        // sub     dl, bl
        // movzx   ecx, cl
        // mov     ????????, ebx
        // inc     ebx
        // xor     dl, [ecx+????????]
        // mov     [eax], dl
        // inc     eax
        // mov     edx, [ebp+??]
        // cmp     eax, esi
        // jb      -1Eh
        // mov     ebx, [ebp+??]
        $old = { 8A 08 2A D3 0F B6 C9 89 1D ?? ?? ?? ?? 43 32 91 ?? ?? ?? ?? 88 10 40 8B 55 ?? 3B C6 72 E2 8B 5D ?? }
    condition:
        $plauger
        and ($twister1 or $twister2 or ($old and uint16(@old + 11) == uint16(@old + 18)))
        and pe.number_of_exports <= 2
        and (pe.exports("DllInstall") or pe.number_of_exports == 1)
        and for any i in (0..pe.number_of_sections-1): (
        pe.sections[i].name == ".text" and 7 < math.entropy(
        pe.sections[i].raw_data_offset,
        pe.sections[i].raw_data_offset + pe.sections[i].raw_data_size)
        )
}

rule CrowdStrike_CSIT_19104_03 : evora lotus_panda rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects strings used to construct file path in LOTUS PANDA payloads"
        reports = "CSIT-19104"
        version = "201907231651"
        last_modified = "2019-07-23"
        actor = "LOTUS PANDA"
        malware_family = "Evora"
    strings:
        $path_part0 = "\\Microsoft" ascii fullword
        $path_part1 = "\\Protect" ascii fullword
        $path_part2 = "\\Internet Explorer\\" ascii fullword
        $name_part1 = "%X.DAT" ascii
        $name_part2 = "%X.dat" ascii
    condition:
        2 of ($path_part*) and
        1 of ($name_part*) and
        filesize < 4MB
}

// WARNING: This rule will only work with YARA 3
import "pe"

rule CrowdStrike_CSIT_19104_04 : evora lotus_panda rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects HMAC testing debug and distinctive export names used by Evora payloads"
        reports = "CSIT-19104"
        version = "201907231651"
        last_modified = "2019-07-23"
        actor = "LOTUS PANDA"
        malware_family = "Evora"
    strings:
        $hmac_test1 = "what do ya want for nothing?"
        $hmac_test2 = "Test With Truncation"
        $winhttp = "WinHttp"
    condition:
        all of them and
        filesize < 1MB and
        (pe.exports("ServiceProvider") or pe.exports("ServiceInstaller"))
}

rule CrowdStrike_CSIT_19104_05 : evora loader lotus_panda 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects Evora config marker string and LZARI compressed PE file"
        reports = "CSIT-19104"
        version = "201907251137"
        last_modified = "2019-07-25"
        actor = "LOTUS PANDA"
        malware_family = "Evora"
    strings:
        $config_marker = /\x00\x00\{[A-Z0-9]{8}\-[A-Z0-9]{8}\}/
        $lzari_pe = { c0 fc 50 51 0f 97 50 fe d9 c1 47 6f ab 63 ef 7d 33 }
    condition:
        all of them
}

rule CrowdStrike_CSIT_19104_06 : elise evora lotus_panda rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects distinctive debug strings in LOTUS PANDA payloads"
        reports = "CSIT-19104"
        version = "201907231651"
        last_modified = "2019-07-23"
        actor = "LOTUS PANDA"
        malware_family = "Evora,Elise"
    strings:
        $ = "0x00, Set Config failed."
        $ = "0x00, set key failed!"
        $ = "0x00, %d"
        $ = "0x00, %s"
        $ = "0x00, %02d-%02d."
        $ = "0x00, Miss Token."
        $ = "0x00, by %s:token[%d] success."
        $ = "0x00, OL failed, s %d."
        $ = "0x06, DT %d."
        $ = "0x01, by config proxy[%d]:%s."
        $ = "0x01, set Param failed!"
        $ = "0x01, TYPE:%s[%d]"
        $ = "0x01, start work."
        $ = "0x01, get list failed."
        $ = "0x01, get list [%d] success."
        $ = "0x01, Update idle info success."
        $ = "0x01, Update idle info failed."
        $ = "0x01, id: %s."
        $ = "0x01, Getting file[%d] context."
        $ = "0x01, Get Context Rate %d."
        $ = "0x01, Get file context failed!"
        $ = "0x01, Get file context success."
        $ = "0x01, Delete file %s success."
        $ = "0x01, finish work."
        $ = "0x01, Client mac not match!"
        $ = "0x01, Recv length not match:%d-%d."
        $ = "0x01, CC failed"
        $ = "0x01, recv %d."
        $ = "0x01, exec %d success."
        $ = "0x01, exec %d failed."
        $ = "0x01, cmd too short"
        $ = "0x01, cmd too long %d"
        $ = "0x01, Illegal length %d"
        $ = "0x01, Modify proxy info:%s"
        $ = "0x01, Set config info failed!"
        $ = "0x01, Test %s,Token[%d] success."
        $ = "0x01, upload file failed!"
        $ = "0x01, upload file [id:%s] success!"
        $ = "0x01, upload file success!"
        $ = "0x01, [getconfig] Open config file failed:%d"
        $ = "0x01, [setconfig] Open file failed:%d"
        $ = "0x00, End."
        $ = "0x01, Dropbox get list failed %d."
        $ = "0x01, Dropbox create folder %s success."
        $ = "0x01, Dropbox Token error."
        $ = "0x01, Twitter Tdle from id:%s."
        $ = "0x01, Dropbox Download file %s failed"
        $ = "0x03, OK: 0x%x."
        $ = "0x03, CS: 0x%x."
        $ = "0x02, OS: 0x%x."
        $ = "0x02, OMP: 0x%x."
        $ = "0x02, SC: 0x%x."
        $ = "0x02, IS ok."
    condition:
        6 of them
}

rule CrowdStrike_CSIT_19104_07 : elise evora lotus_panda rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects distinctive debug strings in LOTUS PANDA payloads"
        reports = "CSIT-19104"
        version = "202012011452"
        last_modified = "2020-12-01"
        actor = "LOTAS PANDA"
        malware_family = "Evora,Elise"
    strings:
        $ = "0x00, %02d-%02d."
        $ = "0x00, %d"
        $ = "0x00, End."
        $ = "0x00, Online failed, sleep %d min."
        $ = "0x00, miss server config."
        $ = "0x01, noffh."
        $ = "0x01, noffhs."
        $ = "0x01, noieh."
        $ = "0x01, noiehs."
        $ = "0x02, get ip data failed."
        $ = "0x02, install svc ok."
        $ = "0x02, ip :%s."
        $ = "0x02, open module path: 0x%x."
        $ = "0x02, open scm: 0x%x."
        $ = "0x02, recv failed 0x%x."
        $ = "0x02, response failed: 0x%x."
        $ = "0x02, send data failed: 0x%x."
        $ = "0x02, send get failed: 0x%x."
        $ = "0x02, send ip data failed: 0x%x."
        $ = "0x02, send post failed: 0x%x."
        $ = "0x02, start svc: 0x%x."
        $ = "0x03, create svc: 0x%x."
        $ = "0x03, open key: 0x%x."
        $ = "0x04, send %d failed."
        $ = "0x04, send %d success."
        $ = "0x04, unknown."
        $ = "0x06, delay %d."
    condition:
        6 of them
}

rule CrowdStrike_CSIT_19104_08 : evora lotus_panda 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects Twitter related debug strings in Evora"
        reports = "CSIT-19104"
        version = "202012011452"
        last_modified = "2020-12-01"
        actor = "LOTUS PANDA"
        malware_family = "evora"
    strings:
        $ = "----0246824681357ACXZabcxyz"
        $ = "Twitter Get Send Buffer Too Short!"
        $ = "Twitter Did You Forget Set Encrypt Key!"
        $ = "Twitter BASE64_Encode1 Failed! - %d"
        $ = "Twitter AES Encrypt Failed"
        $ = "Twitter BASE64_Encode2 Failed! - %d"
        $ = "Twitter Get id_str Failed!"
        $ = "Twitter Get MessageList Failed!"
        $ = "Twitter Get Message Data Failed!"
        $ = "Twitter There Is No Data!"
        $ = "Twitter BASE64_Decode Failed!"
        $ = "Twitter AES Decrypt Failed"
        $ = "Twitter Init Parameters Incorrect!"
        $ = "Twitter Get no directMessage string!"
        $ = "Twitter Get no lpszScreen_name string!"
        $ = "Twitter Send directMessageNew Failed!"
        $ = "Twitter Get directMessageNew Response Failed!"
        $ = "Twitter ErrorInfo: %s!"
        $ = "Twitter Send direct_messageGet Failed!"
        $ = "Twitter Get direct_messageGet Response Failed!"
        $ = "Twitter Missing id_str String!"
        $ = "Twitter Send direct_messagesEventsShow Failed!"
        $ = "Twitter Get direct_messagesEventsShow Response Failed!"
        $ = "Twitter Get Text Data Failed!"
        $ = "Twitter Send StatusUpdate Failed!"
        $ = "Twitter Get StatusUpdate Response Failed!"
    condition:
        filesize<1MB and any of them
}

// WARNING: This rule will only work with YARA 3
import "pe"

rule CrowdStrike_Upatre_Packed : downloader packed upatre 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects packed versions of Upatre Downloader"
        version = "201906210854"
        last_modified = "2019-06-21"
        malware_family = "Upatre"
    strings:
        $pack = {
        8A(44|54|64|74|4C|5C|6C|7C)??FF   // mov ??, [???+???-1]
        C0(C0|C1|C2|C3|C4|C5|C6|C7)0?     // rol ??, ?
        88(44|54|64|74|4C|5C|6C|7C)??FF   // mov [???+???-1], ??
        (83(E8|E9|EA|EB|EC|ED|EF)01|4?)   // sub ???, 1  -- or --  dec ???
        (83(F8|F9|FA|FB|FC|FD|FF)00
        |85(C0|DB|C9|D2|F6|FF|ED|E4))     // cmp ???, 0  -- or -- test ???, ???
        75(E?|F?)                         // jnz short loc_4012C7
        61                                // popa
        C3                                // retn
        }
        $stub = "!This program cannot be run in DOS mode."
        $api1 = "RasFreeEapUserIdentity"
        $api2 = "SHGetSpecialFolderPath"
    condition:
        all of them
        and filesize < 200KB
        and @stub < 0x60
        and pe.number_of_sections >= 4
}

rule CrowdStrike_CSIT_19115_02 : rat skipper venomous_bear 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects VENOMOUS BEAR Skipper malware"
        reports = "CSIT-19115"
        version = "201908131553"
        last_modified = "2019-08-13"
        actor = "VENOMOUS BEAR"
        malware_family = "Skipper"
    strings:
        // CB36580BF69E43458A7F78B9793DC1B3FB65FF320C932D4CF2DB44266A7A6B62 @ 0x100012e0
        $bytes_0x100012e0_0x10001345  = { 39 5c 24 28 75 2b ff 74 24 18 6a 00 68 ?? ?? ?? ?? ff ?? 8b ?? 85 f6 74 12 6a 01 56 ff ?? ?? ?? ?? ?? 56 23 f8 ff ?? ?? ?? ?? ?? 8b ?? ?? ?? ?? ?? 8d 44 24 10 50 ff ?? ?? ?? ff ?? ?? ?? ?? ?? 85 c0 75 bc 53 50 68 ?? ?? ?? ?? ff ?? 8b ?? 85 f6 74 12 6a 01 56 ff 15 ?? ?? ?? ?? 56 23 f8 ff 15 ?? ?? ?? ??  }
    condition:
        $bytes_0x100012e0_0x10001345
}

rule CrowdStrike_CSIT_19140_04 : konni neonate velvet_chollima 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects the victim data collection function found in Neonate and Konni malware in use by VELVET CHOLLIMA and/or SHADOW CRANE."
        reports = "CSIT-19140"
        version = "202001241822"
        last_modified = "2020-01-24"
        actor = "VELVET CHOLLIMA, SHADOW CRANE"
        malware_family = "Neonate, Konni"
    strings:
        $ = "Drive Information is as follow." ascii wide
        $ = "This computer's name is " ascii wide
        $ = "This computer's username is " ascii wide
        $ = "DRIVE_UNKNOWN" ascii wide
        $ = "DRIVE_NO_ROOT_DIR" ascii wide
        $ = "DRIVE_RAMDISK" ascii wide
        $ = "DRIVE_REMOTE" ascii wide
    condition:
        all of them
}

// WARNING: This rule will only work with YARA 3
import "pe"

rule CrowdStrike_CSIT_19189_02 : banker culebra trojan unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects the unpacked Culebra banking trojan DLL."
        reports = "CSIT-19189"
        version = "202012111112"
        last_modified = "2020-12-11"
        malware_family = "Culebra"
    strings:
        $ins_string_decrypt = {
        A1 ?? ?? ?? ??     // mov   eax, KEY_POINTER
        8B00           // mov   eax, [eax]
        8B55??         // mov   edx, [ebp+key_index]
        0FB74450FE     // movzx eax, word ptr [eax+edx*2-2]
        3345??         // xor   eax, [ebp+next_char]
        8945??         // mov   [ebp+decrypted_char], eax
        8B45??         // mov   eax, [ebp+decrypted_char]
        3B45??         // cmp   eax, [ebp+??]
        7F10           // jg    short loc_213C039
        8B45??         // mov   eax, [ebp+decrypted_char]
        05FF000000     // add   eax, 0FFh
        2B45??         // sub   eax, [ebp+??]
        8945??         // mov   [ebp+decrypted_char], eax
        EB06           // jmp   short loc_213C03F
        8B45??         // mov   eax, [ebp+??]
        2945??         // sub   [ebp+decrypted_char], eax
        }
        $ins_keyboard_hook = {
        8B45(E?|F?)    // mov   eax, [ebp+??]
        833828         // cmp   dword ptr [eax], 28h
        74??           // jz    ??
        8B45(E?|F?)    // mov   eax, [ebp+??]
        833826         // cmp   dword ptr [eax], 26h
        74??           // jz    ??
        8B45(E?|F?)    // mov   eax, [ebp+??]
        833824         // cmp   dword ptr [eax], 24h
        74??           // jz    ??
        8B45(E?|F?)    // mov   eax, [ebp+??]
        833823         // cmp   dword ptr [eax], 23h
        7509           // jnz   ??
        }
        $ins_string_encrypt_rand = {
        8B45(D?|E?|F?) // mov   eax, [ebp+??]
        8B55(D?|E?|F?) // mov   edx, [ebp+??]
        0FB74450FE     // movzx eax, word ptr [eax+edx*2-2]
        0345(D?|E?|F?) // add   eax, [ebp+??]
        B9FF000000     // mov   ecx, 0FFh
        99             // cdq
        F7F9           // idiv  ecx
        }
        $ins_string_encrypt_xor = {
        A1????????     // mov   eax, KEY_POINTER
        8B00           // mov   eax, [eax]
        8B55??         // mov   edx, [ebp+??]
        0FB74450FE     // movzx eax, word ptr [eax+edx*2-2]
        3145??         // xor   [ebp+??], eax
        8D45??         // lea   eax, [ebp+??]
        }
        $ins_bitcoin_b58 = {
        8B45(D?|E?|F?) // mov   eax, [ebp+buffer]
        8B00           // mov   eax, [eax]
        8B55(D?|E?|F?) // mov   edx, [ebp+size]
        0FB60410       // movzx eax, byte ptr [eax+edx]
        6BC03A         // imul  eax, 58
        0145(D?|E?|F?) // add   [ebp+checksum], eax
        8B45(D?|E?|F?) // mov   eax, [ebp+checksum]
        25FF000080     // and   eax, 800000FFh
        79??           // jns   short NOALIGN
        48             // dec   eax
        0D00FFFFFF     // or    eax, 0FFFFFF00h
        40             // inc   eax
        }
        $api01 = "UnhookWindowsHookEx"
        $api02 = "SetWindowsHookEx"
        $api03 = "mouse_event"
        $api04 = "keybd_event"
        $api05 = "SHGetFolderPathW"
        $api06 = "VkKeyScan"
        $api07 = "SetClipboardData"
        $api08 = "LoadKeyboardLayout"
        $api09 = "GetKeyNameText"
        $api10 = "ClientToScreen"
        $lib1 = "Chad Z. Hower (Kudzu) and the Indy Pit Crew. All rights reserved." wide
        $lib2 = "Open SSL Support DLL Delphi and C++Builder interface" wide
        $lib3 = /deflate 1\.\d{1,2}\.\d{1,3} Copyright 1995-20[0-5]\d Jean-loup Gailly and Mark Adler/
        $lib4 = /inflate 1\.\d{1,2}\.\d{1,3} Copyright 1995-20[0-5]\d Mark Adler/
    condition:
        3 of ($lib*) and
        2 of ($api*) and
        1 of ($ins*) and
        for any i in (0..pe.number_of_resources-1): (
        uint8(pe.resources[i].offset) == 0x78
        )
}

rule CrowdStrike_CSIT_19115_01 : rat skipper venomous_bear 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects decryption loop for the VENOMOUS BEAR Skipper malware"
        reports = "CSIT-19115"
        version = "201908131554"
        last_modified = "2019-08-13"
        actor = "VENOMOUS BEAR"
        malware_family = "Skipper"
    strings:
        $code_keygen = { 0f b7 c0 99 6a 07 59 f7 f9 8a 06 b1 08 2a ca 88 55 ff 8a d0 d2 }
        $code_rc4_snippet = { 0f b6 c8 0f b6 5c 0c 2c 8d 4c 0c 2c 0f b6 fa 8d
        7c 3c 2c 88 5c 24 13 0f b6 1f 88 19 8a 5c 24 13
        88 1f 0f b6 09 89 7c 24 18 0f b6 fb 03 cf 81 e1
        ff 00 00 80 79 08 49 81 c9 00 ff ff ff 41 0f b6
        c9 8a 4c 0c 2c 32 0c 2e 46 83 6c 24 14 01 88 4e
        ff 75 87 }
        $code_rc4_snippet_new   = { 0F B6 C1 8D 95 FC FE FF FF 03 D0 8B 85 F? FE FF FF 8A 1A 0F B6 C0 8D 8D FC FE FF FF 03 C8 0F B6 01 88 02 88 19 0F B6 0A 0F B6 C3 03 C8 81 E1 FF 00 00 80 79 08 49 81 C9 00 FF FF FF 41 }
        // C72F029126884264BE7D8F0426C2CD8799C908C5A91B25F9D4D3FA4286B0003A @ 0x100017c8
        $code_0x100017c8_0x10001827  = { 8b 8d e0 fe ff ff 83 c1 01 89 8d e0 fe ff ff 8b 95 e0 fe ff ff 3b 55 14 0f 8d f0 00 00 00 8b 85 ec fe ff ff 83 c0 01 25 ff 00 00 80 79 07 48 0d 00 ff ff ff 40 89 85 ec fe ff ff 8b 8d ec fe ff ff 0f b6 94 0d fc fe ff ff 03 95 e4 fe ff ff 81 e2 ff 00 00 80 79 08 4a 81 ca 00 ff ff ff 42 }
        // 437B6848531064A1A0E768DC4709DC634F2B3C8BE9936F6DAF927A7B07262B5F @ 0x100018a0L
        $code_sub_100018A0  = { 55 8b ?? 51 c7 45 fc 00 00 00 00 eb 09 8b ?? ?? 83 ?? ?? 89 45 fc 8b ?? ?? 3b 4d 0c 7d 1f 8b ?? ?? 03 55 fc 0f be 02 8b ?? ?? 0f be 91 88 0e 01 10 33 c2 8b ?? ?? 03 4d fc 88 ?? eb d0 8b ?? 5d c3 }
        // 249B0C43C35497DCD22CE65AB63E6A4D75ECC3751DFD7F5607DAED28EFC4A7 @ 0x100017aa
        $code_0x100017aa_0x100017df  = { 0f b6 d2 8a 84 15 f0 fe ff ff 88 85 ee fe ff ff 8b 4d 10 03 8d dc fe ff ff 0f be 11 0f b6 85 ee fe ff ff 33 d0 8b 4d 18 03 8d dc fe ff ff 88 11 e9 ?? ?? ?? ?? b0 01 }
        // 3EB37EF5395CACA801E00C3F0DEC8718259996ECA538DDAB81B363FF50E0923E @ 0x1800013ddL
        $code_0x1800013ddL_0x1800013f9L  = { 0f b6 ca 49 ff c3 0f b6 14 0c 41 32 54 2b ff 41 88 53 ff 48 ff cb 0f 85 77 ff ff ff }
        // 05C445DFD87D78C117D727B355A60E754FB94C5C36E12037C61324C07A17418A @ 0x1800019f3L
        $code_0x1800019f3L_0x180001a28L  = { 8b 04 24 ff c0 89 04 24 8b 44 24 28 39 04 24 7d 2c 48 63 04 24 48 8b 4c 24 20 0f be 04 01 48 63 0c 24 48 8d 15 ?? ?? ?? ?? 0f be 0c 0a 33 c1 48 63 0c 24 48 8b 54 24 30 88 04 0a eb c3 }
        // 430FBF2130DFB3E4D8BC90C439E0AF52C525492A7B258003B54D0F3FED848986 @ 0x180001a98L
        $code_0x180001a98L_0x180001ad1L  = { 0f b6 84 04 80 00 00 00 88 ?? ?? ?? 48 63 44 24 50 48 8b 8c 24 b0 01 00 00 0f be 04 01 0f b6 4c 24 41 33 c1 48 63 4c 24 50 48 8b 94 24 c0 01 00 00 88 ?? ?? e9 ?? ?? ?? ?? }
    condition:
        any of ($code_*)
}

rule CrowdStrike_CSIT_19115_03 : delivery_document downloader skipper venomous_bear 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects unique strings from a malicious Word document that downloads the VENOMOUS BEAR Skipper malware"
        reports = "CSIT-19115"
        version = "201908131553"
        last_modified = "2019-08-13"
        actor = "VENOMOUS BEAR"
        malware_family = "Skipper"
    strings:
        $doc_header = { D0 CF 11 E0 A1 B1 1A E1 }
        $str_nvshost = "nvshost.exe"
        $str_fDecode = "Bad string passed to fDecode() function."
        $str_enablemac = "EnableMac"
        $str_enablmacvbs = "enablmac.vbs"
        $str_enablmacbat = "enablmacbat.bat"
        $str_ms_nvstemp = "\\Microsoft\\Nvstemp"
    condition:
        $doc_header at 0 and
        (4 of ($str_*))
}

rule CrowdStrike_CSA_19786_01 : labyrinth_chollima manuscrypt rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects key and strings observed in variant of Manuscrypt"
        reports = "CSA-19786"
        version = "201908221336"
        last_modified = "2019-08-22"
        actor = "LABYRINTH CHOLLIMA"
        malware_family = "Manuscrypt"
    strings:
        $key1 = { 27 1a 16 ab }
        $key2 = { 6d 7a 90 0e }
        $key3 = { f3 fa 67 7d }
        $key4 = { ce 8a b2 68 }
        $cookie = "gid=%s%02d%d%03d%s"
    condition:
        all of them
}

rule CrowdStrike_CSIT_19127_01 : ecrime spambot varenyky 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects Varenyky spambot that uses Tor for C2"
        reports = "CSIT-19127"
        version = "201907231633"
        last_modified = "2019-07-23"
    strings:
        $str1 = "DL_EXEC" fullword
        $str2 = "Not available in your country/region!"
        $str3 = "INFO,%s,%s,%d,%d,%d,%d"
        $str4 = "Varenyky.pdb"
        $str5 = "MAIL FROM:<%s>"
        $str6 = "/mail.php"
        $str7 = "/mail_ps.php"
    condition:
        4 of ($str*)
}

rule CrowdStrike_CSIT_19164_01 : novter 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects Novter malware based on characteristic strings"
        reports = "CSIT-19164"
        version = "201909130823"
        last_modified = "2019-09-13"
        malware_family = "Novter"
    strings:
        $ = "%s\\%s.hta"
        $ = "update_interval"
        $ = "Select * From AntiVirusProduct"
        $ = "DisableAntiSpyware"
        $ = "DisableRoutinelyTakingAction"
        $ = "%s /c \"%s\" &exit 1"
        $ = "Global\\CreatorsPatch"
    condition:
        5 of them
}

rule CrowdStrike_CSIT_19135_02 : decryptor ecrime ransomware revil sodinokibi 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects strings in the REvil ransomware decryptor"
        reports = "CSIT-19135"
        version = "201907312016"
        last_modified = "2019-07-31"
        malware_family = "REvil, Sodinokibi"
    strings:
        $ = "REvil" wide
        $ = "Decryptor" wide
        $ = "master_sk"
        $ = "pc-sk"
        $ = "is_ru_speak"
        $ = "!!! IS RU !!!" wide
    condition:
        5 of them
}

rule CrowdStrike_CSA_19806_01 : android riltok 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects strings in Riltok Android malware (APK or DEX file)"
        reports = "CSA-19806"
        version = "201906280845"
        last_modified = "2019-06-28"
        malware_family = "Riltok"
    strings:
        $ = "LoginhintSB"
        $ = "SB_hint_reg"
        $ = "CardHint"
        $ = "DescCaption"
        $ = "pay_size"
        $ = "ohygeztvjm"
        $ = "Register_SB"
        $ = "librealtalk-jni.so"
    condition:
        (uint16(0) == 0x4b50 or uint32(0) == 0x0a786564) and
        5 of them
}

rule CrowdStrike_CSIT_19138_03 : helix_kitten twoface webshell 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "* CrowdStrike_CSIT_19138_03 - Detects webshell used to drop TwoFace payloads in use by HELIX KITTEN."
        reports = "CSIT-19138"
        version = "201908091741"
        last_modified = "2019-08-09"
        actor = "HELIX KITTEN"
        malware_family = "TwoFace"
    strings:
        $ = "System.Security.Cryptography.TripleDESCryptoServiceProvider" wide ascii
        $ = "Request.Form[\"u\"]" wide ascii
        $ = "Request[\"n\"]" wide ascii
        $ = "Request.Unvalidated[\"p\"]" wide ascii
        $ = "<%@ Page Language=\"C#\"" wide ascii
    condition:
        all of them
}

rule CrowdStrike_CSIT_19138_04 : bondupdater glimpse helix_kitten webshell 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects logic used for command parsing of Glimpse webshell in use by HELIX KITTEN."
        reports = "CSIT-19138"
        version = "202001091750"
        last_modified = "2020-01-09"
        actor = "HELIX KITTEN"
        malware_family = "bondupdater"
    strings:
        $ = "[System.Net.Dns]::GetHostAddresses" wide ascii
        $ = "\\Libraries"
        $ = "\\quid"
        $ = "\\lock"
        $ = "\\rcvd"
        $ = "\\files"
        $ = "\\done"
        $ = "\\sendbox"
        $ = "\\receivebox"
        $ = "[0].StartsWith(\"C\")"
        $ = "[0].StartsWith(\"E\")"
        $ = "[0][0] -eq 'S' -and -not"
        $ = "[0] -eq \"S000s\""
        $ = "[0][0] -eq \"N\""
    condition:
        all of them
}

rule CrowdStrike_CSA_19834_01 : artifact cloudstats rat static_kitten 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects encrypted Dropbox credentials stored in CloudSTATS samples"
        reports = "CSA-19834"
        version = "201907050931"
        last_modified = "2019-07-05"
        actor = "STATIC KITTEN"
        malware_family = "CloudSTATS"
    strings:
        $enc_creds_1 = "zZlPvAjcgejyhkfTarHLrFMtvHolw64/30hZUMIe+sSzrARdJZJNAoJzDl0lpDf3fFsjhwy6irMrINfexlv4E7G2WUy8Nzy/uPB/C/wLP9TxUuv7QKxAPSV0dB+iw2YJ"
        $enc_creds_2 = "+aRyOy3rh4c9LcujhSlzsyfGh71jkkNFhv7EbcSVDFqDCwWeClkDuTiq3dMzSXcDG4Rogy9HaLGC1c68e4clgLPiraYlS2YEq8auXGbUTPr5svxqp/aA1AJZAziPqk8Q"
    condition:
        any of them
}

rule CrowdStrike_CSIT_19145_01 : banker danabot scully_spider trojan 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects export function names in the Danabot main module"
        reports = "CSIT-19145"
        version = "201908160943"
        last_modified = "2019-08-16"
        actor = "SCULLY SPIDER"
        malware_family = "Danabot"
    strings:
        $s1 = "ServiceMain"
        $s3 = "f1"
        $s4 = "f2"
        $s5 = "f3"
        $s6 = "f4"
        $s7 = "f5"
        $s8 = "f6"
        $s9 = "f7"
        $s10 = "f8"
        $s11 = "f9"
        $s12 = "MainProc"
    condition:
        uint32(0) == 0x505A4D and
        all of them
}

rule CrowdStrike_CSIT_19121_02 : ecrime infostealer vegalocker 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects clipboard monitor dropped by Decryptor for Vegalocker, Ghost, Buran"
        reports = "CSIT-19121"
        version = "201908091624"
        last_modified = "2019-08-09"
        malware_family = "Vegalocker"
    strings:
        $ = { 04 d0 2c 0a 72 ?? 04 f9 2c 1a 72 ?? 04 fa 2c 1a 73 ?? }
        $ = { 04 d0 2c 0a 73 ?? c6 45 ?? 01 8b 45 ?? 0f b6 44 38 ?? 04 9f 2c 1a 73 ?? c6 45 ?? 01 8b 45 ?? 0f b6 44 38 ?? 04 bf 2c 1a 73 ?? c6 45 ?? 01 }
    condition:
        uint16(0) == 0x5a4d and
        all of them
}

rule CrowdStrike_VENOMOUS_BEAR_neptun_implant : backdoor implant neptun venomous_bear 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Matches on characteristic MSIL code in VENOMOUS BEAR's Neptun implant"
        version = "201908131552"
        last_modified = "2019-08-13"
        actor = "VENOMOUS BEAR"
        malware_family = "Neptun"
    strings:
        // characteristic MSIL bytes found in the UnMark function
        $ = { 00 00 2B 0C 1E 07 58 28 }
    condition:
        // pe binary
        uint16(0) == 0x5A4D and uint32(uint32(0x3c)) == 0x4550 and
        // Mono/.NET 32bit
        ((uint16(uint32(0x3c)+24) == 0x010b and uint32(uint32(0x3c)+232) > 0) or
        // Mono/.NET 64bit
        (uint16(uint32(0x3c)+24) == 0x020b and uint32(uint32(0x3c)+248) > 0))
        and all of them
}

rule CrowdStrike_CSIT_19151_01 : andromut downloader unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Rule to find unpacked AndroMut samples"
        reports = "CSIT-19151"
        version = "201909061325"
        last_modified = "2019-09-06"
        malware_family = "AndroMut"
        
    strings:
        $inst1 = { C1 C9 0D 3C 61 0F BE C0 }
        $inst2 = { C1 CF 0D 03 F8 46 }
        $inst3 = { 32 1E 0F B6 06 80 E3 1F 33 F8 0F B6 CB D3 C7 }
        $s1 = "http://www.google.com" wide fullword
        $s2 = "C:\\Windows \\System32\\ComputerDefaults.exe" ascii fullword
        $s3 = "System32 (C:\\Windows )" wide fullword
        $s4 = "!\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~" wide fullword
    condition:
        2 of ($inst*) and 3 of ($s*)
}

rule CrowdStrike_CSA_19948_01 : decoder iskander 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects variants of the Iskander decoder"
        reports = "CSA-19948"
        version = "201908091622"
        last_modified = "2019-08-09"
        malware_family = "Iskander"
    strings:
        $ = "Release\\iskander.pdb"
        $ = "by P.J. Plauger, licensed by Dinkumware, Ltd. ALL RIGHTS RESERVED."
    condition:
        all of them
}

rule CrowdStrike_CSA_200332_01 : lnk mustang_panda 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects polyglot LNK files which deploy a malicious HTA script in use by MUSTANG PANDA."
        reports = "CSA-200332"
        version = "202003201523"
        last_modified = "2020-03-20"
        actor = "MUSTANG PANDA"
    strings:
        $ = "C:\\Windows\\System32\\cmd.exe"
        $ = "HTA:APPLICATION"
        $ = "dim dom,elm,stm"
    condition:
        all of them
}

rule CrowdStrike_CSIT_19223_01 : datper rat stalker_panda 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects an instance of Datper RAT"
        reports = "CSIT-19223"
        version = "202010072237"
        last_modified = "2020-10-07"
        actor = "STALKER PANDA"
        malware_family = "Datper"
    strings:
        $asc_1 = { 3A 4D 34 33 00 }
        $asc_2 = { 35 6A 32 43 }
        $strlen_asc_1 = { 03 00 00 00 7C 7C 7C 00 }
        $strlen_asc_2 = { 04 00 00 00 5B 7C 2D 5D 00 }
    condition:
        all of ($asc*) and 1 of ($strlen_asc_*) and uint16(0) == 0x5a4d
}

rule CrowdStrike_CSIT_19176_02 : electricfish stardust_chollima 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects strings in TwoPence Electric and ELECTRICFISH tools used by STARDUST CHOLLIMA"
        reports = "CSIT-19176"
        version = "201909271328"
        last_modified = "2019-09-27"
        actor = "STARDUST CHOLLIMA"
        malware_family = "ELECTRICFISH, TwoPence"
    strings:
        $ = "User-Agent:Mozilla/4.0 (compatible; MSIE 5.5; Win32)"
        $ = "Proxy-Authorization: NTLM %s"
    condition:
        all of them and filesize < 2MB
}

rule CrowdStrike_CSIT_19131_01 : doppelpaymer ecrime ransomware 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects the 32bit DoppelPaymer process hacker side loaded stager"
        reports = "CSIT-19131"
        version = "201908091623"
        last_modified = "2019-08-09"
        malware_family = "DoppelPaymer"
    strings:
        // Dridex string decryption
        $rc4_decrypt_asm1 = { e8 ?? ?? ?? ?? 3d 22 04 49 d2 74 ?? }
        $rc4_decrypt_asm2 = { 3d 2c 50 98 75 }
        // Integrity level check
        $d = { 3d 00 10 00 00 ?? ?? 3d 00 21 00 00 ?? ?? 3d 00 20 00 00 ?? ?? 3d 00 30 00 00 ?? ?? 3d 00 40 00 00 }
        // KPH_VERIFYCLIENT IOCTL
        $e = { 07 20 99 99 }
        // KPH_OPENPROCESS IOCTL
        $f = { cb 20 99 99 }
        // KPH_TERMINATEPROCESS IOCTL
        $g = { df 20 99 99 }
    condition:
        all of them
}

rule CrowdStrike_CSIT_19131_02 : doppelpaymer ecrime ransomware 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects the 64bit DoppelPaymer process hacker side loaded stager"
        reports = "CSIT-19131"
        version = "202101042018"
        last_modified = "2021-01-04"
        malware_family = "DoppelPaymer"
    strings:
        // Dridex string decryption 64bit
        $str_enc1 = { e8 ?? ?? ?? ?? 41 89 c0 41 81 f8 22 04 49 d2 }
        $str_enc2 = { 41 81 f8 2c 50 98 75 }
        // Generic dridex strings decrypt
        $str_gen_enc1 = {E8 ?? ?? ?? ?? 3D 22 04 49 D2 74 ??}
        $str_gen_enc2 = {3D 2C 50 98 75}
        // Control codes
        // KPH_VERIFYCLIENT
        $cntl1 = { 07 20 99 99 }
        // KPH_OPENPROCESS
        $cntl2 = { cb 20 99 99 }
        // KPH_TERMINATEPROCESS
        $cntl3 = { df 20 99 99 }
    condition:
        (all of ($cntl*)) and ((all of ($str_enc*)) or (all of ($str_gen_enc*)))
}

rule CrowdStrike_CSA_19914_01 : dropper nokki 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Marker strings used in variant of Nokki observed at news organization"
        reports = "CSA-19914,CSIT-19196"
        version = "201910241301"
        last_modified = "2019-10-24"
        malware_family = "Nokki"
    strings:
        $m1 = "!@#$%^&*())(*&^%$#@!%^$&#*@(!)"
        $m2 = "#$%^&*()#$%^&*(@!#$%^&#^($#@&$"
        $m3 = "45665789wf1wj20945jk#%^&@!78hr"
    condition:
        any of them
}

rule CrowdStrike_LooCipher : ransomware 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects LooCipher ransomware payload."
        version = "201907191530"
        last_modified = "2019-07-19"
        malware_family = "LooCipher Ransomware"
    strings:
        $msg1 = "/! DON'T REMOVE OR ALTER THIS FILE /!"
        $msg2 = "LooCipher Settings"
        $msg3 = "After this period your key will be automatically destroyed"
        $msg4 = "All your important files (including those on the network disks, USBs, etc.)"
        $path1 = "C:\\Users\\Usuario\\Documents\\Proyectos\\sher.lock" nocase
        $path2 = "LooCipher_wallpaper.bmp"
        $path3 = "\\Desktop\\c2056.ini"
        $ini1 = "USER_ID"
        $ini2 = "LIMIT_TIME"
        $ini3 = "BTC_ADDRESS"
    condition:
        uint16(0) == 0x5A4D and filesize > 4MB and
        (all of ($ini*) or
        2 of ($msg*) or
        (1 of ($path*) and 2 of them))
}

rule CrowdStrike_VENOMOUS_BEAR_neptun_dropper : dropper neptun venomous_bear 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Matches on characteristic .NET ID and array name in VENOMOUS BEAR's Neptun dropper"
        version = "201908131552"
        last_modified = "2019-08-13"
        actor = "VENOMOUS BEAR"
        malware_family = "Neptun"
    strings:
        // characteristic MSIL bytes found in the payload's UnMark function
        $ = { 00 00 2B 0C 1E 07 58 28 }
        // characteristic array name
        $ = "Payload" ascii
    condition:
        // pe binary
        uint16(0) == 0x5A4D and uint32(uint32(0x3c)) == 0x4550 and
        // Mono/.NET 32bit
        ((uint16(uint32(0x3c)+24) == 0x010b and uint32(uint32(0x3c)+232) > 0) or
        // Mono/.NET 64bit
        (uint16(uint32(0x3c)+24) == 0x020b and uint32(uint32(0x3c)+248) > 0))
        and all of them
}

rule CrowdStrike_CSIT_19125_01 : dropper exportcontrol silent_chollima 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Decoding code used in variant of ExportControl dropper by SILENT CHOLLIMA"
        reports = "CSIT-19125"
        version = "201907230710"
        last_modified = "2019-07-23"
        actor = "SILENT CHOLLIMA"
        malware_family = "ExportControl"
    strings:
        $code1_forwards = { c1 e9 04 33 c1 c1 e0 18 0b d0 }
        $code1_backwards = { d0 0b 18 e0 c1 c1 33 04 e9 c1 }
        $code2_forwards = { c1 e8 08 23 45 fc 8b 4d fc c1 e9 10 8b 75 fc c1 ee 18 23 ce 33 c1 33 45 f8 8b 4d f8 }
        $code2_backwards = { f8 4d 8b f8 45 33 c1 33 ce 23 18 ee c1 fc 75 8b 10 e9 c1 fc 4d 8b fc 45 23 08 e8 c1 }
    condition:
        any of them
}

rule CrowdStrike_PHPSpy_Webshell : phpspy webshell 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects unobfuscated versions of PHPSpy webshell"
        version = "201907231558"
        last_modified = "2019-07-23"
        malware_family = "PHPSpy"
    strings:
        $s1 = "cf('/tmp/angel_bc'"
        $s2 = "$admin['cookiepre'] = '';"
        $s3 = "$admin['cookiedomain'] = '';"
        $s4 = "if ($doing == 'downfile' && $thefile) {"
        $s5 = "DROP TABLE tmp_angel"
    condition:
        all of them
}

rule CrowdStrike_SharPy_Webshell_01 : sharpy webshell 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule is used to detect variants of the openly-available SharPy webshell"
        version = "201907231723"
        last_modified = "2019-07-23"
        malware_family = "SharPy Webshell"
    strings:
        $pass = "string p ="
        $r = "string r = Request.Form[\"data\"];"
        $byte = "byte[] a ="
        $xor = "a[i] ^= (byte)p[i % p.Length]"
        $instance = "as.CreateInstance("
    condition:
        4 of them
}

rule CrowdStrike_SharPy_Webshell_02 : isi6055 sharpy webshell 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule looks for a compiled version of the SharPy webshell"
        version = "201907231823"
        last_modified = "2019-07-23"
        malware_family = "SharPy Webshell"
    strings:
        $sharpy = "\x00SharPy\x00"
        $runtime_aes = "runtime_compiler_aes"
        $sharpyshell = "SharPyShell" wide
        $sharpyerror = "SharPyShellError" wide
    condition:
        3 of them
}

rule CrowdStrike_LOTUS_PANDA_Exploit_Document : delivery_document elise lotus_panda 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects encoded mutex name in LOTUS PANDA exploit documents"
        version = "201907251051"
        last_modified = "2019-07-25"
        actor = "LOTUS PANDA"
        malware_family = "Elise"
    strings:
        $package = "objclass Package"
        $encoded_mutex_name = "5f4d4943524f534f46545f4c4f414445525f4d555445585f"
        $a_b_package_name = "612e6200433a5c55736572735c"
    condition:
        uint32(0)==0x74725c7b and
        $package and
        ($encoded_mutex_name or $a_b_package_name)
}

rule CrowdStrike_CSIT_19166_01 : blueprint venomous_bear 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects bubble sort code used to sort rule metrics in the VENOMOUS BEAR Blueprint malware"
        reports = "CSIT-19166"
        version = "201910041454"
        last_modified = "2019-10-04"
        actor = "VENOMOUS BEAR"
        malware_family = "Blueprint"
    strings:
        $sort_code  = { 48 89 54 24 10 48 89 4c 24 08 56 57 48 81 ec 98 00 00 00 48 c7 44 24 20 00 00 00 00 48 c7 44 24 28 00 00 00 00 c7 44 24 30 00 00 00 00 48 83 bc 24 b0 00 00 00 00 74 19 48 83 bc 24 b8 00 00 00 00 74 0e 48 8b 84 24 b0 00 00 00 83 ?? ?? ?? 73 05 e9 ?? ?? ?? ?? 48 8b 84 24 b0 00 00 00 48 89 44 24 20 48 8b 44 24 20 48 8b 40 18 48 89 44 24 28 48 8b 84 24 b0 00 00 00 8b ?? ?? 39 ?? ?? ?? 0f 83 eb 00 00 00 48 8d 7c 24 60 48 8b 74 24 28 b9 10 00 00 00 f3 a4 48 8d 7c 24 50 48 8b 74 24 20 b9 10 00 00 00 f3 a4 48 8d 54 24 60 48 8d 4c 24 50 ff ?? ?? ?? ?? ?? ?? 85 c0 74 65 48 8d bc 24 80 00 00 00 48 8b 74 24 20 b9 10 00 00 00 f3 a4 48 8d 7c 24 38 48 8d b4 24 80 00 00 00 b9 10 00 00 00 f3 a4 48 8d 7c 24 70 48 8b 74 24 28 b9 10 00 00 00 f3 a4 48 8d 74 24 70 48 8b 7c 24 20 b9 10 00 00 00 f3 a4 48 8d 74 24 38 48 8b 7c 24 28 b9 10 00 00 00 f3 a4 c7 44 24 30 00 00 00 00 eb 0b 8b ?? ?? ?? 83 ?? ?? 89 44 24 30 48 8b 44 24 28 48 89 44 24 20 48 8b 44 24 28 48 8b 40 18 48 89 44 24 28 48 8b 84 24 b0 00 00 00 48 39 44 24 28 75 18 48 8b 44 24 28 48 89 44 24 20 48 8b 44 24 28 48 8b 40 18 48 89 44 24 28 e9 ?? ?? ?? ?? 48 81 c4 98 00 00 00 5f 5e c3 }
    condition:
        $sort_code
}

rule CrowdStrike_CSIT_19140_02 : infostealer neonate velvet_chollima 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "* CrowdStrike_CSIT_19140_02  - Detects components of the VELVET CHOLLIMA Neonate implant."
        reports = "CSIT-19140"
        version = "202001241822"
        last_modified = "2020-01-24"
        actor = "VELVET CHOLLIMA"
        malware_family = "Neonate"
    strings:
        $url = "URL="
        $pass = "PASS="
        $rorhash = {40 C1 C8 0D 41 03 C7 3B CA 72 F1}
        $api1 = "GetClipboardData"
        $api2 = "IsClipboardFormatAvailable"
    condition:
        all of them
}

rule CrowdStrike_CSIT_19140_01 : downloader neonate velvet_chollima 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "* CrowdStrike_CSIT_19140_01 - Detects filenames used by Neonate downloader in use by VELVET CHOLLIMA."
        reports = "CSIT-19140"
        version = "202001241822"
        last_modified = "2020-01-24"
        actor = "VELVET CHOLLIMA"
        malware_family = "Neonate"
    strings:
        $ = "update.ca"
        $ = "update.tmp"
        $ = "micr.tmp"
        $ = "micr.tmp64"
        $ = "sys32.tmp"
        $ = "sys32.msi"
        $ = "sys64.tmp"
        $ = "sys64.msi"
        $ = "store.sys"
    condition:
        4 of them
}

rule CrowdStrike_CSA_19895_01 : kitten sqlshred wiper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects SQLShred wiper"
        reports = "CSA-19895,CSIT-20010"
        version = "202006261351"
        last_modified = "2020-06-26"
        malware_family = "sqlshred"
    strings:
        $path1 = "\\Windows\\System32\\net.exe" wide
        $path2 = "\\\\.\\PhysicalDrive"
        // DeviceIoControl(v2, IOCTL_DISK_DELETE_DRIVE_LAYOUT, 0, 0, &OutBuffer, 0xC0u, &BytesReturned, 0);
        $ioctl = { 5? 8d ?? ?? ?? ?? ?? 5? 68 c0 00 00 00 8d ?? ?? ?? ?? ?? 5? 5? 5? 68 00 c1 07 00 56 ff 15 }
    condition:
        $ioctl and
        all of ($path*)
}

rule CrowdStrike_CSA_19943_01 : mythic_leopard usbstealer waizsar 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects the USBStealer component associated with Waizsar RAT"
        reports = "CSA-19943"
        version = "201911222113"
        last_modified = "2019-11-22"
        actor = "MYTHIC LEOPARD"
        malware_family = "Waiszar"
    strings:
        $a1 = ".pdf>.doc>.docx>.xls>.xlsx>.ppt>.pptx>.pps>.ppsx>.txt>" wide
        $a2 = "get_mpath"
        $a3 = "usb"
        $a4 = "GetDrives"
        $a5 = "DriveInfo"
    condition:
        all of them and uint16(0) == 0x5a4d
}

rule CrowdStrike_Behinder_Webshell : aspx behinder webshell 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects Behinder ASP.NET webshell"
        version = "201908091621"
        last_modified = "2019-08-09"
        malware_family = "Behinder Webshell"
    strings:
        $all1 = "Request[\"page\"]" ascii wide
        $all2 = "Request[\"pass\"]" ascii wide
        $all3 = "Session.Add(\"k\"" ascii wide
        $any1 = "Assembly.Load(new System.Security.Cryptography.RijndaelManaged().CreateDecryptor" ascii wide
    condition:
        all of ($all*) or any of ($any*)
}

rule CrowdStrike_CSIT_19132_01 : azorult ecrime infostealer 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects strings in unpacked versions of Azorult++"
        reports = "CSIT-19132"
        version = "202002251654"
        last_modified = "2020-02-25"
        malware_family = "Azorult++"
    strings:
        $ = "\\azorult_new\\Release\\azorult_new.pdb"
        $ = "Login Data" wide
        $ = "Cookies" wide
        $ = "Web Data" wide
        $ = "wallet.dat" wide
    condition:
        all of them
}

rule CrowdStrike_CSIT_19136_02 : checkmate kitten 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects timestamp data used by Checkmate Dropper"
        reports = "CSIT-19136"
        version = "201912051742"
        last_modified = "2019-12-05"
        malware_family = "Checkmate"
    strings:
        // Thu Feb 28 20:21:11 UTC 2047
        $ = { 4c 01 03 00 37 1f 23 91 }
        // Wed Aug 28 14:58:28 UTC 2080
        $ = { 4c 01 03 00 14 f4 24 d0 }
        // Thu Mar 25 19:19:16 UTC 2066
        $ = { 4c 01 03 00 34 70 01 b5 }
    condition:
        any of them
}

rule CrowdStrike_CSIT_19136_03 : checkmate kitten 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects hardcoded directories used by Checkmate malware"
        reports = "CSIT-19136"
        version = "201911061449"
        last_modified = "2019-11-06"
        malware_family = "Checkmate"
    strings:
        $ = "5ass2c50-5424-4fd8-8c91-b6cb58d0e615" wide ascii
        $ = "f0574caa-749d-4a01-bbcd-0ca5d5a5cd83" wide ascii
    condition:
        any of them
}

rule CrowdStrike_PhoenixKeylogger : ecrime keylogger phoenix 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects Phoenix Keylogger"
        reports = "CSA-191479"
        version = "201912061947"
        last_modified = "2019-12-06"
    strings:
        // .NET id
        $net = { 00 00 00 00 5F 43 6F 72 45 78 65 4D 61 69 6E 00 6D 73 63 6F 72 65 65 2E 64 6C 6C 00 00 00 00 00 FF 25 }
        // Keylogger strings
        $s1 = "Chrome" wide
        $s2 = "Opera" wide
        $s3 = "FileZilla" wide
        $s4 = "OutLook" wide
        $s5 = "Phoenix Keylogger" wide
        $s6 = "Screenshot" wide
        $s7 = "Clipboard" wide
        $s8 = "Passwords" wide
        // log message strings
        $m1 = "+------------- Client INFO -------------+" wide
        $m2 = "|------- Phoenix Keylogger - Passwords -------|" wide
        $m3 = "|------- Phoenix Keylogger - Logs -------|" wide
        $m4 = "|------- Phoenix Keylogger - Clipboard -------|" wide
        $m5 = "|------- Phoenix Keylogger - Screenshot -------|" wide
    condition:
        $net and all of ($s*) and 1 of ($m*) and filesize < 20MB
}

rule CrowdStrike_CSIT_19136_01 : checkmate kitten 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects Machine Name and User Name used to develop Checkmate Malware"
        reports = "CSIT-19136"
        version = "201910231632"
        last_modified = "2019-10-23"
        malware_family = "Checkmate"
    strings:
        $ = { 00 44 00 45 00 53 00 4b 00 54 00 4f 00 50 00 2d 00 39 00 4c 00 46 00 30 00 32 00 35 00 36 00 5c 00 73 00 69 00 6e }
        $ = "DESKTOP-9LF0256\\sin" wide ascii
        $ = "DESKTOP-9LF0256" wide ascii
    condition:
        any of them
}

rule CrowdStrike_CSIT_19138_01 : helix_kitten hypershell webshell 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects HELIX KITTEN HyperShell through characteristic strings"
        reports = "CSIT-19138"
        version = "201908291516"
        last_modified = "2019-08-29"
        actor = "HELIX KITTEN"
        malware_family = "HyperShell"
    strings:
        $ = "auth"
        $ = "command"
        $ = "upload"
        $ = "uploadbase64"
        $ = "delete"
        $ = "changeTime"
        $ = "sqlQuery"
        $ = "explorer"
        $ = "getsize"
        $ = "getlocation"
        $ = "rename"
        $ = "copy"
        $ = "view"
        $ = "commandAjax"
        $ = "checkModules"
        $ = "installModule"
        $ = "uninstallModule"
        $ = "cmd7z"
        $ = "authAjax"
        $ = "getlocationAjax"
        $ = "spycheck"
        $ = "localExplore"
        $ = "getIPFromNbt"
        $ = "GetLogicDrives"
        $ = "NetworkDownloaderCheck"
        $ = "NetworkDownloaderLog"
        $ = "NetworkDownloaderError"
        $ = "NetworkDownloaderDone"
        $ = "NetworkDownloaderDir"
        $ = "SaveLog"
    condition:
        all of them
}

// WARNING: This rule will only work with YARA 3
import "pe"

rule CrowdStrike_Grenam_01 : grenam virus 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects the Grenam file spreading virus"
        version = "201908141229"
        last_modified = "2019-08-14"
        malware_family = "Grenam"
    strings:
        $d01 = "This program must be run under Win32"
        $d02 = "TJPEGImage"
        $d11 = "SHGetSpecialFolderLocation"
        $d12 = "ExtractIcon"
        $d13 = "UpdateResource"
        $d14 = "FindFirstFile"
        $g_marker = " I am Sorry !!!!! " ascii
        // part of the file infection routine
        // ----------------------------------
        // mov     eax, [esi+6]
        // mov     [edi+6], eax
        // mov     eax, [esi+0Ah]
        // mov     [edi+0Ah], eax
        // mov     eax, [esi+0Eh]
        // mov     [edi+0Eh], eax
        // mov     word ptr [edi+12h], 1
        // mov     eax, [esi+0Eh]
        // ----------------------------------
        $g_code_01 = { 8B4606 894706 8B460A 89470A 8B460E 89470E 66C747120100 8B460E }
        // part of the image altering routine
        // ----------------------------------
        // sub     [ebp+rc.bottom], 19h
        // push    28h
        // lea     eax, [ebp+rc]
        // push    eax
        // push    0FFFFFFFFh
        // push    offset chText
        // mov     eax, ebx
        // call    TCanvas_GetHandle
        // push    eax
        // call    user32_DrawTextA
        // ----------------------------------
        $g_code_02 = { 836D??19 6A28 8D45?? 50 6AFF 68???????? 8BC3 E8???????? 50 E8 }
    condition:
        all of ($d*) and 2 of ($g*) and filesize < 1MB
        and pe.imports("shell32.dll", "SHGetSpecialFolderLocation")
        and (pe.imports("shell32.dll", "ExtractIconA") or pe.imports("shell32.dll", "ExtractIconW"))
        and (pe.imports("kernel32.dll", "UpdateResourceA") or pe.imports("kernel32.dll", "UpdateResourceW"))
        and (pe.imports("kernel32.dll", "FindFirstFileA") or pe.imports("kernel32.dll", "FindFirstFileW"))
        and (pe.imports("user32.dll", "DrawTextA") or pe.imports("user32.dll", "DrawTextW"))
}

rule CrowdStrike_Bloodhound_SharpHound_PS1 : bloodhound powershell reconnaissance 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects the PowerShell wrapper for SharpHound, the reconnaissance implant of the Bloodhound network mapping tool."
        version = "201908091620"
        last_modified = "2019-08-09"
        malware_family = "BloodHound"
    strings:
        $ = "$Assembly.GetType(\"Sharphound2.Sharphound\").GetMethod(\"InvokeBloodHound\")"
        $ = "function Invoke-BloodHound"
        $ = "Runs the BloodHound C# Ingestor using reflection."
    condition:
        any of them
}

rule CrowdStrike_Bloodhound_SharpHound : bloodhound reconnaissance 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects SharpHound, the reconnaissance implant of the Bloodhound network mapping tool."
        version = "201908091620"
        last_modified = "2019-08-09"
        malware_family = "BloodHound"
    strings:
        $str1 = "DUMMYSTRINGSHOULDNOTMATCH" wide fullword
        $str2 = "Filename for the BloodHound database to write to disk" wide
        $str3 = "Usage: SharpHound.exe <options>" wide fullword
        $str4 = "Use stealth collection options" wide fullword
        $bh1 = "The BloodHound C# Ingestor" ascii
        $bh2 = "InvokeBloodHound" ascii
        $bh3 = /Sharp[Hh]ound/
    condition:
        (2 of ($bh*) and 2 of ($str*)) or (4 of them and filesize < 1MB)
}

rule CrowdStrike_CSA_19964_01 : android luckyseven ransomware 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects a characteristic byte sequence of an image used in LuckySeven ransomware APKs"
        reports = "CSA-19964"
        version = "201908091819"
        last_modified = "2019-08-09"
        malware = "Lucky Seven"
    strings:
        $ = { 8e 6c 70 d4 68 d8 30 64 }
    condition:
        all of them
}

rule CrowdStrike_CSIT_19136_04 : checkmate kitten 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects VMware version and thinapp licenses used to delivery Checkmate malware"
        reports = "CSIT-19136"
        version = "201912031810"
        last_modified = "2019-12-03"
        malware_family = "Checkmate"
    strings:
        $version = "5.2.4-9964600" wide ascii
        $license_1 = "Talent Acquisition" wide ascii
        $license_2 = "Funny Chess" wide ascii
        $license_3 = "Audio Book" wide ascii
        $mz = { 4d 5a }
    condition:
        $mz at 0 and $version and any of ($license_*)
}

rule CrowdStrike_CSIT_19140_03 : neonate velvet_chollima 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects the export names used by the VELVET CHOLLIMA Neonate implant"
        reports = "CSIT-19140"
        version = "202001241823"
        last_modified = "2020-01-24"
        actor = "VELVET CHOLLIMA"
        malware_family = "Neonate"
    strings:
        $ = "ChildStart"
        $ = "PDFShow"
        $ = "ShellExploit"
    condition:
        all of them
}

rule CrowdStrike_CSIT_19136_05 : checkmate kitten 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects Checkmate decoy application reflective loading of downloader"
        reports = "CSIT-19136"
        version = "202103102113"
        last_modified = "2021-03-10"
        malware_family = "Checkmate"
    strings:
        /*
        Assembly.Load(File.ReadAllBytes(Path.Combine(Path.GetDirectoryName(Assembly.GetAssembly(base.GetType()).Location), "version.dat"))).GetType("Updater").GetMethod("Check").Invoke(null, new object[0]);
        */
        $a_1 = {
        02 28 ?? 00 00 0a 28 ?? 00 00 0a 6f ?? 00 00 0a
        28 ?? 00 00 0a 72 ?? ?? 00 70 28 ?? 00 00 0a 28
        ?? 00 00 0a 28 ?? 00 00 0a 72 ?? ?? 00 70 6f ??
        00 00 0a 72 ?? ?? 00 70 6f ?? 00 00 0a 14 16 8d
        ?? 00 00 01 6f ?? 00 00 0a 26 de 03
        }
        /*
        Assembly.Load(array).GetType("Updater").GetMethod("Check").Invoke(null, new object[0]);
        */
        $a_2 = {
        28 ?? 00 00 0a 72 ?? ?? 00 70 6f ??
        00 00 0a 72 ?? ?? 00 70 6f ?? 00 00
        0a 14 16 8d ?? 00 00 01 6f ?? 00 00
        0a 26 de 03
        }
        $b_1 = "Updater\x00"
        $b_2 = "Check\x00"
        $b_3 = "GetType\x00"
        $b_4 = "GetMethod\x00"
        $b_5 = "Invoke\x00"
        $c_1 = "NewtonsoftJson.dll" wide ascii
        $c_2 = "version.dat" wide ascii
    condition:
        uint16(0) == 0x5a4d and $a_1 or ($a_2 and all of ($b_*) and any of ($c_*))
}

rule CrowdStrike_CSIT_19136_06 : checkmate kitten 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects Checkmate downloader application reflective loading of malware"
        reports = "CSIT-19136"
        version = "202105031552"
        last_modified = "2021-05-03"
        malware_family = "Checkmate"
    strings:
        /*
        [*] Example 1
        Assembly.Load(memoryStream2.ToArray()).GetType(string.Format("{0}.{1}", 'A', 'B')).GetMethod(string.Format("{0}", 'D')).Invoke(null, new object[]{array2,array4,100,100,5000,array3,8});
        [*] Example 2
        Type type = assembly..GetType(string.Format("{0}.{1}", 'A', 'B'));
        MethodInfo method = type.GetMethod(string.Format("{0}", 'D'))
        */
        $a_1 = {
        72 01 00 00 70 1f 41 8c  ?? 00 00 01 1f 42 8c ??
        00 00 01 28 ?? 00 00 0a  6f ?? 00 00 0a
        }
        $a_2 = {
        72 11 00 00 70 1f 44 8c  ?? 00 00 01 28 ?? 00 00
        0a 6f ?? 00 00 0a
        }
        $b_1 = "\x00Load\x00"
        $b_2 = "\x00Format\x00"
        $b_3 = "\x00GetType\x00"
        $b_4 = "\x00GetMethod\x00"
        $b_5 = "\x00Invoke\x00"
        $b_6 = "\x00A\x00"
        $b_7 = "\x00B\x00"
        $b_8 = "\x00D\x00"
    condition:
        uint16(0) == 0x5a4d and all of ($b_*) and any of ($a_*)
}

rule CrowdStrike_CSIT_19136_07 : checkmate kitten 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects Base64 used to encode configuration used for Checkmate downloader and malware"
        reports = "CSIT-19136"
        version = "202103101801"
        last_modified = "2021-03-10"
        malware_family = "Checkmate"
    strings:
        //#256000|256000|1024
        $ = "IzI1NjAwMHwyNTYwMDB8MTAyN" wide ascii
        $ = "jMjU2MDAwfDI1NjAwMHwxMDI" wide ascii
        $ = "MyNTYwMDB8MjU2MDAwfDEwMj" wide ascii
        //#256000|1024|256000
        $ = "IzI1NjAwMHwxMDI0fDI1NjAwM" wide ascii
        $ = "jMjU2MDAwfDEwMjR8MjU2MDA" wide ascii
        $ = "MyNTYwMDB8MTAyNHwyNTYwMD" wide ascii
        //#1024|256000|256000
        $ = "IzEwMjR8MjU2MDAwfDI1NjAwM" wide ascii
        $ = "jMTAyNHwyNTYwMDB8MjU2MDA" wide ascii
        $ = "MxMDI0fDI1NjAwMHwyNTYwMD" wide ascii
    condition:
        any of them
}

rule CrowdStrike_CSIT_19136_08 : checkmate kitten 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects .NET TYPELIB ID values used to compile Checkmate related binaries"
        reports = "CSIT-19136"
        version = "202103102114"
        last_modified = "2021-03-10"
        malware_family = "Checkmate"
    strings:
        $ = "7497460f-c18e-4226-84cc-e3511516b072" wide ascii
        $ = "b5d764e1-de8b-4cf8-a7e7-933b7e4317bf" wide ascii
        $ = "3094d7e6-e31c-41eb-b2e6-3281407310d4" wide ascii
        $ = "688f411c-fb32-41c1-afdd-e31686efd19a" wide ascii
        $ = "24817610-f491-40be-a847-13fcdd95b3ab" wide ascii
        $ = "657e402a-3a33-4e42-a4f1-3cd8030c0c73" wide ascii
    condition:
        any of them
}

rule CrowdStrike_CSIT_19136_09 : checkmate kitten 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects class name strings used for Checkmate malware"
        reports = "CSIT-19136"
        version = "201911070148"
        last_modified = "2019-11-07"
        malware_family = "Checkmate"
    strings:
        $ = "C5.Client.dll" wide ascii
        $ = "FileDownloadManager" wide ascii
        $ = "FileUploadManager" wide ascii
        $ = "PersistenceManager" wide ascii
        $ = "ShellManager" wide ascii
        $ = "InfoManager" wide ascii
        $ = "ExplorerManager" wide ascii
        $ = "RemoteViewerManager" wide ascii
        $ = "FilePropertiesManager" wide ascii
        $ = "FileCompressManager" wide ascii
    condition:
        7 of them
}

rule CrowdStrike_CSIT_19136_10 : checkmate kitten 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects name and base64 used for Checkmate downloader"
        reports = "CSIT-19136"
        version = "201911070149"
        last_modified = "2019-11-07"
        malware_family = "Checkmate"
    strings:
        $b64 = "aHR0" wide ascii
        $name = "C5.Client.Luncher" wide ascii
    condition:
        $b64 and #name > 5
}

rule CrowdStrike_CSIT_19144_01 : backdoor ecrime infostealer proxyws 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects ProxyWS Apache backdoor based on characteristic APIs, filenames and cookies"
        reports = "CSIT-19144"
        version = "202101291826"
        last_modified = "2021-01-29"
        malware_family = "ProxyWS"
    strings:
        $key_setup = {C6 44 24 ?? 00 C6 44 24 ?? 31 C6 44 24 ?? 33 C6 04 24 31 C6 44 24 ?? 32 C6 44 24 ?? 7A C6 44 24 ?? 36 C6 44 24 ?? 33 C6 44 24 ?? 78 C6 44 24 ?? 35 C6 44 24 ?? 7A C6 44 24 ?? 7A C6 44 24 ?? 78 C6 44 24 ?? 30 C6 44 24 ?? 32}
        $filename = "mod_proxy_ws.c"
        $cookie = "R7N777C66DTJNIKZRPCQPUM9ZDTRQE3O0005"
        $logfile = "hsperfdata"
        $import1 = "ap_add_input_filter"
        $import2 = "apr_file_open"
        $import3 = "ap_get_brigade"
        $import4 = "ap_rwrite"
    condition:
        $key_setup or
        $filename or
        $cookie or
        ($logfile and all of ($import*))
}

rule CrowdStrike_CSIT_19143_01 : anubis bankbot dex downloader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects .dex files from BankBot Anubis Downloader APKs"
        reports = "CSIT-19143"
        version = "201908091733"
        last_modified = "2019-08-09"
        malware_family = "BankBot Anubis"
    strings:
        $ = "operation=statusinstall&data="
        $ = "operation=registration&data="
        $ = "operation=checkpanel&data=0"
        $ = "urlDownloadApp" fullword
        $ = "fileMd5" fullword
        $ = "-------------------checkAdminPanel-------------------"
        $ = "(checkbot)Response:"
    condition:
        5 of them
}

rule CrowdStrike_Ostap_RedSparrow : downloader ostap 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects the RedSparrow variant of Ostap."
        version = "201908291827"
        last_modified = "2019-08-29"
        malware_family = "Ostap"
    strings:
        $t1 = "[1]-spa-"
        $t2 = "[0],'a');}} return "
        $u1 = "+'Str1')['index'+'Of']('1')>-1 && "
        $u2 = "+(function(){var spa=0;  var  "
    condition:
        #t1 > 10 and #t2 > 10 and any of ($u*)
}

rule CrowdStrike_CSA_191000_01 : nimbus ricochet_chollima 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects magic bytes used to identify malicious shellcode in fake images"
        reports = "CSA-191000"
        version = "201908221333"
        last_modified = "2019-08-22"
        actor = "RICOCHET CHOLLIMA"
        malware_family = "Nimbus"
    strings:
        $ = {55 AE 55 AE}
        $ = {4A 50 47 45}
        $ = {33 48 D3 38}
    condition:
        all of them and filesize < 3MB
}

rule CrowdStrike_CSA_191000_02 : ricochet_chollima 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects strings found in the DEX file of the fake image viewer for Android"
        reports = "CSA-191000"
        version = "202004031930"
        last_modified = "2020-04-03"
        actor = "RICOCHET CHOLLIMA"
    strings:
        $ = "DBX_TOKEN"
        $ = "CMD_KEY"
        $ = "YDX_TOKEN"
        $ = "cloudManager"
        $ = "cryptManager"
    condition:
        3 of them
}

rule CrowdStrike_OneSentence_WebShell : aspx onesentence webshell 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects the OneSentence web shell"
        version = "201908160940"
        last_modified = "2019-08-16"
        malware_family = "OneSentence"
    strings:
        $ = "function popup("
        $ = "var b = eval("
        $ = "<script runat=\"server\" language=\"JScript\">" ascii
        $ = "popup(popup(System.Text.Encoding"
        $ = "System.Convert.FromBase64String"
    condition:
        2 of them and filesize < 1KB
}

rule CrowdStrike_CSA_191015_01 : baby_shark delivery_document velvet_chollima 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule matches on decompressed delivery documents used by VELVET CHOLLIMA to deploy the Baby Shark malware"
        reports = "CSA-191015"
        version = "202010151506"
        last_modified = "2020-10-15"
        actor = "VELVET CHOLLIMA"
        malware_family = "Baby Shark"
    strings:
        $select_running = { 53 65 6c 65 63 74 20 2a 20 66 72 6f 6d 20 57 69 6e 33 32 5f 53 65 72 76 69 63 65 20 57 48 45 52 45 20 73 74 61 74 65 20 3d 20 22 52 75 6e 6e 69 6e 67 22 }
    condition:
        $select_running
}

rule CrowdStrike_CSA_191010_01 : badnews quilted_tiger rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Identifies Badnews malware from distinctive file names, path segments and strings"
        reports = "CSA-191010"
        version = "202004072138"
        last_modified = "2020-04-07"
        actor = "QUILTED TIGER"
        malware_family = "Badnews"
    strings:
        $file_name_1 = "TPX498.dat"
        $file_name_2 = "TPX499.dat"
        $file_name_3 = "edg499.dat" // list of files to exfiltrate
        $file_name_4 = "AdbFle.tmp"
        $file_name_5 = "9PT568.dat" // contains infection ID
        $path_segment_1 = "&crc=e3a6"
        $path_segment_2 = "//e3e7e71a0b28b5e96cc492e636722f73//4sVKAOvu3D//ABDYot0NxyG.php"
    condition:
        any of ($file_name_*) and any of ($path_segment_*)
}

// WARNING: This rule will only work with YARA 3
import "pe"

rule CrowdStrike_Grenam_02 : grenam virus 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects the Grenam file infecting virus"
        version = "201908160941"
        last_modified = "2019-08-16"
        malware_family = "Grenam"
    strings:
        $d01 = "This program must be run under Win32"
        $d02 = "FastMM Borland Edition (c) 2004 - 2008 Pierre le Riche / Professional Software Development"
        $d11 = "SHGetSpecialFolderLocation"
        $d12 = "ExtractIcon"
        $d13 = "UpdateResource"
        $d14 = "FindFirstFile"
        // part of the file infection routine
        // ----------------------------------
        // mov     eax, [esi+6]
        // mov     [edi+6], eax
        // mov     eax, [esi+0Ah]
        // mov     [edi+0Ah], eax
        // mov     eax, [esi+0Eh]
        // mov     [edi+0Eh], eax
        // mov     word ptr [edi+12h], 1
        // mov     eax, [esi+0Eh]
        // ----------------------------------
        $gcode = { 8b 46 06 89 47 06 8b 46 0a 89 47 0a 8b 46 0e 89 47 0e 66 c7 47 12 01 00 8b 46 0e }
        $gsrch = { ff ff ff ff 06 00 00 00 2a 00 2e 00 65 00 78 00 65 00 2a 00 00 00 }
        $inf1 = "[autorun]" wide fullword
        $inf2 = "icon=%SystemRoot%\\system32\\SHELL32.dll,4" wide fullword
        $inf3 = "shell\\open\\command=" wide fullword
        $inf4 = "hold.inf" wide
        $inf5 = "autorun.inf" wide
        $fname1 = "OpenFileMaster" ascii
        $fname2 = "SetFileStartup" ascii
        $fname3 = "IsRunAPP" ascii
        $fname4 = "GetDevice" ascii
    condition:
        all of ($d*) and all of ($g*)
        and (4 of ($inf*) or $fname1 and 3 of ($fname*))
        and filesize > 450KB and filesize < 1MB
        and pe.imports("shell32.dll", "SHGetSpecialFolderLocation")
        and (pe.imports("shell32.dll", "ExtractIconA") or pe.imports("shell32.dll", "ExtractIconW"))
        and (pe.imports("kernel32.dll", "UpdateResourceA") or pe.imports("kernel32.dll", "UpdateResourceW"))
        and (pe.imports("kernel32.dll", "FindFirstFileA") or pe.imports("kernel32.dll", "FindFirstFileW"))
}

rule CrowdStrike_CSIT_19144_02 : python remote_shell 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects Python backconnect shell that uses a full PTY and links history to /dev/null"
        reports = "CSIT-19144"
        version = "202101291826"
        last_modified = "2021-01-29"
    strings:
        $ = "= socket.socket(socket.AF_INET, socket.SOCK_STREAM)"
        $ = "connect("
        $ = "os.putenv(\"HISTFILE\",'/dev/null')"
        $ = "pty.spawn(\"/bin/bash\")"
    condition:
        all of them
}

rule CrowdStrike_CSIT_19155_01 : anchor ecrime installer wizard_spider 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects strings in unpacked AnchorInstaller binaries."
        reports = "CSIT-19155"
        version = "202006151614"
        last_modified = "2020-06-15"
        actor = "WIZARD SPIDER"
        malware_family = "AnchorInstaller"
    strings:
        $pdb86 = "anchorInstaller_x86.pdb"
        $pdb64 = "anchorInstaller_x64.pdb"
        $str01 = "cmd.exe /c timeout 5 && del" wide
        $str02 = "qwertyuiopasdfghjklzxcvbnm" wide
        $str03 = ":$GUID" wide
        $str04 = "%SystemRoot%" wide
    condition:
        1 of ($pdb*) and 2 of ($str*)
}

rule CrowdStrike_CSIT_20124_01 : defray defray777 ransomware 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects unpacked Defray777 ransomware (also known as Target777 and Ransom X)"
        reports = "CSIT-20124"
        version = "202106011333"
        last_modified = "2021-06-01"
        malware_family = "Defray777"
    strings:
        $exp = "010001"
        $string_1 = "backup" wide nocase
        $string_2 = "veeam" wide nocase
        $string_3 = "/Change /TN \\\"\\\\Microsoft\\\\Windows\\\\SystemRestore\\\\SR\\\" /disable" wide nocase
        $string_4 = "delete catalog -quiet" wide nocase
        // A8 07           test    al, 7
        // BB 00 00 00 00  mov     ebx, 0
        // 0F 95 C3        setnz   bl
        // C1 E8 03        shr     eax, 3
        // 25 FF FF FF 07  and     eax, 7FFFFFFh
        // 56              push    esi
        // 8B ?? ??        mov     esi, [ebp+arg_0]
        // 03 D8           add     ebx, eax
        $code = { A8 07 BB 00 00 00 00 0F 95 C3 C1 E8 03 25 FF FF FF 07 56 8B ?? ?? 03 D8 }
    condition:
        $exp and 3 of ($string_*) and $code and filesize > 100KB and filesize < 800KB
}

rule CrowdStrike_CSIT_19179_02 : dropper rat sempathy 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects an instance of the dropper executable that deploys Sempathy RAT"
        reports = "CSIT-19179"
        version = "202005041931"
        last_modified = "2020-05-04"
        malware_family = "Sempathy RAT"
    strings:
        $a1 = "setupapi.dll"
        $a2 = "CreateWindow"
        $a3 = "WINMM.dll"
        $a4 = "CLSNAME"
        $a5 = "desk.cpl"
        $a6 = "S_DLL"
    condition:
        all of them and uint16(0) == 0x5a4d
}

rule CrowdStrike_CSIT_19166_03 : artifact blueprint venomous_bear 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects JPEG files used as part of C2 communication performed by Blueprint"
        reports = "CSIT-19166"
        version = "201910041505"
        last_modified = "2019-10-04"
        actor = "VENOMOUS BEAR"
        malware_family = "Blueprint"
    strings:
        $ln_c2_jpeg  = { ff d8 ff e0 00 10 4a 46 49 46 00 01 02 00 00 64 00 64 ff fe 00 03 00 ff db 00 43 00 }
    condition:
        $ln_c2_jpeg
}

rule CrowdStrike_CSIT_19195_01 : downloader fancy_bear nimbledown 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects x86 variants of FANCY BEAR's NimbleDown downloader"
        reports = "CSIT-19195"
        version = "201911011553"
        last_modified = "2019-11-01"
        actor = "FANCY BEAR"
        malware_family = "NimbleDown"
    strings:
        $nim_indicator_1 = "@Connection was closed before full request has been made"
        $nim_indicator_2 = "@No valid socket error code available"
        $nim_indicator_3 = "SIGSEGV: Illegal storage access. (Attempt to read from nil?)"
        $entry_point = { 55 89 E5 83 EC 08 E8 DC FF FF FF A1 ?? ?? ?? ??  C9 C2 10 00 }
    condition:
        any of ($nim_indicator_*) and $entry_point
}

rule CrowdStrike_CSIT_19166_04 : blueprint pdf venomous_bear 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects unique bytes from embedded JPEG included in the Blueprint PDF-based c2 channel"
        reports = "CSIT-19166"
        version = "201910041510"
        last_modified = "2019-10-04"
        actor = "VENOMOUS BEAR"
        malware_family = "Blueprint"
    strings:
        $pdf = { 25 50 44 46 }
        $ln_c2_pdf = { ff db 00 43 01 ff da 00 0c 03 01 00 02 11 03 11 00 3f 00 00 00 }
    condition:
        $pdf at 0 and $ln_c2_pdf
}

rule CrowdStrike_CSIT_19184_01 : dropper neptun 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Matches on code and strings found in Neptun dropper"
        reports = "CSIT-19184"
        version = "201910231630"
        last_modified = "2019-10-23"
        malware_family = "Neptun"
    strings:
        // Characteristic MSIL bytes found in the payload's UnMark function
        $code_1 = { 00 00 2b 0c 1e 07 58 28 }
        // Characteristic array name
        $s_dropper_payload = "Payload" ascii
        $s_dropper_installutil = "\\installutil.exe /LogFile= \"" wide
        $s_dropper_ping = "ping -n 1 127.0.0.1 -w 3000 > Nul & del /f /q " wide
    condition:
        // PE binary
        uint16(0) == 0x5A4D and uint32(uint32(0x3c)) == 0x4550 and
        // Mono/.NET 32bit
        ((uint16(uint32(0x3c)+24) == 0x010b and uint32(uint32(0x3c)+232) > 0) or
        // Mono/.NET 64bit
        (uint16(uint32(0x3c)+24) == 0x020b and uint32(uint32(0x3c)+248) > 0))
        and $code_1 and 2 of ($s_dropper_*)
}

rule CrowdStrike_CSIT_19184_02 : backdoor implant neptun 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Matches on code and strings of the Neptun implant"
        reports = "CSIT-19184"
        version = "201910231630"
        last_modified = "2019-10-23"
        malware_family = "Neptun"
    strings:
        // characteristic MSIL bytes found in the UnMark function
        $code_1 = { 00 00 2B 0C 1E 07 58 28 }
        // dropper strings -- they should not appear
        $s_dropper_payload = "Payload" ascii
        $s_dropper_installutil = "\\installutil.exe /LogFile= \"" wide
        $s_dropper_ping = "ping -n 1 127.0.0.1 -w 3000 > Nul & del /f /q " wide
        $s_backdoor_temp = "c:\\windows\\temp" wide
        $s_backdoor_cmd = "cmd.exe" wide
        $s_backdoor_service_1 = "Windows Remote" wide
        $s_backdoor_service_2 = "WSMan Provider Service" wide
    condition:
        // pe binary
        uint16(0) == 0x5A4D and uint32(uint32(0x3c)) == 0x4550 and
        // Mono/.NET 32bit
        ((uint16(uint32(0x3c)+24) == 0x010b and uint32(uint32(0x3c)+232) > 0) or
        // Mono/.NET 64bit
        (uint16(uint32(0x3c)+24) == 0x020b and uint32(uint32(0x3c)+248) > 0))
        and $code_1 and not any of ($s_dropper_*) and 2 of ($s_backdoor_*)
}

rule CrowdStrike_Ostap_ProduceZero_01 : downloader ostap 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects ProduceZero version of the Ostap downloader"
        version = "201910102352"
        last_modified = "2019-10-10"
        malware_family = "Ostap"
    strings:
        $h1 = "=hisero;"
        $h2 = "hisero=[];"
        $Ch = "],'Ch');  })("
        $A0 = "]+tPrpbbo00()+"
    condition:
        $Ch and
        ($A0 or ($h1 and $h2)) and
        filesize < 1MB
}

rule CrowdStrike_CSIT_19158_01 : backdoor implant powershell powerton refined_kitten 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects code used to generate random strings and AES key material for POWERTON implant"
        reports = "CSIT-19158"
        version = "201912191902"
        last_modified = "2019-12-19"
        actor = "REFINED KITTEN"
        malware_family = "POWERTON"
    strings:
        $ = "System.Security.Cryptography.AesManaged"
        $ = "join ((48..57) + (97..122) | Get-Random -Count 32 | % {[char]$_})"
        $ = "join ((48..57) + (65..90) | Get-Random -Count $"
        $ = "(Get-WMIObject Win32_ComputerSystemProduct).UUID"
    condition:
        all of them
}

rule CrowdStrike_CSIT_19220_01 : buer downloader loader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects Buer Loader"
        reports = "CSIT-19220"
        version = "202105031547"
        last_modified = "2021-05-03"
        malware_family = "BuerLoader"
    strings:
        // pre-1.2
        $opcode_strings = {6A 2E B9 [4] E8 [4] 6A 13 B9 [4] E8 [4] 6A 1D B9 [4] E8}
        $opcode_dec = {BE FD FF 00 00 66 01 34 41 40 3B C2}
        $opcode_main = {6A 0D B9 [4] E8 [4] E8 [4] BA EC BC EE 61 8B C8 E8 [4] C7 04 24 [4] FF D0}
        // 1.2 <= 1.3.4
        $12_s1 = "xjhnsny3j}j" wide
        $12_s2 = "j}uqtwjw3j}j" wide
        $12_s3 = "xmjqq873iqq" wide
        $12_s4 = "Xtky|fwjaRnhwtxtkya\\nsit|xaHzwwjsy[jwxntsaWzsTshj" wide
        $12_s5 = "*FUUIFYF*" wide
        $12_s6 = "fun4rtizqj4" wide
        // > 1.4
        $14_s1 = "h}novvrh5kss"
        $14_s2 = "^pukv~z'87"
        $14_s3 = "^pukv~z'?58"
    condition:
        (2 of ($opcode*) or 4 of ($12_s*) or 3 of ($14_s*))
}

rule CrowdStrike_ConfickerRsaKey : conficker 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Conficker embedded RSA key (versions A, B, C, D)"
        version = "201909061324"
        last_modified = "2019-09-06"
        malware_family = "Conficker"
    strings:
        $rsakey_conficker_a = { CFF07B6189D716E81B09ED3145FE2EE78A24B956F673413678EF3750DFEC86CA4FE2964BC3E6F450BA1656E84E76F25B724557987A070B971517E9ABF66D1356DE661A55AEAE9E9453EE602534FC01CBF7661DF4B0E91D6FE9A91B82C1A35C6EE3DA616528AB366AA53EE9EE0AC13AE22743F61E0B032A3C9B91FEE94076BF25 }
        $rsakey_conficker_b = { E7A72DF545CA1249E6441ED6724C1BBA3C72F08B4BEB75F35EE844CD8756E921E606343376499342ECE8033619A6AD4D12597F9601854125CBE2837E72DF85B3DDE159FB97789A2DB2B63DE9585245391B90C89FD75C2B42DEA66AD803D0F24CAF72242E9D8CF34D2F2F4DF249D68929A2C9C6FFF25F98B66809AD921070D510EA1CDAB6BCD403CC8D9E8E578CCFFCBC5BC39E315BDA088A932680BFD2DB4580833387AF69C2F65F15993414CB0F88CC4429E993459E7EF912878A938E3343BB0C405B604C86403117996513E46CC28AE5A430D9F3D66ABBEBDFDA02EC6D387E23EE11688A627DA893939EC6DC7BF1235D667239C83DE556C320D9A89A2535E43B99D47E61D1D77450E36AEB495A313D21DE294ACD30FCD1FDD79873604BA653085DF9EE05E62197EDD9B7D6BC0034B1766BBD26608A2C1CB6E6582D474D40095B83B19D3C988EA22D9E5D7A07F10DC81B2647B01A1C7008764CC29CCF3AF30E1EC600A815CB47927E1DF90742AA9249DC0471EDD6E7DCE6AD3CBD251832FAECFAB7A5FBCCA14952BA3060A7D3B0A395E5F2DA61BD27D297C0D86633370413D2369D3FCB24796B2E6922E10BADC15B488AE1D50087374406F5AE4C744B200FA3576308D457EBF03AE31A03C4DF9A172D7FFD1F4471DA49B7BA3F26B5DD9CFECA1870DBEC996384963010804C33734DBCB2C3792C8368CD415C45ED7DE7BEA888 }
        $rsakey_conficker_c = { 13E5A419AD584633101EFEC1A1964FB118FBE14920329C17E81C7CBC6D8131C9DB8D7DBCA1BB94E421047D30AAF9678C78A64147CA0857B95200A92BE078D7FC5A57FB7CD9D016E22E2CDEF6DB849443E7EE721C867E819559CE39BBA220A0816303093D9CEF5FEE038BD95621A8C4FAB5B169207430B51CEA8304785078AC1C8C545D2BE39275BDD9785EEB21439BA61689D46B0B0F0D6A1547F8195041622C9ED89A563B417AC45A44AFFBD67DF91CC046A3F58149BAD6E106A893F6E7878362E8C0BC2D187A691E1AF5195AB9CE7A34DCA03A2EEE6B12B2F02D2E876D5F2DF597BCF0531A30C56DC5A4A228BE88ADE179066E3C90F336F92FF8053B5BEAC3D301E5676C4C287E35B3CD6E33D3D3202E09CF30794A410362761D92B2A434880944145514E8EFF0FCCB82E004504236DC3DB892E9AB135A7B0E07A4EB71691C03A90E5E294357D4A8E071BD476E73CC820B6381896FAC5E59163FE2D2DCA4BDF777EA0AF3CC6F4D51DB7C947D575E1BA6A218E1C5B6E2208E6C114FC91EF656938F5662A011861F1D1D2DD72AE13031301CA8BF280D0E90DA2D54B78C0344007D5BABC25F5134E0A5BF2DEDC328D4BB59B5F25EFD5A5B9AE93962B4994E3509E2A2B1812B2F4BDB3E76622252FD795B6E53703CBE9E4DAB54D39E62FF597A60FC78481E052FCB1CF95F2391FE7E42E288B0D333874100724F94632267B9A220 }
        $rsakey_conficker_d = { 91C43C28E0B1CFC99ABF4AF5925DE109D14F8C04C5D73CEB78D77CAD6D203F3299E349C67BCBD68E0605F768FBEF82B7E94FAF471D063EA6CCA6F6A6FA67F202E5F8837693C2C5615C03330D8CEB46E9DD3C9BEE8D65BF6792F7E6ACAC69EA7B130FCA17A8116FB927AFC1C467FF0E32CB96C26C751E5C343C2C187B93A6600EEAB55370E669E873E671890905987840E9D3745BCF3F9EA6C113DFE1FB880A744EBA3E20C7ED4B1325D11BED2E84546D577E8D4B6A09EA203B835B892BEDEABE0906AAE942FBBB1C5D24D3D7F4284D7E9BFF746EBB5D914C51763549897D7DCCA933D7116C275ABACB46FC60E0F8B9F59E8B0CFD233A4C62CE1039D6CFCC1394C5EB811C00C67B635C0324F5725E6D2981B9D3649A0769200A58C0D31776DE1197C7BAACFC3EAF3963770FC14535952C195225C8B5BBED8007BA784E496BA90717E05E898AAEDFB41760475613FAA22D8E79420251BC4029E2FA520E1554304B3099D66E7E77D00E63B7E42B598226C9F5BDF0305D7A05FEABEFFA2096349022D0EBC5868616D9609763748AA3DEED65BA2773C55E9948D7D65C095B92A7A4BA938141E3408F51777F828C30D694E901F691F174DCD15E4C8E30C94FCBB5B5B0E670286197F8A6AFCB867C26F6D8CCCA02541702CA81A1B342A103D1105A4194EA24C9A909CAC5E81941A14098D8390AC13EB9FCD26C45B56BC6AEC15E1F737A }
    condition:
        any of them
}

rule CrowdStrike_HoneyminerN_01 : honeyminer_n miner unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects the unpacked HoneyMiner_N executable which may be used as a mineware component."
        version = "201909061344"
        last_modified = "2019-09-06"
        malware_family = "Honeyminer"
    strings:
        $h01 = "Could not connect to stratum server "
        $h02 = ",\"method\":\"mining.subscribe\",\"params\":[\""
        $h03 = "mining.notify"
        $h04 = "[{\"p\": \"%s\", \"t\": %d, \"h\": %.2f}]"
        $h05 = "Benchmark starting... this may take several minutes, please wait..."
        $h06 = "Modified and optimized for use with Honeyminer"
        $h07 = "Invalid address. Use -u to specify your address."
        $h08 = "{\"miner\": \"%s\", \"version\": \"%s\"}\x0a"
        $h09 = "===================honeyminer.com==================="
        $a01 = "                `-/+os    so+/:`"
        $a02 = "                     +/:::+`"
        $a03 = "            .oo++++++y////y++++++oo. "
    condition:
        (all of ($a*) and any of ($h*)) or (5 of ($h*))
}

// WARNING: This rule will only work with YARA 3
import "pe"

rule CrowdStrike_HoneyminerN_02 : honeyminer_n miner packed 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects the packed HoneyMiner_N executable based on certificate information. The software may be used as a mineware component."
        version = "201909061326"
        last_modified = "2019-09-06"
        malware_family = "Honeyminer"
    strings:
        $S01 = "Stax Digital LLC" ascii
        $C01 = {03381e63c8e875511c0a66c854f9d72b}
        $HMN = "HoneyMiner_N" wide
    condition:
        all of them and pe.overlay.offset < @C01 and @C01 < @S01
}

rule CrowdStrike_CSIT_19156_01 : emissary_panda hyperbro loader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects shellcode decoder initialization and DllMain epilogue code in HyperBro loaders"
        reports = "CSIT-19156"
        version = "202101291826"
        last_modified = "2021-01-29"
        actor = "EMISSARY PANDA"
        malware_family = "HyperBro"
    strings:
        $init = { b? ?? (15|17|16|18) 00 10 b? 00 10 00 10 2b }
        $init2 = { b? ?? (15|17|16|18) 00 10 b? 00 10 00 10 05 [4] 2b }
        $init3 = { b? ?? (15|17|16|18) 00 10 b? 00 10 00 10 81 c? [4] 2b }
        $main_epilogue = { e8 [4] 5? 5? [0-4] 33 c0 40 c2 0c 00 }
    condition:
        filesize<100KB and uint16(0)==0x5a4d and (any of ($init*)) and $main_epilogue
}

rule CrowdStrike_CSIT_19156_02 : emissary_panda hyperbro loader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects shellcode decoder at beginning of .text section and internal DLL name"
        reports = "CSIT-19156"
        version = "202101291826"
        last_modified = "2021-01-29"
        actor = "EMISSARY PANDA"
        malware_family = "HyperBro"
    strings:
        $decoder = { da d4 d9 74 24 f4}
        $decoder2 = { cc d9 ?? d9 74 24 f4 }
        $dll_internal = "dll.dll" fullword
    condition:
        filesize<100KB and uint16(0)==0x5a4d and $dll_internal and (($decoder at 0x400) or ($decoder2 at 0x400))
}

rule CrowdStrike_CSIT_19156_03 : emissary_panda loader sysupdate 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects shellcode decoder initialisation"
        reports = "CSIT-19156"
        version = "202101291826"
        last_modified = "2021-01-29"
        actor = "EMISSARY PANDA"
        malware_family = "SysUpdate"
    strings:
        $init = { b? ?? (15|17|16|18) 00 10 b? 01 10 00 10 6a (08|0c|10) }
    condition:
        filesize<100KB and uint16(0)==0x5a4d and $init
}

rule CrowdStrike_CSIT_19156_04 : emissary_panda sysupdate 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects encoded shellcode with structural similarities to blobs used to load EMISSARY PANDA payloads"
        reports = "CSIT-19156"
        version = "202101291826"
        last_modified = "2021-01-29"
        actor = "EMISSARY PANDA"
        malware_family = "HyperBro,SysUpdate"
    strings:
        $1 = { da d4 d9 74 24 f4 5b bf [4] 29 c9 66 b9 [2] 83 eb fc 31 7b 16 03 7b}
        $2 = { ec 03 0c 04 04 c7 59 }
        $3 = { ea (6d|01) (0b|0a) 02 02 c5 57 }
    condition:
        filesize < 500KB and (($1 at 0) or ($2 at 0) or ($3 at 0))
}

rule CrowdStrike_CSIT_19156_05 : emissary_panda hyperbro 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects encoded shellcode with structural similarities to blobs used to load EMISSARY PANDA payloads"
        reports = "CSIT-19156"
        version = "202101291826"
        last_modified = "2021-01-29"
        actor = "EMISSARY PANDA"
        malware_family = "HyperBro,SysUpdate"
    strings:
        $start1 = { D? ?? (2?|3?) C9 ?9 [2] 00 00 e8 ff ff ff ff c? 5? }
    condition:
        filesize < 500KB and $start1 at 0
}

rule CrowdStrike_CSIT_19156_06 : emissary_panda sysupdate 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects compression class information found within SysUpdate samples"
        reports = "CSIT-19156"
        version = "202101291826"
        last_modified = "2021-01-29"
        actor = "EMISSARY PANDA"
        malware_family = "SysUpdate"
    strings:
        $ = "AVCCompressIF@@"
        $ = "AVCCompressQK@@"
        $ = { c7 [2] 09 90 76 11 c7 [2] 10 18 15 12 }
    condition:
        all of them
}

rule CrowdStrike_CSIT_19156_07 : emissary_panda hyperlogger 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects uncommon strings in HyperLogger samples"
        reports = "CSIT-19156"
        version = "202101291826"
        last_modified = "2021-01-29"
        actor = "EMISSARY PANDA"
        malware_family = "HyperLogger"
    strings:
        $ = "-key" fullword wide
        $ = "AVTConfig"
        $ = "klgClass" wide
    condition:
        filesize<1MB and all of them
}

rule CrowdStrike_CSIT_19156_08 : emissary_panda hyperbro 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects prominent strings in HyperBro payload executables"
        reports = "CSIT-19156"
        version = "202101291826"
        last_modified = "2021-01-29"
        actor = "EMISSARY PANDA"
        malware_family = "HyperBro"
    strings:
        $daemon = "-daemon" fullword wide
        $worker = "-worker" fullword wide
        $uac = "-uac" fullword wide
        $config = "config.ini" fullword wide
        $url_format = "https://%s:%d/ajax" fullword wide
        $url_format2 = "https://%s:%d/api/v2/ajax" fullword wide
        $obj = "system-%d" fullword wide
        $pipename = "\\\\.\\pipe\\testpipe" fullword wide
    condition:
        filesize<1MB and 4 of them
}

rule CrowdStrike_CSIT_19156_09 : emissary_panda hyperbro 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects the presence of prominent class names in HyperBro executables"
        reports = "CSIT-19156"
        version = "202101291826"
        last_modified = "2021-01-29"
        actor = "EMISSARY PANDA"
        malware_family = "HyperBro"
    strings:
        $ = "AVTFileMgr"
        $ = "AVTShellMgr"
        $ = "AVTShellcodeData"
        $ = "AVTDirve"
        $ = "AVTTransMgr"
        $ = "AVTProcessMgr"
        $ = "AVTLoop"
        $ = "AVTLogin"
        $ = "AVTCommand"
    condition:
        filesize<2MB and 6 of them
}

rule CrowdStrike_CSIT_19166_05 : artifact blueprint venomous_bear 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects Base64-encoded data included in the Blueprint email C2 channel"
        reports = "CSIT-19166"
        version = "201910041524"
        last_modified = "2019-10-04"
        actor = "VENOMOUS BEAR"
        malware_family = "Blueprint"
    strings:
        $base64 = "/9j/4AAQSkZJRgABAgAAZABk//4AAwD/2wBDA"
        $content = "Content-Disposition:  attachment;"
    condition:
        all of them
}

rule CrowdStrike_CSA_191130_02 : banker kiron trojan 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects the Brazilian banking malware Kiron"
        reports = "CSA-191130"
        version = "201909201229"
        last_modified = "2019-09-20"
        malware_family = "Kiron"
    strings:
        $version_2 = { e8 ?? ?? ?? ?? b8 34 00 00 00 e8 ?? ?? ?? ?? ba ?? ?? ?? ?? 8a 14 02 8d ?? ?? e8 ?? ?? ?? ?? 8b ?? ?? 8b c6 e8 ?? ?? ?? ?? 4b 75 ?? 33 c0 5a 59 59 64 89 10 68 ?? ?? ?? ?? }
        $version_1 = { e8 ?? ?? ?? ?? 8b ?? ?? e8 ?? ?? ?? ?? 8b f8 8d ?? ?? 50 89 ?? ?? c6 ?? ?? 00 8d ?? ?? 33 c9 }
        $str_1 = "TRAVA"
        $str_2 = "Windows 8"
        $str_3 = "Windows 10"
        $str_4 = "SUSPENDEACESSO"
        $str_5 = "ATIVAKEY"
        $str_6 = "OCULTARMZ"
        $str_7 = "EXIBIRMZ"
        $str_8 = "DETONAPROCESSO"
    condition:
        uint16(0) == 0x5a4d and
        any of ($version_*) and
        6 of ($str_*)
}

rule CrowdStrike_CSIT_19166_06 : artifact blueprint venomous_bear 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects Base64-encoded data included in the Blueprint email C2 channel"
        reports = "CSIT-19166"
        version = "201910041531"
        last_modified = "2019-10-04"
        actor = "VENOMOUS BEAR"
        malware_family = "Blueprint"
    strings:
        $base64 = "/9sAQwH/2gAMAwEAAhEDEQA/A"
        $content = "Content-Disposition: attachment; filename="
    condition:
        all of them
}

rule CrowdStrike_CSA_191087_01 : evileye iframe 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule is used to detect distinct HTML used by a likely China-based adversary in support of deploying an Android-based RAT dubbed EvilEye."
        reports = "CSA-191087"
        version = "201909061346"
        last_modified = "2019-09-06"
    strings:
        $ = "width 0 height 0 visibility hidden></iframe>';"
    condition:
        any of them
}

rule CrowdStrike_Eris_Ransomware : eris golang ransomware unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects unpacked Eris ransomware for Windows"
        version = "201909061345"
        last_modified = "2019-09-06"
    strings:
        $ = "Anti.WipeBackup"
        $ = "Sync.GetGeo"
        $ = "Sync.GetID"
        $ = "Sync.GetOS"
        $ = "Sync.GetSpace"
        $ = "Sync.GetSyncInfo"
        $ = "Sync.GetSynsCheck"
        $ = "Sync.machineID"
        $ = "Utils.GetDrive"
        $ = "Utils.RandStringBytes"
        $ = "Walk.Check"
        $ = "Walk.WalkComputer"
        $ = "Walk.WalkDirectores"
    condition:
        uint16(0) == 0x5A4D and 3 of them
}

rule CrowdStrike_CSIT_19207_01 : firebak imperial_kitten rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects strings used for Delphi variant of FireBAK payload"
        reports = "CSIT-19207"
        version = "202005151226"
        last_modified = "2020-05-15"
        actor = "IMPERIAL KITTEN"
        malware_family = "FireBAK"
    strings:
        $ = "SystemSpooler" wide ascii
        $ = "TMTimer" wide ascii
        $ = "Delphi 5.x" wide ascii
        $ = "/idx.asmx/" wide ascii
        $ = "ssw.ini" wide ascii
        $ = "ver=" wide ascii
        $ = "&aip=" wide ascii
        $ = "osv=" wide ascii
        $ = "&cnm=" wide ascii
        $ = "&mac=" wide ascii
        $ = "&adm=" wide ascii
        $ = "&pid=" wide ascii
        $ = "getInfo?xid=x&tid=" wide ascii
        $ = "getAppHex?aid=" wide ascii
        $ = "getInfo?gotid=" wide ascii
        $ = "getInfo?tid=" wide ascii
        $ = "getInfo?fid=true&tid=" wide ascii
    condition:
        uint16(0)==0x5a4d and 5 of them and filesize < 1MB
}

rule CrowdStrike_CSA_191096_01 : hoplight labyrinth_chollima rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects components that make up LABYRINTH CHOLLIMA's HOPLIGHT Implant"
        reports = "CSA-191096,CSIT-20075"
        version = "202004211732"
        last_modified = "2020-04-21"
        actor = "LABYRINTH CHOLLIMA"
        malware_family = "HOPLIGHT"
    strings:
        $str1 = "fjiejffndxklfsdkfjsaadiepwn"
        $str2 = "ofuierfsdkljffjoiejftyuir"
        $str3 = "reykfgkodfgkfdskgdfogpdokgsdfpg"
        $str4 = "ztretrtireotreotieroptkierert"
        $const1 = { ef cd ab 90 }
        $const2 = { 78 56 b4 c2 }
        $const3 = { 55 84 26 fe }
        $ssl1 = "key expansion"
        $ssl2 = "master secret"
    condition:
        int32(0) == 0x905a4d and
        2 of ($str*) and
        all of ($const*) and
        all of ($ssl*)
}

rule CrowdStrike_CSIT_19230_01 : ecrime nemty ransomware 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects variants of Nemty ransomware"
        reports = "CSIT-19230"
        version = "202004011753"
        last_modified = "2020-04-01"
        malware_family = "Nemty"
    strings:
        $str_1 = "fuckav"
        $str_2 = "nemty"
        $str_3 = "hate"
        $str_4 = "https://pbs.twimg.com/media/Dn4vwaRW0AY-tUu.jpg"
        // Kill processes
        // C7 ?? ?? ?? ?? ?? ??   mov     [ebp+var_64], offset aOnenote ; "onenote"
        // C7 ?? ?? ?? ?? ?? ??   mov     [ebp+var_60], offset aVirtualboxvm ; "virtualboxvm"
        // 57                     push    edi
        // 8B ?? ??               mov     eax, [ebp+var_5C]
        // FF ?? ?? ??            push    [ebp+eax*4+Str] ; Str
        // 8D ?? ??               lea     eax, [ebp+var_20]
        // E8 ?? ?? ?? ??         call    sub_4076BA
        // 68 ?? ?? ?? ??         push    offset aExe     ; ".exe"
        // 68 ?? ?? ?? ??         push    offset aCTaskkillFIm ; " /c taskkill /f /im "
        // 8D ?? ??               lea     ebx, [ebp+var_20]
        // 8D ?? ??               lea     eax, [ebp+var_58]
        // E8 ?? ?? ?? ??         call    sub_40A7BD
        // 59                     pop     ecx
        // 50                     push    eax             ; int
        // 8D ?? ??               lea     eax, [ebp+var_3C]
        // E8 ?? ?? ?? ??         call    sub_4081D0
        // 83 78 14 10            cmp     dword ptr [eax+14h], 10h
        // 59                     pop     ecx
        // 59                     pop     ecx
        // 72 ??                  jb      short loc_40AE01
        $code = { C7 ?? ?? ?? ?? ?? ?? C7 ?? ?? ?? ?? ?? ?? 57 8B ?? ?? FF ?? ?? ?? 8D ?? ?? E8 ?? ?? ?? ?? 68 ?? ?? ?? ?? 68 ?? ?? ?? ?? 8D ?? ?? 8D ?? ?? E8 ?? ?? ?? ?? 59 50 8D ?? ?? E8 ?? ?? ?? ?? 83 78 14 10 59 59 72 ?? }
        $autogen_a = { ff 0d 8b c1 39 75 f4 73 03 8d 45 e0 03 45 f0 39 75 f4 73 03 }
        $autogen_b = { 01 48 39 75 f4 8b 75 e0 73 03 8d 75 e0 03 f0 eb 0e 83 7d f4 }
        $autogen_c = { 09 80 39 2b 75 03 c6 01 2e 41 3b c8 75 f3 8b 45 }
        $autogen2_a = { 5e c3 8a 50 05 8a 48 01 88 50 01 8a 50 09 88 50 05 8a 50 0d }
        $autogen2_b = { 32 4d fa 83 c0 04 88 }
        $autogen2_c = { 3b 5d bc 7c b7 8b 75 bc 85 f6 78 2e 83 7d f4 10 8b 7d e0 8b }
    condition:
        ($code and
        3 of ($str_*)) or
        all of ($autogen_*) or
        all of ($autogen2_*)
}

rule CrowdStrike_CSA_201394_01 : ghahergo remix_kitten 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects GhaherGo malware common function names and strings"
        reports = "CSA-201394"
        version = "202010300230"
        last_modified = "2020-10-30"
        actor = "REMIX KITTEN"
        malware_family = "GhaherGo"
    strings:
        $str_1 = "/Users/ghaher/" wide ascii
        $str_2 = "a.conf" wide ascii
        $str_3 = "64cdscacxs1461sd" wide ascii
        $func_1 = "main.manageWorkMode" wide ascii
        $func_2 = "main.check" wide ascii
        $func_3 = "main.sendResult" wide ascii
        $func_4 = "main.getCommand" wide ascii
        $func_5 = "main.getId" wide ascii
        $func_6 = "main.sendRequest" wide ascii
        $func_7 = "main.runCommand" wide ascii
        $func_8 = "main.saveConfig" wide ascii
        $func_9 = "main.loadConfig" wide ascii
        $func_10 = "main.readDuration" wide ascii
    condition:
        uint16(0) == 0x5a4d and 1 of ($str_*) and 5 of ($func_*)
}

rule CrowdStrike_CSIT_19168_01 : implant malware venomous_bear 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects VENOMOUS BEAR's WordPicLoader malware loader"
        reports = "CSIT-19168"
        version = "202106170931"
        last_modified = "2021-06-17"
        actor = "VENOMOUS BEAR"
        malware_family = "WordPicLoader"
    strings:
        $s_1 = "Addin"
        $s_2 = "targetPath"
        $s_3 = "border"
        $s_4 = "args"
        $s_5 = "addinst"
        $s_6 = "OnDisconnection"
        $s_7 = "SHA256"
        $s_8 = "RSAPKCS1SignatureDeformatter"
        $s_9 = "ParameterizedThreadStart"
        $s_10 = "Rijndael"
        $s_11 = "GZipStream"
        $s_12 = "Bitmap"
        $s_13 = "GetData"
        $code_1 = {
        11 ?? 16 11 ?? 1c 6f ?? ?? ?? ?? 6f ?? ?? ?? ??
        11 ?? 17 11 ?? 1d 6f ?? ?? ?? ?? 6f ?? ?? ?? ??
        11 ?? 18 11 ?? 1b
        }
    condition:
        // PE binary
        uint16(0) == 0x5A4D and uint32(uint32(0x3c)) == 0x4550 and
        // Mono/.NET 32bit
        ((uint16(uint32(0x3c)+24) == 0x010b and uint32(uint32(0x3c)+232) > 0) or
        // Mono/.NET 64bit
        (uint16(uint32(0x3c)+24) == 0x020b and uint32(uint32(0x3c)+248) > 0)) and
        10 of ($s_*) and
        $code_1
}

rule CrowdStrike_CSA_191140_01 : emissary_panda jfileman jfoler webshell 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule matches against a distinct variant of the JFoler webshell deployed during probable EMISSARY PANDA operations"
        reports = "CSA-191140"
        version = "201911121932"
        last_modified = "2019-11-12"
        actor = "EMISSARY PANDA"
        malware_family = "JFoler Webshell"
    strings:
        $str_filem = ",\"File Management\"}"
        $str_com = ",\"Command Window\"}"
        $str_uplinfo = "class UplInfo"
        $str_collecttab = "collecttablinks"
        $str_uprate = "getUprate()"
        $password_check1 = "if(password == null){"
        $password_check2 = "session.getAttribute(\"password\")"
    condition:
        all of them and not uint16(0) == 0x5A4D
}

rule CrowdStrike_CSA_191130_01 : banker kiron trojan vbscript 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects a VBS downloader delivering the Brazilian banking malware Kiron"
        reports = "CSA-191130"
        version = "202004291043"
        last_modified = "2020-04-29"
        malware_family = "Kiron"
    strings:
        $ = "Const b64 = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\""
        $ = "mqXFFRJUWm"
        $ = "msgbox \""
        $ = "aHR0cDovL" // URL encoded
        $ = "objFSOx"
        $ = "o.open \"GET"
        $ = "WScript.Sleep"
    condition:
        all of them
}

rule CrowdStrike_CSIT_19173_01 : danabot module proxy scully_spider unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects distinctive strings in the DanaBot proxy module "
        reports = "CSIT-19173"
        version = "201909201228"
        last_modified = "2019-09-20"
        actor = "SCULLY SPIDER"
        malware_family = "DanaBot"
    strings:
        $ = "E:\\Merzadenio\\Sniffer\\UProxyServer.pas" wide
        $ = "c:\\Programdata\\" wide
        $ = "urlscreen.bmp" wide
        $ = "URL Screen - " wide
        $ = "FileID: " wide
        $ = "Size: " wide
    condition:
        all of them
}

rule CrowdStrike_CSIT_19173_02 : danabot module scully_spider stealer unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects distinctive strings in the DanaBot credential stealer module"
        reports = "CSIT-19173"
        version = "201909201228"
        last_modified = "2019-09-20"
        actor = "SCULLY SPIDER"
        malware_family = "DanaBot"
    strings:
        $ = "E:\\Merzadenio\\Stealer\\Passwords\\base64.pas" wide
        $ = "TModule_AbsolutePoker" ascii
        $ = "MuxaSoft Dialer" wide
        $ = "\\Download Master" wide
    condition:
        all of them
}

rule CrowdStrike_CSIT_19173_03 : danabot hvnc module scully_spider unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects distinctive strings in the DanaBot HVNC module"
        reports = "CSIT-19173"
        version = "201911181057"
        last_modified = "2019-11-18"
        actor = "SCULLY SPIDER"
        malware_family = "DanaBot"
    strings:
        $ = "Software\\Borland\\Delphi\\Locales" wide
        $ = "cmd.exe /c start iexplore.exe" wide
        $ = "start microsoft-edge:" wide
        $ = "profiles.ini" wide
    condition:
        all of them
}

rule CrowdStrike_VELVET_CHOLLIMA_LNK_Hosts : lnk velvet_chollima 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects LNK files created on hosts used by VELVET CHOLLIMA. In some instances these may begin a BabyShark infection or other samples may disable the MS Office Protected View setting."
        version = "202004021444"
        last_modified = "2020-04-02"
        actor = "VELVET CHOLLIMA"
    strings:
        $ksi = { 00 6b 73 69 00 00 00 00 00 00 00 }
        $windows_c12 = "windows-c124dds"
    condition:
        uint32(0) == 0x4c and
        filesize < 20KB and
        ($ksi or $windows_c12)
}

rule CrowdStrike_CSA_191140_02 : jfileman jfoler webshell 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule is intended to match against the JFoler webshell"
        reports = "CSA-191140"
        version = "202009042258"
        last_modified = "2020-09-04"
        malware_family = "JFoler Webshell"
    strings:
        $str_filem = ",\"File Management\"}"
        $str_com = ",\"Command Window\"}"
        $str_uplinfo = "class UplInfo"
        $str_collecttab = "collecttablinks"
        $str_uprate = "getUprate()"
    condition:
        all of them
}

rule CrowdStrike_CSIT_19175_01 : exfiltration ryuk sidoh wizard_spider 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Hunting signature for Ryuk Exfiltration tool"
        reports = "CSIT-19175"
        version = "202003101609"
        last_modified = "2020-03-10"
        actor = "WIZARD SPIDER"
        malware_family = "sidoh"
    strings:
        $header =  { 4D 5A }
        $convert_bytes = { 59 85 C0 0F 84 B3 00 00 00 80 3C 37 33 0F 87 }
        $string = "radaragentnewswire"
        $code_a = { 7a 8a 44 37 01 3c 2f 74 04 3c 2d 75 6e 0f b6 44 37 02 50 e8 }
        $code_b = { f4 2b cf d1 f9 74 27 6a 5c 58 66 39 04 53 8b cb 0f 44 f2 42 }
        $code_c = { 75 f4 2b cf d1 f9 6a 5c 58 74 24 66 39 04 53 8b cb 0f 44 f2 }
    condition:
        $header at 0 and ($convert_bytes or $string or all of ($code_*))
}

rule CrowdStrike_CSIT_19177_05 : fancy_bear pocodown rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Command IDs from known PocoDown samples"
        reports = "CSIT-19177"
        version = "202003061431"
        last_modified = "2020-03-06"
        actor = "FANCY BEAR"
        malware_family = "PocoDown"
    strings:
        $ = { 07 54 36 04 }
        $ = { b9 2f 51 15 }
        $ = { 18 ec 46 1e }
        $ = { 35 9e 6c 40 }
        $ = { 37 9d e9 72 }
        $ = { 67 dc bc 76 }
        $ = { 05 80 59 99 }
        $ = { d4 eb 1c b2 }
    condition:
        5 of them
}

rule CrowdStrike_CSA_191140_03 : emissary_panda vulnerability_scanner 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects a vulnerability scanner, possibly in use by EMISSARY PANDA, to scan for a variety of vulnerabilities. It appears modular in nature as multiple variants scan for different vulnerabilities or services."
        reports = "CSA-191140"
        version = "201909201229"
        last_modified = "2019-09-20"
        actor = "EMISSARY PANDA"
        malware_family = "Liveing Scanner"
    strings:
        $ = "%s living  Linux"
        $ = "Resolv %s\t %s"
        $ = "Scan Liveing Host Finish"
        $ = "backdoor-cmdshell|Microsoft Windows"
        $ = "backdoor-fxsvc|500 Not Loged in"
        $ = "It costs %d s %d ms"
        $ = "log=%s&pwd=%s&testcookie=1"
        $ = "/manager/html/"
    condition:
        2 of them
}

rule CrowdStrike_PouterRAT : pouter rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects a RAT that has not yet been fully characterized by CrowdStrike Intelligence. However, it's usage may be targeted in nature."
        version = "201909271326"
        last_modified = "2019-09-27"
        malware_family = "PouterRAT"
    strings:
        $ = "compouter" wide fullword
        $ = "\\Config.INI" wide fullword
        $ = "CONNECT %s:%d HTTP/1.1" fullword
        $ = "aaa%d-%d\x0a" fullword
        $ = "corrent\x0a" fullword
        $ = "/serialNumber=" fullword
        $ = "/emailAddress=" fullword
        $ = {4281E2FF00008079084A81CA00FFFFFF42}
        $ = {03D881E3FF00008079084B81CB00FFFFFF43}
    condition:
        4 of them and filesize > 100KB
}

rule CrowdStrike_CSIT_19176_01 : rat stardust_chollima twopence 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects components of STARDUST CHOLLIMA TwoPence Electric variant"
        reports = "CSIT-19176"
        version = "202003042123"
        last_modified = "2020-03-04"
        actor = "STARDUST CHOLLIMA"
        malware_family = "TwoPence"
    strings:
        $api1 = {22 DA A3 0F C8 47 ED 10 00 00 00 00 00 00 00 00
        39 8C CE EB 67 7B 5F 42 01}
        $api2 = {77 7F 93 4E BF 09 08 35 00 00 00 00 00 00 00 00
        39 8C CE EB 67 7B 5F 42 01}
        $api3 = {FD 30 CB 2C D3 44 A1 36 00 00 00 00 00 00 00 00
        39 8C CE EB 67 7B 5F 42 01}
        $api4 = {E1 A3 22 AC E9 F8 44 C1 00 00 00 00 00 00 00 00
        39 8C CE EB 67 7B 5F 42 01}
        $ssl = "openssl-1.1.0e"
        $magic = {BE AF FE EA}
    condition:
        1 of ($api*) and $ssl and $magic
}

rule CrowdStrike_JSPSpy_Webshell : jspspy webshell 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule matches against copies of the JSPSpy webshell. This webshell is publicly available and has been used by a variety of adversaries including those backed by the Chinese government."
        version = "202008261528"
        last_modified = "2020-08-26"
        malware_family = "JSPSpy Webshell"
    strings:
        $jspspy = "<title>jspspy</title>"
        $alert1 = "You Are In File Now ! Can Not Create Directory !"
        $alert2 = "Dont Support RAR,Please Use WINRAR"
        $menu1 = "File Manager</a> |"
        $menu2 = "Eval Java Code</a> |"
        $menu3 = "JSP Env</a> "
        $menu4 = "Download Remote File</a> |"
    condition:
        2 of them
}

rule CrowdStrike_CSIT_19166_07 : blueprint dotnet venomous_bear 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects the loader Transport Agent component of VENOMOUS BEAR's Blueprint malware through code bytes associated with the string decoding function."
        reports = "CSIT-19166"
        version = "201910041533"
        last_modified = "2019-10-04"
        actor = "VENOMOUS BEAR"
        malware_family = "Blueprint"
    strings:
        $bytes_0xb0L_0xd6L  = { 1f 55 0a 02 8e 69 8d 15 00 00 01 0b 16 0c 2b 0f 02 08 91 06 61 d1 0d 07 08 09 9d 08 17 58 0c 08 02 8e 69 32 eb 07 }
    condition:
        $bytes_0xb0L_0xd6L
}

rule CrowdStrike_CSIT_20023_01 : gumshell remote_shell stalker_panda 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects an instance of GumShell"
        reports = "CSIT-20023"
        version = "202106081523"
        last_modified = "2021-06-08"
        actor = "STALKER PANDA"
        malware_family = "GumShell"
    strings:
        $a_base64 = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"
        $a_def_iv = "sdjfiejkflmvjfkd"
        $a_def_key = "!@#$%^$$#$%^%$#@"
        $a_def_ua = "Mozilla/5.0 (Windows NT 6.1; WOW64; Trident/7.0; rv:11.0) like Gecko"
        $a_reg_cmd = "reg add HKEY_CURRENT_USER\\Environment /v UserInitMprLogonScript /"
        $b_crypto_1 = { 8b 45 08 89 85 74 fb ff ff 8b f3 c1 ee 04 8d 46 01 c1 e0 04 c7 85 78 fb ff ff 00 00 00 00 89 85 78 fb ff ff 40 50 }
        $b_crypto_2 = { 83 e3 0f b8 10 00 00 00 2b c3 85 c0 7e 12 c1 e6 04 50 03 f3 50 03 f7 56 }
        $b_loop = { 81 fe fe 8f 01 00 75 05 80 f9 30 74 10 8a 84 35 [2] fc ff 3c 22 7c 05 3c 7e 7f 01 }
    condition:
        uint16(0) == 0x5a4d and
        2 of ($a*) and
        any of ($b*)
}

rule CrowdStrike_CSIT_19166_09 : artifact blueprint venomous_bear 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Runs the checksum on the JPEG DQT table to identify JPEGs associated with Blueprint"
        reports = "CSIT-19166"
        version = "201910041615"
        last_modified = "2019-10-04"
        actor = "VENOMOUS BEAR"
        malware_family = "Blueprint"
    strings:
        $dqt = {FF DB 00 43}
    condition:
        0xFA == uint8(@dqt + 5) ^ uint8(@dqt +  9) and
        0x10 == uint8(@dqt + 6) ^ uint8(@dqt + 10) and
        0x52 == uint8(@dqt + 7) ^ uint8(@dqt + 11) and
        0x91 == uint8(@dqt + 8) ^ uint8(@dqt + 12) and
        0x28 == uint8(@dqt + 5) ^ uint8(@dqt + 15) and
        0xDB == uint8(@dqt + 6) ^ uint8(@dqt + 16) and
        0xD5 == uint8(@dqt + 7) ^ uint8(@dqt + 17) and
        0xB0 == uint8(@dqt + 8) ^ uint8(@dqt + 18)
}

rule CrowdStrike_CSIT_19187_01 : cobaltstrike dotnet loader mustang_panda 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects custom Cobalt Strike loader used by MUSTANG PANDA"
        reports = "CSIT-19187"
        version = "201910111035"
        last_modified = "2019-10-11"
        actor = "MUSTANG PANDA"
        malware_family = "Cobalt Strike"
    strings:
        $str_stager = "stager.exe" fullword
        $str_smutext = "s_mutex" fullword
        $str_exec3 = "Exec3" fullword
        $str_rw = "PAGE_EXECUTE_READWRITE" fullword
    condition:
        filesize < 50KB and
        all of them
}

rule CrowdStrike_CSIT_19180_01 : backdoor nofate 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects CPUID instructions used to build victim ID for NoFate backdoor"
        reports = "CSIT-19180"
        version = "201910111035"
        last_modified = "2019-10-11"
        malware_family = "NoFate"
    strings:
        $a1 = { b8 00 00 00 80 0f a2 3d 04 00 00 80 72 ?? (3?|8?) ?? ?? 8d }
        $b1 = "%08X%08X"
        $b2 = "%08x%08x"
    condition:
        filesize < 1MB and
        $a1 and
        1 of ($b*)
}

rule CrowdStrike_CSIT_19180_02 : backdoor nofate 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects distinctive strings in the NoFate backdoor"
        reports = "CSIT-19180"
        version = "201910111035"
        last_modified = "2019-10-11"
        malware_family = "NoFate"
    strings:
        $a1 = { 3c 68 65 61 64 3e 0d 0a 3c 6d 65 74 61 20 68 74 74 70 2d 65 71 75 69 76 3d 22 72 65 66 72 65 73 68 22 20 63 6f 6e 74 65 6e 74 3d 22 30 3b 75 72 6c 3d 2f 22 3e 0d 0a 3c 2f 68 65 61 64 3e 00 }
        $a2 = "9&mNF8^K3iFUtsp4" fullword
        $a3 = "jfkdjveujvpdfjgd34=-321" fullword
        $a4 = "c:\\windows\\temp\\font.tmp"
        $a5 = { 25 73 25 73 00 00 00 00 25 73 2f 00 25 30 38 58 25 30 38 58 00 }
    condition:
        filesize < 1MB and
        any of them
}

rule CrowdStrike_CSIT_19180_03 : credential_dumper mimikatz 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects distinctive usage string in custom Mimikatz version used with NoFate backdoor"
        reports = "CSIT-19180"
        version = "202105271547"
        last_modified = "2021-05-27"
    strings:
        $samlib_str = "SamIFree_SAMPR_USER_INFO_BUFFER"
        $usage = "%s patch/inject" ascii wide
    condition:
        filesize < 1MB and
        all of them
}

rule CrowdStrike_CSIT_19208_01 : chameleon 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects distinctive strings in the Chameleon loader"
        reports = "CSIT-19208"
        version = "201911151638"
        last_modified = "2019-11-15"
        malware_family = "Chameleon"
    strings:
        $ = ":\\2018_\\Chameleon"
        $ = "Chameleon\\DllEd\\"
        $ = "AppVIsvSubsystemsq64.dll"
        $ = "WinNvcpInstall"
        $ = { 73 77 6d 60 69 6a 34 3a 27 6f 73 69 00 }
    condition:
        filesize<4MB and any of them
}

rule CrowdStrike_CSIT_19166_08 : blueprint dotnet venomous_bear 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects the .NET DLL implant component of VENOMOUS BEAR's Blueprint malware through code bytes associated with the loop to remove extra null bytes from the C2 JPEG."
        reports = "CSIT-19166"
        version = "201910041544"
        last_modified = "2019-10-04"
        actor = "VENOMOUS BEAR"
        malware_family = "Blueprint"
    strings:
        $bytes_0xdc0L_0xdf4L  = { 16 13 0a 11 11 13 12 12 11 28 ?? ?? ?? ?? 11 0e 11 09 17 28 ?? ?? ?? ?? 11 09 17 58 13 09 11 05 17 58 13 05 11 05 25 1f 7e 5c 1f 7e 5a 59 2d 04 06 1b 58 0a }
    condition:
        $bytes_0xdc0L_0xdf4L
}

rule CrowdStrike_CSIT_19196_07 : downloader nokki nokkiftp 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects strings used in Nokki FTP Downloader"
        reports = "CSIT-19196"
        version = "201910251252"
        last_modified = "2019-10-25"
        malware_family = "NokkiFTP"
    strings:
        $ = "(%c%c.%c%c.%c%c-%c%c.%c%c.%c%c)" wide
        $ = "%s-log-%s" wide
        $ = "%s-file-%s" wide
        $ = "%s-status-%s" wide
    condition:
        all of them
}

rule CrowdStrike_CSIT_19210_06 : loader mgbot 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects an instance of a MgBot loader executable"
        reports = "CSIT-19210"
        version = "201912271807"
        last_modified = "2019-12-27"
        malware_family = "MgBot"
    strings:
        $str_seq_1 = { 65 96 27 47 57 16 C6 05 27 F6 47 56 36 47 00 00 4B 00 65 00 72 00 6E 00 65 00 6C 00 33 00 32 00 2E 00 64 00 6C 00 6C 00 00 00 }
        $marker_1 = { 07 CA C9 9E CA EC 2B 8A B6 FE 96 1A 00 }
    condition:
        any of them and uint16(0) == 0x5A4D
}

rule CrowdStrike_CSIT_20085_01 : carbon_spider dotnet dotnet_dropper ecrime 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects the JSS Loader that has been used by CARBON SPIDER to drop Harpy payloads."
        reports = "CSIT-20085"
        version = "202101291929"
        last_modified = "2021-01-29"
        actor = "CARBON SPIDER"
        malware_family = "JSSLoader"
    strings:
        $a = "JSS.AppForm.resources"
        $c = "JSS.Properties"
        $d = "GetChromeHistory"
        $v2_a = "Cmd_JS"
        $v2_b = "Cmd_PWS"
        $v2_c = "Cmd_RAT"
        $v2_d = "Cmd_UNINST"
    condition:
        (uint16(0) == 0x5A4D) and
        ((($a or $c) and not $d) or
        ($v2_a and $v2_b and $v2_c and $v2_d))
}

rule CrowdStrike_CSIT_19183_01 : dropper earthquakerat helix_kitten macro 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects HELIX KITTEN lure documents that drop EarthQuakeRAT and AgentDrable"
        reports = "CSIT-19183"
        version = "202105111947"
        last_modified = "2021-05-11"
        actor = "HELIX KITTEN"
        malware_family = "earthquakerat"
    strings:
        $mouse = "If Application.MouseAvailable Then"
        $cmt1 = "'MsgBox \"salam\""
        $cmt2 = "'important defenition for exact write"
        $b64 = "b64 = uf.Lb.Caption"
        $path = " = \"C:\\Users\\\" & Environ(\"us"
        $filemode = "For Binary Lock Read Write As #fileNo"
    condition:
        (any of ($cmt*)) or ($mouse and ($b64 or $path or $filemode))
}

rule CrowdStrike_CSIT_19183_02 : dnstunnel earthquakerat helix_kitten httpclient rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects HELIX KITTEN EarthquakeRAT through strings used in the C2 protocol"
        reports = "CSIT-19183"
        version = "201912061944"
        last_modified = "2019-12-06"
        actor = "HELIX KITTEN"
        malware_family = "earthquakerat"
    strings:
        $ = "NO_COMMAND"
        $ = "QUERY_ERROR"
        $ = ";INIT;id="
        $ = ";alive_delay_seconds ="
        $ = "./settings.txt"
        $ = ";SEND_USERNAME;"
        $ = ";SEND_COMPUTERNAME;"
        $ = "INIT;="
        $ = "SEND_COMPUTERNAME"
        $ = "SEND_USERNAME"
        $ = "ALIVE"
        $ = "data; name=\"textarea\""
    condition:
        5 of them
}

rule CrowdStrike_CSIT_19210_05 : mgbot module rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects an instance of MgBot RAT module"
        reports = "CSIT-19210"
        version = "201912271807"
        last_modified = "2019-12-27"
        malware_family = "MgBot"
        
    strings:
        $c1 = ".?AVCSocketObject@@"
        $c2 = "@CryptoPP@@"
        $c3 = ".?AVCFileObject@@"
        $c4 = ".?AVCManagerObject@@"
        $c5 = ".?AVCShell@@"
    condition:
        all of them and uint16(0) == 0x5a4d
}

rule CrowdStrike_CSIT_19190_01 : downloader ecrime phorpiex unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects unpacked copies of the Phorpiex HTTP Downloader"
        reports = "CSIT-19190"
        version = "201911080950"
        last_modified = "2019-11-08"
        malware_family = "Phorpiex"
    strings:
        $env1 = "%windir%" wide
        $env2 = "%userprofile%" wide
        $env3 = "%systemdrive%" wide
        $env4 = "%temp%" wide
        $comms1 = "%st.php?new=1"
        $comms2 = "%st.php?on=1"
        $comms3 = "Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:67.0) Gecko/20100101 Firefox/67.0"
        $misc1 = "\\winsvcs.txt" wide
        $misc2 = "CryptVerifySignature"
        $misc3 = "%ls:Zone.Identifier" wide
    condition:
        2 of ($env*) and
        2 of ($comms*) and
        all of ($misc*)
}

rule CrowdStrike_CSIT_19196_01 : dropper konni konniftp macro 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects strings present in the macro used for dropping Konni FTP"
        reports = "CSIT-19196"
        version = "201910251251"
        last_modified = "2019-10-25"
        malware_family = "KonniFTP"
    strings:
        $hex1 = "5C7379736E61746976655C636D642E657865202F71202F6320"
        $hex2 = "5C73797374656D33325C636D642E657865202F71202F6320"
        $cmd1 = "copy /y %windir%\\system32\\certutil.exe"
        $cmd2 = "\\sysnative\\cmd.exe"
        $color = "wdBlack"
    condition:
        (all of ($cmd*) or all of ($hex*)) and $color
}

rule CrowdStrike_Kekeo_01 : credential_dumper kekeo 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects the Kekeo Kerberos manipulation library used for credential dumping"
        version = "201910111035"
        last_modified = "2019-10-11"
    strings:
        $ = "[DCSs] No KDC specified, neither user password: using default KDC" wide
        $ = "Break on first injection when Pass-the-Ticket" wide
        $ = "Unable to get SID and/or RID from a PAC" wide
        $ = "Argument '/server:{name|ip}' is needed" wide
        $ = "  - Server returned FILE_NOT_FOUND (not vulnerable" wide
    condition:
        all of them
}

rule CrowdStrike_Rubeus_01 : credential_dumper rubeus 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects C# implementation of Kerberos manipulation tool Rubeus"
        version = "201910111035"
        last_modified = "2019-10-11"
        malware_family = "Rubeus"
    strings:
        $a = { 00 31 04 1f 18 2b 02 1f 17 02 28 }
        $b = { 11 08 1f 64 5a 07 18 12 03 28 }
        $c = { 03 08 58 10 01 0e 07 03 0e 06 }
    condition:
        all of them
}

rule CrowdStrike_Rubeus_02 : credential_dumper rubeus 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects C# kerberos manipulation tool Rubeus"
        version = "201910111035"
        last_modified = "2019-10-11"
        malware_family = "Rubeus"
    strings:
        $ = "*[System[EventID=4624 and TimeCreated[timediff(@SystemTime) <= {0}]]]" wide
        $ = "[*] base64(ticket.kirbi) for SPN '{0}/{1}':" wide
        $ = "[*] Building S4U2proxy request for service: '{0}'" wide
        $ = "[*] Building S4U2self request for: '{0}@{1}'" wide
        $ = "[X] You must supply a /password , or a [/des|/rc4|/aes128|/aes256] hash!" wide
        $ = "^(SYSTEM|LOCAL SERVICE|NETWORK SERVICE|UMFD-[0-9]+|DWM-[0-9]+|ANONYMOUS LOGON)$" wide
        $ = "[!] /user:X and /domain:Y need to be supplied to calculate AES and DES hash types!" wide
        $ = "[X] Alternatively, supply a /user and </rc4:X | /aes256:X> hash to first retrieve a TGT." wide
        $ = "[*]         Use /ticket:X or /tgtdeleg to force RC4_HMAC for these accounts." wide
        $ = "[X] /creduser specification must be in fqdn format (domain.com\\user)" wide
        $ = "[*] Searching for accounts that support AES128_CTS_HMAC_SHA1_96/AES256_CTS_HMAC_SHA1_96" wide
        $ = "invalid character U+{0:X4} in OID" wide
    condition:
        9 of them and
        filesize < 792576
}

rule CrowdStrike_CSIT_19222_01 : downloader ecrime getandgo graceful_spider unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects unpacked GetAndGo Loader samples"
        reports = "CSIT-19222"
        version = "202011301558"
        last_modified = "2020-11-30"
        actor = "GRACEFUL SPIDER"
        malware_family = "GetAndGoLoader"
    strings:
        $s1 = "{<html>}" wide
        $s2 = "{</html>}" wide
        $s3 = "&PR=" wide
        $s4 = "&OS=" wide
        $s5 = "&U=" wide
        $s6 = "&D=" wide
        $re01 = "a([a-zA-Z0-9])" wide fullword
        $re02 = "b([ \\t])" wide fullword
        $re03 = "c([a-zA-Z])" wide fullword
        $re04 = "d([0-9])" wide fullword
        $re05 = "h([0-9a-fA-F])" wide fullword
        $re06 = "q(\"[^\"]*\")|('[^']*')" wide fullword
        $re07 = "w([a-zA-Z]+)" wide fullword
        $re08 = "z([0-9]+)" wide fullword
        $re09 = "charset={[A-Za-z0-9\\-_]+}" wide fullword
        $re10 = "Content-Length: {[0-9]+}" wide fullword
        $re11 = "Location: {[0-9]+}" wide fullword
        $re12 = "Set-Cookie:\\b*{.+?}\\n" wide fullword
    condition:
        uint16(0) == 0x5A4D and 9 of ($re*) and 5 of ($s*)
}

rule CrowdStrike_CSIT_19188_02 : jasperloader loader vbscript 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detect the Visual Basic Script version of the Jasperloader malware family"
        reports = "CSIT-19188,CSIT-19211"
        version = "201912101004"
        last_modified = "2019-12-10"
        malware_family = "JasperLoader"
    strings:
        $s1 = "CreateObject(\"WScript.Shell\").Run"
        $r1 = /Sub [a-z]{4,6}\n(([a-z][a-z][a-z][a-z]|[a-z][a-z][a-z][a-z][a-z]) \-([0-9][0-9]|[0-9][0-9][0-9])\r\n){30,}/
        $r2 = /(([a-z][a-z][a-z][a-z]|[a-z][a-z][a-z][a-z][a-z])  "([0-9][0-9]|[0-9][0-9][0-9]|[0-9][0-9][0-9][0-9]):([0-9][0-9]|[0-9][0-9][0-9]|[0-9][0-9][0-9][0-9])"\r\n){30,}/
        $r3 = /(([a-z][a-z][a-z][a-z]|[a-z][a-z][a-z][a-z][a-z])  "([0-9][0-9]|[0-9][0-9][0-9]|[0-9][0-9][0-9][0-9])[A-Z]([0-9][0-9]|[0-9][0-9][0-9]|[0-9][0-9][0-9][0-9])"\r\n){30,}/
    condition:
        $s1 and (1 of ($r*))
}

rule CrowdStrike_CSIT_19188_01 : jasperloader loader powershell ransomware 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects the PowerShell ransomware component that is part of the Jasperloader"
        reports = "CSIT-19188,CSIT-19211"
        version = "201911201622"
        last_modified = "2019-11-20"
        malware_family = "JasperLoader"
    strings:
        // Generic
        $s1 = ".Key = (new-Object Security.Cryptography.PasswordDeriveBytes"
        $s2 = "Security.Cryptography.SHA1Managed).ComputeHash( "
        $s3 = "wbadmin delete catalog -quiet"
        $s4 = "wbadmin delete systemstatebackup"
        $s5 = "vssadmin delete shadows /all /quiet"
        $s6 = "Get-PSDrive|Where-Object {$_.Free -gt 50000}|Sort-Object -Descending"
        // Pre 1008.1
        $old1 = "[Web.Security.Membership]::GeneratePassword(50, 4)"
        $old2 = "Yes, You can Decrypt Files Encrypted!!!</b> our price 500 USD</h2>"
        // Post 1008.1
        $v1008_1 = ").CreationTime) -End (Get-Date)).Minutes ) -gt 30"
        $v1008_2 = "&status=start"
        $v1008_3 = "&status=done&res="
    condition:
        all of ($s*) and (all of ($v1008*) or all of ($old*))
}

rule CrowdStrike_CSIT_19196_04 : konni konniftp rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects strings present in the main DLL file of the Konni FTP variant"
        reports = "CSIT-19196"
        version = "201910251252"
        last_modified = "2019-10-25"
        malware_family = "KonniFTP"
    strings:
        $pull = "pull" wide ascii
        $put = "put" wide ascii
        $chip = "chip" wide ascii
        $st = "/stext" wide ascii
        $rclsid = { 20 96 70 13 79 c2 ce 11 a4 9e 44 45 53 54 00 00 }
    condition:
        all of them and
        filesize <500KB
}

rule CrowdStrike_CSA_191232_01 : artifact magiclogger rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Matches on the RSA exponent used in MagicLogger samples"
        reports = "CSA-191232"
        version = "201910181557"
        last_modified = "2019-10-18"
        malware_family = "MagicLogger"
    strings:
        $exponent = { ff 8e 52 81 15 7d 70 4c 4b 3c e4 70 90 1f cc 60 25 61 a5 16 c5 bf 15 d7 15 50 f9 27 4d a9 b0 0e }
    condition:
        $exponent
}

rule CrowdStrike_CSA_191232_02 : artifact magiclogger rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects the characteristic decryption loop in MagicLogger components"
        reports = "CSA-191232"
        version = "201910181557"
        last_modified = "2019-10-18"
        malware_family = "MagicLogger"
    strings:
        $dec_loop = { 8a 01 04 06 8a d0 d0 ea c0 e0 07 0a d0 80 f2 03 f6 da 88 11 }
    condition:
        $dec_loop
}

rule CrowdStrike_CSA_191241_02 : jeus labyrinth_chollima rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects XOR key or form delimiter present in updated variant of Jeus"
        reports = "CSA-191241"
        version = "202002031523"
        last_modified = "2020-02-03"
        actor = "LABYRINTH CHOLLIMA"
        malware_family = "Jeus"
    strings:
        $key = {58 2C 25 60 50 4D 6B 2D 2D 4A 6A 38 73 2B 36 3D}
        $delim = "jGzAcN6k4VsTRn9"
    condition:
        any of them
}

rule CrowdStrike_CSA_191241_01 : certificate jeus labyrinth_chollima 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects one of the code signing certificates used by LABYRINTH CHOLLIMA for Jeus implant"
        reports = "CSA-191241"
        version = "202002031523"
        last_modified = "2020-02-03"
        actor = "LABYRINTH CHOLLIMA"
        malware_family = "Jeus"
    strings:
        $cn = "JMT TRADING GROUP INC"
        $serial = {00 91 3b a1 69 62 cd 7e ee 25 96 5a 6d 0e ef fa 10}
    condition:
        all of them
}

rule CrowdStrike_CSIT_19196_06 : installer konni nokki 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects strings in the batch file used to install both Nokki and Konni variants"
        reports = "CSIT-19196"
        version = "202003271720"
        last_modified = "2020-03-27"
        malware_family = "KonniFTP"
    strings:
        $echo = "@echo off"
        $err = "if %ERRORLEVEL% equ 0 (goto INSTALL) else (goto COPYFILE)"
        $copy = ":COPYFILE"
        $ins = ":INSTALL"
        $sc = "sc config"
        $reg = "reg add "
    condition:
        all of them
}

rule CrowdStrike_CSIT_19196_05 : konni konniftp rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects strings present in the main DLL file of the updated Konni FTP variant"
        reports = "CSIT-19196"
        version = "201910251252"
        last_modified = "2019-10-25"
        malware_family = "KonniFTP"
    strings:
        $fmt1 = { 25 77 73 20 25 77 73 20 22 25 77 73 22 00 }
        $fmt2 = { 25 77 73 20 25 77 73 00 25 77 73 20 25 77 73 20 22 25 77 73 22 00 }
    condition:
        all of them and
        filesize <500KB
}

rule CrowdStrike_CSIT_19190_02 : ecrime phorpiex unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects module deployed by Phorpiex Downloader that attempts to spread via weak VNC passwords"
        reports = "CSIT-19190"
        version = "201911080950"
        last_modified = "2019-11-08"
        malware_family = "Phorpiex, Phorpiex VNC Spreader"
    strings:
        $s1 = "work123"
        $s2 = "a1b2c3"
        $s3 = "cmd.exe /c bitsadmin /transfer"
        $s4 = "%ls:Zone.Identifier" wide
        $s5 = "%ls:*:Enabled:%s" wide
        $s6 = "RFB %03d.%03d"
        $uri = "/vnc.php?v="
    condition:
        4 of ($s*) and $uri
}

rule CrowdStrike_CSA_191281_01 : blackremote commodity dotnet rat unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Unpacked commodity Blackremote RAT"
        reports = "CSA-191281"
        version = "201910251251"
        last_modified = "2019-10-25"
        malware_family = "Blackremote RAT"
    strings:
        $msg1 = "AddFileFound|" wide
        $msg2 = "GetMicL|" wide
        $msg3 = "StartKeyboard|" wide
        $msg4 = "TCMon|" wide
        $msg5 = "NewID|" wide
        $msg6 = "GetHosts|" wide
        $msg7 = "MyInfo|" wide
        $msg8 = "DSPreview|" wide
        $msg9 = "AddCam|" wide
        $msg10 = "StartCamera|" wide
        $msg11 = "StopCamera|" wide
        $msg12 = "DownloadStart|" wide
        $msg13 = "DownloadPacket|" wide
        $msg14 = "Album|" wide
        $msg15 = "UploadStart|" wide
    condition:
        4 of ($msg*)
}

rule CrowdStrike_CSIT_19196_08 : downloader nokki 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects strings present in the Nokki HTTP first stage downloader"
        reports = "CSIT-19196"
        version = "201910251252"
        last_modified = "2019-10-25"
        malware_family = "Nokki"
    strings:
        $post = "subject=%s&data="
        $path = "log-%s"
        $stat = "status"
        $time = "%c%c.%c%c-%c%c.%c%c.%c%c"
    condition:
        all of them and
        filesize < 1MB
}

rule CrowdStrike_CSIT_19196_09 : downloader nokki 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects strings present in the Nokki HTTP variant two"
        reports = "CSIT-19196"
        version = "201910251252"
        last_modified = "2019-10-25"
        malware_family = "Nokki"
    strings:
        $post = "subject=%s&data="
        $url = "%s-file-%s"
        $time = "%c%c.%c%c-%c%c.%c%c.%c%c"
        $set = "SetWindowsHookExW"
    condition:
        all of them and
        filesize <1MB
}

rule CrowdStrike_CSIT_20056_01 : clambling unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects all known versions of unpacked Clambling payloads"
        reports = "CSIT-20056"
        version = "202008281158"
        last_modified = "2020-08-28"
        malware_family = "Clambling"
    strings:
        $str_params_1 = "Param: hp=%d; hp=%d; hp=%d; hp=%d; hp=%d;"
        $str_params_2 = "Param: sl=%d; sl=%d; sl=%d; sl=%d; sl=%d;"
        $str_params_3 = { 4d 65 73 73 61 67 65 2d 49 64 3a 20 25 64 00 00 50 72 61 67 6d 61 3a 20 25 64 00 }
        $str_fmt_wide_keys_1 = { 5b 00 25 00 30 00 32 00 64 00 3a 00 25 00 30 00 32 00 64 00 3a 00 25 00 30 00 32 00 64 00 20 00 25 00 30 00 34 00 64 00 2d 00 25 00 30 00 32 00 64 00 2d 00 25 00 30 00 32 00 64 00 20 00 5d 00 20 00 7c 00 25 00 73 00 20 00 7c 00 20 00 25 00 73 00 20 00 7c 00 20 00 25 00 73 00 20 00 0d 00 0a 00 }
        $str_fmt_wide_keys_2 = { 25 00 30 00 34 00 64 00 2d 00 25 00 30 00 32 00 64 00 2d 00 25 00 30 00 32 00 64 00 20 00 25 00 30 00 32 00 64 00 3a 00 25 00 30 00 32 00 64 00 3a 00 25 00 30 00 32 00 64 00 }
        $str_pipe_string_1 = { 5c 5c 2e 5c 50 49 50 45 5c 53 4b 25 64 00 }
        $str_pipe_string_2 = { 5c 5c 2e 5c 50 49 50 45 5c 53 4f 43 25 64 00 }
        $str_pipe_string_3 = { 5c 00 5c 00 2e 00 5c 00 70 00 69 00 70 00 65 00 5c 00 4f 00 25 00 64 00 00 00 }
        $str_plugin_classname_1 = { 2e 3f 41 56 43 48 50 50 6c 75 67 69 6e 40 40 00 }
        $str_plugin_classname_2 = { 2e 3f 41 56 43 50 6c 75 67 69 6e 40 40 00 }
    condition:
        any of ($str_params_*) and
        any of ($str_fmt_wide_keys_*) and
        any of ($str_pipe_string_*) and
        any of ($str_plugin_classname_*)
}

rule CrowdStrike_CSIT_19201_03 : loader plugx 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Loader seen with samples of PlugX possibly related to INetGetSploit activity"
        reports = "CSIT-19201"
        version = "202104071337"
        last_modified = "2021-04-07"
        malware_family = "PlugX"
    strings:
        $str_junk_long = "HUIHWASDIHWEIUDHDSFSFEFWEFEWFDSGEFERWGWEEFWFWEWD" wide fullword
        $str_gateway_bing = "TPUDPGateway.bin" wide fullword
        $code_xor20 = { 80 34 30 20 40 3b c7 7c f7 }
        $code_xorstring = { b8 1f 85 eb 51 f7 e1 c1 ea 04 6b d2 32 8b c1 2b c2 8a 54 05 c8 30 14 31 41 3b cf }
    condition:
        filesize < 200KB and
        2 of them
}

rule CrowdStrike_CSIT_19192_01 : banking banking_trojan dridex dridex_core indrik_spider 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects Dridex Core version 4 assembly patterns"
        reports = "CSIT-19192"
        version = "202010221129"
        last_modified = "2020-10-22"
        actor = "INDRIK SPIDER"
        malware_family = "Dridex"
    strings:
        $bot_version_v4 = { ff ?? ?? ?? 00 00 8b cf e8 [4] 68 ?? ?? 04 00 8b cf e8 }
        $bot_version_v4_2 = { ff ?? ?? ?? 00 00 e8 [4] 68 ?? ?? 04 00 8b cf e8 }
        $asm_rc4_decrypt = { e8 ?? ?? ?? ?? 3d 22 04 49 d2 74 ?? }
        $asm_rc4_decrypt_2 = { 3d 2c 50 98 75 }
        $asm_p2p_incoming = { 0f b6 c0 83 e8 64 0f 84 }
        $asm_200_ok = { b? 30 30 32 30 [0-16] b? 33 30 35 30 }
        $asm_p2p_pong = { e8 [4] 3d 47 4e 4f 50 }
        $asm_c2_resp = { 83 e? 10 0f 84 [4] 4? 83 e? 01 0f 84 [4] 83 e? 01 0f 84 }
    condition:
        1 of ($bot_version*) and
        4 of ($asm*)
}

rule CrowdStrike_CSIT_19196_02 : downloader konni konniftp 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects the downloader batch file script used by Konni FTP"
        reports = "CSIT-19196"
        version = "201910251251"
        last_modified = "2019-10-25"
        malware_family = "KonniFTP"
    strings:
        $echo = "@echo off"
        $x86 = "if not exist \"%PROGRAMFILES(x86)%"
        $chk = ":CHECK_ADMIN"
        $net = "net session > nul"
        $na = ":NONADMIN"
        $ins = "%TEMP%\\install.bat > nul"
        $url = "-urlcache -split -f"
    condition:
        all of them
}

rule CrowdStrike_CSIT_19218_01 : labyrinth_chollima matanet rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects strings present in MataNet implant used by LABYRINTH CHOLLIMA"
        reports = "CSIT-19218"
        version = "202004061712"
        last_modified = "2020-04-06"
        actor = "LABYRINTH CHOLLIMA"
        malware_family = "MataNet"
    strings:
        $str_hash1 = {4C 77 26 07}
        $str_hash2 = {69 D3 CE 6B}
        $str_cls_1 = "c_2910.cls" fullword
        $str_cls_2 = "k_3872.cls" fullword
    condition:
        all of them
}

rule CrowdStrike_CSIT_21043_01 : cozy_bear morpher obfuscator 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects characteristic byte code generated by COZY BEAR's Morpher crypter"
        reports = "CSIT-21043"
        version = "202106251058"
        last_modified = "2021-06-25"
        actor = "COZY BEAR"
        malware_family = "Morpher"
    strings:
        $ = { 89 54 24 10 89 4c 24 08 48 83 ec 18 8b 44 24 20 ff c8 8b 4c 24 28 ff c9 f7 d1 }
    condition:
        all of them
}

rule CrowdStrike_CSIT_20027_02 : labyrinth_chollima manuscrypt powershell rat webtroy 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects PowerShell variants of LABYRINTH CHOLLIMA's WebTroy RAT"
        reports = "CSIT-20027"
        version = "202003021454"
        last_modified = "2020-03-02"
        actor = "LABYRINTH CHOLLIMA"
        malware_family = "WebTroy"
    strings:
        $glob = "$global:"
        $c1 = "[System.Buffer]::BlockCopy"
        $c2 = "[System.IO.FileMode]::Append"
        $c3 = "Test-Connection -ComputerName"
    condition:
        all of them
        and #glob > 50
        and filesize < 30KB
        and filesize > 1KB
}

rule CrowdStrike_CSIT_19214_03 : ecrime graceful_spider rat sdbbot unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects the core bot component of SDBBot"
        reports = "CSIT-19214"
        version = "202102161536"
        last_modified = "2021-02-16"
        actor = "GRACEFUL SPIDER"
        malware_family = "SDBBot"
    strings:
        $bstr0 = "windows_7_windows_10_check_running_once_mutex"
        $bstr1 = "keep_bot_online on"
        $bstr2 = "BOTCFGBOTCFG"
        $bstr3 = "sdb.log.txt" wide fullword
        $bstr4 = "RedirectEXE" wide fullword
        $bstr5 = "runreflective" fullword
        $bstr6 = "Received file is not PE executable"
        $bstr7 = "BotDLL.dll" fullword
        $bstr8 = "c:\\ip.txt" fullword
        $bstr9 = "BotInfo.txt" wide fullword
        $bstr10 = "Unknown reason (this should not happen)"
        $bstr11 = "ReconnectMode="
        $bstr12 = "builder.cfg" fullword
        $bstr13 = "Error: Can't establish connect"
    condition:
        5 of ($bstr*)
}

rule CrowdStrike_CSIT_19204_01 : warlord_kitten 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects .NET GUIDs used to compile OtakuKit Malware"
        reports = "CSIT-19204"
        version = "202005151248"
        last_modified = "2020-05-15"
        actor = "WARLORD KITTEN"
        malware_family = "OtakuKit"
    strings:
        //Sakabota 3314cc701f5c9030622de055879141f6e8c23408029995bd7a88374008aa4390
        $ = "69806d9a-2b07-482c-aa40-7a2d79d2f6c8" wide ascii
        //Gon 8391c571bffb3ce538ace4d8a3388b28eb486cca5bdab08ab7b568b4e8fc0ec8
        $ = "36d77c64-0d18-4c7a-8488-cd901d8bcba1" wide ascii
        //Diezen 054736b827e07d5e461b0a900ad54b0bcb58bdc23a5c607697a1e6c452b3570d
        $ = "74f58a95-3b09-4a71-97e0-fb0a4adf68b8" wide ascii
        //Hisoka 892d5e8e763073648dfebcfd4c89526989d909d6189826a974f17e2311de8bc4
        $ = "22112edc-c204-4d3a-b85b-e84c7d4249c3" wide ascii
        //Hisoka 3996efe9a3cf471a1f816287368fa0f99d2cdb95786530b0b61c7b9024ff717b
        $ = "971aeddb-66d3-4f1f-9644-d65aeeb14980" wide ascii
        //EYE 84122b55e5552af1752a00f1a268247feca7e7dbeb4c4cd7b3f5a3005a19fe16
        $ = "304f8240-1f00-42c5-9347-4ecf35848955" wide ascii
    condition:
        uint16(0) == 0x5a4d and any of them
}

rule CrowdStrike_CSIT_19204_02 : warlord_kitten 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects modified timestamps used by OtakuKit tools"
        reports = "CSIT-19204"
        version = "202005151248"
        last_modified = "2020-05-15"
        actor = "WARLORD KITTEN"
        malware_family = "OtakuKit"
    strings:
        //Hisoka - 3996efe9a3cf471a1f816287368fa0f99d2cdb95786530b0b61c7b9024ff717b
        //$ date -r $[0xcf81a153]
        //Fri Apr 26 10:45:55 PDT 2080
        $ = {4c 01 03 00  53 a1 81 cf}
        //Hisoka - 892d5e8e763073648dfebcfd4c89526989d909d6189826a974f17e2311de8bc4
        //$ date -r $[0x97d648a6]
        //Wed Sep 21 12:55:18 PDT 2050
        $ = {4c 01 03 00  a6 48 d6 97}
        //Gon - 8391c571bffb3ce538ace4d8a3388b28eb486cca5bdab08ab7b568b4e8fc0ec8
        //$ date -r $[0xeca2d16b]
        //Fri Oct 21 20:43:39 PDT 2095
        $ = {4c 01 03 00  6b d1 a2 ec}
    condition:
        any of them
}

rule CrowdStrike_CSIT_19204_03 : warlord_kitten 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects FTP credential used by Sakabota tool from OtakuKit"
        reports = "CSIT-19204"
        version = "202005151248"
        last_modified = "2020-05-15"
        actor = "WARLORD KITTEN"
        malware_family = "OtakuKit"
    strings:
        $ = "Mono8&^Ujm" ascii
        $ = {4d 00 6f 00 6e 00 6f 00 38 00 26 00 5e 00 55 00 6a 00 6d 00}
    condition:
        uint16(0) == 0x5a4d and any of them
}

rule CrowdStrike_CSA_191305_03 : fancy_bear zekadero 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects the unhexlify routine in Zekadero samples"
        reports = "CSA-191305"
        version = "201911011611"
        last_modified = "2019-11-01"
        actor = "FANCY BEAR"
        malware_family = "Zekadero"
    strings:
        $ = { ff 45 a0 66 c7 45 94 30 00 8d 4d D8 89 4d 80 8d 45 B0 89 85 7c ff ff ff 66 c7 45 94 48 00 }
    condition:
        all of them
}

rule CrowdStrike_CSA_191305_01 : fancy_bear zekadero 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects Zekadero samples based on multiple characteristics"
        reports = "CSA-191305"
        version = "201911011617"
        last_modified = "2019-11-01"
        actor = "FANCY BEAR"
        malware_family = "Zekadero"
    strings:
        $compilername = "Embarcadero RAD Studio"
        $containername = { 4D 00 59 00 5F 00 43 00 43 00 00 00 }
        $sizecheck1 = { 59 83 F8 28 }
        $sizecheck2 = { 59 3D 00 04 00 00 }
    condition:
        all of them
}

rule CrowdStrike_CSA_191305_02 : fancy_bear zekadero 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Hex-Encoded HTTP and HTTPS with prefixed null-byte and Embarcadero Delphi Compiler"
        reports = "CSA-191305"
        version = "201911011606"
        last_modified = "2019-11-01"
        actor = "FANCY BEAR"
        malware_family = "Zekadero"
    strings:
        $compilername = "Embarcadero RAD Studio"
        $https = { 00 36 38 37 34 37 34 37 30 37 33 33 41 32 46 32 }
        $http = { 00 36 38 37 34 37 34 37 30 33 41 32 46 32 }
    condition:
        ($https or $http) and $compilername
}

rule CrowdStrike_WIFIService_01 : rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects malware installing itself as a service named WIFIService."
        version = "201911011614"
        last_modified = "2019-11-01"
        
    strings:
        $ = " -s %d"
        $ = "\\qbw021019.dat"
        $ = "captcha_%d"
        $ = "Software\\WIFIService"
    condition:
        all of them
}

rule CrowdStrike_BeamLoader_01 : downloader loader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects Beamloader samples."
        version = "202101292052"
        last_modified = "2021-01-29"
    strings:
        $ = "Beam loader developed by Danij"
        $ = "BeamWinHTTP.pdb"
        $ = "Accept-Language: ru-RU,ru;"
    condition:
        all of them
}

rule CrowdStrike_CSA_191324_01 : backdoor lotus_panda trapdoor 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects distinctive strings found in TrapDoor passive backdoor"
        reports = "CSA-191324"
        version = "202012011453"
        last_modified = "2020-12-01"
        actor = "LOTUS PANDA"
        malware_family = "TrapDoor"
    strings:
        $ = "[(!@#098ABCzyw)]"
        $ = "[!] Failed to execute shell, error = %d"
        $ = { 00 73 79 73 74 65 6d 69 6e 66 6f 00 00 0a 0a 00 }
        $ = "??0Cssdll@@"
    condition:
        filesize<500KB and 2 of them
}

rule CrowdStrike_Backdoor_Metasploit_Loader : loader metasploit 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Backdoor application used to load Metasploit shellcode  "
        version = "202007221746"
        last_modified = "2020-07-22"
    strings:
        /*
        .text:00401084 80 34 01 FA                             xor     byte ptr [ecx+eax], 0FAh
        .text:00401088 41                                      inc     ecx
        .text:00401089 3B CA                                   cmp     ecx, edx
        .text:0040108B 72 F7                                   jb      short loc_401084
        */
        $ = {80 34 01 ?? 41 3B CA 72 F7}
        $ = {8AC880E17F0288??????00403288??????00884C30FF83F81F7CE5}
    condition:
        all of them
}

rule CrowdStrike_CSA_200216_03 : banking culebra_variant downloader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detect samples of the Culebra Variant downloader"
        reports = "CSA-200216"
        version = "202106081532"
        last_modified = "2021-06-08"
        malware_family = "Culebra Variant"
    strings:
        $ = "str+= String.fromCharCode(parseInt("
        $ = "Math.floor(Math.random()*"
        $ = "array=value.split(\"\\x2D\")"
        $ = "){var str='';for(var i=0;i<"
        $ = ".SetTimeouts(30000,30000,30000,5000);void((("
        $ = "item().size<= 10000){"
        $ = "shell.NameSpace("
        $ = ".getFile("
        $ = ".getFolder("
        $ = ".moveNext()){if("
        $ = ".IconLocation= "
        $ = ".Hotkey= \"\";"
        $ = ".Description= \""
    condition:
        4 of them
}

rule CrowdStrike_CSA_200216_04 : banking brazilian culebra_variant trojan 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects samples of Culebra Variant"
        reports = "CSA-200216"
        version = "202105241202"
        last_modified = "2021-05-24"
        malware_family = "Culebra Variant"
    strings:
        $ = "5VANV4SDMC3VEAFR8S2M3M9U6WRH3P7FDD9T9Q10IAG5WZJ5K5" wide
        $ = "Magnification.dll" wide
        $ = "Shell_traywn d" wide
        $ = "/qn /norestart" wide
        $ = "cmd /c msiexec /i" wide
        $ = "clav.op:" wide
        $ = "clav.seg:" wide
        $ = "CL4vE:" wide
        $ = "PrinWindow" wide
        $ = " ser:" wide
        $ = "Criou Host Mag:" wide
    condition:
        5 of them
}

rule CrowdStrike_Colonbreak_Dropper_01 : colonbreak dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects a VBS dropper known to deliver various crimeware"
        version = "202105190949"
        last_modified = "2021-05-19"
        malware_family = "Colonbreak"
    strings:
        $s1 = ":::.Close:::End With"
        $s2 = "Then:::WScript.Quit"
        $s3 = ":::Else:::End If:::"
        $s4 = ":::End If:::End Function::::::Function"
        $s5 = ":::const "
        // regular expression causes problems with yara 3.6.3
        // $ar = /:{1,3}\w{1,50}\s?=\s?Array\(\s?(\w{1,5},\s?){200,}/
    condition:
        3 of them
}

rule CrowdStrike_CSIT_19214_01 : ecrime graceful_spider rat sdbbot unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects the installer component of SDBBot"
        reports = "CSIT-19214"
        version = "202011301618"
        last_modified = "2020-11-30"
        actor = "GRACEFUL SPIDER"
        malware_family = "SDBBot"
    strings:
        $istr0 = "UpdateRegCodeStarter"
        $istr1 = "Installing sdb..."
        $istr2 = "SdbInstallerDll.dll"
        $istr3 = "RegCodeLoader.dll"
        $istr4 = "InstallHelperAsUser: can't"
        $istr5 = "Version: %d.%d.%d %s" fullword
        $istr6 = "No shellcode data found (.data1)"
        $istr7 = "sdb_" wide fullword
        $istr8 = "-q -p \"%s\"" wide fullword
        $istr9 = "PEFILE: search export ordinal by name ordinals not implemented."
    condition:
        5 of ($istr*)
}

rule CrowdStrike_CSIT_19214_02 : ecrime graceful_spider rat sdbbot unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects the registry code loader component of SDBBot"
        reports = "CSIT-19214"
        version = "202011301618"
        last_modified = "2020-11-30"
        actor = "GRACEFUL SPIDER"
        malware_family = "SDBBot"
    strings:
        $lasm0 = { 8a dd c1 c8 0d 8a cd 8d 76 0? 80 e9 20 80 eb 61 }
        $lasm1 = { 50 68 19 00 02 00 8d 44 24 ?? c7 44 24 ?? 00 00 00 00 }
        $lasm2 = { 50 6a ff ff 54 24 ?? }
        $lasm3 = { 55 8b ec 83 ec ?? 64 a1 18 00 00 00 }
    condition:
        3 of ($lasm*)
}

rule Crowdstrike_CSIT_19203_01 : dropper pcshare rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects a particular PcShare loader/dropper that has been used in attacks against South-East Asian telcos"
        reports = "CSIT-19203"
        version = "201911151631"
        last_modified = "2019-11-15"
        malware_family = "PcShare"
    strings:
        $s_dropped_1 = "%sNvSmartMax.dat" ascii
        $s_dropped_2 = "%sNvSmartMax.dll" ascii
        $s_dropped_3 = "%snvSmart.exe" ascii
        $s_app_name = "Local AppWizard-Generated Applications" ascii
        $s_app_doc_1 = "CF1Doc" ascii
        $s_app_doc_2 = "CF1View" ascii
        $s_classname = "CMainFrame" ascii
        /*
        push    0; hTemplateFile
        push    80h ; ; dwFlagsAndAttributes
        push    2; dwCreationDisposition
        push    0; lpSecurityAttributes
        push    1; dwShareMode
        push    40000000h; dwDesiredAccess
        push    eax; lpFileName
        */
        $code_drop_file = { 6A 00 68 80 00 00 00 6A 02 6A 00 6A 01 68 00 00 00 40 5? }
        $api_1 = "WinExec" ascii
        $api_2 = "CreateProcessA" ascii
        $api_3 = "GetTempPathA" ascii
    condition:
        uint16(0) == 0x5A4D and filesize > 200KB and filesize < 4096KB and 4 of ($s_*) and $code_drop_file and 1 of ($api*)
}

rule Crowdstrike_CSIT_19203_02 : pcshare rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects the malicious DLL that is used to load PcShare. Has been used in attacks against South-East Asian telcos"
        reports = "CSIT-19203"
        version = "201911181420"
        last_modified = "2019-11-18"
        malware_family = "PcShare"
        
    strings:
        // 0x100043ac 2b fd    sub    edi, ebp
        // 0x100043ae 4d    dec    ebp
        // 0x100043af 85 ed    test    ebp, ebp
        // 0x100043b1 8d 47 01    lea    eax, [edi + 1]
        // 0x100043b4 74 1d    je    0x100043d3
        // 0x100043b6 8b 7c 24 18    mov    edi, dword ptr [esp + 0x18]
        // 0x100043ba 2b f8    sub    edi, eax
        // 0x100043bc 8a 08    mov    cl, byte ptr [eax]
        // 0x100043be 8a 14 ??    mov    dl, byte ptr [edi + eax]
        $code_1 = { 2b fd 4d 85 ed 8d 47 01 74 1d 8b 7c 24 18 2b f8 8a 08 8a 14 } // sample=c5226bfd53d789a895559e8bcbedc4ecdde543e54a427b1cb4e5d7ef90756daa address=0x100043ac
        // 0x10004b56 ?? 6b 08    mov    dword ptr [ebx + 8], ebp
        // 0x10004b59 c6 04 28 00    mov    byte ptr [eax + ebp], 0
        // 0x10004b5d eb 34    jmp    0x10004b93
        // 0x10004b5f 2b 7d 0c    sub    edi, dword ptr [ebp + 0xc]
        // 0x10004b62 4f    dec    edi
        // 0x10004b63 89 7c 24 20    mov    dword ptr [esp + 0x20], edi
        // 0x10004b67 eb 2a    jmp    0x10004b93
        // 0x10004b69 8b 4d ??    mov    ecx, dword ptr [ebp + 0xc]
        $code_2 = { 6b 08 c6 04 28 00 eb 34 2b 7d 0c 4f 89 7c 24 20 eb 2a 8b 4d } // sample=c5226bfd53d789a895559e8bcbedc4ecdde543e54a427b1cb4e5d7ef90756daa address=0x10004b57
        // 0x1000423a ?? ef    mov    ebp, edi
        // 0x1000423c 8b 42 0c    mov    eax, dword ptr [edx + 0xc]
        // 0x1000423f 2b e8    sub    ebp, eax
        // 0x10004241 2b ee    sub    ebp, esi
        // 0x10004243 85 c9    test    ecx, ecx
        // 0x10004245 75 0e    jne    0x10004255
        // 0x10004247 8d 44 2e ff    lea    eax, [esi + ebp - 1]
        // 0x1000424b 89 32    mov    dword ptr [edx], esi
        // 0x1000424d 89 42 ??    mov    dword ptr [edx + 4], eax
        $code_3 = { ef 8b 42 0c 2b e8 2b ee 85 c9 75 0e 8d 44 2e ff 89 32 89 42 } // sample=c5226bfd53d789a895559e8bcbedc4ecdde543e54a427b1cb4e5d7ef90756daa address=0x1000423b
        $s_api_1 = "CreateMutexW" ascii
        $s_api_2 = "GetModuleFileNameA" ascii
        $s_api_3 = "VirtualAlloc" ascii
        $s_api_4 = "GetProcAddress" ascii
        $s_api_5 = "DeleteFileA" ascii
        $s_api_6 = "MoveFileA" ascii
        $s_api_7 = "RegSetValueExA" ascii
        $s_loader_1 = "Software\\Microsoft\\Windows\\CurrentVersion\\Run" ascii
        $s_loader_2 = "NvSmart" ascii
        $s_loader_3 = "GetContainingRect" ascii
        $s_loader_4 = "NvSmartMaxNotifyAppHWND" ascii
        $s_loader_5 = "NvSmartMaxUseDynamicDeviceGrids" ascii
        $s_pcshare_dropper = "Local AppWizard-Generated Applications" ascii
    condition:
        uint16(0) == 0x5A4D and all of ($code_*) and all of ($s_api_*) and 2 of ($s_loader*) and not $s_pcshare_dropper
}

rule CrowdStrike_CSIT_19210_02 : keylogger mgbot module 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects an instance of the keylogger module that is associated with MgBot malware"
        reports = "CSIT-19210"
        version = "201912271807"
        last_modified = "2019-12-27"
        malware_family = "MgBot"
    strings:
        $s1 = "@FunClass@@"
        $s2 = "%s%s.nom" wide ascii
        $s3 = "%s%s.stp" wide ascii
        $s4 = "GetAsyncKeyState"
    condition:
        all of them and uint16(0) == 0x5a4d and filesize <= 100KB
}

rule CrowdStrike_CSIT_19210_03 : infostealer mgbot module 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects an instance of the WeChat database stealer module that is associated with MgBot"
        reports = "CSIT-19210"
        version = "201912271807"
        last_modified = "2019-12-27"
        malware_family = "MgBot"
        
    strings:
        $str_seq_1 = { 72 00 62 00 00 00 00 00 46 00 49 00 4C 00 45 00 48 00 45 00 41 00 44 00 45 00 4E 00 44 00 00 00 77 00 62 00 00 00 00 00 61 00 62 00}
        $str_seq_2 = { 4D 00 73 00 67 00 00 00 2E 00 64 00 62 00 00 00 5C 00 44 00 61 00 74 00 61 00 00 00 5C 00 56 00 69 00 64 00 65 00 6F 00 }
    condition:
        all of them and uint16(0) == 0x5a4d and filesize <= 200KB
}

rule CrowdStrike_CSIT_19210_04 : infostealer mgbot module 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects an instance of removable drive information stealer module that is associated with MgBot"
        reports = "CSIT-19210"
        version = "201912271807"
        last_modified = "2019-12-27"
        malware_family = "MgBot"
        
    strings:
        $str_seq_1 = { 25 00 75 00 2F 00 25 00 75 00 2F 00 25 00 75 00 20 00 25 00 75 00 3A 00 25 00 75 00 3A 00 25 00 75 00 00 00 00 00 00 00 53 00 59 00 53 00 54 00 45 00 4D 00 5C 00 43 00 75 00 72 00 72 00 65 00 6E 00 74 00 43 00 6F 00 6E 00 74 00 72 00 6F 00 6C 00 53 00 65 00 74 00 5C 00 45 00 6E 00 75 00 6D 00 5C 00 55 00 53 00 42 00 53 00 54 00 4F 00 52 00 00 00 }
        $str1 = "\\USBInfo.dat" wide
    condition:
        all of them and filesize <= 200KB and uint16(0) == 0x5A4D
}

rule Crowdstrike_CSIT_19203_03 : pcshare rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects the main PcShare module, which has been used in attacks against South-East Asian telcos"
        reports = "CSIT-19203"
        version = "201911151631"
        last_modified = "2019-11-15"
        malware_family = "PcShare"
    strings:
        $s_proxy = "Proxy-Authorization: NTLM" ascii
        $s_importname = "RtlGetVersion" ascii
        $s_worker_procname = "WorkMainF" ascii
        $s_http_formatstring = "http://%s" ascii
        $s_iexplore = "iexplore.exe" ascii
        $s_rundll = "rundll32.exe \"%s\",%s ServerAddr=%s;ServerPort=%d;Hwnd=%d;Cmd=%d;DdnsUrl=%s;" ascii
        $s_messagebox_1 = { BE AF B8 E6 }
        $s_messagebox_2 = { B4 ED CE F3 }
        $s_messagebox_3 = { CC E1 CA BE }
        $s_polar_s_1 = "Single block msg" ascii
        $s_polar_s_2 = "PolarSSLTest" ascii
        $s_polar_aes_test_ctr_ct = { E4 09 5D 4F B7 A7 B3 79 2D 61 75 A3 26 13 11 B8 }
        $s_polar_base64_test_enc = "JEhuVodiWr2/F9mixBcaAZTtjx4Rs9cJDLbpEG8i7hPKswcFdsn6MWwINP+Nwmw4AEPpVJevUEvRQbqVMVoLlw==" ascii
        /*
        40                   inc     eax
        66 89 46 0A          mov     [esi+0Ah], ax
        8B 45 10             mov     eax, [ebp+arg_8]
        89 46 2C             mov     [esi+2Ch], eax
        8D 04 C5 1F 00 00 00 lea     eax, ds:1Fh[eax*8]
        C1 E8 05             shr     eax, 5
        C1 E0 02             shl     eax, 2
        */
        $code_lzw_decode = { 40 66 89 46 0A 8B 4? [1-2] 89 46 2C 8D 04 C5 1F 00 00 00 C1 E8 05 C1 E0 02 }
        /*
        0f b6 79 23          movzx    edi, byte ptr [ecx + 0x23]
        03 c7                add    eax, edi
        83 f8 08             cmp    eax, 8
        77 08                ja    0x100011ff
        8b 51 18             mov    edx, dword ptr [ecx + 0x18]
        */
        $code_lzw_decode_getnextcode = { 0f b6 79 23 03 c7 83 f8 08 77 0? 8b 51 18 } // sample=93af53564
        /*
        81 BD 74 F8 FF FF 4F+ cmp     [ebp+var_78C], 1F4Fh
        1F 00 00
        75 19                 jnz     short loc_10001AF6
        83 F8 04              cmp     eax, 4
        74 05                 jz      short loc_10001AE7
        83 F8 06              cmp     eax, 6
        75 0F                 jnz     short loc_10001AF6
        */
        $code_mainthread = { 81 [2-5] 4F 1F 00 00 75 ?? 83 F8 04 74 0? 83 F8 0? 75 }
    condition:
        10 of ($s_*) and 2 of ($code_*)
}

rule CrowdStrike_CSIT_19210_01 : infostealer mgbot module 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects an instance of the QQStealer module that is associated with MgBot"
        reports = "CSIT-19210"
        version = "201912271807"
        last_modified = "2019-12-27"
        malware_family = "MgBot"
    strings:
        $str_seq_1 = { 71 71 2E 65 78 65 00 00 5C 4D 73 67 33 2E 30 2E 64 62 00 00 61 63 63 65 73 73 5F 00 41 4D 50 5F 00 }
        $str_seq_2 = { 43 41 42 44 45 2D 34 37 42 39 54 2D 32 57 38 37 4A 2D 25 73 00 00 00 00 2E 44 42 51 00 00 00 00 }
        $str_seq_3 = { 72 75 6E 64 6C 6C 33 32 2E 65 78 65 00 00 00 00 63 3A 5C 31 2E 74 78 74 00 }
    condition:
        any of them and uint16(0) == 0x5a4d and filesize <= 200KB
}

rule CrowdStrike_CSA_200224_01 : banker kiron trojan 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects samples of the DLL Kiron downloader"
        reports = "CSA-200224"
        version = "202007201201"
        last_modified = "2020-07-20"
        malware_family = "Kiron"
    strings:
        $str_1 = "Shell32.dll"
        $str_2 = "ShellExecuteA"
        $str_3 = "urlmon.dll"
        $str_4 = "URLDownloadToFileA"
        $str_5 = "LOCALAPPDATA"
        $obfuscation = { D3 EB 8B CF B8 01 00 00 00 D3 E0 50 8B ?? ?? 5A 8B CA 99 F7 F9 }
        $decryption = { 8B CE 0F B7 ?? ?? D3 E8 F6 D0 30 }
    condition:
        all of ($str*) and
        ($obfuscation or $decryption)
}

rule CrowdStrike_CSA_191362_01 : anonybr carat chollima_lego dropper monorat silent_chollima 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects the bytes used in a custom decoding function observed with ANONYBR, MonoRAT and CARAT"
        reports = "CSA-191362"
        version = "201911151648"
        last_modified = "2019-11-15"
        actor = "SILENT CHOLLIMA"
        malware_family = "CARAT, MonoRAT, ANONYBR"
    strings:
        $ = {81 E7 F8 07 00 00 C1 E7 14 C1 EA 08 0B D7 8D 3C
        00 33 F8 22 C8 C1 E7 04 33 F8 32 CB 8B D8 83 E7
        80 C1 E3 07 33 FB C1 E7 11 C1 E8 08}
    condition:
        all of them
}

rule CrowdStrike_CSIT_19207_04 : firebak imperial_kitten rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects .NET GUIDs used to compile FireBAK malware"
        reports = "CSIT-19207"
        version = "202005151225"
        last_modified = "2020-05-15"
        actor = "IMPERIAL KITTEN"
        malware_family = "FireBAK"
    strings:
        //da060f48b3c681639d8ec285846285ed8fda300fa9ee69a69d4fa8c0420c8070
        $ = "c592e957-e12c-4788-8883-c199422dd0e2" wide ascii
        //51d186c16cc609ddb67bd4f3ecd09ef3566cb04894f0496f7b01f356ae260424
        $ = "79e2018b-2daf-4089-8a12-a94d831b56b3" wide ascii
        //18412c5482ae122a8b753590f6c78cad5cd0cb14a7e7596dd98fc9c80f851be2
        $ = "cd75cf02-17f4-4815-9368-7cd4b2b3bef9" wide ascii
    condition:
        any of them
}

rule CrowdStrike_CSIT_19207_03 : fireback imperial_kitten rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects reduced-functionality variant of IMPERIAL KITTEN FireBAK malware"
        reports = "CSIT-19207"
        version = "202005151226"
        last_modified = "2020-05-15"
        actor = "IMPERIAL KITTEN"
        malware_family = "FireBAK"
    strings:
        $s1 = "Main" ascii wide
        $s2 = "patrol" ascii wide
        $s3 = "ShowWindow" ascii wide
        $s4 = "GetConsoleWindow" ascii wide
        $cmd1 = "cmd" ascii wide nocase
        $cmd2 = "cmdv" ascii wide nocase
    condition:
        all of ($s*) and 1 of ($cmd*) and filesize < 15KB
}

rule CrowdStrike_CSA_191355_01
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Malware dropped from HWP files using slack hosting for dead drop C2"
        reports = "CSA-191355"
        version = "201911151632"
        last_modified = "2019-11-15"
    strings:
        $code_cmp_DEADBEE       = { 81 3C 0A EE BE AD DE }
        $xorkey_1               = { 3F C8 3D F8 64 13 F2 3D BC BC 65 3E 98 64 FF A1 }
        $xorkey_2_start         = { B7 1D C1 04 6E 3B 82 09 D9 26 43 0D DC 76 04 13 }
        $str_reflective         = "ReflectiveLoader" fullword
        $str_slackparse         = " | Slack" fullword
        $str_google_ua          = "User-Agent: Google"
    condition:
        all of them
}

rule CrowdStrike_CSIT_19208_02 : chameleon 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects RTTI and DLL names from the Chameleon payload"
        reports = "CSIT-19208"
        version = "201911151638"
        last_modified = "2019-11-15"
        malware_family = "Chameleon"
    strings:
        $ = "BotDll64.dll"
        $ = "AVHttpsClient"
        $ = "AVPacketCache"
        $ = "AVTLSClient"
        $ = "AVTLSCore"
        $ = "AVNetClient"
    condition:
        filesize<2MB and 2 of them
}

rule CrowdStrike_Qealler_01 : stealer 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects version of Qealler stealing IE browsing history"
        version = "201911151637"
        last_modified = "2019-11-15"
    strings:
        $qealler = "Qealler" wide ascii nocase
        $s1 = "Q4_PASS_LIB" wide ascii
        $s2 = "JPOWERSHELL" wide ascii
        $s3 = "LIBRARY_CMD" wide ascii
        $s4 = "CREDENTIAL_CMD" wide ascii
    condition:
        ($qealler and 1 of ($s*)) or (4 of ($s*))
}

rule CrowdStrike_CSA_191362_02 : carat rat silent_chollima 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects API prefix string and filenames present in SILENT CHOLLIMA CARAT payload"
        reports = "CSA-191362"
        version = "201911151639"
        last_modified = "2019-11-15"
        actor = "SILENT CHOLLIMA"
        malware_family = "CARAT"
    strings:
        $ap1 = "CARAT_kernel32.dll"
        $ap2 = "CARAT_CreateThread"
        $ap3 = "CARAT_Ws2_32.dll"
        $ap4 = "CARAT_socket"
        $ap5 = "CARAT_bind"
        $ap6 = "CARAT_recv"
        $ap7 = "CARAT_send"
        $fn1 = "cr670w537c49.dat"
        $fn2 = "crc4ch3pw6.dat"
        $fn3 = "crf0rm9r4p.dat"
        $fn4 = "crk3y10993r.dat"
        $fn5 = "cr4udi0c4p.dat"
        $fn6 = "cr5cr33nc4p.dat"
    condition:
        4 of ($ap*) and 3 of ($fn*)
}

rule CrowdStrike_CSIT_19210_07 : infostealer mgbot module 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects an instance of the desktop screenshot module associated with MgBot"
        reports = "CSIT-19210"
        version = "201912271808"
        last_modified = "2019-12-27"
        malware_family = "MgBot"
        
    strings:
        $s1 = "Capstone.db" wide
        $s2 = "image/jpeg" wide
        $s3 = ".cfg" wide
        $s4 = "%d-%02d-%02d-%02d-%02d-%02d-%03d" wide
    condition:
        all of them and filesize <= 100KB and uint16(0) == 0x5A4D
}

rule CrowdStrike_CSIT_19212_01 : labyrinth_chollima manuscrypt rat webtroy 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects strings used in August 2019 variant of Manuscrypt dubbed WebTroy"
        reports = "CSIT-19212"
        version = "202004090830"
        last_modified = "2020-04-09"
        actor = "LABYRINTH CHOLLIMA"
        malware_family = "Manuscrypt"
        reports = "CSIT-19212"
    strings:
        $uriParam = "?v="
        $multipartField1 = "_webident_f"
        $multipartField2 = "_webident_s"
        $multipartField3 = ".dat"
        $cmdExec = "cmd.exe /c" wide
    condition:
        uint16(0) == 0x5A4D and all of them and filesize < 250KB
}

rule CrowdStrike_CSIT_19207_05 : firebak imperial_kitten rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects strings used for command parsing and address variable names used by FireBAK .NET malware"
        reports = "CSIT-19207"
        version = "202007011848"
        last_modified = "2020-07-01"
        actor = "IMPERIAL KITTEN"
        malware_family = "FireBAK"
    strings:
        $str_0 = "\\]{,}\\[" wide ascii
        $str_1 = "]{,}[" wide ascii
        $str_2 = "Post" wide ascii
        $str_3 = "&os=" wide ascii
        $str_4 = "&os_name=" wide ascii
        $str_5 = "&mac=" wide ascii
        $old_1 = "_method" wide ascii
        $old_2 = "send_info" wide ascii
        $old_3 = "send_command_result" wide ascii
    condition:
        (5 of ($str_*) or (2 of ($str_*) and all of ($old_*))) and filesize < 30KB
}

rule CrowdStrike_CSIT_19207_06 : firebak imperial_kitten rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects .NET strings used by PingDrop, the installer of FireBAK"
        reports = "CSIT-19207"
        version = "202012042001"
        last_modified = "2020-12-04"
        actor = "IMPERIAL KITTEN"
        malware_family = "FireBAK"
    strings:
        $a1 = "\x00PingHost\x00" ascii
        $a2 = "\x00PingReply\x00" ascii
        $a3 = "\x00Dispose\x00" ascii
        /*
        Wide ascii .Net string:
        -install
        */
        $a4 = {
        00 11 2d 00 69 00 6e 00 73 00
        74 00 61 00 6c 00 6c 00 01
        }
        $a5 = "\x00get_ResourceManager\x00" ascii
        $a6 = "\x00get_Assembly\x00" ascii
        $a7 = "\x00set_UseShellExecute\x00" ascii
        $a8 = "\x00sender\x00" ascii
        $a9 = "\x00IPStatus\x00" ascii
        $a10 = "\x00get_Status\x00" ascii
    condition:
        uint16(0) == 0x5a4d and all of ($a*) and filesize < 800KB
}

rule CrowdStrike_CSA_191414_01 : doublebase_dropper dropper labyrinth_chollima macro 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects components of a macro dropper where two payloads and a decoy are double Base64-encoded"
        reports = "CSA-191414"
        version = "202006111609"
        last_modified = "2020-06-11"
        actor = "LABYRINTH CHOLLIMA"
        malware_family = "DoubleBaseDropper"
    strings:
        $doc = { d0 cf 11 e0}
        $b1 = "VFZxUUFBT"
        $b2 = "QUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFB"
        $b3 = "VUVzRE"
        $load = "LoadLibraryA"
    condition:
        $doc at 0 and
        all of ($b*) and
        $load
}

rule CrowdStrike_CSA_191414_02 : downloader labyrinth_chollima neddnloader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects format strings for data collection and POST request used by NedDnLoader"
        reports = "CSA-191414,CSIT-20037"
        version = "202007291800"
        last_modified = "2020-07-29"
        actor = "LABYRINTH CHOLLIMA"
        malware_family = "NedDnLoader"
    strings:
        $ = "%s=%d&%s=%s&%s=%d"
        $ = {25 00 73 00 09 00 25 00 73 00 09 00 25 00 64 00
        47 00 42 00 20 00 46 00 72 00 20 00 4F 00 66 00
        20 00 25 00 64 00 47 00 42 00 0D 00 0A 00}
    condition:
        all of them
}

rule CrowdStrike_CSIT_19215_01 : android infostealer wizard_spider 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects hardcoded AndroStealer strings contained within the decoded resources of the Android information stealer"
        reports = "CSIT-19215"
        version = "201911291050"
        last_modified = "2019-11-29"
        actor = "WIZARD SPIDER"
        malware_family = "AndroStealer"
    strings:
        $ = "resources"
        $ = "AA2970311690"
        $ = "Sicherheitskontrolle"
    condition:
        all of them
}

rule CrowdStrike_Ostap_P99 : downloader ostap 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects Produce99 version of the Ostap downloader"
        reports = "CSIT-18161"
        version = "201911291050"
        last_modified = "2019-11-29"
        malware_family = "Ostap"
    strings:
        $h1 = ")+(function("
        $h2 = "),'C');  }"
        $o1 = ").substr(1,1)+'"
        $o2 = ").substr(2,1)+'"
        $o3 = "); } return false; }};"
    condition:
        2 of them and
        filesize < 1MB
}

rule CrowdStrike_CSIT_20016_01 : ecrime maze ransomware unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects strings present within unpacked Maze ransomware samples"
        reports = "CSIT-20016"
        version = "202009080544"
        last_modified = "2020-09-08"
        malware_family = "Maze Ransomware"
    strings:
        $a0 = "Maze Ransomware" wide
        $b0 = "We know that this computer is" wide
        $b1 = "a standalone server" wide
        $b2 = "a server in corporate network" wide
        $b3 = "a workstation in corporate network" wide
        $b4 = "a primary domain controller" wide
        $b5 = "a backup server"
        $b6 = "decryptor" wide
        $b7 = "Alert!" wide
        $b8 = "%USERID%" wide
        $b9 = "%base64key%" wide
        $ba = "shadowcopy" wide
        $bb = "--logging" wide
        $bc = "--nomutex" wide
        $bd = "--noshares" wide
        $rdata = {7B0104010502040205020376010401050204020502037001040105020402050203450104010502040200000000050203700104010502040205020371010401050204020502037E010401050204020502037F010401050204020502037C010401050204020502037D01040105020402C06C1D00FCD101008185070027B22C00B1060500A1F10200E16609009A0200}
    condition:
        ($a0 and 5 of ($b*)) or $rdata
}

rule CrowdStrike_CSA_191466_01 : helix_kitten intrudingdivisor webshell 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects constants used for HELIX KITTEN webshell - IntrudingDivisor"
        reports = "CSA-191466"
        version = "201912061947"
        last_modified = "2019-12-06"
        actor = "HELIX KITTEN"
        malware_family = "IntrudingDivisor"
    strings:
        $a_1 = "36EAC6171DD840EAB07EBEA9B2AAAF68" wide ascii
        $b_1 = "5473" wide ascii
        $b_2 = "6571" wide ascii
        $b_3 = "9273" wide ascii
        $b_4 = "3471" wide ascii
        $c_1 = /\!= \"[A-Z0-9]{32}\"/
    condition:
        ( $a_1 or all of ($b_*) ) and $c_1 and filesize < 50KB
}

rule CrowdStrike_CSIT_19209_02 : credential_dumper ecrime flawedgrace graceful_spider module 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detect FlawedGrace credential dumper module"
        reports = "CSIT-19209"
        version = "202012151533"
        last_modified = "2020-12-15"
        actor = "GRACEFUL SPIDER"
        malware_family = "FlawedGrace"
    strings:
        $ = "Login: %s" wide fullword
        $ = "Password: %s" wide fullword
        $ = "Domain: %s" wide fullword
        $ = "; --------------------------------------------------" wide fullword
    condition:
        filesize < 500KB and uint16(0) == 0x5a4d and (all of them)
}

rule CrowdStrike_Beapy_01 : beapy mineware 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects a PyInstaller based malware framework known as Beapy in industry reporting."
        version = "201912061942"
        last_modified = "2019-12-06"
        malware_family = "beapy"
    strings:
        $ = "ftplib(" ascii
        $ = "cmdreader(" ascii
        $ = "multiprocessing.process(" ascii
        $ = "win32con(" ascii
        $ = "cookielib(" ascii
        $ = "winerror(" ascii
        $ = "netbios(" ascii
        $ = "bbz2.pyd" ascii
        $ = "mysmb(" ascii
        $ = "impacket.smbconnection(" ascii
        $ = "psexec(" ascii
        $py_magic = {4d 45 49 0c 0b 0a 0b 0e}
    condition:
        $py_magic and all of them and filesize > 4MB
}

rule CrowdStrike_CSA_191470_01 : kitten wiper zerocleare 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects ZeroCleare wiper through use of the ElDos RawDisk driver"
        reports = "CSA-191470"
        version = "202001021738"
        last_modified = "2020-01-02"
        malware_family = "ZeroCleare"
    strings:
        $ = "b4b615c28ccd059cf8ed1abf1c71fe03c0354522990af63adf3c911e2287a4b906d47d" wide
        $ = "elrawdsk.sys" wide
        $ = "/u /c sc start soydsk" wide
        $ = "/u /c sc create soydsk type= kernel start= demand binPath= \"" wide
    condition:
        uint16(0) == 0x5A4D and
        uint32(uint32(0x3C)) == 0x00004550 and
        all of them
}

rule CrowdStrike_CSA_191519_02 : gallium quarkbandit 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detect command and control strings present in the QuarkBandit malware in use by China-based adversaries."
        reports = "CSA-191519"
        version = "201912131610"
        last_modified = "2019-12-13"
        malware_family = "QuarkBandit"
    strings:
        $ = "POST HTTP://%s:%d/ HTTP/1.1\x0d\x0aClientID: %s\x0d\x0aContent-Length: %d" ascii
        $ = "POST HTTP://%s:%d/ HTTP/1.1\x0d\x0aContent-Length: %d" ascii
        $ = "POST HTTP://%s:%d/ HTTP/1.1\x0d\x0aContent-Length: %zd" ascii
        $ = "POST HTTP://%s:%d/ HTTP/1.1\x0d\x0aConnection: Close" ascii
        $ = "atlTraceQI" ascii
        $ = "atlTraceMap" ascii
    condition:
        5 of them and filesize < 902300
}

rule CrowdStrike_CSA_191519_01 : gallium quarkbandit 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule matches against the xor routine found in QuarkBandit samples."
        reports = "CSA-191519"
        version = "201912131610"
        last_modified = "2019-12-13"
        malware_family = "QuarkBandit"
    strings:
        $xor_routine = { 8a 0c 06 80 c1 7a 80 f1 19 88 0c 06 46 }
    condition:
        $xor_routine
}

rule CrowdStrike_CSIT_19227_01 : chinch venomous_bear 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects portions of the XOR encryption loop from WowManager in the Chinch framework."
        reports = "CSIT-19227"
        version = "201912271524"
        last_modified = "2019-12-27"
        actor = "VENOMOUS BEAR"
        malware_family = "Chinch, WowManager"
    strings:
        $bytes_0x4040a0_0x4040d7  = { 8b ?? 8b ?? 83 ?? ?? 83 ?? ?? c1 e6 02 33 f7 8b ?? d1 e6 83 ?? ?? 33 f7 8b ?? d1 e6 83 ?? ?? 33 f7 c1 e6 03 d1 f8 33 c6 30 04 29 41 83 ?? ?? 7c cf 33 c9 85 db 7e 3e }
    condition:
        $bytes_0x4040a0_0x4040d7
}

rule CrowdStrike_CSA_191537_02 : labyrinth_chollima 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects a Linux based file listing tool used by LABYRINTH CHOLLIMA and associated with MataNet"
        reports = "CSA-191537"
        version = "201912200645"
        last_modified = "2019-12-20"
        actor = "LABYRINTH CHOLLIMA"
    strings:
        $ = "%04d%02d%02d%02d%02d"
        $ = { 25 64 09 25 73 09 25 63 09 25 64 09 25 73 0a }
    condition:
        all of them
}

rule CrowdStrike_CSA_191537_01 : labyrinth_chollima matanet 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects strings present in LABYRINTH CHOLLIMA MataNet Linux variant"
        reports = "CSIT-20018,CSA-191537"
        version = "202001291606"
        last_modified = "2020-01-29"
        actor = "LABYRINTH CHOLLIMA"
        malware_family = "MataNet"
    strings:
        $ = "c_2910.cls"
        $ = "k_3872.cls"
        $ = "/var/run/init.pid"
    condition:
        all of them
}

rule CrowdStrike_CSIT_19228_01 : carbon_spider pos pos_scraper poslurp supersoft 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects the SuperSoft (PoSlurp) credit card track data dumper / scraper"
        reports = "CSIT-19228"
        version = "202001091534"
        last_modified = "2020-01-09"
        actor = "CARBON SPIDER"
        malware_family = "SuperSoft"
    strings:
        $LoadLibraryA_hash = { 26 80 ac C8 }
        $GetProcAddress_hash = { ee ea c0 1f }
        $EncConst1 = { 0d 66 19 00 }
        $EncConst2 = { 6b 1e f9 49 }
    condition:
        all of them
}

rule CrowdStrike_CSIT_19228_02 : carbon_spider loader pos powershell supersoft 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects the SuperSoft (PoSlurp) PowerShell loader"
        reports = "CSIT-19228"
        version = "202001091534"
        last_modified = "2020-01-09"
        actor = "CARBON SPIDER"
        malware_family = "SuperSoft"
    strings:
        $start_time = "get-date \"1/1/2010\""
        $reg_key = "-Name ODBC2"
        $temp_overwrite = "00001e23.tmp"
        $regedit = "regedit.exe"
    condition:
        ($start_time and $reg_key) or ($temp_overwrite and $regedit) and
        filesize < 100KB
}

rule CrowdStrike_CSIT_19227_03 : chinch dropper venomous_bear 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects 0xaa XOR code from VENOMOUS BEAR Chinch droppers."
        reports = "CSIT-19227"
        version = "201912271525"
        last_modified = "2019-12-27"
        actor = "VENOMOUS BEAR"
        malware_family = "Chinch"
        
    strings:
        $aa_xor  = { 33 d2 39 ?? ?? ?? 7e 1c 8b ?? ?? ?? 8d 0c 02 8a ?? 84 c0 74 08 3c aa 74 04 34 aa 88 ?? 42 3b 54 24 08 7c e4 c2 08 00 }
        $xaa_xor  = { 56 8b ?? ?? ?? 33 c9 85 f6 7e 19 8b ?? ?? ?? 8a ?? ?? 84 c0 74 09 3c aa 74 05 34 aa 88 ?? ?? 41 3b ce 7c eb 5e c3 }
    condition:
        any of them
}

rule CrowdStrike_CSIT_19227_02 : chinch key venomous_bear 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects parts of XOR key used by Musket, a VENOMOUS BEAR tool in the Chinch malware framework."
        reports = "CSIT-19227"
        version = "201912271524"
        last_modified = "2019-12-27"
        actor = "VENOMOUS BEAR"
        malware_family = "Chinch"
    strings:
        $key_part_1  = "4eKLD\\vdasdvmW$tkW|$g0kdLDT)$|wp4evkl0Vk"
        $key_part_2 = "sf(SfoSfpbIdpx$;a/q,Oa;vPAD,g]dgth04($"
    condition:
        all of them
}

rule CrowdStrike_CSIT_19229_01 : downloader kerrdown ocean_buffalo 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects kerrdown downloader with AES encrypted shellcode, as detailed in CSIT-19229."
        reports = "CSIT-19229"
        version = "202001311620"
        last_modified = "2020-01-31"
        actor = "OCEAN BUFFALO"
        malware_family = "KerrDown"
        reports = "CSIT-19229"
    strings:
        //loading of CryptAcquireContextA hash
        $apihash1 = { C7 85 ?? FF FF FF CE A8 00 B1}
        //loading of CryptAcquireContextW hash
        $apihash2 = { C7 85 ?? FF FF FF 2F A9 00 B1}
        //loading of CryptDecrypt hash
        $decrypt_apihash = { C7 85 ?? FF FF FF AE 53 E3 00 }
        $str4 = "mscoree.dll" wide ascii
    condition:
        (uint16(0) == 0x5A4D) and 1 of ($apihash*) and $decrypt_apihash and $str4
}

rule CrowdStrike_CSIT_19229_02 : kerrdown ocean_buffalo shellcode 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects stage of KerrDown with AES/RC4 encrypted shellcode, as detailed in CSIT-19229"
        reports = "CSIT-19229"
        version = "202106021610"
        last_modified = "2021-06-02"
        actor = "OCEAN BUFFALO"
        malware_family = "KerrDown"
        reports = "CSIT-19229"
    strings:
        //loading of InternetOpenW hash
        $wininethash1 = { C7 85 ?? FE FF FF B7 DD 8A 07 }
        //loading of InternetConnectW hash
        $wininethash2 = { C7 85 ?? FE FF FF ED 2B A2 CB }
        //loading of HttpOpenRequestW hash
        $wininethash3 = { C7 85 ?? FE FF FF 06 1A 8C 8F }
        //loading of HttpSendRequestW hash
        $wininethash4 = { C7 85 ?? FE FF FF F8 3A EA 8D }
        //loading of CryptAcquireContextW hash
        $crypthash1 = { C7 84 24 ?? 01 00 00 2F A9 00 B1 }
        //loading of CryptDecrypt hash
        $crypthash2 = { C7 84 24 ?? 01 00 00 AE 53 E3 00 }
        $httpstr = "comput"
        $impstr1 = "wini"
        $impstr2 = "net"
        $impstr3 = "dll"
    condition:
        (uint16(0) == 0x5A4D) and ((all of ($wininethash*) and all of ($impstr*)) or (all of ($crypthash*) and $httpstr))
}

rule CrowdStrike_CSIT_20081_01 : circus_spider netwalker ransomware 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects the NetWalker ransomware"
        reports = "CSIT-20081"
        version = "202105260913"
        last_modified = "2021-05-26"
        actor = "CIRCUS SPIDER"
        malware_family = "NetWalker"
    strings:
        $salsaconst = "expand 32-byte kexpand 16-byte k"
        $ins_getapi = { 55 8B EC A1 ?? ?? ?? ?? 5D C3 }
        $ins_crc32 = { 25 20 83 B8 ED 33 D0 }
        $ins_push1337 = { 68 39 05 00 00 68 69 7A 00 00 }
        $ins_rc4 = { 8B 45 ( E? |F? ) 83 C0 01 33 D2 B9 00 01 00 00 F7 F1 89 55 }
        $ins_c25519 = { 6A 00 68 41 DB 01 00 }
    condition:
        3 of them
}

rule CrowdStrike_CSIT_20081_02 : circus_spider netwalker ransomware 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects the NetWalker ransomware"
        reports = "CSIT-20081"
        version = "202105260913"
        last_modified = "2021-05-26"
        actor = "CIRCUS SPIDER"
        malware_family = "NetWalker"
    strings:
        $ = "namesz"  fullword
        $ = "crmask"  fullword
        $ = "idsz"    fullword
        $ = "lend"    fullword
        $ = "lfile"   fullword
        $ = "mpk"     fullword
        $ = "namesz"  fullword
        $ = "pspath"  fullword
        $ = "rwsz"    fullword
        $ = "spsz"    fullword
        $ = "svcwait" fullword
        $ = "unlocker" fullword
        $ = "onion1" fullword
    condition:
        10 of them
}

rule CrowdStrike_CSIT_19227_04 : chinch venomous_bear 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects a distinctive function found in Faerie, a VENOMOUS BEAR tool in the Chinch malware framework."
        reports = "CSIT-19227"
        version = "201912271526"
        last_modified = "2019-12-27"
        actor = "VENOMOUS BEAR"
        malware_family = "Chinch"
    strings:
        $sub_401CE4  = { 57 6a 5c 56 e8 ?? ?? ?? ?? 68 ?? ?? ?? ?? 6a 00 53 8b ?? e8 ?? ?? ?? ?? 83 ?? ?? 8b ?? 8d 50 01 85 ff 75 41 8a ?? 40 84 c9 75 f9 2b c2 b9 03 01 00 00 3b c1 76 04 8b ?? eb 0e 8b ?? 8d 50 01 8a ?? 40 84 c9 75 f9 2b c2 50 56 53 e8 ?? ?? ?? ?? 8b ?? 83 ?? ?? 8b ?? 2b d6 8a ?? 88 ?? ?? 40 84 c9 75 f6 5f c3 8a ?? 40 84 c9 75 f9 2b c2 b9 03 01 00 00 3b c1 76 04 8b ?? eb 0e 8b ?? 8d 50 01 8a ?? 40 84 c9 75 f9 2b c2 50 47 57 53 e8 ?? ?? ?? ?? 83 ?? ?? 5f c3 }
    condition:
        $sub_401CE4
}

rule CrowdStrike_CSIT_19227_05 : chinch venomous_bear 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects a unique encryption algorithm used by Kasta, a VENOMOUS BEAR tool in the Chinch malware framework."
        reports = "CSIT-19227"
        version = "201912271526"
        last_modified = "2019-12-27"
        actor = "VENOMOUS BEAR"
        malware_family = "Chinch"
        
    strings:
        $sub_418490  = { 33 d2 39 ?? ?? ?? 7e 32 56 be ?? ?? ?? ?? 8b ?? ?? ?? 8a ?? ?? 0f be c8 3b ce 7e 0b 83 ?? ?? 3b ce 7e 04 34 11 eb 02 34 21 8b ?? ?? ?? 8b ?? 88 ?? ?? 42 3b 54 24 10 7c d5 5e 33 c0 40 c2 0c 00 }
    condition:
        $sub_418490
}

rule CrowdStrike_CSA_200693_01 : credential_theft deployfilter 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects PDB string and a stack string associated with GALLIUM tooling, including their DeployFilter malware and a credential harvesting tool."
        reports = "CSA-200693"
        version = "202106081537"
        last_modified = "2021-06-08"
    strings:
        $pdb_1 = "E:\\vs_proj\\" wide ascii
        $pdb_2 = ".pdb" wide ascii
        $stack_string = { b8 52 00 00 00 66 ?? ?? ?? ?? b8 20 00 00 00 66 ?? ?? ?? ?? b8 52 00 00 00 66 ?? ?? ?? ?? }
    condition:
        uint16(0) == 0x5a4d and
        (all of ($pdb*) or $stack_string)
}

rule CrowdStrike_CSIT_20000_01 : ecrime infostealer wizard_spider 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects plaintext strings within the WIZARD SPIDER MagneticScraper tool"
        reports = "CSIT-20000"
        version = "201912271434"
        last_modified = "2019-12-27"
        actor = "WIZARD SPIDER"
        malware_family = "MagneticScraper"
    strings:
        $a1 = "kiosk"
        $a2 = "kassa"
        $a3 = "teller"
        $a4 = "director"
        $a5 = "verifon"
        $a7 = "skype"
        $b1 = "WinHTTP loader/1.0" wide
        $b2 = "WinHTTP sender/1.0" wide
    condition:
        4 of ($a*) and 1 of ($b*)
}

rule CrowdStrike_CSIT_19231_01 : double7 rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects prominent strings and decoder bytes found in the Double7 RAT. "
        reports = "CSIT-19231"
        version = "202001170819"
        last_modified = "2020-01-17"
        malware_family = "Double7"
    strings:
        $a_event1 = "Global\\67BDE5D7"
        $a_event2 = "Global\\C255AB79"
        $a_args1 = "\"%s\" 99 4 3 2 1"
        $a_dnsargs = "\"%s\" -l %d -r ssh -z %s %s"
        $a_args2 = "rundll32.exe \"%s\",DllMain %d %s %s "
        $a_decoder = { 8d 46 21 bf eb 00 00 00 99 f7 ff 30 13 43 46 49 75 ee }
        $t1 = "TTaskSpy"
        $t2 = "TTaskThd"
        $t3 = "TTaskBase"
        $t4 = "TTaskRun"
        $t5 = "TTcpBase"
        $t6 = "TTcpMain"
        $t7 = "THttpsMain"
        $t8 = "THttpThd"
        $t9 = "TDnsMain"
        $t10 = "TCmdMgr"
        $t11 = "TTcpCmd"
        $t12 = "THttpCmd"
    condition:
        filesize<3MB and (any of ($a*) or 6 of ($t*))
}

rule CrowdStrike_CSIT_20001_05 : cannon downloader fancy_bear 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "MSIL of function carrying contacting upstream POP3 server found in FANCY BEAR's Cannon downloader."
        reports = "CSIT-20001"
        version = "202105261543"
        last_modified = "2021-05-26"
        actor = "FANCY BEAR"
        malware_family = "Cannon Downloader"
    strings:
        $ = { 00 16 13 05 2b 57 00 09 11 05 17 58 6f ?? ?? 00 06 0b 07 6f ?? 00 00 06 6f ?? 00 00 06 03 28 ?? 00 00 0a 16 fe 01 13 09 11 09 2d 2a }
    condition:
        uint16(0) == 0x5a4d and uint32(uint32(0x3c)) == 0x00004550 and all of them
}

rule CrowdStrike_CSIT_20018_02 : chollima_lego labyrinth_chollima matanet 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects the plugin file names used by the LABYRINTH CHOLLIMA MataNet implant"
        reports = "CSIT-20018"
        version = "202001311623"
        last_modified = "2020-01-31"
        actor = "LABYRINTH CHOLLIMA"
        malware_family = "MataNet"
    strings:
        $ = "MATA_Plug_File.dll"
        $ = "MATA_Plug_Cmd.dll"
        $ = "MATA_Plug_Process.dll"
        $ = "MATA_Plug_TestConnect.dll"
        $ = "?DllGetIUnkownInterface@@"
    condition:
        any of them
}

rule CrowdStrike_CSA_200008_02 : wiper zerocleare 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detect 64bit version of the ZeroCleare wiper"
        reports = "CSA-200008"
        version = "202001031540"
        last_modified = "2020-01-03"
        malware_family = "ZeroCleare"
    strings:
        $ = "b4b615c28ccd059cf8ed1abf1c71fe03c0354522990af63adf3c911e2287a4b906d47d" wide
        $ = "DeviceIoControl"
        $ = { 84 bf 22 00 }
        $ = { 80 7f 22 00 }
    condition:
        uint16(0) == 0x5a4d and
        uint32(uint32(0x3C)) == 0x00004550 and
        all of them
}

rule CrowdStrike_CSA_200008_01 : dropper dustman 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects the Dustman dropper used to deploy the ZeroCleare wiper malware"
        reports = "CSA-200008"
        version = "202001031540"
        last_modified = "2020-01-03"
        malware_family = "Dustman"
    strings:
        $string_obfu_code = { 42 8a 04 06 48 8d 15 ?? ?? 00 00 48 63 c9 41 ff c1 32 04 11 41 88 00 48 b8 8b 7c d6 0d a6 c8 67 dd 48 f7 e1 49 ff c0 48 c1 ea 05 48 6b c2 ?? 48 2b c8 49 63 c1 ff c1 48 3b c3 72 c4 }
        $reg = "Software\\Oracle\\VirtualBox" wide
        $ioctl = "DeviceIoControl"
    condition:
        uint16(0) == 0x5a4d and
        uint32(uint32(0x3c)) == 0x00004550 and
        all of them
}

rule CrowdStrike_Simple_JScript_webshell : jscript webshell 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects a simple webshell used to execute parameters that are passed to it via a URL. "
        version = "202001101532"
        last_modified = "2020-01-10"
        malware_family = "Simple JScript Webshell"
    strings:
        $ = "var a = \"un\" + Char ( 115 ) + Char ( 97 ) + \"fe\";"
    condition:
        all of them
}

rule CrowdStrike_formOWA_Webshell : formowa webshell 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects a low-prevalence webshell which can delete, download, or execute files on a targeted web server."
        version = "202001101430"
        last_modified = "2020-01-10"
        malware_family = "Form OWA Webshell"
    strings:
        $ = "<table width='100%'><tr><th>Name</th><th>Size KB</th><th colspan='2' width='50'>Actions</th></tr>"
        $ = "string.Format(\"<tr><td>{0}</td><td>{1:d}</td><td>{2}</td><td>{3}</td></tr>\", fstr,"
    condition:
        any of them
}

rule CrowdStrike_XSLT_ASPX_zcgovnh_webshell : webshell xslt_aspx zcgonvh 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects a webshell used to execute code passed in a URL parameter."
        version = "202006151632"
        last_modified = "2020-06-15"
        malware_family = "XSLT ASPX Webshell"
    strings:
        $ = { 78 6D 6C 6E 73 3A 7A 63 67 3D 22 22 7A 63 67 6F 6E 76 68 22 22 }
        $ = "c.Response;var Server=c.Server;eval(Request.Item["
        $ = "xml(x) {var a=new ActiveXObject('wscript.shell'); var exec=a.Exec(x);"
    condition:
        any of them
}

rule CrowdStrike_onload_uploader_webshell : uploader webshell 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule matches against a webshell that is used to upload files to a compromised webserver."
        version = "202001101431"
        last_modified = "2020-01-10"
        malware_family = "Simple Uploader Webshell"
    strings:
        $ = "string contentType = Request.Form[\"contentType\"];"
        $ = "string base64 = Request.Form[\"base64\"];"
        $ = "string fileName = Request.Form[\"fileName\"];"
    condition:
        all of them
}

rule CrowdStrike_CSIT_20005_01 : amadey downloader ecrime infostealer loader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects strings within the Amadey Loader stealer module"
        reports = "CSIT-20005"
        version = "202001101442"
        last_modified = "2020-01-10"
        malware_family = "AmadeyStealer"
    strings:
        $ = "FileZilla"
        $ = "Pidgin"
        $ = "<User>"
        $ = "<Host>"
        $ = "<Pass"
        $ = "<protocol>"
        $ = "<name>"
        $ = "<password>"
        $ = "host="
        $ = "username="
        $ = "password="
        $ = "cred.dll"
        $ = "cred="
        $ = "Stealer_"
    condition:
        all of them
}

rule CrowdStrike_BirdLoader_01 : loader packed 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects malicious .NET loaders disguised as bird hunting games."
        version = "202001101429"
        last_modified = "2020-01-10"
        malware_family = "BirdLoader"
    strings:
        $ = "v4.0.30319"
        $ = "#Strings"
        $ = "GetMethod"
        $ = {11 0? 1f 0a 5d 91 61 d2 9c 11 0? 17 58 13 0? 11 0? 02}
    condition:
        all of them
}

rule CrowdStrike_BirdLoader_02 : loader unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects payloads of .NET loaders disguised as bird hunting games."
        version = "202001101428"
        last_modified = "2020-01-10"
        malware_family = "BirdLoader"
    strings:
        $must_dotNet1 = "v4.0.30319"
        $must_dotNet2 = "#Strings"
        $must_dotNet3 = "get_TotalSeconds"
        $must_dotNet4 = "HttpWebRequest"
        $mayb_panel0 = "WebPanel/dbloader.php/?func=" wide
        $mayb_panel1 = "get_path&name=" wide
        $mayb_panel2 = "still_alive&name=" wide
        $mayb_panel3 = "add_comp&name=" wide
        $mayb_schtasks1 = "/create /tn \"Task5H3DKU8\" /tr " wide
        $mayb_schtasks2 = "C:\\Users\\Public\\stsk.exe" wide
        $mayb_suicide = "/C choice /C Y /N /D Y /T" wide
    condition:
        all of ($must*) and 4 of ($mayb*)
}

rule CrowdStrike_CSIT_20019_01 : dotnet remote_shell topinambour venomous_bear 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects networking code for TinyNetShell which is dropped by Topinambour Dropper"
        reports = "CSIT-20019"
        version = "202001311626"
        last_modified = "2020-01-31"
        actor = "VENOMOUS BEAR"
        malware_family = "Topinambour"
    strings:
        $bytes_0xb8_0xd5  = { 09 11 06 11 07 11 05 11 07 59 16 6f ?? ?? ?? ?? 13 0b 11 0b 2c 0d 11 07 11 0b 58 13 07 }
    condition:
        $bytes_0xb8_0xd5
}

rule CrowdStrike_CSA_200027_01 : kazuar rat venomous_bear 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects the string decryption routine in Kazuar variants observed in 2019 in use by VENOMOUS BEAR."
        reports = "CSA-200027,CSIT-20019"
        version = "202002042014"
        last_modified = "2020-02-04"
        actor = "VENOMOUS BEAR"
        malware_family = "Kazuar"
    strings:
        $msil_switch_statement = {
        1f 41 2a 1f 42 2a 1f 43  2a 1f 44 2a 1f 45 2a 1f
        46 2a 1f 47 2a 1f 48 2a  1f 49 2a 1f 4a 2a 1f 4b
        2a 1f 4c 2a 1f 4d 2a 1f  4e 2a 1f 4f 2a 1f 50 2a
        1f 51 2a 1f 52 2a 1f 53  2a 1f 54 2a 1f 55 2a 1f
        56 2a 1f 57 2a 1f 58 2a  1f 59 2a 1f 5a 2a 1f 61
        2a 1f 62 2a 1f 63 2a 1f  64 2a 1f 65 2a 1f 66 2a
        1f 67 2a 1f 68 2a 1f 69  2a 1f 6a 2a 1f 6b 2a 1f
        6c 2a 1f 6d 2a 1f 6e 2a  1f 6f 2a 1f 70 2a 1f 71
        2a 1f 72 2a 1f 73 2a 1f  74 2a 1f 75 2a 1f 76 2a
        1f 77 2a 1f 78 2a 1f 79  2a 1f 7a 2a 1f 7e 2a 1f
        25 2a 1f 3a 2a 1f 2e 2a  1f 20 2a 1f 7c 2a 1f 7b
        2a 1f 7d 2a 1f 2d 2a 1f  3d 2a 1f 3c 2a 1f 3e 2a
        1f 5c 2a 1f 0a 2a 1f 09  2a 1f 30 2a 1f 31 2a 1f
        32 2a 1f 33 2a 1f 34 2a  1f 35 2a 1f 36 2a 1f 37
        2a 1f 38 2a 1f 39 2a 02  2a
        }
    condition:
        all of them
}

rule CrowdStrike_Ostap_Generic : downloader ostap 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Generic detection for obfuscation patterns that commonly appear in Ostap malware samples."
        version = "202002070919"
        last_modified = "2020-02-07"
        malware_family = "Ostap"
    strings:
        $fchain = ")+(function("
    condition:
        #fchain > 50 and filesize < 2MB
}

rule CrowdStrike_CSIT_20011_01 : ecrime unpacked valak 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects strings within unpacked samples of Valak"
        reports = "CSIT-20011"
        version = "202002041003"
        last_modified = "2020-02-04"
        malware_family = "Valak"
    strings:
        $ = "var config = {"
        $ = "PRIMARY_C2"
        $ = "COMMAND_C2"
        $ = "SOFT_SIG"
        $ = "C2_PREFIX"
        $ = "BODY"
        $ = "TASK"
        $ = "PLUGIN"
    condition:
        5 of them
}

rule CrowdStrike_CSA_200531_03 : fancy_bear python pytunnel 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "AES-based Python packer used by FANCY BEAR to obfuscate PyTunnel malware"
        reports = "CSA-200531"
        version = "202010041225"
        last_modified = "2020-10-04"
        actor = "FANCY BEAR"
        malware_family = "PyTunnel"
    strings:
        $argument_1 = "(sys.argv[1], len("
        $argument_2 = "sys.argv.append(nk[1])"
        $argument_3 = "ce(sys.argv[1], len(hk))"
        $except = "except:"
    condition:
        any of ($argument_*) and $except
}

rule CrowdStrike_CSIT_20039_01 : ecrime medusalocker ransomware 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects unpacked instances of MedusaLocker ransomware"
        reports = "CSIT-20039"
        version = "202010222115"
        last_modified = "2020-10-22"
        malware_family = "MedusaLocker"
    strings:
        $portal = "kwvhrdibgmmpkhkidrby4mccwqpds5za6uo2thcw5gz75qncv7rbhyad.onion"
        $str1 = "{PATTERN_ID}"
        $str2 = "{EXT}"
        $str3 = "{UID}"
        $c1 = {3d 16 00 09 80 75 ?? 6a 08 6a 01}
        $c2 = {68 00 00 00 f0 6a 01}
        $c3 = {68 3f 00 0f 00 6a 00}
        $c4 = {6a 07 6a 00 6a 00 ff}
        $c5 = {83 c4 08 6a 3f 68}
    condition:
        uint16(0) == 0x5a4d and $portal or (all of ($str*) or all of($c*))
}

rule CrowdStrike_CSA_200075_01 : freebsd golang post_exploitation 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects a golang binary being distributed to hosts vulnerable to CVE-2019-19781"
        reports = "CSA-200075"
        version = "202001171009"
        last_modified = "2020-01-17"
    strings:
        // Function names
        $a = "main.doFile"
        $b = "main.remove_bds"
        $c = "main.install_itself"
        $d = "main.install_cron"
        $e = "main.xrun"
    condition:
        3 of them
}

rule CrowdStrike_CSIT_20009_01 : banking downloader ecrime 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects the assembly patterns of Zloader"
        reports = "CSIT-20009"
        version = "202102221427"
        last_modified = "2021-02-22"
        malware_family = "Zloader"
    strings:
        $asm_rc4_key = { 68 00 01 00 00 5? e8 [4] 83 c4 ?? [0-4] a8 01 74 ?? }
        $asm_rc4_encdec = { 88 ?? 00 01 00 00 88 ?? 01 01 00 00 83 c4 ?? }
        $asm_xor_dec = { 8a 54 01 ff 30 14 01 48 75 f6 }
        $asm_xor_dec2 = { 0F B6 04 ?? 30 ?? 3? }
        $asm_decstring = { 0f b6 14 06 32 94 08 [4] 88 14 07 }
        $asm_decstring2 = { 0F B6 04 ?? 32 8? [4] 8B 4? ?? 88 04 3? }
        $asm_winapiresolv = { c1 ea 07 69 c2 68 02 00 00 [0-2] 8b ?? ?? ?? ?? ?? ?? }
        $asm_winapiresolv2 = { 83 ?? 14 0f 87 [4] ff 24 b5 ?? ?? ?? ?? }
        $asm_InternetOpenA_resolv = { 68 71 a3 0c 0d 6a 13 e8 ?? ?? ?? ?? }
        $asm_InternetConnectA_resolv = { 68 71 A3 0C 0D 6A 13 e8 ?? ?? ?? ?? }
        $asm_InternetSetOption_resolv = { 68 01 D6 B4 05 6A 13 e8 ?? ?? ?? ?? }
        $asm_wininet_resolv1 = { 68 E1 75 E7 0A 6A 13 e8 ?? ?? ?? ?? }
        $asm_wininet_resolv2 = { 68 91 94 EB 0B 6A 13 e8 ?? ?? ?? ?? }
        $asm_wininet_resolv3 = { 68 61 C2 49 02 6A 13 e8 ?? ?? ?? ?? }
        $asm_wininet_resolv4 = { 68 85 B6 14 07 6A 13 e8 ?? ?? ?? ?? }
    condition:
        uint16(0) == 0x5a4d and
        4 of ($asm_*)
}

rule CrowdStrike_CSIT_20011_02 : ecrime plugin valak 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects strings within Valak plugins"
        reports = "CSIT-20011"
        version = "202002051118"
        last_modified = "2020-02-05"
        malware_family = "Valak"
    strings:
        $ = "ENDPOINT"
        $ = "LOG_TYPE"
        $ = "NAME"
        $ = "nonce1" wide
        $ = "nonce2" wide
        $ = "plugin" wide
        $ = "ltype" wide
    condition:
        all of them
}

rule CrowdStrike_CSIT_20021_01 : ecrime odveta ransomware unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects Odveta ransomware based on strings observed in unpacked samples"
        reports = "CSIT-20021"
        version = "202009142141"
        last_modified = "2020-09-14"
        malware_family = "Odveta"
    strings:
        $s1 = "in case of no answer"
        $s2 = "detive"
        $s3 = "C:\\Users\\LEGION\\Desktop\\New folder\\rijndael_simd.cpp"
        $s4 = "All Your Files Has Been Locked"
        $s5 = "net stop MSSQL$CONTOSO1"
        $s6 = "0123456789QWERTYUIOPASDFGHJKLZXCVBNM"
        $s7 = "C:\\ProgramData\\ids.txt"
        $s8 = "C:\\ProgramData\\IDo.txt"
        $s9 = "C:\\ProgramData\\Pkey.txt"
        $s10 = "C:\\ProgramData\\pubkey.txt"
    condition:
        5 of them
}

rule CrowdStrike_CSIT_20021_02 : ecrime odveta ransomware unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects Odveta ransomware based on observed PDB paths."
        reports = "CSIT-20021"
        version = "202002211513"
        last_modified = "2020-02-21"
        malware_family = "Odveta"
    strings:
        $pdb1 = "\\rsa+aes\\motherfucker\\Release\\motherfucker.pdb"
        $pdb2 = "D:\\Ouroboros v7\\Ouroborosv7\\Release\\Ouroborosv7.pdb"
        $pdb3 = "D:\\odveta+ unicode\\Odveta+\\Release\\Odveta+.pdb"
        $pdb4 = "D:\\kronos+\\Lastundecryptableversion\\notsimple\\motherfucker\\Release\\motherfucker.pdb"
        $pdb5 = "D:\\Raas\\ouroboros_en\\Release\\Ouroboros_en.pdb"
        $pdb6 = "D:\\Raas\\gui\\uiapp\\obj\\Release\\uiapp.pdb"
    condition:
        any of them
}

rule CrowdStrike_CSA_200076_01 : malicious_document 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects document artifacts with an attachedTemplate property referencing a Google Drive URL"
        reports = "CSA-200076"
        version = "202106081537"
        last_modified = "2021-06-08"
    strings:
        $ = "attachedTemplate\" Target=\"https://drive.google.com/"
    condition:
        all of them
}

rule CrowdStrike_CSA_200076_02 : python rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Characteristic strings from a Python-based RAT that leverages multiple legitimate web services for C2"
        reports = "CSA-200076"
        version = "202001171009"
        last_modified = "2020-01-17"
    strings:
        $ = "wmic diskdrive get SerialNumber"
        $ = "threading, winreg"
    condition:
        all of them
}

rule CrowdStrike_CSA_200490_01 : venomous_bear 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects a characteristic opaque predicate in obfuscated entry point functions of VENOMOUS BEAR malware"
        reports = "CSA-200490"
        version = "202004171510"
        last_modified = "2020-04-17"
        actor = "VENOMOUS BEAR"
    strings:
        $startfn = { 31 C0 40 90 74 03 EB 07 CC E9 }
    condition:
        all of them
}

rule CrowdStrike_KARMA_PANDA_Flapjack_FirstStage_RAT : flapjack karma_panda 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This tools looks for a first stage remote access tool (Flapjack) in use by KARMA PANDA."
        version = "202106081537"
        last_modified = "2021-06-08"
        malware_family = "Flapjack"
    strings:
        $code1 = { f0 0f be c9 8d 04 70 03 c1 8a 4a 01 42 84 c9 75 e9 5f 25 ff }
        $code2 = { 8b 6e 34 2b c1 8b 4e 2c b3 05 1b cd 8d 6e 20 51 50 51 88 5c }
        $code3 = { 74 1e 8a 4c 14 10 8d 7c 24 10 80 f1 1d 33 c0 88 4c 14 10 83 }
        $str1 = "nkd|gihq|d|3yds|pt~0ysn3sxi" ascii
        $str2 = "Found NO.%u  %I64d (s)." ascii
        $str3 = "nkd|gih3tsyrtszjhqx|os3~rp" ascii
        $str4 = "abadjfp455646$#%TDFSDAFfdsdafafdQSS34-=" ascii
        $str5 = "abad4jfpoajdf5ndv934789fu7adjfn34435625u409t8#9#$9-" ascii
    condition:
        ((all of ($code*)) or (2 of ($str*))) and filesize < 1MB
}

rule CrowdStrike_CSIT_20060_01 : nemty nemtyx ransomware 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule identifies the Nemty X ransomware. As most Nemty X samples are packed, this rule is most effective against unpacked samples and memory dumps."
        reports = "CSIT-20060"
        version = "202004031220"
        last_modified = "2020-04-03"
        malware_family = "Nemty"
        reports = "CSIT-20060"
    strings:
        $api = "SystemFunction036"
        $auto_1 = { 5e c3 8a 50 05 8a 48 01 88 50 01 8a 50 09 88 50 05 8a 50 0d }
        $auto_2 = { f4 8a 1c 03 88 18 8a 5e ff 88 58 01 8a 1e 88 58 02 03 f2 03 }
        $auto_13 = { 32 4d fa 83 c0 04 88 4e 10 8b 4d dc 8a 0c 31 32 4d fb ff 45 }
    condition:
        all of ($a*)
}

rule CrowdStrike_CSA_200216_01 : downloader v8tron 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects samples of V8Tron downloader"
        reports = "CSA-200216"
        version = "202002211515"
        last_modified = "2020-02-21"
        malware_family = "Megaton, V8"
    strings:
        $ = "function unzip("
        $ = "if (!unzipdir)"
        $ = ".msi /quiet"
        $ = "dst = "
        $ = "= new ActiveXObject("
        $ = ".status == 200)"
    condition:
        5 of them
}

rule CrowdStrike_CSIT_20031_01 : banker trojan v8 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects samples of a banking trojan internally dubbed V8"
        reports = "CSIT-20031"
        version = "202009070742"
        last_modified = "2020-09-07"
        malware_family = "V8"
    strings:
        $msi_magic = { d0 cf 11 e0 a1 b1 1a e1 }
        $str1 = ">>01<>"
        $str2 = "<<TECLAS>>"
        $str3 = "<<|>>"
        $str4 = "avisa.php?escrita="
        $str5 = "TCustomWinSocket"
        $str_key = "LWX123X0X321XWL" fullword
        $str_enc1 = "89A8B3B73447A6B2C34FADC23FDC66E86B9F" // [<<MANDASOCKET>>]
        $str_enc2 = "1F0132F353FA1A25A44A" // .dynu.com
        $str_enc3 = "CF71B3459B26B84442FF4B82" // msiexec.exe
        $str_delphi1 = { ff ff ff ff 05 00 00 00 20 56 2e 3? 20 } // delphi string " V.x "
    condition:
        (uint16(0) == 0x5a4d or $msi_magic at 0) and
        filesize > 500KB and
        4 of ($str*)
}

rule CrowdStrike_CSIT_20018_01 : labyrinth_chollima loader matanet 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects API loading function used by the MataNet Loader DLL"
        reports = "CSIT-20018"
        version = "202001311622"
        last_modified = "2020-01-31"
        actor = "LABYRINTH CHOLLIMA"
        malware_family = "MataNet"
    strings:
        $va = "kernel32.dll:VirtualAlloc"
        $cfm = "kernel32.dll:CreateFileMappingW"
        $cfw = "kernel32.dll:CreateFileW"
        $aes = {63 7C 77 7B F2 6B 6F C5 30 01 67 2B FE D7 AB 76}
    condition:
        all of them
}

rule CrowdStrike_CSIT_20018_03 : labyrinth_chollima matanet plugin 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects strings found in the MataNet command plugin"
        reports = "CSIT-20018"
        version = "202001311622"
        last_modified = "2020-01-31"
        actor = "LABYRINTH CHOLLIMA"
        malware_family = "MataNet"
    strings:
        $ = "RtlGetCompressionWorkSpaceSize"
        $ = "C:\\Windows\\system32\\WindowsPowerShell\\v1.0\\powershell.exe" wide
        $ = "cmd.exe /c" wide
        $ = {89 45 14 C7 45 10 00 05 02 00 C7 45 18 02 00 00 00}
    condition:
        3 of them
}

rule CrowdStrike_CSIT_20018_04 : labyrinth_chollima matanet plugin 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects strings found in the MataNet file plugin"
        reports = "CSIT-20018"
        version = "202003161910"
        last_modified = "2020-03-16"
        actor = "LABYRINTH CHOLLIMA"
        malware_family = "MataNet"
    strings:
        $api = "RtlGetCompressionWorkSpaceSize"
        $fname = "DESKTOP%08X.ZIP" wide
        $log = {25 00 64 00 09 00 25 00 73 00 09 00 25 00 63 00
        09 00 25 00 49 00 36 00 34 00 75 00 09 00 25 00
        30 00 34 00 64 00 25 00 30 00 32 00 64 00 25 00
        30 00 32 00 64 00 25 00 30 00 32 00 64 00 25 00
        30 00 32 00 64 00 0A 00}
    condition:
        1 of ($fname,$log) and $api
}

rule CrowdStrike_CSIT_20018_05 : labyrinth_chollima matanet plugin 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects strings found in the MataNet process plugin"
        reports = "CSIT-20018"
        version = "202003161910"
        last_modified = "2020-03-16"
        actor = "LABYRINTH CHOLLIMA"
        malware_family = "MataNet"
    strings:
        $send = {48 8D 4C 24 28 C7 44 24 28 00 06 02 00 C7 44 24
        2C 04 00 00 00 8D 50 0C}
        $api = "CreateProcessAsUserW"
    condition:
        all of them
}

rule CrowdStrike_CSIT_20018_06 : labyrinth_chollima matanet plugin 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects strings found in the MataNet test connection plugin"
        reports = "CSIT-20018"
        version = "202003161911"
        last_modified = "2020-03-16"
        actor = "LABYRINTH CHOLLIMA"
        malware_family = "MataNet"
    strings:
        $icmp1 = "Reply from %s: bytes=%d time=%dms TTL=%d"
        $icmp2 = "Ping from %s failed"
        $icmp3 = "echodata"
        $iprange = {83 CA FF B9 20 00 00 00 2B CB 8B EA D3 E5 8B F0
        23 E8 8B CB D3 EA 03 EA 3B C5}
    condition:
        $iprange or all of ($icmp*)
}

rule CrowdStrike_CSIT_20051_01 : cryak cryakl ecrime ransomware 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects unpacked Cryakl ransomware samples"
        reports = "CSIT-20051"
        version = "202003201523"
        last_modified = "2020-03-20"
        malware_family = "Cryakl"
    strings:
        $ = "{ENCRYPTSTART}"
        $ = "{ENCRYPTENDED}"
        $ = "-nolocal"
        $ = "-nolan"
        $ = "-wid"
        $ = "schtasks"
        $ = "vssadmin delete shadows"
        $ = "wbadmin"
        $ = "wmic"
        $ = "bcdedit"
    condition:
        7 of them
}

rule CrowdStrike_CSIT_20015_01 : hannotog lotus_panda 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects prominent strings in Hannotog malware"
        reports = "CSIT-20015"
        version = "202001311619"
        last_modified = "2020-01-31"
        actor = "LOTUS PANDA"
        malware_family = "Hannotog"
    strings:
        $dbg1 = "connection to %s:%d error!:%d"
        $dbg2 = "Recv buf %s"
        $dbg3 = "connection to %s:%d OK!"
        $dbg4 = "Start: WSAStartup failed %d."
        $dbg5 = "De failed, %d."
        $dbg6 = "Unused proxy information"
        $dbg7 = "Get Request Failed: %d"
        $dbg8 = "Open connection failed:%d"
        $dbg9 = "Open session failed:%d"
        $dbg10 = "Data is too loog"
        $dbg11 = "Length error:%d"
        $dbg12 = "Post Request Failed: %d"
        $dbg13 = "Failed socket()!"
        $cmd1 = {73 65 74 6C 6F 67 0D 0A}
        $cmd2 = {6E 6F 74 6C 6F 67 0D 0A}
        $cmd3 = {72 65 73 74 61 72 74 0D 0A}
    condition:
        filesize<500KB and 4 of ($dbg*) or all of ($cmd*)
}

rule CrowdStrike_CSIT_20022_01 : imperial_kitten rat twostep 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects Python functions names used with IMPERIAL KITTEN tool TwoStep"
        reports = "CSIT-20022"
        version = "202005151221"
        last_modified = "2020-05-15"
        actor = "IMPERIAL KITTEN"
        malware_family = "TwoStep"
    strings:
        $a_1 = "def commandExecution" wide ascii
        $a_2 = "def runDefaultCommands" wide ascii
        $a_3 = "def fileExecution" wide ascii
        $a_4 = "def pathGenerator" wide ascii
        $a_5 = "def stabilize" wide ascii
        $a_6 = "def downlaodFile" wide ascii
        $a_7 = "def autoScript" wide ascii
        $a_8 = "def uploader" wide ascii
        $a_9 = "def executer" wide ascii
        $a_10 = "def download" wide ascii
        $a_11 = "def autoCommand" wide ascii
        $a_13 = "def send_output" wide ascii
        $a_14 = "def receive_input" wide ascii
        $b = "# -*- coding: utf-8 -*-" wide ascii
    condition:
        $b in (0..0x20) and 11 of ($a_*)
}

rule CrowdStrike_CSIT_20022_02 : imperial_kitten pyinstaller twostep 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects PyInstaller name used for IMPERIAL KITTEN tool TwoStep"
        reports = "CSIT-20022"
        version = "202006262315"
        last_modified = "2020-06-26"
        actor = "IMPERIAL KITTEN"
        malware_family = "TwoStep"
    strings:
        // 2-base64-5-step-tcp-shell-decode-execute-client
        // 2-base64-5-step-http-shell-decode-execute-client
        // 2-base64-5-step-tcp-shell-decode-execute-revFile
        $ = "2-base64-5-step-tcp-shell-decode-execute-" wide ascii
        $ = "2-base64-5-step-http-shell-decode-execute-" wide ascii
    condition:
        uint16(0) == 0x5a4d and any of them
}

rule CrowdStrike_Bisonal_Updated : bisonal karma_panda rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects instances of Bisonal implant variant"
        reports = "CSA-200115"
        version = "202004082108"
        last_modified = "2020-04-08"
        malware_family = "Bisonal"
    strings:
        $str_dll_imiss      = "IMissServDll.dll" fullword
        $str_askppbu        = "akspbu.txt" fullword
        $str_recv_spaced    = { 72 65 63 76 20 20 73 75 63 63 65 73 73 0a 00 }
        $str_flag           = { 66 6c 61 67 20 3a 00 }
        $str_thatmustbe     = "thatmustbe" fullword
        $str_mismyou        = "mismyou" fullword
        $str_sucfai         = "suc_fai==true"
        // RC4 code fragment
        /* Code from starting VA 100021e5:
        lea     eax, [edx+1]
        xor     edx, edx
        div     edi
        inc     ecx
        cmp     ecx, 100h
        jl      short loc_100021DB
        xor     eax, eax
        */
        $code_va_100021E5 = { 8d 42 01 33 d2 f7 f7 41 81 f9 00 01 00 00 7c e6 33 c0 }
        // RC4 code alternate variant
        /* Code from starting VA 00402228:
        lea     eax, [edx+1]
        xor     edx, edx
        div     [ebp+arg_4]
        inc     esi
        cmp     esi, ecx
        jl      short loc_40221B
        xor     edi, edi
        */
        $code_va_00402228 = { 8d 42 01 33 d2 f7 75 ?? 46 3b f1 7c e6 33 ff }
    condition:
        filesize < 2MB and
        2 of them
}

rule CrowdStrike_CSA_200131_01 : helix_kitten rat seebee 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects HELIX KITTEN SeeBee through strings used in the C2 protocol"
        reports = "CSA-200131,CSIT-20121"
        version = "202006261355"
        last_modified = "2020-06-26"
        actor = "HELIX KITTEN"
        malware_family = "SeeBee"
    strings:
        $ = "/upl"
        $ = "/dow"
        $ = "?ser=000000"
    condition:
        uint16(0) == 0x5A4D and
        uint32(uint32(0x3C)) == 0x00004550 and
        all of them
}

rule CrowdStrike_CSA_200134_01 : implant powerton refined_kitten 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects .NET GUIDS used in occurrence with POWERTON .NET malware"
        reports = "CSA-200134"
        version = "202005011711"
        last_modified = "2020-05-01"
        actor = "REFINED KITTEN"
        malware_family = "POWERTON"
    strings:
        //Payload: 6e067ba5e3ed1e8d01d1c24cc6a291039131af723d5a94550e4bc1d8a1ce2574
        $ = "e6a81a13-fb31-4bfe-ae73-d4c4b61f52e5" wide ascii
        //Loader: 3f5e63ac398f0207566387670741c3b620912fc3ba8539e9d1d7106d07d26422
        $ = "7d7c264a-90df-457e-b542-cb6142c743eb" wide ascii
    condition:
        uint16(0) == 0x5a4d and any of them
}

rule CrowdStrike_CSA_200134_02 : implant powerton refined_kitten 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects strings and code used by .NET POWERTON loader"
        reports = "CSA-200134"
        version = "202005011712"
        last_modified = "2020-05-01"
        actor = "REFINED KITTEN"
        malware_family = "POWERTON"
    strings:
        $ = "VmlzdWFsIFNldCQ=" wide ascii
        $ = { 08 00 00 f7 ed bd }
    condition:
        uint16(0) == 0x5a4d and all of them
}

rule CrowdStrike_CSA_200134_03 : implant powerton refined_kitten 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects function names used by POWERTON .NET implant"
        reports = "CSA-200134"
        version = "202001311625"
        last_modified = "2020-01-31"
        actor = "REFINED KITTEN"
        malware_family = "POWERTON"
    strings:
        $a_1 = "_PostSleep" wide ascii
        $a_2 = "_RunCMD" wide ascii
        $a_3 = "_getFile" wide ascii
        $a_4 = "_Startup" wide ascii
        $a_5 = "_unhex" wide ascii
        $a_6 = "_PostResult" wide ascii
        $a_7 = "_StartupOtherUser" wide ascii
        $a_8 = "_getmd5" wide ascii
        $a_9 = "_Download" wide ascii
        $a_10 = "_Sleep" wide ascii
        $a_11 = "_GetMd5Hash" wide ascii
        $a_12 = "_ByteArrayToString" wide ascii
        $a_13 = "_GetOSFriendlyName" wide ascii
        $a_14 = "_ToByteArray" wide ascii
        $a_15 = "_RandomString" wide ascii
        $a_16 = "_fileSize" wide ascii
        $a_17 = "_Decryptor" wide ascii
        $a_18 = "_upload" wide ascii
        $a_19 = "_Encryptor" wide ascii
        $a_20 = "_IsBase64" wide ascii
        $a_21 = "_Connection" wide ascii
        $a_22 = "_PrintSc" wide ascii
        $a_23 = "_Servercommand" wide ascii
    condition:
        uint16(0) == 0x5a4d and 17 of ($a_*)
}

rule CrowdStrike_CSIT_20002_01 : atm_malware whisper_spider 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detect strings and opcodes present in XFS-Test ATM malware"
        reports = "CSIT-20002"
        version = "202102191058"
        last_modified = "2021-02-19"
        actor = "WHISPER SPIDER"
        malware_family = "XFS-Test"
    strings:
        $log_name = "C:\\xfsasdf.txt"
        $log1 = "Injected mxsfs killer into %d."
        $log2 = "pos=%d, status=%d, shutter=%d, transport=%d, status=%d"
        $log3 = "state=%d, safedoor=%d, dispenser=%d, stacker=%d"
        $log4 = "Exchanging cashunits"
        $code_leet = { c7 05 [4] 39 05 00 00 5? 8b }
    condition:
        uint16(0) == 0x5a4d and
        ($log_name or (any of ($log*)) or $code_leet) and
        filesize < 800KB
}

rule CrowdStrike_CSIT_20102_01 : glitchpos pos_scraper unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects Unpacked Samples of GlitchPoS "
        reports = "CSIT-20102"
        version = "202101121556"
        last_modified = "2021-01-12"
        malware_family = "GlitchPoS"
    strings:
        $pattern1 = "\\d{13,19}\\W\\d{7}\\w*" wide
        $pattern2 = "3D,2B,2F,=,+,/" wide
        $pattern3 = "=,+,/,3D,2B,2F" wide
        $param1 = "&s=1" wide
        $param2 = "&r=1" wide
        $param3 = "&nc=1" wide
        $param4 = "&ui=1" wide
        $param5 = "&u=1" wide
        $code1 = ":Set obj = CreateObject(" wide
        $code2 = "Scripting.FileSystemObject" wide
        $code3 = ":while obj.FileExists(path)" wide
        $code4 = ":obj.DeleteFile(path)" wide
        $code5 = ":obj.CopyFile " wide
        $code6 = ").Run " wide
        $other1 = "uid.log" wide
        $other2 = "?ped=" wide
        $other3 = "Select * from Win32_NetworkAdapter where physicaladapter=true" wide
        $keygen_1 = { FF EC 39 0A 36 00 08 00 39 0A 37 00 08 00 74 }
        $keygen_2 = { 0A 1D 00 08 00 39 0A 1E 00 08 00 74 04 FF 28 2C FF 01 00 25 F5 00 }
    condition:
        uint16(0) == 0x5a4d and
        all of ($pattern*) or all of ($param*) or all of ($code*) or all of ($other*) or any of ($keygen_*)
}

rule CrowdStrike_CSA_200224_02 : banker kiron 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects samples of Kiron trojan"
        reports = "CSA-200224"
        version = "202105261605"
        last_modified = "2021-05-26"
        malware_family = "Kiron"
    strings:
        $ = "TRtc"
        $ = "Windows"
        $ = "Magnifier"
        $ = "TEventHandlers"
        $ = "h55u4u4u5u5ii5"
    condition:
        uint16(0)==0x5A4D and
        4 of them
}

rule CrowdStrike_CSIT_20019_02 : dll kazuar venomous_bear 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects distinct code that calls CorBindToRuntimeEx using an API hash."
        reports = "CSIT-20019"
        version = "202001311626"
        last_modified = "2020-01-31"
        actor = "VENOMOUS BEAR"
        malware_family = "Kazuar"
    strings:
        $sub_6D842D5A  = { 48 83 ec 28 e8 ?? ?? ?? ?? ba 2b f6 86 57 48 89 c1 48 83 c4 28 e9 ?? ?? ?? ?? }
    condition:
        $sub_6D842D5A
}

rule CrowdStrike_CSIT_20038_03 : fancy_bear trsloader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects TrsLoader known import hashes"
        reports = "CSIT-20038"
        version = "202003131431"
        last_modified = "2020-03-13"
        actor = "FANCY BEAR"
        malware_family = "TrsLoader"
        
    strings:
        $h1 = {32 F1 9C A9}     // RtlExitUserProcess
        $h2 = {BB 2E 92 5D}     // GetCommandLineW
        $h3 = {2C 7E 79 DF}     // GetFileSize
        $h4 = {10 30 4A 0D}     // ReadFile
        $h5 = {0C C2 57 5F}     // CreateFileW
        $h6 = {E6 30 AC D7}     // VirtualProtect
        $h7 = {B7 4A 24 8A}     // CloseHandle
        $h8 = {10 BE 69 DF}     // AllocateHeap
        $h9 = {80 14 D6 FF}     // HeapFree
        $h10 = {63 B5 CA EB}    // GetProcessHeap
        $h11 = {4C D2 66 3B}    // GetProcAddress
        $h12 = {36 D8 F5 79}    // LoadLibraryA
        // LCG hash algorithm parameters used
        $lcg1 = {0D 66 19 00}
        $lcg2 = {5F F3 6E 3C}
    condition:
        filesize > 2KB and filesize < 1MB and
        all of ($lcg*) and 3 of ($h*)
}

rule CrowdStrike_CSIT_20038_02 : fancy_bear trsloader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects TrsLoader samples from obfuscated command-line arguments hashes"
        reports = "CSIT-20038"
        version = "202003131434"
        last_modified = "2020-03-13"
        actor = "FANCY BEAR"
        malware_family = "TrsLoader"
        
    strings:
        // Hash values
        $h1 = {B? 08 E6 00 00}
        $h2 = {B? FB E5 00 00}
        // LCG hash algorithm parameters used
        $lcg1 = {0D 66 19 00}
        $lcg2 = {5F F3 6E 3C}
    condition:
        all of them and filesize > 5KB and filesize < 500KB
}

rule CrowdStrike_CSIT_20038_04 : fancy_bear trsloader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects the x86 instructions used for the decryption of the self-wiping batch file embedded in TrsLoader samples"
        reports = "CSIT-20038"
        version = "202003131409"
        last_modified = "2020-03-13"
        actor = "FANCY BEAR"
        malware_family = "TrsLoader"
        
    strings:
        $i1 = {81 3? 07 79 F7 A5}
        $i2 = {81 7? ?? 9C 73 BB D4}
    condition:
        all of them
}

rule CrowdStrike_Valak_Plugin_IpGeo : ecrime plugin valak 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects strings identifying the Valak IPGeo plugin"
        version = "202002070920"
        last_modified = "2020-02-07"
        malware_family = "Valak"
    strings:
        $ = "IpGeo"
        $ = "ENDPOINT"
        $ = "LOG_TYPE"
        $ = "NAME"
        $ = "nonce1" wide
        $ = "nonce2" wide
        $ = "plugin" wide
        $ = "ltype" wide
    condition:
        all of them
}

rule CrowdStrike_Valak_Plugin_NetRecon : ecrime plugin valak 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects strings identifying the Valak NetRecon plugin"
        version = "202002070920"
        last_modified = "2020-02-07"
        malware_family = "Valak"
    strings:
        $ = "NetRecon"
        $ = "ENDPOINT"
        $ = "LOG_TYPE"
        $ = "NAME"
        $ = "nonce1" wide
        $ = "nonce2" wide
        $ = "plugin" wide
        $ = "ltype" wide
    condition:
        all of them
}

rule CrowdStrike_Valak_Plugin_PasswordGrabber : ecrime plugin valak 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects strings identifying the Valak PasswordGrabber plugin"
        version = "202002070919"
        last_modified = "2020-02-07"
        malware_family = "Valak"
    strings:
        $ = "PasswordGrabber"
        $ = "ENDPOINT"
        $ = "LOG_TYPE"
        $ = "NAME"
        $ = "nonce1" wide
        $ = "nonce2" wide
        $ = "plugin" wide
        $ = "ltype" wide
    condition:
        all of them
}

rule CrowdStrike_Valak_Plugin_ProcInfo : ecrime plugin valak 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects strings identifying the Valak ProcInfo plugin"
        version = "202002070919"
        last_modified = "2020-02-07"
        malware_family = "Valak"
    strings:
        $ = "ProcInfo"
        $ = "ENDPOINT"
        $ = "LOG_TYPE"
        $ = "NAME"
        $ = "nonce1" wide
        $ = "nonce2" wide
        $ = "plugin" wide
        $ = "ltype" wide
    condition:
        all of them
}

rule CrowdStrike_Valak_Plugin_ScreenCap : ecrime plugin valak 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects strings identifying the Valak ScreenCap plugin"
        version = "202002070919"
        last_modified = "2020-02-07"
        malware_family = "Valak"
    strings:
        $ = "ScreenCap"
        $ = "ENDPOINT"
        $ = "LOG_TYPE"
        $ = "NAME"
        $ = "nonce1" wide
        $ = "nonce2" wide
        $ = "plugin" wide
        $ = "ltype" wide
    condition:
        all of them
}

rule CrowdStrike_Valak_Plugin_SystemInfo : ecrime plugin valak 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects strings identifying the Valak SystemInfo plugin"
        version = "202002070919"
        last_modified = "2020-02-07"
        malware_family = "Valak"
    strings:
        $ = "SystemInfo"
        $ = "ENDPOINT"
        $ = "LOG_TYPE"
        $ = "NAME"
        $ = "nonce1" wide
        $ = "nonce2" wide
        $ = "plugin" wide
        $ = "ltype" wide
    condition:
        all of them
}

rule CrowdStrike_CSA_200172_01 : dotnet primitive_bear triceratops 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects unique sleep code used by Triceratops Microsoft Office file infector"
        reports = "CSA-200172"
        version = "202003031528"
        last_modified = "2020-03-03"
        actor = "PRIMITIVE BEAR"
        malware_family = "Triceratops"
    strings:
        $bytes_0x565_0x5a0  = { 00 ( 11 08 | 08 ) 23 00 00 00 00 00 00 20 40 23 00 00 00 00 00 00 10 40 ( 11 09 | 09 ) 5a 23 00 00 00 00 00 00 f0 3f 59 23 00 00 00 00 00 00 10 40 ( 11  09 | 09 ) 5a 23 00 00 00 00 00 00 f0 3f 58 5a 5b 59 }
    condition:
        $bytes_0x565_0x5a0
}

rule CrowdStrike_CSIT_20047_01 : ransomware thanos 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects samples of Thanos Ransomware"
        reports = "CSIT-20047"
        version = "202103231100"
        last_modified = "2021-03-23"
        malware_family = "ThanosRansomware"
    strings:
        $m_str_1 = "EVET" wide
        $m_str_2 = "HELP_ME_RECOVER_MY_FILES.txt" wide
        $m_str_3 = ".crypted" wide
        $m_str_4 = "VW5pcXVlIElkZW50aWZpZXIgS2V5IChtdXN0IGJlIHNlbnQgdG8gdXMgdG9nZXRoZXIgd2l0aCBwcm9vZiBvZiBwYXltZW50KTog" wide
        $m_str_5 = "TnVtYmVyIG9mIGZpbGVzIHRoYXQgeW91IGNvdWxkIGhhdmUgcG90ZW50aWFsbHkgbG9zdCBmb3JldmVyIGNhbiBiZSBhcyBoaWdoIGFzOiA=" wide
        $m_str_6 = "aHR0cCBhbmFseXplciBzdGFuZC1hbG9uZQ==" wide
        $m_str_7 = "TWVnYUR1bXBlcg==" wide
        $m_str_8 = "aHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL2QzNWhhL1Byb2Nlc3NIaWRlL21hc3Rlci9iaW5zL1Byb2Nlc3NIaWRlMzIuZXhl" wide
        $m_str_9 = "RansomBuilder_Log" wide
        $m_str_10 = "RijndaelManaged"
        $str_1 = "stop avpsus /y" wide
        $str_2 = "stop McAfeeDLPAgentService /y" wide
        $str_3 = "stop mfewc /y" wide
        $str_4 = "stop BMR Boot Service /y" wide
        $str_5 = "stop NetBackup BMR MTFTP Service /y" wide
        $str_6 = "config SQLTELEMETRY" wide
        $str_7 = "config SQLWriter start= disabled" wide
        $str_8 = "config SstpSvc start= disabled" wide
        $str_9 = "/IM mspub.exe /F" wide
        $str_10 = "/IM mydesktop" wide
        $str_11 = "Delete Shadows /all /quiet" wide
        $str_12 = "resize shadowstorage /for=c: /on=c: /maxsize=" wide
        $str_13 = "FtpWebRequest"
        $str_14 = "FtpWebResponse"
        $str_15 = "ftp://" wide
        $str_16 = "raw.githubusercontent.com" wide
        $str_17 = "FTP Password" wide
        $str_18 = "FTP Username" wide
        $str_19 = "bHNhc3MuZXhl" wide
        $str_20 = "TmV0d29ya1RyYWZmaWNWaWV3" wide
        $str_21 = "RGVsZXRlIFNoYWRvd3MgL2FsbCAvcXVpZXQ=" wide
        $str_22 = "c3RvcCBCYWNrdXBFeGVjQWdlbnRBY2NlbGVyYXRvciAveQ==" wide
        $str_23 = "cmVzaXplIHNoYWRvd3N0b3JhZ2UgL2Zvcj1oOiAvb249aDogL21heHNpemU9dW5ib3VuZGVk" wide
        $str_24 = "L3MgL2YgL3EgZDpcKi5WSEQgZDpcKi5iYWMgZDpcKi5iYWsgZDpcKi53YmNhdCBkOlwqLmJrZiBkOlxCYWNrdXAqLiogZDpcYmFja3VwKi4qIGQ6XCouc2V0IGQ6XCoud2luIGQ6XCouZHNr" wide
    condition:
        3 of ($m_str*) and
        3 of ($str_*)
}

rule CrowdStrike_Winterlove_Hidden_Account_Creator : post_exploitation winterlove 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects a post-exploitation tool used to add a hidden account on Windows-based systems for use by malicious adversaries."
        version = "202006190727"
        last_modified = "2020-06-19"
    strings:
        $ = "Now Create %s Registry Key..."
        $ = "SAM\\SAM\\Domains\\Account\\Users\\%s"
        $ = "Delete %s Success..."
        $ = { 4f 4b 21 0d 0a 55 53 45 52 3a 20 25 73 0d 0a 50 41 53 53 3a 20 25 73 00 }
    condition:
        all of them
}

rule CrowdStrike_CSIT_20002_02 : atm_malware whisper_spider 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detect strings and opcodes present in new version of XFS-Test ATM malware"
        reports = "CSIT-20002"
        version = "202102191058"
        last_modified = "2021-02-19"
        actor = "WHISPER SPIDER"
        malware_family = "XFS-Test"
    strings:
        // log messagess
        $ = "%s\\rtksys2.exe"
        $ = "%s\\rtkdrv2.exe"
        $ = "--install"
        $ = "--systeminstall"
        $ = "Connected. Version: wfs:%d.%d, srvc:%d.%d, spi:%d.%d"
        $ = "pos=%d, status=%d, shutter=%d, transport=%d, status=%d"
        $ = "Error getting bill status: 0x%p."
        $ = "ADD HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Run /v \"%s\" /t REG_SZ /d \"%s\"" wide
        $ = "%s\\updatea.bin" wide
        $ = "%s\\updatea2.bin" wide
    condition:
        uint16(0) == 0x5a4d and
        3 of them and
        filesize < 800KB
}

rule CrowdStrike_CSA_200216_02 : banker megatron trojan 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects samples of Metamorfo variant dubbed Megatron by CrowdStrike Intelligence"
        reports = "CSA-200216"
        version = "202103181549"
        last_modified = "2021-03-18"
        malware_family = "Megatron"
    strings:
        $ = "TZDecompressionStream"
        $ = "TMemoryStream"
        $ = "TZDecompressionStream"
        $ = "TResourceStream"
        $ = { 50 6A 0A 8B ?? ?? ?? ?? ?? B2 01 A1 ?? ?? ?? ?? E8 ?? ?? ?? ?? }
        $ = { B8 ?? 7F 00 00 E8 ?? ?? ?? ?? B8 ?? 7F 00 00 E8 ?? ?? ?? ?? B8 ?? 7F 00 00 E8 ?? ?? ?? ?? }
        $ = { 6A 00 6A 00 8B ?? ?? E8 ?? ?? ?? ?? 8B ?? ?? E8 }
    condition:
        all of them
}

rule CrowdStrike_CSIT_20027_01 : labyrinth_chollima manuscrypt rat webtroy 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects strings used to generate traffic and execute commands in executable versions of WebTroy (mach-o, PE)"
        reports = "CSIT-20027"
        version = "202008121735"
        last_modified = "2020-08-12"
        actor = "LABYRINTH CHOLLIMA"
        malware_family = "Manuscrypt"
    strings:
        $randSeed0 = { 11 08 04 02 }
        $randSeed1 = { 69 ?? 80 3F 00 00 }
        $multipartSess1 = "_sessid1"
        $multipartSess2 = "_sessid2"
        $multipartWebidentF = "_webident_f"
        $multipartWebidentS = "_webident_s"
        $multipartMedia1 = "_media_1"
        $multipartMedia2 = "_media_2"
        $bashExec = "/bin/bash -c"
        $cmdExec = "cmd.exe /c" wide
    condition:
        (uint16(0) == 0x5A4D and 4 of them) or (uint16(0) == 0xfacf and 4 of them) or (uint16(0) == 0xface and 4 of them) and filesize < 250KB
}

rule CrowdStrike_CSA_200199_01 : cobravenom dropper velvet_chollima 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects the resource type and self delete string of CobraVenom droppers"
        reports = "CSA-200199"
        version = "202009211932"
        last_modified = "2020-09-21"
        actor = "VELVET CHOLLIMA"
        malware_family = "CobraVenom"
    strings:
        $res = "BINARY"
        $bat = { 3a 52 65 70 65 61 74 31 0d 0a 64 65 6c 20 22 25
        73 22 0d 0a 69 66 20 65 78 69 73 74 20 22 25 73
        22 20 67 6f 74 6f 20 52 65 70 65 61 74 31 0d 0a
        64 65 6c 20 22 25 73 22 20 00 }
    condition:
        all of them
}

rule CrowdStrike_CSA_200199_02 : cobravenom rat velvet_chollima 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects the JS variant of CobraVenom utilised by VELVET CHOLLIMA"
        reports = "CSA-200199,CSIT-20136"
        version = "202009211931"
        last_modified = "2020-09-21"
        actor = "VELVET CHOLLIMA"
        malware_family = "CobraVenom"
    strings:
        $fmt = "%d-%02d-%02d_%02d-%02d-%02d-%03d"
        $js = ".JS"
        $url = "%s/?m="
    condition:
        all of them
}

rule CrowdStrike_VENOMOUS_BEAR_PDF_Wipbot_Payload : delivery_document venomous_bear wipbot 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects encoded Wipbot payloads as seen in malicious PDF documents"
        version = "202002141007"
        last_modified = "2020-02-14"
        actor = "VENOMOUS BEAR"
        malware_family = "Wipbot"
    strings:
        $enc_pe_start = { be aa 67 fc 00 0c 17 }
    condition:
        uint32(0) == 0x46445025 and
        $enc_pe_start
}

rule CrowdStrike_VENOMOUS_BEAR_Wipbot_01 : rat venomous_bear wipbot 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects Wipbot via distinctive string obfuscation algorithm"
        version = "202002141007"
        last_modified = "2020-02-14"
        actor = "VENOMOUS BEAR"
        malware_family = "Wipbot"
    strings:
        $strdecloop = { 8d 3c 08 88 c2 32 17 40 83 f2 }
    condition:
        uint16(0) == 0x5a4d and
        $strdecloop
}

rule CrowdStrike_VENOMOUS_BEAR_Wipbot_02 : rat venomous_bear wipbot 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects Wipbot via distinctive string conversion code"
        version = "202002141007"
        last_modified = "2020-02-14"
        actor = "VENOMOUS BEAR"
        malware_family = "Wipbot"
    strings:
        $strconvloop = { 66 0f be 14 0e 66 89 14 4b 41 39 c1 75 f2 }
    condition:
        uint16(0) == 0x5a4d and
        $strconvloop
}

rule CrowdStrike_CSIT_20029_01 : android backdoor barbarian berserk_bear implant 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects the DEX file of Barbarian Core"
        reports = "CSIT-20029"
        version = "202101291824"
        last_modified = "2021-01-29"
    strings:
        $header_dex = {64 65 78 0a 30 33 35 00}
        /*
        48 06 01 03             aget-byte           v6, v1, v3
        21 97                   array-length        v7, p1
        94 07 03 07             rem-int             v7, v3, v7
        48 07 09 07             aget-byte           v7, p1, v7
        B7 76                   xor-int/2addr       v6, v7
        DF 06 06 7A             xor-int/lit8        v6, v6, 0x7A
        8D 66                   int-to-byte         v6, v6
        4F 06 05 03             aput-byte           v6, v5, v3
        D8 03 03 01             add-int/lit8        v3, v3, 1
        */
        $code_string_decryption = { 48 [3] 21 ?? 94 [3] 48 [3] B7 [1-5] 8D ?? 4F [3] D8 [2] 01 }
        /*
        13 04 0B 00             const/16            v4, 11
        33 43 20 00             if-ne               v3, v4, :C0
        13 03 38 00             const/16            v3, 56
        33 30 1C 00             if-ne               v0, v3, :C0
        */
        $code_phone_number_normalization = { 13 ?? 0B 00 33 [2] 00 13 ?? 38 00 33 [2] 00 }
        /*
        13 07 10 00             const/16            v7, 16
        12 00                   const/4             v0, 0
        21 81                   array-length        v1, p0
        DC 01 01 10             rem-int/lit8        v1, v1, 16
        D9 02 01 10             rsub-int/lit8       v2, v1, 16
        21 83                   array-length        v3, p0
        21 81                   array-length        v1, p0
        */
        $code_aes = { 13 ?? 10 00 12 00 21 81 DC ?? ?? 10 D9 ?? ?? 10 21 ?? 21 }
    condition:
        ($header_dex at 0) and all of ($code_*)
}

rule CrowdStrike_CSIT_20029_02 : android backdoor barbarian berserk_bear implant 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects the DEX file of Barbarian XMPP"
        reports = "CSIT-20029"
        version = "202101291824"
        last_modified = "2021-01-29"
    strings:
        $header_dex = {64 65 78 0a 30 33 35 00}
        /*
        48 06 01 03             aget-byte           v6, v1, v3
        21 97                   array-length        v7, p1
        94 07 03 07             rem-int             v7, v3, v7
        48 07 09 07             aget-byte           v7, p1, v7
        B7 76                   xor-int/2addr       v6, v7
        DF 06 06 7A             xor-int/lit8        v6, v6, 0x7A
        8D 66                   int-to-byte         v6, v6
        4F 06 05 03             aput-byte           v6, v5, v3
        D8 03 03 01             add-int/lit8        v3, v3, 1
        */
        $code_string_decryption = { 48 [3] 21 ?? 94 [3] 48 [3] B7 ?? DF [3] 8D ?? 4F [3] D8 [2] 01 }
        /*
        13 04 0B 00             const/16            v4, 11
        33 43 20 00             if-ne               v3, v4, :C0
        13 03 38 00             const/16            v3, 56
        33 30 1C 00             if-ne               v0, v3, :C0
        */
        $code_phone_number_normalization = { 13 ?? 0B 00 33 [2] 00 13 ?? 38 00 33 [2] 00 }
        $string_smack = "smack"
    condition:
        ($header_dex at 0) and 1 of ($code_*) and #string_smack > 500
}

rule CrowdStrike_CSIT_20037_03 : labyrinth_chollima rat undergroundrat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects strings present in LABYRINTH CHOLLIMA's UnderGround RAT"
        reports = "CSA-200912,CSIT-20037"
        version = "202007150932"
        last_modified = "2020-07-15"
        actor = "LABYRINTH CHOLLIMA"
        malware_family = "UnderGroundRAT"
    strings:
        $format = "id=%s%s&%s=%s&%s=%s&%s="
        $id = "T1B7D95256A2001E"
    condition:
        all of them
}

rule CrowdStrike_CSIT_20038_05 : fancy_bear trsloader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects code from the TrsLoader crypto container decryption function"
        reports = "CSIT-20038"
        version = "202003131409"
        last_modified = "2020-03-13"
        actor = "FANCY BEAR"
        malware_family = "TrsLoader"
    strings:
        // .text:10001020 8A C3                                   mov     al, bl
        // .text:10001022 F6 E9                                   imul    cl
        // .text:10001024 02 04 39                                add     al, [ecx+edi]
        // .text:10001027 41                                      inc     ecx
        // .text:10001028 30 02                                   xor     [edx], al
        // .text:1000102A 3B CE                                   cmp     ecx, esi
        $x86 = {8A C3 F6 E9 02 04 39 41 30 02 3B CE}
        // .text:000000013F331250 0F B6 C1                        movzx   eax, cl
        // .text:000000013F331253 FF C1                           inc     ecx
        // .text:000000013F331255 41 F6 E9                        imul    r9b
        // .text:000000013F331258 41 02 C0                        add     al, r8b
        // .text:000000013F33125B 32 D0                           xor     dl, al
        // .text:000000013F33125D 41 88 12                        mov     [r10], dl
        // .text:000000013F331260 44 0F B6 04 39                  movzx   r8d, bl
        $x64 = {0F B6 C1 FF C1 41 F6 E9 41 02 C0 32 D0 41 88 12 44 0F B6 04 39}
    condition:
        any of them
}

rule CrowdStrike_CSIT_20062_01 : forelord implant static_kitten 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects TTPs used by STATIC KITTEN implant ForeLord to make C2 requests via DNS"
        reports = "CSIT-20062"
        version = "202008281650"
        last_modified = "2020-08-28"
        actor = "STATIC KITTEN"
        malware_family = "ForeLord"
    strings:
        $dns_str_1 = "lordlordlordlord" wide ascii
        $dns_str_2 = "0000" wide ascii
        $dns_str_3 = "0001" wide ascii
        $dns_str_4 = "0002" wide ascii
        $dns_str_5 = "SHA1" wide ascii
        $dns_str_6 = "C:\\Windows\\System32\\cmd.exe" wide ascii
        $dns_str_7 = "CreatePipe" wide ascii
        $dns_str_8 = "lord" wide ascii
        $dns_ttp_1 = "DnsQuery_A" wide ascii
        $dns_ttp_2_1 = "8.8.8.8" wide ascii
        $dns_ttp_2_2 = "53" wide ascii
        $dns_ttp_2_3 = "getaddrinfo" wide ascii
        $dns_ttp_2_4 = "WS2_32.dll" wide ascii
    condition:
        uint16(0) == 0x5a4d and filesize < 1MB and 7 of ($dns_str_*) and ( $dns_ttp_1 or all of ($dns_ttp_2_*) )
}

// WARNING: This rule will only work with YARA 3
import "pe"
import "hash"

rule CrowdStrike_CSIT_20062_02 : forelord implant static_kitten 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects Clear Rich data used with STATIC KITTEN  implant ForeLord"
        reports = "CSIT-20062"
        version = "202106171600"
        last_modified = "2021-06-17"
        actor = "STATIC KITTEN"
        malware_family = "ForeLord"
    condition:
        hash.sha256(pe.rich_signature.clear_data) == "f650ec2fb7c4ab5e91854ab8c0a10603d12e3747f9ac95c6a520efea317bbc10"
        or
        hash.sha256(pe.rich_signature.clear_data) == "b117a94faef49df7f5ed50049ff0a328319c9886087fff0687478cc0dd63522f"
}

rule CrowdStrike_CSA_200259_01 : malicious_document primitive_bear vbscript 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects features used in embedded VBScript from a likely PRIMITIVE BEAR macro document"
        reports = "CSA-200259"
        version = "202002281004"
        last_modified = "2020-02-28"
        actor = "PRIMITIVE BEAR"
    strings:
        $magic = { d0 cf 11 e0 }
        $s_select_process = "Select * from Win32_Process"
        $s_select_bios = "Select * from Win32_BIOS where PrimaryBIOS = true"
        $s_homedrive = "HOMEDRIVE"
        $s_getdrive = "GetDrive"
        $s_serial = "SerialNumber"
        $s_computername = "COMPUTERNAME"
        $proc_b_1 = "_!PExp"
        $proc_b_2 = "_!WShark"
    condition:
        $magic at 0 and
        1 of ($proc_b*) and
        2 of ($s_*)
}

rule CrowdStrike_CSIT_20061_05 : fleetingenigma galaxy 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects distinctive loader shellcode fragments embedded in Galaxy GIF files."
        reports = "CSIT-20061"
        version = "202004031207"
        last_modified = "2020-04-03"
        malware_family = "Galaxy"
    strings:
        $code_func_start = { 488DAC2470FFFFFF4881EC900100004C8BC1 }
        $code_mem_alloc = { 33C9BA7001000041B8003000 }
        $err1 = { C785C80000000C000002 }
        $err2 = { C785C800000029000002 }
    condition:
        filesize<3MB and uint32(0)==0x38464947 and  (1 of ($code*) or all of ($err*))
}

rule CrowdStrike_CSIT_20061_04 : fleetingenigma galaxy 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects distinctive strings in Galaxy payload loader DLLs"
        reports = "CSIT-20061"
        version = "202004031159"
        last_modified = "2020-04-03"
        malware_family = "Galaxy"
    strings:
        $1 = "UpdateSchedule:%i"
        $g1 = "GIF87a"
        $g2 = "GIF89a"
    condition:
        filesize<2MB and uint16(0)==0x5a4d and $1 and 1 of ($g*)
}

rule CrowdStrike_CSIT_20061_03 : fleetingenigma galaxy 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects distinctive PDB path segments found in Galaxy samples"
        reports = "CSIT-20061"
        version = "202004031201"
        last_modified = "2020-04-03"
        malware_family = "Galaxy"
    strings:
        $1 = "\\Dev\\Galaxy\\"
        $2 = "\\TvServer.pdb"
    condition:
        filesize<5MB and any of them
}

rule CrowdStrike_CSIT_20061_02 : fleetingenigma galaxy 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects code artefacts from Galaxy components that load a DLL from the registry"
        reports = "CSIT-20061"
        version = "202004031201"
        last_modified = "2020-04-03"
        malware_family = "Galaxy"
    strings:
        $c1 = { 488B01488D542440FF5010488B4C2448 }
        $c2 = { FFC3837C244403 }
        $api = "KeyExW"
    condition:
        filesize<2MB and all of them
}

rule CrowdStrike_CSIT_20061_01 : fleetingenigma galaxy 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects distinctive strings in Galaxy payloads"
        reports = "CSIT-20061"
        version = "202004031200"
        last_modified = "2020-04-03"
        malware_family = "Galaxy"
    strings:
        $1 = "%s - %u: %s"
        $3 = "ss exception: %s"
        $4 = "ra: %u" fullword
        $5 = "ra exception: %s"
        $6 = "{\"type\" : \"%s\",  \"errorCode\" : %u, \"error\" : %u}"
        $7 = "{\"type\" : \"%s\",  \"errorCode\" : %u, \"error\" : %u, \"context\" : \"%s\"}"
        $8 = "{\"type\" : \"%s\",  \"id\" : %u, \"error\" : %u, \"context\" : \"%s\"}"
        $9 = "rp: %s" fullword
        $10 = "AVLauncherConfigurationInFile"
        $11 = "AVILauncherConfigurationReader"
        $12 = "r exception: %s" fullword
        $13 = "id: %I64u" fullword
    condition:
        filesize<5MB and 3 of them
}

rule CrowdStrike_CSIT_20066_12 : primitive_bear usb_grabber 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects SQLite static library and requests in UsbGrabber"
        reports = "CSIT-20066"
        version = "202006100928"
        last_modified = "2020-06-10"
        actor = "PRIMITIVE BEAR"
        malware_family = "UsbGrabber"
    strings:
        // UsbStealer requests
        $create_db_01 = "create table if not exists hashes (hash char(32) primary key)" ascii
        $create_db_02 = "create table if not exists settings (id int primary key, fr int)" ascii
        $insert_01 = "insert into hashes values ('%s')" ascii
        // SQLite static library strings
        $sqlite = "SQLite format 3" ascii
    condition:
        any of ($create_db_*) and
        any of ($insert_*) and
        $sqlite
}

rule CrowdStrike_CSIT_20066_13 : primitive_bear usb_grabber 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects UsbGrabber based on cleartext strings sometimes left in binaries by the developers"
        reports = "CSIT-20066"
        version = "202006100943"
        last_modified = "2020-06-10"
        actor = "PRIMITIVE BEAR"
        malware_family = "UsbGrabber"
    strings:
        $file_dir_01 = "reports\\" ascii wide
        $file_dir_02 = "\\Microsoft\\Windows\\" ascii wide
        $file_dir_03 = "\\Microsoft\\Windows\\Updates\\" ascii wide
        $file_dir_04 = "\\Google\\Chrome\\Default\\LocalStorage\\" ascii wide
        $file_db_01 = "cache32.bin" wide ascii
        $file_db_03 = "cache32.db" wide ascii
        $file_db_04 = "cache64.bin" wide ascii
        $file_db_06 = "cache64.db" wide ascii
        $file_db_07 = "asha.dat" wide ascii
        $file_db_08 = "ihqy2vo8v.dat" wide ascii
        $file_db_09 = "WebCache.dat" wide ascii
        $mutex_01 = "__rkFFF33i7CKun1N__" wide ascii
        $mutex_02 = "__rkh2v33i7CKun1N__" wide ascii
        $mutex_03 = "__rkh2vi7CKun1N__l" wide ascii
        $mutex_04 = "__rkh2vi7CKun1N__" wide ascii
        $mutex_05 = "__rkh2vi7CKun1U__" wide ascii
        $mutex_06 = "__rkh2vi7CKun1F__" wide ascii
        $mutex_07 = "__rkh2vi7CKun1__" wide ascii
        $mutex_08 = "__rkh2vi7CKun__" wide ascii
        $mutex_09 = "__Wsnusbtt73__" wide ascii
        $mutex_10 = "__kh2vWWWKu1__" wide ascii
        $mutex_11 = "__kh2vi7CKu1__" wide ascii
        $mutex_12 = "__kh2vi7CKu1__l" wide ascii
        $mutex_13 = "__kh2vi7CKu__" wide ascii
        $mutex_14 = "__Wsnusb73__" wide ascii
        $network_cc_01 = "195.62.52.93" wide ascii
        $network_cc_02 = "195.62.52.59" wide ascii
        $network_cc_03 = "195.2.253.218" wide ascii
        $network_cc_04 = "upfiles.myftp.org" nocase wide ascii
        $network_cc_05 = "winlocationmobile.ru" nocase wide ascii
        $network_cc_06 = "referal-mobile.ru" nocase wide ascii
        $network_cc_07 = "adblocked.space" nocase wide ascii
        $network_cc_08 = "fiofio.fun" nocase wide ascii
        $network_cc_09 = "195.62.53.63"wide ascii
        $network_cc_10 = "185.248.100.44"wide ascii
        $network_cc_11 = "adblock.host" nocase wide ascii
        $network_cc_12 = "193.19.118.137"wide ascii
        $network_cc_13 = "adblock.co.in" nocase wide ascii
        $network_cc_14 = "goolstore.ru" nocase wide ascii
    condition:
        any of ($mutex_*) or
        (any of ($file_dir_*) and any of ($file_db_*)) and
        any of ($network_cc_*)
}

rule CrowdStrike_CSIT_20066_07 : primitive_bear usb_grabber 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects network patterns used by UsbGrabber for file exfiltration"
        reports = "CSIT-20066"
        version = "202006100933"
        last_modified = "2020-06-10"
        actor = "PRIMITIVE BEAR"
        malware_family = "UsbGrabber"
    strings:
        $boundary_01 = "----qwerty" ascii
        $boundary_02 = "----------------------------AF26BCE3471A" ascii
        $boundary_03 = "----qweRRy123" ascii
        $http_method = "POST" ascii
        $http_url_default = "post.php" ascii
        $http_url_carmack_prng_url_01 = "YMnU0O" ascii
        $http_url_carmack_prng_url_02 = "MENq21" ascii
        $http_url_carmack_prng_url_03 = "44LTjb" ascii
        $http_url_carmack_prng_url_04 = "BJPYMn" ascii
        $http_url_carmack_prng_url_05 = "DF[hQz" ascii
        $http_url_carmack_prng_url_06 = "F5mMEN" ascii
        $http_url_carmack_prng_url_07 = "q21oFK" ascii
        $http_url_carmack_prng_url_08 = "8IMbjV" ascii
        $header_01 = "Content-Type: multipart/form-data; boundary=" ascii
        $field_header = "Content-Disposition: form-data; name=\"" ascii
        $field_name_01 = "filename" ascii
        $field_name_02 = "filedate" ascii
        $field_name_03 = "compname" ascii
        $field_name_04 = "serial" ascii
        $field_name_05 = "filesize" ascii
    condition:
        any of ($boundary_*) and
        any of ($http_url_*) and
        $header_01 and
        $http_method and
        $field_header and
        5 of ($field_name_*)
}

// WARNING: This rule will only work with YARA 3
import "pe"

rule CrowdStrike_CSIT_20066_11 : primitive_bear usb_grabber 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects DLLs with exports seen in UsbGrabber samples"
        reports = "CSIT-20066"
        version = "202102181424"
        last_modified = "2021-02-18"
        actor = "PRIMITIVE BEAR"
        malware_family = "UsbGrabber"
    condition:
        pe.characteristics & pe.DLL and
        (
        (pe.number_of_exports == 2 and pe.exports("StartBackup") and pe.exports("initial")) or
        (pe.number_of_exports == 1 and pe.exports("StartBackup")) or
        (pe.number_of_exports == 1 and pe.exports("chkupd")) or
        (pe.number_of_exports == 1 and pe.exports("hello32")) or
        (pe.number_of_exports == 1 and pe.exports("h")) or
        (pe.number_of_exports == 1 and pe.exports("cache")) or
        (pe.number_of_exports >= 10 and pe.exports("ekib")) or
        (pe.number_of_exports == 1 and pe.exports("gonduras")) or
        (pe.number_of_exports == 1 and pe.exports("nikaragua")) or
        (pe.number_of_exports == 1 and pe.exports("PterodoDS")) or
        (pe.number_of_exports >= 10 and pe.exports("igverervsv")) or
        (pe.number_of_exports >= 10 and pe.exports("ihbuwqcce")) or
        (pe.number_of_exports >= 10 and pe.exports("acvauy")) or
        (pe.number_of_exports >= 10 and pe.exports("iuvwecw")) or
        (pe.number_of_exports >= 10 and pe.exports("oiebrviuveev")) or
        (pe.number_of_exports >= 10 and pe.exports("oueyrbviev")) or
        (pe.number_of_exports >= 10 and pe.exports("oueyrbviev")) or
        (pe.number_of_exports >= 10 and pe.exports("qwecbl")) or
        (pe.number_of_exports >= 10 and pe.exports("siuervoeyrb")) or
        (pe.number_of_exports >= 10 and pe.exports("tufcu6")) or
        (pe.number_of_exports >= 10 and pe.exports("ty7wcv")) or
        (pe.number_of_exports >= 10 and pe.exports("wecwe")) or
        (pe.number_of_exports >= 10 and pe.exports("wetfvqi"))
        )
}

rule CrowdStrike_CSIT_20037_01 : dropper labyrinth_chollima neddnloader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects components present in a trojanized Putty sample that drops NedDnLoader"
        reports = "CSIT-20037"
        version = "202003061434"
        last_modified = "2020-03-06"
        actor = "LABYRINTH CHOLLIMA"
        malware_family = "NedDnLoader"
    strings:
        $config1 = {3D 64 83 00 00}
        $config2 = {3D 53 47 00 00}
        $dif = {41 0F B6 40 FF 49 8D 48 FF 41 32 C1 44 0F B6 09}
        $exec = {22 00 25 00 73 00 22 00 2C 00 20 00 25 00 73 00 20 00 25 00 73 00 00 00}
    condition:
        3 of them
}

rule CrowdStrike_CSA_200279_01 : mumbaidown mythic_leopard 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects an instance of MYTHIC LEOPARD's multi-stage malware MumbaiDown."
        reports = "CSA-200279"
        version = "202106081524"
        last_modified = "2021-06-08"
        actor = "MYTHIC LEOPARD"
        malware_family = "MumbaiDown"
    strings:
        $mutex_1 = "{7HuxuyKW2Zv6R4aaW3ktkrxzKVbskjPgRTEVhZHU}" wide ascii
        $mutex_2 = "{DWzAf4NeNkvVjcbPrh5Xbph7cR8RePRHng8day4A}" wide ascii
        $net_str_1 = "zb000p" wide ascii
        $net_str_2 = "xs00p" wide ascii
        $net_str_3 = "xb0001" wide ascii
        $net_str_4 = "xn00p" wide ascii
        $class_method_1 = "createdir"
        $class_method_2 = "RequestLoop"
        $class_method_3 = "SendString"
        $class_method_4 = "ConnectToServer"
        $class_method_5 = "portArray"
        $class_method_6 = "ReceiveResponse"
    condition:
        ((1 of ($mutex_*) and 2 of ($net_str_*)) or (all of ($class_method_*))) and uint16(0) == 0x5a4d
}

// WARNING: This rule will only work with YARA 3
import "pe"

rule CrowdStrike_CSIT_20066_09 : primitive_bear usb_grabber 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects DLLs with exports combinations as seen in UsbGrabber samples"
        reports = "CSIT-20066"
        version = "202006100932"
        last_modified = "2020-06-10"
        actor = "PRIMITIVE BEAR"
        malware_family = "UsbGrabber"
    condition:
        pe.characteristics & pe.DLL and
        pe.number_of_exports > 9 and
        pe.exports("go0") and
        pe.exports("go1") and
        pe.exports("go2") and
        pe.exports("go3") and
        pe.exports("go4") and
        pe.exports("go5") and
        pe.exports("go6") and
        pe.exports("go7") and
        pe.exports("go8") and
        pe.exports("go9")
}

rule CrowdStrike_CSA_200273_01 : helix_kitten maildrop rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects HELIX KITTEN MailDrop through strings used in the C2 protocol"
        reports = "CSA-200273,CSIT-20156"
        version = "202008171431"
        last_modified = "2020-08-17"
        actor = "HELIX KITTEN"
        malware_family = "MailDrop"
    strings:
        $ = "Microsoft Office/15.0 (Windows NT {0}; Microsoft Outlook 15.0.4675; Pro)" ascii wide
        $ = "resume.txt" ascii wide
        $ = "Resume" ascii wide
        $ = "This is our reusme!" ascii wide
        $ = "home/" wide
        $ = "; WOW64; Trident/7.0; rv:11.0) like Gecko" wide
        $ = "image.jpg" wide
        $ = "EWS.Resource1" wide
    condition:
        uint16(0) == 0x5A4D and
        uint32(uint32(0x3C)) == 0x00004550 and
        6 of them
}

rule CrowdStrike_CSIT_20037_02 : labyrinth_chollima loader undergroundrat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects artefacts found in trojanized software containing functionality to load UnderGround RAT"
        reports = "CSIT-20037"
        version = "202004142022"
        last_modified = "2020-04-14"
        actor = "LABYRINTH CHOLLIMA"
        malware_family = "UnderGroundRAT"
    strings:
        $xor = {0F B6 48 FF 30 08 48 8D 40 FF 49 83 EA 01 75 F0}
        $mod = {B8 F3 1A CA 6B}
        $param = {2D 00 73 00}
    condition:
        all of them
}

rule CrowdStrike_XORDDoS_Strings : bot ddos xorddos 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects strings present in XOR DDoS malware samples."
        version = "202102231142"
        last_modified = "2021-02-23"
        malware_family = "XOR DDoS"
    strings:
        $key1 = "BB2FA36AAA9541F0"
        $key2 = "CB2FA36AAA9541F0"
        $key3 = "BE2FA46ABA9541F2"
        $format_dnsparse = "nameserver %15[0-9.]" fullword
        $format_tcpparse = "%d: %64[0-9A-Fa-f]:%X %64[0-9A-Fa-f]:%X %X %lX:%lX %X:%lX %lX %d %d %ld %512s" fullword
        $partial_key = "2FA36AAA9541F"
        $service = "#!/bin/sh\x0a# chkconfig: 12345 90 90\x0a# description: %s\x0a### BEGIN INIT INFO\x0a# Provides:\x09\x09%s\x0a# Required-Start:\x09\x0a# Required-Stop:\x09\x0a# Default-Start:\x091 2 3 4 5\x0a# Default-Stop:\x09\x09\x0a# Short-Description:\x09%s\x0a### END INIT INFO\x0acase $1 in\x0astart)\x0a\x09%s\x0a\x09;;\x0astop)\x0a\x09;;\x0a*)\x0a\x09%s\x0a\x09;;\x0aesac\x0a\x00"
    condition:
        $service or any of ($key*) or all of ($format*) or (any of ($format*) and $partial_key)
}

rule CrowdStrike_XORDDoS_Symbols : bot ddos xorddos 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects the names of function symbols observed in XOR DDoS malware."
        version = "202102231138"
        last_modified = "2021-02-23"
        malware_family = "XOR DDoS"
    strings:
        $ = "send_process_md5"
        $ = "read_kill_cfg"
        $ = "rand_filename"
        $ = "kill_pid_md5"
        $ = "kill_pid_filename"
        $ = "kill_denyip"
        $ = "http_download_mem"
        $ = "get_self"
        $ = "get_file_form_pid"
        $ = "exec_packet"
        $ = "exec_kill_cfg"
        $ = "encrypt_code"
        $ = "decrypt_remotestr"
        $ = "dec_conf"
        $ = "daemon_get_kill_process"
        $ = "abstract_save_name"
        $ = "abstract_file_name"
        $ = "LinuxExec_Argv2"
        $ = "LinuxExec_Argv"
        $ = "LinuxExec"
        $ = "HidePidPort"
        $ = "HideFile"
        $ = "DelService_form_pid"
        $ = "CheckLKM"
        $ = "CalcFindIpCrc"
        $ = "AddService"
    condition:
        10 of them
}

rule CrowdStrike_CSIT_20048_01 : ecrime makop ransomware unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects distinctive strings and bytes found in Makop ransomware"
        reports = "CSIT-20048"
        version = "202003201523"
        last_modified = "2020-03-20"
        malware_family = "Makop"
    strings:
        $strui1 = "%s%s\\*.*" wide fullword
        $strui2 = "Stop?" wide fullword
        $strui3 = "Start folder" wide fullword
        $strui5 = "MS Shell Dlg" wide fullword
        $strui6 = "Hide" wide fullword
        $str1 = ".ndata" fullword
        $str2 = "WNetEnumResourceW" fullword
        $oledstr1 = "Error preparing session key(s)!" fullword
        $oledstr2 = "YOUR_FILES_ARE_ENCRYPTED" fullword
        $oledstr3 = "readme-warning.txt" fullword
        $oledstr4 = "encoded: %I64d %s, files count: %u, time %I64d seconds"
        $oledstr5 = "Error preparing public key!" fullword
        $asm_aes_key_header = { 66 c7 44 24 ?? 08 02 66 c7 44 24 ?? 10 66 c6 44 24 ?? 20 }
        $asm_aes_key_header_memset = { 68 80 00 00 00 6a 00 5? e8 [4] [3-12] 68 80 00 00 00 6a 00 5? e8 }
        $asm_filesize_div3 = { 6a 03 5? 5? 89 74 24 ?? 89 74 24 ?? 89 74 24 ?? 89 74 24 ?? e8 }
        $asm_arg_e = { 66 [1-2] (65 | 65 00) 0f 94 c0 5? 5? c3 }
    condition:
        uint16(0) == 0x5a4d and
        (3 of ($asm*) or
        all of ($str*) or
        4 of ($oledstr*))
}

rule CrowdStrike_CSIT_20038_01 : fancy_bear trsloader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects a decryption xor key for the embedded self-wiping batch file"
        reports = "CSIT-20038"
        version = "202003131435"
        last_modified = "2020-03-13"
        actor = "FANCY BEAR"
        malware_family = "TrsLoader"
    strings:
        $key = {07 79 F7 A5 9C 73 BB D4}
    condition:
        any of them
}

rule CrowdStrike_CSA_201268_01 : circuit_panda elf fakedead 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects an instance of FakeDead - Linux version"
        reports = "CSA-201268"
        version = "202104061314"
        last_modified = "2021-04-06"
        actor = "CIRCUIT PANDA"
        malware_family = "FakeDead - Linux Variant"
        
    strings:
        $compare_command_id_7200AC07 = { 8B 40 0C 3D 07 AC 00 72 }
        $compare_command_switch = { 8B 40 0C 2D 03 AC 00 72 }
        $command_id_7263BC06 = { 06 BC 63 72 }
        $ror_13_block_32bit = { 8B 45 FC 89 C2 C1 CA 0D 8B 45 08 0F B6 00 0F B6 C0 8D 04 02 89 45 FC 83 45 08 01 }
        $ror_13_block_64bit = { 8B 45 FC 89 C2 C1 CA 0D 48 8B 45 E8 0F B6 00 0F B6 C0 8D 04 02 89 45 FC 48 83 45 E8 01 }
        $rc4_byte_seq_ver_1_32bit = { 8D 04 02 25 FF 00 00 00 0F B6 84 05 F4 FE FF FF 31 C8 88 03 }
        $rc4_byte_seq_ver_2_32bit = { 8D 14 13 81 E2 FF 00 00 00 0F B6 94 15 F0 FE FF FF 31 CA 88 10 }
        $rc4_byte_seq_ver_1_64bit = { 8D 14 13 81 E2 FF 00 00 00 48 63 D2 0F B6 94 15 E0 FE FF FF 31 CA 88 10 }
        $config_params_ver_1_32bit = { 05 [1] 04 00 00 C7 44 24 08 78 0B 00 00 }
        $config_params_ver_2_32bit = { 05 [1] 04 00 00 89 C1 B8 78 0B 00 00 }
        $config_params_ver_1_64bit = { 48 05 [1] 04 00 00 BA 78 0B 00 00 }
    condition:
        3 of them and uint32(0) == 0x464C457F
}

rule CrowdStrike_CSIT_20126_01 : macro phishing primitive_bear vba 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects an obfuscated form of VBA macro used by PRIMITIVE BEAR"
        reports = "CSIT-20126"
        version = "202007240808"
        last_modified = "2020-07-24"
        actor = "PRIMITIVE BEAR"
    strings:
        $beginsub = /(Public|Private) Sub/ ascii wide
        $endsub = "End Sub" ascii wide
        $pattern = /\.Write\s+"[a-z0-9]{11}\s*=\s*[a-z0-9]{11}\s*\+\s*\([a-z0-9]{11}\s*\(\s*""[0-9:]{32,}""\s*\)\s*\)/ nocase ascii wide
        $vbcrlf = "vbCrLf" wide ascii
    condition:
        any of them and
        filesize < 200KB and
        #pattern > 10 and
        #vbcrlf > 10
}

rule CrowdStrike_CSIT_20032_01 : ecrime graceful_spider minebridge rat unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects strings and opcodes present in MINEBRIDGE"
        reports = "CSIT-20032"
        version = "202102191059"
        last_modified = "2021-02-19"
        actor = "GRACEFUL SPIDER"
        malware_family = "MINEBRIDGE"
    strings:
        // server command names
        $cmd_name1 = "drun_command"
        $cmd_name2 = "drun_URL"
        $cmd_name3 = "rundll_command"
        $cmd_name4 = "rundll_URL"
        $cmd_name5 = "update_command"
        $cmd_name6 = "update_URL"
        $cmd_name7 = "restart_command"
        $cmd_name8 = "terminate_command"
        $cmd_name9 = "kill_command"
        $cmd_name10 = "poweroff_command"
        $cmd_name11 = "reboot_command"
        $cmd_name12 = "setinterval_command"
        $cmd_name13 = "setinterval_time"
        // client response
        $cmd_response1 = "uuid=%s&drun_status="
        $cmd_response2 = "uuid=%s&kill_status="
        $cmd_response3 = "uuid=%s&poweroff_status="
        $cmd_response4 = "uuid=%s&reboot_status="
        $cmd_response5 = "uuid=%s&restart_status="
        $cmd_response6 = "uuid=%s&rundll_status="
        $cmd_response7 = "uuid=%s&setinterval_status="
        $cmd_response8 = "uuid=%s&terminate_status="
        $cmd_response9 = "uuid=%s&update_status="
        $cmd_response10 = "uuid=%s&id=%s&pass=%s&username=%s&pcname=%s&osver=%s&timeout=%d"
        $bot_ID_gen_code1 = { 81 c6 f7 52 13 00 69 c6 00 24 00 00 69 d6 a0 77 00 00 }
        $bot_ID_gen_code2 = { 0f b7 c8 69 c6 00 80 92 26 05 57 ba c7 01 }
    condition:
        filesize < 800KB and
        uint16(0) == 0x5a4d and (
        (3 of ($cmd_name*)) or
        (any of ($cmd_response*)) or
        (any of ($bot_ID_gen_code*))
        )
}

rule CrowdStrike_CSIT_20044_02 : cobalt_spider crimeware ecrime rat spectre_sekur 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects the hashing algorithm used in the Spectre Sekur bot."
        reports = "CSIT-20044"
        version = "202005011724"
        last_modified = "2020-05-01"
        actor = "COBALT SPIDER"
        malware_family = "SpectreSekur"
    strings:
        $hash_func = { 0f b6 07 0f af ce 69 f6 b7 c6 05 00 03 c8 47 4a 75 ee }
    condition:
        all of them
}

rule CrowdStrike_CSIT_20044_01 : cobalt_spider crimeware ecrime rat spectre_sekur 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects decoding algorithm used by Spectre Sekur bot"
        reports = "CSIT-20044"
        version = "202005011724"
        last_modified = "2020-05-01"
        actor = "COBALT SPIDER"
        malware_family = "SpectreSekur"
    strings:
        $decode_table_op = { 33 f1 2b f1 79 06 81 c6 00 01 00 00 8b 5d 0c 8b c6 c1 e0 08 03 c1 89 03 }
        $decode_table_op_2 = { 33 c6 2b c6 79 05 05 00 01 00 00 88 04 11 41 }
    condition:
        all of them
}

rule CrowdStrike_CSIT_20103_01 : attachloader wicked_panda 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects distinctive 2-byte marker for payload data along with MS Crypt API functions"
        reports = "CSIT-20103"
        version = "202006100952"
        last_modified = "2020-06-10"
        actor = "WICKED PANDA"
        malware_family = "AttachLoader"
    strings:
        // Check data magic
        $check64 = { 80 3? 50 0f 85 ?? 00 00 00 80 7? 01 4c }
        $check32 = { 80 3? 50 75 ?? 80 7? 01 4c }
        // Need crypt API...
        $crypt1 = "CryptAcquireContext"
        $crypt2 = "Microsoft Enhanced RSA and AES Cryptographic Provider" ascii wide
        $crypt3 = "CryptCreateHash"
        $crypt4 = "CryptDeriveKey"
        $crypt5 = "CryptDestroyKey"
        // ...or BCrypt API...
        $bcrypt1 = "BCryptDecrypt"
        $bcrypt2 = "BCryptGenerateSymmetricKey"
        $bcrypt3 = "BCryptOpenAlgorithmProvider"
        $bcrypt4 = "BCryptCloseAlgorithmProvider"
        // ...or ChaCha magic numbers
        $chacha1 = { 65 78 70 61 }
        $chacha2 = { 6e 64 20 33 }
        $chacha3 = { 32 2d 62 79 }
        $chacha4 = { 74 65 20 6b }
    condition:
        uint16(0) == 0x5a4d and
        filesize < 4MB and
        (all of ($crypt*) or all of ($bcrypt*) or all of ($chacha*)) and
        ($check64 or $check32)
}

rule CrowdStrike_CSIT_20044_03 : cobalt_spider crimeware ecrime loader spectre_sekur spectresekur 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects the Spectre Sekur Loader"
        reports = "CSIT-20044,CSIT-21070"
        version = "202103311248"
        last_modified = "2021-03-31"
        actor = "COBALT SPIDER"
        malware_family = "SpectreSekur"
    strings:
        $str_dec = { 25 93 36 ea a9 81 e1 eb e1 f0 42 }
        $stack_str = { c7 45 f0 47 65 74 50 }
    condition:
        all of them
}

rule CrowdStrike_CSIT_20120_01 : dropper mosquito venomous_bear 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects a custom file time manipulation function from VENOMOUS BEAR Mosquito installer"
        reports = "CSIT-20120"
        version = "202101291829"
        last_modified = "2021-01-29"
        actor = "VENOMOUS BEAR"
        malware_family = "Mosquito"
    strings:
        $sub_414F31  = { 66 01 45 ec 58 66 89 45 }
    condition:
        $sub_414F31
}

rule CrowdStrike_CSIT_20050_02 : backdoor backdoor_dll ocean_buffalo pagoda 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects final stage of Pagoda backdoor"
        reports = "CSIT-20050"
        version = "202004082059"
        last_modified = "2020-04-08"
        actor = "OCEAN BUFFALO"
        malware_family = "Pagoda"
    strings:
        $str1 = "winhttp.dll" nocase
        $str2 = "CreateInstance"
        $str3 = "httpprov.dll" nocase
        $uri_encoding_loop = { 0f 8e 30 01 00 00 8d 45 ec 6a 10 50 e8 82 03 00 00 0f b6 45 ec 8b 7d e4 59 83 c0 b0 59 0f b6 4d ed 83 f850 0f 87 20 01 00 00 8b c1 33 d2 6a 05 59 f7 f1 c6 45 eb 01 8a 92 68 ?? ?? ?? 8d 42 9f 3c 19 77 03 80 c2 e0 88 14 33 46 8b c7 2b c6 85 c0 0f 8e df 00 00 00 0f b6 45 ed 33 d2 6a 15 59 f7 f1 80 7d eb 00 8a 92 50 ?? ?? ?? 75 0a 8d 42 9f 3c 19 77 03 80 c2 e0 88 14 33 46 8b c7 2b c6 85 c0 0f 8e ae 00 00 00 0f b6 45 ee 80 fa 68 74 19 83 c0 b0 83 f8 50 77 11 c6 04 33 68 46 8b c7 2b c6 85 c0 0f 8e 8c 00 00 00 0f b6 45 f0 33 d2 6a 05 59 f7 f1 8a 82 68 ?? ?? ?? 88 04 33 46 8b c7 2b c6 85 c0 7e 6f 80 7d f1 60 77 1a 0f b6 45 f2 33 d2 f7 f1 8a 82 68 ?? ?? ?? 88 04 33 46 8b c7 2b c6 85 c0 7e 4f 0f b6 45 f3 33 d2 6a 15 59 f7 f1 8a 82 50 ?? ?? ?? 88 04 33 46 8b c7 2b c6 85 c0 7e 32 80 7d f4 50 77 1d 0f b6 45 f5 33 d2 6a 05 59 f7 f1 8a 82 68 ?? ?? ?? 88 04 33 46 8b c7 2b c6 85 c0 7e 0f c6 04 33 2d 46 2b fe 85 ff 0f 8f d0 fe ff ff }
    condition:
        uint16(0) == 0x5a4d and
        all of them
}

rule CrowdStrike_CSIT_20050_01 : dropper ocean_buffalo pagoda rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects first stage dropper of Pagoda RAT"
        reports = "CSIT-20050"
        version = "202006101721"
        last_modified = "2020-06-10"
        actor = "OCEAN BUFFALO"
        malware_family = "Pagoda"
    strings:
        $str1 = ".exe" wide
        $str2 = "WUSER32.DLL" wide nocase
        $str3 = "SHELL32.dll" nocase
        $str4 = "open" wide nocase
        $str5 = "OriginalFilename" wide
        $str6 = "NoRemove" wide
        $str7 = "LoadResource"
        $str8 = "FindResource"
        $str9 = "ShellExecuteW"
        $xor_decoding_loop = { 8b 55 0c b8 10 00 00 00 39 45 20 73 03 8d 55 0c 89 55 d0 8b 55 d4 39 45 e8 73 03 8d 55 d4 89 55 cc 39 46 14 72 04 8b 3e eb 02 8b fe 33 d2 8b c1 f7 75 c4 8b 45 cc 8b 5d d0 8a 04 02 32 04 0b 88 04 0f 8b 7d d4 b8 10 00 00 00 39 45 e8 73 03 8d 7d d4 39 46 14 72 04 8b 06 eb 02 8b c6 8a 04 08 30 04 3a 41 3b 4d c8 72 97
        }
    condition:
        uint16(0) == 0x5a4d and
        all of them
}

rule CrowdStrike_CSA_200428_01 : panda quandry rat targeted 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule matches against QuandryRAT, likely in use by China-nexus adversaries."
        reports = "CSA-200428"
        version = "202004031238"
        last_modified = "2020-04-03"
        malware_family = "QuandryRAT"
    strings:
        // SSL hardcoded bytes
        $ssl_header_a           = { 16 03 00 00 41 01 00 00 3D 03 00 51 D5 2C 6A 4B 2F E2 9D 75 68 7E 21 A3 57 0E FF 92 5B 7E 19 4F }
        $ssl_header_b           = { 16 03 00 01 04 10 00 01 00 44 15 B3 76 32 9F 46 4F 39 99 3B 84 AD 2D 5C BD DA E2 2B 3E B3 19 04 }
        // Code filling random buffer for handshake
        /* Code from starting VA 00403cf1:
        lea     ecx, [ebp+var_4]
        shr     ecx, 4
        xor     eax, ecx
        mov     edx, [ebp+var_8]
        add     edx, [ebp+var_4]
        mov     cl, [edx+4]
        xor     cl, al
        mov     edx, [ebp+var_8]
        add     edx, [ebp+var_4]
        mov     [edx+4], cl
        */
        $code_va_00403CF1 = { 8D 4D FC C1 E9 04 33 C1 8B 55 F8 03 55 FC 8A 4A 04 32 C8 8B 55 F8 03 55 FC 88 4A 04 }
    condition:
        any of them
}

rule CrowdStrike_CSIT_20055_01 : dotnet netflash venomous_bear 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects strings used in VENOMOUS BEAR's NetFlash malware."
        reports = "CSIT-20055"
        version = "202003270602"
        last_modified = "2020-03-27"
        actor = "VENOMOUS BEAR"
        malware_family = "NetFlash"
    strings:
        $t = "8c435b5b-ff03-4729-becb-bb40139a1b3b" ascii
        $key = "schtasks /CREATE /TN \"\\System\\drivers\\BIOS\" /ST 00:00 /SC MINUTE /MO 10 /F /TR \"{0}\"" wide
    condition:
        all of them
}

rule CrowdStrike_CSIT_20066_06 : primitive_bear usb_grabber 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects PDB paths from UsbGrabber and UsbGrabberStager"
        reports = "CSIT-20066"
        version = "202006100939"
        last_modified = "2020-06-10"
        actor = "PRIMITIVE BEAR"
        malware_family = "UsbGrabber"
    strings:
        $path1 = /:\\.{0,64}\\USBgrabber\\(x64\\)?(Debug|Release)\\Stager.pdb/ nocase ascii
        $path2 = /:\\.{0,64}\\Harvester\\(x64\\)?(Debug|Release)\\Harvester.pdb/ nocase ascii
    condition:
        any of them
}

rule CrowdStrike_CSIT_20066_05 : primitive_bear usb_grabber 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects a pattern found in UsbGrabber PE samples resources"
        reports = "CSIT-20066"
        version = "202006100934"
        last_modified = "2020-06-10"
        actor = "PRIMITIVE BEAR"
        malware_family = "UsbGrabber"
    strings:
        $pe_pattern = { 00 00 00 00 00 00 00 00 00 00 00 00 00 00 0a 00 55 00 53 00 42 00 67 00 72 00 61 00 62 00 62 00 65 00 72 00 00 00 00 00 00 00 00 00 00 00 0a 00 55 00 53 00 42 00 47 00 52 00 41 00 42 00 42 00 45 00 52 00 00 00 00 00 }
    condition:
        $pe_pattern
}

rule CrowdStrike_CSIT_20055_02 : pyflash python venomous_bear 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects unique strings associated with the Python script of PyFlash."
        reports = "CSIT-20055"
        version = "202003270602"
        last_modified = "2020-03-27"
        actor = "VENOMOUS BEAR"
        malware_family = "PyFlash"
    strings:
        $pymain = "if __name__ == '__main__':"
        $str_key = "key_for_me = '"
        $str_dying = "\\nI'm dying :(\\nTell my wife that i love her...\\n"
        $str_sheduler = "'Sheduler error: "
    condition:
        $pymain and
        any of ($str_*)
}

rule CrowdStrike_CSIT_20077_01 : downloader ecrime guloader unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects the core shellcode of GuLoader"
        reports = "CSIT-20077"
        version = "202008111609"
        last_modified = "2020-08-11"
        malware_family = "GuLoader"
    strings:
        $str1 = "wininet.dll" fullword
        $str2 = "Software\\Microsoft\\Windows\\CurrentVersion\\RunOnce" fullword
        $str3 = "\\system32\\" wide fullword
        $str4 = "Mozilla/5.0 (Windows NT 6.1; WOW64; Trident/7.0; rv:11.0) like Gecko" fullword
        $str5 = "Startup key" fullword
        $str6 = "C:\\Program Files\\qga\\qga.exe" fullword
        $str7 = "C:\\Program Files\\Qemu-ga\\qemu-ga.exe" fullword
        $asm_winapi = { 3? 39 05 00 00 [2-60] 68 fb f0 bf 5f }
        $asm_winapi2 = { 3? 39 05 00 00 [2-60] 68 55 95 db 6d }
        $asm_antibp = { 8a 18 80 fb cc (74 | 0f) }
        $asm_antibp2 = { 66 81 f? cd 03 (74 | 0f) }
        $asm_antibp3 = { 66 81 f? 0f 0b (74 | 0f) }
    condition:
        4 of ($str*) and
        2 of ($asm*)
}

rule CrowdStrike_CSIT_20062_04 : forelord implant static_kitten 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects x86 constants used to get a random value and perform a modulo division of 2. Result is used to select the C2 domain from config data"
        reports = "CSIT-20062"
        version = "202106171603"
        last_modified = "2021-06-17"
        actor = "STATIC KITTEN"
        malware_family = "ForeLord"
        /*
        mov     ecx, [ebp+arg_4]
        mov     eax, 2AAAAAABh
        sub     ecx, [ebp+arg_0]
        add     esp, 8
        imul    ecx
        sar     edx, 2
        mov     esi, edx
        shr     esi, 1Fh
        add     esi, edx
        call    _rand
        xor     edx, edx
        div     esi
        */
    strings:
        $hex_string = { 8b ?? ?? b8 ab aa aa 2a 2b ?? ?? 83 c4 08 f7 e9 c1 fa 02 8b f2 c1 ee 1f 03 f2 e8 ?? ?? ?? ?? 33 d2 f7 f6}
    condition:
        uint16(0) == 0x5a4d and $hex_string
}

rule CrowdStrike_CSA_200423_04 : rat targeted 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Strings within AvantGarde's DCOM extension capable of creating an interactive shell and executing shellcode"
        reports = "CSA-200423,CSIT-20101"
        version = "202006020715"
        last_modified = "2020-06-02"
        malware_family = "AvantGarde"
    strings:
        $ = "nanomsg.org"
        $ = "InprocServer32"
        $ = "DeviceManager"
        $ = "%d ->SPAWN(%p,%d)" wide
    condition:
        all of them
}

rule CrowdStrike_CSA_200423_02 : rat targeted 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Strings within in the Windows Version of AvantGarde's Utilities.dll"
        reports = "CSA-200423,CSIT-20101"
        version = "202006020715"
        last_modified = "2020-06-02"
        malware_family = "AvantGarde"
    strings:
        $ = "spawned SC of"
        $ = "CreateDirectory()"
        $ = "initialized realtime module."
    condition:
        all of them
}

rule CrowdStrike_CSA_200423_01 : rat targeted 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Strings within AvantGarde's unpacker COM server - decompresses and executes a zlib compressed payload"
        reports = "CSA-200423,CSIT-20101"
        version = "202006020716"
        last_modified = "2020-06-02"
        malware_family = "AvantGarde"
    strings:
        $ = "Worker stage file not opened" wide
        $ = "Worker uncompress()" wide
        $ = "Worker FinalConstruct() initializing" wide
        $ = "DcomServerLib"
        $ = "ThreadingModel"
    condition:
        all of them
}

rule CrowdStrike_CSA_200423_03 : rat targeted 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Strings within in the Windows and Linux versions of AvantGarde's RAT"
        reports = "CSA-200423,CSIT-20101"
        version = "202006020715"
        last_modified = "2020-06-02"
        malware_family = "AvantGarde"
    strings:
        $ = "command currently not available"
        $ = "successfully uploaded."
        $ = "interval of http_poll"
        $ = "AAAAAA"
        $ = "cwd"
    condition:
        all of them
}

rule CrowdStrike_AsyncRat_Strings_01 : asyncrat rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects the open source .NET RAT AsyncRAT."
        version = "202004031157"
        last_modified = "2020-04-03"
        malware_family = "AsyncRAT"
    strings:
        $must_dotnet_1 = "BSJB"
        $must_dotnet_2 = "#Strings"
        $must_api_1 = "System.Security.Cryptography.X509Certificates" fullword
        $must_api_2 = "AesCryptoServiceProvider" fullword
        $must_api_3 = "MD5CryptoServiceProvider" fullword
        $config_value_0 = "Key" fullword
        $config_value_1 = "MTX" fullword
        $config_value_2 = "Serversignature" fullword
        $config_value_3 = "ServerCertificate" fullword
        $config_value_4 = "Anti" fullword
        $config_value_5 = "aes256" fullword
        $config_value_6 = "Pastebin" fullword
        $config_value_7 = "BDOS" fullword
        $config_value_8 = "Hwid" fullword
        $namespace_1 = "Client.Algorithm" fullword
        $namespace_2 = "Client.Connection" fullword
        $namespace_3 = "Client.Cryptography" fullword
        $namespace_4 = "Client.Handle_Packet" fullword
        $namespace_5 = "Client.Helper" fullword
        $namespace_6 = "Client.Install" fullword
        $namespace_7 = "Client.MessagePack" fullword
        $namespace_8 = "Client.Properties" fullword
        $namespace_9 = "Client.Sockets" fullword
        $namespace_A = "Client.StreamLibrary" fullword
        $insn_key = {
        28 [3] 0A 7E [3] 04 28 [3] 0A 6F [3] 0A 80 [3] 04
        7E [3] 04 73 [3] 06 80 [3] 04 7E [3] 04
        }
        $insn_pastebin = {
        72 [4-10]
        72 [4-10]
        73 [3] 0A
        13 0?
        11 0?
        11 0?
        6F [3] 0A
        11 0?
        7E [3] 04
        6F [3] 0A
        17
        8D [4]
        25
        16
        72 [3] 70
        }
        $insn_c2 = {
        7E [3] 04 [0-4] 8D [4] 25 [0-4] 1F 2C [8-20]
        7E [3] 04 [0-4] 8D [4] 25 [0-4] 1F 2C [8-20]
        7E [3] 04 [0-4] 8D [4] 25 [0-4] 1F 2C [8-20]
        7E [3] 04 [0-4] 8D [4] 25 [0-4] 1F 2C
        }
    condition:
        all of ($must*) and (5 of ($conf*) or 6 of ($namespace*) or ($insn_key and ($insn_pastebin or $insn_c2)))
}

rule CrowdStrike_Mystery_Stealer : ecrime mystery stealer unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects strings in unpacked samples of Mystery Stealer"
        version = "202004031155"
        last_modified = "2020-04-03"
        malware_family = "Mystery Stealer"
    strings:
        $ = "MysteryPanel" wide
        $ = "GrabBrowserCredentials" wide
        $ = "GrabColdWallets" wide
        $ = "GrabRdp" wide
        $ = "GrabFtp" wide
        $ = "GrabDesktopFiles" wide
        $ = "GrabTelegram" wide
        $ = "GrabDiscord" wide
    condition:
        6 of them
}

rule CrowdStrike_CSIT_20050_03 : backdoor metaljack ocean_buffalo pagoda rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects OCEANBUFFALO backdoor "
        reports = "CSIT-20050"
        version = "202006101728"
        last_modified = "2020-06-10"
        actor = "OCEAN BUFFALO"
        malware_family = "Pagoda"
    strings:
        $str1 = "FindResourceW"
        $str2 = "CreateInstance"
        $str3 = "LoadResource"
        $str4 = "WUSER32.DLL" wide nocase
        $str5 = "{A96B020F-0000-466F-A96D-A91BBF8EAC96}.dll"
        $str6 = "SerialNumber" wide
        $str7 = "NoRemove" wide
        $str8 = {00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 07 00 00 00 00 00 00 00 00 00 00 00 01 01 01 00 10 27 00 00}
    condition:
        uint16(0) == 0x5a4d and all of them
}

rule CrowdStrike_CSIT_20066_04 : primitive_bear usb_grabber 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects a x86/x64 platform detection shellcode uniquely found in UsbGrabber samples"
        reports = "CSIT-20066"
        version = "202006100935"
        last_modified = "2020-06-10"
        actor = "PRIMITIVE BEAR"
        malware_family = "UsbGrabber"
    strings:
        $p = { 55 8b ec 83 ec 08 c7 45 f8 00 00 00 00 c7 45 fc 02 00 00 00 eb 09 8b 45 fc 83 c0 01 89 45 fc 81 7d fc 2a 01 00 00 7d 0b 8b 4d f8 03 4d 08 89 4d f8 eb e3 8b 45 f8 8b e5 5d c3 }
    condition:
        any of them
}

rule CrowdStrike_CSIT_20065_01 : android mobzsar mythic_leopard rat unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects an instance of Mobzsar"
        reports = "CSIT-20065"
        version = "202006152029"
        last_modified = "2020-06-15"
        actor = "MYTHIC LEOPARD"
        malware_family = "Mobzsar"
    strings:
        $ = ">smsMoniter="
        $ = ">smsWhere="
        $ = ">callMoniter="
        $ = ">callWhere="
        $ = ">capPath="
        $ = ">setPath="
        $ = ">recPath="
        $ = ">simSerial="
        $ = ">deviceName="
        $ = ">health="
        $ = ">plugged="
        $ = ">present="
        $ = ">technology="
        $ = ">temperature="
        $ = ">voltage="
        $ = ">simOperatorCode="
        $ = ">iMemorySize="
        $ = ">eMemorySize="
        $ = ">aMemorySize="
        $ = ">isRealNotif="
        $ = ">enbScren="
        $ = ">mehiden="
    condition:
        uint16(0) == 0x6564 and
        5 of them
}

rule CrowdStrike_CSA_200433_01 : rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects a unique remote access tool described in CSA-200433"
        reports = "CSA-200433"
        version = "202010161023"
        last_modified = "2020-10-16"
    strings:
        $wolfssl_1 = "CLNTSRVRclient finished" ascii
        $zlib_1 = " deflate 1.2.11 Copyright 1995-2017 Jean-loup Gailly and Mark Adler " ascii
        $api_1 = "SetErrorMode"
        $api_2 = "PeekNamedPipe"
        $api_3 = "GetComputerNameW"
        $api_4 = "SHDeleteKeyW"
        $zlib_header = { 78 9c }
    condition:
        uint16(0) == 0x5a4d and
        filesize < 500KB and
        all of them and
        #zlib_header > 2
}

rule CrowdStrike_CSIT_20086_01 : bokbot downloader ecrime lunar_spider unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects unpacked version of the BokBot core module downloader v2"
        reports = "CSIT-20086"
        version = "202006190727"
        last_modified = "2020-06-19"
        actor = "LUNAR SPIDER"
        malware_family = "BokBot"
    strings:
        $uri = "/image/?id=%0.2X%0.8X%0.8X%s"
        $idat1 = { 81 7c 2e 04 49 44 41 54 }
        $idat2 = { 81 e2 00 00 ff 00 8b c1 c1 e8 10 0b d0 8b c1 c1 e0 10 }
        $idat3 = { 81 e1 00 ff 00 00 0b c1 c1 ea 08 c1 e0 08 0b d0 }
    condition:
        uint16(0) == 0x5a4d and
        $uri and
        2 of ($idat*)
}

rule CrowdStrike_CSIT_20086_02 : bokbot downloader ecrime lunar_spider unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects unpacked version of the BokBot first stage downloader"
        reports = "CSIT-20086"
        version = "202006190727"
        last_modified = "2020-06-19"
        actor = "LUNAR SPIDER"
        malware_family = "BokBot"
    strings:
        $s1 = "Cookie: __gads=" wide
        $s2 = "ldr_dll.dll"
        $idat1 = { 81 7c 2e 04 49 44 41 54 }
        $idat2 = { 81 e2 00 00 ff 00 8b c1 c1 e8 10 0b d0 8b c1 c1 e0 10 }
        $idat3 = { 81 e1 00 ff 00 00 0b c1 c1 ea 08 c1 e0 08 0b d0 }
    condition:
        1 of ($s*) and
        2 of ($idat*)
}

rule CrowdStrike_CSIT_20128_01 : capriccio hunting lnk razor_tiger 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects LNK file used as downloader by RAZOR TIGER"
        reports = "CSIT-20128"
        version = "202009041501"
        last_modified = "2020-09-04"
        actor = "RAZOR TIGER"
        malware_family = "Capriccio"
        reports = "CSIT-20128"
    strings:
        $lnk_header = { 4c 00 00 00 01 14 02 00 00 00 }
        $ = "%windir%\\system32\\cftmo.exe"
        $ = "msHta.Exe" wide
    condition:
        $lnk_header at 0 and all of them
}

rule CrowdStrike_CSIT_20128_04 : capriccio hunting javascript razor_tiger 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects HTA files used by RAZOR TIGER to decode .NET DLLs"
        reports = "CSIT-20128"
        version = "202009041502"
        last_modified = "2020-09-04"
        actor = "RAZOR TIGER"
        malware_family = "Capriccio"
        reports = "CSIT-20128"
    strings:
        $header = "<script language=\"javascript\">"
        $str1 = "= String.fromCharCode;"
        $str2 = "(bytes.charCodeAt(i)) ^ key.charCodeAt(j)"
        $str3 = "var keeee ="
        $str4 = "shells.Environment"
        $str5 = "var ba = enc"
    condition:
        $header at 0 and all of them
}

rule CrowdStrike_CSIT_20128_05 : capriccio rat razor_tiger 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects DUSER.DLL used in Capriccio RAT"
        reports = "CSIT-20128"
        version = "202009041503"
        last_modified = "2020-09-04"
        actor = "RAZOR TIGER"
        malware_family = "Capriccio"
        reports = "CSIT-20128"
    strings:
        $ = "FileRipper" fullword
        $ = "InitGadgets" fullword
        $ = "pluginAssembly" fullword
        $ = "UHJvZ3JhbQ==" wide fullword
        $ = "U3RhcnQ=" wide fullword
    condition:
        uint16(0) == 0x5a4d and all of them
}

rule CrowdStrike_CSIT_20057_01 : emotet geodo mummy_spider plugin spreader worm 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects the Emotet Wi-Fi Spreader Module"
        reports = "CSIT-20057"
        version = "202102191057"
        last_modified = "2021-02-19"
        actor = "MUMMY SPIDER"
        malware_family = "Emotet"
    strings:
        $note1 = "NOTE : Current connecting" ascii
        $note2 = "NOTE : WLAN_AVAILABLE_NETWORK_HAS_PROFILE" ascii
        $note3 = "NOTE : WLAN_AVAILABLE_NETWORK_CONSOLE_USER_PROFILE" ascii
        $encryption_test = { 2b c3 59 74 30 48 74 26 48 74 1c 48 48 74 11 48 74 07 }
        // v2 log strings
        $log1 = "worm started"
        $log2 = "bruting SSID:"
        $log3 = "no active WI-FI networks found"
        $log4 = "Password for ssid %s is bruted. Pass is %s"
        $log5 = "EnumerateFunc returned FALSE"
        $log6 = "WNetEnumResource failed with error"
        $log7 = "We succ connected to ipc share"
        $log8 = "We have bruted valid password for current username\\password:"
        $log9 = "We have bruted valid password for Administrator username:"
        $log10 = "Found valid username. Bruting password for username:"
        $log11 = "We have bruted valid password for current username!"
    condition:
        uint16(0) == 0x5a4d and
        ((2 of ($note*)) or $encryption_test or (3 of ($log*))) and
        filesize < 850KB
}

rule CrowdStrike_CSIT_20057_02 : emotet geodo mummy_spider plugin spreader worm 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects the Emotet Wi-Fi Spreader Module Dropper"
        reports = "CSIT-20057"
        version = "202102191057"
        last_modified = "2021-02-19"
        actor = "MUMMY SPIDER"
        malware_family = "Emotet"
    strings:
        $service_name = "WinDefService" wide fullword
        $encryption_test = { 2b c3 59 74 30 48 74 26 48 74 1c 48 48 74 11 48 74 07 }
        // v2 log strings
        $log1 = "remote service runned. Downloading payload..."
        $log2 = "error downloading payload"
        $log3 = "payload downloaded ok"
        $log4 = "payload started ok"
        $log5 = "payload starting error"
    condition:
        uint16(0) == 0x5a4d and
        ($encryption_test or $service_name or (3 of ($log*))) and
        filesize < 1500KB
}

rule CrowdStrike_Amadey_Screencap_Module : amadey ecrime infostealer screencap 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects strings within the Amadey Loader screen-capture module"
        version = "202004100812"
        last_modified = "2020-04-10"
        malware_family = "AmadeyScreencap"
    strings:
        $ = "octet-stream"
        $ = "MachineGuid"
        $ = "?scr=up"
        $ = "Uploador"
        $ = "scr.dll"
    condition:
        all of them
}

rule CrowdStrike_CSIT_20075_01 : buffetline labyrinth_chollima 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects the presence of markers and hostname used in LABYRINTH CHOLLIMA BUFFETLINE implant"
        reports = "CSIT-20075"
        version = "202004231434"
        last_modified = "2020-04-23"
        actor = "LABYRINTH CHOLLIMA"
        malware_family = "BUFFETLINE"
    strings:
        $marker1 = "fjiejffndxklfsdkfjsaadiepwn"
        $marker2 = "ofuierfsdkljffjoiejftyuir"
        $marker3 = "reykfgkodfgkfdskgdfogpdokgsdfpg"
        $marker4 = "ztretrtireotreotieroptkierert"
        $sni1 = "!Q@W#E$R%T^Y&U*I(O)P"
        $sni2 = "1234567890"
    condition:
        int32(0) == 0x905a4d and 2 of ($marker*) and 1 of ($sni*)
}

rule CrowdStrike_CSIT_20069_01 : hotcroissant rat silent_chollima 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects XOR decoding routine, encoded strings, and compression library string used in HOTCROISSANT RAT"
        reports = "CSIT-20069"
        version = "202004291319"
        last_modified = "2020-04-29"
        actor = "SILENT CHOLLIMA"
        malware_family = "HOTCROISSANT"
    strings:
        $xorString = { 80 3? 0f 4? 80 3? 00 8? ?? 75 f5 }
        $zipString = "unknown compression method"
        $victimInfoFormatString = "*|s*|s*|s*|s*|s*|s*|"
        $adminString = "Nkbfaf|{}n{`}"
    condition:
        uint16(0) == 0x5a4d and
        4 of them
}

rule CrowdStrike_CSA_200487_01 : forelord implant static_kitten 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects stack string used to invoke command shell in ForeLord implant"
        reports = "CSA-200487"
        version = "202106171600"
        last_modified = "2021-06-17"
        actor = "STATIC KITTEN"
        malware_family = "ForeLord"
        /*
        mov     dword ptr [ebp+ApplicationName], 3A0043h
        mov     [ebp+var_4C], 5C005Ch
        mov     [ebp+var_48], 690057h
        mov     [ebp+var_44], 64006Eh
        mov     [ebp+var_40], 77006Fh
        mov     [ebp+var_3C], 5C0073h
        mov     [ebp+var_38], 53005Ch
        mov     [ebp+var_34], 730079h
        mov     [ebp+var_30], 650074h
        mov     [ebp+var_2C], 33006Dh
        mov     [ebp+var_28], 5C0032h
        mov     [ebp+var_24], 63005Ch
        mov     [ebp+var_20], 64006Dh
        mov     [ebp+var_1C], 65002Eh
        mov     [ebp+var_18], 650078h
        mov     [ebp+var_14], 0
        */
    strings:
        $ = {
        c7 ?? ?? 43 00 3a 00
        c7 ?? ?? 5c 00 5c 00
        c7 ?? ?? 57 00 69 00
        c7 ?? ?? 6e 00 64 00
        c7 ?? ?? 6f 00 77 00
        c7 ?? ?? 73 00 5c 00
        c7 ?? ?? 5c 00 53 00
        c7 ?? ?? 79 00 73 00
        c7 ?? ?? 74 00 65 00
        c7 ?? ?? 6d 00 33 00
        c7 ?? ?? 32 00 5c 00
        c7 ?? ?? 5c 00 63 00
        c7 ?? ?? 6d 00 64 00
        c7 ?? ?? 2e 00 65 00
        c7 ?? ?? 78 00 65 00
        66 ?? ?? ?? 00 00
        }
    condition:
        uint16(0) == 0x5a4d and any of them
}

rule CrowdStrike_CSA_200496_01 : ragnarlocker ransomware 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects samples of Ragnar Locker ransomware"
        reports = "CSA-200496"
        version = "202004171510"
        last_modified = "2020-04-17"
        malware_family = "Ragnar Locker"
    strings:
        $ = { 0F B7 [2-6] 42 81 F1 3C FF 01 AB 03 F1 8B C6 C1 C0 0D 2B F0 3B D? 7? }
    condition:
        all of them
}

rule CrowdStrike_CSIT_20230_03 : carbon_spider domenus ecrime vbscript 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects CARBON SPIDER Domenus VBS dropper that installs the Harpy backdoor"
        reports = "CSIT-20230"
        version = "202101221700"
        last_modified = "2021-01-22"
        actor = "CARBON SPIDER"
        malware_family = "Domenus"
    strings:
        $vbs_obf = { 69 66 20 79 65 61 72 28 22 }
        $vbs_obf_2 = { 69 66 20 72 69 67 68 74 28 79 65 61 72 28 22 }
        $vbs_exec = "execute(replace("
        $vbs_set = "Set "
        $vbs_base64 = "bin.base64"
        $vbs_year = " = year("
    condition:
        ($vbs_obf or $vbs_obf_2 and $vbs_exec) or
        ($vbs_set at 0 and $vbs_base64 and $vbs_year) and
        filesize < 50KB
}

rule CrowdStrike_CSIT_20066_03 : primitive_bear usb_grabber 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects a shellcode equivalent for strlenA solely used by PrimitiveBear in UsbGrabber"
        reports = "CSIT-20066"
        version = "202006100936"
        last_modified = "2020-06-10"
        actor = "PRIMITIVE BEAR"
        malware_family = "UsbGrabber"
    strings:
        $s = { 55 8b ec 51 c7 45 fc 00 00 00 00 eb 09 8b 45 fc 83 c0 01 89 45 fc 81 7d fc 10 27 00 00 73 14 8b 4d 08 03 4d fc 0f be 11 85 d2 75 05 8b 45 fc eb 04 eb da 33 c0 8b e5 5d c3 }
    condition:
        all of them
}

rule CrowdStrike_CSIT_20066_02 : primitive_bear usb_grabber 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects ROR13 hashes of API functions used by UsbGrabber"
        reports = "CSIT-20066"
        version = "202006100937"
        last_modified = "2020-06-10"
        actor = "PRIMITIVE BEAR"
        malware_family = "UsbGrabber"
    strings:
        $kernel32dll_001 = { 0b 7f d9 ff }
        $kernel32dll_002 = { 5e 89 ec 99 }
        $kernel32dll_003 = { 74 89 ec 99 }
        $kernel32dll_004 = { a5 17 00 7c }
        $kernel32dll_005 = { 29 12 c6 56 }
        $kernel32dll_006 = { bb 17 00 7c }
        $kernel32dll_007 = { 45 a0 e4 4e }
        $kernel32dll_008 = { 72 fe b3 16 }
        $kernel32dll_009 = { 6b d0 2b ca }
        $kernel32dll_010 = { 25 b0 ff c2 }
        $kernel32dll_011 = { 3b b0 ff c2 }
        $kernel32dll_012 = { 7d 4a e1 a8 }
        $kernel32dll_013 = { 0f cb 10 38 }
        $kernel32dll_014 = { 78 59 54 23 }
        $kernel32dll_015 = { 65 c0 d6 63 }
        $kernel32dll_016 = { 7b c0 d6 63 }
        $kernel32dll_017 = { 97 ac e1 a5 }
        $kernel32dll_018 = { ad ac e1 a5 }
        $kernel32dll_019 = { 8f 22 a4 96 }
        $kernel32dll_020 = { ba 53 2a f7 }
        $kernel32dll_021 = { d0 53 2a f7 }
        $kernel32dll_022 = { 00 10 22 cb }
        $kernel32dll_023 = { 00 26 22 cb }
        $kernel32dll_024 = { 37 8e d1 e9 }
        $kernel32dll_025 = { ad 9b 7d df }
        $kernel32dll_026 = { ad 9b 15 e1 }
        $kernel32dll_027 = { 66 19 da 75 }
        $kernel32dll_028 = { cf 88 8c b9 }
        $kernel32dll_029 = { 19 2b c2 14 }
        $kernel32dll_030 = { 76 6d b0 45 }
        $kernel32dll_031 = { e1 43 c4 f1 }
        $kernel32dll_032 = { 38 22 ac e7 }
        $kernel32dll_033 = { 33 ca 8a 5b }
        $kernel32dll_034 = { a0 41 b2 8a }
        $kernel32dll_035 = { b6 41 b2 8a }
        $kernel32dll_036 = { 8e 4e 0e ec }
        $kernel32dll_037 = { fa 97 02 4c }
        $kernel32dll_038 = { f6 ea ba 5c }
        $kernel32dll_039 = { 59 3c 07 7b }
        $kernel32dll_040 = { 0a 66 25 4e }
        $kernel32dll_041 = { e4 c4 4a ef }
        $kernel32dll_042 = { 16 65 fa 10 }
        $kernel32dll_043 = { e5 59 a0 14 }
        $kernel32dll_044 = { 47 26 d3 83 }
        $kernel32dll_045 = { 5d 26 d3 83 }
        $kernel32dll_046 = { b0 49 2d db }
        $kernel32dll_047 = { 05 06 bd 93 }
        $kernel32dll_048 = { 89 6f 01 bd }
        $kernel32dll_049 = { 59 92 08 b2 }
        $kernel32dll_050 = { 54 ca af 91 }
        $kernel32dll_051 = { 0c 3a 63 30 }
        $kernel32dll_052 = { ad d9 05 ce }
        $kernel32dll_053 = { f9 4a 63 c1 }
        $kernel32dll_054 = { 1f 79 0a e8 }
        $kernel32dll_055 = { 3b 49 53 cb }
        $kernel32dll_056 = { 51 49 53 cb }
        $kernel32dll_057 = { 11 4a 9b cb }
        $kernel32dll_058 = { 3b 47 43 dd }
        $kernel32dll_059 = { 51 47 43 dd }
        $wininetdll_001 = { 38 37 2a 13 }
        $wininetdll_002 = { 9f 76 de f7 }
        $wininetdll_003 = { 9d be e6 2d }
        $wininetdll_004 = { c7 69 9b fa }
        $wininetdll_005 = { 0e e8 4b 1e }
        $wininetdll_006 = { e7 00 15 da }
        $wininetdll_007 = { 29 44 e8 57 }
        $wininetdll_008 = { 69 f8 60 b9 }
        $wininetdll_009 = { 8b 4b e3 5f }
        $wininetdll_010 = { 0d a0 ef f5 }
        $shell32dll_001 = { 67 c8 45 37 }
        $shell32dll_002 = { 0f 0b 70 99 }
        $shell32dll_003 = { 86 07 1b 8b }
        $shell32dll_004 = { 9c 07 1b 8b }
        $shell32dll_005 = { 67 c8 45 37 }
        $shell32dll_006 = { 7d c8 45 37 }
        $shlwapidll_001 = { 0e 31 2e 42 }
        $shlwapidll_002 = { 24 31 2e 42 }
        $shlwapidll_003 = { 5c fd 03 62 }
        $crypt32dll_001 = { af aa c2 7c }
        $advapi32dll_001 = { da 8b c2 43 }
        $advapi32dll_002 = { 30 a1 05 41 }
        $advapi32dll_003 = { 7a ae d4 25 }
        $advapi32dll_004 = { a9 b4 af c7 }
        $advapi32dll_005 = { 29 26 12 c2 }
        $advapi32dll_006 = { 94 e8 e8 5a }
        $advapi32dll_007 = { 95 25 5a c1 }
        $advapi32dll_008 = { 34 aa 52 5c }
        $userdll32_001 = { 41 49 45 84 }
        $userdll32_002 = { 23 77 a8 b9 }
        $userdll32_003 = { 01 17 0a 69 }
        $userdll32_004 = { ed 7b c6 7a }
        $userdll32_005 = { cf c0 a6 cb }
        $userdll32_006 = { 14 ba f8 16 }
        $userdll32_007 = { 9d 46 e0 4b }
        $userdll32_008 = { ca 0c e2 51 }
        $userdll32_009 = { 8b 1d 15 e8 }
        $userdll32_010 = { 83 4f 5d c9 }
        $userdll32_011 = { a7 c3 64 25 }
        $userdll32_012 = { 7e 2c de 8f }
        $userdll32_013 = { 3f d8 bf c2 }
        $userdll32_014 = { db bb f6 57 }
        $userdll32_015 = { f1 bb f6 57 }
    condition:
        8 of ($kernel32dll_*) and
        4 of ($wininetdll_*) and
        1 of ($shell32dll_*) and
        1 of ($shlwapidll_*) and
        (
        any of ($userdll32_*) or
        any of ($advapi32dll_*) or
        any of ($crypt32dll_*)
        )
}

rule CrowdStrike_CSA_200503_01 : aesloader backdoor venomous_bear 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects VENOMOUS BEAR's AesLoader Tool"
        reports = "CSA-200503"
        version = "202004171511"
        last_modified = "2020-04-17"
        actor = "VENOMOUS BEAR"
        malware_family = "AesLoader"
    strings:
        // Characteristic x86 bytecode for PE header sanity checks
        $ = { 81 3C 01 50 45 00 00 75 03 33 C0 C3 B8 65 00 59 21 C3 }
    condition:
        all of them
}

rule CrowdStrike_CSA_200528_01 : dnstunnel kitten rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects DNSDAT RAT through configuration parameter names in the data segment"
        reports = "CSA-200528,CSIT-20100"
        version = "202006191916"
        last_modified = "2020-06-19"
        actor = "TRACER KITTEN"
        malware_family = "DNSDAT"
    strings:
        // "/server= <padding> /id="
        $params = { 2f 73 65 72 76 65 72 3d 00 [0-8] 2f 69 64 3d 00 }
    condition:
        uint16(0) == 0x5a4d and
        uint32(uint32(0x3c)) == 0x00004550 and
        $params
}

rule CrowdStrike_CSA_200519_01 : coviper locker packed 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects packed CoViper samples"
        reports = "CSA-200519"
        version = "202004240737"
        last_modified = "2020-04-24"
        malware_family = "CoViper"
    strings:
        $ = {
        d3 ed 75 49 24 12 f8 ae 8b a6 69 18 86 ce c8 d0
        30 ad 46 83 e1 cb 0b 3c fb f5 6b 1c 6d ba 6c 8b
        1e 41 3a c1 ea f2 12 ae eb 61 59 7d 0e 0f 0e d8
        da de 66 6d 63 13 5d 55 c9 e7 73 dc ba 7d 07 db
        76 38 a8 56 18 19 19 65 7b 7b 9b a3 53 d3 28 aa
        46 3c 66 72 64 72 92 46 bd ce ea ca 0a 81 22 13
        7e ec 22 5f 5e be c9 b4 99 24 17 89 4c a7 06 b8
        1a 75 b8 b9 b9 48 da 55 18 7d 6f 1f 31 65 f0 f5
        e5 f7 48 a7 d3 94 cb 65 c2 28 a2 54 2c d0 38 a8
        92 b1 ea 5c b9 fc 36 93 d3 33 5c b8 70 91 81 9b
        }
    condition:
        all of them
}

rule CrowdStrike_CSA_200541_01 : doppelspider exfiltration 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects a PyInstaller-based exfiltration tool by DOPPEL SPIDER"
        reports = "CSA-200541"
        version = "202106131750"
        last_modified = "2021-06-13"
        actor = "DOPPEL SPIDER"
    strings:
        $ = "paramiko.sftp"
        $ = "pyi-windows-manifest-filename svchost.exe.manifest"
    condition:
        all of them and
        ((uint32(filesize - 88) == 0x0c49454d and uint32(filesize - 84) == 0x0e0b0a0b) or
        (uint32(filesize - 24) == 0x0c49454d and uint32(filesize - 20) == 0x0e0b0a0b))
}

rule CrowdStrike_CSA_200531_01 : fancy_bear pytunnel 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects FANCY BEAR PyTunnel versions created with PyInstaller"
        reports = "CSA-200531"
        version = "202008030717"
        last_modified = "2020-08-03"
        actor = "FANCY BEAR"
        malware_family = "PyTunnel"
    strings:
        $ = "opyi-windows-manifest-filename aps-win.encrypted.exe.manifest"
    condition:
        all of them
}

rule CrowdStrike_CSA_200531_02 : fancy_bear pytunnel 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects FANCY BEAR PyTunnel versions created with py2exe"
        reports = "CSA-200531"
        version = "202010041224"
        last_modified = "2020-10-04"
        actor = "FANCY BEAR"
        malware_family = "PyTunnel"
    strings:
        $py2exe_1 = "PYTHONSCRIPT"
        $py2exe_2 = "PY2EXE_VERBOSE"
        $py2exe_3 = "PK"
        $py2exe_4 = "Could not load python dll"
        $eps_py = { 00 65 70 73 2e 70 79 }
    condition:
        all of them
}

rule CrowdStrike_CSIT_20066_01 : primitive_bear usb_grabber 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects x86 instructions used for the creation of the victim identifier in UsbGrabber samples."
        reports = "CSIT-20066"
        version = "202006100937"
        last_modified = "2020-06-10"
        actor = "PRIMITIVE BEAR"
        malware_family = "UsbGrabber"
    strings:
        $s1 = { 55 8b ec 83 ec [0-1] 8b 45 0c 89 45 [0-1] 8b [0-1] 08 89 [0-2] 8b [0-1] 10 89 [0-1] f4 8b 45 10 [0-3] 89 45 10 83 7d f4 00 74 [0-1] 8b [0-3] 4d [0-3] f8 [0-6] 8b [0-1] fc }
        $s2 = { 55 8b ec 81 ec ?? ?? 00 00 [2-12] 00 02 00 00 [0-20] (57 57 57 57 | 6a 00 6a 00 6a 00 6a 00) [0-12] 8d 45 ?? 50 (57 57 | 6a 00 6a 00) [10-48] 00 30 00 00 [48-256] 00 80 00 00 [6-32] 00 80 00 00 [6-32] c3 }
    condition:
        all of them
}

rule CrowdStrike_ChunkyTuna_webshell : chunky_tuna webshell 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects ASP, JSP, and PHP versions of the open-source ChunkyTuna webshell"
        version = "202005011704"
        last_modified = "2020-05-01"
        malware_family = "ChunkyTuna Webshell"
    strings:
        $pwd = "Ddzq1Mg6rIJDCAj7ch78vl3ZEGcXnqKjs97gs5y"
        $x1 = "\"X-Pwd\""
        $x2 = "\"X-Ip\""
        $x3 = "\"X-Port\""
        $x4 = "\"X-Type\""
    condition:
        ($pwd and any of ($x*)) or 3 of ($x*)
}

rule CrowdStrike_CSA_200536_01 : konni macro_dropper velvet_chollima 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects strings present in the April 2020 variant of the macro dropper for Konni downloader"
        reports = "CSA-200536"
        version = "202005011705"
        last_modified = "2020-05-01"
        actor = "VELVET CHOLLIMA"
        malware_family = "Konni"
    strings:
        $ = "Document_Open"
        $ = "cmd /c cd /d %USERPROFILE% && ren"
        $ = "wdBlack"
    condition:
        all of them
}

rule CrowdStrike_CSA_200536_02 : downloader konni velvet_chollima 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects strings present in the April 2020 variant of the Konni downloader"
        reports = "CSA-200536"
        version = "202006161739"
        last_modified = "2020-06-16"
        actor = "VELVET CHOLLIMA"
        malware_family = "Konni"
    strings:
        $ = {20 2F 63 20 22 25 77 73 22 00}
        $ = "install.bat" wide
        $ = "cmd /c expand %ws -F:*"
    condition:
        all of them
}

rule CrowdStrike_CSIT_20126_06 : phishing primitive_bear 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects a message left by the PRIMITIVE BEAR in their phishing template"
        reports = "CSIT-20126"
        version = "202007240808"
        last_modified = "2020-07-24"
        actor = "PRIMITIVE BEAR"
    strings:
        $message_01 = "Your PR is complete shit!\x0d" ascii
    condition:
        any of them
}

rule CrowdStrike_CSIT_20080_01 : ragnar_locker ransomware 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects the Ragnar Locker Ransomware"
        reports = "CSIT-20080"
        version = "202105141503"
        last_modified = "2021-05-14"
        malware_family = "Ragnar Locker"
    strings:
        $ransom_note = "RAGNAR SECRET"
        $ransom_magic = "_RAGNAR_"
        $ransom_name1 = ".ragnar_" wide
        $ransom_name2 = "RGNR_" wide
        $ransom_name3 = ".ragn@r_" wide
        $ransom_name4 = "!$R4GN4R_" wide
        $ransom_name5 = "$$$_RAGNAR_$$$"
        $ransom_name6 = "!R!A!G!N!A!R_" wide
        $commands1 = "wmic.exe shadowcopy delete" wide
        $commands2 = "vssadmin delete shadows /all /quiet" wide
        $pubkey_start_1 = "---BEGIN KEY R_R---" ascii
        $pubkey_start_2 = "---A PRIVATE KEY---" ascii
        $pubkey_end_1 = "---END KEY R_R---" ascii
        $pubkey_end_2 = "---Z PRIVATE KEY---" ascii
        $hash = { 0f b7 [2-6] 42 81 f1 3c ff 01 ab 03 f1 8b c6 c1 c0 0d 2b f0 3b d? 7? }
        // Decryptor
        $decrypt = "PLEASE WAIT FOR DECRYPTION..." wide
        $private_key = {
        2D 2D 2D 2D 2D 42 45 47 49 4E 20 52 53 41 20 50
        52 49 56 41 54 45 20 4B 45 59 2D 2D 2D 2D 2D 0A
        4D 49 49 45 70 41 49 42 41 41 4B 43 41 51 45 41
        36 73 62 71 31 30 6A 49 77 6F 30 51 54 38 30 43
        53 41 69 6C 6C 2F 59 70 57 57 72 5A 4A 35 6E 6F
        48 67 37 69 41 6D 71 59 56 50 52 69 4C 70 50 55
        0A 66 4A 31 41 46 2B 2B 37 38 43 50 51 7A 7A 6A
        68 37 4C 4A 6D 32 51 36 34 36 4A 50 68 64 69 6A
        77 55 32 75 38 73 75 6A 6A 66 31 5A 77 57 67 64
        59 75 69 67 4D 7A 71 67 4E 41 2F 67 2F 54 4B 68
        76 0A 6C 31 58 34 59 54 30 6F 2B 70 78 31 59 78
        41 47 35 72 57 49 4A 6A 4D 74 69 6D 54 78 6F 4C
        46 38 4E 57 49 30 41 6C 65 6B 50 70 4C 67 56 2B
        70 69 5A 54 67 52 54 56 79 37 4A 59 33 4E 7A 54
        53 4B 0A 31 56 4B 56 67 5A 6E 7A 6F 5A 42 59 71
        4E 61 68 78 38 46 71 69 30 46 39 38 7A 73 2B 74
        6F 7A 61 43 73 42 56 6F 56 69 38 57 49 48 72 4D
        69 34 6B 50 2B 46 75 76 70 72 36 56 61 64 6F 63
        73 6F 50 0A 59 48 77 59 68 72 6D 47 51 45 69 58
        6C 6D 2F 71 5A 2B 56 4A 34 64 31 35 57 52 34 6C
        6F 32 43 5A 33 65 54 4D 4F 41 77 36 54 4B 6A 74
        71 47 57 55 56 6F 41 57 78 7A 66 62 6F 6C 36 45
        64 6F 42 51 0A 62 79 69 6C 76 67 4B 68 77 38 43
        2F 65 74 63 7A 4C 32 49 6B 7A 44 67 50 56 79 6B
        68 2F 45 59 7A 68 67 56 69 74 77 49 44 41 51 41
        42 41 6F 49 42 41 42 4F 4B 73 52 74 77 54 48 32
        64 48 6B 46 32 0A 4C 2F 31 73 38 74 4F 65 51 72
        7A 56 6E 76 4F 6A 35 4F 55 7A 6D 65 35 58 6A 77
        78 72 4E 77 7A 6E 63 79 56 59 4E 58 43 49 6E 4E
        30 56 4C 68 6C 42 67 39 53 65 32 4E 36 79 55 67
        50 52 34 30 39 68 0A 67 76 64 2B 6E 54 74 4C 46
        54 79 52 4A 6C 4C 6F 44 36 4F 58 46 39 48 50 76
        52 32 61 65 54 4A 5A 52 73 69 53 2B 46 53 6E 73
        5A 53 43 6C 32 62 43 65 38 43 53 56 5A 33 51 58
        72 63 4A 52 65 39 35 0A 4E 6E 78 2F 43 78 4D 79
        31 6C 48 37 43 62 39 6E 6D 2F 38 4F 31 71 6E 59
        30 52 38 44 38 4E 42 68 44 66 6D 6B 57 6B 6F 59
        6F 4B 78 76 73 66 34 4D 6F 6B 4C 54 61 32 35 66
        43 33 39 6E 70 43 46 4E 0A 57 69 44 50 73 6C 62
        2B 6E 62 45 56 53 72 59 54 64 6F 62 30 45 33 6B
        71 4A 4B 6A 56 39 4A 38 36 6A 46 70 64 67 33 4A
        65 68 63 70 58 32 55 52 78 46 73 46 4D 54 69 4F
        52 70 73 68 31 71 59 2B 4E 0A 49 54 49 38 4B 4D
        62 67 38 66 52 76 78 67 6D 6C 34 49 66 4A 53 56
        43 65 36 42 50 70 36 67 30 4A 77 73 6F 32 34 6E
        6C 72 34 48 62 33 4D 32 75 6C 52 64 6C 6E 72 41
        52 4A 67 31 62 50 65 71 73 65 0A 6C 6E 34 50 35
        72 45 43 67 59 45 41 39 63 2F 35 39 55 56 56 4F
        6C 65 61 49 41 37 57 77 4F 39 56 2F 59 6E 42 6D
        74 67 41 62 68 63 44 77 54 46 49 6C 43 64 52 47
        43 49 48 7A 64 64 61 46 49 47 62 0A 4C 65 74 56
        36 35 58 6B 65 69 79 33 4A 76 52 56 61 63 30 4D
        6E 6C 36 62 4B 53 57 30 57 35 2F 56 42 45 45 6A
        5A 54 47 30 53 53 50 4B 7A 53 38 51 6F 71 76 52
        78 7A 35 5A 36 6C 6C 43 74 42 54 47 0A 56 31 69
        71 4D 6C 54 49 41 61 64 45 4D 43 6D 55 72 42 39
        39 4C 37 6F 6D 61 73 42 47 6C 4E 70 68 69 4E 4F
        58 44 41 41 69 72 49 63 6E 39 77 70 43 72 4F 34
        4E 77 4A 6B 43 67 59 45 41 39 49 48 62 0A 69 52
        66 74 78 31 79 37 34 69 70 4B 4B 58 2F 59 41 6E
        52 7A 7A 77 32 53 4B 59 4A 76 4B 36 47 69 36 4E
        48 59 48 74 48 70 2B 37 53 76 56 57 48 46 65 68
        61 70 35 77 39 37 6E 4D 6D 77 6D 52 70 41 0A 32
        7A 68 6D 44 5A 31 4E 68 54 41 57 38 33 47 58 49
        71 77 55 77 41 72 4B 6D 2B 66 33 43 4D 34 61 56
        6B 33 76 42 69 57 57 72 62 36 70 30 2F 52 6B 2F
        59 38 4C 4D 77 37 6A 6F 2F 6B 35 33 68 5A 6C 0A
        74 70 31 6D 63 55 4C 47 72 66 79 77 4B 67 59 66
        68 74 6B 65 44 46 7A 69 42 41 76 39 4B 41 48 31
        4C 76 34 70 50 38 38 43 67 59 45 41 72 38 6F 77
        49 36 75 56 71 38 65 43 50 58 4C 66 4F 64 4C 76
        0A 57 41 58 77 49 75 42 65 54 6C 79 2F 48 71 59
        30 46 56 2B 59 71 76 32 4C 50 7A 58 48 41 65 73
        2B 49 72 53 75 47 58 42 30 6D 4C 72 70 73 44 34
        44 35 30 6E 77 77 45 46 41 44 55 6B 64 6C 6E 6A
        54 0A 53 64 75 62 69 48 37 6E 51 33 63 4A 54 58
        74 66 46 6A 5A 79 4B 31 37 33 78 70 52 58 45 35
        6E 58 7A 68 64 6D 66 2B 41 4A 75 4D 54 36 43 73
        64 78 76 7A 59 31 76 4C 41 50 55 55 42 34 4F 58
        4F 44 0A 56 4F 71 63 6C 73 52 79 42 35 67 51 69
        4B 63 5A 7A 37 6E 65 73 2B 45 43 67 59 45 41 70
        56 6D 73 50 57 6F 52 51 32 46 54 4C 66 2B 72 5A
        36 55 74 54 33 75 78 56 62 53 33 77 35 71 52 30
        38 2F 62 0A 65 39 64 74 63 47 70 45 38 68 4F 65
        2F 76 36 2F 72 58 44 6D 4E 58 77 69 2F 45 54 70
        53 4B 43 59 65 36 67 49 57 2B 79 6C 49 41 30 46
        65 46 79 34 2B 4A 6D 6D 37 72 68 64 6A 46 47 79
        6E 69 48 44 0A 62 64 6F 47 61 77 48 41 68 48 38
        4D 47 6D 71 4D 59 57 7A 37 42 65 78 72 78 64 67
        6C 61 69 74 37 58 61 50 55 51 34 51 46 47 47 52
        71 50 67 45 6D 45 4F 75 44 68 70 6A 4A 77 44 4C
        62 59 4E 4C 79 0A 48 48 57 46 4C 38 45 43 67 59
        41 43 6A 71 58 76 66 77 42 50 55 62 43 54 4F 6C
        4C 42 66 33 59 4F 43 2F 4C 69 37 6E 4E 59 70 67
        37 64 72 30 63 53 32 51 58 4D 64 79 68 62 6A 63
        75 45 73 66 46 71 0A 76 68 41 32 4B 34 49 2B 42
        45 2B 72 47 55 49 42 4D 46 6E 46 74 30 49 74 74
        42 47 61 61 58 33 31 32 4F 52 5A 57 57 43 72 4C
        65 70 4C 5A 4A 6F 54 58 4A 33 4F 73 39 68 77 62
        33 64 76 59 7A 4A 78 0A 67 64 4F 37 59 4B 33 2B
        6E 75 68 55 31 55 42 58 53 68 52 78 2B 6F 4C 7A
        6B 7A 61 71 75 70 31 6C 50 53 36 37 6D 47 64 33
        41 49 43 2B 78 77 73 72 33 48 6A 31 6A 67 3D 3D
        0A 2D 2D 2D 2D 2D 45 4E 44 20 52 53 41 20 50 52
        49 56 41 54 45 20 4B 45 59 2D 2D 2D 2D 2D 0A
        }
    condition:
        uint16(0) == 0x5a4d and (
        $ransom_note or
        $ransom_magic or
        (any of ($ransom_name*)) or
        (all of ($commands*)) or
        $hash or
        $private_key or
        $decrypt or
        (any of ($pubkey_*))
        ) and
        filesize < 350KB
}

rule CrowdStrike_LemonDuck_01 : lemonduck mineware 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects mineware payload for LemonDuck"
        version = "202011271112"
        last_modified = "2020-11-27"
        malware_family = "LemonDuck"
    strings:
        $ = "\"donate-level\":"
        $ = "\"health-print-time\":"
        $ = "\"retry-pause\":"
        $ = "\"randomx\":"
        $ = "\"opencl\":"
        $ = "\"cuda\":"
        $ = "\"worker-id\":"
        $ = "\"cn-lite/0\":"
        $stratum = "stratum+tcp://" ascii wide
    condition:
        7 of them and
        $stratum
}

rule CrowdStrike_CSA_201584_01 : distortedshepherd godx rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects strings from GodX PowerShell implant used by DistortedShepherd"
        reports = "CSA-201584"
        version = "202012181539"
        last_modified = "2020-12-18"
        malware_family = "GodX"
        activity_cluster = "DistortedShepherd"
    strings:
        $ = "function G0Dx()" wide ascii
        $ = "Proccess" wide ascii
        $ = "([IPAddress] [regex]::match($answer, 'Address:\\s+([\\dabcdef:]+|::[\\d\\.]+)\\s').Groups[1].Value).GetAddressBytes()"
        $ = "[int][Math]::Ceiling($edata.Length / 40.0)"
        $ = "$split[0] \"r\" $domain ([System.IO.File]::ReadAllBytes($ResultDir))"
        $ = "nslookup -timeout=10 -retry=5 -query=AAAA"
        $ = "Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/82.0.4085.6 Safari/537.36"
    condition:
        2 of them
}

rule CrowdStrike_CSIT_20122_01 : prolock ransomware 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Matches on the on ProLock's routine for decrypting its instructions upon being loaded into memory."
        reports = "CSIT-20122"
        version = "202007030722"
        last_modified = "2020-07-03"
        malware_family = "Prolock"
    strings:
        // Check for end of encrypted "section"
        $ = { 81 3c 1a 90 90 90 90 }
        // Check for end of encrypted data
        $ = { 81 3c 1a c4 c4 c4 c4 }
        // End of Encrypted data
        $ = { c4 c4 c4 c4 c4 c4 c4 }
    condition:
        all of them
}

rule CrowdStrike_CSA_200553_01 : dotnet dotnet_ratankba dropper ratankba stardust_chollima 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Strings found in crypto currency decoy used to drop new DotNet variant of Ratankba"
        reports = "CSA-200553"
        version = "202005011718"
        last_modified = "2020-05-01"
        actor = "STARDUST CHOLLIMA"
        malware_family = "Ratankba"
    strings:
        $ = "TVqQ^^M^^^^E^^^^//8^" wide
        $ = "szContent"
        $ = "FromBase64String"
    condition:
        all of them
}

rule CrowdStrike_CSA_200553_02 : dotnet dotnet_ratankba ratankba stardust_chollima 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Strings found in DotNet variant of Ratankba first stage implant"
        reports = "CSA-200553"
        version = "202005011719"
        last_modified = "2020-05-01"
        actor = "STARDUST CHOLLIMA"
        malware_family = "Ratankba"
    strings:
        $ = "?action=\"CmdRes\"&type=\"kagent\"&u=" wide
        $ = "?action=\"CmdRes\"&type=\"delay\"&u=" wide
        $ = "?action=\"CmdRes\"&type=\"panel\"&u=" wide
        $ = "DESCryptoServiceProvider"
    condition:
        all of them
}

rule CrowdStrike_CSA_200376_01 : stealer unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects Telegram Stealer payload from CSA-200376."
        version = "202005011709"
        last_modified = "2020-05-01"
    strings:
        $tele = "Telegram" wide
        $url1 = "https://api.telegram.org/bot" wide
        $url2 = "/sendDocument?chat_id=" wide
        $url3 = "&parse_mode=html&text=<b>" wide
        $msg1 = "&caption=Hacked by" wide
        $msg2 = {2f06 3106 2d06 2706 4406 2000 2706 3106 3306 2706 4406}
        $sig1 = "EXPL0IT"
        $sig2 = "SendTData"
        $sig3 = "Report2Tel"
        $sig4 = "TryHookProcess"
    condition:
        8 of them and any of ($url*) and any of ($sig*)
}

rule CrowdStrike_CSA_200568_01 : busy_guild downloader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule matches against a downloader likely deployed against Vietnamese government personnel."
        reports = "CSA-200568"
        version = "202005012008"
        last_modified = "2020-05-01"
    strings:
        $user_agent = "Gecko / 20100101 Chrome/73.0.3645.0"
        $b64_url_safe_mistake = { 80 f? 2b 74 05 80 f? 2f 75 04 c6 ?? ?? 5f }
        $dll_name = "WininetBodyShell.dll"
    condition:
        any of them
}

rule CrowdStrike_CSIT_20087_01 : certificate powerton refined_kitten 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects x509 certificate used for REFINED KITTEN POWERTON malware"
        reports = "CSIT-20087"
        version = "202006081741"
        last_modified = "2020-06-08"
        actor = "REFINED KITTEN"
        malware_family = "POWERTON"
    strings:
        // Date Range
        $ = "180411121806Z" wide ascii
        $ = "200522081851Z" wide ascii
        // Company Name
        $ = "Cerbero GmbH" wide ascii
        // Serial Number
        $ = { 49 93 45 e0 da 32 6d c7 bd 3b 34 69 }
        // .Net Framework
        $ = ".NETFramework,Version=" wide ascii
    condition:
        // PE Timestamp
        uint32(uint32(0x3c) + 0x8) < 0x5acdfcfe and
        all of them
}

rule CrowdStrike_BornSlippy_01 : bornslippy dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects a VBS-based malicious dropper with heavy VM detection"
        version = "202106251058"
        last_modified = "2021-06-25"
        malware_family = "BornSlippy"
    strings:
        $array = /\w+\s{0,3}=\s{0,3}Array\(\s{0,3}(\w{1,10},\s{0,3}){80}/
        $const = /const\s{1,3}\w{2,5}\s{0,3}=\s{0,3}\d{2,5}/
        $exe1 = "ExecuteGlobal("
        $exe2 = "execute("
        $chr = "ChrW"
    condition:
        #array > 20 and
        #const > 3 and
        #chr >= 1 and
        #chr <= 3 and
        (#exe1 > 10 or #exe2 > 10)
}

rule CrowdStrike_CSA_200585_01 : downloader ecrime salt_stack script 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects Bash script used in May 2020 Salt Stack exploit miner campaigns"
        reports = "CSA-200585"
        version = "202005131255"
        last_modified = "2020-05-13"
    strings:
        $bash = "#!/bin/sh"
        $wget = "$WGET $DIR/salt-store"
        $md5check = "sum=$(md5sum $DIR/salt-store"
        $skl = "SKL=sa $DIR/salt-store"
    condition:
        all of them
}

rule CrowdStrike_CSA_200584_01 : labyrinth_chollima matanet 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects strings present in LABYRINTH CHOLLIMA MataNet MacOS variant"
        reports = "CSA-200584"
        version = "202005081110"
        last_modified = "2020-05-08"
        actor = "LABYRINTH CHOLLIMA"
        malware_family = "MataNet"
    strings:
        $ = "c_2910.cls"
        $ = "k_3872.cls"
        $ = "CMataNet_"
        $ = "/LaunchDaemons/"
    condition:
        all of them
}

rule CrowdStrike_Pyxie_Backdoor_Loader : backdoor loader pyxie 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Backdoor DLL used in DLL search order hijacking to load first stage of PyXie"
        version = "202007221746"
        last_modified = "2020-07-22"
    strings:
        $s1 = "GetModuleFileNameA"
        $s2 = ".dat"
        $s3 = "dll_loader.dll"
        $crypto = { ba 10 00 00 00 8a 1c 01 30 18 40 4a}
        $aes_table = {63 7c 77 7b f2 6b 6f c5 30 01 67 2b fe d7 ab 76 ca 82 c9 7d fa 59 47 f0 ad d4 a2 af 9c a4 72 c0}
    condition:
        all of them and filesize <= 40000
}

rule CrowdStrike_CSIT_20093_01 : chollima labyrinth_chollima rat xctrat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects class names and strings observed in likely CHOLLIMA payload delivered using an exploit in a COVID-19 themed HWP document lure"
        reports = "CSIT-20093"
        version = "202006221435"
        last_modified = "2020-06-22"
        actor = "LABYRINTH CHOLLIMA"
        malware_family = "XcTRAT"
    strings:
        $s0 = "id=%u&content="
        $s1 = "?timestamp=%u" wide
        $s2 = "XcT_"
        $s3 = "ShutdownBlockReason"
        $s4 = "/c del /F" wide
        $s5 = "V1.h1" wide
        $s6 = "Microsoft\\Windows\\WinX\\Group" wide
        $s7 = "[MyDocuments]" wide
        $s8 = "[LocalAppData]" wide
        $s9 = "Running Processes"
        // Exports
        $e0 = "ReflectiveLoader"
        $e1 = "getVersion"
        // Class name, generic ".?AVC<name>Funit@@"
        $c0 = {2e 3f 41 56 43 [1-10] 46 75 6e 69 74 40 40}
        $c1 = ".?AVCRcver@@"
        $c2 = ".?AVCCmdFunit@@"
        $c3 = ".?AVCRootFunit@@"
        $c4 = ".?AVCFduFunit@@"
    condition:
        uint16(0) == 0x5a4d and
        3 of ($s*) and
        1 of ($e*) and
        2 of ($c*)
}

rule CrowdStrike_CSIT_20095_01 : loader metaljack ocean_buffalo 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects METALJACK loader based on unique Resource Directory String"
        reports = "CSIT-20095"
        version = "202005221442"
        last_modified = "2020-05-22"
        actor = "OCEAN BUFFALO"
        malware_family = "METALJACK"
    strings:
        $str1 = "VirtualProtect"
        $str2 = "krpt.dll"
        $str3 = "LoadResource"
        $str4 = "?_force_link_krpt@@YGXXZ"
        $hex_str = { 41 00 53 00 44 00 4B 00 4C 00 46 00 4A 00 47 00 48 00 45 00 44 00 4A 00 49 00 48 00 41 00 53 00 49 00 4F }
    condition:
        uint16(0) == 0x5a4d and
        all of them
}

rule CrowdStrike_CSIT_20095_02 : metaljack ocean_buffalo shellcode 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects METALJACK shellcode decryption routine "
        reports = "CSIT-20095"
        version = "202006101722"
        last_modified = "2020-06-10"
        actor = "OCEAN BUFFALO"
        malware_family = "METALJACK"
    strings:
        $xor_decoding_loop = { BE ?? ?? ?? ?? DB CE D9 74 24 F4 58 29 C9 B9 ??
        ?? ?? 00 31 70 16 03 70 16 83 E8 20 83 1A 05 D8
        44 E7 76 30 4D E7 76 C0 C3
        }
    condition:
        $xor_decoding_loop
}

rule CrowdStrike_JSPX_Sevck_Webshell_By_Robot : panda webshell 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects distinctive strings in webshell file associated with Zoho ManageEngine exploitation"
        version = "202005221554"
        last_modified = "2020-05-22"
        malware_family = "Sevck Webshell"
        
    strings:
        $ = "User: robot"
        $ = "getParameter(\"newid\")"
        // "// "
        $ = { 2F 2F 20 E5 A2 9E E5 8A A0 E8 BE 93 E5 87 BA }
        $ = "Who am I? Someone that's afraid to let go, uh"
        $ = "JejEOrai3DhYR8q8"
        $ = "67NfRvQARK3sqkwA"
        $ = ".equals(\"sevck\")"
    condition:
        filesize < 1MB and 2 of them
}

rule CrowdStrike_CSA_200623_01 : chemtrail loader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Decryption loop bytecode in Chemtrail loader component"
        reports = "CSA-200623"
        version = "202005221438"
        last_modified = "2020-05-22"
        malware_family = "Chemtrail"
    strings:
        $decloop_bytecode = { 61 31 C2 8B 45 FC 48 98 }
    condition:
        all of them
}

rule CrowdStrike_CSA_200623_02 : chemtrail logcleaner 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "encrypted string in Chemtrail log cleaner component"
        reports = "CSA-200623"
        version = "202005221440"
        last_modified = "2020-05-22"
        malware_family = "Chemtrail"
    strings:
        $ = { 14 CC FC 28 25 DE B9 }
    condition:
        all of them
}

rule CrowdStrike_CSIT_20188_01 : ransomware snatch 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Matches on the on Snatch Ransomware"
        reports = "CSIT-20188"
        version = "202009281548"
        last_modified = "2020-09-28"
        malware_family = "Snatch"
    strings:
        // Go build ID
        $g = "Go build ID"
        // Main functions
        $m1 = "main.runService"
        $m2 = "main.runInstance"
        $m3 = "main.decodeString"
        $m4 = "main.makeFile"
        $m5 = "main.makeBatFile"
        $m6 = "main.runBatFile"
        $m7 = "main.isSafeBoot"
        $m8 = "main.deleteShadowCopy"
        $m9 = "main.selfRemove"
        $m10 = "main.randomBatFileName"
        $m11 = "main.safeModeEnabled"
        // Source files
        $s1 = "/home/go/src/locker/config.go"
        $s2 = "/home/go/src/locker/queue.go"
        $s3 = "/home/go/src/locker/misc.go"
        $s4 = "/home/go/src/locker/services.go"
        $s5 = "/home/go/src/locker/main.go"
        $s6 = "/home/go/src/locker/files.go"
        $s7 = "/home/go/src/locker/dirs.go"
    condition:
        $g and 6 of ( $m* ) and  4 of ( $s* )
}

rule CrowdStrike_CSIT_20106_01 : ekans ransomware 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects strings and opcodes used by EKANS ransomware"
        reports = "CSIT-20106"
        version = "202006120756"
        last_modified = "2020-06-12"
        malware_family = "EkansRansomware"
    strings:
        $str_gobuild = "Go build ID:"
        $gostr1 = "scandir_windows.go" fullword
        $gostr2 = "swbemservices.go" fullword
        $gostr3 = "ENCRYPTED_AES_Key"
        $asm_decstr = { 8d 05 [4] 89 44 24 04 c7 44 24 08 [3] 00 e8 [4] [16-48] 8d 15 [4] 89 54 24 04 c7 44 24 08 [3] 00 e8 }
        $asm_decstr1 = { 83 c? ?? 0f b6 3c 2? 31 f? }
        $asm_domainr = { e8 [4] 0f b6 44 24 ?? 84 c0 74 ?? b8 01 00 00 00 eb ?? }
    condition:
        uint16(0) == 0x5a4d and
        filesize > 3MB and filesize < 8MB and
        $str_gobuild and
        any of ($gostr*) and
        2 of ($asm_*) and
        #asm_decstr > 500
}

rule CrowdStrike_CSA_200648_01 : sevck webshell 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule matches against a publicly available webshell and specifically negates a modification used by a targeted intrusion adversary."
        reports = "CSA-200648"
        version = "202005221549"
        last_modified = "2020-05-22"
        malware_family = "Sevck Webshell"
    strings:
        $str1 = "Process pro = pb.start();"
        $str2 = ").equals(\"sevck\")"
        $str3 = "String [] args = command.split(\"@\");"
        $aes = "public static class AEScrypt"
    condition:
        any of ($str*) and not $aes
}

rule CrowdStrike_CSA_200648_02 : sevck webshell 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule matches against a publicly available webshell and specifically includes a modification used by a targeted intrusion adversary."
        reports = "CSA-200648"
        version = "202005221549"
        last_modified = "2020-05-22"
        malware_family = "Sevck Webshell (modified)"
    strings:
        $str1 = "Process pro = pb.start();"
        $str2 = ").equals(\"sevck\")"
        $str3 = "String [] args = command.split(\"@\");"
        $aes = "public static class AEScrypt"
    condition:
        any of ($str*) and $aes
}

rule CrowdStrike_CSA_200648_04 : jsp_filebrowser webshell with_crypto 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule matches against a publicly available webshell that has been modified by a targeted intrusion adversary to include AES encrypted communications."
        reports = "CSA-200648"
        version = "202005221553"
        last_modified = "2020-05-22"
        malware_family = "JSP FileBrowser Webshell (modified)"
    strings:
        $func1 = "UplInfo"
        $func2 = "getUprate"
        $func3 = "getPercent"
        $func4 = "getTimeEstimated"
        $cipher = "cipher.doFinal"
    condition:
        all of them
}

rule CrowdStrike_CSA_200648_03 : jsp_filebrowser webshell 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule matches against a publicly available webshell called JSP File Browser."
        reports = "CSA-200648"
        version = "202005291719"
        last_modified = "2020-05-29"
        malware_family = "JSP FileBrowser Webshell"
    strings:
        $func1 = "UplInfo"
        $func2 = "getUprate"
        $func3 = "getPercent"
        $func4 = "getTimeEstimated"
        $cipher = "cipher.doFinal"
    condition:
        all of ($func*) and not $cipher
}

rule CrowdStrike_CSIT_20114_01 : indrik_spider ransomware unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects WastedLocker ransomware used by INDRIK SPIDER"
        reports = "CSIT-20114"
        version = "202011021934"
        last_modified = "2020-11-02"
        actor = "INDRIK SPIDER"
        malware_family = "WastedLocker"
    strings:
        $asm_bss = { 81 3? 2e 62 73 73 74 ?? }
        $asm_dec_ror = { 89 08 8a cb d3 ca 83 c6 04 4b 8b ca }
        $asm_dec_swap = { 89 19 0f ca 83 c6 04 83 c1 04 8b da }
        $asm_argr = { 8b 00 3d 2d 00 72 00 75 ?? }
        $asm_args = { 3d 2d 00 73 00 75 ?? }
        $asm_argp = { 8b 00 3d 2d 00 70 00 0f 85 ?? ?? ?? ?? }
        $asm_argf = { 3d 2d 00 66 00 75 ?? }
    condition:
        uint16(0) == 0x5a4d and
        4 of ($asm_*)
}

rule CrowdStrike_KARMA_PANDA_exploit_doc_metadata : eight_t karma_panda rtf 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule matches against metadata found in 8.t-like RTF documents deployed by KARMA PANDA."
        version = "202106081537"
        last_modified = "2021-06-08"
        actor = "KARMA PANDA"
    strings:
        $operator = "{\\operator KeyNG}"
        $operator_b64_1 = "e1xcb3BlcmF0b3IgS2V5Tkd9"
        $operator_b64_2 = "tcb3BlcmF0b3IgS2V5Tkd9"
        $operator_b64_3 = "XG9wZXJhdG9yIEtleU5Hf"
    condition:
        any of them
}

rule CrowdStrike_CSIT_20104_04 : kordll labyrinth_chollima stardust_chollima twopence 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects the components that make up the KorDLL-Twopence linked main payload"
        reports = "CSIT-20104"
        version = "202006120757"
        last_modified = "2020-06-12"
        actor = "LABYRINTH CHOLLIMA"
        malware_family = "KorDLL"
    strings:
        $xordns1 = { 8b 44 24 ?? 8b 54 24 ?? 6a 01 50 8b 48 18 81 f1 ?? ?? ?? ?? 89 0a 8b 0d }
        $xordns2 = { 8b 44 24 04 8b ?? ?? ?? 6a 01 50 8b 50 18 81 f2 ?? ?? ?? ?? 89 ?? 8b 0d }
        $xordns3 = { 8b 44 24 10 8b 4c 24 14 6a 01 50 ff 70 18 5a 81 f2 ?? ?? ?? ?? 52 8f 01 }
        $xordns4 = { 8b 44 24 10 8b 4c 24 14 6a 01 50 8b 50 18 81 f2 ?? ?? ?? ?? 52 8f 01 }
        $dotobf1 = { 3c 2e 74 07 3c 20 74 03 88 06 46 8a 42 01 42 84 c0 }
        $dotobf2 = { 3c 2e 74 07 3c 20 74 03 88 03 43 47 eb eb }
        $mutex = "Global\\WindowsUpdateTracing%d.%d"
    condition:
        1 of ($xordns*) and
        1 of ($dotobf*) and
        $mutex
}

rule CrowdStrike_CSIT_20104_03 : kordll labyrinth_chollima stardust_chollima twopence 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects the self delete script, mutex and obfuscation routine used by the KorDLL-TwoPence linked payload dropper"
        reports = "CSIT-20104"
        version = "202006120755"
        last_modified = "2020-06-12"
        actor = "LABYRINTH CHOLLIMA"
        malware_family = "KorDLL"
    strings:
        $selfdel1 = { 3a 4c 31 0d 0a 64 65 6c 20 22 25 73 22 0d 0a 69 66 20 65 78 69 73 74 20 22 25 73 22 20 67 6f 74 6f 20 4c 31 0d 0a 64 65 6c 20 22 25 73 22 0d 0a }
        $selfdel2 = { 22 20 67 6f 74 6f 20 52 31 0d 0a 64 65 6c 20 2f 61 20 22 00 }
        $dotobf1 = { 3c 2e 74 07 3c 20 74 03 88 06 46 8a 42 01 42 84 c0 }
        $dotobf2 = { 3c 2e 74 07 3c 20 74 03 88 03 43 47 eb eb }
        $mutex = "Global\\WindowsUpdateTracing%d.%d"
    condition:
        1 of ($selfdel*) and 1 of ($dotobf*) and $mutex
}

rule CrowdStrike_CSIT_20100_01 : mimikatz tracer_kitten 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detect custom Mimikatz variant through obfuscated print statements"
        reports = "CSIT-20100"
        version = "202006191916"
        last_modified = "2020-06-19"
        actor = "TRACER KITTEN"
        malware_family = "Mimikatz"
    strings:
        $ = "* 4main     : %wZ" wide
        $ = "* Bassworld :" wide
        $ = "* NMLT     :" wide
        $ = "* SA_One     :" wide
        $ = "* RKy  :" wide
    condition:
        all of them
}

rule CrowdStrike_CSA_200677_01 : cve_2019_10149 exploit 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects invalid RCPT TO and MAIL FROM fields used to exploit CVE-2019-10149."
        reports = "CSA-200677"
        version = "202106171600"
        last_modified = "2021-06-17"
    strings:
        $ = "MAIL FROM:<${run"
        $ = "RCPT TO:<${run"
    condition:
        any of them
}

rule CrowdStrike_CSIT_20104_05 : dropper hawup kordll labyrinth_chollima 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects format string and self deletion script contained in dropper for KorDLL framework - Hawup linked RAT"
        reports = "CSIT-20104"
        version = "202006120755"
        last_modified = "2020-06-12"
        actor = "LABYRINTH CHOLLIMA"
        malware_family = "KorDLL"
    strings:
        $bat1 = ":Repeat1"
        $bat2 = "if exist \"%s\" goto Repeat1"
        $format1 = "ExePath: %s"
        $format2 = "XlsPath: %s"
        $format3 = "TmpPath: %s"
    condition:
        all of them
}

rule CrowdStrike_CSIT_20104_06 : hawup kordll labyrinth_chollima rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects code used for obfuscation and fakeTLS in the KorDLL framework - Hawup linked main payload"
        reports = "CSIT-20104"
        version = "202006120755"
        last_modified = "2020-06-12"
        actor = "LABYRINTH CHOLLIMA"
        malware_family = "KorDLL"
    strings:
        $tls1 = { 8b 3d a4 01 41 00 8b f1 68 01 03 00 00 88 44 24 10 ff d7 }
        $tls2 = { 8b 3d ?? ?? (4? ??| 00 10) 8b f1 68 01 03 00 00 88 44 24 10 ff d7 }
        $dotobf1 = { 3c 2e 74 07 3c 20 74 03 88 06 46 8a 42 01 42 84 c0 }
        $dotobf2 = { 3c 2e 74 07 3c 20 74 03 88 03 43 47 eb eb }
    condition:
        1 of ($tls*) and
        1 of ($dotobf*)
}

rule CrowdStrike_CSIT_20104_02 : kordll labyrinth_chollima rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects the obfuscation routine for strings and format string for command execution observed in KorDLL Bot"
        reports = "CSIT-20104"
        version = "202006120755"
        last_modified = "2020-06-12"
        actor = "LABYRINTH CHOLLIMA"
        malware_family = "KorDLL"
    strings:
        $dotobf1 = { 3c 2e 74 07 3c 20 74 03 88 06 46 8a 42 01 42 84 c0 }
        $dotobf2 = { 3c 2e 74 07 3c 20 74 03 88 03 43 47 eb eb }
        $exec1 = "%sd.e%sc %s 2>%s"
        $exec2 = "%sd.e%sc %s >%s 2>&1"
    condition:
        1 of ($dotobf*) and
        1 of ($exec*)
}

rule CrowdStrike_CSIT_20104_01 : dropper kordll labyrinth_chollima 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects the obfuscation routine for strings, self deletion script and encoding scheme for KorDLL Bot droppers"
        reports = "CSIT-20104"
        version = "202006120755"
        last_modified = "2020-06-12"
        actor = "LABYRINTH CHOLLIMA"
        malware_family = "KorDLL"
    strings:
        $selfdel1 = { 3a 4c 31 0d 0a 64 65 6c 20 22 25 73 22 0d 0a 69 66 20 65 78 69 73 74 20 22 25 73 22 20 67 6f 74 6f 20 4c 31 0d 0a 64 65 6c 20 22 25 73 22 0d 0a }
        $selfdel2 = { 22 20 67 6f 74 6f 20 52 31 0d 0a 64 65 6c 20 2f 61 20 22 00 }
        $dotobf1 = { 3c 2e 74 07 3c 20 74 03 88 06 46 8a 42 01 42 84 c0 }
        $dotobf2 = { 3c 2e 74 07 3c 20 74 03 88 03 43 47 eb eb }
        $xor = { 8a 10 80 f2 ?? 80 ea }
    condition:
        1 of ($selfdel*) and
        1 of ($dotobf*) and
        $xor
}

// WARNING: This rule will only work with YARA 3
import "pe"

rule CrowdStrike_CSIT_20066_08 : primitive_bear usb_grabber 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects DLLs with exported functions combinations seen in UsbGrabber samples"
        reports = "CSIT-20066"
        version = "202006100930"
        last_modified = "2020-06-10"
        actor = "PRIMITIVE BEAR"
        malware_family = "UsbGrabber"
    condition:
        pe.characteristics & pe.DLL and
        (
        pe.number_of_exports >= 4 and
        pe.exports("install") and
        pe.exports("noinstall") and
        pe.exports("start") and
        pe.exports("run")
        )
}

// WARNING: This rule will only work with YARA 3
import "pe"

rule CrowdStrike_CSIT_20066_10 : primitive_bear usb_grabber 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects DLLs with exported functions as seen in UsbGrabber samples"
        reports = "CSIT-20066"
        version = "202006100933"
        last_modified = "2020-06-10"
        actor = "PRIMITIVE BEAR"
        malware_family = "UsbGrabber"
    condition:
        pe.characteristics & pe.DLL and pe.exports("ou34")
}

rule CrowdStrike_CSIT_20103_02 : derusbi wicked_panda 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects distinctive strings and obfuscated data in files relating to WICKED PANDA Derusbi activity"
        reports = "CSIT-20103"
        version = "202006101000"
        last_modified = "2020-06-10"
        actor = "WICKED PANDA"
        malware_family = "Derusbi"
    strings:
        $s1 = "-pergb"
        $log = "Log.txt"
        $pdb_path = "\\rk\\_OUT\\"
        $s2 = "dfgnoehnthrt4"
        $obfuscated_pe = { c5 d2 18 88 8b 88 88 88 8c 88 88 88 77 77 88 88 }
    condition:
        uint16(0) == 0x5a4d and
        filesize < 2MB and
        2 of them
}

rule CrowdStrike_CSIT_20104_07 : hawup kordll labyrinth_chollima rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects code used for obfuscation and fakeTLS in the KorDLL framework - Hawup linked main payload"
        reports = "CSIT-20104"
        version = "202006120756"
        last_modified = "2020-06-12"
        actor = "LABYRINTH CHOLLIMA"
        malware_family = "KorDLL"
    strings:
        $crypt = { 7e 0e 8a 10 80 f2 ?? 80 ea ?? 88 10 40 49 75 f2 }
        $dotobf1 = { 3c 2e 74 07 3c 20 74 03 88 06 46 8a 42 01 42 84 c0 }
        $dotobf2 = { 3c 2e 74 07 3c 20 74 03 88 03 43 47 eb eb }
        $end = "---------------End--------------!"
    condition:
        $crypt and
        $end and
        1 of ($dotobf*)
}

rule CrowdStrike_CSIT_20109_01 : ransomware sekhmet 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects distinctive strings and code in Sekhmet Ransomware samples"
        reports = "CSIT-20109"
        version = "202006120756"
        last_modified = "2020-06-12"
        malware_family = "Sekhmet Ransomware"
    strings:
        $ = "expand 32-byte kexpand 16-byte k" ascii
        $ = { 35 be ba ad de }
        $ = { 3d be ba ad de }
        $ = { 6a 00 6a 00 68 [4] c3 }
        $ = { c7 [3] 81 11 14 14 c7 [3] 19 18 ae 4f 68 [4] c3 }
    condition:
        all of them
}

rule CrowdStrike_CSIT_20091_01 : mallard_spider plugin qakbot 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects the Qakbot email stealer plugin"
        reports = "CSIT-20091"
        version = "202102191058"
        last_modified = "2021-02-19"
        actor = "MALLARD SPIDER"
        malware_family = "Qakbot"
    strings:
        $method_name1 = "GetMsgDate"
        $method_name2 = "CollectFolderEmails"
        $method_name3 = "GetEmailMsgRecepients"
        $method_name4 = "TryToGuessMsgStoreEmailByMessage"
        $method_name5 = "CheckSpamMessage"
        $method_name7 = "EnumerateEmailFoldersRecur"
        $method_name8 = "ProcessMsgStore"
        $method_name9 = "CollectOutlookAddressBookThread"
        $method_name10 = "CollectOutlookAddressBook"
        $method_name11 = "ListOutlookProfiles"
        $method_name12 = "JsonUploadMsgChunk"
        $method_name13 = "JsonUploadChunk"
        $method_name14 = "PushMsgToChunk"
        $method_name15 = "UploadEmailsCallback"
        $method_name16 = "UploadEnumOutlookProfilesCallback"
        $method_name17 = "UploadEmails"
        $method_name18 = "UploadWorkerLog"
        $method_name19 = "StorageCreateRootDirectoryW"
        $command1 = "\\SysWOW64\\ping.exe -t 127.0.0.1" wide
        $command2 = "\\system32\\ping.exe -t 127.0.0.1" wide
        $regex1 = "^[-A-Za-z0-9._%+]+@[-A-Za-z0-9.]+\\.[A-Za-z]+$"
        $regex2 = "^[-A-Za-z0-9._]+:\\s"
        $log1 = "Emails in folder: %u / %u"
        $log2 = "skip bad folder: %S"
        $log3 = "Enter folder '%S'"
        $log4 = "Address book done: total %u records"
    condition:
        uint16(0) == 0x5a4d and
        ((any of ($command*)) or (any of ($regex*)) or (any of ($log*)) or (2 of ($method_name*))) and
        filesize < 500KB
}

rule CrowdStrike_CSIT_20091_02 : mallard_spider plugin qakbot 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects the Qakbot password grabber plugin"
        reports = "CSIT-20091"
        version = "202102191058"
        last_modified = "2021-02-19"
        actor = "MALLARD SPIDER"
        malware_family = "Qakbot"
    strings:
        $method_name1 = "RipSavedPasses" ascii
        $method_name2 = "CuteFtpScanCfg" ascii
        $method_name3 = "CuteFtpScanDirs" ascii
        $method_name4 = "CuteFtpPasswords" ascii
        $method_name5 = "EnumPStorage" ascii
        $method_name6 = "TimeToWstring" ascii
        $method_name8 = "DecryptEEPSData" ascii
        $method_name9 = "ExtractIE7AutoCompleteData" ascii
        $method_name10 = "ExtractIECredentials2" ascii
        $method_name11 = "GetFirefoxInstallPath" ascii
        $method_name12 = "GetFirefoxProfilePath" ascii
        $method_name13 = "GetChromeProfilePath" ascii
        $method_name14 = "CrackChrome" ascii
        $method_name15 = "OutlookAddPStoreRec" ascii
        $method_name16 = "OutlookDecryptPassword" ascii
        $method_name17 = "ScanOutlookProfiles" ascii
        $method_name18 = "ExtractOutlookAccounts" ascii
        $method_name19 = "WriteSecLogStr" ascii
        $code_random_gen1 = { 5? 6a 1e 6a 14 8b ?? ?? 81 c2 ?? ?? 00 00 5? e8 }
        $code_random_gen2 = { 5? 6a 0f 6a 0a 8b ?? ?? 05 ?? ?? ?? ?? 5? e8 }
        $string1 = "dbg_%s_%u.txt" ascii
        $string2 = "dbg_%s_%u_qbotdll.txt" ascii
        $string3 = "qbot_dll_main" ascii
    condition:
        uint16(0) == 0x5a4d and
        ((2 of ($string*)) or (2 of ($code_random_gen*)) or (4 of ($method_name*))) and
        filesize < 800KB
}

rule CrowdStrike_CSIT_20091_03 : mallard_spider plugin qakbot 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects the Qakbot Javascript dropper plugin"
        reports = "CSIT-20091"
        version = "202102191058"
        last_modified = "2021-02-19"
        actor = "MALLARD SPIDER"
        malware_family = "Qakbot"
    strings:
        $string1 = "LookupAccountSidW() err %u" wide
        $string2 = "%s\\%s" wide
        $string3 = "abcdefghijklmnopqrstuvwxyz"
        $string4 = "USERPROFILE" wide
        $code_random_gen1 = { 68 ?? ?? ?? ?? 6a 0a 6a 0f 58 bb ?? ?? ?? ?? e8 }
        $code_random_gen2 = { 50 6a 14 6a 1e 58 bb ?? ?? ?? ?? e8 }
    condition:
        uint16(0) == 0x5a4d and
        ((2 of ($code_random_gen*)) or (4 of ($string*))) and
        filesize < 100KB
}

rule CrowdStrike_Web_Based_Credential_Harvesting_SSL_Channel : credential_theft 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule matches against content observed in web-based credential harvesting attacks, may include spoofed login pages for Microsoft and other similar sites."
        version = "202006120756"
        last_modified = "2020-06-12"
    strings:
        $login = "Login.php?sslchannel="
        $password = "Password.php?sslchannel="
    condition:
        any of them
}

rule CrowdStrike_CSIT_20122_02 : powershell prolock ransomware 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects the PowerShell Prolock Loader"
        reports = "CSIT-20122"
        version = "202007030722"
        last_modified = "2020-07-03"
        malware_family = "prolock"
    strings:
        $enc = "IAAgACAAIAAJAGYAdQBuAGMAdABpAG8AbgAgAEwAbwBjAGEAbAA6AEEARgBGAEYARgBGAEYARgBDAEMAQQBFACAAIAAgACAAIAB7ACAAIAAgACAAIAAgACAAIAAgAFAAYQByAGEAb"
    condition:
        $enc
}

rule CrowdStrike_CSIT_21003_02 : metaljack ocean_buffalo pagoda 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects shellcode that unpacks a malicious DLL and is attributed to OCEAN BUFFALO"
        reports = "CSIT-21003"
        version = "202101291825"
        last_modified = "2021-01-29"
        actor = "OCEAN BUFFALO"
        malware_family = "Pagoda"
    strings:
        $str1 = "!This program cannot be run in DOS mode"
        $str2 = "RtlZPV"
        $str3 = "eroM"
        $str4 = "RtlM"
        $str5 = "oveM"
        $str6 = "VirtPR"
        $str7 = "kern"
        $str8 = ".dll"
        //initialize DLL
        $hex_str1 = { 8b 47 28 85 c0 0f 84 13 00 00 00 53 6a 01 56 03 c6 ff d0 85 c0 0f 84 0e 0e 00 00 89 5f 28 8b 47 78 85 c0 0f 84 fd 0d 00 00 39 5f 7c 0f 84 f4 0d 00 00 8d 3c 30 39 5f 14 0f 86 e8 0c 00 00 8b 47 24 8b d3 8b 4f 20 03 c6 89 45 d0 03 ce 8b 47 1c 6a 44 03 c6 89 4d f4 83 7f 18 00 89 45 b8 58 6a 6c 88 45 a4 e9 43 fa ff ff }
        //calculate entrypoint
        $hex_str2 = { 8b 04 24 52 0f ca 66 99 9c 53 03 da 50 c1 c8 00 42 51 fe cd c1 f9 03 8d 93 3a 9a ff ff 66 b8 ab 00 52 37 f5 66 f7 d8 66 98 33 d2 b8 42 58 00 00 b9 7b 5e 00 00 f7 f1 66 48 02 cf 90 27 52 0f ba e1 06 40 22 fd 8b 5c 24 10 8b 4c 24 08 66 23 c2 f6 c3 aa 5a 8b 54 24 14 d4 0a 52 66 40 66 48 66 98 8b 44 24 0c 84 d7 53 8b 5c 24 18 53 9d 5b 8d 64 24 1c 8d 64 24 04 6a 6e 88 45 a7 58 6a 72 88 45 a8 58 c6 45 a9 74 88 45 aa c6 45 ab 79 88 5d ac 0f 86 e8 21 00 00 }
        //move header data
        $hex_str3 = { ff d6 89 45 f0 85 c0 0f 84 fe 27 00 00 6a 10 59 8b f8 8d b5 10 f9 ff ff f3 a5 8b 50 3c 8d b5 18 f8 ff ff 03 d0 6a 3e 59 8b fa 89 55 f8 f3 a5 8b 4d d8 8d 82 f8 00 00 00 89 45 c0 85 c9 0f 84 4e 00 00 00 29 45 e8 8b d0 8b 45 e8 8b d9 8d 34 10 e9 20 00 00 00 }
        $hex_str4 = { 8b fa 6a 0a 59 83 c2 28 f3 a5 83 eb 01 0f 85 c5 ff ff ff 8b 55 f8 8b 45 c0 8b 4d d8 }
        //move decrypted data
        $hex_str5 = { 8a 85 50 fa ff ff fe c0 88 85 50 fa ff ff 0f b6 d0 8a 85 51 fa ff ff 02 84 15 50 f9 ff ff 88 85 51 fa ff ff 8a 8c 15 50 f9 ff ff 0f b6 c0 8a 84 05 50 f9 ff ff 88 84 15 50 f9 ff ff 0f b6 85 51 fa ff ff 88 8c 05 50 f9 ff ff 0f b6 85 51 fa ff ff 0f b6 8d 50 fa ff ff 8a 84 05 50 f9 ff ff 02 84 0d 50 f9 ff ff 0f b6 c0 0f b6 84 05 50 f9 ff ff e9 4e 18 00 00 }
        //post unpacking - call unpacked dll using LoadLibrary
        $hex_str6 = { 68 00 10 00 00 ff 72 f8 8d 64 24 fc 8d 64 24 e4 53 9c f8 52 66 f7 d2 50 2f 8b 04 24 89 44 24 28 5a b8 22 58 00 00 51 b9 4c 6e 00 00 f7 e1 f5 99 90 66 33 d2 66 b8 50 89 66 b9 8d 84 66 f7 f1 53 66 f7 d3 8b 1c 24 90 66 f7 d0 42 f7 d9 99 8b 44 24 2c 8b 54 24 08 f5 8b 4c 24 0c 51 9d 0f c9 8b 4c 24 04 8d 64 24 30 89 0c 24 ff 55 cc 89 45 c8 85 c0 e9 57 f7 ff ff 3b 57 18 0f 83 cf 00 00 00 8b 4d f4 e9 df de ff ff 8b 45 d0 8b 4d b8 8d 64 24 fc 9c 50 d4 0a 52 66 f7 d2 40 4a 8d 64 24 fc 9c 50 d4 0a 53 51 02 cf 52 99 51 f5 f8 f8 99 59 81 f2 b5 03 00 00 8b c8 66 98 43 f6 d0 52 9f 86 fa 0f bc c3 d4 0a 0f ba f9 03 c0 e0 00 5a 8b 14 24 c0 e4 05 8b 44 24 0c 0f c9 8b 4c 24 04 f7 d3 8b 5c 24 08 f9 53 8b 5c 24 14 53 9d 5b 8d 64 24 14 89 1c 24 51 f6 d9 8d 8a 6c 50 00 00 50 d1 c0 f8 0f c8 f7 da 0f c1 c8 8b 4c 24 04 53 fe c7 8b 1c 24 99 c1 f8 02 90 d5 0a 8b 44 24 14 5a 53 66 99 52 51 42 8b 54 24 18 f5 53 8b 5c 24 24 53 9d 5b 8d 64 24 24 89 1c 24 0f b7 04 50 8b 04 81 8d 4d b4 51 56 03 c6 88 5d b4 53 88 5d b5 ff d0 }
    condition:
        all of them
}

rule CrowdStrike_CSA_200751_01 : checkupdatedownloader downloader labyrinth_chollima 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects the format string and user agent found in LABYRINTH CHOLLIMA MacOS and Windows Downloaders"
        reports = "CSA-200751"
        version = "202006291331"
        last_modified = "2020-06-29"
        actor = "LABYRINTH CHOLLIMA"
        malware_family = "CheckUpdateDownloader"
    strings:
        $ = "ver=%d&timestamp=%l"
        $ = "(Check Update " wide ascii
    condition:
        all of them
}

rule CrowdStrike_CSA_200751_02 : labyrinth_chollima macos manuscrypt 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects HTTP header artefacts used in MacOS variant of Manuscrypt for C2 communications"
        reports = "CSA-200751"
        version = "202006120756"
        last_modified = "2020-06-12"
        actor = "LABYRINTH CHOLLIMA"
        malware_family = "Manuscrypt"
    strings:
        $ = "--N9dLfqxHNUUw8qaUPqggVTpX-"
        $ = "--%s%sContent-Disposition: form-data; name=\"uid\"%s%s%u%s"
    condition:
        all of them
}

rule CrowdStrike_CSIT_21008_01 : celestialtorrent finalsea kitten rat unid 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects strings used for 2020 version of FinalSea implant"
        reports = "CSIT-21008"
        version = "202104091136"
        last_modified = "2021-04-09"
        actor = "CelestialTorrent"
        malware_family = "FinalSea"
        activity_cluster = "CelestialTorrent"
    strings:
        $ = "FinalRatC" ascii
        $ = "ReqD" ascii
        $ = "ResD" ascii
        $ = "NameValue" ascii
        $ = "FileValue" ascii
        $ = "b.php" wide ascii
        $ = "cmd.exe" wide ascii
        $ = "getnew=1&token=" wide ascii
        $ = "sendresult=1&token=" wide ascii
        $ = "CFE18DDE5.tmp" wide ascii
    condition:
        7 of them
}

rule CrowdStrike_CSIT_21008_02 : celestialtorrent finalsea kitten rat unid 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects strings used for 2019 version of FinalSea implant"
        reports = "CSIT-21008"
        version = "202104091136"
        last_modified = "2021-04-09"
        actor = "CelestialTorrent"
        malware_family = "FinalSea"
        activity_cluster = "CelestialTorrent"
    strings:
        $ = "abcdabcdabcdabcdabcdabcdabcdabcd" ascii
        $ = "abcdefghabcdefgh" ascii
        $ = "rtt.php?token=" ascii
        $ = "rt.php?token=" ascii
        $ = "furl.dat" ascii
        $ = "2538172538172365127356" ascii
        $ = "Encrr" ascii
        $ = "RAT1" ascii
        $ = "ProjectInstaller" ascii
        $ = "RatService2" ascii
        $ = "Rijndael" ascii
    condition:
        7 of them
}

rule CrowdStrike_CSIT_20132_02 : implant moriagent rat static_kitten 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects obfuscated strings used to handle C2 socket for STATIC KITTEN implant MoriAgent"
        reports = "CSIT-20132"
        version = "202007311738"
        last_modified = "2020-07-31"
        actor = "STATIC KITTEN"
        malware_family = "MoriAgent"
    strings:
        $ = "|x7d873iqq" wide ascii              //ws2_32.dll
        $ = "ljyfiiwnskt" wide ascii             //getaddrinfo
        $ = "htssjhy" wide ascii                 //connect
        $ = "kwjjfiiwnskt" wide ascii            //freeaddrinfo
        $ = "xjsi" wide ascii                    //send
        $ = "wjh{" wide ascii                    //recv
        $ = "hqtxjxthpjy" wide ascii             //closesocket
        $ = "WinHttpGetIEProxyConfigForCurrentUser" wide ascii
        $ = "WINHTTP.dll" wide ascii
        $ = "Content-Type: application/json" wide ascii
    condition:
        all of them
}

rule CrowdStrike_CSIT_20132_03 : implant moriagent static_kitten 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects x86 code used for strings deobfuscation in MoriAgent adjacent implant"
        reports = "CSIT-20132"
        version = "202007311738"
        last_modified = "2020-07-31"
        actor = "STATIC KITTEN"
        malware_family = "MoriAgent"
        /*
        DISASSEMBLY:
        mov     ebx, [esi+14h]
        mov     eax, ebx
        mov     cl, [edi]
        mov     edx, [esi+10h]
        sub     cl, 5
        sub     eax, edx
        mov     byte ptr [ebp+var_11], cl
        cmp     eax, 1
        jb      short loc_405D50
        lea     eax, [edx+1]
        mov     [esi+10h], eax
        mov     eax, esi
        cmp     ebx, 10h
        jb      short loc_405D46
        mov     eax, [esi]
        mov     [eax+edx], cl
        mov     byte ptr [eax+edx+1], 0
        jmp     short loc_405D66
        push    1; size_t
        lea     eax, [ebp+var_11]
        mov     byte ptr [ebp+var_20], 0
        push    eax; int
        push    [ebp+var_20]; int
        mov     ecx, esi; Src
        push    1; int
        call    sub_405A30
        */
    strings:
        $hex_string = { 8b ?? ??
        8b c3
        8a ??
        8b ?? ??
        80 e9 05
        2b c2
        88 ?? ??
        83 f8 01
        72 ??
        8d ?? ??
        89 ?? ??
        8b c6
        83 fb 10
        72 ??
        8b ??
        88 ?? ??
        c6 ?? ?? ?? ??
        eb ??
        6a 01
        8d ?? ??
        c6 ?? ?? ??
        50
        ff ?? ??
        8b ce
        6a 01
        e8 ?? ?? ?? ?? }
    condition:
        $hex_string
}

rule CrowdStrike_CSIT_20132_04 : implant moriagent static_kitten 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects x86 code used for string deobfuscation in operational and development version of MoriAgent implant"
        reports = "CSIT-20132"
        version = "202007311654"
        last_modified = "2020-07-31"
        actor = "STATIC KITTEN"
        malware_family = "MoriAgent"
    strings:
        // Operational Version
        $ = { 48 ?? ?? ?? 48 03 f9 48 3b df 0f ?? ?? ?? ?? ?? 66 ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? 0f ?? ?? 80 ea 05 88 ?? ?? ?? 4c ?? ?? ?? 49 83 f8 10 72 ?? 48 ?? ?? eb ??}
        // Development Version
        $ = { 0f ?? ?? 41 2a cf 88 ?? ?? ?? 48 ?? ?? ?? 4c ?? ?? ?? 49 8b c0 48 2b c2 48 83 f8 01 72 ?? 48 ?? ?? ?? 48 ?? ?? ?? 48 8b c3 49 83 f8 10 72 ?? 48 ?? ??}
    condition:
        any of them
}

rule CrowdStrike_CSIT_20132_05 : implant moriagent static_kitten 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects strings used for code signing certificate used with operational versions of MoriAgent"
        reports = "CSIT-20132"
        version = "202007311726"
        last_modified = "2020-07-31"
        actor = "STATIC KITTEN"
        malware_family = "MoriAgent"
    strings:
        $ = "191230134700Z" ascii
        $ = "200328235900Z" ascii
        $ = "FML@NFC.com" ascii
    condition:
        any of them
}

rule CrowdStrike_CSIT_20132_06 : implant moriagent static_kitten 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects custom base64 tables used in operational and development versions of MoriAgent"
        reports = "CSIT-20132"
        version = "202007311727"
        last_modified = "2020-07-31"
        actor = "STATIC KITTEN"
        malware_family = "MoriAgent"
    strings:
        $ = "Jm3QkjRpMF2K+Gbvco1XhCIANfwua7WY9EtxgHlTzOZV48P6qDSnBri5ydLe0s/U" wide ascii
        // Stack String
        // B ~YcAyxX!U^eqT8K"|pRZP{fdu]JD$rkgV*G[tEI\i%C+'}@Wb&zaQv_wj
        $ = {
        c7 45 ?? 59 7e 20 42
        c7 45 ?? 78 79 41 63
        c7 45 ?? 5e 55 21 58
        c7 45 ?? 38 54 71 65
        c7 45 ?? 70 7c 22 4b
        c7 45 ?? 7b 50 5a 52
        c7 45 ?? 5d 75 64 66
        c7 45 ?? 72 24 44 4a
        c7 45 ?? 2a 56 67 6b
        c7 45 ?? 74 5b 7f 47
        c7 45 ?? 69 5c 49 45
        c7 45 ?? 27 2b 43 25
        c7 45 ?? 62 57 40 7d
        c7 45 ?? 51 61 7a 26
        c7 45 ?? 6a 77 5f 76
        c7 45 ?? 23 60 3c 46
        }
        $ = "B ~YcAyxX!U^eqT8K\"|pRZP{fdu]JD$rkgV*G[tEI\\i%C+'}@Wb&zaQv_wj" wide ascii
    condition:
        any of them
}

rule CrowdStrike_CSIT_20132_01 : implant moriagent static_kitten 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects strings used in STATIC KITTEN MoriAgent implant"
        reports = "CSIT-20132"
        version = "202007311736"
        last_modified = "2020-07-31"
        actor = "STATIC KITTEN"
        malware_family = "MoriAgent"
    strings:
        $ = "HTTP/1.1" wide ascii
        $ = "POST" wide ascii
        $ = "SOfTWARE\\NFC\\" wide ascii
        $ = "ERROR: Can not get File From Server" wide ascii
        $ = "ERROR: Temp File is not reachable!" wide ascii
        $ = "ERROR: Hash is not the same!" wide ascii
        $ = "ERROR: Can not Decode File!" wide ascii
        $ = "ERROR: File is not reachable!" wide ascii
        $ = "ERROR: Can not send file to server!" wide ascii
        $ = "0x50504060" wide ascii
        $ = "TType" wide ascii
        $ = "TPath" wide ascii
        $ = "TFileid" wide ascii
        $ = "THash" wide ascii
        $ = "TSize" wide ascii
        $ = "TCommand" wide ascii
        $ = "TTimeout" wide ascii
        $ = "TFilter" wide ascii
        $ = "TData" wide ascii
    condition:
        uint16(0) == 0x5a4d and 12 of them
}

rule CrowdStrike_CSIT_20126_02 : dropper phishing primitive_bear vbscript 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects an obfuscated form of VBA macros used by PRIMITIVE BEAR"
        reports = "CSIT-20126"
        version = "202007240808"
        last_modified = "2020-07-24"
        actor = "PRIMITIVE BEAR"
    strings:
        $beginsub = /(Public|Private) (Function|Sub)/ ascii wide
        $endsub = /End (Sub|Function)/ ascii wide
        $pattern = /\n[a-zA-Z]{11}\s?=\s?[a-zA-Z]{11}\s?\+\s?\([a-zA-Z]{11}\s?\(\s?"[0-9:$]{32,}"\)\)/ ascii wide
        $vbcrlf = "vbCrLf" wide ascii
    condition:
        all of them and
        filesize < 200KB and
        #pattern > 10 and
        #vbcrlf > 10
}

rule CrowdStrike_CSIT_20112_01 : chinoxy loader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects an instance of Chinoxy loader"
        reports = "CSIT-20112"
        version = "202101291830"
        last_modified = "2021-01-29"
        malware_family = "Chinoxy"
    strings:
        $ = "ghherbber.tmp" wide ascii
        $ = "CoCreateInstance"
        $ = "TYPELIB" wide
    condition:
        all of them
}

rule CrowdStrike_CSIT_20112_02 : chinoxy rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects an instance of Chinoxy RAT"
        reports = "CSIT-20112"
        version = "202102230135"
        last_modified = "2021-02-23"
        malware_family = "Chinoxy"
    strings:
        $1 = "Set-Cookie: %u%s%s"
        $2 = "%s %s%s/%s/%08X%08X/%u/%u/%u/%u/%u/%u/%08X%08x HTTP/1.1"
        $3 = "SocketInfo::OnPacketReceived() Error code: %d BytesTransfered: %u [Continue receiving]"
        $4 = "AVCriSec@@"
        $5 = "AVCriSecDbg@@"
    condition:
        2 of them
}

rule CrowdStrike_CSIT_20126_03 : macro phishing primitive_bear 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects an obfuscated form of VBA macro used by PRIMITIVE BEAR"
        reports = "CSIT-20126"
        version = "202007240808"
        last_modified = "2020-07-24"
        actor = "PRIMITIVE BEAR"
    strings:
        $p = "& vbCrLf" wide ascii
        $c = "\"Ex\" + \"\" + \"ec\" + \"ut\" + \"e\"" wide ascii
    condition:
        $c and
        #p > 20 and
        filesize < 200KB
}

rule CrowdStrike_CSIT_20146_01 : avaddon ransomware 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects the Avaddon ransomware."
        reports = "CSIT-20146"
        version = "202011271827"
        last_modified = "2020-11-27"
        malware_family = "Avaddon"
    strings:
        $crypt = { 8A 06 8B 55 E4 2C 02 8B 7D E8 34 43 88 45 D0 3B D7 }
        $IID_Class_A = "UANEventDropNote"
        $IID_Class_B = "UANEventGetPublicKey"
    condition:
        $crypt or ($IID_Class_A and $IID_Class_B)
}

rule CrowdStrike_CSIT_20123_02 : dotnet ecrime valak 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects the string patterns of the PluginHost component used by Valak"
        reports = "CSIT-20123"
        version = "202007101311"
        last_modified = "2020-07-10"
        malware_family = "Valak"
    strings:
        $ = "PluginHost" ascii wide fullword
        $ = "ManagedPlugin.ManagedPlugin" wide fullword
        $ = "&VDImon=" wide
        $ = "&dfc={0}" wide
        $ = "GetC2" fullword
        $ = "GetPluginBytes" fullword
        $ = "RegistryReadInfo" fullword
    condition:
        uint16(0) == 0x5A4D and
        4 of them
}

rule CrowdStrike_vjw0rm_01 : rat vjw0rm worm 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects the vjw0rm RAT based on characteristic strings"
        version = "202006190727"
        last_modified = "2020-06-19"
        malware_family = "vjw0rm"
    strings:
        $str1 = "vjw0rm"
        $str2 = "%RgNe%"
        $str3 = "%sfdr"
        $str4 = /["']\|V\|["']/
        $link = /https?:\/\//
        $cmd1 = /['"]Cl['"]/
        $cmd2 = /['"]Sc['"]/
        $cmd3 = /['"]Ex['"]/
        $cmd4 = /['"]Rn['"]/
        $cmd5 = /['"]Up['"]/
        $cmd6 = /['"]Un['"]/
        $cmd7 = /['"]RF['"]/
    condition:
        2 of ($str*) and
        6 of ($cmd*) and
        $link and
        filesize < 100KB
}

rule CrowdStrike_CSIT_20126_04 : artefact lnk phishing primitive_bear 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects a hardcoded SID from PRIMITIVE BEAR shortcut LNKs sent in phishing emails"
        reports = "CSIT-20126"
        version = "202103291610"
        last_modified = "2021-03-29"
        actor = "PRIMITIVE BEAR"
    strings:
        $sid_01 = "S-1-5-21-4172252760-1270819298-3976368389-1001" ascii wide
        $sid_02 = "S-1-5-21-4062856068-233413301-215052903-1001" ascii wide
    condition:
        any of them
}

rule CrowdStrike_CSIT_20126_05 : artefact lnk phishing primitive_bear 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects hardcoded timestamps from PRIMITIVE BEAR shortcut LNKs sent in phishing emails"
        reports = "CSIT-20126"
        version = "202103291613"
        last_modified = "2021-03-29"
        actor = "PRIMITIVE BEAR"
    strings:
        $ts_01 = { 7c f2 12 d2 ad ea d5 01 }
        $ts_02 = { a0 ef 50 d2 ad ea d5 01 }
        $ts_03 = { 36 b7 28 0e de ac d5 01 }
        $ts_04 = { 69 9f 96 cf 6e d0 d6 01 }
    condition:
        for any of ($ts_*) : ( $ at 0x1c or $ at 0x24 or $ at 0x2c  )
}

rule CrowdStrike_CSIT_20126_07 : artefact lnk phishing primitive_bear 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects the TrackerDataBlock left behind by PRIMITIVE BEAR in their LNK files"
        reports = "CSIT-20126"
        version = "202007240808"
        last_modified = "2020-07-24"
        actor = "PRIMITIVE BEAR"
    strings:
        $data_01 = { 60 00 00 00 03 00 00 a0 58 00 00 00 00 00 00 00 a0 a4 ac a8 ad 2d af aa 00 00 00 00 00 00 00 00 68 8f d0 cf 56 58 c6 45 a1 60 ad 62 a5 83 55 c4 ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? 08 00 27 ba 4c bc 68 8f d0 cf 56 58 c6 45 a1 60 ad 62 a5 83 55 c4 ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? 08 00 27 ba 4c bc }
    condition:
        any of them
}

rule CrowdStrike_CSA_200869_02 : loader salve trojan 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects the second-stage loader of Salve banking trojan"
        reports = "CSA-200869"
        version = "202008270710"
        last_modified = "2020-08-27"
        malware_family = "Salve"
    strings:
        $ = { FF (B5|75) [1-4] 68 [4] B8 [4] BA 05 00 00 00 E8 }
        $ = { 0F [3] C1 E8 08 8B 55 ?? 32 02 8B 55 ?? 88 02 8B 45 ?? 8A 00 02 45 ?? 25 FF 00 00 00 66 [3] 66 [3] 66 [3] FF [2] FF [2] FF [2] FF [2] 75 }
    condition:
        all of them
}

rule CrowdStrike_CSIT_20120_02 : loader mosquito venomous_bear 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects hook function for 32-bit and 64-bit versions of the Mosquito Loader."
        reports = "CSIT-20120"
        version = "202101291829"
        last_modified = "2021-01-29"
        actor = "VENOMOUS BEAR"
        malware_family = "Mosquito"
    strings:
        $sub_10004237  = { 8b d0 52 ff d1 5a 50 }
    condition:
        any of them
}

rule CrowdStrike_CSIT_20239_04 : proxip wicked_panda 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects the Proxip malware"
        reports = "CSIT-20239"
        version = "202102051109"
        last_modified = "2021-02-05"
        actor = "WICKED PANDA"
        malware_family = "Proxip"
    strings:
        $ = { (c7|b8) [1-6] 6f 6b 31 32 }
        $ = { (c7|b8) [1-6] 33 34 0a 00 }
    condition:
        filesize < 700KB and
        all of them
}

rule CrowdStrike_CSIT_20239_01 : rat routergod wicked_panda 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects distinctive strings in packed instances of RouterGod"
        reports = "CSIT-20239"
        version = "202102051108"
        last_modified = "2021-02-05"
        actor = "WICKED PANDA"
        malware_family = "RouterGod"
    strings:
        $ = "RouterGodOffline"
        $ = "Funny.Connector"
    condition:
        uint16(0)==0x5a4d and
        filesize < 2MB and
        any of them
}

rule CrowdStrike_CSIT_20239_03 : certificate wicked_panda 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects certificate from 2015 inserted into various WICKED PANDA related samples in 2020 "
        reports = "CSIT-20239"
        version = "202102051109"
        last_modified = "2021-02-05"
        actor = "WICKED PANDA"
    strings:
        $ = "ZEALOT DIGITAL"
        $ = "150820074353Z"
        $ = "160919074"
    condition:
        all of them
}

rule CrowdStrike_ProstoClipper_01 : clipper prostoclipper stealer 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects the ProstoClipper stealer based on characteristic strings"
        version = "202006260655"
        last_modified = "2020-06-26"
        malware_family = "ProstoClipper"
    strings:
        $dn1 = "BSJB"
        $dn2 = "#Strings"
        $regex01 = "(^(1|3)(?=.*[0-9])(?=.*[a-zA-Z])[\\da-zA-Z]{27,34}?[\\d\\- ])|(^(1|3)(?=.*[0-9])(?=.*[a-zA-Z])[\\da-zA-Z]{27,34})$" wide
        $regex02 = "(^(GD|GC)[A-Z0-9]{54,56}?[\\d\\- ])|(^(GD|GC)[A-Z0-9]{54,56})$" wide
        $regex03 = "(^(T[A-Z])[A-Za-z0-9]{32,35}?[\\d\\- ])|(^(T[A-Z])[A-Za-z0-9]{32,35})$" wide
        $regex04 = "(^0x[A-Za-z0-9]{40,40}?[\\d\\- ])|(^0x[A-Za-z0-9]{40,40})$" wide
        $regex05 = "(^A[A-Za-z0-9]{32,34}?[\\d\\- ])|(^A[A-Za-z0-9]{32,34})$" wide
        $regex06 = "(^D[A-Za-z0-9]{32,35}?[\\d\\- ])|(^D[A-Za-z0-9]{32,35})$" wide
        $regex07 = "(^G[A-Za-z0-9]{32,35}?[\\d\\- ])|(^G[A-Za-z0-9]{32,35})$" wide
        $regex08 = "(^L[A-Za-z0-9]{32,34}?[\\d\\- ])|(^L[A-Za-z0-9]{32,34})$" wide
        $regex09 = "(^q[A-Za-z0-9\\:]{32,54}?[\\d\\- ])|(^q[A-Za-z0-9\\:]{32,54})$" wide
        $regex10 = "(^r[A-Za-z0-9]{32,34}?[\\d\\- ])|(^r[A-Za-z0-9]{32,34})$" wide
        $regex11 = "(^t[A-Za-z0-9]{32,36}?[\\d\\- ])|(^t[A-Za-z0-9]{32,36})$" wide
        $regex12 = "(^X[A-Za-z0-9]{32,34}?[\\d\\- ])|(^X[A-Za-z0-9]{32,34})$" wide
        $regex13 = "^((8|\\+7|\\+380|\\+375|\\+373)[\\- ]?)?(\\(?\\d{3}\\)?[\\- ]?)?[\\d\\- ]{7,10}$" wide
        $regex14 = "^(P|p){1}[0-9]?[\\d\\- ]{7,15}|.+@.+\\..+$" wide
        $regex15 = "^41001[0-9]?[\\d\\- ]{7,11}$" wide
        $regex16 = "^R[0-9]?[\\d\\- ]{12,13}$" wide
        $regex17 = "^Z[0-9]?[\\d\\- ]{12,13}$" wide
        $pc1 = "ProstoClipper" fullword
        $pc2 = "[antivm]" wide
        $pc3 = "[Kill]" wide
        $pc4 = "[StartUp]" wide
        $ctype01 = "QIWI" fullword
        $ctype02 = "BTC" fullword
        $ctype03 = "LTC" fullword
        $ctype04 = "BCH" fullword
        $ctype05 = "PAY" fullword
        $ctype06 = "ETHEREUM" fullword
        $ctype07 = "DASH" fullword
        $ctype08 = "YANDEX_MONEY" fullword
        $ctype09 = "WMR" fullword
        $ctype10 = "WMZ" fullword
        $ctype11 = "XLM" fullword
        $ctype12 = "NEO" fullword
        $ctype13 = "ZCASH" fullword
        $ctype14 = "XPR" fullword
        $ctype15 = "BTG" fullword
        $ctype16 = "DOGE" fullword
        $ctype17 = "TRX" fullword
        $ctype18 = "STEAMTRADE_LINK" fullword
    condition:
        all of ($dn*)
        and 2 of ($pc*)
        and (
        10 of ($regex*) and 10 of ($ctype*)
        or 14 of ($regex*)
        or 14 of ($ctype*)
        or $pc1 and 5 of ($ctype*)
        or $pc1 and 1 of ($regex*)
        )
}

rule CrowdStrike_CSA_200813_01 : carbon venomous_bear 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "C2 module with rendezvous support of VENOMOUS BEAR's Carbon malware"
        reports = "CSA-200813"
        version = "202006260654"
        last_modified = "2020-06-26"
        actor = "VENOMOUS BEAR"
        malware_family = "Carbon"
    strings:
        $rsapubkeyhdr = { 06 02 00 00 00 a4 00 00 52 53 41 31 00 04 00 00 01 00 01 00 }
        $rsaprivkeyhdr = { 07 02 00 00 00 a4 00 00 52 53 41 32 00 04 00 00 01 00 01 00 03 66 00 00 54 02 00 00 94 00 00 00 80 00 00 00 80 00 00 00 }
        $castkeyfrag1 = { 12 34 56 78 c7 }
        $castkeyfrag2 = { 9a bc de f0 c7 }
        $rplogprefix = "RSRR"
    condition:
        all of them
}

rule CrowdStrike_CSIT_20120_03 : implant mosquito venomous_bear 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects distinct code from the Blum Blum Shub next() function in Mosquito's final payload and several Mosquito installers."
        reports = "CSIT-20120"
        version = "202101291829"
        last_modified = "2021-01-29"
        actor = "VENOMOUS BEAR"
        malware_family = "Mosquito"
    strings:
        $bytes_0x100011fa_0x1000122a  = { 8b c1 83 e0 08 33 d2 0b c2 74 ?? 80 4c 24 13 20 8b c1 83 e0 20 33 d2 0b c2 74 ?? 80 4c 24 13 40 8b c1 83 e0 04 33 d2 0b c2 74 ?? 80 4c 24 13 80 }
        $bytes_0x100026e6_0x1000271e  = { 8b c2 83 e0 08 83 c8 00 74 09 8d ?? ff b0 01 d2 e0 0a d8 8b c2 83 e0 20 83 c8 00 74 08 b0 01 8b ?? d2 e0 0a d8 8b c2 83 e0 04 83 c8 00 74 09 8d ?? 01 b0 01 d2 e0 0a d8 }
        $bytes_0x10001bdc_0x10001c12  = { 8b c2 83 e0 08 83 c8 00 74 ?? 0f b6 db 8d 47 ff 0f ab c3 8b c2 83 e0 20 83 c8 00 74 ?? 0f b6 db 0f ab fb 8b c2 83 e0 04 83 c8 00 74 ?? 0f b6 db 8d 47 01 0f ab c3 }
    condition:
        any of them
}

rule CrowdStrike_CSIT_20128_03 : capriccio rat razor_tiger 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects SystemApp.dll used by RAZOR TIGER Capriccio"
        reports = "CSIT-20128"
        version = "202009041502"
        last_modified = "2020-09-04"
        actor = "RAZOR TIGER"
        malware_family = "Capriccio"
        reports = "CSIT-20128"
    strings:
        $str1 = "Newtonsoft.Json"
        $str2 = "CreateInstance"
        $str3 = "GZipStream"
        $str4 = "shell32.dll"
        $str5 = "SystemApp.dll"
    condition:
        uint16(0) == 0x5a4d and all of them
}

rule CrowdStrike_CSIT_20129_01 : conti ecrime ransomware wizard_spider 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects Conti ransomware used by WIZARD SPIDER"
        reports = "CSIT-20129"
        version = "202103091245"
        last_modified = "2021-03-09"
        actor = "WIZARD SPIDER"
        malware_family = "ContiRansomware"
    strings:
        $str_1 = ".CONTI" wide
        $str_2 = ".GURAC" wide
        $str_3 = ".LOCK" wide
        $str_4 = "CONTI_README.txt" wide
        $str_5 = "HOW_TO_DECRYPT.txt" wide
        $str_6 = "winnt" wide
        $asm_io1 = { 8b 73 ?? 83 e6 f0 2b 73 ?? 1b ff 81 c6 34 02 00 00 13 f9 }
        $asm_io2 = { 8b d9 83 e3 f0 2b d9 1b ff 81 c3 34 02 00 00 83 d7 00}
        $asm_io3 = { ff 15 [4] 85 c0 74 ?? 81 7d ?? 0c 02 00 00 75 ?? 6a 00 6a 00 6a 00 ff 76 ?? ff 15 }
        $asm_io4 = { bb 24 02 00 00 33 ff eb ?? 8b d9 83 e3 f0 2b d9 1b ff 81 c3 34 02 00 00 }
        $asm_io5 = { 6a 02 53 57 68 ec fd ff ff ff 76 ?? ff 15 }
        $asm_io6 = { 6a 02 6a 00 6a ff 68 ec fd ff ff ff 76 ?? ff 15 }
        $asm_advobfus = { 99 f7 fb 8d 42 ?? 99 f7 fb 88 54 [3] 83 }
        $asm_chaconst = { c7 [2] 65 78 70 61 c7 [2] 6e 64 20 33 c7 [2] 32 2d 62 79 c7 [2] 74 65 20 6b }
        $asm_chakeygen1 = { 8d [3] 6a 20 ff 75 ?? ff 15 [4] 85 c0 0f 84 [4] 8d [3] 6a 08 ff 75 ?? ff 15 [4] 85 c0 }
        $asm_chakeygen2 = { 68 67 0a cb ab ba [4] 89 [2] c7 45 ?? 28 00 00 00 e8 [4] 83 c4 08 8d 7b [2-8] ff d0 85 c0 }
        $asm_callimpkey = { 6a 00 6a 00 68 00 10 00 00 68 [4] 56 ff d0 85 c0 }
        $asm_murmur1 = { bf 2d 5b 00 00 83 fe 04 7c ?? 8b c3 f7 d8 8d 34 86 [1-14] 69 0a 95 e9 d1 5b }
        $asm_murmur2 = { 69 0a 95 e9 d1 5b 83 c2 04 69 ff 95 e9 d1 5b 8b c1 c1 e8 18 33 c1 69 c8 95 e9 d1 5b }
        $asm_valloc5mb = { 6a 04 68 00 30 00 00 68 00 00 50 00 6a 00 ff (d0 | 15) }
    condition:
        filesize < 500KB and
        uint16(0) == 0x5a4d and
        (3 of ($str_*) or 4 of ($asm_*))
}

rule CrowdStrike_CSIT_20123_01 : ecrime javascript valak 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects unobfuscated and obfuscated Valak Installer and Handler components"
        reports = "CSIT-20123"
        version = "202007291430"
        last_modified = "2020-07-29"
        malware_family = "Valak"
    strings:
        $pattern_generic1 = /\s+\w+\s{0,1}:\s{0,1}\[('https?:\/\/[\w\.\-]+'\,?){3,}\]/
        $pattern_installer1 = /(\s+\w+\s{0,1}:\s{0,1}2[01]\,(\s+\/\/[^\r\n]+)*){2}/
        $pattern_installer2 = /\s+\w+\s{0,1}:\s{0,1}2[01]\,(\s+\/\/[^\r\n]+)*\s+\w+\s{0,1}:\s{0,1}'\w{4,10}'\,/
        $pattern_handler1 = /\s+\w+\s{0,1}:\s{0,1}'[0-9A-F]{32}'\,(\s+\/\/[^\r\n]+)*\s+\w+\s{0,1}:\s{0,1}20\,/
        $pattern_handler2 = /\s+\w+\s{0,1}:\s{0,1}[31]\,(\s+\/\/[^\r\n]+)*\s+\w+\s{0,1}:\s{0,1}'\w{4,10}'\,/
        $str_hash_const1 = " = 0xdeadbeef;"
        $str_hash_const2 = "2654435761);"
        $str_client = "<<<CLIENT__" fullword
        $str_uptime = "Uptime <= 3000" fullword
        $str_delim = "&_(^^<,&+<*)+*-=_^,(<>!,*!%&-@!<"
        $str_delim1 = "???00R44t0ubwGppvdr%%"
        $str_task1 = "(\"--TASK\") !== -1"
        $str_task2 = "('--TASK') !== -1"
        $str_plugin1 = "(\"--PLUGIN\") !== -1"
        $str_plugin2 = "('--PLUGIN') !== -1"
        $str_ads = ".concat(\":\")"
        $str_bin = ".concat(\".bin\")"
    condition:
        filesize < 100KB and 2 of ($pattern*) and 4 of ($str*)
}

rule CrowdStrike_CSIT_20121_01 : credential_dumper credential_theft helix_kitten valuevault 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects HELIX KITTEN VALUEVAULT through symbol names and paths"
        reports = "CSIT-20121"
        version = "202101291826"
        last_modified = "2021-01-29"
        actor = "HELIX KITTEN"
        malware_family = "VALUEVAULT"
    strings:
        $ = "main.Decrypt"
        $ = "main.NewBlob"
        $ = "main.copyFileToDirectory"
        $ = "main.checkFileExist"
        $ = "APPDATA"
        $ = "\\Chrome\\User"
        $ = "\\AppData\\Local\\Google"
        $ = "fsociety.dat"
    condition:
        all of them
}

rule CrowdStrike_HiddenTear_01 : hiddentear ransomware unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects the HiddenTear ransomware"
        version = "202007030722"
        last_modified = "2020-07-03"
        malware_family = "HiddenTear"
    strings:
        $ = "#Strings"
        $ = "BSJB"
        $ = "<RSAKeyValue><Modulus>" wide
        $ = "</Modulus><Exponent>AQAB</Exponent></RSAKeyValue>" wide
        $ = "EncryptRSA"
        $ = "CreatePassword"
        $ = "encryptDirectory"
    condition:
        all of them
}

rule CrowdStrike_CSIT_21003_01 : ambit downloader ocean_buffalo sfx 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects SFX files attributed to OCEAN BUFFALO and deliver Ambit downloader"
        reports = "CSIT-21003"
        version = "202101291825"
        last_modified = "2021-01-29"
        actor = "OCEAN BUFFALO"
        malware_family = "Ambit"
    strings:
        $ = "sfxzip.pdb"
        $ = ".exe"
        $ = ".dll"
        $ = ".locale"
        $ = "SoftwareUpdateFilesLocalized.dll"
    condition:
        all of them and filesize < 5MB
}

rule CrowdStrike_CSIT_20124_02 : defray777 loader pyxie 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects dll search order hijack loader used in early stages of Defray777 and PyXie intrusion"
        reports = "CSIT-20124"
        version = "202101291829"
        last_modified = "2021-01-29"
        malware_family = "defray777"
        
    strings:
        $s1 = {C7 46 05 9C 81 74 24}
        $s2 = {66 C7 46 0E 9D C3}
        $s3 = "dll_loader.dll"
    condition:
        all of them
}

rule CrowdStrike_CSIT_20230_05 : carbon_spider domenus ecrime vbscript 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects Domenus VBS used to CARBON SPIDER to delivery various payloads."
        reports = "CSIT-20230"
        version = "202101291830"
        last_modified = "2021-01-29"
        actor = "CARBON SPIDER"
        malware_family = "Domenus"
    strings:
        $do = "Do While"
        $rem = "REM"
        $dim = "Dim"
        $replace = "= replace("
        $execute = "execute("
        $ifr = "if right("
    condition:
        filesize < 1MB and #do > 15 and #do < 70 and #rem > 15 and #rem < 70 and #dim > 70 and #dim < 225 and ( $replace or $execute or $ifr )
}

rule CrowdStrike_CSA_200860_01 : goldenspy pdb 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects a PDB string identified in GoldenSpy backdoor-like component of the Intelligent Tax software and other Intelligent Tax components."
        reports = "CSA-200860"
        version = "202106081516"
        last_modified = "2021-06-08"
    strings:
        // D:\\\VCProject\dgs\Release\BWXT.pdb
        // D:\\\VCProject\dgs\Release\del.pdb
        $ = { 44 3a 5c e6 97 a5 e5 b8 b8 e5 b7 a5 e4 bd 9c 5c e5 ae a2 e6 88 b7 e7 ab af e8 bd af e4 bb b6 5c 56 43 50 72 6f 6a 65 63 74 5c 64 67 73 5c 52 65 6c 65 61 73 65 }
        $ = "\\svm.exe -stopProtect"
        $ = "\\svmm.exe -stopProtect"
        $ = "c3ZtLmV4ZSAtc3RvcFByb3RlY3Q="
        $ = "c3ZtbS5leGUgLXN0b3BQcm90ZWN0"
    condition:
        any of them
}

rule CrowdStrike_CSA_200856_01 : cve_2020_0787 graceful_spider privilege_escalation 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Custom Windows privilege escalation tool that uses CVE-2020-0787"
        reports = "CSA-200856"
        version = "202012071449"
        last_modified = "2020-12-07"
        actor = "GRACEFUL SPIDER"
    strings:
        $tmp_str1 = "%ls%d.dat" fullword wide
        $tmp_str2 = "\\RPC Control" fullword wide
        $tmp_str3 = "\\??\\%ls" fullword wide
        $tmp_str4 = "bait\\" fullword wide
        $tmp_str5 = "C:\\%S\\" fullword wide
        $dll1 = "msfte.dll" fullword
        $dll2 = "wlanapi.dll" fullword
        $dll3 = "wlanhlp.dll" fullword
        $dll4 = "SrClient.dll" fullword
        $dll5 = "windowscoredeviceinfo.dll" fullword
        $dll6 = "wuauserv.dll" fullword
        $dll7 = "appraiser.dll" fullword
        $dll8 = "wbem\\loadperf.dll" fullword
        $dll9 = "wbem\\cryptsp.dll" fullword
        $dll10 = "wbem\\wmiclnt.dll" fullword
        $trigger1 = "Win32_QuickFixEngineering" fullword
        $trigger2 = "Win32_PerfFormattedData_PerfOS_Memory" fullword
        $trigger3 = "IsInstalled=1 and IsHidden=1 and Type='Software'" wide
        $trigger4 = "NcFreeNetconProperties" fullword
    condition:
        4 of ($tmp_str*) and 5 of ($dll*) and 2 of ($trigger*)
}

rule CrowdStrike_CSA_200869_01 : loader salve trojan 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects the first-stage loader of Salve banking trojan"
        reports = "CSA-200869"
        version = "202007101325"
        last_modified = "2020-07-10"
        malware_family = "Salve"
    strings:
        $ = { B8 ?? 00 00 00 E8 [4] 8B D0 83 C2 ?? 8D 45 ?? E8 [4] 8B 55 ?? 8B 45 ?? E8 [4] 8B 45 ?? E9 }
        $ = "TIdHTTP"
        $ = "TZipForge"
        $ = "TResourceStream"
    condition:
        all of them
}

rule CrowdStrike_CSA_200869_03 : salve trojan 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects samples of Salve banking trojan"
        reports = "CSA-200869"
        version = "202103231215"
        last_modified = "2021-03-23"
        malware_family = "Salve"
    strings:
        $decryption = { 0F B6 ?? 0F B7 [2-5] C1 E9 08 66 33 D1 }
        $obfuscation = { FF B5 [2-4] 6A 00 8D [2-5] B8 02 00 00 00 E8 }
    condition:
        $decryption and
        #obfuscation > 30
}

rule CrowdStrike_CSIT_20113_01 : mallard_spider plugin qakbot 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects the Qakbot hook plugin"
        reports = "CSIT-20113"
        version = "202102191059"
        last_modified = "2021-02-19"
        actor = "MALLARD SPIDER"
        malware_family = "Qakbot"
    strings:
        $injector_code = { 8b 4d 0c e8 [4] 24 0f 8d 58 40 e8 [4] 33 d2 6a 30 59 f7 f1 b8 f3 1f 00 00 80 ea 80 88 55 f0 e8 [4] 0f b6 4d f7 }
        $injector_res = "RES_DATA_" ascii
        // Hook plugin main
        $hook_string1 = " cookie=[" ascii fullword
        $hook_string2 = " referer=[" ascii fullword
        $hook_string3 = " url=[" ascii fullword
        $hook_string4 = " cookie=[" ascii fullword
        $hook_string5 = " app=[" ascii fullword
        $hook_string6 = " data=[" ascii fullword
        $hook_string7 = "] exe=[" ascii fullword
        $hook_string8 = "] pid=[" ascii fullword
        $hook_string9 = " p=[" ascii fullword
        $hook_string10 = "] t=[" ascii fullword
    condition:
        uint16(0) == 0x5a4d and
        (($injector_code and $injector_res) or (4 of ($hook_string*))) and
        filesize < 500KB
}

rule CrowdStrike_CSIT_14058_03 : encrypted_resource 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Pacific Panda Encrypted Resource"
        reports = "CSIT-14058"
        version = "202101291829"
        last_modified = "2021-01-29"
        in_the_wild = true
    strings:
        $encpeheader = { 65 72 78 00 2a 00 00 00 }
    condition:
        all of them
}

rule CrowdStrike_CSIT_20143_02 : ecrime lockbit ransomware 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects unpacked samples of LockBit ransomware based on strings."
        reports = "CSIT-20143"
        version = "202008141122"
        last_modified = "2020-08-14"
        malware_family = "LockBit"
    strings:
        $a1 = "LockBit"
        $b1 = "vssadmin"
        $b2 = "bcdedit"
        $b3 = "wbadmin"
        $b4 = "127.0.0.7" wide
        $b5 = "fsutil" wide
    condition:
        (uint16(0) == 0x5a4d) and $a1 and 4 of ($b*)
}

rule CrowdStrike_CSIT_20145_01 : chollima crat labyrinth_chollima rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects strings and xor decoding loops used in LABYRINTH CHOLLIMA's CRAT variants."
        reports = "CSIT-20145"
        version = "202008071506"
        last_modified = "2020-08-07"
        actor = "LABYRINTH CHOLLIMA"
        malware_family = "CRAT"
    strings:
        // common CRAT strings
        $csBuildVer = "Major=%d, Minor=%d, Build=%d, Arch=%d" wide
        $csDebugMsg0 = "DLL Loading failure" wide
        $csDebugMsg1 = "Unable to GetProcAddress of  " wide
        $csDebugMsg2 = "DLL Loader Initialize failure!" wide
        $csDebugMsg3 = "create file %s, errno = %d" wide
        // less common CRAT strings to catch more unique variants
        $cs0 = "zero_x64.dll" fullword
        $cs1 = "iAppleCloud" fullword
        $cs2 = "CloudService.exe" fullword
        $cs3 = "MozillaCloud" fullword
        $cs6 = "CratClient.dll" fullword
        $cs7 = "MaintenanceService.exe" fullword
        $cs8 = "maintenanceservice_" fullword
        $cs9 = "KeyLog_Win32_DllRelease.dll" fullword
        $csA = "KeyLog_x64_DllRelease.dll" fullword
        $csB = "ScreenCapture_Win32_DllRelease.dll" fullword
        $csC = "ScreenCapture_x64_DllRelease.dll" fullword
        $csD = "first_x64.dll" fullword
        $csE = "first_Win32.dll" fullword
        $csF = "ClipboardMonitor_x64_DllRelease.dll" fullword
        $cs10 = "ClipboardMonitor_Win32_DllRelease.dll" fullword
        $cs17 = "PackImageStore" fullword
        $cs18 = "UpgradeToPremium" fullword
        // original crat/no xor key modification
        $xorDecodeLoop64bit = {81 36 ?? ?? 2? 20 [12] 48 3B C8 7?}
        $xorDecodeLoop32bit = {81 34 ?? ?? ?? 2? 20 83 C0 04 ?? ?? ?? 7?}
        // timestamp based xor key modifier
        $xorKeyMod64bit = {31 ?? ?? ?? 81 C1 ?? ?? 2? 20 ?? 83 C0 04 ?? ?? ?? 7?}
        $xorKeyMod64bit2 = {31 ?? 81 C7 ?? ?? 2? 20 48 8D 5B 04 ?? ?? ?? 7?}
        $xorKeyMod32bit = {31 ?? ?? ?? ?? ?? ?? 83 C0 04 81 C1 ?? ?? 2? 20 ?? ?? 7?}
    condition:
        uint16(0) == 0x5a4d and filesize < 850KB and 2 of ($cs*) and 1 of ($xor*)
}

rule CrowdStrike_CSIT_20128_02 : capriccio dropper rat razor_tiger 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects dropper used in Capriccio RAT"
        reports = "CSIT-20128"
        version = "202009041501"
        last_modified = "2020-09-04"
        actor = "RAZOR TIGER"
        malware_family = "Capriccio"
        reports = "CSIT-20128"
    strings:
        $str1 = "Work"
        $str2 = "GZipStream"
        $str3 = "hijackdllname"
        $str4 = "xorIt"
        $str5 = "StInstaller"
        $str6 = "rekeywiz.exe" wide
    condition:
        uint16(0) == 0x5a4d and all of them
}

rule CrowdStrike_CSIT_20136_04 : cobravenom velvet_chollima 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects command strings and format strings used for the UID present in the Wild variant of CobraVenom"
        reports = "CSIT-20136"
        version = "202009211929"
        last_modified = "2020-09-21"
        actor = "VELVET CHOLLIMA"
        malware_family = "CobraVenom"
    strings:
        $ = "%s_tiger"
        $ = "lion"
        $ = "wolf"
        $ = "snake"
        $ = "bear"
        $ = "monkey"
        $ = "00000000"
        $ = "%02X%02X%02X%02X%02X%02X"
    condition:
        all of them
}

rule CrowdStrike_CSA_210418_01 : cobravenom velvet_chollima 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects the marker string used for encrypted files being sent or received by CobraVenom Hex-XOR variant"
        reports = "CSA-210418"
        version = "202106081534"
        last_modified = "2021-06-08"
        actor = "VELVET CHOLLIMA"
        malware_family = "CobraVenom"
    strings:
        $ = "%PDF-1.7..4 0 obj"
    condition:
        all of them and filesize < 2MB
}

rule CrowdStrike_CSA_200904_01 : cobaltstrike xmrig 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "XMRig instances with Cobalt Strike malware payloads"
        reports = "CSA-200904"
        version = "202007170756"
        last_modified = "2020-07-17"
        malware_family = "Cobalt Strike"
    strings:
        $stratumurl_prefix = "stratum+tcp://"
        $cobaltstrike_pattern = { 68 ef be 00 00 e8 c1 28 02 00 8b 0e }
    condition:
        all of them
}

rule CrowdStrike_CSIT_20136_05 : cobravenom velvet_chollima 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects the URL strings, items used for UID generation and hex XOR format string contained in CobraVenom Hex XOR variant"
        reports = "CSIT-20136"
        version = "202009211928"
        last_modified = "2020-09-21"
        actor = "VELVET CHOLLIMA"
        malware_family = "CobraVenom"
    strings:
        $url1 = "/?m=b&p1="
        $url2 = "/?m=c&p1="
        $uid1 = "00000000"
        $uid2 = "Win%d.%d.%d"
        $form = {25 78 00}
    condition:
        1 of ($url*) and 1 of ($uid*) and $form
}

rule CrowdStrike_CSIT_20113_02 : mallard_spider plugin qakbot 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects the Qakbot cookie stealer plugin"
        reports = "CSIT-20113"
        version = "202102191058"
        last_modified = "2021-02-19"
        actor = "MALLARD SPIDER"
        malware_family = "Qakbot"
    strings:
        $query1 = "SELECT encrypted_value,creation_utc,host_key,name,path,expires_utc,is_secure,is_httponly,last_access_utc,has_expires,is_persistent,priority FROM cookies"
        $query2 = "SELECT id,baseDomain,originAttributes,name,value,host,path,expiry,lastAccessed,creationTime,isSecure,isHttpOnly,inBrowserElement,sameSite FROM moz_cookies"
        $command = "esentutl.exe /r V01 /l\"%s\" /s\"%s\" /d\"%s\"" wide
        $table_name = "CookieEntryEx_%u" wide
    condition:
        uint16(0) == 0x5a4d and
        1 of them and
        filesize < 500KB
}

rule CrowdStrike_CSIT_20113_03 : mallard_spider plugin qakbot 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects the Qakbot VNC server plugin"
        reports = "CSIT-20113"
        version = "202102191058"
        last_modified = "2021-02-19"
        actor = "MALLARD SPIDER"
        malware_family = "Qakbot"
    strings:
        $command_kill = "/c TASKKILL /F /T /PID %u"
    condition:
        uint16(0) == 0x5a4d and
        $command_kill and
        filesize < 500KB
}

rule CrowdStrike_CSIT_20113_04 : mallard_spider plugin qakbot 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects the Qakbot VNC server activator plugin"
        reports = "CSIT-20113"
        version = "202102191058"
        last_modified = "2021-02-19"
        actor = "MALLARD SPIDER"
        malware_family = "Qakbot"
    strings:
        $string1 = "HehWtatsCool" wide
        $string2 = "NeverWorse" wide
        $dll1 = "vncdll64.dll"
        $dll2 = "vncdll32.dll"
        $func1 = "VncStartServer"
        $func2 = "VncStopServer"
    condition:
        uint16(0) == 0x5a4d and
        (
        $string1 or
        $string2 or
        (($func1 or $func2) and ($dll1 or $dll2))
        ) and
        filesize < 500KB
}

rule CrowdStrike_CSIT_20136_03 : cobravenom rat velvet_chollima 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects the format strings, UID components and boundary string used in HTTP POST requests within CobraVenom plaintext variant"
        reports = "CSIT-20136"
        version = "202009211930"
        last_modified = "2020-09-21"
        actor = "VELVET CHOLLIMA"
        malware_family = "CobraVenom"
    strings:
        $fn1 = "%s::%04d/%02d/%02d-%02d:%02d:%02d:%03d"
        $fn2 = "%s_%04d%02d%02d_%02d%02d%02d%03d"
        $uid = "%02X%02X%02X%02X%02X%02X"
        $empty = "00000000"
        $bound = "boundary=-------------"
    condition:
        1 of ($fn*) and all of($uid,$empty,$bound)
}

rule CrowdStrike_CSIT_20230_02 : carbon_spider domenus downloader ecrime 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects Domenus Stager VBS that downloads CARBON SPIDER's Domenus VBS Downloader"
        reports = "CSIT-20230"
        version = "202101291829"
        last_modified = "2021-01-29"
        actor = "CARBON SPIDER"
        malware_family = "Domenus"
    strings:
        $a1 = "createobject(\"msxml2.serverxmlhttp\")" nocase
        $a2 = ".open \"post\", \"http" nocase
        $a3 = ".setrequestheader \"user-agent" nocase
        $a4 = ".setrequestheader \"content-type\", \"application/x-www-form-urlencoded" nocase
        $a5 = ".responsetext" nocase
        $a6 = ".send" nocase
        $wmi1 = "select * from win32_networkadapterconfiguration where ipenabled" nocase
        $wmi2 = "if typename(macaddress) = \"String\" and len(macaddress)" nocase
        $wmi3 = "macaddress = objitem.macaddress" nocase
        $wmi4 = "shell.ExpandEnvironmentStrings('%COMPUTERNAME%')" nocase
        $wmi5 = ".item().macaddress" nocase
        $yoyo = "xmlhttp.send \"yoyo=" nocase
    condition:
        filesize < 10KB and (6 of ($a*)) or (3 of ($wmi*)) or $yoyo
}

rule CrowdStrike_CSIT_20230_04 : carbon_spider domenus vbs 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects the decoded version of the Domenus VBS, which has been seen being delivered by the Domenus Stager VBS."
        reports = "CSIT-20230"
        version = "202101291829"
        last_modified = "2021-01-29"
        actor = "CARBON SPIDER"
        malware_family = "Domenus"
    strings:
        $term1 = "panel_url"
        $term2 = "get_grivers"
        $term3 = "count_domain_hosts"
        $term4 = "&DomainHosts="
    condition:
        all of them
}

rule CrowdStrike_CSA_200912_01 : downloader labyrinth_chollima macos neddnloader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects strings present for installation and POST requests from NedDnLoader MacOS variant"
        reports = "CSA-200912"
        version = "202007170756"
        last_modified = "2020-07-17"
        actor = "LABYRINTH CHOLLIMA"
        malware_family = "NedDnLoader"
    strings:
        $post = "%s=%d&%s=%s&%s=%s&%s=%d"
        $cmd = "%s -t %s > /dev/null 2>&1 &"
        $lau = "/Library/LaunchDaemons/%s"
    condition:
        all of them
}

rule CrowdStrike_CSIT_20136_02 : cobravenom loader velvet_chollima 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects strings and payload marker present in CobraVenom loaders"
        reports = "CSIT-20136"
        version = "202009211928"
        last_modified = "2020-09-21"
        actor = "VELVET CHOLLIMA"
        malware_family = "CobraVenomLoader"
    strings:
        $marker = "%PDF-1.7..4 0 obj"
        $param = {20 2F 73 20 22 00}
        $export = "DllRegisterServer"
    condition:
        all of them
}

rule CrowdStrike_CSIT_20136_01 : cobravenom dropper velvet_chollima 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects variable names or package name associated with WSF JavaScript dropper for CobraVenom"
        reports = "CSIT-20136"
        version = "202009211930"
        last_modified = "2020-09-21"
        actor = "VELVET CHOLLIMA"
        malware_family = "CobraVenom"
    strings:
        $b64bin = "var var_b64_bin_path = var_local_folder + var_b64_bin_name;"
        $b64file = "var var_b64_file_path = var_local_folder + var_b64_file_name;"
        $package = {3C 70 61 63 6B 61 67 65 3E 3C 6A 6F 62 20 20 69
        64 3D 27 72 6C 4C 59 56 59 62 4E 27 3E 3C 73 63
        72 69 70 74 20 6C 61 6E 67 75 61 67 65 3D 27 4A
        53 63 72 69 70 74 27 3E}
    condition:
        any of them
}

rule CrowdStrike_CSA_200938_04 : sorefang 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects SoreFang downloader based on constant values"
        reports = "CSA-200938"
        version = "202106171559"
        last_modified = "2021-06-17"
        malware_family = "SoreFang"
    strings:
        $ = { 85 c0 79 0b 3d 19 01 01 80 0f 85 e4 }
        $ = { 9f 36 87 0f e5 a4 fc 4c bd 3e 73 e6 15 45 72 dd }
        $ = { c7 a4 ab 2f a9 4d 13 40 96 97 20 cc 3f d4 0f 85 }
        $ = { 5c 6c 12 88 }
    condition:
        all of them
}

rule CrowdStrike_CSA_200938_02 : cozy_bear dotnet wellmess 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Characteristic .NET bytecode of the SSL.Decipher routine in WellMess"
        reports = "CSA-200938"
        version = "202106171537"
        last_modified = "2021-06-17"
        actor = "COZY BEAR"
        malware_family = "WellMess"
    strings:
        $bytecode = { 11 06 11 07 11 09 60 11 0b 60 11 0d }
    condition:
        all of them
}

rule CrowdStrike_CSA_200938_01 : cozy_bear wellmess 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects distinctive strings observed in Wellmess samples"
        reports = "CSA-200938"
        version = "202007290746"
        last_modified = "2020-07-29"
        actor = "COZY BEAR"
        malware_family = "Wellmess"
    strings:
        $str_botlib_init = "botlib.init" fullword
        $str_cert = "-----BEGIN "
    condition:
        all of them and
        filesize > 2MB
}

rule CrowdStrike_CSA_200938_03 : cozy_bear wellmail 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects distinctive strings observed in Wellmail samples"
        reports = "CSA-200938"
        version = "202106171559"
        last_modified = "2021-06-17"
        actor = "COZY BEAR"
        malware_family = "Wellmail"
    strings:
        $str_zipit = "main.zipit.func1" fullword
        $str_rsa = "-----BEGIN RSA PRIVATE KEY-----"
    condition:
        all of them and
        filesize > 2MB
}

rule CrowdStrike_Vatet_Loader_Stage1 : defray777 pyxie vatet 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects backdoored open source projects used by SPRITE SPIDER as first stage loader"
        reports = "CSA-200985"
        version = "202105252051"
        last_modified = "2021-05-25"
        actor = "SPRITE SPIDER"
        malware_family = "Vatet"
    strings:
        // CreateFile argument setup and crypto
        $x1 = {8a 04 ?? [4-8] 88 04 ?? 4? 3? ?? 72 [75-400] 8a ??  ?? 32 ?? (04 | 2c) ?? 32 }
        $x2 = {8a 04 ?? [4-8] 88 04 ?? 4? 3? ?? 72 [75-400] 8a ??  ?? 34 ?? (04 | 2c) ?? 34 }
        $x3 = {8a 04 ?? [4-8] 88 04 ?? 4? 3? ?? 72 [75-400] 8a ??  ?? (04 | 2c) ?? 34 ?? (04 | 2c) }
        $x4 = {68 80 00 00 ?? 6a 03 [2-4] 68 00 00 00 80 68 [75-400] 8a ??  ?? 32 ?? (04 | 2c) ?? 32 }
        $x5 = {68 80 00 00 ?? 6a 03 [2-4] 68 00 00 00 80 68 [75-400] 8a ??  ?? 34 ?? (04 | 2c) ?? 34 }
        $x6 = {68 80 00 00 ?? 6a 03 [2-4] 68 00 00 00 80 68 [75-400] 8a ??  ?? (04 | 2c) ?? 34 ?? (04 | 2c) }
        $x7 = {6a 00 ?? 6a 03 [2-4] 68 00 00 00 80 68 [75-400] 8a ??  ?? 32 ?? (04 | 2c) ?? 32 }
        $x8 = {6a 00 ?? 6a 03 [2-4] 68 00 00 00 80 68 [75-400] 8a ??  ?? 34 ?? (04 | 2c) ?? 34 }
        $x9 = {6a 00 ?? 6a 03 [2-4] 68 00 00 00 80 68 [75-400] 8a ??  ?? (04 | 2c) ?? 34 ?? (04 | 2c) }
        // Local .dat
        $dat = { 2e 64 61 74 00}
        // Old samples
        // pdb path
        $s1 = {00 00 00 43 3A 5C 55 73 65 72 73 5C 31 5C 44 6F 77 6E 6C 6F 61 64 73 5C}
        $s2 = {00 00 00 43 00 3A 00 5C 00 55 00 73 00 65 00 72 00 73 00 5C 00 31 00 5C 00 44 00 6F 00 77 00 6E 00 6C 00 6F 00 61 00 64 00 73 00 5C}
        // network path dat or sto
        $rfile1 = /\\\\\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}\\[0-9]{2,16}\\.{2,16}\.(sto|dat)/
        // local path dat or sto
        $rfile2 = /c\:\\([a-zA-Z]{2,16}\\){1,3}.{2,16}\.(sto|dat)/
        $mx1 = {8b 55 ?? 03 55 ?? 0f b6 02   (83 | 05 | 2d) [2-4]   8b 4d ?? 03 4d ?? 88 01 8b 55 ?? 03 55 ?? 0f b6 02   (83 | 05 | 2d) [2-4]   8b 4d ?? 03 4d ?? 88 01 8b 55 ?? 03 55 ?? 0f b6 02   (83 | 05 | 2d) [2-4]   8b 4d ?? 03 4d ?? 88 01  8b 55 ?? 03 55 ?? 0f b6 02   (83 | 05 | 2d)}
        $mx2 = {8A 04 ?? (04 | 2c) ?? 34 ?? (04 | 2c) ?? 34 ?? (04 | 2c) ?? 34 ?? (04 | 2c) ?? 34 ?? (04 | 2c) ?? 34 ?? (04 | 2c) ?? 34 ?? (04 | 2c) ?? 34 ?? (04 | 2c) ?? 34 ?? (04 | 2c) ?? 34 ?? (04 | 2c) ?? 34 ?? (04 | 2c) ?? 34 ?? (04 | 2c) ?? 34 ?? (04 | 2c) ?? 34 ?? (04 | 2c) ?? 34 }
    condition:
        uint16(0) == 0x5A4D and filesize < 10MB and ( any of ($mx*)   or  (any of ($x*) and  $dat)   or     (any of ($s*) and any of ($rfile*)) )
}

rule CrowdStrike_CSIT_21112_03 : backdoor carbon_spider killack powershell 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects strings in the CARBON SPIDER KillACK PowerShell Backdoor."
        reports = "CSIT-21112"
        version = "202105280931"
        last_modified = "2021-05-28"
        actor = "CARBON SPIDER"
        malware_family = "KillACK"
    strings:
        $function_1 = "function Run-Command("
        $function_2 = "function Get-TaskOutput("
        $function_3 = "function Check-Tasks"
        $function_4 = "function Log-DebugMessage("
        $function_5 = "function Get-BiosSerial("
        $function_6 = "Function Send-ToConsole("
        $string_1 = "======Errors:======"
        $string_2 = "Host is not a member of domain"
        $string_3 = "$myVer Init complete"
        $string_4 = "=====Start-Job Critical Error====="
        $string_5 = "=====Warnings:====="
        $string_6 = "$NoSweep"
        $string_7 = "$urlConsole"
    condition:
        3 of ($string_*) or 4 of ($function_*)
}

rule CrowdStrike_Malicious_JScript_Executor_01
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects a unique combination of strings and bytes found in both packed and unpacked versions of a JScript execution tool linked to malicious activity targeting the Australian government."
        version = "202008071403"
        last_modified = "2020-08-07"
    strings:
        $decoder = { 25 47 0? 61 D2 52 0? 17 58 }
        $2 = "HttpUtility"
        $3 = "xxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"
        $4 = "ReadAndDel"
        $5 = "StrEnc"
        $6 = "StrDec"
    condition:
        filesize<500KB and 4 of them
}

rule CrowdStrike_CSIT_20140_02 : hacktool python stealer 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "LaZagne is a publicly available password stealer written in Python"
        reports = "CSIT-20140"
        version = "202007311736"
        last_modified = "2020-07-31"
        malware_family = "LaZagne"
    strings:
        // generic
        $gen1 = "from lazagne.config."
        $gen2 = "def run(self):"
        $gen3 = "ModuleInfo.__init__"
        // write_output.py
        $output1 = "[+] %s passwords have been found."
        $output2 = " passwords -----------------"
        $output3 = "For more information launch it again with the -v option"
        // manage_modules.py
        $mods1 = "from lazagne.softwares.browsers.chromium_based import chromium_browsers"
        $mods2 = "Chat clients supported" fullword
        $mods3 = "Games etc." fullword
        $mods4 = "Maven java build tool" fullword
    condition:
        all of ($gen*) or all of ($output*) or all of ($mods*)
}

rule CrowdStrike_CSIT_20140_01 : qealler stealer 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects Java strings in the memory dump of Qealler"
        reports = "CSIT-20140"
        version = "202007311736"
        last_modified = "2020-07-31"
        malware_family = "Qealler"
    strings:
        $ = "Q4_PASS_LIB"
        $ = "JPOWERSHELL"
        $ = "LIBRARY_CMD"
        $ = "CREDENTIAL_CMD"
        $ = "serverIps"
        $ = "pushCredentials"
    condition:
        4 of them
}

rule CrowdStrike_CSA_200988_01 : ransomware vhd_ransomware 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects strings within the VHD ransomware reportedly deployed using MataNet"
        reports = "CSA-200988"
        version = "202007311735"
        last_modified = "2020-07-31"
        malware_family = "VHDRansomware"
    strings:
        $mz  = {4d 5a}
        $mutex = "AEEAEE SET" wide
        $fl = "HowToDecrypt.txt" wide
        $fmt = "COM_%d"
    condition:
        ($mz at 0) and all of them
}

rule CrowdStrike_CSIT_20143_01 : ecrime lockbit ransomware unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects AES instructions and timing calculations found in LockBit ransomware."
        reports = "CSIT-20143"
        version = "202008141122"
        last_modified = "2020-08-14"
        malware_family = "LockBit"
    strings:
        $time1 = { B8 3B D4 B5 31 2B FE F7 E7 B8 B1 7C 21 95 8B F2 }
        $time2 = { C1 E? 18 69 C? 00 A4 D9 FA }
        $aes1 = { 66 0F EF E0 66 0F EF 64 24 ?0 }
        $aes2 = { 66 0F 38 DC 64 24 70 66 0F 38 DC A4 24 80 00 00 00 66 0F 38 DC A4 24 90 00 00 00 66 0F 38 DC A4 24 A0 00 00 00 }
        $aes3 = { 66 0F 38 DC E7 66 0F 38 DC E6 66 0F 38 DC E5 66 0F 38 DC E3 66 0F 38 DC E2 66 0F 38 DD E1 }
        $aes4 = { 66 0F 38 DC 64 24 60 66 0F 38 DC 64 24 70 66 0F 38 DC A4 24 80 00 00 00 66 0F 38 DC A4 24 90 00 00 00 }
    condition:
        1 of ($time*) and 2 of ($aes*)
}

rule CrowdStrike_CSIT_20144_01 : primitive_bear rat vulcanops 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects the Vulcanops malware deployed by PRIMITIVE BEAR"
        reports = "CSIT-20144"
        version = "202010161023"
        last_modified = "2020-10-16"
        actor = "PRIMITIVE BEAR"
        malware_family = "Vulcanops"
    strings:
        $str_atoi = "atoi" fullword
        $str_virtualprotect = "VirtualProtect" fullword
        $code_xorstrings = { 89 d0 0f b6 84 05 ?? ?? ff ff 31 d8 88 01 }
        $code_volxor = { ba 00 00 00 00 f7 f3 8b 45 ?? 01 d0 0f b6 00 32 85 ?? ?? ff ff}
    condition:
        filesize < 2MB and
        3 of them
}

rule CrowdStrike_CSIT_20171_01 : downloader evildr evilnum phishing 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects samples of EVILNK based off characteristic strings"
        reports = "CSIT-20171"
        version = "202101191608"
        last_modified = "2021-01-19"
        malware_family = "EVILNK"
    strings:
        $header = {4c 00 00 00 01}
        $str1 = "\\..\\..\\..\\..\\..\\Windows\\System32\\cmd.exe" wide
        $str2 = "pdf.lnk" wide
        $str3 = "S-1-5-21-" wide ascii
        $str4 = "cScrIPt" wide ascii nocase
        $unq1 = "seitreporp.eruces.swavaj.tnemyolped" wide
        $unq2 = "bdp.swavaj"
    condition:
        $header at 0 and filesize > 100KB and filesize < 2MB and (2 of ($str*) or any of ($unq*))
}

rule CrowdStrike_CSIT_20169_01 : ecrime ransomware sfile 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects SFile ransomware PE binaries."
        reports = "CSIT-20169"
        version = "202010021551"
        last_modified = "2020-10-02"
        malware_family = "sfileransomware"
    strings:
        $str_1 = "sfile" wide
        $str_2 = "skeys" wide
        $str_3 = "--kill-susp" wide
        $str_4 = "--enable-shares" wide
        $str_5 = "\\far manager\\" wide
        $str_6 = "\\ida 7.0\\" wide
        $str_7 = "\\ida 6.8\\" wide
        $str_8 = "re-decrypt file %ws" ascii
        $str_9 = "EncryptDisk(%ws) DONE" ascii
        $str_10 = "WorkModeFindFiles :" ascii
        $str_11 = "WorkModeEncryptFiles :" ascii
        $str_12 = "waiting for sacred time..." ascii
        $bin_murhash = { 89 45 ?? 69 4D ?? 95 E9 D1 5B }
        $bin_aeskeygen = { 75 ?? 6A 20 8D 8D [4] 51 E8 [4] 83 C4 08 6A 10 8D 95 [4] 52 E8 [4] 83 C4 08 }
        $bin_sizetable = { 80 3E 00 00 00 00 01 00 00 00 00 00 00 00 00 00 00 00 7D 00 00 00 00 00 00 00 00 F4 01 00 00 00 40 1F 00 00 00 00 00 00 00 80 02 00 00 00 01 00 00 00 00 00 00 00 }
    condition:
        uint16(0) == 0x5a4d and (6 of ($str_*) or 3 of ($bin_*)) and filesize < 750KB
}

rule CrowdStrike_CSIT_20157_01 : ransomware thanos 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects Thanos ransomware"
        reports = "CSIT-20157"
        version = "202010221652"
        last_modified = "2020-10-22"
        malware_family = "ThanosRansomware"
    strings:
        // Required strings
        $req_rijndael = "RijndaelManaged" fullword
        $req_corexemain = "_CorExeMain" fullword
        $req_myapp = "MyApplication.app" fullword
        // Optional strings
        // Sniffer names
        $str_1 = "aHR0cCBhbmFseXplciBzdGFuZC1hbG9uZQ==" wide // http analyzer stand-alone
        $str_2 = "TWVnYUR1bXBlcg==" wide // MegaDumper
        // Github and external tooling
        $str_3 = "aHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL2QzNWhhL1Byb2Nlc3NIaWRlL21hc3Rlci9iaW5zL1Byb2Nlc3NIaWRlMzIuZXhl" wide
        $str_4 = "aHR0cHM6Ly93d3cucG93ZXJhZG1pbi5jb20vcGFleGVjL3BhZXhlYy5leGU=" wide
        // Other strings
        $str_5 = "Aditional KeyId:" wide fullword
        $str_6 = "S2V5IElkZW50aWZpZXI6IA==" wide // Key Identifier:
        $str_7 = "MjA0OCE8UlNBS2V5VmFsdWU+PE1vZHVsdXM+" wide // 2048!<RSAKeyValue><Modulus>
        $str_8 = "_MachineName=" wide fullword
        $str_9 = "VGhhbm9z" wide fullword // Thanos
        $str_10 = "Incorrect MAC address supplied!" wide fullword
    condition:
        uint16(0) == 0x5a4d and
        filesize < 300KB and
        all of ($req_*) and
        4 of ($str_*)
}

rule CrowdStrike_CSA_201028 : defray777 linux ransomware 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Defray777 Ransomware Linux Variant in use by SPRITE SPIDER."
        reports = "CSA-201028"
        version = "202106232005"
        last_modified = "2021-06-23"
        actor = "SPRITE SPIDER"
        malware_family = "Defray777"
    strings:
        $unique = { 45D877BC90C9C3 }
        // the symbols aren't stripped so we can use them for now
        $sym1 = "GetRansomConfig"
        $sym2 = "CryptOneBlock"
        $sym3 = "CryptOneFile"
        $sym4 = "encrypt_worker"
        $sym5 = "EnumFiles"
    condition:
        $unique or (uint32(0) == 0x464c457f and all of ($sym*) )
}

rule CrowdStrike_CSA_201269_02 : artefact delphi downloader fancy_bear zekapab 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects Zekapab variants with reversed strings"
        reports = "CSA-201269"
        version = "202010021546"
        last_modified = "2020-10-02"
        actor = "FANCY BEAR"
        malware_family = "Zekapab"
    strings:
        $str_1 = "//:ptth" ascii
        $str_2 = "php." ascii
        $str_3 = "OM/ ETUNIM CS/ etaerC/ sksathcs" ascii
        $str_4 = "cMD.eXe /c " ascii
        $path_01 = "C:\\Users\\user\\Documents\\Borland Studio Projects\\22 - 0\\IdHTTP.pas" ascii
    condition:
        any of ($path_*) or all of ($str_*)
}

rule CrowdStrike_CSIT_20151_01 : crashoverride exaramel voodoo_bear 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects distinct user agent code used in VOODOO BEAR Exaramel and CrashOverride"
        reports = "CSIT-20151"
        version = "202101291829"
        last_modified = "2021-01-29"
        actor = "VOODOO BEAR"
        malware_family = "Exaramel, CrashOverride"
    strings:
        $  = { 56 57 6a 02 c7 45 fc 01 00 00 00 e8 ?? ?? ?? ?? 8b f8 ( 59 | 83 C4 04 ) 85 ff 0f 84 ?? ?? 00 00 8d 45 fc 50 57 6a 00 e8 ?? ?? 00 00 ?? 0e 00 07 80 }
    condition:
        any of them
}

rule CrowdStrike_CSA_201043_01 : implant remix_kitten 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects .NET TypeLib GUID used for REMIX tools - XWatch and DWatch"
        reports = "CSA-201043"
        version = "202008141124"
        last_modified = "2020-08-14"
        actor = "REMIX KITTEN"
        malware_family = "DWATCH"
    strings:
        $ = "3af85bb3-fc6d-4545-8136-dd0639ec8d49" wide ascii
    condition:
        all of them
}

rule CrowdStrike_CSIT_20169_02 : ecrime ransomware sfile 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects SFile ransomware ELF32/64 binaries."
        reports = "CSIT-20169"
        version = "202102171631"
        last_modified = "2021-02-17"
        malware_family = "sfileransomware"
    strings:
        $ext = ".sfile" ascii
        $str_1 = "--e-size=" ascii
        $str_2 = "--g-size=" ascii
        $str_3 = "--exl=" ascii
        $str_4 = "--threads-count=" ascii
        $str_5 = "_FILES_ENCRYPTED_.txt" ascii
        $str_6 = "[appendremove_encrypt_keys]" ascii
        $str_7 = "[encrypt_decrypt_file]" ascii
        $str_8 = "[hashes_init]" ascii
        $str_9 = "[dynamic_exclude]" ascii
        $str_10 = "ENCRYPTME_RING" ascii
        $str_11 = "MINIMAL_ENCRYPT_SIZE" ascii
        $str_12 = "BIG_FILE_ONE_GROWTH" ascii
    condition:
        uint32(0) == 0x464c457f and $ext and 6 of ($str_*) and filesize < 3MB
}

rule CrowdStrike_CSIT_19195_02 : downloader fancy_bear nimbledown 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Encoded strings from FANCY BEAR's NimbleDown downloader"
        reports = "CSIT-19195"
        version = "202008141123"
        last_modified = "2020-08-14"
        actor = "FANCY BEAR"
        malware_family = "NimbleDown"
    strings:
        $persistence = "63324E6F6447467A61334D674C324E795A5746305A5341766447346756326C755"
        $obfuscated_c2_server = "6148523063446F764C7A4D784C6A63754E6A49754D54417A"
        $encoded_string = "64323170597942766379426E5A5851675132467764476C7662697844553052575"
        $adobe_reader = "51575276596D5567556D56685A475679"
        $error_message = "3536343736383643363336443535363736343332343637413439343734363735343"
    condition:
        any of them
}

rule CrowdStrike_CSA_201063_01 : darkside ransomware unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects unpacked Darkside ransomware "
        reports = "CSA-201063"
        version = "202104140004"
        last_modified = "2021-04-14"
        malware_family = "DarkSide"
    strings:
        // Crypto SBOX gen
        $a1 = { 81 ea 10 10 10 10 2d 10 10 10 10 81 eb 10 10 10 10 81 ef 10 10 10 10 83 e9 10 }
        // Blob end marker
        //$a2 = { de ad be ef }
        // Aplib decompress
        $a3 = { 3d 00 7d 00 00 83 d9 ff 3d 00 05 00 00 83 d9 ff 3d 80 00 00 00 83 d1 00 3d 80 00 00 00 83 d1 00 }
        // UNC path
        $b1 = { c7 [1-2] 5c 00 5c 00 c7 [1-2] 3f 00 5c 00 c7 [1-2] 55 00 4e 00 c7 [1-2] 43 00 5c 00 }
        $b2 = {51 64 8b 0d 30 00 00 00 8b 41 18}
        $ex1 = "DarkSide Decryption Tool" wide
    condition:
        uint16(0) == 0x5A4D  and all of ($a*) and not $ex1 and ($b1 or $b2)
}

rule CrowdStrike_CSA_201056_01 : dropper redcurl scarletspiral 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects RedCurl Vigenere dropper"
        reports = "CSA-201056,CSIT-21004"
        version = "202101141747"
        last_modified = "2021-01-14"
        actor = "ScarletSpiral"
        malware_family = "RedCurl"
    strings:
        $rel = "release.dll"
        $rel2 = "release_fileserver.dll"
        $gcc = "GCC: (MinGW.org GCC-"
        $code = { 8b 7d 10 8b 0f 8b 3e 8a 0c 01 40 88 0c 17 42 eb }
    condition:
        (($rel or $rel2) and $gcc)
        or $code
}

rule CrowdStrike_CSA_201252_01 : powgoop static_kitten 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects PowerShell strings used by STATIC KITTEN PowGoop loader"
        reports = "CSA-201252"
        version = "202103171834"
        last_modified = "2021-03-17"
        actor = "STATIC KITTEN"
        malware_family = "PowGoop"
    strings:
        $a_1 = "$a=get-content" wide ascii
        $a_2 = ";$t =bDd" wide ascii
        $a_3 = "$a;iex($t);" wide ascii
        $a_4 = "{$in[$i] = $in[$i] - 2;}" wide ascii
        $b_1 = "goopdata86.DllEntry" wide ascii
        $c_1 = "DllRegisterServer" wide ascii
    condition:
        uint16(0) == 0x5a4d and
        $c_1 and
        ( 3 of ($a_*) or $b_1 )
}

rule CrowdStrike_CSA_201066_01 : iis rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects strings in malicious IIS filter malware"
        reports = "CSA-201066"
        version = "202008241414"
        last_modified = "2020-08-24"
    strings:
        $ = "Service has not Started yet, but get an order:"
        $ = "Unacceptable Order:"
        $ = "Execute Order '%s' Failed."
        $ = "Execute Order '%s' Partly."
        $ = "Warning Code: %d."
        $ = "Execute Order '%s' Succeed."
        $ = "Order Data Length: %d"
        $ = "[%c]-[%04I64u%c]>|%s"
        $ = "Release Dynamic Code Buffer Failed"
        $ = "Unacceptable UF-order data."
        $ = "Can not open target file."
        $ = "Wrong type or number of Order-data."
        $ = "Path given by LIST_DIR is no exist."
        $ = "Expect an Order-data."
        $ = "Order was partly executed."
        $ = "Order executed completely."
        $ = "Execute Failed."
        $ = "Long Response."
        $ = "Order executed, but some mistakes took place."
        $ = "Before Response Generated:"
        $ = "<hdr:%d>    <cont:%d>    <all:%d>"
        $ = "A.START_SERVICE"
        $ = "B.TERMINATE_SERVICE"
        $ = "C.URL_PATH"
        $ = "D.LIST_DIR"
        $ = "E.UPLOAD_FILE_NEW"
        $ = "F.UPLOAD_FILE_SEQUENCE"
        $ = "Not expected block sequence:%d-%d"
        $ = "UFS paras:fileid-%d    blockseq-%d    blocksize-%d"
        $ = "UPLOAD_FILE_FINISH"
        $ = "UFS paras:fileid-%d    blockseq-%d"
        $ = "UPLOAD_FILE_REINDEX"
        $ = "FetchLongRespongseData"
        $ = "EraseLongResponseData"
        $ = "K.DownloadFile"
        $ = "L.LIST_RESOURCE"
        $ = "M.Execute"
        $ = "Log started: %s."
        $ = "Memory used: %u Bytes."
        $ = "Orders available: %d"
        $ = "Running UF task: %d"
        $ = "<File-id:%d><Sequence:%d><File-name:%s>"
        $ = "N.CLEAR_TASKS"
        $ = "O.DELETE_FILE"
        $ = "Delete File Failed, Error Number:%s"
        $ = "OrderDeleteFile"
        $ = "OrderClearTask"
        $ = "OrderExecute"
        $ = "OrderListResource"
        $ = "OrderDownloadFile"
        $ = "OrderEraseData"
        $ = "OrderFetchData"
        $ = "OrderUploadFileReindex"
        $ = "OrderUploadFileFinish"
        $ = "OrderUploadFileSequence"
        $ = "OrderUploadFileNew"
        $ = "OrderListDirectory"
        $ = "OrderUrlPath"
        $ = "OrderTerminateService"
        $ = "OrderStartService"
        $ = "OrderBase"
        $ = "HTTP_WGJ"
        $ = "HTTP_WGK"
        $ = "BKMGT"
        $ = "%04u||%s"
    condition:
        uint16(0) == 0x5a4d and
        filesize < 500KB and
        3 of them
}

rule CrowdStrike_Knmrerl_01 : downloader knmrerl 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects a malicious hybrid VBS and PowerShell downloader dubbed Knmrerl."
        version = "202008210909"
        last_modified = "2020-08-21"
        malware_family = "Knmrerl"
    strings:
        $ = "CreateObject(A55)"
        $ = "Knmrerl(ttt)"
        $ = ") 6 5 A ( s g n i r t S t n e m n o r i v n E d n a p x"
        $ = "C r e a t e O b j e c t ( A 5 5 )"
        $ = "=Eval(kbv())"
        $ = "Set SD00RT34HG7H = FDSFHTRY00ERSFD.SpawnInstance_"
    condition:
        2 of them and
        filesize < 10KB
}

rule CrowdStrike_CSIT_20134_01 : mallard_spider proxy qakbot 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects Qakbot proxy component using embedded strings and code patterns"
        reports = "CSIT-20134"
        version = "202104200730"
        last_modified = "2021-04-20"
        actor = "MALLARD SPIDER"
        malware_family = "Qakbot"
    strings:
        $string1 = "fsmonitor" ascii fullword
        $string2 = "HardwareMonWindowClass" ascii fullword
        $string3 = "HardwareMonWindow" ascii fullword
        $string4 = "Socket error: %s, %d" ascii
        $string5 = "UpnpDiscoverGateway() failed" ascii fullword
        $string6 = "Global\\{EEE80B68-1EF4-47C2-9017-59E46A84F3BC}" ascii fullword
        $string7 = "https://%s:%u/bot_serv" ascii fullword
        $string8 = "cmd=1&msg=%s&ports=" ascii fullword
        $string9 = "mozzizla huiiazzilla" ascii fullword
        $string10 = "FsMonServerMain" ascii fullword
        $string11 = "FsMonServerMainNt" ascii fullword
        $string12 = "X-Forwarded-For-Gateway2: %s" ascii fullword
        $string13 = "FilesystemMonitor" ascii
        $string14 = "HwmonServerMain" ascii fullword
        $string15 = "HwmonServerMainNT" ascii fullword
        $string16 = "hwmon" ascii fullword
        $string17 = "HwmonWindowClass" ascii fullword
        $string18 = "HwmonWindow" ascii fullword
        $string19 = "aabcdeeeefghiiijklmnooopqrstttuuvwxyz" ascii fullword
        $result1 = "ok, in process" ascii fullword
        $result2 = "failed err=%d" ascii fullword
        $path1 = "/bot_serv"  ascii fullword
        $path2 = "/ctrl_cmd" ascii fullword
        $path3 = "/gwsup" ascii fullword
        $legit1 = "HOST: %s:1900" ascii
        $legit2 = "-----BEGIN RSA PUBLIC KEY-----" ascii
        $code1 = { 50 68 [4] ba 00 10 00 00 2b 95 [4] 52 8b 45 [1] 03 85 [4] e8 }
        $code2 = { 53 56 57 c7 85 [4] 00 00 00 00 b8 bb 01 00 00 66 89 85 [4] c7 85 58 [4] 00 00 00 00 c7 85 60 [4] 00 00 00 00 }
    condition:
        filesize < 5000KB and uint16(0) == 0x5a4d and (
        (2 of ($string*)) or
        (all of ($result*)) or
        (any of ($path*)) or
        (all of ($legit*)) or
        ($code1 or $code2)
        )
}

rule CrowdStrike_Modified_Chopper_Webshell_Godfather : chopper godfather webshell 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This webshell was identified as being used during a targeted intrusion event. It is likely a variant of Chopper used to evade strings-based detection techniques."
        version = "202008210909"
        last_modified = "2020-08-21"
        malware = "Chopper"
    strings:
        $req_item = "Request.Item["
        $un = "'un',"
        $safe = "'safe',"
        $resp_write = "Response.Write(eval("
    condition:
        ($un and $safe) and
        ($req_item or $resp_write)
}

rule CrowdStrike_CSIT_20158_01 : fiftystacks rat wet_panda 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects an instance of FIFTYSTACKS malware"
        reports = "CSIT-20158"
        version = "202010091335"
        last_modified = "2020-10-09"
        actor = "WET PANDA"
        malware_family = "FIFTYSTACKS"
    strings:
        $ = "Ptrans()::connect() fail!" nocase
        $ = "Ptrans()::MyConnect() fail!" nocase
        $ = { 08 01 00 00 51 C3 00 00 }
        $ = { 81 BD 54 FD FF FF 60 00 BA FF }
    condition:
        2 of them and filesize <= 500KB and uint16(0) == 0x5A4D
}

rule CrowdStrike_CSIT_20175_01 : downloader lampcarrier 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects LampCarrier downloader written in Golang"
        reports = "CSIT-20175"
        version = "202106171531"
        last_modified = "2021-06-17"
        actor = "LampCarrier"
        malware_family = "Smog"
    strings:
        $go1 = "Go build ID:"
        $go2 = "main.uSeRhOmEd1r0xxx0xx01230120123032402340432402343240"
        $str1 = "GetFileAttributesExW"
        $str2 = "RegOpenKeyExW"
        $str3 = "runtime.cgocall"
        $str4 = "runtime.aeshash"
        $str5 = "PATHEXT"
        $str6 = "HOMEPATH"
        $str7 = "HOMEDRIVE"
        $str8 = "WSARecv"
        $str9 = "Software\\Microsoft\\Windows\\CurrentVersion\\Run"
        $str10 = "SkypeApp.exe"
        //encoding/decoding func
        $hex1 = { 48 8B 44 24 10 48 8B 4C 24 08 31 D2 31 DB EB 16 48 8D 72 01 69 FB 93 01 00 01 44 0F B6 04 11 42 8D 1C 07 48 89 F2 48 39 C2 7C E5 B9 93 01 00 01 BA 01 00 00 00 EB 16 89 D6 0F AF D1 48 A9 01 00 00 00 0F 45 F2 48 D1 F8 0F AF C9 89 F2 48 85 C0 7F E5 89 5C 24 20 89 54 24 24 }
        //url safe encoding func
        $hex2 = { 0F B6 44 24 08 3C 61 72 0A 3C 7A 77 06 C6 44 24 18 00 C3 3C 41 0F 82 90 01 00 00 3C 5A 0F 96 C1 84 C9 75 E9 3C 30 0F 82 78 01 00 00 3C 39 0F 96 C1 84 C9 75 D8 48 8B 4C 24 10 48 83 F9 03 0F 85 51 01 00 00 3C 2C 0F 87 28 01 00 00 8D 50 DF 80 FA 01 77 06 }
    condition:
        uint16(0) == 0x5a4d and
        filesize > 3MB and
        all of them
}

rule CrowdStrike_CSIT_20158_02 : chattycrc dll loader wet_panda 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects an instance of ChattyCRC - SleepyThread variant"
        reports = "CSIT-20158"
        version = "202010091336"
        last_modified = "2020-10-09"
        actor = "WET PANDA"
        malware_family = "ChattyCRC"
        
    strings:
        $ = "ScLdr.dll"
        $ = { 81 7D F8 FE A3 94 D6 }
    condition:
        all of them and uint16(0) == 0x5A4D
}

rule CrowdStrike_CSIT_20158_03 : implant stealthpipes wet_panda 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects an instance of STEALTHPIPES"
        reports = "CSIT-20158"
        version = "202010091335"
        last_modified = "2020-10-09"
        actor = "WET PANDA"
        malware_family = "STEALTHPIPES"
    strings:
        $ = { BE 0B AC 00 00 2B C6 03 CE 0F AF C1 C1 C8 07 }
        $ = { 2B C6 03 CE 0F AF C1 C1 C8 07 }
        $ = { C7 45 E8 6E 74 64 6C C7 45 EC 6C 2E 64 6C 66 C7 45 F0 6C 00 C7 45 A8 41 64 76 61 C7 45 AC 70 69 33 32 C7 45 B0 2E 64 6C 6C 88 5D B4 }
        $ = { 4F 81 CF 00 FF FF FF 47 8A 10 8D 34 1F 8A 1E 88 18 40 FF 4D FC 88 16 }
        $ = { 81 C9 00 FF FF FF 41 8A 84 0D 7C FE FF FF 30 04 1A 43 89 5D FC }
    condition:
        any of them
}

rule CrowdStrike_Darkside_Ransomware_Linux : darkside ransomware 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects Linux version of Darkside ransomware"
        reports = "CSA-201275"
        version = "202102171633"
        last_modified = "2021-02-17"
        malware_family = "DarkSide"
    strings:
        $s1 = "PartialFileCrypter"
        $s2 = "[CFG] Thread Count"
        $s3 = "[SUMM] Network"
        $s4 = "[CFG] ReadMe File"
        $s5 = "[CFG] ReadMe Size"
        $s6 = "[CFG] Key Path"
        $s7 = "[CFG] Key Size"
        $s8 = "[CFG] ReadMe Path"
        $s9 = "[CFG] New Extension"
        $s10 = "[CFG] Root Path"
        $s11 = "[CFG] Part Size"
    condition:
        uint32(0) == 0x464c457f and all of ($s*)
}

rule CrowdStrike_ASCII_Loader_v1 : cobalt_spider cobint ecrime 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects ASCII Loader obfuscation used by a loader that load position independent code for execution. This loader has been used by COBALT SPIDER for distribution of COBINT."
        version = "202106021518"
        last_modified = "2021-06-02"
    strings:
        $func_preamble = { 55 b8 03 00 00 }
        $cmp1 = { 80 (FA | F9) 70 0f }
        $esp_mov = { A1 38 ?? ?? ?? 89 04 24 e8 }
        $loop_mov = { 0F BE 04 4E 84 C0 }
    condition:
        int32(0) == 0x905a4d and filesize < 300KB
        and $func_preamble
        and $cmp1
        and $esp_mov
        and $loop_mov
}

rule CrowdStrike_CSA_201116_01 : dropper exportcontrol silent_chollima 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects snippets used to locate and decrypt next-stage shellcodes"
        reports = "CSA-201116"
        version = "202009041510"
        last_modified = "2020-09-04"
        actor = "SILENT_CHOLLIMA"
        malware_family = "ExportControl"
    strings:
        /*
        .text:0042896F 64 8B 1D 30 00 00 00 mov     ebx, large fs:30h
        .text:00428976 8B 4B 08             mov     ecx, [ebx+8]
        */
        $image_base_calc = {64 8B 1D 30 00 00 00 8B 4B 08}
        // Grab key from fixed offsets, e.g., .text:00428AB6 05 F4 03 00 00       add     eax, 3F4h
        $offset_0 = {05 F4 03 00 00}
        $offset_1 = {05 F0 03 00 00}
        /* Decryption routine bytes
        .text:004288A1 83 C0 01             add     eax, 1
        .text:004288A4 33 D2                xor     edx, edx
        .text:004288A6 B9 00 01 00 00       mov     ecx, 100h
        .text:004288AB F7 F1                div     ecx
        ...
        .text:00428900 03 C2                add     eax, edx
        .text:00428902 33 D2                xor     edx, edx
        .text:00428904 B9 00 01 00 00       mov     ecx, 100h
        .text:00428909 F7 F1                div     ecx
        */
        $decrypt_bytes_0 = {83 C0 01 33 D2 B9 00 01 00 00 F7 F1}
        $decrypt_bytes_1 = {03 C2 33 D2 B9 00 01 00 00 F7 F1}
    condition:
        uint16(0) == 0x5a4d and all of them and filesize < 10MB
}

rule CrowdStrike_CSA_201116_02 : rat silent_chollima valefor 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects strings used in Valefor RAT for naming artifacts and command execution"
        reports = "CSA-201116,CSIT-21009"
        version = "202101200149"
        last_modified = "2021-01-20"
        actor = "SILENT_CHOLLIMA"
        malware_family = "Valefor"
    strings:
        $cmd_string = "cmd.exe /u /c %s" wide fullword
        $fin_string = "%_fin" fullword
        $mutex_string = "%s_main" fullword
        $persistence_string = "Startup_LNK" fullword
        $name_0 = "VSingle."
        $name_1 = "Valefor"
    condition:
        uint16(0) == 0x5a4d and 3 of them and filesize < 1MB
}

rule CrowdStrike_CSIT_20168_01 : loader morilite static_kitten 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects algorithm used to parse export function names within MoriLite loader"
        reports = "CSIT-20168"
        version = "202009041507"
        last_modified = "2020-09-04"
        actor = "STATIC KITTEN"
        malware_family = "MoriLite"
    strings:
        $a_1 = {
        48
        [0-2]
        89 [2-5]
        e8 [4]
        03 c6
        68 [4]
        50
        e8 [4]
        83 c4 (10 | 08)
        85 c0
        75 [1]
        (83 ?? ?? ?? ?? ?? 02 83 c7 04 8b ?? ?? ?? ?? ?? | 8b ?? ?? 83 c7 04 83 c3 02)
        85 c0
        75
        }
        $a_2 = "ReflectiveLoader" ascii
        $b_1 = "metsrv.dll" ascii
        $b_2 = "mtsrv.dll" ascii
        $b_3 = ">Wak?Xbl@YcmAZdnB" wide ascii
        $b_4 = "kitrap0d" ascii
    condition:
        uint16(0) == 0x5a4d and all of ($a_*) and not any of ($b_*)
}

rule CrowdStrike_CSA_201141_01 : ironpythonloader python venomous_bear 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects string decryption code for VENOMOUS BEAR Iron Python Loader"
        reports = "CSA-201141"
        version = "202009041508"
        last_modified = "2020-09-04"
        actor = "VENOMOUS BEAR"
        malware_family = "IronPythonLoader"
    strings:
        $ = "lambda s,k:''.join([chr((ord(c)^k)%0x100) for c in s])"
    condition:
        any of them
}

rule CrowdStrike_CSIT_20173_01 : distortedshepherd doublehash webshell 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects DistortedShepherd DoubleHash Webshell through characteristic code fragments"
        reports = "CSIT-20173"
        version = "202101201900"
        last_modified = "2021-01-20"
        malware_family = "DoubleHash"
        activity_cluster = "DistortedShepherd"
    strings:
        $hashpw = "return((BitConverter.ToString((new SHA1CryptoServiceProvider()).ComputeHash(Encoding.UTF8.GetBytes(p))).Replace(\"-\", \"\")==\""
        $compareid = "if(String.IsNullOrEmpty(Request[\"id\"]) || Request[\"id\"] != \""
        $upload = "flup.PostedFile.SaveAs(Encoding.UTF8.GetString(Convert.FromBase64String(flremoteaddr.Text))+\"\\\\\"+System.IO.Path.GetFileName(flup.PostedFile.FileName)"$result = "lblresultshow.Text=\"<pre>\"+so.Replace(\">\", \"&gt;\").Replace(\"<\", \"&lt;\").Replace(Environment.NewLine,\"<br />\")+\"</pre>\";"
    condition:
        filesize < 1MB and
        any of them
}

rule CrowdStrike_CSIT_20173_02 : distortedshepherd powershell rat sheeppipe 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects DistortedShepherd SheepPipe through characteristic code fragments"
        reports = "CSIT-20173"
        version = "202010091331"
        last_modified = "2020-10-09"
        malware_family = "SheepPipe"
        activity_cluster = "DistortedShepherd"
    strings:
        $ = "if ($line -eq '**end**') {" ascii wide
        $ = "$parts = $path.Split(':')" ascii wide
        $ = "$newPath = $parts -join ':'" ascii wide
        $ = "$retval = iex $data | Out-String" ascii wide
        $ = "$client = new-object System.IO.Pipes.NamedPipeClientStream $next, $pipeName, 'InOut', 'None', 'Anonymous'" ascii wide
        $ = "$retval = 'error:' + $env:computername + '>' + $path + '> ' + $Error[0].ToString()" ascii wide
    condition:
        filesize < 1MB and
        3 of them
}

rule CrowdStrike_CSIT_20173_03 : distortedshepherd sheepshell webshell 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects DistortedShepherd SheepShell through characteristic APIs and strings"
        reports = "CSIT-20173"
        version = "202012071625"
        last_modified = "2020-12-07"
        malware_family = "SheepShell"
        activity_cluster = "DistortedShepherd"
    strings:
        $str1 = "splsvc" wide
        $str2 = "sending to :"  wide
        $str3 = ", path = " wide
        $str4 = "key/plain" wide
        $str5 = "**end**" wide
        $cmd = "cmd.exe" wide
        $api1 = "HttpApplication"
        $api2 = "HttpRequest"
        $api3 = "HttpContext"
        $api4 = "Rfc2898DeriveBytes"
        $api5 = "RijndaelManaged"
        $api6 = "CryptoStream"
        $api7 = "ProcessStartInfo"
    condition:
        filesize < 1MB and
        uint16(0) == 0x5A4D and
        uint32(uint32(0x3C)) == 0x00004550 and
        all of ($api*) and
        $cmd and
        any of ($str*)
}

rule CrowdStrike_CSA_201141_02 : ironpythonloader python venomous_bear 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects deobfuscated strings in VENOMOUS BEAR IronPythonLoader"
        reports = "CSA-201141"
        version = "202009041509"
        last_modified = "2020-09-04"
        actor = "VENOMOUS BEAR"
        malware_family = "IronPythonLoader"
        
    strings:
        $ = "[!] Failed to get assem"
        $ = "[!] Failed to get pid"
        $ = "[!] Net exc (msg: {0}, st: {1})"
    condition:
        any of them
}

rule CrowdStrike_CSA_201272_01 : ipstorm 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Strings appearing in IPStorm variants for different architectures"
        reports = "CSA-201272"
        version = "202010021601"
        last_modified = "2020-10-02"
        malware_family = "IPStorm"
    strings:
        $lib_1 = "github.com/ipfs/go-ipns/"
        $lib_2 = "golang.org/x/crypto/ssh"
        $local_ip_1 = "192.168.0.0"
        $local_ip_2 = "127.0.0.1"
        $storm_indicator = "storm/starter.init"
    condition:
        all of them and filesize > 10MB
}

rule CrowdStrike_CSIT_20172_01 : downloader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects distinctive strings found in malicious downloaders bundled with VPN software"
        reports = "CSIT-20172"
        version = "202009041511"
        last_modified = "2020-09-04"
    strings:
        $endpoint1 = "%s/shellcode"
        $endpoint2 = "%s/key"
        $bilibili_cfg = "0062696C6962696C690000000075726C00"
        $marker1 = "a new song: "
        $marker2 = "code: "
        $bilibili_url1 = "api.vc.bilibili.com/dynamic_svr/v1/dynamic_svr/space_history?visitor_uid="
        $bilibili_url2 = "&host_uid=%s&offset_dynamic_id=0&need_top="
        $key_string1 = "Operation_Barrenland"
        $key_string2 = "Speed_of_Light"
        $key_string3 = "be_the_one"
    condition:
        filesize<5MB and uint16(0)==0x5a4d and 3 of them
}

rule CrowdStrike_CSIT_20172_02 : downloader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects distinctive strings found in malicious downloaders bundled with VPN software"
        reports = "CSIT-20172"
        version = "202009041511"
        last_modified = "2020-09-04"
    strings:
        $key1 = "fuckingpieceofshitfuck"
        $key2 = "bobisanassholebbfuck"
        $key3 = "explorerexplorer"
        $file1 = "\\c2hex"
        $file2 = "InsHelper.pdb"
    condition:
        filesize<1MB and uint16(0)==0x5a4d and 3 of them
}

rule CrowdStrike_CSIT_20181_01 : apollozeus rat silent_chollima 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects string decoding loop, encoded beacon string, and stream cipher bytes in 2018 version of ApolloZeus"
        reports = "CSIT-20181"
        version = "202009181324"
        last_modified = "2020-09-18"
        actor = "SILENT CHOLLIMA"
        malware_family = "ApolloZeus"
    strings:
        $apollo_zeus_xor_CC_encoded = {8D 00 BC 00 A3 00 A0 00 A0 00 A3 00 96 00 A9 00 B9 00 BF 00 00 00 00}
        $xor_cc_decoding_loop = {B9 CC 00 00 00 66 31 08 83 C0 02 66 39 18 75 F0}
        $stream_cipher_loop = {8A 0C 3E 32 C8 32 CB 88 0C 3E 8B CA 8B D8 C1 EB 08 89 5D F8 8B DA C1 E9 08 C1 EB 10 22 D9 22 DA 89 4D F0 8B D0 C1 EA 10 22 55 F8 8A C8 22 4D FF 32 DA 32 D9 8B 4D F4 8B D0 C1 EA 18 32 DA 8D 14 00 33 D0 81 E2 FE 01 00 00 C1 E1 18 0B 4D F8 C1 E2 16 0B 55 F0 46 88 5D FF 89 55 F4 8B C1 3B 75 08 7C 9D}
    condition:
        3 of them
}

rule CrowdStrike_CSIT_20181_02 : apollozeus rat silent_chollima 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects string decoding loop, encoded beacon string, and DES routine bytes in 2019 version of ApolloZeus"
        reports = "CSIT-20181"
        version = "202010091337"
        last_modified = "2020-10-09"
        actor = "SILENT CHOLLIMA"
        malware_family = "ApolloZeus"
    strings:
        $apollo_zeus_xor_9C_encoded = { dd 00 ec 00 f3 00 f0 00 f0 00 f3 00 c6 00 f9 00 e9 00 ef 00 00 00 00 }
        $xor_9c_decoding_loop = { ba 9c 00 00 00 66 31 11 8d 49 02 66 83 39 00 75 f4 }
        $des_bytes_loop = { d3 fa 22 c2 d2 e0 8a cb 80 e1 07 43 d2 e8 08 06 83 fb 40 7c b6 }
    condition:
        3 of them
}

rule CrowdStrike_CSIT_20170_01 : ransomware suncrypt 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detect SunCrypt ransomware based on string and code patterns"
        reports = "CSIT-20170"
        version = "202104150823"
        last_modified = "2021-04-15"
        malware_family = "SunCrypt"
    strings:
        $arg_name = "-noreport" wide fullword
        $arg_hash1 = {12 c9 00 10}
        $arg_hash2 = {f1 96 1b 3a}
        $arg_hash3 = {d2 53 cb 1a}
        $arg_hash4 = {ed c6 1a b7}
        // status set code
        // .text:02386597 C7 83 40 81 02 00 A1 00 00 00   mov     dword ptr [ebx+28140h], 0A1h
        // .text:0238298D C7 86 40 81 02 00 A2 00 00 00   mov     dword ptr [esi+28140h], 0A2h
        // .text:0238291F C7 86 40 81 02 00 A3 00 00 00   mov     dword ptr [esi+28140h], 0A3h
        $set_status = {C7 ?? 40 81 02 00 (A1|A2|A3) 00 00 00}
    condition:
        filesize < 400KB and uint16(0) == 0x5a4d and (
        $arg_name or
        (3 of ($arg_hash*)) or
        #set_status > 2
        )
}

rule CrowdStrike_CSIT_20176_01 : artefact fancy_bear python pytunnel 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects PyTunnel samples from imported modules."
        reports = "CSIT-20176"
        version = "202101291827"
        last_modified = "2021-01-29"
        actor = "FANCY BEAR"
        malware_family = "PyTunnel"
    strings:
        $im = "import" ascii
        $i1 = "cselect as select" ascii
        $i2 = "socket" ascii
        $i3 = "from Crypto" ascii
    condition:
        all of them and (@im < @i1) and (@im < @i2) and filesize < 4MB
}

rule CrowdStrike_CSIT_20176_06 : artefact fancy_bear python pytunnel 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects format string for PyTunnel error messages"
        reports = "CSIT-20176"
        version = "202101291826"
        last_modified = "2021-01-29"
        actor = "FANCY BEAR"
        malware_family = "PyTunnel"
    strings:
        $f1 = "Handshake stage %d, message:" ascii
        $r1 = /Handshake stage \d+, message:/ ascii
        $f2 = "AG sock closing!" ascii
        $f3 = "Error closing ag socket!" ascii
        $f4 = "EXCEPT! Not sended http request" ascii
        $f5 = "ag_socket error! Exiting" ascii
        $f6 = "Error send to sps, exiting," ascii
        $f7 = "Recved from sps:" ascii
        $f8 = "Sended to sps:" ascii
        $f9 = "CLI SEND EWOULD BLOCK!!!" ascii
        $f10 = "Reconnect (recon_count %d). Waiting for %d seconds..." ascii
        $r10 = /Reconnect \(recon_count \d+\). Waiting for \d+ seconds.../ ascii
    condition:
        any of them and filesize < 1MB
}

rule CrowdStrike_CSIT_20176_05 : artefact fancy_bear python pytunnel 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects PyTunnel unique file names"
        reports = "CSIT-20176"
        version = "202101291827"
        last_modified = "2021-01-29"
        actor = "FANCY BEAR"
        malware_family = "PyTunnel"
    strings:
        $debug1 = "apswe.log" ascii
        $error1 = "apswe-err.log" ascii
    condition:
        any of them and filesize < 500KB
}

rule CrowdStrike_CSIT_20176_04 : artefact configuration fancy_bear python pytunnel 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects global variable names in PyTunnel"
        reports = "CSIT-20176"
        version = "202101291827"
        last_modified = "2021-01-29"
        actor = "FANCY BEAR"
        malware_family = "PyTunnel"
    strings:
        $crypto_01 = "CRYPTO_T_AES" ascii
        $crypto_02 = "CRYPTO_T_NONE" ascii
        $crypto_03 = "CRYPTO_TYPES" ascii
        $fake_00 = "FAKE_HTTP_PROXY_DATA" ascii
        $fake_01 = "FAKE_HTTP_REQUEST" ascii
        $fake_02 = "FAKE_HTTP_SERVERS" ascii
        $fake_03 = "FAKE_HTTP_USERAGENTS" ascii
        $http_00 = "HTTP_PROXY_AUTH_BASIC_HEADER" ascii
        $http_01 = "HTTP_PROXY_AUTH_BASIC_UP_FORMAT" ascii
        $http_02 = "HTTP_PROXY_CONNECT_METHOD" ascii
        $http_03 = "HTTP_PROXY_KEEP_ALIVE" ascii
        $handshake_03 = "HANDSHAKE_T_PLAIN" ascii
        $handshake_04 = "HANDSHAKE_T_RSA" ascii
        $handshake_05 = "HANDSHAKE_TYPES" ascii
        $pack_01 = "P_CONN_ID" ascii
        $pack_02 = "P_PACK_COMM" ascii
        $pack_03 = "P_PACK_CURR_LEN" ascii
        $pack_04 = "P_PACK_LEN" ascii
        $pack_05 = "P_PACK_SENDED_LEN" ascii
        $pack_06 = "P_PACKET" ascii
        $code_01 = "NOT_MSG_CODE" ascii
        $code_02 = "PING_CLIENT_CODE" ascii
        $code_03 = "DATA_CLIENT_CODE" ascii
        $code_04 = "CLOSE_CLIENT_CODE" ascii
        $code_05 = "CLOSE_CLIENT_COMM" ascii
        $socks_01 = "SOCKS_AT_DOMAIN" ascii
        $socks_02 = "SOCKS_AT_IP" ascii
        $socks_03 = "SOCKS_C_CONNECT" ascii
    condition:
        filesize < 500KB and
        (3 of ($pack_*) or 2 of ($code_*) or 2 of ($socks_*) or 2 of ($handshake_*) or 2 of ($http_*) or 2 of ($fake_*) or 2 of ($crypto_*))
}

rule CrowdStrike_CSIT_20176_03 : artefact fancy_bear python pytunnel 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects PyTunnel class names"
        reports = "CSIT-20176"
        version = "202101291827"
        last_modified = "2021-01-29"
        actor = "FANCY BEAR"
        malware_family = "PyTunnel"
    strings:
        $n1 = "DetectProxy" ascii
        $n2 = "APSConnection" ascii
        $n3 = "SPSCrypto" ascii
        $n4 = "SPSAg" ascii
    condition:
        2 of them and filesize < 500KB
}

rule CrowdStrike_CSIT_20176_02 : artefact fancy_bear python pytunnel 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects mistakes in PyTunnel function names"
        reports = "CSIT-20176"
        version = "202101291827"
        last_modified = "2021-01-29"
        actor = "FANCY BEAR"
        malware_family = "PyTunnel"
    strings:
        $t1 = "getEnablesProxy" ascii
        $t2 = "getDynamycProxy" ascii
    condition:
        any of them and filesize < 500KB
}

rule CrowdStrike_CSA_201261_01 : ketrican rat royalcli royaldns vixen_panda 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule matches on strings found across several malware families including RoyalCLI, RoyalDNS, and Ketrican. Use of this malware is associated with VIXEN PANDA at low confidence. "
        reports = "CSA-201261"
        version = "202010021550"
        last_modified = "2020-10-02"
        actor = "VIXEN PANDA"
        malware_family = "RoyalCLI-like"
    strings:
        $s1 = "myWObject"
        $s2 = "/?setssion==%d%d"
        $s3 = "/?newfrs%dsetssion=%d%d"
        $s4 = ":\\wininet_fr_"
        $s5 = "\\dlln\\Release\\dlln.pdb"
        $s6 = "-pl,MKO)"
        $t1 = "~temd"
        $t2 = "~tempd"
        $t3 = "?id1=%d"
        $t4 = "%s%s.ini" fullword
        $t5 = "%s%d.txt" fullword
    condition:
        uint16(0)==0x5a4d and filesize<1MB and (any of ($s*) or 3 of ($t*))
}

rule CrowdStrike_CSA_201210_03 : artefact batch primitive_bear word_remote_template_injector 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects SFX entry point batch scripts injecting remote templates in Word documents"
        reports = "CSA-201210"
        version = "202009181330"
        last_modified = "2020-09-18"
        actor = "PRIMITIVE BEAR"
        malware_family = "WordRemoteTemplateInjector"
    strings:
        $echo = "@echo off" ascii
        $chcp = "chcp 1251" ascii
        $dot = ".dot" ascii
        $doc = "docx" ascii
        $cmd_getmac = "('getmac^|find /i \"device\"')" ascii
        $cmd_schtasks = "@schtasks /Create" ascii
        $cmd_7za = "7za.exe" ascii
        $cmd_wscript = "wscript" ascii
        $path2 = "word" ascii
        $path1 = "_rels" ascii
        $path3 = ".xml.rels" ascii
    condition:
        filesize < 100KB and $echo at 0 and @chcp < 64 and #dot > 2 and $doc and 2 of ($cmd_*) and all of ($path*)
}

rule CrowdStrike_CSA_201210_01 : artefact primitive_bear vbscript word_remote_template_injector 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects a VBScript attaching a template to a Word document used by PRIMITIVE BEAR"
        reports = "CSA-201210"
        version = "202009181326"
        last_modified = "2020-09-18"
        actor = "PRIMITIVE BEAR"
        malware_family = "WordRemoteTemplateInjector"
    strings:
        $get_object = "GetObject(,\"Word.Application\")" ascii
        $get_arg = "Wscript.Arguments.Named.Item" ascii
        $create_object = "CreateObject(\"Word.Application\")" ascii
        $open = ".Documents.Open" ascii
        $attach = ".AttachedTemplate" ascii
        $save = ".Save()" ascii
    condition:
        filesize < 5KB and all of them and @get_object < @get_arg and @get_arg < @create_object and @create_object < @open and @open < @attach and @attach < @save
}

rule CrowdStrike_CSA_201210_02 : artefact primitive_bear vbscript word_remote_template_injector 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects a VBS script used by PRIMITIVE BEAR to disable security features of MS Office Word"
        reports = "CSA-201210"
        version = "202009181328"
        last_modified = "2020-09-18"
        actor = "PRIMITIVE BEAR"
        malware_family = "WordRemoteTemplateInjector"
    strings:
        $versions = "10 to 17" ascii
        $accessvbom = "AccessVBOM" ascii
        $vbawarnings = "VBAWarnings" ascii
        $regwrite = ".RegWrite" ascii
        $create_object = "CreateObject" ascii
        $dword = "REG_DWORD" ascii
    condition:
        filesize < 1KB and all of them
}

rule CrowdStrike_CSIT_20200_03 : ramsay rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects UID, custom XOR routine, and format string present in Ramsay main agent DLL"
        reports = "CSIT-20200"
        version = "202102191059"
        last_modified = "2021-02-19"
        malware_family = "Ramsay"
    strings:
        $uid = "{00000000-0000-0000-0000-000000000000}"
        $xor = { 35 fa 00 00 00 83 c0 23 }
        $format = "[%04d%02d%02d_%02d%02d%02d]_%s" wide
    condition:
        all of them and
        filesize < 1MB
}

rule CrowdStrike_Pyxie_Loader : loader pyxie 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects unpacked PyXie Loader"
        reports = "CSA-201280"
        version = "202105252105"
        last_modified = "2021-05-25"
        actor = "SPRITE SPIDER"
        malware_family = "Pyxie"
    strings:
        $s1= "DEFAULTCOMPNAME"
        $s2 = "release.exe" wide
        $s3 = ".gfids"
        $s4 = "?DllInit@@YAXXZ"
    condition:
        all of them
}

rule CrowdStrike_CSA_201273_01 : eggshell macos rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects payloads of the MacOS backdoor EggShell and its variant Milt"
        reports = "CSA-201273,CSA-201334"
        version = "202010131342"
        last_modified = "2020-10-13"
        malware_family = "EggShell"
    strings:
        // Variant espl:
        $ = "captureImageWithBlock"
        $ = "changeDirectory"
        $ = "getcapturedevice"
        $ = "getFacebook"
        $ = "getPasteBoard"
        $ = "keyStroke"
        $ = "killTask"
        $ = "listDirectory"
        $ = "runAppleScript"
        $ = "sendFile"
        $ = "setAudioRecorder"
        $ = "setFileManager"
        $ = "setSession"
        $ = "setStillImageOutput"
        $ = "setSystask"
        $ = "tabComplete"
        $ = "takePicture"
        // Variant milt:
        $ = "sendExitAnswer"
        $ = "sendInputFile"
        $ = "sendPasteFile"
        $ = "sendsss"
    condition:
        uint32(0) == 0xfeedfacf and 15 of them and filesize < 500KB
}

rule CrowdStrike_CSIT_20230_01 : carbon_spider domenus downloader ecrime javascript 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects Domenus Stager JS that downloads CARBON SPIDER's Domenus JS Downloader"
        reports = "CSIT-20230"
        version = "202101291829"
        last_modified = "2021-01-29"
        actor = "CARBON SPIDER"
        malware_family = "Domenus"
    strings:
        //;eval(amuwr.split("un3").join(""));var
        $a1 = { 3b 65 76 61 6c 28 [2-10] 2e 73 70 6c 69 74 28 22 [2-10] 22 29 2e 6a 6f 69 6e 28 22 22 29 29 3b 76 61 72 }
    condition:
        all of them
}

rule CrowdStrike_CSA_201486_01 : artifact backdoor dotnet mistygulf oceandrive 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects a tool downloading next-stages on Google Drive alledgedly operated by FANCY BEAR"
        reports = "CSA-201486"
        version = "202011271111"
        last_modified = "2020-11-27"
        actor = "MistyGulf"
        malware_family = "OceanDrive"
    strings:
        $param_client_id = "client_id=" wide
        $param_grant_type = "grant_type=refresh_token" wide
        $param_refresh_token = "refresh_token=" wide
        $http_boundary = "multipart/related; boundary=\"boundary_tag\"" wide fullword
        $http_bearer_header = "Bearer " wide fullword
        $http_param = "?alt=media" wide fullword
        $http_content_type = "application/x-www-form-urlencoded" wide fullword
        $known_token = "1//09Wg_ouHxX40NCgYIARAAGAkSNwF-L9IrtRfvYq3COQPFt-QJceqcvGJx16GTj9drgvk2U_o2NFEIWsyoQ5_cb1yjso9L87W7mWY" wide
        $persistence_dir = "\\AppData\\Roaming\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\\" wide
        $persistence_name_gdrive = "gdrive.exe" wide fullword
        $binary_internal_name = "ExeFromTxt" wide fullword
        $url_googleusercontnet = "apps.googleusercontent.com" wide
        $url_upload = "https://www.googleapis.com/upload/drive/v3/files" wide
        $url_oauth = "https://oauth2.googleapis.com/token" wide
        $url_download = "https://www.googleapis.com/drive/v3/files" wide
        $dotnet = "BSJB" ascii
    condition:
        filesize < 1MB and (
        $known_token or
        ($persistence_dir and any of ($persistence_name_*)) or
        (4 of ($http_*) and 1 of ($url_*) and all of ($param_*)) or
        uint16(0) == 0x5a4d and $dotnet and $binary_internal_name
        )
}

rule CrowdStrike_CSIT_20200_01 : dropper ramsay 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects marker strings used in Ramsay infected file that acts as a first stage dropper"
        reports = "CSIT-20200"
        version = "202102191059"
        last_modified = "2021-02-19"
        malware_family = "Ramsay"
    strings:
        $m1 = "4znZCTTa2J24E64GzUxaUnYg"
        $m2 = "2A2rRhArF6akS9PaRZBwdrbn"
        $m3 = "pN64RaafaQfjWXjM3Ku3Ukq"
        $m4 = "9J7uQTqgTxhqHaGUue5caaEr3KU"
    condition:
        uint16(0) == 0x5a4d and
        all of them
}

rule CrowdStrike_CSA_201252_02 : powgoop static_kitten 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects strings used in .NET PowGoop"
        reports = "CSA-201252"
        version = "202010211248"
        last_modified = "2020-10-21"
        actor = "STATIC KITTEN"
        malware_family = "PowGoop"
    strings:
        $a_1 = "GetModulePath"
        $a_2 = "hModule"
        $a_3 = "GetModuleDirPath"
        $a_4 = "Read"
        $a_5 = "szPath"
        $a_6 = "dwSize"
        $a_7 = "Write"
        $a_8 = "pbBuff"
        $a_9 = "script"
        $a_10 = "DownloadString"
        $a_11 = "address"
        $a_12 = "DllRegisterServer"
        $a_13 = "hwnd"
        $a_14 = "hinst"
        $a_15 = "pszCmdLine"
        $a_16 = "nCmdShow"
        $a_17 = "DllMain"
        $a_18 = "PipelineState"
        $a_19 = "RunspaceFactory"
        $a_20 = "WebClient"
        $a_21 = "CreateFileW"
        $a_22 = "GetFileSize"
        $a_23 = "VirtualAlloc"
        $a_24 = "ReadFile"
        $a_25 = "CloseHandle"
        $a_26 = "WriteFile"
        $a_27 = "CLI.dll"
        $b_1 = ":\\Project\\Covic\\"
        $c_1 = "std.basic_string"
        $c_2 = "std::char_traits"
    condition:
        filesize < 1MB and
        (
        (21 of ($a_*) and
        all of ($c_*)) or
        any of ($b_*)
        )
}

rule CrowdStrike_CSIT_20187_01 : ecrime hta javascript jsoutprox rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects JsOutProx when delivered as an HTA file"
        reports = "CSIT-20187"
        version = "202010222228"
        last_modified = "2020-10-22"
        malware_family = "JsOutProx"
    strings:
        $a = "<HTA:APPLICATION icon=\"#\" SHOWINTASKBAR=\"no\">"
        $js1 = "<script language=\"JScript\">"
        $js2 = "atob"
        $js3 = "return new ActiveXObject"
        $js4 = "new Date()"
    condition:
        uint16(0) != 0x5a4d and
        ( filesize > 300KB and filesize < 2MB ) and
        all of them
}

rule CrowdStrike_CSA_201278_01 : loader logicalduckbill powershell spreader tarnishedgauntlet 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects LogicalDuckBill through characteristic code snippets"
        reports = "CSA-201278,CSIT-20214"
        version = "202011161959"
        last_modified = "2020-11-16"
        malware_family = "LogicalDuckBill"
        activity_cluster = "TarnishedGauntlet"
    strings:
        $ = "[System.Text.Encoding]::ASCII.GetString([System.Convert]::FromBase64String($"
        $ = "iex($"
        $ = ".locked -ErrorAction SilentlyContinue).Length -ne 0){"
        $ = "[Program]::Do([Int32]$"
        $ = "(Get-NetTCPConnection).RemoteAddress"
        $ = "[0] -eq '10'){"
        $ = "[0] -eq '172'){"
        $ = "[0] -eq '192'){"
        $ = "net use"
        $ = "wmic /node:$"
    condition:
        5 of them
}

rule CrowdStrike_CSA_201269_01 : artefact bitmap fancy_bear zekapab 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects a bitmap found in Zekapab samples from august 2020"
        reports = "CSA-201269"
        version = "202010021546"
        last_modified = "2020-10-02"
        actor = "FANCY BEAR"
        malware_family = "Zekapab"
    strings:
        $bitmap_header = {42 4d 0e d1 01 00 00 00 00 00 36 00 00 00 28 00 00 00 d2 01 00 00 55 00 00 00}
        $bitmap_data = {c6 c7 a8 a8 a9 8e 8e 8f 7b 7b 7c 6e 6e 6f 6e 6e 6f 7b 7b 7c 8e 8e 8f a8 a8 a9 c6 c6 c7 e9 e9 e9}
    condition:
        all of them and $bitmap_data at (@bitmap_header + 0x99c0)
}

rule CrowdStrike_CSIT_20200_02 : dropper ramsay 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects file names, parameters and batch script variables observed in the Ramsay dropper"
        reports = "CSIT-20200"
        version = "202102191059"
        last_modified = "2021-02-19"
        malware_family = "Ramsay"
    strings:
        $param = "gQ9VOe5m8zP6" wide
        $fname1 = "wideshut.exe" wide
        $fname2 = "wimsvc.exe" wide
        $msfte = "msfte.dll" wide
        $msdtc =  "/c sc config msdtc obj= LocalSystem" wide
        $bat1 = "Repeat 1"
        $bat2 = "goto Repeat 1"
    condition:
        uint16(0) == 0x5a4d and
        all of them and
        filesize < 2MB
}

rule CrowdStrike_CSA_201251_01 : gifstealer infostealer silent_chollima 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects strings used in GifStealer infostealer used to generate filenames, volatile artifacts, and execute commands"
        reports = "CSA-201251"
        version = "202009281330"
        last_modified = "2020-09-28"
        actor = "SILENT CHOLLIMA"
        malware_family = "GifStealer"
    strings:
        // ZipCrypto password generation
        $zip_password_bytes = { 78 56 34 12 [1-9] 89 67 45 23 [1-9] 90 78 56 34 }
        // Strings used to execute commands
        $cmd_info = "/c ipconfig /all > \x22%s\x22 & tasklist > \x22%s\x22 & netstat -naop tcp > \x22" fullword
        $cmd_self_delete = "/c ping -n 3 127.0.0.1 >NUL & echo EEEE > \x22%s\x22" fullword
        // Filenames
        $file_ipconfig = "%s\\res.ip" fullword
        $file_tasklist = "%s\\task.list" fullword
        $file_netstat = "%s\\netstat.res" fullword
        // Mutex
        $mutex = "MTX_Global\\Xo45hTye"
        // Fake GIF header
        $header_gif_fake = "GIF89aAPS" fullword ascii
    condition:
        $zip_password_bytes and
        1 of ($cmd*) and
        1 of ($file*) and
        ($mutex or $header_gif_fake)
}

rule CrowdStrike_CSA_201254_01 : exploit zerologon 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects .NET based ZeroLogon exploit"
        reports = "CSA-201254"
        version = "202009251043"
        last_modified = "2020-09-25"
    strings:
        $flags = { 20 ff ff 2f 21 }
        $init_obj = { FE 15 } // uses initobj to create per default all zero buf
        $netlogon_cred = "NETLOGON_CREDENTIAL"
        $req_challenge = "I_NetServerReqChallenge"
        $auth = "I_NetServerAuthenticate2"
        $channel_type = "NETLOGON_SECURE_CHANNEL_TYPE"
        $changing_password = "I_NetServerPasswordSet2"
    condition:
        all of them and
        filesize < 20KB and
        uint16(0) == 0x5a4d and uint32(uint32(0x3c)) == 0x4550 and
        // Mono/.NET 32bit
        ((uint16(uint32(0x3c)+24) == 0x010b and int32(uint32(0x3c)+232) > 0) or
        // Mono/.NET 64bit
        (uint16(uint32(0x3c)+24) == 0x020b and int32(uint32(0x3c)+248) > 0))
}

rule CrowdStrike_CSA_201254_02 : exploit zerologon 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects .NET based ZeroLogon exploit which can be executed from a non domain-joined computers"
        reports = "CSA-201254"
        version = "202009251347"
        last_modified = "2020-09-25"
    strings:
        $lib = "logoncli.dll" wide
        $byte_array = { 1f 0a 8d ?? 00 00 01 25 d0 01 00 00 04 28 } // CIL code to init array
        // Functions used for patching
        $read_proc_mem = "ReadProcessMemory"
        $virtual_protect = "VirtualProtect"
        $write_byte = "WriteByte"
        $flags = { 20 ff ff 2f 21 }
        $init_obj = { fe 15 } // uses initobj to create per default all zero buf
        $netlogon_cred = "NETLOGON_CREDENTIAL"
        $req_challenge = "I_NetServerReqChallenge"
        $auth = "I_NetServerAuthenticate2"
        $channel_type = "NETLOGON_SECURE_CHANNEL_TYPE"
        $changing_password = "I_NetServerPasswordSet2"
    condition:
        all of them and
        filesize < 20KB and
        uint16(0) == 0x5a4d and uint32(uint32(0x3c)) == 0x4550 and
        // Mono/.NET 32bit
        ((uint16(uint32(0x3c)+24) == 0x010b and int32(uint32(0x3c)+232) > 0) or
        // Mono/.NET 64bit
        (uint16(uint32(0x3c)+24) == 0x020b and int32(uint32(0x3c)+248) > 0))
}

rule CrowdStrike_CSA_201263_01 : carbon_spider dll 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects stager DLLs used by CARBON SPIDER, which are being loaded by their PowerShell loader."
        reports = "CSA-201263"
        version = "202106151541"
        last_modified = "2021-06-15"
    strings:
        $s2 = "data$zzzdbg"
        $s3 = "ReflectiveLoader"
        $s4 = "SystemFunction036"
        $s5 = "Iphl"
        $s6 = { 00 74 2e 64 6c 6c 00 }
        $hash_a = { 3D 5B BC 4A 6A }
        $hash_b = { 8E 4E 0E EC }
        $hash_c = { AA FC 0D 7C }
        $hash_d = { 54 CA AF 91 }
        $hash_e = { 5D 68 FA 3C }
        $hash_f = { B8 0A 4C 53 }
        $hash_g = { B8 43 08 21 84 }
    condition:
        ((($s2 and $s3 and $s4 and ($s5 or $s6))) or
        (all of ($hash*)))
        and (filesize < 60KB)
}

rule CSIT_20203_01 : loader scout 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects samples of the Scout's loader"
        reports = "CSIT-20203"
        version = "202010211411"
        last_modified = "2020-10-21"
        malware_family = "Scout Loader"
    strings:
        $mg_ms = { 50 4B 03 04 }
        $tag1 = "<html>"
        $tag2 = "<script type=\"text/javascript\">"
        $s1 = "for(var i=0;i<z"
        $s2 = ".join(\"\")};eval("
        $s3 = ".charCodeAt(i%"
    condition:
        uint16(0) == 0x004C and
        $mg_ms and
        any of ($tag*) and
        2 of ($s*)
}

rule CSIT_20203_02 : loader scout 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects samples of the Scout Loader Second Stage"
        reports = "CSIT-20203"
        version = "202010211412"
        last_modified = "2020-10-21"
        malware_family = "Scout Loader"
    strings:
        $r1 = "-Count 8 | &('%')"
        $r2 = "(48..57) + (97..122)"
        $r3 = "-ScOUT"
        $r4 = ".(\"{1}{0}{2}\" -f "
        $e1 = "GlObAlAl"
        $e2 = "[TyPe](\"{"
        $e3 = "E:5Kp"
        $e4 = "').Invoke( "
        $e5 = "','"
        $e6 = "')|&(\"{"
        $e7 = "-K  "
    condition:
        3 of ($r*) or 5 of ($e*)
}

rule CSIT_20203_04 : ransomware scout 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects samples of Scout's ransomware module"
        reports = "CSIT-20203"
        version = "202010211411"
        last_modified = "2020-10-21"
        malware_family = "Scout Ransomware"
    strings:
        $ = "README_BASED"
        $ = "gl_Mutex"
        $ = "gl_BuildId"
        $ = "index.php?r=bag"
        $ = "REPORTS_ENDPOINT"
        $ = "$j = ($j + $s[$i]) % 256"
        $ = "mailclients"
    condition:
        5 of them
}

rule CrowdStrike_CSIT_20193_01 : ecrime golang ransomware sorena 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects Sorena Ransomware based on sample strings"
        reports = "CSIT-20193"
        version = "202010281824"
        last_modified = "2020-10-28"
        malware_family = "Sorena"
    strings:
        $go = "Go build ID:"
        $note1 = "You Have 2days to Decide to Pay"
        $note2 = "All Your Files Has Been Locked!"
        $note3 = "unique Id :"
        $note4 = "AES RSA 256"
        $note5 = "AES-256, RSA-2848"
        $note6 = "just a business"
        $fname1 = "main.GoRoutingEncrypt"
        $fname2 = "main.getCode"
        $fname3 = "main.getdrives"
        $fname4 = "main.RunFuckLogAndSoft"
        $fname5 = "main.MessageRan"
    condition:
        $go and
        2 of ($note*) and
        2 of ($fname*) and
        filesize > 1MB and filesize < 5MB
}

rule CrowdStrike_CSIT_20194_01 : artefact delphi fancy_bear imports zekapab 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects screenshot capabilities in Zekapab"
        reports = "CSIT-20194"
        version = "202011271111"
        last_modified = "2020-11-27"
        actor = "FANCY BEAR"
        malware_family = "Zekapab"
    strings:
        $s_get_device_caps = "GetDeviceCaps" ascii fullword
        $s_bitmap = "Bitmap" ascii fullword
        $s_canvas = "Canvas" ascii fullword
        $s_TextHeight = "TextHeight" ascii fullword
        $s_TextWidth = "TextWidth" ascii fullword
        $s_get_desktop_window = "GetDesktopWindow" ascii fullword
        $s_jpeg_image = "JPEGImage" ascii fullword
        $p_borland = { 50 e8 ?? ?? ?? ?? 68 20 00 cc 00 6a 0a 8b 45 ?? 50 e8 }
        $p_embarcadero = { 50 e8 ?? ?? ?? ?? 68 20 00 cc 00 6a 0a ff ?? ?? e8 }
    condition:
        filesize < 5MB and
        any of ($p_*) and
        4 of ($s_*)
}

rule CrowdStrike_CSA_201269_03 : artefact delphi fancy_bear zekapab 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects encoded strings in Zekapab"
        reports = "CSA-201269"
        version = "202010120955"
        last_modified = "2020-10-12"
        actor = "FANCY BEAR"
        malware_family = "Zekapab"
    strings:
        $s_schtasks_delete = "7363687461736B73202F44656C657465" wide
        $s_http = "687474703A2F2F" wide
        $s_php = "2E706870" wide
        $s_schtasks_create = "7363687461736B73202F437265617465202F5343204D494E555445202F4D4F" wide
        $s_cmd_copy = "636D642E657865202F6320636F7079" wide
        $s_error = "4572526F72" wide
    condition:
        filesize < 5MB and uint16(0) == 0x5a4d and all of them
}

rule CSIT_20203_03 : rat scout 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects samples of Scout's RAT module"
        reports = "CSIT-20203"
        version = "202010211412"
        last_modified = "2020-10-21"
        malware_family = "Scout RAT"
    strings:
        $rc4_1 = "${I} = (${i} + 1) % 256" nocase wide ascii
        $rc4_2 = "${j} = (${J} + ${s}[${I}]) % 256" nocase wide ascii
        $rc4_3 = "for (${i} = 0; ${I} -lt 256; ${I}++)" nocase wide ascii
        $rc4_4 = "${J} = (${J} + ${s}[${i}] + ${k}[${I}]) % 256" nocase wide ascii
        $s_1 = "e} = \"MD5\")" nocase wide ascii
        $s_2 = "${clIEntiD}" nocase wide ascii
        $s_3 = "').Invoke((\"{0}{1}{2}{3}\" -f " wide ascii
        $s_4 = "DY} = [byte[]][char[]]${b" nocase wide ascii
        $s_5 = "R} = [System.IO.StreamReader](${R" nocase wide ascii
        $s_6 = "-Rc4" wide ascii
    condition:
        3 of ($rc4*) or 3 of ($s*)
}

rule CrowdStrike_CSIT_20194_02 : artefact delphi fancy_bear zekapab 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects paths found in Zekapab linked to assertion errors of the IdHttp.pas library"
        reports = "CSIT-20194"
        version = "202011271112"
        last_modified = "2020-11-27"
        actor = "FANCY BEAR"
        malware_family = "Zekapab"
    strings:
        $path01 = "C:\\Users\\user\\Documents\\Borland Studio Projects\\22 - 0\\IdHTTP.pas" ascii wide
        $path02 = "C:\\Users\\Public\\Documents\\RAD Studio\\10.0\\Pro\\IdHTTP.pas" ascii wide
    condition:
        filesize < 5MB and any of them
}

rule CrowdStrike_CSIT_21112_02 : backdoor carbon_spider domenusps powershell 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects strings in the CARBON SPIDER Domenus PowerShell backdoor."
        reports = "CSIT-21112"
        version = "202105280931"
        last_modified = "2021-05-28"
        actor = "CARBON SPIDER"
        malware_family = "DomenusPS"
    strings:
        $code_1 = "[io.file]::ReadAllBytes('c:\\windows\\system32\\shell32.dll')" nocase
        $code_3 = "-ea SilentlyContinue | Out-String" nocase
        $code_4 = "Get-Variable URL -ea SilentlyContinue" nocase
        $code_5 = "Get-Variable Interval -ea SilentlyContinue" nocase
        $code_6 = "Get-Variable Log -ea SilentlyContinue" nocase
        $code_7 = "Get-Variable Debug -ea SilentlyContinue" nocase
        $code_8 = "Get-Variable Autoremove -ea SilentlyContinue" nocase
        $error_message_1 = "[!] DLL task execution error" nocase
        $error_message_2 = "[!] EXE task execution error" nocase
        $error_message_3 = "[!] JS task execution error" nocase
        $error_message_4 = "ERROR: PS task execution error" nocase
        $error_message_5 = "[!] Invalid task format" nocase
        $error_message_6 = "[!] Send-WebQuery error" nocase
        $error_message_7 = "ERROR: output file '$cmdOutFile' not found"  nocase
    condition:
        2 of ($error_message_*) or 2 of ($code_*)
}

rule CrowdStrike_CSA_201281_01 : delphi rat silent_chollima valefor 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects strings used in the Delphi version of the Valefor RAT for naming artifacts and command execution"
        reports = "CSA-201281,CSIT-21009"
        version = "202101200147"
        last_modified = "2021-01-20"
        actor = "SILENT_CHOLLIMA"
        malware_family = "Valefor"
    strings:
        $cmd_string = "%s\\\\cmd.exe /c %s" fullword
        $delete_string = "/c ping -n 4 127.0.0.1 >NUL & echo VFB > \"%s\"" fullword
        $info_string_0 = "ForeGround Window" fullword
        $info_string_1 = "Volatile Environment" fullword
        $name_0 = "VSingle."
        $name_1 = "Valefor" fullword
    condition:
        uint16(0) == 0x5a4d and 3 of them and filesize < 1MB
}

rule CrowdStrike_CSIT_20239_02 : loader routergod wicked_panda 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects distinctive code in RouterGod loader executables"
        reports = "CSIT-20239"
        version = "202102051109"
        last_modified = "2021-02-05"
        actor = "WICKED PANDA"
        malware_family = "RouterGod"
    strings:
        $bytes1 = { (ff|00) (ff|00) (ff|00) (ff|00) (ff|00) e9 4b 0a 00 00 cc cc cc cc cc cc cc cc cc cc cc 48 89 5c 24 08 }
        $bytes2 = { 44 0f b7 c8 0f 1f 44 00 00 0f be 01 41 c1 c8 0d 3c 61 }
        $bytes3 = { cc cc 56 48 8b f4 48 83 e4 f0 48 83 ec 20 e8 00 00 00 00 59 e8 a9 f5 ff ff 48 8b e6 5e c3 }
        $bytes4 = { c7 44 24 58 23 67 2f cb c7 44 24 5c 3a ab d2 11 }
        $bytes5 = { 45 8b 0b 4d 8d 5b 04 4c 03 cb 41 8b c7 66 90 }
    condition:
        uint16(0)==0x5a4d and
        filesize < 1MB and
        any of ($bytes*)
}

rule CrowdStrike_TVRat_01 : backdoor tvrat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects the TVRat backdoor module."
        version = "202010021603"
        last_modified = "2020-10-02"
        malware_family = "TVRat"
    strings:
        // Function to rebase pointers:
        $tv_rebase = {5589E5608B550885D2750D648B15180000008B52308B52083B550C74118B751089F78B4D14AD2B450C01D0ABE2F761C9C21000}
        // mov dword ptr [ebp-??], 'tv_w'
        // mov dword ptr [ebp-??], '32.d'
        $tvw32_stackstring = {
        C7 45 ?? 74 76 5F 77
        C7 45 ?? 33 32 2E 64
        }
        // call 0x0B
        // db 'tv_w32.dll',0
        $tvw32_call_pop_ascii = {
        E80B000000
        74765F7733322E646C6C
        00
        }
        // wide variant
        // 32a96f857d18bebc18aef89f36beeaa60d75302424ac945d2146105b7008fd87
        $tvw32_call_pop_utf16 = {
        E816000000
        740076005F0077003300
        32002E0064006C006C00
        0000
        }
        // Code snippets from CRC32 routine:
        $tv_crc32a = {C1C00450240F2704F01440AA58E2F1B000AA}
        $tv_crc32b = {31C031DBAC30C888E988D588F2B60866D1EB66D1D873??663520836681F3B8ED}
        // Code snippets from RC4 routine:
        // WARNING: This RC4 implementation overlaps with Tinba code and
        // is not, by itself, indicative of TVRat.
        $rc4a = {31C9880C0F4181F90001000075F4}
        $rc4b = {8A040F021C1600C38A241F88240F88041F4181F900010000}
        $rc4c = {FEC38A141F00D08A0C07880C1F88140700D18A0C0F300E46}
    condition:
        2 of ($tv*) and 3 of them
}

rule CrowdStrike_CSIT_20192_01 : ecrime formjacking javascript 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects common strings in Magecart formjacking script"
        reports = "CSIT-20192"
        version = "202101291830"
        last_modified = "2021-01-29"
        malware_family = "Magecart"
    strings:
        $str1 = "GetCCInfo: function()" fullword
        $str2 = "Data['Number'] === undefined ||"
        $str3 = "Data['Holder'] === undefined ||"
        $str4 = "Data['Date'] === undefined ||"
        $str5 = "Data['CVV'] === undefined ||"
        $gate = "Gate:"
        $getcvv = /document\.getElementById\(\$\S{1,10}\.CVV\)\.value/
        $setinterval = /setInterval\(\$\S{1,10}\.TrySend\, 500\)\;/
    condition:
        filesize < 1MB and 5 of them
}

rule CrowdStrike_CSA_201295_01 : rat slothful_media 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects a remote access tool named Slothful Media."
        reports = "CSA-201295"
        version = "202010021707"
        last_modified = "2020-10-02"
        malware_family = "Slothful Media"
    strings:
        // c2 strings
        $c2_1 = "/v?m"
        $c2_2 = "%s&i=%d"
        // c2 xor routines
        // from f0503f0131040b805e106eafe64a65d9404a0e279f052237b868e456c34d36e6
        $xor_sub_408024 = { 8B C? BF 90 00 00 00 F7 F7 8A ?? ?? ?? ?? ?? 30 0?  }
        // from 320cf030b3d28fcddcf0a3ef541dea15599d516cb6edaad53ec9be6b708d15c2
        $xor_sub_410c99 = { 33 D2 BE 90 00 00 00 F7 F6 0F ?? ?? ?? ?? ?? ?? 33 c8 }
    condition:
        all of ($c2_*) or 1 of ($xor_sub*)
}

rule CrowdStrike_CSA_201295_02 : rat slothful_media 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule matches against strings identified in the Slothful Media RAT."
        reports = "CSA-201295"
        version = "202106081515"
        last_modified = "2021-06-08"
        malware_family = "Slothful Media"
    strings:
        $ = "AppData\\Roaming\\Media\\mediaplayer.exe"
        $ = "ExtRegItemDel"
        $ = "ExtKeyloggerS"
        $ = "ExtKeyloggerStop"
        $ = "%s\\media.lnk"
        $ = "\\Filter3.jpg" wide
        $ = " sess5^a" wide
        $ = "MEDIAP~1.EXE"
        $ = "TaskFrame Test!"
    condition:
        2 of them
}

rule CrowdStrike_CSA_201298_01 : roguewave xddown 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects string decryption in 32-bit and 64-bit variants of XDDown."
        reports = "CSA-201298"
        version = "202103111615"
        last_modified = "2021-03-11"
        malware_family = "XDDown"
        activity_cluster = "RogueWave"
    strings:
        $bytes_0x140002100_0x14000211d  = { 41 88 04 08 49 ff c0 49 83 f8 0b 7c e8 }
        $bytes_0x40f09a_0x40f0c0  = { 2c 3d 80 e9 3d 80 ea 3d a2  }
    condition:
        any of them
}

rule CrowdStrike_CSA_201298_02 : roguewave 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects unique DLL and export name used by RogueWave Command DLLs."
        reports = "CSA-201298"
        version = "202103111614"
        last_modified = "2021-03-11"
        activity_cluster = "RogueWave"
        
    strings:
        $ = "commandC_dll.dll"
        $ = "versionValidation"
    condition:
        all of them
}

rule CrowdStrike_Malicious_Base64_Decode_VBScript_Downloader : downloader vbscript 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule matches against a string found in a base64 decoding function commonly used in or with malicious HTA and/or VB scripts."
        version = "202012240929"
        last_modified = "2020-12-24"
    strings:
        $outstring = "sPreliminaryOutString = Chr(CByte("
    condition:
        $outstring
}

rule CrowdStrike_RMS_RAT_01 : rat rms 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects a Remote Utilities based backdoor based on hex-encoded XML configuration substrings."
        version = "202010091338"
        last_modified = "2020-10-09"
        malware_family = "RMS"
    strings:
        $msi = {D0 CF 11 E0 A1 B1 1A E1}
        $rms1 = "3C726D735F696E65745F69645F6E6F74696669636174696F6E2076657273696F6E3D" ascii
        $rms2 = "3C73656375726974795F73657474696E67732076657273696F6E3D" ascii
        $rms3 = "3C637573746F6D5F7365727665725F6C6973743E" ascii
        $custom_ip_start = "3C69645F637573746F6D5F7365727665725F616464726573733E" ascii
        $custom_ip_end = "3C2F69645F637573746F6D5F7365727665725F616464726573733E" ascii
        $user_access = "3C757365725F6163636573733E" ascii
        $send_to_email = "3C73656E645F746F5F656D61696C3E747275653C2F73656E645F746F5F656D61696C3E" ascii
    condition:
        $msi at 0 and any of ($rms*) and (@custom_ip_end != @custom_ip_start + 52 or $user_access or $send_to_email)
}

rule CrowdStrike_CSIT_20200_05 : commodity ramsay rootkit 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Commodity rootkit observed being used by Ramsay implant"
        reports = "CSIT-20200"
        version = "202102191059"
        last_modified = "2021-02-19"
        malware_family = "Ramsay"
    strings:
        $class = "HideDriver::HookMng::"
        $pdb = "HideDriver.pdb"
        $device = "\\Device\\HideDriver"
        $start = "------HIDE DRIVER START------"
        $irp = { 2d 04 24 22 00 ?? ?? 83 e8 04 ?? ?? 83 e8 04 ?? ?? 83 e8 04 }
    condition:
        3 of them
}

rule CrowdStrike_CSIT_20200_04 : infector ramsay spreader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects the spreader component for Ramsay used for local and network file infection"
        reports = "CSIT-20200"
        version = "202102191059"
        last_modified = "2021-02-19"
        malware_family = "Ramsay"
    strings:
        $log = "[%d, %d-%02d-%02d %02d:%02d:%02d]" wide
        $debug = "Ramsay is not exist. I will finish." wide
        $fname = "trnmg.sdb"
        $trn = "===== Start TRN Local " wide
        $m1 = "4znZCTTa2J24"
        $m2 = "E64GzUxaUnYg"
        $m3 = "2A2rRhArF6ak"
        $m4 = "S9PaRZBwdrbn"
        $m5 = "pN64RaafaQfj"
        $m6 = "WXjM3Ku3UkqP"
        $m7 = "9J7uQTqgTxhq"
        $m8 = "HaGUue5caaEr"
        $m9 = "9J7uQTqgTxhq"
        $m10 = "HaGUue5caaEr"
    condition:
        2 of ($log,$debug,$fname,$trn) and
        5 of ($m*) and
        filesize < 1MB
}

rule CrowdStrike_CSA_201345_01 : ecrime egregor packer sekhmet twisted_spider 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects a packer likely used by the Egregor and Sekhmet ransomware families"
        reports = "CSA-201345,CSIT-20208"
        version = "202102111604"
        last_modified = "2021-02-11"
        actor = "TWISTED SPIDER"
        malware_family = "egregor"
    strings:
        $keys = /\b([!-~]{32})\x00{1,50}([!-~]{8})\x00/
        $chacha_magic = "expand 32-byte kexpand 16-byte k"
        $chacha8 = { c7 45 bc 08 00 00 00 }
        $snip_cmp_keysize = { 81 7d 10 00 01 00 00 }
        $snip_initial_xor = { 0f be 04 08 83 f0 }
        $snip_peload = { 81 f9 4d 5a 00 00 }
    condition:
        $keys and
        4 of them and
        filesize < 1MB and uint16(0) == 0x5a4d
}

rule CrowdStrike_CSA_201351_01 : blackhome discard_rus post_exploitation scanner 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This detects a low-prevalence scanning tool possibly in use by China-based adversaries dubbed BlackHome."
        reports = "CSA-201351"
        version = "202010231034"
        last_modified = "2020-10-23"
        malware_family = "BlackHome Network Scanner"
    strings:
        $ = "Scan start : %d hosts , port %d  %d threads ..."
        $ = "Multi-Service Information Scanner, Copyright (c) 2015 Black Home"
        $ = "Administrator\\Desktop\\myscan_ver\\myscan_ver"
        $ = " %s [-s startip] [-e endip] [-p port] [-t timeout] [-n maxthreadnum] [-l logfile] [-h?]"
        $ = "User-Agent: nonexist"
        $ = "%-40s MySQL Server %s"
        $ = "pysb  <-s start ip> <-"
    condition:
        any of them
}

rule CrowdStrike_CSA_201345_02 : ecrime egregor ransomware twisted_spider unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects unpacked Egregor ransomware in memory dumps."
        reports = "CSA-201345,CSIT-20208"
        version = "202101262035"
        last_modified = "2021-01-26"
        actor = "TWISTED SPIDER"
        malware_family = "Egregor"
    strings:
        $chacha = "expand 32-byte kexpand 16-byte k" ascii
        $junkvals = { c7 [3] 81 11 14 14 c7 [3] 19 18 ae 4f }
        $obfus1 = { 6a 00 6a 00 68 [4] c3 }
        $obfus2 = { 0f 85 [4] 74 ?? 68 [4] c3 }
        $obfus3 = { 0f 84 [4] 0f 85 [4] 0f 84 [4] 68 [4] c3 }
        $xorcheck = { 8b 84 24 [4] 31 c9 33 84 24 [4] 3d b5 00 6b b1 }
    condition:
        all of them
}

rule CrowdStrike_CSA_201354_01 : rat scorchedepoch tikrat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects Tikrat variant through characteristic strings in the C2 protocol"
        reports = "CSA-201354"
        version = "202101291825"
        last_modified = "2021-01-29"
        malware_family = "TikRat"
        activity_cluster = "ScorchedEpoch"
    strings:
        $ = "{%08x-%04hx-%04hx-%02hhx%02hhx-%02hhx%02hhx%02hhx%02hhx%02hhx%02hhx}" ascii
        $ = "DNS_QUERY_STANDARD" ascii
    condition:
        all of them
}

rule CrowdStrike_CSA_201354_02 : rat scorchedepoch tikrat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects Tikrat variant through characteristic API use and signaling IP"
        reports = "CSA-201354"
        version = "202101291825"
        last_modified = "2021-01-29"
        malware_family = "TikRat"
        activity_cluster = "ScorchedEpoch"
    strings:
        $ = "cmd /c nslookup -retry=2 -type=" ascii
        $ = "35.101.120.32" ascii
    condition:
        all of them
}

rule CrowdStrike_CSA_210259_01 : infostealer solarmarker solarmarkerstealer 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects in-memory version of SolarMarker Stealer"
        reports = "CSA-210259"
        version = "202105261821"
        last_modified = "2021-05-26"
        malware_family = "SolarMarkerStealer"
    strings:
        $victim_id_file = "\\AppData\\Roaming\\solarmarker.dat" wide
        $victim_id_stack_string={1F 53 9D 09 17 1F 4F 9D 09 18 1F 4C 9D 09 19 1F 41 9D 09 1A 1F 52 9D 09 1B 1F 4D 9D 09 1C 1F 41 9D 09 1D 1F 52 9D 09 1E 1F 4B 9D 09 1F 09 1F 45 9D 09 1F 0A 1F 52}
        $s_browser_logins= "\\logins.json" wide
        $s_browser_keys="\\key4.db" wide
        $s_browser_certs="\\cert9.db" wide
        $s_browser_cookies="\\cookies.sqlite" wide
        $s_browser_forms="\\formhistory.sqlite" wide
        $s_passwords_json_key="os_crypt" wide
        $s_passwords_json_key2="encrypted_key" wide
        $s_dpapi_class="ProtectedData"
        $s_http_response="HttpWebRequest"
        $s_env_var="GetEnvironmentVariable"
        $s_base64="FromBase64String"
        $s_dir="Directory"
        $s_rand="Random"
    condition:
        (any of ($victim_id*) ) and all of ($s*)
}

rule CrowdStrike_CSIT_20212_01 : ecrime fickerstealer infostealer 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects assembly and string patterns found in Ficker Stealer"
        reports = "CSA-201375,CSIT-20212"
        version = "202011181518"
        last_modified = "2020-11-18"
        malware_family = "FickerStealer"
    strings:
        $asm_c2_checkin = {c7 44 24 ?? 0c 00 0f 0a c7 44 24 ?? 0b 0a 0b 0a}
        $asm_dec_str1 = {8a 3c 32 00 cf 88 3c 37 4?}
        $asm_dec_str2 = {8b ?? 0c 8b ?? 10 6b ?? ??}
        $asm_obf_1 = {b9 [4] ba [4] 89 03 b8 [4] 01 d1 03 03}
        $str1 = "Mingw-w64 runtime failure:"
        $str2 = "Address %p has no image-section"
        $str3 = "SomeNone"
        $str4 = "rust_eh_personality"
        $str5 = "rust_eh_register_frames"
    condition:
        filesize < 1MB and 3 of ($str*) and 2 of ($asm*)
}

rule CrowdStrike_BehinderWebshell : webshell 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects Behinder JSP Webshell"
        version = "202010231034"
        last_modified = "2020-10-23"
        malware_family = "Behinder Webshell"
    strings:
        $s1 = "c.init(2,new SecretKeySpec(k.getBytes(),\"AES\"));" // key initialization
        $s2 = "new U(this.getClass().getClassLoader()).g" // instantiation of binary class loader
        $s3 = "c.doFinal" // decryption call for payload
        $s4 = "new sun.misc.BASE64Decoder().decodeBuffer(request.getReader().readLine()" // base64 decoding of payload
        $s5 = ".newInstance().equals(pageContext);" // instantiation of class
        $s6 = "public Class g(byte []b){return super.defineClass(b,0,b.length);" // dynamic loading of class from byte array
    condition:
        all of them
}

rule CrowdStrike_CSIT_20204_01 : elf someterror voodoo_bear 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects strings used in VOODOO BEAR's SomeTerror backdoor."
        reports = "CSIT-20204"
        version = "202010300229"
        last_modified = "2020-10-30"
        actor = "VOODOO BEAR"
        malware_family = "SomeTerror"
    strings:
        $ = "Online interval (sec.):"
        $ = "/tmp/.applock"
        $ = "app/vendor/worker"
    condition:
        any of them and uint32(0) == 0x464C457F
}

rule CrowdStrike_CSIT_20206_01 : emotet loader module mummy_spider 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Identify Emotet binary runner"
        reports = "CSIT-20206"
        version = "202101291829"
        last_modified = "2021-01-29"
        actor = "MUMMY SPIDER"
        malware_family = "Emotet"
    strings:
        /*
        .text:10004F30 55               push    ebp
        .text:10004F31 8B EC            mov     ebp, esp
        .text:10004F33 8B 45 0C         mov     eax, [ebp+fdwReason]
        .text:10004F36 83 E8 0A         sub     eax, 0Ah
        .text:10004F39 74 0A            jz      short loc_10004F45
        .text:10004F3B 48               dec     eax
        .text:10004F3C B8 01 00 00 00   mov     eax, 1
        .text:10004F41 5D               pop     ebp
        .text:10004F42 C2 0C 00         retn
        */
        $dll_main = {55 8b ec 8b 45 0c 83 e8 0a 74 0a 48 b8 01 00 00 00 5d c2}
        /* Use a more relatex approach than dev_Emotet_c2_list
        but add a check on exported function name to avoid FP
        */
        $c2_port_pattern1 = {50 00 [6] (50 00 | 90 1f | bb 01 | a8 1b)}
        $c2_port_pattern2 = {90 1f [6] (50 00 | 90 1f | bb 01 | a8 1b)}
        $c2_port_pattern3 = {bb 01 [6] (50 00 | 90 1f | bb 01 | a8 1b)}
        $c2_port_pattern4 = {bb 01 [6] (50 00 | 90 1f | bb 01 | a8 1b)}
        /*
        .text:10068B88 6A 06           push    6
        .text:10068B8A 5A              pop     edx
        .text:10068B8B B9 8C 4F 06 10  mov     ecx, offset dword_10064F8C
        .text:10068B90 E8 AE 36 00 00  call    malware_load_library_by_index
        .text:10068B95 6A 09           push    9
        .text:10068B97 EB B5           jmp     short loc_10068B4E
        */
        $load_lib_switch_1 = {6a (02 | 03 | 04 | 05 | 06 | 07) 5a b9 [4] e8 [4] 6a (02 | 03 | 04 | 05 | 06 | 07 | 08 | 09) eb}
        /*
        .text:10041AE7 6A 06           push    6
        .text:10041AE9 5A              pop     edx
        .text:10041AEA B9 AC 3E 03 10  mov     ecx, offset dword_10033EAC
        .text:10041AEF E8 AA 21 00 00  call    sub_10043C9E
        .text:10041AF4 B8 C8 2C C4 23  mov     eax, 23C42CC8h
        */
        $load_lib_switch_2 = {6a (02 | 03 | 04 | 05 | 06 | 07) 5a b9 [4] e8 [4] b8}
    condition:
        filesize < 600KB and uint16(0) == 0x5a4d and (
        $dll_main or (
        (
        #load_lib_switch_1 >= 3 or
        #load_lib_switch_2 >= 3
        ) and
        (
        #c2_port_pattern1 >= 4 or
        #c2_port_pattern2 >= 4 or
        #c2_port_pattern3 >= 4 or
        #c2_port_pattern4 >= 4
        )
        )
        )
}

rule CrowdStrike_CSA_201436_02 : panelboy rat wizard_spider 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects PanelBoy files on disk"
        reports = "CSA-201436,CSIT-20244"
        version = "202012230113"
        last_modified = "2020-12-23"
        actor = "WIZARD SPIDER"
        malware_family = "PanelBoy"
    strings:
        $decryption = { 89 4d f4 8b 55 10 03 55 f8 8a 02 88 45 ff 83 7d f4 00 7e 17 60 33 db 8b 5d 10 03 5d f8 8a 03 33 c9 8b 4d f4 d2 c8 88 03 }
    condition:
        $decryption and
        uint16(0) == 0x5a4d
}

rule CrowdStrike_VideoGrabber_ExfilStager : exfiltration rar video_grabber 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule identifies files used by China-nexus actors to create AVI formatted video grabs of an infected system and subsequently stage them for exfiltration."
        version = "202012111111"
        last_modified = "2020-12-11"
    strings:
        $ = "%s a -hp%s -m5"
        $ = ".AVI"
        $ = ".RAR"
    condition:
        all of them
}

rule CrowdStrike_CSA_201415_01 : labyrinth_chollima rat xctrat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects XcTRAT via C2 communication implementation"
        reports = "CSA-201415"
        version = "202011061056"
        last_modified = "2020-11-06"
        actor = "LABYRINTH CHOLLIMA"
        malware_family = "XcTRAT"
    strings:
        $plain_mt_init = { 23 01 00 00 [1-4] 34 02 00 00 [1-4] 45 03 00 00 [1-4] 56 04 00 00 }
        $plain_mt_const_0 = { aa d6 2b 01 }
        $plain_mt_const_1 = { 65 8b 58 5d }
        $plain_mt_const_2 = { 0d 66 19 00 }
        $plain_mt_const_3 = { 70 02 00 00 }
        $plain_response_string = "<!DOCTYPE"
        $plain_beacon_uri = "?timestamp="
        $plain_multipart = "boundary=---------------------------293582696224464"
        $build_specific_mt = { c7 44 24 30 23 01 00 00 c7 44 24 34 34 02 00 00 c7 44 24 38 45 03 00 00 c7 44 24 3c 56 04 00 00 c7 44 24 20 04 00 00 00 }
        $build_specific_import_0 = "VirtualProtect"
    condition:
        all of ($plain*) or
        2 of ($build_specific*)
}

rule CrowdStrike_NotVncLoader_01 : downloader notvncloader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects a likely malicious downloader pretending to be VNC related software"
        version = "202011061056"
        last_modified = "2020-11-06"
        malware_family = "NotVncLoader"
    strings:
        $int1 = { 2c 30 5d c3 2c 61 04 0a 5d c3 2c 41 04 0a 5d c3 }
        $int2 = { 8b ca 83 e9 30 83 f9 0a 73 07 8b c2 83 e8 16 eb 1a 8b ca 83 e9 41 83 f9 1a 73 04 89 c8 eb 0c 8b ca 83 e9 61 83 f9 1a 73 02 89 c8 c3 }
        $strong1 = "Embarcadero Delphi for Win" ascii
        $strong2 = "This program must be run under Win" ascii
        $strong3 = "TVncServer" ascii
        $strong4 = "TBot" ascii
        $strong5 = "WinRAR archiver"
        $strong6 = "vnchost.exe" ascii
        $ = "service_name yok kurulacak" wide
        $ = "wget resource yok" wide
        $ = "wget.exe eklendi" wide
        $ = "unrar resource yok" wide
        $ = "unrar.exe eklendi" wide
        $ = "C:\\Log\\Bot" wide
        $ = "Thread basladi" wide
        $ = "Thread bitti" wide
        $ = "kurulacak" wide
        $ = "%s/download/%s/%s" wide
        $ = "/VERYSILENT /SUPPRESSMSGBOXES" wide
    condition:
        any of ($int*) and
        4 of ($strong*) and
        10 of them and
        filesize > 2MB and filesize < 10MB
}

rule CrowdStrike_CSIT_20235_01 : destory rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects Destory through a string pushed on the stack in the exception handler"
        reports = "CSIT-20235"
        version = "202101081622"
        last_modified = "2021-01-08"
        malware_family = "DestoryRAT"
    strings:
        $code = { b9 45 00 00 00 66 89 4d ?? ba 4e 00 00 00 66 89 55 ?? b8 61 00 00 00 66 89 45 ?? b9 6d 00 00 00 66 89 4d ?? ba 65 00 00 00 66 89 55 ?? b8 3a 00 00 00 66 89 45 ?? b9 20 00 00 00 66 89 4d ?? }
    condition:
        $code and
        filesize < 1MB
}

rule CrowdStrike_CSA_210336_01 : ecrime mountlocker ransomware 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects MountLocker ransomware samples, 32-bit and 64-bit, versions 1 through 4."
        reports = "CSA-210336,CSIT-21067"
        version = "202104232010"
        last_modified = "2021-04-23"
        malware_family = "MountLocker"
    strings:
        $str_note1 = "RecoveryManual.html" wide
        $str_note2 = ".ReadManual." wide
        $str_mutex = "%0.8X%0.8X%0.8X%0.8X" wide
        $str_arg1 = "/log:" wide
        $str_arg2 = "/scan:" wide
        $str_arg3 = "/marker:" wide
        $str_arg4 = "/nodel" wide
        $str_log1 = "[I] Check double run" ascii
        $str_log2 = "[W] SKIP VOLUME:" ascii
        $str_log3 = "[I] SCAN VOLUME:" ascii
        $str_log4 = "[W] SKIP FOLDER " ascii
        $str_log5 = "[ERROR] locker" wide
        $str_log6 = "[WARN] locker" wide
        $str_log7 = "[OK] locker" wide
        $asm32_keygen1 = { 33 c9 0f 31 89 44 8c ?? 41 83 f9 08 72 ?? }
        $asm32_keygen2 = { 0f 31 8b 96 [4] 8b c8 83 e1 07 42  d3 c2 33 d0 }
        $asm32_fmtmutex = { 8b c1 c1 c8 09 50 8b c1 c1 c8 06 50 8b c1 c1 c8 03 50 51 8d 85 [4] 68 [4] 50 }
        $asm64_keygen1 = { 33 c9 0f 31 48 c1 e2 20 48 0b c2 89 44 8d ?? 48 ?? ?? 48 83 f9 08 72 ?? }
        $asm64_keygen2 = { 45 33 c0 0f 31 48 c1 e2 20 4c 8d 0d [4] 48 0b c2 43 8b 14 08 }
        $asm64_fmtmutex = { b9 bd 07 a2 41 44 0f 44 c1 41 8b c8 44 [4-7] c1 c9 09 41 8b c0 89 [2-3] 45 8b c8 c1 c8 06 48 [3-4] 41 c1 c9 03 }
    condition:
        uint16(0) == 0x5a4d and
        filesize < 500KB and
        (8 of ($str_*) or 2 of ($asm32_*) or 2 of ($asm64_*))
}

rule CrowdStrike_CSA_201486_05 : artifact dotnet mistygulf oceanmap 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects the RC4 function from OceanMap"
        reports = "CSA-201486"
        version = "202011271111"
        last_modified = "2020-11-27"
        actor = "MistyGulf"
        malware_family = "OceanMap"
    strings:
        $p = {
        20 00 01 00 00 8d 16 00 00 01 13 05 20 00 01 00 00 8d 16 00 00 01 13 06 03 8e 69 8d 17 00 00 01
        13 07 16 0b 2b 14 11 05 07 02 07 02 8e 69 5d 91 9e 11 06 07 07 9e 07 17 58 0b 07 20 00 01 00 00
        32 e4 16 25 0b 0c 2b 2a 08 11 06 07 94 58 11 05 07 94 58 20 00 01 00 00 5d 0c 11 06 07 94 13 04
        11 06 07 11 06 08 94 9e 11 06 08 11 04 9e 07 17 58 0b 07 20 00 01 00 00 32 ce 16 25 0b 25 0c 0a
        2b 50 06 17 58 0a 06 20 00 01 00 00 5d 0a 08 11 06 06 94 58 0c 08 20 00 01 00 00 5d 0c 11 06 06
        94 13 04 11 06 06 11 06 08 94 9e 11 06 08 11 04 9e 11 06 11 06 06 94 11 06 08 94 58 20 00 01 00
        00 5d 94 0d 11 07 07 03 07 91 09 61 d2 9c 07 17 58 0b 07 03 8e 69 32 aa 11 07 2a
        }
    condition:
        $p and
        filesize < 200KB
}

rule CrowdStrike_CSA_201486_02 : artifact backdoor dotnet mistygulf oceanmap 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects known RC4 keys found in OceanMap samples"
        reports = "CSA-201486"
        version = "202011271111"
        last_modified = "2020-11-27"
        actor = "MistyGulf"
        malware_family = "OceanMap"
    strings:
        $k1 = {
        8c 18 63 4c 63 74 ce 4e 75 f1 55 f8 06 80 8f 05 32 fe f8 a8 47 2d b2 54 33 90 a3 a4 8c b6 9b 7c
        b1 43 bc e1 39 91 9d 33 c2 09 22 01 70 f0 d9 8f de 4f a4 97 f6 68 ec 18 0a e2 9f 13 db ec e3 3e
        97 d5 e8 43 86 19 ce 70 28 3d dc 0a 39 2a 27 19 3a 04 3e 02 6f c4 5e b3 9a 44 f3 52 6f 80 f7 20
        f3 96 6a a1 71 be 57 74 83 be 7d 1c f6 0b 50 cc 96 ba 56 fe e5 49 09 a3 19 e3 c9 45 b3 42 b8 9e
        ad a4 90 ea 86 31 90 8f 2e 28 71 ef 55 6b f1 21 e6 1d e9 35 1e 41 d1 9d 24 71 4b d0 71 aa 3e 22
        ce e9 16 d0 84 59 d9 07 16 70 b6 16 03 12 8a 5c 2d 57 81 08 6d b1 1e 55 80 cc 55 cb ee 71 67 91
        c3 69 86 b9 10 86 30 5f a4 e4 7d 8e e3 70 e8 f1 72 2c a8 cd a9 44 ed 8e 25 50 f2 9c a2 85 ec 63
        cd 89 3a 12 31 01 cb 92 7c e9 b7 96 47 ae 33 17 26 06 6d 62 64 28 0c 9a 4a e5 40 c2 79 98 66 69
        }
    condition:
        $k1 and
        filesize < 64MB
}

rule CrowdStrike_CSA_201486_04 : artifact dotnet mistygulf oceanmap 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects IMAP commands and strings for the OceanMAP C2 protocol"
        reports = "CSA-201486"
        version = "202011271111"
        last_modified = "2020-11-27"
        actor = "MistyGulf"
        malware_family = "OceanMap"
    strings:
        // Create report on remote server
        $s1 = "_report_" wide
        // Append the report to the server Inbox
        $s2 = "$ APPEND Inbox {" wide nocase
        // Search for tasking in the server drafts
        $s3 = "$ UID SEARCH subject \"" wide nocase
        // Get the content of the drafts to get tasking
        $s4 = " BODY.PEEK[text]" wide
        // Get the UID of tasking drafts
        $s5 = "$ UID FETCH " wide
    condition:
        all of them and
        filesize < 100KB
}

rule CrowdStrike_CSA_201436_01 : panelboy rat unpacked wizard_spider 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects unpacked samples of PanelBoy"
        reports = "CSA-201436,CSIT-20244"
        version = "202012230113"
        last_modified = "2020-12-23"
        actor = "WIZARD SPIDER"
        malware_family = "PanelBoy"
    strings:
        $ = "vendor="
        $ = "&country="
        $ = "&domain="
        $ = "&build_version="
        $ = "&systemOS="
        $ = "&registry="
        $ = "&username="
        $ = "&privileges="
    condition:
        all of them
}

rule CrowdStrike_CSIT_20210_01 : hunting nemty traveling_spider 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Targets bytes with Nemty X's AES CTR encryption. "
        reports = "CSIT-20210"
        version = "202102041615"
        last_modified = "2021-02-04"
        actor = "TRAVELING SPIDER"
        malware_family = "Nemty"
        reports = "CSIT-20210"
    strings:
        $aes_ctr = {b8 0f 00 00 00 90 8a 0c 38 80 f9 ff 75 0b c6 04 38 00 83 e8 01 79 ef eb 05}
        $some_bytes = {8A 42 F3 43 32 C4 88 42 03 8A 42 F4 32 85 39 FF FF FF 88 42 04 8A 42 F5 32 C1 88 42 05 8A 42 F6 32 C5 88 42 06 83 C2 04 83 FB 2C 0F 82 4E FF FF FF }
    condition:
        any of them
}

rule CrowdStrike_CSIT_20227_01 : downloader labyrinth_chollima torisma 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects strings used Torisma downloader for C2 beacon and response, as well as dynamically resolved imports"
        reports = "CSIT-20227"
        version = "202101291824"
        last_modified = "2021-01-29"
        actor = "LABYRINTH CHOLLIMA"
        malware_family = "Torisma"
    strings:
        $beacon_format_string = "ACTION=VIEW&PAGE=%s&CODE=%s&CACHE=%s&REQUEST=%d" nocase
        $login_string = "Your request has been accepted. ClientID: {" nocase
        $dynamic_import_api = "WTSEnumerateSessions" nocase
        $dynamic_import_lib = "WtsApi32.dll" wide nocase fullword
    condition:
        uint16(0) == 0x5a4d and all of them
}

rule CrowdStrike_CSA_201486_03 : artifact crypto key mistygulf oceanmap 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects known DES keys found in OceanMap samples"
        reports = "CSA-201486"
        version = "202011271111"
        last_modified = "2020-11-27"
        actor = "MistyGulf"
        malware_family = "OceanMap"
    strings:
        $k1 = "HbqC9!mV" wide
        $iv1 = { 1c 0b 33 0c 20 1a 07 29 }
    condition:
        any of them and
        filesize < 1MB
}

rule CrowdStrike_CSIT_20227_02 : labyrinth_chollima venus webshell 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects strings used in the plaintext version of the Venus ASP Webshell"
        reports = "CSIT-20227"
        version = "202105141015"
        last_modified = "2021-05-14"
        actor = "LABYRINTH CHOLLIMA"
        malware_family = "Venus"
    strings:
        $config_object_string = "Scripting.FileSystemObject#WScript.Shell#WScript.Shell.1#Shell.Application#Shell.Application.1#"
        $cmd_0 = "formCMD()" nocase
        $cmd_1 = "formfolder()" nocase
        $cmd_3 = "formnetscan()" nocase
        $cmd_4 = "formurld()" nocase
        $cmd_status_0 = "execcmd_shell=\"Command has been executed by Shell.Application." nocase
        $cmd_function_name_0 = "execcmd_wscript" nocase
        $cmd_function_name_1 = "execcmd_nonwscript" nocase
    condition:
        $config_object_string and 3 of ($cmd_*)
}

rule CrowdStrike_CSA_201457_01 : cashy200 powershell rat snugy warlord_kitten 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects strings used in CASHY200 and Snugy PowerShell DNS RATs used by WARLORD KITTEN"
        reports = "CSA-201457"
        version = "202011131757"
        last_modified = "2020-11-13"
        actor = "WARLORD KITTEN"
        malware_family = "CASHY200"
        
    strings:
        $v2_1 = "-join((65..90)+(97..122)|Get-Random -Count" wide ascii
        $v2_2 = "'\\b(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\b'" wide ascii
        $v2_3 = "[Convert]::ToString($" wide ascii
        $v2_4 = ".split('.')[0]" wide ascii
        $v2_5 = "-replace('%',' ')" wide ascii
        //-replace '%' , ' '
        $v1_1 = {
        2d 72 65 70 6c 61 63 65  20 (22 | 27) 25 (22 | 27) 20 2c 20 (22 | 27) 20 (22 | 27)
        }
        $v1_1_wide = {
        002d 0072 0065 0070 006c 0061 0063 0065  0020 00(22 | 27) 0025 00(22 | 27) 0020 002c 0020 00(22 | 27) 0020 00(22 | 27)
        }
        //[char[]]'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789'
        $v1_2 = {
        5b 63 68 61 72 5b 5d 5d  (22 | 27) 41 42 43 44 45 46 47
        48 49 4a 4b 4c 4d 4e 4f  50 51 52 53 54 55 56 57
        58 59 5a 61 62 63 64 65  66 67 68 69 6a 6b 6c 6d
        6e 6f 70 71 72 73 74 75  76 77 78 79 7a 30 31 32
        33 34 35 36 37 38 39 (22 | 27)
        }
        $v1_2_wide = {
        005b 0063 0068 0061 0072 005b 005d 005d  00(22 | 27) 0041 0042 0043 0044 0045 0046 0047
        0048 0049 004a 004b 004c 004d 004e 004f  0050 0051 0052 0053 0054 0055 0056 0057
        0058 0059 005a 0061 0062 0063 0064 0065  0066 0067 0068 0069 006a 006b 006c 006d
        006e 006f 0070 0071 0072 0073 0074 0075  0076 0077 0078 0079 007a 0030 0031 0032
        0033 0034 0035 0036 0037 0038 0039 00(22 | 27)
        }
        // .split('.')[0] -eq '200'
        $v1_3 = {
        2e 73 70 6c 69 74 28 (22 | 27)  2e (22 | 27) 29 5b 30 5d 20 2d
        65 71 20 (22 | 27) 32 30 30 (22 | 27)  29
        }
        $v1_3_wide = {
        002e 0073 0070 006c 0069 0074 0028 00(22 | 27)  002e 00(22 | 27) 0029 005b 0030 005d 0020 002d
        0065 0071 0020 00(22 | 27) 0032 0030 0030 00(22 | 27)  0029
        }
        //Test-Path 'HKCU:\Software\Microsoft\Cashe'
        $v1_4 = "Test-Path 'HKCU:\\Software\\Microsoft\\Cashe'" wide ascii
    condition:
        all of ($v2_*) or (4 of ($v2_*) and $v1_1) or 4 of ($v1_*)
}

rule CrowdStrike_CSA_201470_01 : crat hansom labyrinth_chollima ransomware 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects strings and xor string decoding loops used in CRAT Hansom Ransomware Plugin"
        reports = "CSA-201470"
        version = "202011271111"
        last_modified = "2020-11-27"
        actor = "LABYRINTH CHOLLIMA"
        malware_family = "CRAT"
    strings:
        // Timestamp based xor key modifier
        $xorKeyMod64bit = {31 ?? ?? ?? 81 C1 ?? ?? 2? 20 ?? 83 C0 04 ?? ?? ?? 7?}
        $xorKeyMod64bit2 = {31 ?? 81 C7 ?? ?? 2? 20 48 8D 5B 04 ?? ?? ?? 7?}
        $xorKeyMod32bit = {31 ?? ?? ?? ?? ?? ?? 83 C0 04 81 C1 ?? ?? 2? 20 ?? ?? 7?}
        // Hansom strings
        $ransom_note_name = "\\hansom.jpg" fullword wide
        $ransom_key_name_0 = ".hansomkey" fullword wide
        $ransom_key_name_1 = ".hansom" fullword wide
        $ransom_rar_invocation = "a -y -ep -k -r -s -ibck -df -m0 -hp" wide
        // Hansom DLL and export names
        $dll_name_64 = "Ransom_x64_DllRelease.dll" fullword
        $dll_name_32 = "Ransom_Win32_DllRelease.dll" fullword
        $dll_export_0 = "ExtractHansom" fullword
        $dll_export_1 = "HansomMain" fullword
    condition:
        uint16(0) == 0x5a4d and
        1 of ($xor*) and
        2 of ($ransom_*) and
        2 of ($dll_*)
}

rule CrowdStrike_CSA_201490_01 : rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects KillSomeOne samples through common patterns found in the PDB paths"
        reports = "CSA-201490"
        version = "202011271111"
        last_modified = "2020-11-27"
        malware_family = "KillSomeOne"
    strings:
        $pdb1 = "C:\\Users\\B\\Desktop\\0.1\\"
        $pdb2 = "C:\\Users\\guss\\Desktop\\Recent Work\\"
        $pdb3 = "C:\\Users\\guss\\Desktop\\U\\"
    condition:
        uint16(0) == 0x5a4d and
        filesize < 5MB and
        1 of them
}

rule CrowdStrike_CSA_201490_02 : rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects KillSomeOne payload based on common strings"
        reports = "CSA-201490"
        version = "202011271111"
        last_modified = "2020-11-27"
        malware_family = "KillSomeOne"
    strings:
        $s1 = "LKU_Test_" wide
        $s2 = "Removable Disk(%dGB)" wide
        $s3 = "RECYCLER.BIN" wide
        $s4 = "UsersDate" wide
        $s5 = "IconResource=%systemroot%\\system32\\SHELL32.dll,7" wide
        $s6 = "LKUFORYOU"
        $s7 = "\\desktop.ini" wide
    condition:
        uint16(0) == 0x5a4d and
        filesize < 5MB and
        4 of them
}

rule CrowdStrike_CSA_201548_01 : downloader halfandhalfdownloader javascript 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Javascript downloader that splits its JS in half, reverses the first half, and intertwines them, observed distributed via driveby downloads"
        reports = "CSA-201548"
        version = "202106031645"
        last_modified = "2021-06-03"
        malware_family = "HalfAndHalfDownloader"
    strings:
        $enc_constructor = { 72 ?? 6F ?? 74 ?? 63 ?? 75 ?? 72 ?? 74 ?? 73 ?? 6E ?? 6F ?? 63 }
        $enc_WScript = { 74 ?? 70 ?? 69 ?? 72 ?? 63 ?? 53 ?? 57 }
    condition:
        all of them
}

rule CrowdStrike_CSIT_20215_01 : backdoor shadow_crane slub 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects SLUB malware that uses mattermost for C2"
        reports = "CSIT-20215"
        version = "202012041535"
        last_modified = "2020-12-04"
        actor = "SHADOW CRANE"
        malware_family = "SLUB"
    strings:
        $str1 = "c:\\work.vcpkg\\installed\\x64-windows-static\\include\\boost/exception/detail/exception_ptr.hpp"
        $str2 = "Authorization: Bearer %s"
        $str3 = "team_id"
        $str4 = "channel_id"
        $str5 = "Microsoft Setup Initializazion"
    condition:
        uint16(0) == 0x5a4d and
        all of them
}

rule CrowdStrike_CSA_201484_01 : dropper imperial_kitten pingdrop 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects .NET Type Library GUIDs for IMPERIAL KITTEN tooling"
        reports = "CSA-201484"
        version = "202101201859"
        last_modified = "2021-01-20"
        actor = "IMPERIAL KITTEN"
        malware_family = "Pingdrop"
    strings:
        $liderc_1 = "10e33d93-a0bb-4faf-869b-c3be8ad325f4" nocase ascii
        $liderc_2 = "7bb696d3-d5aa-4af3-8c0a-1bb9e0c20fd7" nocase ascii
        $pingdrop = "73003da9-cb64-41d2-9f4c-4b75107f3de9" nocase ascii
        $pingdrop_payload = "9f058df7-8156-47af-8f07-3a6f780fe36f" nocase ascii
    condition:
        uint16(0) == 0x5a4d and
        any of them
}

rule CrowdStrike_CSA_201480_01 : artifact downloader fancy_bear godown 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects obfuscated strings found in GoDown samples with ($ch - 1) obfuscation "
        reports = "CSA-201480"
        version = "202011271111"
        last_modified = "2020-11-27"
        actor = "FANCY BEAR"
        malware_family = "GoDown"
    strings:
        $https = "iuuqt" ascii
        $cmdexe = "d;]Xjoepxt]Tztufn43]dne/fyf" ascii
        $winword = "XJOXPSE/FYF" ascii
        $php = "/qiq" ascii
        $ping_localhost = "dne/fyf!0D!qjoh!mpdbmiptu!" ascii
        $scheduled_task = "tdiubtlt!0Dsfbuf!" ascii
        $robocopy = "spcpdpqz" ascii
        // Persistence file name ndfapi.exe
        $config_0 = "]MjhpCbs]" ascii
        $config_1 = "oegbqj/fyf" ascii
        $config_4 = "tupn/cbu" ascii
        // C2 server and path
        $config_2 = "iuuqt;00tvqqpsu.dmpve/mjgf" ascii
        $config_3 = "0nbobhnfou0dc.tfdvsf0ufdiopmphz/qiq" ascii
        // Commands
        $cmd_1 = "\x0e\x0b!dne/fyf!0D!qjoh!mpdbmiptu!.o!8!?!ovm!'!efm" ascii
        $cmd_2 = "\x0e\x0b!dne/fyf!0D!qjoh!mpdbmiptu!.o!4!?!ovm!'!efm" ascii
        $cmd_3 = "tdiubtlt!0Dsfbuf!0TD!NJOVUF!0NP!4!0UO!TpguxbsfQspufdujpoQmbugpsn!0G!0US" ascii
        $cmd_4 = "0D!gpsgjmft!0q!d;]xjoepxt]tztufn43!0n!opufqbe/fyf!0D!" ascii
    condition:
        any of ($cmd_*) or
        any of ($config_*) or
        5 of them and
        filesize < 20MB
}

rule CrowdStrike_CSA_201484_02 : dotnet imperial_kitten liderc 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects strings used in IMPERIAL KITTEN system profiling tool"
        reports = "CSA-201484"
        version = "202101201858"
        last_modified = "2021-01-20"
        actor = "IMPERIAL KITTEN"
        malware_family = "liderc"
    strings:
        $ = "otpgen" wide ascii
        $ = "/C ipconfig > %temp%\\otpgen\\ipconf.txt" wide ascii
        $ = "/C tracert google.com > %temp%\\otpgen\\tracert.txt" wide ascii
        $ = "/C ping w3schools.com > %temp%\\otpgen\\ping.txt" wide ascii
        $ = "/C arp -a > %temp%\\otpgen\\arp.txt" wide ascii
        $ = "/C getmac > %temp%\\otpgen\\getmac.txt" wide ascii
        $ = "/C net accounts > %temp%\\otpgen\\netaccounts.txt" wide ascii
        $ = "/C net computer > %temp%\\otpgen\\netcomputer.txt" wide ascii
        $ = "/C net config > %temp%\\otpgen\\netconfig.txt" wide ascii
        $ = "/C net localgroup > %temp%\\otpgen\\netlocal.txt" wide ascii
        $ = "/C net group > %temp%\\otpgen\\netgroup.txt" wide ascii
        $ = "/C net user > %temp%\\otpgen\\netuser.txt" wide ascii
        $ = "/C copy  %temp%\\otpgen\\*.txt  %temp%\\otpgen\\Erroroutput.txt" wide ascii
        $ = "\\otpgen\\Erroroutput.txt" wide ascii
        $ = "Port 25" wide ascii
        $ = "smtp.gmail.com" wide ascii
        $ = "Port 587" wide ascii
    condition:
        uint16(0) == 0x5a4d and
        all of them
}

rule CrowdStrike_CSA_201486_06 : artifact backdoor mistygulf oceandrive oceanmap 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects common artifacts between OceanDrive and OceanMap"
        reports = "CSA-201486"
        version = "202011271111"
        last_modified = "2020-11-27"
        actor = "MistyGulf"
        malware_family = "OceanDrive, OceanMap"
    strings:
        $func_create_file = "create" ascii
        $func_delete = "delete" ascii
        $func_execute = "execute" ascii
        $func_read_file = "readFile" ascii
        $conf_comp_id = "comp_id" ascii
        $conf_report = "_report_" wide
        $drive_access_token = "access_token" ascii
        $drive_refresh_token = "refresh_token" ascii
        $imap_creds = "creds" ascii
        $imap_creds_r = "r_creds" ascii
    condition:
        filesize < 200KB and
        all of ($func_*) and
        all of ($conf_*) and
        (all of ($drive_*) or all of ($imap_*))
}

rule CrowdStrike_CSA_201496_01 : ragnarok ransomware unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects unpacked samples of Ragnarok ransomware"
        reports = "CSA-201496"
        version = "202011271111"
        last_modified = "2020-11-27"
        malware_family = "Ragnarok"
    strings:
        $str_c1 = "cmd_shadow"
        $str_c2 = "cmd_boot"
        $str_c3 = "cmd_recovery"
        $str_c4 = "cmd_firewall"
        $str_h1 = "prv_ip"
        $str_h2 = "pub_ip"
        $op_rc4_decode = { 33 db 33 c0 33 ff 40 99 f7 f9 8b c2 }
        $crypto_rsa1 = { c1 e0 08 33 c3 bb ff 00 00 00 c1 e0 08 33 c7 }
        $crypto_rsa2 = { 0f b6 c8 8d 04 12 f7 d9 1b c9 46 83 e1 1b 33 c8 33 ca 0f b6 d1 81 fe 00 01 00 00 }
        $crypto_rsa3 = { 24 80 0f b6 c8 8d 04 36 f7 d9 1b c9 83 c2 04 83 e1 1b 33 c8 0f b6 f1 }
        $crypto_sbox = { 63 7c 77 7b f2 6b 6f c5 30 01 67 2b fe d7 ab 76 ca 82 c9 7d fa 59 47 f0 ad d4 a2 af 9c a4 72 c0 b7 fd 93 26 36 3f f7 cc 34 a5 e5 f1 71 d8 31}
    condition:
        5 of ($str*) or
        2 of ($str*) and
        ($op_rc4_decode or 2 of ($crypto*))
}

rule CrowdStrike_CSIT_20221_01 : eggshell labyrinth_chollima macos milt rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects all known variants of the macOS backdoor Milt"
        reports = "CSIT-20221"
        version = "202102011432"
        last_modified = "2021-02-01"
        actor = "LABYRINTH CHOLLIMA"
        malware_family = "Milt"
    strings:
        $s_1 = "NVBKMF5/MIOFc3gwdnl8dTB/gjB0eYJ1c4R/goka" ascii
        $s_2 = "fnWIhIR5fXUweYMwcnV2f4J1MHOFgoJ1foQwhHl9dQ==" ascii
        $s_3 = "changeDirectory:" ascii
        $s_4 = "sendSuccessMessage:" ascii
        $code_xor = { 48 8d 04 1f 48 99 48 f7 f9 42 8a 04 3a 41 30 04 3e 89 f7 ff c6 48 39 df 7c e6 }
    condition:
        uint32(0) == 0xfeedfacf and (2 of ($s_*) or $code_xor) and filesize < 500KB
}

rule CrowdStrike_CSA_201498_01 : dropper labyrinth_chollima openssl_downloader openssldownloader trojan 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects a trojanized MuPDF viewer used to drop open_ssl loader"
        reports = "CSA-201498,CSIT-21058"
        version = "202103231652"
        last_modified = "2021-03-23"
        actor = "LABYRINTH CHOLLIMA"
        malware_family = "OpenSSLDownloader"
    strings:
        $ = "cmd.exe /c start /b %s \"%s\",%s"
        $ = "C:\\Windows\\System32\\rundll32.exe"
        $ = "(link src_md5=%s dst_md5=%s)"
    condition:
        all of them
}

rule CrowdStrike_CSA_201498_02 : labyrinth_chollima loader openssl_loader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects the export function and RC4 key used in the OpenSSL loader malware"
        reports = "CSA-201498"
        version = "202102261753"
        last_modified = "2021-02-26"
        actor = "LABYRINTH CHOLLIMA"
        malware_family = "OpenSSL Downloader"
    strings:
        $ = "Rand_SSLeayW"
        $ = { 62 aa a2 b2 ?? ?? ?? c9 f4 f0 c6 ?? ?? ?? 62 b1 f2 e3 ?? ?? ?? 16 ae 6f 9c }
    condition:
        all of them
}

rule CrowdStrike_CSA_201498_03 : downloader labyrinth_chollima openssl_downloader openssldownloader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects the password, embedded library and format strings used in OpenSSL downloader"
        reports = "CSA-201498,CSIT-21058"
        version = "202103231651"
        last_modified = "2021-03-23"
        actor = "LABYRINTH CHOLLIMA"
        malware_family = "OpenSSLDownloader"
    strings:
        $ = "5618198335124815612315615648487"
        $ = "crypto\\evp\\enc_min.c"
        $ = "%s=%s&%s=%s&%s=%s&%s=%d&%s=%d&%s=%s"
    condition:
        all of them
}

rule CrowdStrike_CSIT_20218_01 : mikroceen rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects decryption code observed in instances of Mikroceen"
        reports = "CSIT-20218"
        version = "202104141824"
        last_modified = "2021-04-14"
        malware_family = "Mikroceen"
        example_hash = "f10c854dbb5f84ec06447919a5b93efc971d6802b5f74a1fb3f98dc74138b13c"
        
    strings:
        $ = { b8 20 00 00 00 48 8b cf 2a c3 ff c3 00 04 3a ff 15 }
        $ = { b8 20 00 00 00 2a c3 ff c3 00 04 39 48 8b cf ff 15 }
        $ = { b8 20 00 00 00 2a c3 48 8b cf ff c3 00 04 3a ff 15 }
        $ = { b8 20 00 00 00 2a c3 42 00 04 39 ff c3 49 8b cf ff 15 }
        $ = { b8 20 00 00 00 2a c3 42 00 04 31 ff c3 49 8b ce ff 15 }
        $ = { b8 20 00 00 00 2a c3 42 00 04 29 ff c3 49 8b cd ff 15 }
        $ = { b8 20 00 00 00 2a c3 00 04 39 ff c3 48 8b cf ff 15 }
        $ = { b8 20 00 00 00 2a c3 00 04 31 ff c3 48 8b ce ff 15 }
        $ = { b8 20 00 00 00 2a c3 00 01 ff c3 48 8d 8d a8 01 00 00 ff 15 }
        $ = { b8 20 00 00 00 2a c3 00 01 ff c3 48 8d 8d 48 03 00 00 ff 15 }
        $ = { b8 20 00 00 00 2a c3 00 01 ff c3 48 8d 8d 18 03 00 00 ff 15 }
        $ = { b0 20 8d 0c 33 2a c3 00 01 43 56 ff }
        $ = { b0 20 8d 0c 32 2a c2 42 00 01 56 89 54 24 14 ff }
        $ = { b0 20 2a c3 00 84 1c c4 01 00 00 8d 84 24 c4 01 00 00 50 43 }
        $ = { b0 20 2a c1 00 81 e0 bf 01 10 41 68 e0 bf 01 10 89 4c 24 18 ff d7 }
        $ = { b0 20 2a c1 00 81 c0 bf 01 10 41 68 c0 bf 01 10 89 4c 24 20 ff d6 }
        $ = { b0 20 2a c1 00 81 c0 9f 01 10 41 68 c0 9f 01 10 89 4c 24 18 ff d6 }
        $ = { b0 20 2a c1 00 81 a0 cf 01 10 41 68 a0 cf 01 10 89 4c 24 30 ff d7 }
        $ = { b0 20 2a c1 00 81 a0 bf 01 10 41 68 a0 bf 01 10 89 4c 24 18 ff d6 }
        $ = { b0 20 2a c1 00 81 a0 af 01 10 41 68 a0 af 01 10 89 4c 24 18 ff d6 }
        $ = { b0 20 2a c1 00 81 90 bf 01 10 41 68 90 bf 01 10 89 4c 24 18 ff d6 }
        $ = { b0 20 2a c1 00 81 80 bf 01 10 41 68 80 bf 01 10 89 4c 24 20 ff d6 }
        $ = { b0 20 2a c1 00 81 80 9f 01 10 41 68 80 9f 01 10 89 4c 24 18 ff d6 }
        $ = { b0 20 2a c1 00 81 70 bf 01 10 41 68 70 bf 01 10 89 4c 24 20 ff d6 }
        $ = { b0 20 2a c1 00 81 70 9f 01 10 41 68 70 9f 01 10 89 4c 24 18 ff d6 }
        $ = { b0 20 2a c1 00 81 50 cf 01 10 41 68 50 cf 01 10 89 4c 24 30 ff d7 }
        $ = { b0 20 2a c1 00 81 50 af 01 10 41 68 50 af 01 10 89 4c 24 18 ff d6 }
        $ = { b0 20 2a c1 00 81 40 cf 01 10 41 68 40 cf 01 10 89 4c 24 30 ff d7 }
        $ = { b0 20 2a c1 00 81 40 af 01 10 41 68 40 af 01 10 89 4c 24 18 ff d6 }
        $ = { 2a c1 04 20 88 02 ff c1 83 f9 20 72 e6 }
        $ = { 2a c1 04 20 88 02 ff c1 83 f9 10 72 e6 }
    condition:
        any of them and uint16(0) == 0x5a4d
}

rule CrowdStrike_CSIT_20218_02 : mikroceen rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects string data identified in instances of Mikroceen"
        reports = "CSIT-20218"
        version = "202104141825"
        last_modified = "2021-04-14"
        malware_family = "Mikroceen"
        example_hash = "a2c597836ab31246ac8e5adaa33ee61553045f64ea84a50fdef52fb8d73a518b"
    strings:
        $ = "%d-%d-%d %d:%d:%d %s"
        $ = "http="
        $ = "Schannel"
        $ = "\x0Doxy-Connection: TP/1.1\x0D\x0A" nocase
        $ = "\x00ent-length: 0\x0D\x0A" nocase
    condition:
        3 of them and uint16(0) == 0x5A4D
}

rule CrowdStrike_CSIT_20218_03 : mikroceen rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects XOR code observed in Mikroceen"
        reports = "CSIT-20218"
        version = "202104141824"
        last_modified = "2021-04-14"
        malware_family = "Mikroceen"
        
    strings:
        $xor_32_1 = { 8b c1 83 e0 0f (0f b6 80 [4] 30 81 [4] 70 bf | 8a 80 [4] 30 04 31 41 3b 4c 24 10 7?) }
        $xor_64_1 = { 48 8d 15 [4] 49 ff c0 83 e0 0f 8a 04 10 30 01 48 ff c1 49 ff c9 }
        $xor_64_2 = { 488d42fe83e00f0fb604383041ff488d42ff83e00f0fb604383001488bc283e00f0fb60438304101488d420183e00f0fb604383041024883c204488d490449ffc875bd }
    condition:
        any of them and uint16(0) == 0x5a4d
}

rule CrowdStrike_CSIT_20227_03 : c2 labyrinth_chollima neddnloader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects strings used in plaintext NedDnLoader C2 script from July 2020"
        reports = "CSIT-20227"
        version = "202101291825"
        last_modified = "2021-01-29"
        actor = "LABYRINTH CHOLLIMA"
        malware_family = "NedDnLoader"
    strings:
        $request_vars_ned = "Request.Form(\"ned\")" nocase
        $request_vars_gl = "Request.Form(\"gl\")" nocase
        $request_vars_hl = "Request.Form(\"hl\")" nocase
        $request_os_var = "strosbit" nocase
        $ip_whitelist_var = "strwhitefile" nocase
        $ip_blacklist_var = "strblackfile" nocase
        $ip_md5_var = "strmd5ipaddr" nocase
        $ip_check = "ipOk(str" nocase
        $payload_var_x86 = "_torisma_x86=" nocase
        $payload_var_x64 = "_torisma_x64=" nocase
        $payload_fake_x86 = "_doris_x86=" nocase
        $payload_fake_x64 = "_doris_x64=" nocase
    condition:
        2 of ($request_*) and 2 of ($ip_*) and 2 of ($payload_*)
}

rule CrowdStrike_CSIT_20227_04 : c2 labyrinth_chollima torisma 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects strings used in plaintext Torisma C2 script from July 2020"
        reports = "CSIT-20227"
        version = "202101291825"
        last_modified = "2021-01-29"
        actor = "LABYRINTH CHOLLIMA"
        malware_family = "Torisma"
    strings:
        $response_accepted = "Response.Write(\"Your request has been accepted. ClientID: {" nocase
        $response_invalid = "Response.Write(\"Your request is not valid. ClientID: {" nocase
        $send_data_start = "send_data = \"HashCode=" nocase
        $send_data_vars = "&CONTENT=\" & Request(\"CACHE\")" nocase
        $write_log = "WriteAgentLog(Request(\"PAGE\"))" nocase
        $save_name = "\"~dmf\" & Request(\"CODE\") & \".tmp\""
    condition:
        1 of ($response_*) and 1 of ($send_data_*) and ($write_log or $save_name)
}

rule CrowdStrike_CSA_210188_01 : powershell powerstallion venomous_bear 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects log date string from VENOMOUS BEAR PowerStallion (OneDrive PowerShell backdoor)."
        reports = "CSA-210188"
        version = "202102191057"
        last_modified = "2021-02-19"
        actor = "VENOMOUS BEAR"
        malware_family = "PowerStallion"
    strings:
        $ = "[Text.Encoding]::ASCII.GetBytes(\"[$([DateTime]::Now.ToString('G'))]: $msg`n\");" wide ascii
    condition:
        any of them
}

rule CrowdStrike_CSIT_21028_01 : lightbasin packer steelcorgi 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects routines used to deobfuscate strings, as well as some of the obfuscated strings themselves, in the STEELCORGI packer in use by the LightBasin activity cluster."
        reports = "CSIT-21028"
        version = "202102121548"
        last_modified = "2021-02-12"
    strings:
        // source: b1cb1b086ee305bf137fa6cb36f559166536288340d547d9fd497bb3762a3ac4
        $blob_0804a469 = { 0F B6 04 11 3C FF 75 ?? 0F B6 44 11 01 41 }
        // source: 00bf1d319e0cbd4d5624f7fb181743b92d1490638044f0c5fd42cc2908ae5cee
        $blob_402cde = { 80 FA FF 75 ?? 42 8A 44 01 01 FF C7 }
        $str_mtabr = { FF 2F FF 65 FF 74 FF 63 FF 2F FF 6D FF 74 FF 61 FF 62 00 72 00 }
        $str_machine_id = { FF 2F FF 76 FF 61 FF 72 FF 2F FF  6C FF 69 FF 62 FF 2F FF 64 FF 62 FF 75 FF 73 FF 2F FF 6D FF 61 FF 63 FF 68 FF 69 FF 6E FF 65 FF 2D FF 69 FF 64 00 }
        $str_by_uuid = { FF 2F FF 64 FF 65 FF 76  FF 2F FF 64 FF 69 FF 73 FF 6B FF 2F FF 62 FF 79  FF 2D FF 75 FF 75 FF 69 FF 64 00 }
    condition:
        any of them
}

rule CrowdStrike_CSIT_21062_01 : circuit_panda loader waterbear 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects instances of loader component associated with Waterbear"
        reports = "CSIT-21062"
        version = "202104301008"
        last_modified = "2021-04-30"
        actor = "CIRCUIT PANDA"
        malware_family = "Waterbear"
    strings:
        $ = "\x00Uuudll.dll\x00"
        $ = "\x00Update.dll\x00"
        $ = "?nUnit@@3HA"
        $ = "\\drivers\\sftst.sys\x00"
        $ = "\x00\\System\\msadc\\\x00"
        $ = "\x00Sicrosoft Corporation\x00"
        $ = "\\%s\\%04x%04x\\%s"
        $ = "\x00Mutex\x00"
        $ = ".exe \"%s\",EnCOMSecurity %"
        $ = "Microsoft\\pdfupd.dll"
        $ = "\x00pdfshell\x00"
        $ = "Microsoft\\pdfsh.dll"
    condition:
        2 of them
}

rule CrowdStrike_CSA_201545_01 : web_based_credential_harvesting 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detection for HTML page used as part of credential phishing campaign"
        version = "202012041537"
        last_modified = "2020-12-04"
    strings:
        $ = "///////////new injection////////////////"
        $ = "var email = window.location.hash.substr(1)"
        $ = "dataType: 'JSON',"
        $ = ".html('Verifing...')"
    condition:
        all of them
}

// WARNING: This rule will only work with YARA 3
import "pe"

rule CrowdStrike_CSA_201551_01 : destoryrat loader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects GoLang Destory loaders based on export names"
        reports = "CSA-201551"
        version = "202012041644"
        last_modified = "2020-12-04"
        malware_family = "DestoryRAT"
    condition:
        (uint16(0) == 0x5a4d) and (filesize < 2MB) and pe.exports("CEFProcessForkHandlerEx") and pe.exports("cgo_init") and (pe.number_of_exports > 1000) and (pe.number_of_signatures == 0)
}

// WARNING: This rule will only work with YARA 3
import "pe"

rule CrowdStrike_CSA_201551_02 : destoryrat loader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects Delphi Destory loaders based on section names and code pattern"
        reports = "CSA-201551"
        version = "202012041643"
        last_modified = "2020-12-04"
        malware_family = "DestoryRAT"
    strings:
        /* ".dat" pushed on the stack:
        C6 04 (02|18) 2E      mov byte ptr [eax+reg], 2E
        (40|43)           inc reg
        8B ?5 (F0|EC)           mov reg, [ebp+var]
        C6 04 ?? 64             mov byte ptr [eax+reg], 64
        (40|43)           inc reg
        8B ?5 (F0|EC)           mov reg, [ebp+var]
        C6 04 ?? 61             mov byte ptr [eax+reg], 61
        (40|43)           inc reg
        8B ?5 (F0|EC)           mov reg, [ebp+var]
        C6 04 ?? 74             mov byte ptr [eax+reg], 74
        (40|43)           inc reg
        8B ?5 (F0|EC)           mov reg, [ebp+var]
        C6 04 ?? 00             mov byte ptr [eax+reg], 0
        */
        $code = { C6 04 (02|18) 2E (40|43) 8B ?5 (F0|EC) C6 04 ?? 64 (40|43) 8B ?5 (F0|EC) C6 04 ?? 61 (40|43) 8B ?5 (F0|EC) C6 04 ?? 74 (40|43) 8B ?5 (F0|EC) C6 04 ?? 00 }
    condition:
        (uint16(0) == 0x5a4d) and (filesize < 2MB) and $code and (pe.number_of_signatures == 0) and ((pe.sections[1].name == ".itext") or (pe.sections[0].name == "CODE"))
}

rule CrowdStrike_CSIT_21062_02 : circuit_panda shellcode waterbear 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects likely Waterbear shellcode"
        reports = "CSIT-21062"
        version = "202104301008"
        last_modified = "2021-04-30"
        actor = "CIRCUIT PANDA"
        malware_family = "Waterbear"
    strings:
        $ = "CONNECT %s:%d HTTP/1."
        $ = "\x00Console\x00"
        $ = "\x00DbgPrint\x00"
        $ = "\x00Mutex\x00"
        $ = "\x00QuickEdit\x00"
        $ = "\x00abcdefghijklmno\x00"
        $ = "\x00http=\x00"
    condition:
        (uint16(0) != 0x5a4d and uint16(0) != 0x4b50) and
        4 of them and
        filesize <= 20KB
}

rule CrowdStrike_CSA_201554_01 : crutch rat venomous_bear 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects unique code used to calculate sleep time in command loop for the Crutch backdoor"
        reports = "CSA-201554"
        version = "202012111112"
        last_modified = "2020-12-11"
        actor = "VENOMOUS BEAR"
        malware_family = "Crutch"
    strings:
        $  = { 6a 3d 99 59 f7 f9 6a 64 59 8d 42 46 0f af c6 99 f7 f9 50 }
    condition:
        all of them
}

rule CrowdStrike_CSA_201556_01 : foudre infostealer radiantcrash 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects strings used for password scraping function of Foudre"
        reports = "CSIT-21007"
        version = "202101222329"
        last_modified = "2021-01-22"
        actor = "RadiantCrash"
        malware_family = "Foudre"
    strings:
        /*
        <13>
        <46>
        [Password field Start]
        */
        $ = {
        b0 04 02 00 ff ff ff ff  04 00 00 00 3c 00 31 00
        33 00 3e 00 00 00 00 00  b0 04 02 00 ff ff ff ff
        04 00 00 00 3c 00 34 00  36 00 3e 00 00 00 00 00
        b0 04 02 00 ff ff ff ff  17 00 00 00 20 00 5b 00
        50 00 61 00 73 00 73 00  77 00 6f 00 72 00 64 00
        20 00 66 00 69 00 65 00  6c 00 64 00 20 00 53 00
        74 00 61 00 72 00 74 00  5d 00 00 00 b0 04 02 00
        ff ff ff ff 08 00 00 00
        }
        /*
        [Password field End]
        Kbd:
        */
        $ = {
        b0 04 02 00
        ff ff ff ff 15 00 00 00  20 00 5b 00 50 00 61 00
        73 00 73 00 77 00 6f 00  72 00 64 00 20 00 66 00
        69 00 65 00 6c 00 64 00  20 00 45 00 6e 00 64 00
        5d 00 00 00 b0 04 02 00  ff ff ff ff 05 00 00 00
        4b 00 62 00 64 00 3a 00  20 00 00 00
        }
    condition:
        all of them
}

rule CrowdStrike_CSIT_21062_03 : circuit_panda shellcode waterbear 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects byte sequences observed in Waterbear shellcode"
        reports = "CSIT-21062"
        version = "202104301008"
        last_modified = "2021-04-30"
        actor = "CIRCUIT PANDA"
        malware_family = "Waterbear"
    strings:
        $ror7_api_hashes = { 32 74 91 0c 9b 51 04 ed ed 4c 3d 01 70 1f 7d 86 80 5a fd 30 70 1f b9 90 a0 65 97 cb 05 aa 44 61 67 59 de 1e b2 f2 e2 f4 85 df af bb 51 40 ba 7f 24 e9 ec 2c 4c 0f 29 d1 62 77 57 c0 d4 d7 ef 0b 7f ec 7b f3 f3 a6 bf dd 71 77 0a 63 76 90 97 c7 64 98 97 dd 98 c4 b9 de 73 1f af 2b 7c e2 9b 7c 3d 6a b4 80 e0 6d 0d 2a 5e a6 21 aa 69 80 50 61 5e a9 21 aa 12 10 cb bf cc 15 9a 1d 12 10 cb c5 8d 53 1e 43 14 99 dd 27 23 0d 44 79 83 17 51 0e 3b df f7 0b 7e c6 2f 8a 1d 76 e8 cf eb 46 39 f7 aa fe c0 d8 }
        $ror13_api_hashes_1 = { 81 eb 4a a8 (ab 95 ba fc e6 73 e2 35 54 ca af 91 | 08 3c f6 c8 71 1a 8a 02 ab 95 ba fc) }
        $ror13_api_hashes_2 = { 0f a7 1e 59 5a 6e db db 07 44 ac 64 34 aa 52 5c 81 eb 4a a8 ab 95 ba fc e6 73 e2 35 dd 9a 1c 2d }
        $bytes_before_config_1 = { 33 80 7c 24 24 00 74 28 80 7c 24 28 00 74 21 83 ec 10 8b f0 8b fc ac aa 3c 2e 75 fa c6 47 ff 00 54 ff 54 24 38 56 50 ff 54 24 40 83 c4 10 eb 04 33 c0 eb 00 83 c4 08 5f 5e 5d 5b c3 }
        $bytes_before_config_2 = { 8b 44 24 04 50 ff 90 [4] 59 6a 01 58 c3 }
        $bytes_before_config_3 = { e8 00 00 00 00 58 bb [4] b9 [4] 2b d9 03 c3 50 e8 4a ff ff ff e9 fb fe ff ff }
        $xor_keys = { 61 62 63 64 65 66 67 68 69 6a 6b 6c 6d 6e 6f 00 0c 2f 65 19 4f f3 7b 2d 63 d3 46 35 c7 b2 05 e4 }
        $entry_code = { 55 8b ec 81 ec 50 06 00 00 53 56 57 83 a5 10 fe ff ff 00 83 a5 14 fe ff ff 00 c7 85 18 fe ff ff }
        $rc4_modded_prga_1 = { 8a 09 32 0c 02 8b 85 68 fc ff ff 03 85 c8 fb ff ff 88 08 }
        $rc4_modded_prga_2 = { c1 e0 04 0f b6 8d 9c fb ff ff 8b 95 ec fc ff ff 0f b6 0c 0a c1 f9 04 0b c1 }
    condition:
        2 of them
}

rule CrowdStrike_CSA_201557_01 : httphelper labyrinth_chollima loader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects code used in decryption algorithm in the loader used for HTTPHelper RAT"
        reports = "CSA-201557,CSIT-21060"
        version = "202103220225"
        last_modified = "2021-03-22"
        actor = "LABYRINTH CHOLLIMA"
        malware_family = "HTTPHelper"
    strings:
        $code = { 41 8d 40 fd 41 8d 48 f9 41 ff c0 83 e0 0f 83 e1 0f }
    condition:
        uint16(0) == 0x5a4d and
        $code and
        filesize < 2MB
}

rule CrowdStrike_CSA_201557_02 : httphelper labyrinth_chollima rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects strings present in HTTPHelper RAT"
        reports = "CSA-201557,CSIT-21060"
        version = "202103220225"
        last_modified = "2021-03-22"
        actor = "LABYRINTH CHOLLIMA"
        malware_family = "HTTPHelper"
    strings:
        $class = "?AVhttpclientexceptionA@Ryeol"
        $zip = "1.2.7.f-hanba-win64-v1"
        $fmt = "Sleeptime %d" wide
    condition:
        uint16(0) == 0x5a4d and
        all of them and
        filesize < 2MB
}

// WARNING: This rule will only work with YARA 3
import "pe"

rule CrowdStrike_Expiro_01 : expiro infector infostealer 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects a variant of the Expiro file infector"
        version = "202104160926"
        last_modified = "2021-04-16"
        malware_family = "Expiro"
    strings:
        $resolv = { 8b fb 83 c7 20 8b 3f 2b d7 29 c2 c1 ea 01 8b fb 83 c7 24 8b 3f 03 fa 01 c7 8b 17 8b 7b 1c 81 e2 ff ff 00 00 c1 e2 02 03 f8 03 fa 8b 17 01 c2 }
        $protect = { 51 03 d9 53 54 56 57 53 ff d2 5f 59 50 }
        $snip1 = { 89 c7 83 c7 3c 8b 3f 01 c7 c3 }
        $snip2 = { ba 00 00 01 00 4e 85 f6 4a 85 d2 75 f8 c3 }
        $snip3 = { 42 83 eb 04 40 40 40 40 83 c7 04 83 fb 00 }
    condition:
        3 of them and
        @resolv < pe.entry_point + 300
}

rule CrowdStrike_CSIT_21005_02 : doorme dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects Doorme installer through encoded strings"
        reports = "CSIT-21005"
        version = "202102191057"
        last_modified = "2021-02-19"
        malware_family = "Doorme"
    strings:
        $s1 = {536472716e6f726447686d75647368}
        $s2 = {506771726d6c7167446b6e7667706b}
        $s3 = {516670736c6d7066456a6f7766716a}
        $s4 = {566177746b6a7761426d687061766d}
        $s5 = {576076756a6b7660436c697160776c}
        $s6 = {5463757669687563406f6a7263746f}
        $s7 = {5562747768697462416e6b7362756e}
        $s8 = {5a6d7b7867667b6d4e61647c6d7a61}
        $s9 = {5b6c7a7966677a6c4f60657d6c7b60}
        $s10 = {586f797a6564796f4c63667e6f7863}
        $s11 = {596e787b6465786e4d62677f6e7962}
        $s12 = {5e697f7c63627f694a656078697e65}
        $s13 = {5f687e7d62637e684b646179687f64}
        $s14 = {5c6b7d7e61607d6b4867627a6b7c67}
        $s15 = {5d6a7c7f60617c6a4966637b6a7d66}
        $s16 = {427563607f7e637556797c64756279}
        $s17 = {437462617e7f627457787d65746378}
        $s18 = {407761627d7c6177547b7e6677607b}
        $s19 = {417660637c7d6076557a7f6776617a}
        $s20 = {467167647b7a6771527d786071667d}
        $s21 = {477066657a7b6670537c796170677c}
        $s22 = {4473656679786573507f7a6273647f}
        $s23 = {4572646778796472517e7b6372657e}
        $s24 = {4a7d6b6877766b7d5e71746c7d6a71}
        $s25 = {4b7c6a6976776a7c5f70756d7c6b70}
        $s26 = {487f696a7574697f5c73766e7f6873}
        $s27 = {497e686b7475687e5d72776f7e6972}
        $s28 = {4e796f6c73726f795a757068796e75}
        $s29 = {4f786e6d72736e785b747169786f74}
        $s30 = {4c7b6d6e71706d7b5877726a7b6c77}
        $s31 = {4d7a6c6f70716c7a5976736b7a6d76}
        $s32 = {724553504f4e534566494c54455249}
        $s33 = {734452514e4f524467484d55445348}
        $s34 = {704751524d4c5147644b4e5647504b}
        $s35 = {714650534c4d5046654a4f5746514a}
        $s36 = {764157544b4a5741624d485041564d}
        $s37 = {774056554a4b5640634c495140574c}
        $s38 = {7443555649485543604f4a5243544f}
        $s39 = {7542545748495442614e4b5342554e}
        $s40 = {7a4d5b5847465b4d6e41445c4d5a41}
        $s41 = {7b4c5a5946475a4c6f40455d4c5b40}
        $s42 = {784f595a4544594f6c43465e4f5843}
        $s43 = {794e585b4445584e6d42475f4e5942}
        $s44 = {7e495f5c43425f496a454058495e45}
        $s45 = {7f485e5d42435e486b444159485f44}
        $s46 = {7c4b5d5e41405d4b6847425a4b5c47}
        $s47 = {7d4a5c5f40415c4a6946435b4a5d46}
        $s48 = {625543405f5e435576595c44554259}
        $s49 = {635442415e5f425477585d45544358}
        $s50 = {605741425d5c4157745b5e4657405b}
        $s51 = {615640435c5d4056755a5f4756415a}
        $s52 = {665147445b5a4751725d584051465d}
        $s53 = {675046455a5b4650735c594150475c}
        $s54 = {6453454659584553705f5a4253445f}
        $s55 = {6552444758594452715e5b4352455e}
        $s56 = {6a5d4b4857564b5d7e51544c5d4a51}
        $s57 = {6b5c4a4956574a5c7f50554d5c4b50}
        $s58 = {685f494a5554495f7c53564e5f4853}
        $s59 = {695e484b5455485e7d52574f5e4952}
        $s60 = {6e594f4c53524f597a555048594e55}
        $s61 = {6f584e4d52534e587b545149584f54}
        $s62 = {6c5b4d4e51504d5b7857524a5b4c57}
        $s63 = {6d5a4c4f50514c5a7956534b5a4d56}
        $s64 = {122533302f2e332506292c34253229}
        $s65 = {132432312e2f322407282d35243328}
        $s66 = {102731322d2c3127042b2e3627302b}
        $s67 = {112630332c2d3026052a2f3726312a}
        $s68 = {162137342b2a3721022d283021362d}
        $s69 = {172036352a2b3620032c293120372c}
        $s70 = {1423353629283523002f2a3223342f}
        $s71 = {1522343728293422012e2b3322352e}
        $s72 = {1a2d3b3827263b2d0e21243c2d3a21}
        $s73 = {1b2c3a3926273a2c0f20253d2c3b20}
        $s74 = {182f393a2524392f0c23263e2f3823}
        $s75 = {192e383b2425382e0d22273f2e3922}
        $s76 = {1e293f3c23223f290a252038293e25}
        $s77 = {1f283e3d22233e280b242139283f24}
        $s78 = {1c2b3d3e21203d2b0827223a2b3c27}
        $s79 = {1d2a3c3f20213c2a0926233b2a3d26}
        $s80 = {023523203f3e233516393c24352239}
        $s81 = {033422213e3f223417383d25342338}
        $s82 = {003721223d3c2137143b3e2637203b}
        $s83 = {013620233c3d2036153a3f2736213a}
        $s84 = {063127243b3a2731123d382031263d}
        $s85 = {073026253a3b2630133c392130273c}
        $s86 = {0433252639382533103f3a2233243f}
        $s87 = {0532242738392432113e3b2332253e}
        $s88 = {0a3d2b2837362b3d1e31342c3d2a31}
        $s89 = {0b3c2a2936372a3c1f30352d3c2b30}
        $s90 = {083f292a3534293f1c33362e3f2833}
        $s91 = {093e282b3435283e1d32372f3e2932}
        $s92 = {0e392f2c33322f391a353028392e35}
        $s93 = {0f382e2d32332e381b343129382f34}
        $s94 = {0c3b2d2e31302d3b1837322a3b2c37}
        $s95 = {0d3a2c2f30312c3a1936332b3a2d36}
        $s96 = {320513100f0e130526090c14051209}
        $s97 = {330412110e0f120427080d15041308}
        $s98 = {300711120d0c1107240b0e1607100b}
        $s99 = {310610130c0d1006250a0f1706110a}
        $s100 = {360117140b0a1701220d081001160d}
        $s101 = {370016150a0b1600230c091100170c}
        $s102 = {3403151609081503200f0a1203140f}
        $s103 = {3502141708091402210e0b1302150e}
        $s104 = {3a0d1b1807061b0d2e01041c0d1a01}
        $s105 = {3b0c1a1906071a0c2f00051d0c1b00}
        $s106 = {380f191a0504190f2c03061e0f1803}
        $s107 = {390e181b0405180e2d02071f0e1902}
        $s108 = {3e091f1c03021f092a050018091e05}
        $s109 = {3f081e1d02031e082b040119081f04}
        $s110 = {3c0b1d1e01001d0b2807021a0b1c07}
        $s111 = {3d0a1c1f00011c0a2906031b0a1d06}
        $s112 = {221503001f1e031536191c04150219}
        $s113 = {231402011e1f021437181d05140318}
        $s114 = {201701021d1c0117341b1e0617001b}
        $s115 = {211600031c1d0016351a1f0716011a}
        $s116 = {261107041b1a0711321d180011061d}
        $s117 = {271006051a1b0610331c190110071c}
        $s118 = {2413050619180513301f1a0213041f}
        $s119 = {2512040718190412311e1b0312051e}
        $s120 = {2a1d0b0817160b1d3e11140c1d0a11}
        $s121 = {2b1c0a0916170a1c3f10150d1c0b10}
        $s122 = {281f090a1514091f3c13160e1f0813}
        $s123 = {291e080b1415081e3d12170f1e0912}
        $s124 = {2e190f0c13120f193a151008190e15}
        $s125 = {2f180e0d12130e183b141109180f14}
        $s126 = {2c1b0d0e11100d1b3817120a1b0c17}
        $s127 = {2d1a0c0f10110c1a3916130b1a0d16}
        $s128 = {d2e5f3f0efeef3e5c6e9ecf4e5f2e9}
        $s129 = {d3e4f2f1eeeff2e4c7e8edf5e4f3e8}
        $s130 = {d0e7f1f2edecf1e7c4ebeef6e7f0eb}
        $s131 = {d1e6f0f3ecedf0e6c5eaeff7e6f1ea}
        $s132 = {d6e1f7f4ebeaf7e1c2ede8f0e1f6ed}
        $s133 = {d7e0f6f5eaebf6e0c3ece9f1e0f7ec}
        $s134 = {d4e3f5f6e9e8f5e3c0efeaf2e3f4ef}
        $s135 = {d5e2f4f7e8e9f4e2c1eeebf3e2f5ee}
        $s136 = {daedfbf8e7e6fbedcee1e4fcedfae1}
        $s137 = {dbecfaf9e6e7faeccfe0e5fdecfbe0}
        $s138 = {d8eff9fae5e4f9efcce3e6feeff8e3}
        $s139 = {d9eef8fbe4e5f8eecde2e7ffeef9e2}
        $s140 = {dee9fffce3e2ffe9cae5e0f8e9fee5}
        $s141 = {dfe8fefde2e3fee8cbe4e1f9e8ffe4}
        $s142 = {dcebfdfee1e0fdebc8e7e2faebfce7}
        $s143 = {ddeafcffe0e1fceac9e6e3fbeafde6}
        $s144 = {c2f5e3e0fffee3f5d6f9fce4f5e2f9}
        $s145 = {c3f4e2e1feffe2f4d7f8fde5f4e3f8}
        $s146 = {c0f7e1e2fdfce1f7d4fbfee6f7e0fb}
        $s147 = {c1f6e0e3fcfde0f6d5faffe7f6e1fa}
        $s148 = {c6f1e7e4fbfae7f1d2fdf8e0f1e6fd}
        $s149 = {c7f0e6e5fafbe6f0d3fcf9e1f0e7fc}
        $s150 = {c4f3e5e6f9f8e5f3d0fffae2f3e4ff}
        $s151 = {c5f2e4e7f8f9e4f2d1fefbe3f2e5fe}
        $s152 = {cafdebe8f7f6ebfddef1f4ecfdeaf1}
        $s153 = {cbfceae9f6f7eafcdff0f5edfcebf0}
        $s154 = {c8ffe9eaf5f4e9ffdcf3f6eeffe8f3}
        $s155 = {c9fee8ebf4f5e8feddf2f7effee9f2}
        $s156 = {cef9efecf3f2eff9daf5f0e8f9eef5}
        $s157 = {cff8eeedf2f3eef8dbf4f1e9f8eff4}
        $s158 = {ccfbedeef1f0edfbd8f7f2eafbecf7}
        $s159 = {cdfaeceff0f1ecfad9f6f3ebfaedf6}
        $s160 = {f2c5d3d0cfced3c5e6c9ccd4c5d2c9}
        $s161 = {f3c4d2d1cecfd2c4e7c8cdd5c4d3c8}
        $s162 = {f0c7d1d2cdccd1c7e4cbced6c7d0cb}
        $s163 = {f1c6d0d3cccdd0c6e5cacfd7c6d1ca}
        $s164 = {f6c1d7d4cbcad7c1e2cdc8d0c1d6cd}
        $s165 = {f7c0d6d5cacbd6c0e3ccc9d1c0d7cc}
        $s166 = {f4c3d5d6c9c8d5c3e0cfcad2c3d4cf}
        $s167 = {f5c2d4d7c8c9d4c2e1cecbd3c2d5ce}
        $s168 = {facddbd8c7c6dbcdeec1c4dccddac1}
        $s169 = {fbccdad9c6c7daccefc0c5ddccdbc0}
        $s170 = {f8cfd9dac5c4d9cfecc3c6decfd8c3}
        $s171 = {f9ced8dbc4c5d8ceedc2c7dfced9c2}
        $s172 = {fec9dfdcc3c2dfc9eac5c0d8c9dec5}
        $s173 = {ffc8deddc2c3dec8ebc4c1d9c8dfc4}
        $s174 = {fccbdddec1c0ddcbe8c7c2dacbdcc7}
        $s175 = {fdcadcdfc0c1dccae9c6c3dbcaddc6}
        $s176 = {e2d5c3c0dfdec3d5f6d9dcc4d5c2d9}
        $s177 = {e3d4c2c1dedfc2d4f7d8ddc5d4c3d8}
        $s178 = {e0d7c1c2dddcc1d7f4dbdec6d7c0db}
        $s179 = {e1d6c0c3dcddc0d6f5dadfc7d6c1da}
        $s180 = {e6d1c7c4dbdac7d1f2ddd8c0d1c6dd}
        $s181 = {e7d0c6c5dadbc6d0f3dcd9c1d0c7dc}
        $s182 = {e4d3c5c6d9d8c5d3f0dfdac2d3c4df}
        $s183 = {e5d2c4c7d8d9c4d2f1dedbc3d2c5de}
        $s184 = {eaddcbc8d7d6cbddfed1d4ccddcad1}
        $s185 = {ebdccac9d6d7cadcffd0d5cddccbd0}
        $s186 = {e8dfc9cad5d4c9dffcd3d6cedfc8d3}
        $s187 = {e9dec8cbd4d5c8defdd2d7cfdec9d2}
        $s188 = {eed9cfccd3d2cfd9fad5d0c8d9ced5}
        $s189 = {efd8cecdd2d3ced8fbd4d1c9d8cfd4}
        $s190 = {ecdbcdced1d0cddbf8d7d2cadbccd7}
        $s191 = {eddacccfd0d1ccdaf9d6d3cbdacdd6}
        $s192 = {92a5b3b0afaeb3a586a9acb4a5b2a9}
        $s193 = {93a4b2b1aeafb2a487a8adb5a4b3a8}
        $s194 = {90a7b1b2adacb1a784abaeb6a7b0ab}
        $s195 = {91a6b0b3acadb0a685aaafb7a6b1aa}
        $s196 = {96a1b7b4abaab7a182ada8b0a1b6ad}
        $s197 = {97a0b6b5aaabb6a083aca9b1a0b7ac}
        $s198 = {94a3b5b6a9a8b5a380afaab2a3b4af}
        $s199 = {95a2b4b7a8a9b4a281aeabb3a2b5ae}
        $s200 = {9aadbbb8a7a6bbad8ea1a4bcadbaa1}
        $s201 = {9bacbab9a6a7baac8fa0a5bdacbba0}
        $s202 = {98afb9baa5a4b9af8ca3a6beafb8a3}
        $s203 = {99aeb8bba4a5b8ae8da2a7bfaeb9a2}
        $s204 = {9ea9bfbca3a2bfa98aa5a0b8a9bea5}
        $s205 = {9fa8bebda2a3bea88ba4a1b9a8bfa4}
        $s206 = {9cabbdbea1a0bdab88a7a2baabbca7}
        $s207 = {9daabcbfa0a1bcaa89a6a3bbaabda6}
        $s208 = {82b5a3a0bfbea3b596b9bca4b5a2b9}
        $s209 = {83b4a2a1bebfa2b497b8bda5b4a3b8}
        $s210 = {80b7a1a2bdbca1b794bbbea6b7a0bb}
        $s211 = {81b6a0a3bcbda0b695babfa7b6a1ba}
        $s212 = {86b1a7a4bbbaa7b192bdb8a0b1a6bd}
        $s213 = {87b0a6a5babba6b093bcb9a1b0a7bc}
        $s214 = {84b3a5a6b9b8a5b390bfbaa2b3a4bf}
        $s215 = {85b2a4a7b8b9a4b291bebba3b2a5be}
        $s216 = {8abdaba8b7b6abbd9eb1b4acbdaab1}
        $s217 = {8bbcaaa9b6b7aabc9fb0b5adbcabb0}
        $s218 = {88bfa9aab5b4a9bf9cb3b6aebfa8b3}
        $s219 = {89bea8abb4b5a8be9db2b7afbea9b2}
        $s220 = {8eb9afacb3b2afb99ab5b0a8b9aeb5}
        $s221 = {8fb8aeadb2b3aeb89bb4b1a9b8afb4}
        $s222 = {8cbbadaeb1b0adbb98b7b2aabbacb7}
        $s223 = {8dbaacafb0b1acba99b6b3abbaadb6}
        $s224 = {b28593908f8e9385a6898c94859289}
        $s225 = {b38492918e8f9284a7888d95849388}
        $s226 = {b08791928d8c9187a48b8e9687908b}
        $s227 = {b18690938c8d9086a58a8f9786918a}
        $s228 = {b68197948b8a9781a28d889081968d}
        $s229 = {b78096958a8b9680a38c899180978c}
        $s230 = {b483959689889583a08f8a9283948f}
        $s231 = {b582949788899482a18e8b9382958e}
        $s232 = {ba8d9b9887869b8dae81849c8d9a81}
        $s233 = {bb8c9a9986879a8caf80859d8c9b80}
        $s234 = {b88f999a8584998fac83869e8f9883}
        $s235 = {b98e989b8485988ead82879f8e9982}
        $s236 = {be899f9c83829f89aa858098899e85}
        $s237 = {bf889e9d82839e88ab848199889f84}
        $s238 = {bc8b9d9e81809d8ba887829a8b9c87}
        $s239 = {bd8a9c9f80819c8aa986839b8a9d86}
        $s240 = {a29583809f9e8395b6999c84958299}
        $s241 = {a39482819e9f8294b7989d85948398}
        $s242 = {a09781829d9c8197b49b9e8697809b}
        $s243 = {a19680839c9d8096b59a9f8796819a}
        $s244 = {a69187849b9a8791b29d988091869d}
        $s245 = {a79086859a9b8690b39c998190879c}
        $s246 = {a493858699988593b09f9a8293849f}
        $s247 = {a592848798998492b19e9b8392859e}
        $s248 = {aa9d8b8897968b9dbe91948c9d8a91}
        $s249 = {ab9c8a8996978a9cbf90958d9c8b90}
        $s250 = {a89f898a9594899fbc93968e9f8893}
        $s251 = {a99e888b9495889ebd92978f9e8992}
        $s252 = {ae998f8c93928f99ba959088998e95}
        $s253 = {af988e8d92938e98bb949189988f94}
        $s254 = {ac9b8d8e91908d9bb897928a9b8c97}
        $t1 = {686f6475727377}
        $t2 = {6b6c6776717074}
        $t3 = {6a6d6677707175}
        $t4 = {6d6a6170777672}
        $t5 = {6c6b6071767773}
        $t6 = {6f686372757470}
        $t7 = {6e696273747571}
        $t8 = {61666d7c7b7a7e}
        $t9 = {60676c7d7a7b7f}
        $t10 = {63646f7e79787c}
        $t11 = {62656e7f78797d}
        $t12 = {656269787f7e7a}
        $t13 = {646368797e7f7b}
        $t14 = {67606b7a7d7c78}
        $t15 = {66616a7b7c7d79}
        $t16 = {797e7564636266}
        $t17 = {787f7465626367}
        $t18 = {7b7c7766616064}
        $t19 = {7a7d7667606165}
        $t20 = {7d7a7160676662}
        $t21 = {7c7b7061666763}
        $t22 = {7f787362656460}
        $t23 = {7e797263646561}
        $t24 = {71767d6c6b6a6e}
        $t25 = {70777c6d6a6b6f}
        $t26 = {73747f6e69686c}
        $t27 = {72757e6f68696d}
        $t28 = {757279686f6e6a}
        $t29 = {747378696e6f6b}
        $t30 = {77707b6a6d6c68}
        $t31 = {76717a6b6c6d69}
        $t32 = {494e4554535256}
        $t33 = {484f4455525357}
        $t34 = {4b4c4756515054}
        $t35 = {4a4d4657505155}
        $t36 = {4d4a4150575652}
        $t37 = {4c4b4051565753}
        $t38 = {4f484352555450}
        $t39 = {4e494253545551}
        $t40 = {41464d5c5b5a5e}
        $t41 = {40474c5d5a5b5f}
        $t42 = {43444f5e59585c}
        $t43 = {42454e5f58595d}
        $t44 = {454249585f5e5a}
        $t45 = {444348595e5f5b}
        $t46 = {47404b5a5d5c58}
        $t47 = {46414a5b5c5d59}
        $t48 = {595e5544434246}
        $t49 = {585f5445424347}
        $t50 = {5b5c5746414044}
        $t51 = {5a5d5647404145}
        $t52 = {5d5a5140474642}
        $t53 = {5c5b5041464743}
        $t54 = {5f585342454440}
        $t55 = {5e595243444541}
        $t56 = {51565d4c4b4a4e}
        $t57 = {50575c4d4a4b4f}
        $t58 = {53545f4e49484c}
        $t59 = {52555e4f48494d}
        $t60 = {555259484f4e4a}
        $t61 = {545358494e4f4b}
        $t62 = {57505b4a4d4c48}
        $t63 = {56515a4b4c4d49}
        $t64 = {292e2534333236}
        $t65 = {282f2435323337}
        $t66 = {2b2c2736313034}
        $t67 = {2a2d2637303135}
        $t68 = {2d2a2130373632}
        $t69 = {2c2b2031363733}
        $t70 = {2f282332353430}
        $t71 = {2e292233343531}
        $t72 = {21262d3c3b3a3e}
        $t73 = {20272c3d3a3b3f}
        $t74 = {23242f3e39383c}
        $t75 = {22252e3f38393d}
        $t76 = {252229383f3e3a}
        $t77 = {242328393e3f3b}
        $t78 = {27202b3a3d3c38}
        $t79 = {26212a3b3c3d39}
        $t80 = {393e3524232226}
        $t81 = {383f3425222327}
        $t82 = {3b3c3726212024}
        $t83 = {3a3d3627202125}
        $t84 = {3d3a3120272622}
        $t85 = {3c3b3021262723}
        $t86 = {3f383322252420}
        $t87 = {3e393223242521}
        $t88 = {31363d2c2b2a2e}
        $t89 = {30373c2d2a2b2f}
        $t90 = {33343f2e29282c}
        $t91 = {32353e2f28292d}
        $t92 = {353239282f2e2a}
        $t93 = {343338292e2f2b}
        $t94 = {37303b2a2d2c28}
        $t95 = {36313a2b2c2d29}
        $t96 = {090e0514131216}
        $t97 = {080f0415121317}
        $t98 = {0b0c0716111014}
        $t99 = {0a0d0617101115}
        $t100 = {0d0a0110171612}
        $t101 = {0c0b0011161713}
        $t102 = {0f080312151410}
        $t103 = {0e090213141511}
        $t104 = {01060d1c1b1a1e}
        $t105 = {00070c1d1a1b1f}
        $t106 = {03040f1e19181c}
        $t107 = {02050e1f18191d}
        $t108 = {050209181f1e1a}
        $t109 = {040308191e1f1b}
        $t110 = {07000b1a1d1c18}
        $t111 = {06010a1b1c1d19}
        $t112 = {191e1504030206}
        $t113 = {181f1405020307}
        $t114 = {1b1c1706010004}
        $t115 = {1a1d1607000105}
        $t116 = {1d1a1100070602}
        $t117 = {1c1b1001060703}
        $t118 = {1f181302050400}
        $t119 = {1e191203040501}
        $t120 = {11161d0c0b0a0e}
        $t121 = {10171c0d0a0b0f}
        $t122 = {13141f0e09080c}
        $t123 = {12151e0f08090d}
        $t124 = {151219080f0e0a}
        $t125 = {141318090e0f0b}
        $t126 = {17101b0a0d0c08}
        $t127 = {16111a0b0c0d09}
        $t128 = {e9eee5f4f3f2f6}
        $t129 = {e8efe4f5f2f3f7}
        $t130 = {ebece7f6f1f0f4}
        $t131 = {eaede6f7f0f1f5}
        $t132 = {edeae1f0f7f6f2}
        $t133 = {ecebe0f1f6f7f3}
        $t134 = {efe8e3f2f5f4f0}
        $t135 = {eee9e2f3f4f5f1}
        $t136 = {e1e6edfcfbfafe}
        $t137 = {e0e7ecfdfafbff}
        $t138 = {e3e4effef9f8fc}
        $t139 = {e2e5eefff8f9fd}
        $t140 = {e5e2e9f8fffefa}
        $t141 = {e4e3e8f9fefffb}
        $t142 = {e7e0ebfafdfcf8}
        $t143 = {e6e1eafbfcfdf9}
        $t144 = {f9fef5e4e3e2e6}
        $t145 = {f8fff4e5e2e3e7}
        $t146 = {fbfcf7e6e1e0e4}
        $t147 = {fafdf6e7e0e1e5}
        $t148 = {fdfaf1e0e7e6e2}
        $t149 = {fcfbf0e1e6e7e3}
        $t150 = {fff8f3e2e5e4e0}
        $t151 = {fef9f2e3e4e5e1}
        $t152 = {f1f6fdecebeaee}
        $t153 = {f0f7fcedeaebef}
        $t154 = {f3f4ffeee9e8ec}
        $t155 = {f2f5feefe8e9ed}
        $t156 = {f5f2f9e8efeeea}
        $t157 = {f4f3f8e9eeefeb}
        $t158 = {f7f0fbeaedece8}
        $t159 = {f6f1faebecede9}
        $t160 = {c9cec5d4d3d2d6}
        $t161 = {c8cfc4d5d2d3d7}
        $t162 = {cbccc7d6d1d0d4}
        $t163 = {cacdc6d7d0d1d5}
        $t164 = {cdcac1d0d7d6d2}
        $t165 = {cccbc0d1d6d7d3}
        $t166 = {cfc8c3d2d5d4d0}
        $t167 = {cec9c2d3d4d5d1}
        $t168 = {c1c6cddcdbdade}
        $t169 = {c0c7ccdddadbdf}
        $t170 = {c3c4cfded9d8dc}
        $t171 = {c2c5cedfd8d9dd}
        $t172 = {c5c2c9d8dfdeda}
        $t173 = {c4c3c8d9dedfdb}
        $t174 = {c7c0cbdadddcd8}
        $t175 = {c6c1cadbdcddd9}
        $t176 = {d9ded5c4c3c2c6}
        $t177 = {d8dfd4c5c2c3c7}
        $t178 = {dbdcd7c6c1c0c4}
        $t179 = {daddd6c7c0c1c5}
        $t180 = {dddad1c0c7c6c2}
        $t181 = {dcdbd0c1c6c7c3}
        $t182 = {dfd8d3c2c5c4c0}
        $t183 = {ded9d2c3c4c5c1}
        $t184 = {d1d6ddcccbcace}
        $t185 = {d0d7dccdcacbcf}
        $t186 = {d3d4dfcec9c8cc}
        $t187 = {d2d5decfc8c9cd}
        $t188 = {d5d2d9c8cfceca}
        $t189 = {d4d3d8c9cecfcb}
        $t190 = {d7d0dbcacdccc8}
        $t191 = {d6d1dacbcccdc9}
        $t192 = {a9aea5b4b3b2b6}
        $t193 = {a8afa4b5b2b3b7}
        $t194 = {abaca7b6b1b0b4}
        $t195 = {aaada6b7b0b1b5}
        $t196 = {adaaa1b0b7b6b2}
        $t197 = {acaba0b1b6b7b3}
        $t198 = {afa8a3b2b5b4b0}
        $t199 = {aea9a2b3b4b5b1}
        $t200 = {a1a6adbcbbbabe}
        $t201 = {a0a7acbdbabbbf}
        $t202 = {a3a4afbeb9b8bc}
        $t203 = {a2a5aebfb8b9bd}
        $t204 = {a5a2a9b8bfbeba}
        $t205 = {a4a3a8b9bebfbb}
        $t206 = {a7a0abbabdbcb8}
        $t207 = {a6a1aabbbcbdb9}
        $t208 = {b9beb5a4a3a2a6}
        $t209 = {b8bfb4a5a2a3a7}
        $t210 = {bbbcb7a6a1a0a4}
        $t211 = {babdb6a7a0a1a5}
        $t212 = {bdbab1a0a7a6a2}
        $t213 = {bcbbb0a1a6a7a3}
        $t214 = {bfb8b3a2a5a4a0}
        $t215 = {beb9b2a3a4a5a1}
        $t216 = {b1b6bdacabaaae}
        $t217 = {b0b7bcadaaabaf}
        $t218 = {b3b4bfaea9a8ac}
        $t219 = {b2b5beafa8a9ad}
        $t220 = {b5b2b9a8afaeaa}
        $t221 = {b4b3b8a9aeafab}
        $t222 = {b7b0bbaaadaca8}
        $t223 = {b6b1baabacada9}
        $t224 = {898e8594939296}
        $t225 = {888f8495929397}
        $t226 = {8b8c8796919094}
        $t227 = {8a8d8697909195}
        $t228 = {8d8a8190979692}
        $t229 = {8c8b8091969793}
        $t230 = {8f888392959490}
        $t231 = {8e898293949591}
        $t232 = {81868d9c9b9a9e}
        $t233 = {80878c9d9a9b9f}
        $t234 = {83848f9e99989c}
        $t235 = {82858e9f98999d}
        $t236 = {858289989f9e9a}
        $t237 = {848388999e9f9b}
        $t238 = {87808b9a9d9c98}
        $t239 = {86818a9b9c9d99}
        $t240 = {999e9584838286}
        $t241 = {989f9485828387}
        $t242 = {9b9c9786818084}
        $t243 = {9a9d9687808185}
        $t244 = {9d9a9180878682}
        $t245 = {9c9b9081868783}
        $t246 = {9f989382858480}
        $t247 = {9e999283848581}
        $t248 = {91969d8c8b8a8e}
        $t249 = {90979c8d8a8b8f}
        $t250 = {93949f8e89888c}
        $t251 = {92959e8f88898d}
        $t252 = {959299888f8e8a}
        $t253 = {949398898e8f8b}
        $t254 = {97909b8a8d8c88}
    condition:
        uint16(0) == 0x5a4d and
        (1 of ($s*)) and (1 of ($t*)) and
        filesize < 2MB
}

rule CrowdStrike_CSIT_21005_01 : doorme implant 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects Doorme IIS implant through strings and decoding algorithm"
        reports = "CSIT-21005"
        version = "202102191057"
        last_modified = "2021-02-19"
        malware_family = "Doorme"
    strings:
        $s1 = "POST"
        $s2 = "CGlobalModule::OnGlobal"
        $pat = { 80 f2 ?? 88 55 ?? 41 80 f0 ?? 44 88 45 ?? 41 80 f1 ?? 44 88 4d ?? 41 80 f2 ?? 44 88 55 ?? }
    condition:
        uint16(0) == 0x5a4d and
        $s1 and
        #s2 > 10 and
        $pat
}

rule CrowdStrike_CSA_201570_01 : poorweb rat ricochet_chollima 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects strings used for C2 communications in a suspected RICOCHET CHOLLIMA RAT dubbed PoorWeb"
        reports = "CSA-201570"
        version = "202012181538"
        last_modified = "2020-12-18"
        actor = "RICOCHET CHOLLIMA"
        malware_family = "PoorWeb"
    strings:
        $powershell_req_get = "cmd /c powershell invoke-restmethod -uri %s -method get -header @{'cache-control'='no-cache'} -body @{%s}"
        $powershell_req_post = "cmd /c powershell invoke-restmethod -uri %s -method post -header @{'cache-control'='no-cache'} -body @{"
        $req_connect = "REQ='Connect';ID='%d'" fullword
        $req_send = "REQ='Send';KEY='%s';ID1='%d';ID2='%d';Data='" fullword
        $req_receive = "REQ='Receive';KEY='%s';ID1='%d';ID2='%d';RecvSize='%d'" fullword
        $req_disconnect = "REQ='Disconnect';KEY='%s';ID1='%d';ID2='%d'" fullword
        $req_connect_ok = "Connecting OK!" fullword
        $req_send_ok = "Sending OK!" fullword
        $req_receive_ok = "Receiving OK!" fullword
        $req_receive_fail = "Receiving Fail!Time is out of 25s." fullword
        $name_exe = "IDMhelpAssist.exe" wide
        $name_asep = "IDMhelp" wide fullword
        $name_mutex = "KMJuiidse_Mutex" fullword
    condition:
        uint16(0) == 0x5a4d and 1 of ($powershell_*) and 4 of ($req_*) and 1 of ($name_*)
}

rule CrowdStrike_CSIT_20224_01 : loader stealer taurusstealer 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detect Taurus stealer using code patterns"
        reports = "CSIT-20224"
        version = "202103171626"
        last_modified = "2021-03-17"
        malware_family = "TaurusStealer"
    strings:
        $cis_check = { 3d 19 04 00 00 0f 84 [4] 3d 2b 04 00 00 0f 84 [4] 3d 23 04 00 00 0f 84 [4] 3d 37 04 00 00 0f 84 [4] 3d 3f 04 00 00 0f 84 [4] 3d 28 04 00 00 0f 84 [4] 3d 43 08 00 00 0f 84 [4] 3d 22 04 00 00 }
        $allocate_100MB = { 68 00 00 40 06 e8 }
        $custom_crc32_table = { 6a 7a 04 41 d4 f4 08 82 be 8e 0c c3 df ef 60 df }
    condition:
        uint16(0) == 0x5a4d and
        ($custom_crc32_table and ($cis_check or $allocate_100MB)) and
        filesize < 500KB
}

rule CrowdStrike_CSIT_20243_01 : rat stellarparticle sunburst 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects SUNBURST malware through encoded data used by the malware to detect security products"
        reports = "CSIT-20243"
        version = "202012181542"
        last_modified = "2020-12-18"
        malware_family = "SUNBURST"
        activity_cluster = "StellarParticle"
    strings:
        $dotnet = "BSJB"
        // Service captions
        $service_cap_1 = { d2 46 94 3a b8 45 a9 8b }
        $service_cap_2 = { d7 1f 5d f6 f2 cc bb 91 }
        $service_cap_3 = { 96 b0 00 66 d4 73 5a 92 }
        $service_cap_4 = { 2c 25 61 ce 70 27 b6 ac }
        $service_cap_5 = { 28 d9 44 66 b1 41 0e c3 }
        $service_cap_6 = { b2 3d 2e c2 bc 95 6a c9 }
        $service_cap_7 = { bd 6e 51 f0 0b 8d c6 cf }
        $service_cap_8 = { de 51 7e 80 84 39 b8 d0 }
        $service_cap_9 = { f4 2c 43 5a b1 25 2a 02 }
        $service_cap_10 = { 66 c8 8b ec 6f 0b d1 d9 }
        $service_cap_11 = { eb f8 c0 11 1f cf 2b ec }
        $service_cap_12 = { 80 a6 5f 4f ab e2 c3 ee }
        $service_cap_13 = { 47 db bd 2d 96 70 81 f9 }
        $service_cap_14 = { 32 10 86 e8 5b de 69 2c }
        $service_cap_15 = { af e0 72 3a 68 28 f0 47 }
        $service_cap_16 = { 71 c4 dc da c1 85 3b 07 }
        $service_cap_17 = { d7 8a 2c 29 8d fd 8a 4d }
        $service_cap_18 = { d7 08 92 12 3c dc 0e 53 }
        $service_cap_19 = { fc 31 4d 9d 5b 33 6d 08 }
        $service_cap_20 = { c6 0d 49 22 de d4 e3 08 }
        $service_cap_21 = { 32 11 f6 61 22 aa b6 78 }
        $service_cap_22 = { 8a d5 9f 83 bf ea bf 7d }
        // Service path names
        $service_path_1 = { da ec d8 f6 70 90 3e 90 }
        $service_path_2 = { 30 5e da a4 a2 9f 00 9e }
        $service_path_3 = { 2c 25 61 ce 70 27 b6 ac }
        $service_path_4 = { 86 43 61 ce 70 59 b6 ac }
        $service_path_5 = { 10 79 68 0d a5 3b 81 bd }
        $service_path_6 = { 93 13 07 bb 3b 2d 09 be }
        $service_path_7 = { 56 5e 50 0b 8f 48 48 bf }
        $service_path_8 = { 0c 20 30 2d ff 0e 65 c3 }
        $service_path_9 = { c8 e1 4e 33 78 af ab c5 }
        $service_path_10 = { fc a2 2c 42 dd 4a 72 d1 }
        $service_path_11 = { 7d aa 30 7c 8a 53 50 d8 }
        $service_path_12 = { 66 c8 8b ec 6f 0b d1 d9 }
        $service_path_13 = { 04 32 9d fc 59 36 f8 de }
        $service_path_14 = { 1d ef 0b 44 fa fd 9b df }
        $service_path_15 = { fe 34 8a f7 0b dd b3 e2 }
        $service_path_16 = { 52 fa 67 7b dd 8c 95 f4 }
        $service_path_17 = { ee c0 b8 e4 7b cd b6 f7 }
        $service_path_18 = { 28 4b f8 cf 5b 92 f5 f8 }
        $service_path_19 = { a9 e8 f8 17 13 a0 c5 f9 }
        $service_path_20 = { 97 6a c9 ad 10 40 38 fd }
        $service_path_21 = { 7e 1e d3 86 21 41 08 21 }
        $service_path_22 = { 18 11 07 35 de 44 f1 23 }
        $service_path_23 = { 2d 96 0d 6b 33 bc 15 2e }
        $service_path_24 = { 8a 09 cd 76 43 8d 4b 2f }
        $service_path_25 = { 11 5a c5 76 43 99 5d 2f }
        $service_path_26 = { fc 55 26 77 43 8f 60 2f }
        $service_path_27 = { 89 8f de 76 43 89 7a 2f }
        $service_path_28 = { 82 1d b3 3b b3 f8 88 2f }
        $service_path_29 = { cb 7a d7 22 b1 fe 70 44 }
        $service_path_30 = { 2c 9c be 19 f8 a1 82 07 }
        $service_path_31 = { 77 a6 d6 19 66 c7 11 57 }
        $service_path_32 = { 50 26 42 4f a6 14 87 65 }
        $service_path_33 = { 0e dd a6 ff 70 ae 85 81 }
        $service_path_34 = { 7c dc e7 b1 f8 d0 3c 82 }
        $service_path_35 = { e8 a6 82 ca 49 a3 aa 84 }
        $service_path_36 = { a7 1d 39 c3 65 5a 5e a3 }
        $service_path_37 = { 32 10 86 e8 5b de 69 2c }
        $service_path_38 = { 3f 61 de 76 43 97 7a 2f }
        $service_path_39 = { 32 11 f6 61 22 aa b6 78 }
        $service_path_40 = { c2 81 89 6c bc 1b bc 0c }
        $service_path_41 = { 35 ee 00 8c c4 ef 28 80 }
        // Driver file names
        $driver_name_1 = { b8 5d 13 52 f8 18 46 ed }
        $driver_name_2 = { be 9c d7 50 b2 22 df d2 }
        $driver_name_3 = { 84 87 a5 49 af e4 80 b0 }
        $driver_name_4 = { 0f 2e db 56 a8 a4 40 ff }
        $driver_name_5 = { 54 cb 04 da 8a a5 52 32 }
        $driver_name_6 = { c9 ad c8 4e ea 54 4c ab }
        $driver_name_7 = { 0d 13 34 26 ad 33 85 05 }
        $driver_name_8 = { 8b ad 2b d1 c1 da 5a 60 }
        $driver_name_9 = { 98 b8 1b f3 15 11 f6 bb }
        $driver_name_10 = { 6c b0 67 68 1a 3a c8 a3 }
        $driver_name_11 = { 9c c7 35 bd b8 39 04 fc }
        $driver_name_12 = { eb 5d 44 4f c0 0d 97 0b }
        $driver_name_13 = { bb 42 c0 45 c3 52 f7 e5 }
        $driver_name_14 = { 17 9d a6 4d 11 bc 67 16 }
        $driver_name_15 = { 98 83 51 f7 d2 8c f5 af }
        $driver_name_16 = { 0b a2 57 ac 4e d0 b4 25 }
        $driver_name_17 = { 33 a8 3b 26 68 40 96 f9 }
    condition:
        uint16(0) == 0x5a4d and
        $dotnet and
        5 of ($service_cap_*) and
        5 of ($service_path_*) and
        5 of ($driver_name_*)
}

rule CrowdStrike_CSIT_20243_03 : rat stellarparticle sunburst 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects SUNBURST malware through and XOR pattern and associated encoded data"
        reports = "CSIT-20243"
        version = "202012181544"
        last_modified = "2020-12-18"
        malware_family = "SUNBURST"
        activity_cluster = "StellarParticle"
    strings:
        $dotnet = "BSJB"
        $xor = { 67 19 d8 a7 3b 90 ac 5b }
        $regex = "U4qpjjbQtUzUTdONrTY2q42pVapRgooABYxQuIZmtUoA" wide
    condition:
        uint16(0) == 0x5a4d and
        $dotnet and
        $xor and
        $regex
}

rule CrowdStrike_CSIT_20243_02 : rat stellarparticle sunburst 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects SUNBURST malware through encoded strings used in the DGA C2 communication process"
        reports = "CSIT-20243"
        version = "202012181544"
        last_modified = "2020-12-18"
        malware_family = "SUNBURST"
        activity_cluster = "StellarParticle"
    strings:
        $dotnet = "BSJB"
        $ = "07DP1NQozs9JLCrPzEsp1gQA" wide
        $ = "07DP1NSIjkvUrYqtidPUKEktLoHzVTQB" wide
        $ = "8/B2jYz38Xd29In3dXT28PRzjQn2dwsJdwxyjfHNTC7KL85PK4lxLqosKMlPL0osyKgEAA==" wide
        $ = "801MzsjMS3UvzUwBAA==" wide
        $ = "83V0dkxJKUotLgYA" wide
        $ = "88wrLknMyXFJLEkFAA==" wide
        $ = "8w92LErOyCxJTS4pLUoFAA==" wide
        $ = "8wwILk3KSy0BAA==" wide
        $ = "8wxwTEkpSi0uBgA=" wide
        $ = "8y9KT8zLrEosyczPAwA=" wide
        $ = "C07NSU0uUdBScCvKz1UIz8wzNor3L0gtSizJzEsPriwuSc0FAA==" wide
        $ = "C07NSU0uUdBScCvKz1UIz8wzNor3Sy0pzy/KdkxJLChJLXLOz0vLTC8tSizJzM9TKM9ILUpV8AxwzUtMyklNsS0pKk0FAA==" wide
        $ = "C0otyC8qCU8sSc5ILQpKLSmqBAA=" wide
        $ = "C0otyC8qCU8sSc5ILQrILy4pyM9LBQA=" wide
        $ = "C0pNzywuSS1KTQktTi0CAA==" wide
        $ = "C0stKs7MzwMA" wide
        $ = "Ky3WLU8tLtE1AgA=" wide
        $ = "Ky3WTU0sLtE1AgA=" wide
        $ = "Ky3WTU0sLtE1BAA=" wide
        $ = "M7Q00jM0s9Az0DMAAA==" wide
        $ = "M7Qw0TM30jPQMwAA" wide
        $ = "M7S01DMyMNQzNDTXMwAA" wide
        $ = "M7TQMzQ20ANCAA==" wide
        $ = "M7UwTkm0NDHVNTNKTNM1NEi10DWxNDDSTbRIMzIwTTY3SjJKBQA=" wide
        $ = "MzHUszDRMzS11DMAAA==" wide
        $ = "MzI01zM0M9Yz1zMAAA==" wide
        $ = "MzI11TMAQQA=" wide
        $ = "MzI11TMCYRMLPQMA" wide
        $ = "MzI11TMCYgM9AwA=" wide
        $ = "MzI11TMCYxM9AwA=" wide
        $ = "MzI11TMCYyM9AwA=" wide
        $ = "MzI11TMyMdADQgA=" wide
        $ = "MzI11TMyNdEz0DMAAA==" wide
        $ = "MzI11TOCYgMA" wide
        $ = "MzIx0ANDAA==" wide
        $ = "MzIy0TMAQQA=" wide
        $ = "MzLQMzQx0ANCAA==" wide
        $ = "MzQ10TM0tNAzNDHQMwAA" wide
        $ = "MzQ21DMystAzNNIzAAA=" wide
        $ = "MzQ30jM00zPQMwAA" wide
        $ = "MzQx0bMw0zMyMtMzAAA=" wide
        $ = "MzTQA0MA" wide
        $ = "MzfRMzQ00TMy0TMAAA==" wide
        $ = "MzfUMzQ10jM11jMAAA==" wide
        $ = "S0s1MLCyAgA=" wide
        $ = "S0s2MLCyAgA=" wide
        $ = "S0szMLCyAgA=" wide
        $ = "S0tLNrCyAgA=" wide
        $ = "S0tNNrCyAgA=" wide
        $ = "Sy3VLU8tLtE1BAA=" wide
        $ = "SywoKK7MS9ZNLMgEAA==" wide
        $ = "SywrLstNzskvTdFLzs8FAA==" wide
        $ = "SyzI1CvOz0ksKs/MSynWS87PBQA=" wide
        $ = "c/EL9sgvLvFLzE0FAA==" wide
        $ = "c/ELDk4tKkstCk5NLErO8C9KSS0CAA==" wide
        $ = "c/ELdsnPTczMCy5NS8usCE5NLErO8C9KSS0CAA==" wide
        $ = "c/FwDghOLSpLLQIA" wide
        $ = "c/FwDnDNS0zKSU0BAA==" wide
        $ = "c04sKMnMzwMA" wide
        $ = "c0ktTi7KLCjJzM8DAA==" wide
        $ = "c0lNSyzNKfEMcE8sSS1PrAQA" wide
        $ = "i3aNVag2qFWoNgRio1oA" wide
        $ = "s7TUM7fUM9AzAAA=" wide
        $ = "s9AztNAzNDHRMwAA" wide
        $ = "szDXMzK20LMw0DMAAA==" wide
        $ = "szTTMzbUMzQ30jMAAA==" wide
    condition:
        uint16(0) == 0x5a4d and
        $dotnet and
        6 of them
}

rule CrowdStrike_CSA_201592_01 : supernova 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "C# compiler in StellarParticle's Supernova malware"
        reports = "CSA-201592"
        version = "202102022011"
        last_modified = "2021-02-02"
        malware_family = "SUPERNOVA"
    strings:
        $dotnetilbytes = { 07 0e 04 0c 08 6f }
        $dotnetverstr = ".NETFramework,Version="
        $dllname = "System.dll" wide
        $method1 = "CreateCompiler"
        $method2 = "CompileAssemblyFromSource"
        $method3 = "Invoke"
    condition:
        all of them
}

rule CrowdStrike_CSIT_20241_01 : eggshell eggshellmilt labyrinth_chollima milt python rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects known variants of the Python variant of Milt"
        reports = "CSIT-20241"
        version = "202102011432"
        last_modified = "2021-02-01"
        actor = "LABYRINTH CHOLLIMA"
        malware_family = "EggShellMilt"
    strings:
        $s_1 = "URc2A0sSGhIBCVECWx1MBBNPFQBbUghDFx4S" ascii
        $s_2 = " EQIdAAMYDQlZDk8MTB8IAhQ=" ascii
        $s_3 = "EggShell" ascii
    condition:
        (uint32(0) == 0x0a0df303 or uint32(0) == 0x752f2123) and 2 of ($s_*) and filesize < 500KB
}

rule CrowdStrike_CSA_201608_01 : loader stellarparticle teardrop 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects instance of the TEARDROP loader used to deploy Cobalt Strike and associated with the StellarParticle activity cluster"
        reports = "CSA-201608"
        version = "202012181958"
        last_modified = "2020-12-18"
        malware_family = "TEARDROP"
        activity_cluster = "StellarParticle"
    strings:
        $code_xormul_fragment               = { 48 f7 e3 48 89 c8 44 89 ce 48 c1 ea 06 }
        $code_mov_Alloc                     = { c7 02 41 6c 6c 6f }
        $code_mov_SOFTWARE                  = { 48 b8 53 4f 46 54 57 41 52 45 }
        $code_shifts                        = { 8d 46 f8 49 8d 51 08 d1 e8 }
        $code_mov_Protect                   = { 48 b8 50 72 6f 74 65 63 74 00 }
    condition:
        2 of them
}

rule CrowdStrike_CSA_201621_01 : chollima fatfingers rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects strings used to construct HTTP beacons in FatFingers RAT. It also checks for a specific PDB path in an obfuscated PE version"
        reports = "CSA-201621"
        version = "202101051422"
        last_modified = "2021-01-05"
        actor = "CHOLLIMA"
        malware_family = "FatFingers"
    strings:
        $all_c2_url = "/do.php"
        $all_c2_beacon_0 = "?type=hello&direction=send&id="
        $all_cmd_request_0 = "?type=command&direction=receive&id="
        $all_cmd_request_1 = "&type=command&direction=receive"
        $all_upload_0 = "?type=file&direction=send&id="
        $ps_cmd_check_0 = "!$data.Contains(\"Fail\")"
        $ps_cmd_check_1 = "($data.Contains(\"cmd:\"))"
        $all_result_file_0 = "desktop.dat"
        $all_result_file_1 = "chinotto.dat"
        $pdb_path = "D:\\VSWorkspace\\chinotto\\Release\\Chinotto.pdb"
        $apk_com_0 = "com.private.talk"
        $apk_com_1 = "com.pure.talk"
    condition:
        (filesize < 5MB and (2 of ($all_*)) and (1 of ($ps_*) or (1 of ($apk_*) and uint32(0) == 0xa786564))) or
        ($pdb_path and uint16(0) == 0x5a4d)
}

rule CrowdStrike_CSIT_20239_05 : routergod wicked_panda 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects debug strings found in RouterGod samples used by WICKED PANDA"
        reports = "CSIT-20239"
        version = "202102051109"
        last_modified = "2021-02-05"
        actor = "WICKED PANDA"
        malware_family = "RouterGod"
    strings:
        $debug1 = "route message {0} -> {1}, {2} bytes." wide
        $debug2 = "Decode Mesage ID: {0}" wide
        $debug3 = "internal connect ipc: {0}" wide
        $debug4 = "input message: {0}, [{1} -> {2}]" wide
        $debug5 = "cannot found {0}" wide
        $debug6 = "add connector fail: {0}" wide
        $debug7 = "ERR! handle pipe binder thread exception: {0}" wide
        $debug8 = "ERR! handle pipe connector thread exception: {0}" wide
        $debug9 = "tcp connector silent, not work time" wide
        $debug10 = "try connect remote {0}:{1}" wide
        $debug11 = "tcp connector silent, already control" wide
        $debug12 = "heart beat not update, session lost in {0} seconds" wide
        $debug13 = "connection not response heartbeat message" wide
        $debug14 = "tcp_encrypted" wide
        $debug15 = "[!] http session push {0} packets" wide
        $debug16 = "found cached data, send to pull request" wide
        $debug17 = "tick flush pending request at {0} seconds" wide
        $debug18 = "add firewall with prefix {0}, fail: {1}" wide
        $debug19 = "certfile not exists, use custom cert: {0}" wide
        $debug20 = "add custom cert file fail prefix {0}, errorMessage: {1}" wide
        $debug21 = "process http Request fail: {0}" wide
        $debug22 = "handle http Request fail: {0}" wide
    condition:
        2 of them
}

rule CrowdStrike_CSA_210425_02 : deathkitty ecrime ransomware unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects unpacked DeathKitty ransomware PE files."
        reports = "CSA-210425"
        version = "202105260909"
        last_modified = "2021-05-26"
        malware_family = "DeathKitty"
    strings:
        $str_1 = "HelloKittyMutex" wide
        $str_2 = "ReadWritePoolThread" ascii
        $str_3 = "-path" wide
        $str_4 = "io.sys" wide
        $str_5 = "msdos.sys" wide
        $str_6 = "winnt" wide
        $str_7 = "%s/secret/%S" wide
        $str_8 = ".crypt" wide
        $asm_rdtsc = { 55 8b ec 51 0f 31 89 45 ?? 83 7d ?? 04 }
    condition:
        filesize < 750KB and
        uint16(0) == 0x5a4d and
        5 of them
}

// WARNING: This rule will only work with YARA 3
import "pe"

rule CrowdStrike_CSA_210001_01 : destory loader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects Destory rzLog4cpp loader based on the .dat extension pushed on the stack"
        reports = "CSA-210001"
        version = "202101080942"
        last_modified = "2021-01-08"
        malware_family = "Destory"
    strings:
        $pat1 = { 66 c7 44 ?? e0 2e 00 }
        $pat2 = { 66 c7 44 ?? e0 64 00 }
        $pat3 = { 66 c7 44 ?? e0 61 00 }
        $pat4 = { 66 c7 44 ?? e0 74 00 }
        $pat5 = { 66 c7 44 ?? e0 00 00 }
    condition:
        uint16(0) == 0x5a4d and
        filesize < 1MB and
        pe.number_of_signatures == 0 and
        all of them
}

rule CrowdStrike_CSA_201632_01 : cve_2020_0787 exploit privilege_escalation 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Microsoft Windows privilege escalation tool that uses CVE-2020-0787"
        reports = "CSA-201632"
        version = "202101080942"
        last_modified = "2021-01-08"
    strings:
        $iid_ibackgroundcopyqmgr = { 69 1c f4 16 f5 09 d2 41 8c d8 3c 08 c4 7b c8 a8 }
        $iid_ibackgroundcopyjob = { 37 8d 66 37 7e 50 60 41 93 16 26 30 6d 15 0b 12 }
        $clsid_backgroundcopyqmgr = { ee 4a ad 69 be 51 9b 43 a9 2c 86 ae 49 0e 8b 30 }
        $fsctl_set_reparse_point = { ( 68 | ba ) a4 00 09 00 }
        $fsctl_delete_reparse_point = { ( 68 | ba ) ac 00 09 00 }
    condition:
        all of them
}

// WARNING: This rule will only work with YARA 3
import "pe"

rule CrowdStrike_CSA_210001_02 : destory destoryrat loader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects Destory SmadHook loader based on the .dat extension pushed on the stack"
        reports = "CSA-210001"
        version = "202101080942"
        last_modified = "2021-01-08"
        malware_family = "Destory"
    strings:
        $pat1 = { c6 44 ?? d0 2e }
        $pat2 = { c6 44 ?? d0 64 }
        $pat3 = { c6 44 ?? d0 61 }
        $pat4 = { c6 44 ?? d0 74 }
        $pat5 = { c6 44 ?? d0 00 }
    condition:
        uint16(0) == 0x5a4d and
        filesize < 1MB and
        pe.number_of_signatures == 0 and
        all of them
}

rule CrowdStrike_CSIT_21002_03 : artifact logging stellarparticle sunspot 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects log format lines in SUNSPOT"
        reports = "CSIT-21002"
        version = "202101151845"
        last_modified = "2021-01-15"
        malware_family = "SUNSPOT"
        activity_cluster = "StellarParticle"
    strings:
        $s01 = "[ERROR] ***Step1('%ls','%ls') fails with error %#x***\x0A" ascii
        $s02 = "[ERROR] Step2 fails\x0A" ascii
        $s03 = "[ERROR] Step3 fails\x0A" ascii
        $s04 = "[ERROR] Step4('%ls') fails\x0A" ascii
        $s05 = "[ERROR] Step5('%ls') fails\x0A" ascii
        $s06 = "[ERROR] Step6('%ls') fails\x0A" ascii
        $s07 = "[ERROR] Step7 fails\x0A" ascii
        $s08 = "[ERROR] Step8 fails\x0A" ascii
        $s09 = "[ERROR] Step9('%ls') fails\x0A" ascii
        $s10 = "[ERROR] Step10('%ls','%ls') fails with error %#x\x0A" ascii
        $s11 = "[ERROR] Step11('%ls') fails\x0A" ascii
        $s12 = "[ERROR] Step12('%ls','%ls') fails with error %#x\x0A" ascii
        $s13 = "[ERROR] Step30 fails\x0A" ascii
        $s14 = "[ERROR] Step14 fails with error %#x\x0A" ascii
        $s15 = "[ERROR] Step15 fails\x0A" ascii
        $s16 = "[ERROR] Step16 fails\x0A" ascii
        $s17 = "[%d] Step17 fails with error %#x\x0A" ascii
        $s18 = "[%d] Step18 fails with error %#x\x0A" ascii
        $s19 = "[ERROR] Step19 fails with error %#x\x0A" ascii
        $s20 = "[ERROR] Step20 fails\x0A" ascii
        $s21 = "[ERROR] Step21(%d,%s,%d) fails\x0A" ascii
        $s22 = "[ERROR] Step22 fails with error %#x\x0A" ascii
        $s23 = "[ERROR] Step23 fails with error %#x\x0A" ascii
        $s24 = "[%d] Solution directory: %ls\x0A" ascii
        $s25 = "[%d] %04d-%02d-%02d %02d:%02d:%02d:%03d %ls\x0A" ascii
        $s26 = "[%d] + '%s' " ascii
    condition:
        2 of them and filesize < 10MB
}

rule CrowdStrike_CSIT_21002_02 : artifact stellarparticle sunspot 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects mutex names in SUNSPOT"
        reports = "CSIT-21002"
        version = "202101151843"
        last_modified = "2021-01-15"
        malware_family = "SUNSPOT"
        activity_cluster = "StellarParticle"
    strings:
        $mutex_01 = "{12d61a41-4b74-7610-a4d8-3028d2f56395}" wide ascii
        $mutex_02 = "{56331e4d-76a3-0390-a7ee-567adf5836b7}" wide ascii
    condition:
        any of them and filesize < 10MB
}

rule CrowdStrike_CSIT_21002_01 : artifact stellarparticle sunspot 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects RC4 and AES key encryption material in SUNSPOT"
        reports = "CSIT-21002"
        version = "202101151843"
        last_modified = "2021-01-15"
        malware_family = "SUNSPOT"
        activity_cluster = "StellarParticle"
    strings:
        $key = {fc f3 2a 83 e5 f6 d0 24 a6 bf ce 88 30 c2 48 e7}
        $iv  = {81 8c 85 49 b9 00 06 78 0b e9 63 60 26 64 b2 da}
    condition:
        all of them and filesize < 32MB
}

rule CrowdStrike_CSIT_21073_01 : commodity dropper ecrime isfb unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects multiple versions of ISFB dropper"
        reports = "CSIT-21073"
        version = "202105140948"
        last_modified = "2021-05-14"
        malware_family = "ISFB"
    strings:
        $crc0 = { 8a 2a 04 7a }
        $crc1 = { 0c 4a 15 9e }
        $crc2 = { a7 ce 75 4f }
        $crc3 = { d4 2f 80 30 }
        $crc4 = { 1f 2e 98 41 }
        $crc5 = { b4 aa f8 90 }
        $aplib1 = { c7 41 0c 07 00 00 00 8b 51 08 8b c2 c1 e8 07 03 d2 83 e0 01 }
        $aplib2 = { 8d 58 07 8b c2 c1 e8 07 83 e0 01 03 d2 }
        $aplib3 = { 8b c? 23 c? 40 40 d1 e? 7? 1? }
        $aplib4 = { 81 fe 00 7d 00 00 72 0? [1-3] 81 fe 00 05 00 00 72 0? [1-3] 81 fe 80 00 00 00 73 0? }
        $aplib5 = { 81 fe ff 04 00 00 76 01 40 81 fe ff 7c 00 00 76 01 40 83 fe 7f 77 02 40 40 }
    condition:
        any of ($crc*) and 2 of ($aplib*)
}

rule CrowdStrike_Hydra_WordPress_Scanner : ecrime hydra scanner 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects Hydra WordPress scanner ELF binary "
        reports = "CSA-210021"
        version = "202101151841"
        last_modified = "2021-01-15"
        malware_family = "Hydra"
    strings:
        $s1 = "<methodName>wp.getUsersBlogs</methodName>"
        $s2 = "Laucnhed procces"
    condition:
        uint32(0) == 0x464c457f and all of ($s*)
}

rule CrowdStrike_CSIT_21073_02 : ecrime isfb unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects ISFB v2.50 samples, both the client and downloader variants"
        reports = "CSIT-21073"
        version = "202105140948"
        last_modified = "2021-05-14"
        malware_family = "ISFB"
    strings:
        $crc1 = { 64 5e 28 e1 }
        $crc2 = { e1 dd b1 8f }
        $crc3 = { cb af 22 d7 }
        $aplib1 = { c7 41 0c 07 00 00 00 8b 51 08 8b c2 c1 e8 07 03 d2 83 e0 01 }
        $aplib2 = { 8d 58 07 8b c2 c1 e8 07 83 e0 01 03 d2 }
        $aplib3 = { 8b c? 23 c? 40 40 d1 e? 7? 1? }
        $aplib4 = { 81 fe 00 7d 00 00 72 0? [1-3] 81 fe 00 05 00 00 72 0? [1-3] 81 fe 80 00 00 00 73 0? }
        $aplib5 = { 81 fe ff 04 00 00 76 01 40 81 fe ff 7c 00 00 76 01 40 83 fe 7f 77 02 40 40 }
        // code that constructs Serpent key to decrypt the RSA key
        $serp1 = { 85 c9 75 0d 6a 10 e8 [4] 8b c8 85 c9 74 1f }
        $serp2 = { 8d 41 04 e8 [4] 8d 41 0c e8 [4] 8b c1 e8 [4] 8d 41 08 e8 [4] 8b c1 c3 }
    condition:
        2 of ($crc*) and 2 of ($aplib*) and 1 of ($serp*)
}

rule CrowdStrike_CSA_210065_01 : android appcheck backdoor velvet_chollima 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects config strings and class names used in an Android backdoor used by VELVET CHOLLIMA"
        reports = "CSA-210065"
        version = "202102101644"
        last_modified = "2021-02-10"
        actor = "VELVET CHOLLIMA"
        malware_family = "appcheck"
    strings:
        $dex = { 64 65 (78 | 79) 0A ?? ?? ?? 00 }
        $a1 = "up.php"
        $a2 = "files"
        $a3 = "server_first.txt"
        $a4 = "server_second.txt"
        $c1 = "init.txt"
        $c2 = "account.txt"
        $c3 = "app.txt"
        $c4 = "clipboard.txt"
        $c5 = "contact.txt"
        $c6 = "hook.txt"
        $c7 = "keylog.txt"
        $c8 = "phonecall.txt"
        $c9 = "sdcard.txt"
        $ca = "sms_all.txt"
        $cb = "sms_new.txt"
        $cc = "sms.txt"
        $cd = "start.txt"
        $ce = "time.txt"
        $cf = "user.txt"
        $n1 = "AppKeyloggerService"
        $n2 = "AppProtectReceive"
        $n3 = "AppProtectService"
        $n4 = "DeviceAdministratorReceive"
    condition:
        $dex at 0 and
        ((9 of ($c*)) or all of ($a*) or all of ($n*))
}

rule CrowdStrike_CSIR_21004_02 : ssp_loader tracer_kitten 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects usage and error strings with a custom helper executable used by TRACER KITTEN to load an SSP DLL"
        reports = "CSIR-21004"
        version = "202102171810"
        last_modified = "2021-02-17"
        actor = "TRACER KITTEN"
    strings:
        $ = "[!] Error %x" wide ascii
        $ = "[*] Error 0x6c6" wide ascii
        $ = "Usage: %s DLL_FULL_PATH" wide ascii
        $ = "lsasspirpc" wide ascii
        $ = "ncalrpc" wide ascii
    condition:
        uint16(0) == 0x5a4d and all of them
}

rule CrowdStrike_CSA_210054_01 : helix_kitten idlerat rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects HELIX KITTEN IdleRAT based on characteristic paths and error messages"
        reports = "CSA-210054"
        version = "202101291826"
        last_modified = "2021-01-29"
        actor = "HELIX KITTEN"
        malware_family = "IdleRAT"
    strings:
        $ = "Please install visual studio 2017 and try again" ascii wide
        $ = "..\\update.xml" ascii wide
        $ = ".\\start.exe" ascii wide
        $ = "error_%s|Error: %d" ascii wide
        $ = "text/*" ascii wide
        $ = "/search/%s" ascii wide
    condition:
        uint16(0) == 0x5A4D and
        uint32(uint32(0x3C)) == 0x00004550 and
        3 of them
}

rule CrowdStrike_CSA_210107_01 : astaroth culebra_variant downloader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects samples of the LNK downloader for Astaroth and a Culebra variant"
        reports = "CSA-210107"
        version = "202101291620"
        last_modified = "2021-01-29"
        malware_family = "Astaroth, Culebra variant"
    strings:
        $ = "/c \"finger.exe" wide ascii
        $ = "|more +2|cmd" wide ascii
    condition:
        uint16(0) == 0x004C and
        all of them and
        filesize < 2KB
}

rule CrowdStrike_CSA_210171_01 : delphi infostealer stealer 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects strings from MyThreadStealer"
        version = "202102121739"
        last_modified = "2021-02-12"
    strings:
        $ = {508BC65A8BCA99F7F9428B45F88A4410FF32C38BD8}
        $ = "***$$***"
        $ = "firefox.exe"
        $ = "iexplore.exe"
    condition:
        all of them
}

rule CrowdStrike_CSIR_21004_01 : rat rgdoor tracer_kitten 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects strings and .NET GUID found within TRACER KITTEN RGDoor admin interface"
        reports = "CSIR-21004"
        version = "202102171810"
        last_modified = "2021-02-17"
        actor = "TRACER KITTEN"
        malware_family = "RGDoor"
    strings:
        $forwarder_1 = "/a=s?v1=" wide ascii
        $forwarder_2 = "/a=r?v1=" wide ascii
        $forwarder_3 = "/a=f?v1=" wide ascii
        $forwarder_4 = "targetURL>" wide ascii
        $forwarder_5 = "targetIP>" wide ascii
        $forwarder_6 = "localPortNumber>" wide ascii
        $forwarder_7 = "RemotePortNumber>" wide ascii
        $backdoor_1 = "a=r&c=" wide ascii
        $backdoor_2 = "a=u&c=" wide ascii
        $backdoor_3 = "a=d&k=" wide ascii
        $backdoor_4 = "targetName>" wide ascii
        $backdoor_5 = "generatekeys" wide ascii
        $backdoor_6 = "listtarget" wide ascii
        $backdoor_7 = "clearhistory" wide ascii
        $guid = "c58dd94e-778b-41f9-93d7-7148c8f8efb7" ascii
    condition:
        uint16(0) == 0x5a4d and ( all of ($forwarder_*) or all of ($backdoor_*) or $guid )
}

rule CrowdStrike_CSIT_21035_02 : cryptbot infostealer unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects strings in unpacked samples of CryptBot stealer"
        reports = "CSIT-21035"
        version = "202102261717"
        last_modified = "2021-02-26"
        malware_family = "CryptBot"
    strings:
        $ = "\\_Files\\_Wallet" fullword wide
        $ = "\\files_\\cryptocurrency" fullword wide
        $ = "\\_Files\\_Screen_Desktop.jpeg" fullword wide
        $ = "_AllPasswords_list.txt" fullword wide
        $ = "Soft: Brave New" fullword
        $ = "Soft: Mozilla Firefox" fullword
        $ = "Content-Disposition: form-data; name=\"file\"; filename=\"%wS\""
        $ = "UserName (ComputerName): %wS" fullword wide
        $ = "GPU:                     %wS" fullword wide
        $ = "[Installed software]" fullword wide
    condition:
        filesize < 5MB and 8 of them
}

rule CrowdStrike_CSIT_21035_03 : cryptbot infostealer unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects strings in unpacked samples of the cryptocurrency file stealer component of CryptBot"
        reports = "CSIT-21035"
        version = "202102261717"
        last_modified = "2021-02-26"
        malware_family = "CryptBot"
    strings:
        $gen1 = "%USERPROFILE%\\Desktop\\report.doc" fullword wide
        $gen2 = "%USERPROFILE%\\Desktop\\secret.txt" fullword wide
        $gen3 = "Computername: %wS" fullword wide
        $gen4 = "%Y_%m_%d___%H_%M" fullword
        $gen5 = "N0t_Country___" fullword
        $target1 = "*bitcoin*.txt" fullword wide
        $target2 = "*electrum*.txt" fullword wide
        $target3 = "*wallet*.dat" fullword wide
        $target4 = "*ledger*.txt" fullword wide
        $target5 = "*trezor*.txt" fullword wide
        $target6 = "*jaxx*.txt" fullword wide
    condition:
        filesize < 5MB and 4 of ($gen*) and 4 of ($target*)
}

rule CrowdStrike_CSA_210112_02 : dropper labyrinth_chollima stackeyflate stackeyflate_dropper stackeyflatedropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects RC4 and HC-256 decryption of configuration data, Zlib parameters, and imports used by Stackeyflate droppers"
        reports = "CSA-210112,CSIT-21058"
        version = "202103231650"
        last_modified = "2021-03-23"
        actor = "LABYRINTH CHOLLIMA"
        malware_family = "StackeyflateDropper"
    strings:
        $sequence_stack_16_bytes_rc4 = { c7 45 ?? ?? ?? ?? ?? c7 45 ?? ?? ?? ?? ?? c7 45 ?? ?? ?? ?? ?? c7 45 ?? ?? ?? ?? ?? [1-15] 88 01 ff c0 4? [1-3] 3d 00 01 00 00 7? }
        $sequence_cipher_hc_256 = {81 e? ff 03 00 00 [0-1] 81 e? ff 03 00 00 [0-1] 81 e? ff 03 00 00 [0-1] 81 e? ff 03 00 00 [0-8] 00 04 00 00 }
        $sequence_parameters_lea_call = { e8 [4] 48 8d [5] e8 [4] 48 8d [5] e8 [4] 48 8d [5] e8 [4] 48 8d [5] e8 [4] 48 8d [5] e8 [4] 48 8d [5-7] ff 15}
        $sequence_zlib_params = { 0c ab 00 00 01 00 00 00 ?? ?? ?? 00 2b 00 00 01 00 00 00 ?? ?? 08 2b 00 00 }
        $import_create_directory = "CreateDirectory"
        $import_create_file = "CreateFile"
        $import_create_process = "CreateProcess"
        $import_reg_open = "RegOpenKey"
        $import_reg_set = "RegSetValue"
        $import_write_file = "WriteFile"
    condition:
        uint16(0) == 0x5a4d and 3 of ($sequence_*) and 3 of ($import_*) and filesize < 2MB
}

rule CrowdStrike_CSA_210112_01 : labyrinth_chollima loader stackeyflate 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects RC4 and HC-256 decryption, Zlib parameters, and imports used to load payloads in-memory by Stackeyflate loaders"
        reports = "CSA-210112"
        version = "202102051746"
        last_modified = "2021-02-05"
        actor = "LABYRINTH CHOLLIMA"
        malware_family = "Stackeyflate"
    strings:
        // RC4 init loop
        $sequence_inline_rc4_init = { 88 01 ff c0 4? [1-3] 3d 00 01 00 00 7? }
        $sequence_cipher_hc_256 = {81 e? ff 03 00 00 [0-1] 81 e? ff 03 00 00 [0-1] 81 e? ff 03 00 00 [0-1] 81 e? ff 03 00 00 [0-8] 00 04 00 00 }
        // zlib parameters sequence
        $sequence_zlib_params = { 0c ab 00 00 01 00 00 00 ?? ?? ?? 00 2b 00 00 01 00 00 00 ?? ?? 08 2b 00 00 }
        // loader check for MZ, PE
        $check_for_MZ_jmp = { 4d 5a 00 00 [1-16] 7?}
        $check_for_PE_jmp = { 50 45 00 00 7? }
        // crucial imports
        $import_create_mutex = "CreateMutex"
        $import_virtual_alloc = "VirtualAlloc"
        $import_free_library = "FreeLibraryAndExitThread"
        $import_service_register = "RegisterServiceCtrlHandler"
        $import_service_status = "SetServiceStatus"
    condition:
        uint16(0) == 0x5a4d and (2 of ($sequence_*) and 2 of ($check_*) and 3 of ($import_*))
}

rule CrowdStrike_ZeroLogon_Python_Exploit : cve_2020_1472 exploit python zerologon 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects Python Implementation of ZeroLogon Exploit"
        version = "202102101433"
        last_modified = "2021-02-10"
    strings:
        $comm_channel_type_part1="NETLOGON_SECURE_CHANNEL_TYPE" // this channel is unauthenticated and thus suitable
        $comm_channel_type_part2="ServerSecureChannel"
        $request_type= /nrpc\s{0,4}.\s{0,4}hNetrServerReqChallenge/ // this request type is used to send the challenge to the Domain Controller
        $authentication_request= /nrpc\s{0,4}.\s{0,4}hNetrServerAuthenticate3/ // api used for authentication
        $authentication_request2= /nrpc\s{0,4}.\s{0,4}hNetrServerAuthenticate2/ // api used for authentication
        $payload1= /b\"\\x00\"\s{0,4}\*\s{0,4}[8|7]/ // this produces a payload consisting of 7 or 8 zero bytes (the last byte can have another value as it is only used for xoring)
        $payload2= /b'\\x00'\s{0,4}\*\s{0,4}[8|7]/
        $payload3= "b'\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00'"
        $payload4= "b\"\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\""
    condition:
        filesize < 50KB and $comm_channel_type_part1 and $comm_channel_type_part2 and $request_type and 1 of ($authentication_request*) and 1 of ($payload*)
}

rule CrowdStrike_CSIT_21035_01 : beamdownloader downloader ecrime unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects strings associated with Beam Downloader"
        reports = "CSIT-21035"
        version = "202102261718"
        last_modified = "2021-02-26"
        malware_family = "BeamDownloader"
    strings:
        $ = "/stats/itsru.php" fullword
        $ = "/do.php" fullword
        $ = ".php?pub="
        $ = "KILLME" fullword
        $ = "lnk:" fullword
        $ = "Quick installation of useful programs" fullword
    condition:
        filesize < 5MB and 4 of them
}

rule CrowdStrike_CSIT_21056_01 : danabot ecrime scully_spider unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects unpacked samples of DanaBot V4"
        reports = "CSA-210124,CSIT-21056"
        version = "202104061508"
        last_modified = "2021-04-06"
        actor = "SCULLY SPIDER"
        malware_family = "Danabot"
    strings:
        $bot_version = { c7 43 1c ?? ?? ?? ?? }
        $timeout = { c7 43 18 40 7e 05 00 }
        $ports = { c7 43 6e ?? ?? 00 00 c7 43 76 ?? ?? 00 00 c7 43 7e ?? ?? 00 00 }
    condition:
        uint16(0) == 0x5a4d and
        filesize < 7MB and
        all of them
}

rule CrowdStrike_Cyber1stCmd_Webshell_01 : cyber1stcmd webshell 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects the Cyber1stCmd ASP web shell"
        version = "202102051108"
        last_modified = "2021-02-05"
        malware_family = "Cyber1stCmd"
    strings:
        $ = "FillGV"
        $ = "1sT-Cmd"
        $ = "mailto:cyb3r-1st"
        $ = "Cyb3r-1sT"
        $ = "private void IUD"
        $ = { d8 a2 c2 a9 }
        $ = "SqlConnection con = new SqlConnection(conS);"
    condition:
        3 of them
}

rule CrowdStrike_CSA_210133_01 : artifact backdoor eventhorizon orionweb 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects obfuscation loops in the credentials dumping stub of a backdoored OrionWeb dll dubbed EventHorizon"
        reports = "CSA-210133"
        version = "202102051108"
        last_modified = "2021-02-05"
        malware_family = "EventHorizon"
    strings:
        $p1 = {07 11 04 02 11 04 6f ?? ?? ?? ?? 61 (1f d4|20 d4 00 00 00) 61 (1f 78|20 78 00 00 00) 58 8c ?? ?? ?? ?? 28 ?? ?? ?? ?? 0b 11 04 17 58 13 04}
        $p2 = {08 11 05 03 11 05 6f ?? ?? ?? ?? 61 (1f 4d|20 4d 00 00 00) 61 (1f 78|20 78 00 00 00) 58 8c ?? ?? ?? ?? 28 ?? ?? ?? ?? 0c 11 05 17 58 13 05}
    condition:
        uint16(0) == 0x5a4d and uint16(uint32(0x3c)) == 0x4550 and
        filesize < 10MB and
        all of them and
        @p2 < (@p1 + 0x80)
}

rule CrowdStrike_CSA_210133_02 : artifact backdoor eventhorizon orionweb 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects hardcoded strings in the EventHorizon OrionWeb.dll backdoor"
        reports = "CSA-210133"
        version = "202102051108"
        last_modified = "2021-02-05"
        malware_family = "EventHorizon"
    strings:
        $s1 = "Delete from  AuditingEvents where AuditEventMessage = 'User " wide
        $s2 = " logged in from " wide
        $s3 = " logged out from " wide
        $s4 = "Delete from  AuditingEvents where AccountID = '_system' " wide
        $r1 = "8CD1DB_" ascii wide
        $r2 = "_0F90D2" ascii wide
    condition:
        uint16(0) == 0x5a4d and uint16(uint32(0x3c)) == 0x4550 and
        filesize < 20MB and
        all of ($s*) or all of ($r*)
}

rule CrowdStrike_MapleMercy_Downloader_01 : downloader maplemercy 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects the MapleMercy HTA-based downloader"
        version = "202102051108"
        last_modified = "2021-02-05"
        malware_family = "MapleMercy"
    strings:
        $b64_1 = "var A=\"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\";"
        $b64_2 = ";b=(b<<6)+c;l+=6;while(l>=8){((a=(b>>>(l-=8))&0xff)||(x<(L-2)))&&(a48PcM+=w(a));}}return"
        $eval_1 = ".Timeout = 60000;"
        $eval_2 = ".AddCode("
        $eval_3 = "msscriptcontrol.scriptcontrol"
        $hta_1 = "</script><script language=\"vbscript\">"
        $hta_2 = "<script language=\"javascript\">"
        $rev = ".split(\"\").reverse().join(\"\");}"
        $window_1 = ".moveTo(-100, -100);"
        $window_2 = ".resizeTo(1, 1);"
    condition:
        6 of them and
        filesize < 40KB
}

rule CrowdStrike_CSA_210134_01 : emissary_panda sysupdate 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects distinctive code from SysUpdate loader DLL files as described in CSA-210134"
        reports = "CSA-210134"
        version = "202102051108"
        last_modified = "2021-02-05"
        actor = "EMISSARY PANDA"
        malware_family = "SysUpdate"
    strings:
        $loop_variant1 = { 6b c9 07 6a 0b 5f 83 c1 05 8b c1 99 f7 ff }
        $loop_variant2 = { 6b c9 07 83 c1 05 8b c1 6a 0b 99 5f f7 ff }
        $loop_variant3 = { c1 f8 02 6b c0 05 40 47 83 ff 05 }
    condition:
        filesize < 1MB and
        any of them
}

rule CrowdStrike_CSA_210133_03 : artifact backdoor eventhorizon orionweb 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects a GUID file name found in an backdoored OrionWeb sample"
        reports = "CSA-210133"
        version = "202102051108"
        last_modified = "2021-02-05"
        malware_family = "EventHorizon"
    strings:
        $guid = "31F75042-1324-47AD-A387-8CD1DB0F90D1" ascii wide nocase
    condition:
        all of them and
        filesize < 10MB
}

rule CrowdStrike_CSIT_21035_04 : clipper cryptbot infostealer unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects strings in unpacked samples of the cryptocurrency clipboard address changer component of CryptBot"
        reports = "CSIT-21035"
        version = "202102261720"
        last_modified = "2021-02-26"
        malware_family = "CryptBot"
    strings:
        $ = "SmartClock.exe" wide fullword
        $ = "Smart Clock" wide fullword
        $ = "{48D87B02-03F7-4188-8BE8-7733FF2CBCA6}" wide fullword
        $ = "CURSOR" wide fullword
        $ = {6c 1a 7a 3d 3a 0d d8 0f 04 89 a6 29 a7 06 37 f4}
    condition:
        filesize < 5MB and all of them
}

rule CrowdStrike_CSIT_21024_01 : cuba cubaransomware ransomware unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects unpacked variants of Cuba Ransomware"
        reports = "CSIT-21024"
        version = "202102051109"
        last_modified = "2021-02-05"
        malware_family = "CubaRansomware"
    strings:
        $note_1 = "* Do not rename encrypted files."
        $note_2 = "* Do not try to decrypt your data using third party software,"
        $note_3 = "it may cause permanent data loss"
        $cuba_1 = "FIDEL.CA"
        $cuba_2 = ".cuba" wide
    condition:
        all of ($note_*) and all of ($cuba_*)
}

rule CrowdStrike_CSIT_21066_01 : loader xstart 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects xStart DLL delivered via SFX"
        reports = "CSIT-21066"
        version = "202104160927"
        last_modified = "2021-04-16"
        malware_family = "xStart"
    strings:
        $str1 = "rundll32.exe" wide
        $str2 = "StrStrIW"
        $str3 = "FMain"
        $str4 = "lpszPassWord"
        $str5 = "CryptDecrypt"
        $str6 = "LoadResource"
        $str7 = "FindResourceW"
        $str8 = "SeDebugPrivilege"
        //signals end of AES key
        $str9 = { 00 00 00 2e 00 64 00 6f 00 63 00 }
        //offset to name of MP4 rsrc
        $str10 = { 4d 00 50 00 34 00 00 00 }
        //offset to name of MPZ rsrc
        $str11 = { 4d 00 4b 00 56 00 00 00 }
        $exe1 = "WINWORD.exe" wide
        $exe2 = "explorer.exe" wide
    condition:
        uint16(0) == 0x5a4d and
        all of ($str*) and
        1 of ($exe*)
}

rule CrowdStrike_CSA_210151_01 : artifact cerasinops primitive_bear 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects Cerasinops function names"
        reports = "CSA-210151"
        version = "202102121736"
        last_modified = "2021-02-12"
        actor = "PRIMITIVE BEAR"
        malware_family = "Cerasinops"
    strings:
        $dotnet = "BSJB" ascii
        $f1 = "desktopOK" fullword ascii
        $f2 = "url_string" fullword ascii
        $f3 = "serial_number" fullword ascii
        $f4 = "testSite" fullword ascii
        $f5 = "replace_id" fullword ascii
        $f6 = "load_string" fullword ascii
    condition:
        uint16(0) == 0x5a4d and uint16(uint32(0x3c)) == 0x4550 and
        all of them
}

rule CrowdStrike_CSA_210153_01 : artifact mosaicdecoy primitive_bear 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Strings found in the Mosaic decoy used in Vulcanops samples"
        reports = "CSA-210153"
        version = "202102121735"
        last_modified = "2021-02-12"
        actor = "PRIMITIVE BEAR"
        malware_family = "MosaicDecoy"
    strings:
        $dotnet = "BSJB" ascii
        $guid = "2d971593-f1d4-444f-8482-d5a059c3fc1c" ascii
        $u1 = "CheckUSBValid" fullword ascii
        $u2 = "USBSerialNumber" fullword ascii
        $u3 = "matchDriveLetterWithSerial" fullword ascii
        $u4 = "getSerialNumberFromDriveLetter" fullword ascii
        $e1 = "Form_Work_KeyDown" fullword ascii
        $e2 = "buttonDecrypt_Click" fullword  ascii
        $e3 = "NoiseFile" fullword ascii
        $e4 = "matchDriveLetterWithSerial" fullword  ascii
        $e5 = "EncryptFileKey" fullword ascii
        $e6 = "ReadKeyXORFile" fullword ascii
        $e7 = "CryptoRND" fullword ascii
    condition:
        $dotnet and uint16(0) == 0x5a4d and uint16(uint32(0x3c)) == 0x4550 and $guid or ((2 of ($u*)) and (3 of ($e*)))
}

rule CrowdStrike_CSA_210202_01 : android xloader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Encrypted XLoader APK payloads using a single-byte XOR in combination with zlib compression"
        reports = "CSA-210202"
        version = "202102261716"
        last_modified = "2021-02-26"
        malware_family = "XLoader"
    condition:
        filesize > 50KB and filesize < 500KB
        and uint8(11) ^ uint8(12) == 0x78
        and uint8(11) ^ uint8(13) == 0x01
        and uint8(11) ^ uint8(14) == 0x4c
}

rule CrowdStrike_CSA_210169_01 : cve_2021_1732 exploit hunting privilege_escalation 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Broader hunting rule to detect CVE-2021-1732 based privilege escalation on Microsoft Windows"
        reports = "CSA-210169"
        version = "202102121743"
        last_modified = "2021-02-12"
    strings:
        $ = "normalClass" ascii wide
        $ = "magicClass" ascii wide
        $ = "NtUserConsoleControl" ascii wide
        $ = "NtCallbackReturn" ascii wide
        $ = "CreateWindowEx" ascii wide
        $ = "SetWindowLongPtr" ascii wide
    condition:
        all of them
}

// WARNING: This rule will only work with YARA 3
import "pe"

rule CrowdStrike_CSIT_21071_03 : loader shadowpad 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects ShadowPad loader based on patterns used in the obfuscator and of characteristics from the PE"
        reports = "CSIT-21071"
        version = "202104301009"
        last_modified = "2021-04-30"
        malware_family = "ShadowPad"
    strings:
        $pat1 = { 48 87 04 24 }
        $pat2 = { 48 87 04 24 0f 8? ?? ?? ?? ff }
        $pat3 = { 48 83 ec 28 33 c9 ff 15 ?? ?? ?? 00 81 b8 }
    condition:
        uint32(0x7c) == 0 and
        pe.number_of_signatures == 0 and
        pe.characteristics & pe.LARGE_ADDRESS_AWARE and
        pe.subsystem == pe.SUBSYSTEM_WINDOWS_GUI and
        #pat1 > 1 and
        $pat2 and
        $pat3 and
        filesize < 5MB
}

// WARNING: This rule will only work with YARA 3
import "pe"

rule CrowdStrike_CSIT_21071_02 : loader shadowpad 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects ShadowPad loader based on encryption algorithm and characteristics of the PE"
        reports = "CSIT-21071"
        version = "202104301009"
        last_modified = "2021-04-30"
        malware_family = "ShadowPad"
    strings:
        $pat1 = { 6b ?? 11 }
        $pat2 = { 4? ?? c? }
        $pat3 = { 81 e? 9f 5d 33 53 }
        $pat4 = { c1 e? 18 }
        $pat5 = { c1 e? 10 }
        $pat6 = { c1 e? 08 }
    condition:
        uint32(0x7c) == 0 and
        pe.number_of_signatures == 0 and
        pe.characteristics & pe.LARGE_ADDRESS_AWARE and
        pe.subsystem == pe.SUBSYSTEM_WINDOWS_GUI and
        all of them and
        filesize < 5MB
}

rule CrowdStrike_CSA_210169_02 : cve_2021_1732 exploit hunting privilege_escalation 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Hunting rule to detect CVE-2021-1732 based on arbitrary read instructions"
        reports = "CSA-210169"
        version = "202102121743"
        last_modified = "2021-02-12"
    strings:
        $ = { 48 63 05 CC 69 05 00 8B 0D C2 69 05 00 }
    condition:
        all of them
}

rule CrowdStrike_CSIT_21058_03 : hoplight httphoplight labyrinth_chollima rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects the custom obfuscation routine, RC4 encryption key, and C2 HTTP strings for an updated variant of HOPLIGHT"
        reports = "CSIT-21058,CSIT-21090"
        version = "202104301009"
        last_modified = "2021-04-30"
        actor = "LABYRINTH CHOLLIMA"
        malware_family = "HttpHoplight"
    strings:
        $key1 = { b6 b7 2d 8c }
        $key2 = { 6b 5f 14 df }
        $key3 = { b1 38 a1 73 }
        $key4 = { 89 c1 d2 c4 }
        $obf1 = { ef cd ab 90 }
        $obf2 = { 78 56 b4 c2 }
        $obf3 = { 55 84 26 fe }
        $http = "Content-Type: application/x-www-form-urlencoded" wide
    condition:
        all of them
}

rule CrowdStrike_CSA_210152_01 : shellstarter wizard_spider 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detect function and PDB names found in WIZARD SPIDER's ShellStarter "
        reports = "CSA-210152"
        version = "202102121750"
        last_modified = "2021-02-12"
        malware_family = "ShellStarter"
    strings:
        $str1 = "entryPoint"
        $str2 = "DllRegisterServer"
        $str3 = "Control_RunDLL"
        $str4 = "SeDebugPrivilege"
        $c1 = {B9 88 13 00 00 FF}
        $c2 = {0D 01 01 01 01}
        $p1 = "shellStarter_llvm_x64.pdb"
        $p2 = "shellStarter_llvm_x64.dll"
    condition:
        uint16(0) == 0x5a4d and (filesize > 50KB and filesize < 250KB) and (all of ($str*)) and (1 of ($c*)) or (any of ($p*))
}

rule CrowdStrike_CSIT_21020_01 : loader mallard_spider qakbot 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detect Qakbot malware"
        reports = "CSIT-21020,CSIT-21052"
        version = "202104090916"
        last_modified = "2021-04-09"
        actor = "MALLARD SPIDER"
        malware_family = "Qakbot"
    strings:
        $string1 = "sadccdcdsasa"
        $string2 = "cdcdwqwqwq"
        $export_dll_name = "stager_1.dll" ascii fullword
        $exported_dll_function = "DllRegisterServer" ascii fullword
        $process_name_x86 = { b9 96 08 00 00 ba c0 02 00 00 }
        $process_name_x64 = { b9 ef 02 00 00 ba 8a 07 00 00 be ad 04 00 00 }
    condition:
        uint16(0) == 0x5a4d and
        $exported_dll_function and
        (($string1 and $string2) or $export_dll_name or ($process_name_x86 and $process_name_x64)) and
        filesize < 300KB
}

rule CrowdStrike_CSA_210217_01 : nebulae override_panda 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects distinctive code and constants in Nebulae malware samples"
        reports = "CSA-210217"
        version = "202102261719"
        last_modified = "2021-02-26"
        actor = "OVERRIDE PANDA"
        malware_family = "Nebulae"
    strings:
        $cmd_val = { 83 e8 39 74 }
        $push_const1 = { 68 ce 00 00 00 }
        $set_const1 = { c7 45 f0 01 00 01 00 }
        $set_const2 = { cc 1d c7 05 }
        $decoder1 = { 8a 4d ea 2a 45 db 02 c9 2a 45 b7 32 45 e5 f6 6d e9 }
        $decoder2 = { 8d ?? 01 [0-2] 8a 0? 4? 84 C? 75 f9 [0-2] 0f 57 c0 [0-2] (33|2B) }
    condition:
        filesize<3MB and uint16(0)==0x5a4d and 4 of them
}

rule CrowdStrike_CSA_210186_01 : jeus labyrinth_chollima 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects strings found in the October 2020 Ants2Whale variant of Jeus"
        reports = "CSA-210186"
        version = "202102191057"
        last_modified = "2021-02-19"
        actor = "LABYRINTH CHOLLIMA"
        malware_family = "Jeus"
    strings:
        $time = "auth_timestamp"
        $signature = "auth_signature"
        $shell = "/bin/sh -c %s"
        $path = "/var/tmp/fiexpl"
        $id = "vG2eZ1KOeGd2n5fr"
    condition:
        3 of them
}

rule CrowdStrike_CSA_210196_01 : ecrime rat sombra 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Identifies an obfuscated batch file (stage 1) used to base64-decode a loader script for Sombra RAT."
        reports = "CSA-210196"
        version = "202103121846"
        last_modified = "2021-03-12"
        malware_family = "Sombra"
    strings:
        $echo_off = "@echo off" ascii
        $set_str = /[sS]et [a-zA-Z]{2,3}=\w{62,64}/
        $substr = /%[a-zA-Z]{2,3}:~\d+,\d+%/
        $cond_open = "% (" ascii
        $cond_close = ") %" ascii
    condition:
        filesize > 2500 and
        filesize < 4000 and
        $echo_off at 0 and
        $set_str in (10..85) and
        #cond_open == 2 and #cond_close == 1 and
        #substr > 250 and #substr < 400
}

rule CrowdStrike_CSA_210192_01 : artifact cathoderaider trialogger zekadero 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects a unique User-Agent in TriaLogger"
        reports = "CSA-210192,CSIT-21094"
        version = "202106030950"
        last_modified = "2021-06-03"
        actor = "CathodeRaider"
        malware_family = "TriaLogger"
    strings:
        $ua1 = "\x00Windows NT 6.1; WOW64;\x00" ascii
    condition:
        any of them
}

rule CrowdStrike_CSA_210227_01 : rat razor_tiger wrat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects WRAT used by RAZOR TIGER"
        reports = "CSA-210227"
        version = "202103051036"
        last_modified = "2021-03-05"
        actor = "RAZOR TIGER"
        malware_family = "WRAT"
    strings:
        $b641 = "80,97,107"
        $b642 = "80,65,75"
        $inet1 = "InternetCheckConnectionA"
        $inet2 = "WSASocketW"
        $str4 = "GCTL"
        $str5 = "AreFileApisANSI"
        $str6 = "FindNextFileW"
        $str7 = "api-ms-win-security-systemfunctions-l1-1-0" wide
    condition:
        uint16(0) == 0x5a4d and
        1 of ($b64*) and
        1 of ($inet*) and
        all of ($str*) and
        filesize < 500KB
}

rule CrowdStrike_CSA_210196_04 : ecrime rat sombra 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Identifies decoded/unpacked PE files of Sombra RAT (32-bit or 64-bit)."
        reports = "CSA-210196"
        version = "202103121847"
        last_modified = "2021-03-12"
        malware_family = "Sombra"
    strings:
        // RTTI in early samples (pre-2020)
        $str_cls1 = "IOCPProcessor" ascii
        $str_cls2 = "PacketsWorker" ascii
        $str_cls3 = "SchannelWorker" ascii
        $str_cls4 = "PeLoaderBaseClass" ascii
        $str_cls5 = "PeLoaderDummy" ascii
        $str_cls6 = "PeLoaderLocal" ascii
        $str_cls7 = "NetworkDriverBaseClass" ascii
        $str_cls8 = "NetworkDriverLayer" ascii
        $str_cls9 = "PDCore" ascii
        $str_cls10 = "PDDataContainer" ascii
        $str_cls11 = "PDMessage" ascii
        $str_cls12 = "PDModule" ascii
        $str_cls13 = "PDNetwork" ascii
        $str_cls14 = "PDOverlappedPipe" ascii
        $str_cls15 = "PDStorage" ascii
        $str_cls16 = "PDTaskman" ascii
        $str_cls17 = "ProxyBaseClass" ascii
        $str_cls18 = "ProxyHandler" ascii
        $str_cls19 = "ProxySocks5Handler" ascii
        // Later samples (2020+)
        $str_auth1 = "proxy-authenticate" ascii
        $str_auth2 = "digest" ascii
        $str_auth3 = "basic" ascii
        $str_auth4 = "ntlm" ascii
        $str_auth5 = "socks5" ascii
        $str_cmd1 = "CLNT" ascii
        $str_cmd2 = "SRVR" ascii
        $str_cmd3 = "PING" ascii
        $str_fmt1 = "%s.%s" ascii
        $str_fmt2 = "%x.%s" ascii
        $str_fmt3 = "%d.%d.%d.%d" ascii
        $str_fmt4 = "%02X::%02X::%02X::%02X" ascii
        $str_misc1 = "NTLM" wide
        $str_misc2 = "\\pipe\\" wide
        $str_misc3 = "services.exe" wide
        $asm32_lng = { 69 ?? 05 84 08 08 33 D2 BB FF 00 00 00 6A 0E 41 8B C1 F7 ?? 69 ?? 05 84 08 08 }
        $asm32_svc = { 83 e8 01 74 ?? 83 e8 04 75 ?? 6a 03 59 e8 [4] 68 e8 03 00 00 ff 15 [4] 33 c9 41 e8 }
        $asm64_lng = { 69 cb 05 84 08 08 ff c1 b8 81 80 80 80 f7 e1 }
        $asm64_enc = { 66 41 c1 e0 08 66 41 c1 ea 08 66 45 0b c2 c0 ea 04 0f b6 c2 66 44 33 c0 44 0f b7 d1 66 41 c1 e2 03 66 45 33 d0 }
    condition:
        filesize > 200KB and
        filesize < 1MB and
        uint16(0) == 0x5a4d and
        (12 of ($str_*) or 2 of ($asm32_*) or 2 of ($asm64_*))
}

rule CrowdStrike_CSIT_21058_04 : hotplugin labyrinth_chollima rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects strings found in a RAT associated with OpenSSL Downloader that contains the class name HotPlugin"
        reports = "CSIT-21058"
        version = "202104301009"
        last_modified = "2021-04-30"
        actor = "LABYRINTH CHOLLIMA"
        malware_family = "HotPlugin"
    strings:
        $c2str = "Cookie=Enable&CookieV=%d&Cookie_Time="
        $cmd0 = "%d-101010"
        $cmd1 = "%d-101011"
        $cmd2 = "%d-202022"
    condition:
        $c2str or
        all of ($cmd*)
}

rule CrowdStrike_CSA_210192_02 : artifact cathoderaider keylogger trialogger 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects encoded special keys strings in TriaLogger."
        reports = "CSA-210192,CSIT-21094"
        version = "202106030950"
        last_modified = "2021-06-03"
        actor = "CathodeRaider"
        malware_family = "TriaLogger"
    strings:
        $s_window = "[Window: " ascii
        $s_ENTER = "ENTER" ascii
        $s_at = "202D20617420" ascii
        $s_BACKSPACE = "5B4241434B53504143455D" ascii
        $s_CAPSLOCK = "5B434150534C4F434B5D" ascii
        $s_CONTROL = "5B434F4E54524F4C5D" ascii
        $s_DOWN = "5B444F574E5D" ascii
        $s_END = "5B454E445D" ascii
        $s_ESCAPE = "5B4553434150455D" ascii
        $s_HOME = "5B484F4D455D" ascii
        $s_LEFT = "5B4C4546545D" ascii
        $s_RIGHT = "5B52494748545D" ascii
        $s_SHIFT = "5B53484946545D" ascii
        $s_TAB = "5B5441425D" ascii
        $s_UP = "5B55505D" ascii
    condition:
        filesize < 20MB and 10 of them
}

rule CrowdStrike_CSIT_21058_01 : labyrinth_chollima loader stackeyflate stackeyflateloader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects the main compression and loading routines present in multiple Stackeyflate loader variants"
        reports = "CSIT-21058,CSIT-21090"
        version = "202104301009"
        last_modified = "2021-04-30"
        actor = "LABYRINTH CHOLLIMA"
        malware_family = "StackeyflateLoader"
    strings:
        $zlib1 = { 00 00 01 00 00 00 [4-5] 00 00 01 00 00 00 ?? ?? ?? ?? 00 00 0f 00 00 00 }
        $zlib2 = { 00 00 01 00 00 00 [4-5] 00 00 01 00 00 00 89 ?? ?? ?? 00 00 }
        $load32 = { c1 e9 1d c1 ea 1e 8b f0 83 e1 01 83 e2 01 c1 ee 1f a9 00 00 00 02 74 15 8b 47 ec 8b 4f e4 68 00 40 00 00 }
        $load64 = { c1 e8 1d c1 ea 1e 41 c1 ?? 1f 83 e0 01 83 e2 01 41 0f ba ?? 19 }
    condition:
        1 of ($zlib*) and
        1 of ($load*)
}

rule CrowdStrike_CSIT_21042_01 : deadbool loader shroudedtutor targeted 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects Deadbool loader binaries based on the smBIOS UUID parsing code"
        reports = "CSIT-21042"
        version = "202103251742"
        last_modified = "2021-03-25"
        actor = "ShroudedTutor"
        malware_family = "Deadbool"
    strings:
        $code_1 = { (B9|68) 42 4D 53 52 }
        $code_2 = {80 (79|78) 01 19}
        $api_getsystemfirmwaretable = "GetSystemFirmwareTable" ascii
        $api_virtualalloc = "VirtualAlloc" ascii
    condition:
        uint16(0) == 0x5A4D and uint32(uint32(0x3C)) == 0x00004550 and filesize < 250KB
        and all of ($code_*) and all of ($api_*)
}

rule CrowdStrike_CSA_210255_01 : blocrypt ntcrypt 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detect packet headers used by ntcrypt for C2 communications"
        reports = "CSA-210255"
        version = "202103191813"
        last_modified = "2021-03-19"
    strings:
        $ = {C7 ?? 02 B1 1C 6C B1 C7 ?? 06 F4 10 22 11}
    condition:
        all of them
}

rule CrowdStrike_CSA_210238_01 : ecrime sprite_spider tunsocks 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects socks tunnel tool TunSocks associated with SPRITE SPIDER activity"
        reports = "CSA-210238"
        version = "202105252048"
        last_modified = "2021-05-25"
        actor = "SPRITE SPIDER"
        malware_family = "TunSocks"
    strings:
        $pdb = "Z:\\coding\\TunCSharp\\TunSocks\\Tun\\obj\\Release\\Tun.pdb"
        $fn1 = "DarthEncrypt"
        $fn2 = "Get8CharacterRandomString"
        $fn3 = "Socks5Server"
    condition:
        uint16(0) == 0x5a4d and
        ($pdb or all of ($fn*))
}

rule CrowdStrike_CSIT_21036_02 : loader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects distinctive bytes and strings used in loaders with XXTEA variant and deobfuscation step"
        reports = "CSIT-21036"
        version = "202106181019"
        last_modified = "2021-06-18"
    strings:
        $prep = { 83 e0 03 81 f6 b9 79 37 9e c1 ed 02 }
        $div_step = { b? 03 00 00 00 99 f7 f? }
        $post_xor = { 3? c? 3? b9 79 37 9e }
        $xxtea1 = { 81 eb 47 86 c8 61 }
        $xxtea2 = { 56 da 4c b5 }
        $name1 = "RTFileQueryInfo"
        $name2 = "RTPathJoin"
        $name3 = "RTProcSelf"
        $name4 = "foo"
    condition:
        all of them and
        filesize < 1MB
}

rule CrowdStrike_CSIT_21036_01 : pcshare rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects distinctive strings in PcShare variant with DNS-based C2 Channel"
        reports = "CSIT-21036"
        version = "202106181019"
        last_modified = "2021-06-18"
        malware_family = "PcShare"
    strings:
        $keylog = "[Erase EOF]"
        $format = ".9%04d"
        $api_string = "api."
        $do = "how do you do" ascii wide
    condition:
        all of them and
        filesize < 500KB
}

rule CrowdStrike_CSIT_21058_02 : labyrinth_chollima loader openssl_loader opensslloader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects a loader similar to Stackeyflate that uses OpenSSL to decrypt strings and an XOR routine to decode a payload"
        reports = "CSIT-21058"
        version = "202104301009"
        last_modified = "2021-04-30"
        actor = "LABYRINTH CHOLLIMA"
        malware_family = "OpenSSLLoader"
    strings:
        $pwd = "5618198335124815612315615648487"
        $xor = { b1 8a eb 06 ?? ?? ?? ?? ?? ?? 30 88 }
    condition:
        all of them
}

rule CrowdStrike_FriarFox_Landing_Page : firefox_extension friarfox 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This matches against strings identified in a landing page used to trick users into installing a malicious Firefox extension dubbed FriarFox. It is likely in use by a China-nexus actor and was seen targeting Tibetans and the diaspora."
        version = "202103051036"
        last_modified = "2021-03-05"
    strings:
        $ = "setTimeout(\"jmp()\",500);"
        $ = "function jmp(){"
    condition:
        all of them
}

rule CrowdStrike_CSA_210231_01 : chopper exchange vexatioustemper webshell 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule matches against a Chopper-like webshell used during exploitation of Microsoft Exchange vulnerabilities by a likely China-nexus actor."
        reports = "CSA-210231"
        version = "202103051036"
        last_modified = "2021-03-05"
    strings:
        // http://f/<script language="JScript" runat="server">
        $ = { 68 74 74 70 3a 2f 2f 66 2f 3c 73 63 72 69 70 74 20 6c 61 6e 67 75 61 67 65 3d 22 4a 53 63 72 69 70 74 22 20 72 75 6e 61 74 3d 22 73 65 72 76 65 72 22 3e }
        $ = "/f/f34fji34r209ur29ur92ru"
        $ = "/<script runat=\"server\">protected void Page_Load(object sender, EventArgs e){S"
        $ = "NO9BxmCXw0JE" ascii wide
    condition:
        any of them
}

rule CrowdStrike_CSA_210196_02 : ecrime rat sombra 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Identifies the decoded reflective injection PowerShell script (stage 2) used to load Sombra RAT."
        reports = "CSA-210196"
        version = "202103121851"
        last_modified = "2021-03-12"
        malware_family = "Sombra"
    strings:
        $ = "$key = [IO.File]::ReadAllBytes" ascii
        $ = "$PEBytes = [IO.File]::ReadAllBytes" ascii
        $ = "[$i] -bxor $key[$i % $key.count]" ascii
        $ = "$e_magic = ($PEBytes[0..1]" ascii
        $ = "Write-Host 'Key length: ' $" ascii
        $ = "Write-Host 'Encrypted length: ' $" ascii
        $ = "Write-Host 'Dump decrypted base64 PEBytes...'" ascii
        $ = "RemoteScriptBlock $" ascii
    condition:
        filesize > 100KB and
        filesize < 200KB and
        5 of them
}

rule CrowdStrike_Mimikat_SSP_CredentialHarvestingTool : mimikat_ssp mimikatz post_exploitation 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects openly available Mimikatz variant called mimikat_ssp, associated with multiple suspected PANDA intrusions"
        version = "202103051036"
        last_modified = "2021-03-05"
        malware_family = "Mimikatz, mimikat_ssp"
    strings:
        $ = "[!] Error code %x received"
        $ = "Usage: ssp.exe PACKAGE_PATH"
        $ = "[*] Building RPC packet"
        $ = "[*] Sending SspirCallRpc call"
        $ = "[*] Sending SspirConnectRpc call"
        $ = "[*] Error code 0x6c6 returned, which is expected if DLL load returns FALSE"
        $ = "AddSecurityPackage Raw RPC Example... by @_xpn_"
        $ = "[*] Connecting to lsasspirpc RPC service"
    condition:
        6 of them
}

rule CrowdStrike_CSIT_21052_03 : goldmax stellarparticle sunshuttle 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects the hardcoded MAC address in GoldMax samples"
        reports = "CSIT-21053"
        version = "202103191028"
        last_modified = "2021-03-19"
        actor = "StellarParticle"
        malware_family = "GoldMax"
    strings:
        $pclntab_fn = "net.(*HardwareAddr).String" ascii
        $hyperv_mac = "c8:27:cc:c2:37:5a" ascii nocase
    condition:
        all of them
}

rule CrowdStrike_CSA_210196_03 : ecrime rat sombra 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects CostaBricks loader for 32-bit Sombra RAT payloads."
        reports = "CSA-210196"
        version = "202103121850"
        last_modified = "2021-03-12"
        malware_family = "Sombra"
    strings:
        $str_pdb = "\\CostaRicto\\Release\\CostaBricks.pdb" ascii
        $str_vmcls = "VMBASERUNNER" ascii
        $str_lib1 = "inflate 1.2." ascii
        $str_lib2 = "Plauger, licensed by Dinkumware, Ltd." ascii
        $str_inj1 = "Failed to open target application process!" ascii
        $str_inj2 = "Machine architecture mismatch between target application and this application!" ascii
    condition:
        filesize > 250KB and
        filesize < 750KB and
        uint16(0) == 0x5a4d and
        5 of them
}

rule CrowdStrike_CSA_201242_01 : mist vexatioustemper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects distinctive HTML element tags and string obfuscation found in samples of the Mist malware."
        reports = "CSA-210242"
        version = "202103121858"
        last_modified = "2021-03-12"
        malware_family = "Mist"
    strings:
        $codi1 = "<CODI>"
        $codi2 = "</CODI>"
        $apde1 = "<APDE>"
        $apde2 = "</APDE>"
        $str_deob = {  C0 C? 04 34 AA }
    condition:
        filesize<1MB and all of them
}

rule CrowdStrike_CSA_210255_02 : blocrypt ntcrypt stealer 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detect strings in the ntcrypt stealer module"
        reports = "CSA-210255"
        version = "202103121900"
        last_modified = "2021-03-12"
    strings:
        $ = "Adding"
        $ = "CheckAccess"
        $ = "POST /"
        $ = " HTTP/1.0"
        $ = "brwsixp"
        $ = "brwsedf"
        $ = "brwschrm"
        $ = "explorer.exe" wide
    condition:
        all of them
}

rule CrowdStrike_CSIT_21053_02 : goldmax stellarparticle sunshuttle 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects function names in GoldMax samples"
        reports = "CSIT-21053"
        version = "202103191028"
        last_modified = "2021-03-19"
        actor = "StellarParticle"
        malware_family = "GoldMax"
    strings:
        $cfg_1 = "main.save_internal_settings"
        $cfg_2 = "main.define_internal_settings"
        $c2_1 = "main.beaconing"
        $c2_2 = "main.request_session_key"
        $c2_3 = "main.send_command_result"
        $c2_4 = "main.retrieve_session_key"
        $c2_5 = "main.resolve_command"
        $aoo_1 = "main.clean_file"
        $aoo_2 = "main.delete_empty"
        $aoo_3 = "main.wget_file"
        $aoo_4 = "main.send_file_part"
        $aoo_5 = "main.write_file"
        $crypt_1 = "main.random"
        $crypt_2 = "main.encrypt"
        $crypt_3 = "main.decrypt"
        $misc_1 = "main.removeBase64Padding"
        $misc_2 = "main.addBase64Padding"
        $misc_3 = "main.Unpad"
        $misc_4 = "main.Pad"
        $misc_5 = "main.GetMD5Hash"
        $misc_6 = "main.fileExists"
    condition:
        any of ($cfg*) and
        any of ($c2*) and
        any of ($aoo*) and
        any of ($crypt*) and
        any of ($misc*) and
        filesize < 10MB
}

rule CrowdStrike_CSA_210265_01 : android xloader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detect ARM64 native libraries used by Android XLoader malware"
        reports = "CSA-210265"
        version = "202103121905"
        last_modified = "2021-03-12"
        malware_family = "XLoader"
    strings:
        // Call Static Object Method (unused)
        $co00 = { 08 7c 7d 93 08 3d 00 91 }
        $co01 = { 08 ed 7c 92 e9 03 00 91 }
        $co02 = { 37 01 08 cb }
        $co10 = { 28 17 40 f9 a9 83 5b f8 }
        $co20 = { 59 d0 3b d5 }
        $co30 = { 28 17 40 f9 }
        // Getter Strings
        $gss0  = "com.Loader"
        $gs01 = { 5f 08 00 71 20 01 00 54 }
        $gs02 = { 5f 04 00 71 80 01 00 54 }
        $gs03 = { 02 02 00 35 08 00 40 f9 }
        // Component Enabler
        $hds0 = "(Landroid/content/ComponentName;II)V"
        $hds1 = "setComponentEnabledSetting"
        $hd01 = { c8 16 40 f9 e9 0f 40 f9 }
        $hd02 = { 1f 01 09 eb c1 00 00 54 }
    condition:
        uint32(0) == 0x464C457F and
        uint32(16) == 0x00b70003 and
        filesize < 100KB and
        ((all of ($co*)) or (all of ($gs*)) or (all of ($hd*)))
}

rule CrowdStrike_CSIT_21073_03 : banking ecrime isfb unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects 64bit ISFB v2.50 samples"
        reports = "CSIT-21073"
        version = "202105140948"
        last_modified = "2021-05-14"
        malware_family = "ISFB"
    strings:
        $crc1 = { 64 5e 28 e1 }
        $crc2 = { e1 dd b1 8f }
        $crc3 = { cb af 22 d7 }
        $aplib = { 41 81 fb ff 04 00 00 76 03 83 c0 01 41 81 fb ff 7c 00 00 76 03 83 c0 01 41 83 fb 7f 77 03 83 c0 02 }
        $serp = { 48 8d 48 04 e8 [4] 48 8d 48 0c e8 [4] 48 8b c8 e8 [4] 48 8d 48 08 e8 [4] 48 83 c4 28 c3 }
    condition:
        2 of ($crc*) and $aplib and $serp
}

rule CrowdStrike_USB_DriveDetector : hunting 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects tools likely based off public USB drive detector code, for hunting purposes"
        version = "202103121854"
        last_modified = "2021-03-12"
    strings:
        $query_remove = "Drive path must be supplied to register for Query remove." wide
        $form_msg = "This is invisible form. To see DriveDetector code click View Code" wide
        $form_name = "DetectorForm" wide
        $form_label = "label1" wide
        $pdb_frag = "DriveDetector"
    condition:
        2 of them and
        filesize < 75KB
}

rule CrowdStrike_CSIT_21057_01 : downloader nim nimarloader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects assembly and string patterns found in NimarLoader samples"
        reports = "CSIT-21057"
        version = "202104160926"
        last_modified = "2021-04-16"
        malware_family = "NimarLoader"
    strings:
        $str1 = "@heartbeat" fullword
        $str2 = "@shellcode" fullword
        $str3 = "@powershell.exe" fullword
        $str4 = "@handshake" fullword
        $str5 = "@HEARTBEAT set Failed" fullword
        $str6 = "@Shellcode Done" fullword
        $cmd1 = { 48 b8 70 6f 77 65 72 73 68 65 }
        $cmd2 = { 48 b8 68 61 6e 64 73 68 61 6b }
        $cmd3 = { 48 b8 73 68 65 6c 6c 63 6f 64 }
        $cmd4 = { 48 b8 68 65 61 72 74 62 65 61 }
        $asm_xor_decrypt = { 48 89 f0 48 83 c6 01 48 c1 f8 ?? }
        $asm_c2_url_parse = { 81 78 10 68 74 74 70 0f }
        $asm_c2_url_parse1 = { 80 78 14 73 0f [5] 4? ?? bb 01 00 00 }
    condition:
        filesize < 1MB and
        ( 4 of ($str*) or 3 of ($cmd*) or all of ($asm*) )
}

rule CrowdStrike_CSIT_21066_02 : loader xstart 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects additional xStart variants that may not contain an FMain export"
        reports = "CSIT-21066"
        version = "202104160927"
        last_modified = "2021-04-16"
        malware_family = "xStart"
    strings:
        $str1 = "lpszPassWord"
        $str2 = "CryptDecrypt"
        $str3 = "LoadResource"
        $str4 = "FindResourceW"
        // Offset to name of MP4 rsrc
        $str5 = { 4d 00 50 00 34 00 00 00 }
        $exe1 = "SearchFilterHost.exe" wide
        $exe2 = "Dot ,IMAGE_FILE_DLL" wide
        $b64 = "IMAGE_REL_BASED_DIR64(=%x)." wide
        $run1 = "IsRun." wide
        $run2 = "MP4" wide
    condition:
        uint16(0) == 0x5a4d and
        filesize < 1500KB and
        all of ($str*) and
        ((1 of ($exe*)) or ($b64 and $run1) or (all of ($run*)))
}

rule CrowdStrike_Obfuscated_Chopper_Webshell_UnsafeVariant : chopper webshell 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects an obfuscated copy of Chopper webshell that has been observed to be in use by China-nexus actors, including one group publicly referred to as HAFNIUM."
        version = "202103191027"
        last_modified = "2021-03-19"
    strings:
        $header = "<%@ Page Language=\"Jscript\" Debug=true%>"
        $closer = { 29 3B [1-2] 25 3E }
        $error = "=Request.Form(\""
        $eval = "eval("
        $space_plus = ") + "
    condition:
        $header and $closer and $error and $eval and #space_plus == 5 and filesize < 4KB
}

rule CrowdStrike_CSA_210264_01 : ecrime hades indrik_spider ransomware unpacked wastedlocker 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Identifies an unpacked 64-bit PE variant of WastedLocker known as Hades ransomware."
        reports = "CSA-210264"
        version = "202105260908"
        last_modified = "2021-05-26"
        actor = "INDRIK SPIDER"
        malware_family = "WastedLocker"
    strings:
        $asm_cfgval1 = { b9 de 60 b9 59 e8 }
        $asm_cfgval2 = { b9 6f b0 ce ad e8 }
        $asm_cfgval3 = { b9 c6 85 4d dc e8 }
        $asm_cfgval4 = { b9 a4 48 15 05 e8 }
        $asm_cfgval5 = { b9 c7 d3 25 f9 e8 }
        $asm_blksize = { bb 00 00 01 00 }
    condition:
        uint16(0) == 0x5a4d and
        filesize < 5MB and
        6 of ($asm_*)
}

rule CrowdStrike_CSIT_21053_01 : artifact golang goldmax stellarparticle 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects a unique build path found in GoldMax samples"
        reports = "CSIT-21053"
        version = "202103191028"
        last_modified = "2021-03-19"
        actor = "StellarParticle"
        malware_family = "GoldMax"
    strings:
        // Example: /var/www/html/builds/1590072397_FZGMBM.go
        $p = "/var/www/html/builds/1"
    condition:
        $p and
        filesize < 128MB
}

rule CrowdStrike_CSA_210268_01 : dearcry ecrime ransomware 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule identifies DearCry ransomware PE files that were deployed during a mass exploitation event involving Microsoft Exchange servers."
        reports = "CSA-210268"
        version = "202103161906"
        last_modified = "2021-03-16"
        malware_family = "DearCry Ransomware"
    strings:
        $pdb = "\\EncryptFile -svcV2\\Release\\EncryptFile.exe.pdb" ascii
        $str_1 = ".CRYPT" ascii
        $str_2 = "msupdate" ascii
        $str_3 = "readme.txt" ascii
        $str_4 = "dear!!!" ascii
        $str_5 = "Your file has been encrypted!" ascii
        $str_6 = "CRY!" ascii
    condition:
        uint16(0) == 0x5a4d and
        filesize < 3MB and
        ($pdb or 5 of ($str_*))
}

rule CrowdStrike_Aenjaris_01 : virus 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects a polymorphic virus with the AV label 'Aenjaris'."
        version = "202103191028"
        last_modified = "2021-03-19"
        malware_family = "Aenjaris"
    strings:
        $str01 = "Com`on , that`s the best you can do"
        $str02 = "HA HA HA"
        $str03 = "Ha Ha HA !"
        $str04 = "How lame can u be ?"
        $str05 = "I am the one and only"
        $str06 = "I`m so cool :)"
        $str07 = "I`m very dissapointed with your performace"
        $str08 = "Mess with the best , die like the rest"
        $str09 = "Nobady can distroy me"
        $str10 = "SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run\\"
        $str11 = "Still trying  !"
        $str12 = "What`s the point !"
        $str13 = "Yeap , i`m a bad mother fucker !"
        $str14 = "You realy think you can escape me"
        $str15 = "You suck"
        $str16 = "c:\\stop-adw.txt"
        $str17 = "start %s"
    condition:
        10 of them
}

rule CrowdStrike_CSA_210283_01 : email exchange helix_kitten maildrop rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects HELIX KITTEN MailDrop through strings used in the configuration segment"
        reports = "CSA-210283"
        version = "202103261808"
        last_modified = "2021-03-26"
        actor = "HELIX KITTEN"
        malware_family = "MailDrop"
    strings:
        $ = "Microsoft Office/15.0 (Windows NT {0}; Microsoft Outlook 15.0.4675; Pro)" ascii wide
        $ = "cmdSubject" wide
        $ = "resultSubject" wide
        $ = "ruleName" wide
        $ = "emailBody" wide
        $ = "aliveSubject" wide
        $ = "startString" wide
        $ = "cmd.exe" wide
    condition:
        uint16(0) == 0x5A4D and
        uint32(uint32(0x3C)) == 0x00004550 and
        all of them
}

rule CrowdStrike_CSIT_21066_03 : loader xstart 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects xStart malware signed with Elysian cert"
        reports = "CSIT-21066"
        version = "202104160927"
        last_modified = "2021-04-16"
        malware_family = "xStart"
    strings:
        $str1 = "thawte SHA256 Code Signing CA"
        $str2 = "LoadResource"
        $str3 = "CryptDecrypt"
        // Offset to name of MP4 rsrc
        $str4 = { 4d 00 50 00 34 00 00 00 }
        $serial = { 03 d4 33 fd c2 46 9e 9f d8 78 c8 0b c0 54 51 47 }
        $certname = { ec a3 bc ec 8b 9d ed 9a 8c ec 82 ac 20 ec 97 98 eb a6 ac ec 8b 9c ec 98 a8 eb 9e a9 }
    condition:
        uint16(0) == 0x5a4d and
        all of them
}

rule CrowdStrike_CSIT_21066_04 : loader xstart 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects xStart malware signed with Eagle cert"
        reports = "CSIT-21066"
        version = "202104160927"
        last_modified = "2021-04-16"
        malware_family = "xStart"
    strings:
        $str1 = "Eagle Investment Systems LLC"
        $str2 = "LoadResource"
        $str3 = "CryptDecrypt"
        // Offset to name of MP4 rsrc
        $str4 = { 4d 00 50 00 34 00 00 00 }
        $serial = { 61 6a ae 89 22 bb 78 e2 16 0a 73 05 61 06 b7 bb }
    condition:
        uint16(0) == 0x5a4d and
        all of them
}

rule CrowdStrike_ExploitPotato_01 : exploit privilege_escalation 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects privilege escalation tools named BadPotato and SweetPotato"
        version = "202103261809"
        last_modified = "2021-03-26"
    strings:
        $str1 = "[=] Your version of Windows fixes DCOM interception forcing BITS to perform WinRM intercept" wide ascii
        $str2 = "[!] No authenticated interception took place, exploit failed" wide ascii
        $str3 = "CLSID (default BITS: 4991D34B-80A1-4291-83B6-3328366B9097)" wide ascii
        $bwp1 = "\\\\.\\pipe\\{0}\\pipe\\spoolss" wide ascii
        $bwp2 = "[!] No Command" wide ascii
    condition:
        2 of ($str*) or ($bwp1 and $bwp2)
}

rule CrowdStrike_CSA_210312_01
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects the DiamondFox Azeria strings and UnixCrypt constants"
        reports = "CSA-210312"
        version = "202104211321"
        last_modified = "2021-04-21"
    strings:
        $ = "AZERIA" wide
        $ = "pthreadVC" wide
        $ = "snapshot.jpg" wide
        $ = "\\ID.txt" wide
        // UnixCrypt constants
        $SKBC2 = {00000000010000000000040001000400000000010100000100000401010004010200000003000000020004000300040002000001030000010200040103000401000200000102000000020400010204000002000101020001000204010102040102020000030200000202040003020400020200010302000102020401030204010000000801000008000004080100040800000009010000090000040901000409020000080300000802000408030004080200000903000009020004090300040900020008010200080002040801020408000200090102000900020409010204090202000803020008020204080302040802020009030200090202040903020409}
        $SKBC3 = {00000000000010000001000000011000080000000800100008010000080110000010000000101000001100000011100008100000081010000811000008111000000000040000100400010004000110040800000408001004080100040801100400100004001010040011000400111004081000040810100408110004081110040000020000001200000102000001120008000200080012000801020008011200001002000010120000110200001112000810020008101200081102000811120000000204000012040001020400011204080002040800120408010204080112040010020400101204001102040011120408100204081012040811020408111204}
    condition:
        all of them
}

rule CrowdStrike_Piccoload_01 : downloader loader piccoload stager 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects a very small Linux connect-back stager for shellcode payloads that are executed in memory."
        version = "202103261831"
        last_modified = "2021-03-26"
        malware_family = "Piccoload"
    strings:
        $call_socket = {31DBF7E35343536A02B06689E1CD80}
        $call_connect = {68????????680200????89E16A665850515789E143CD80}
        $call_sleep = {68A2000000586A006A0589E331C9CD8085C0}
        $call_mprotect = {B207B90010000089E3C1EB0CC1E30CB07DCD80}
        $call_read = {89E199B26AB003CD8085C07802FFE1}
    condition:
        $call_connect and 3 of them and filesize < 800
}

rule CrowdStrike_CheekyParcelStager_01 : cheeky_parcel downloader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects a downloader that disguises itself as an application for tracking parcels."
        version = "202103261830"
        last_modified = "2021-03-26"
        malware_family = "CheekyParcel"
    strings:
        $must1 = "#Strings"
        $must2 = "BSJB"
        $ = "/UPT;component/mainwindow.xaml" wide fullword
        $ = "Code: {0}" wide fullword
        $ = "Downloading..." wide fullword
        $ = "{0}.msi" wide fullword
        $ = "Track a package" wide
        $ = "Downloading..." wide
        $ = "Show information" wide
        $ = "Universal Package Tracking" wide
        $ = "Click on the button to see the Tracking Details." wide
        $ = "Invoke-Expression([System.Text.Encoding]::UTF8.GetString([System.Convert]::FromBase64String(" wide
    condition:
        all of ($must*) and 6 of them
}

rule CrowdStrike_CheekyParcelStager_02 : cheeky_parcel downloader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects a downloader that disguises itself as an application for tracking parcels."
        version = "202103261828"
        last_modified = "2021-03-26"
        malware_family = "CheekyParcel"
    strings:
        $ = "#Strings"
        $ = "BSJB"
        $ = {
        02 00 03 00 14 23 05 6C 6F 63 61 6C 11 63 6C 72 2D 6E 61 6D
        65 73 70 61 63 65 3A 55 50 54 04 00 04 00 01 00 02 00 03 00
        2D 01 00 00 00 1F 0C 00 00 1D FD 00 05 54 69 74 6C 65 24 20
        00 00 1A 55 6E 69 76 65 72 73 61 6C 20 50 61 63 6B 61 67 65
        20 54 72 61 63 6B 69 6E 67 99 FD 24 09 D1 FF 03 34 35 30 A4
        FE 24 09 C7 FF 03 38 30 30 A4 FE 1F 0B 01 00 1D FD 00 04 49
        63 6F 6E 24 12 01 00 0C 6C 6F 63 61 74 69 6F 6E 2E 70 6E 67
        E2 FE 1F 11 02 00 1D FD 00 0A 52 65 73 69 7A 65 4D 6F 64 65
        24 0E 02 00 08 4E 6F 52 65 73 69 7A 65 3D FF 1F 1C 03 00 1D
        FD 00 15 57 69 6E 64 6F 77 53 74 61 72 74 75 70 4C 6F 63 61
        74 69 6F 6E 24 12 03 00 0C 43 65 6E 74 65 72 53 63 72 65 65
        6E 3D FF 1F 0E 04 00 1D FD 00 07 54 6F 70 6D 6F 73 74 06 06
        04 00 2E 00 01 2E F2 FF 03 02 FF 00 07 AA FF 03 E6 FE 00 1F
        12 05 00 E6 FE 00 0B 49 6D 61 67 65 53 6F 75 72 63 65 24 0F
        05 00 09 32 33 33 32 32 2E 6A 70 67 E2 FE 04 08 2E 2B FF 03
        C9 FF 00 2D 02 00 00 00 1F 0B 06 00 C9 FF 03 04 4E 61 6D 65
        24 0C 06 00 06 62 75 74 74 6F 6E 99 FD 24 15 F2 FF 0F 54 72
        61 63 6B 20 61 20 70 61 63 6B 61 67 65 99 FD 24 15 CF FF 0F
        32 34 35 2C 31 37 34 2C 32 34 35 2C 31 37 33 71 FD 24 08 E4
        FF 02 32 32 28 FF 04 03 17 FE 00 2D 03 00 00 00 1F 0B 07 00
        17 FE 03 04 4E 61 6D 65 24 0E 07 00 08 70 72 6F 67 72 65 73
        73 99 FD 24 08 D1 FF 02 32 35 A4 FE 24 13 CF FF 0D 31 32 39
        2C 31 31 37 2C 31 32 38 2C 30 71 FD 24 09 C8 FF 03 54 6F 70
        3D FF 24 0C 79 FF 06 48 69 64 64 65 6E 3D FF 04 03 A6 FE 00
        2D 04 00 00 00 1F 0B 08 00 A6 FE 03 04 4E 61 6D 65 24 0B 08
        00 05 6C 61 62 65 6C 99 FD 24 36 F2 FF 30 43 6C 69 63 6B 20
        6F 6E 20 74 68 65 20 62 75 74 74 6F 6E 20 74 6F 20 73 65 65
        20 74 68 65 20 54 72 61 63 6B 69 6E 67 20 44 65 74 61 69 6C
        73 2E 99 FD 24 10 CF FF 0A 31 30 2C 33 36 36 2C 30 2C 30 71
        FD 24 09 C8 FF 03 54 6F 70 3D FF 24 08 E4 FF 02 31 38 28 FF
        24 0C D0 FF 06 43 65 6E 74 65 72 3D FF 24 0D 79 FF 07 56 69
        73 69 62 6C 65 3D FF 06 0A E0 FF E8 02 01 FF FF FF FF 24 09
        C7 FF 03 37 38 34 A4 FE 24 0C DF FF 06 43 65 6E 74 65 72 3D
        FF 04 04 04 02
        }
    condition:
        all of them
}

rule CrowdStrike_CheekyParcel_01 : backdoor cheeky_parcel 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects a PowerShell backdoor observed as the payload of a stager that disguises itself as a parcel tracking application."
        version = "202103261830"
        last_modified = "2021-03-26"
        malware_family = "CheekyParcel"
    strings:
        $handles_plain = "$res = \"VALID $stdout`n$stderr\""
        $handles_b64_1 = "JHJlcyA9ICJWQUxJRCAkc3Rkb3V0YG4kc3RkZXJyIg"
        $handles_b64_2 = "cmVzID0gIlZBTElEICRzdGRvdXRgbiRzdGRlcnIi"
        $handles_b64_3 = "ZXMgPSAiVkFMSUQgJHN0ZG91dGBuJHN0ZGVyciI"
        $tasklen_plain = "$task[2..$task.Length]"
        $tasklen_b64_1 = "JHRhc2tbMi4uJHRhc2suTGVuZ3RoXQ"
        $tasklen_b64_2 = "dGFza1syLi4kdGFzay5MZW5ndGhd"
        $tasklen_b64_3 = "YXNrWzIuLiR0YXNrLkxlbmd0aF0"
        $encrypt_plain = "Encrypt $key \"VALID uploaded $path success\""
        $encrypt_b64_1 = "RW5jcnlwdCAka2V5ICJWQUxJRCB1cGxvYWRlZCAkcGF0aCBzdWNjZXNzIg"
        $encrypt_b64_2 = "bmNyeXB0ICRrZXkgIlZBTElEIHVwbG9hZGVkICRwYXRoIHN1Y2Nlc3Mi"
        $encrypt_b64_3 = "Y3J5cHQgJGtleSAiVkFMSUQgdXBsb2FkZWQgJHBhdGggc3VjY2VzcyI"
        $c2build_plain = "(\"https\" + ':' + \"//$ip\" + ':' + \"$port/results/$name\")"
        $c2build_b64_1 = "KCJodHRwcyIgKyAnOicgKyAiLy8kaXAiICsgJzonICsgIiRwb3J0L3Jlc3VsdHMvJG5hbWUiKQ"
        $c2build_b64_2 = "Imh0dHBzIiArICc6JyArICIvLyRpcCIgKyAnOicgKyAiJHBvcnQvcmVzdWx0cy8kbmFtZSIp"
        $c2build_b64_3 = "aHR0cHMiICsgJzonICsgIi8vJGlwIiArICc6JyArICIkcG9ydC9yZXN1bHRzLyRuYW1lIik"
    condition:
        filesize < 100KB and (
        ($handles_plain or any of ($handles_b64*)) or
        ($tasklen_plain or any of ($tasklen_b64*)) or
        ($encrypt_plain or any of ($encrypt_b64*)) or
        ($c2build_plain or any of ($c2build_b64*)))
}

rule CrowdStrike_Modified_Regeorg_Webshell_Tunneling_Tool : post_exploitation regeorg webshell 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule matches against a modified version of the Regeorg webshell tunneling tool that has been used by targeted intrusion actors."
        version = "202103262000"
        last_modified = "2021-03-26"
    strings:
        $ = "String en ="
        $ = "String de ="
        $ = "String cmd = Request.Headers.Get("
        $ = "Socket s = (Socket)Session[\"socket\"];"
        $ = "System.Net.IPEndPoint remoteEP = new IPEndPoint(ip, port);"
    condition:
        all of them
}

rule CrowdStrike_OWA_Auth_Chopper_Credential_Logger_Variant : chopper credential_harvesting webshell 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule matches against a Chopper variant often deployed on Exchange or OWA servers that includes functionality to harvest user credentials in an encrypted log file."
        version = "202104021044"
        last_modified = "2021-04-02"
    strings:
        $c2_z1 = "Z1" ascii wide
        $c2_z2 = "Z2" ascii wide
        $c2_open_delim = "|<-" ascii wide
        $c2_close_delim = "->|" ascii wide
        $c2_exec_success = "Execute Successfully!" ascii wide
        $c2_error = "ERROR://" ascii wide
        $logger1 = "c:\\programdata\\log.txt" ascii wide
        $logger2 = "user" ascii wide
        $logger3 = "password" ascii wide
        $logger4 = "/{0}\t{1}\t{2}\t{3}\t{4}\t{5}" ascii wide
    condition:
        4 of ($c2_*) and 2 of ($logger*) and filesize < 30KB
}

rule CrowdStrike_CSIT_21071_04 : rat shadowpad 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects opaque predicates used in ShadowPad"
        reports = "CSIT-21071"
        version = "202105271552"
        last_modified = "2021-05-27"
        malware_family = "ShadowPad"
    strings:
        $pat1 = { 81 fc ?? ?? 00 00 e8 }
    condition:
        #pat1 > 150 and
        filesize < 5MB
}

// WARNING: This rule will only work with YARA 3
import "pe"

rule CrowdStrike_CSIT_21071_01 : loader shadowpad 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects custom hash algorithm used in ShadowPad loader"
        reports = "CSIT-21071"
        version = "202104301009"
        last_modified = "2021-04-30"
        malware_family = "ShadowPad"
    strings:
        $pat1 = { b8 49 bb 3d 91 }
        $pat2 = { c1 c8 08 }
        $pat3 = { 35 59 b6 06 fa }
    condition:
        uint32(0x7c) == 0 and
        pe.number_of_signatures == 0 and
        pe.characteristics & pe.LARGE_ADDRESS_AWARE and
        pe.subsystem == pe.SUBSYSTEM_WINDOWS_GUI and
        all of them and
        filesize < 5MB
}

rule CrowdStrike_CSA_210321_02 : elf linux rat sempathy 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects an instance of the ELF-based Sempathy RAT based on identified FUNC type symbols"
        reports = "CSA-210321"
        version = "202104090915"
        last_modified = "2021-04-09"
        malware_family = "SempathyRAT"
    strings:
        $ = "CMD_SearchFile"
        $ = "CMD_TcpProxyClosed"
        $ = "CMD_TcpProxyDataComming"
        $ = "CMD_StartTcpProxy"
        $ = "CMD_FileUploadEnd"
        $ = "CMD_FileDataComing"
        $ = "CMD_OpenCmdShell"
        $ = "CMD_PTTYDataComming"
        $ = "CMD_DownloadOneFile"
        $ = "CMD_GetProcessList"
        $ = "CMD_GetFileList"
        $ = "CMD_GetFileAttributes"
        $ = "CMD_UploadOneFile"
        $ = "CMD_CreateNewFolder"
        $ = "CMD_DeleteFile"
        $ = "CMD_TerminateProcess"
    condition:
        uint32(0) == 0x464c457f and
        3 of them
}

rule CrowdStrike_CSA_210357_03 : goldfinder stellarparticle 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects GoldFinder using cleartext strings"
        reports = "CSA-210357"
        version = "202104160949"
        last_modified = "2021-04-16"
        actor = "StellarParticle"
        malware_family = "GoldFinder"
    strings:
        $s1 = "Target:"
        $s2 = "StatusCode:"
        $s3 = "Headers:"
        $s4 = "Data:"
        $s5 = "Go-http-client/"
        $s6 = "Location"
        $cmp1 = { 48 83 fa 64 0f }
        $cmp2 = { 48 81 78 10 c8 00 00 00 }
    condition:
        all of them and
        filesize < 10MB
}

rule CrowdStrike_CSA_210357_02 : downloader sibot stellarparticle 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects Sibot obfuscated strings"
        reports = "CSA-210357"
        version = "202104160928"
        last_modified = "2021-04-16"
        actor = "StellarParticle"
        malware_family = "Sibot"
    strings:
        $s1 = "\"BCD\""
        $s2 = "\"BCF\""
        $s3 = "HHIDIIHHHGFAEGIDGJICIGGJICIIHHHGHCIEIEIAEGFEEGEI"
        $s4 = "IAICHJIIIJGJHIGFGGHGGJ"
        $s5 = "IAICHJIIIJIDGJICIGGJIC"
        $s6 = "IDGHICHDIAIEHDHIHBEGHAHDHGGJIDIJIDIEGJHHHJGGHEGJGHIE"
        $s7 = "IDGJHGGJGHIEDCECDCHAICHJHHDCHCHIGJIEJFGHHJHIHIGJGHIEHDHJHI"
        $s8 = "IDHJHAIEIHGFICGJJCHHHDGHICHJIDHJHAIEJCIHHDHIGIHJIHIDJCGHIFICICGJHIIEIGGJICIDHDHJHIJCHDHIIEGJICHIGJIEDCIDGJIEIEHDHIHBID"
        $s9 = "IFIDGJICEFGFHBGJHIIE"
        $s10 = "IHHDHIFBFAJFIAICHJGHGJIDIDIDIEGFICIEIFIA"
        $s11 = "IHHDHIHCIEIEIAEGIHHDHIHCIEIEIAICGJIBIFGJIDIEEGFDEGEJ"
        $s12 = "IHHDHIHHHBHHIEIDFI"
        $s13 = "JJFIJCBBJBAFBBABAABBBBBJBBFJCBBFBCBBBFBBGBABBAJFBFAJCBAABBEBAFBBIBABBBEBBF"
        $s14 = "HBGJIE"
    condition:
        6 of them and
        filesize < 10MB
}

rule CrowdStrike_CSA_210357_01 : downloader sibot stellarparticle 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects Sibot obfuscated strings"
        reports = "CSA-210357"
        version = "202104160928"
        last_modified = "2021-04-16"
        actor = "StellarParticle"
        malware_family = "Sibot"
    strings:
        $s1 = /CINT\(CHR\(CINT\(ASC\(MID\([^,]+\s*,\s*[^,]+\s*,\s*1\)\)\s*-\s*17\)\)\)/
        $s2 = /IF \S+\*10 \+ \S+ < 32 THEN/
        $s3 = /& CHR\(\S+\*100 \+ \S+\*10 \+ \S+\)/
    condition:
        all of them and
        filesize < 10MB
}

rule CrowdStrike_CSA_210321_01 : linux rat sempathy 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects the ELF-based Sempathy RAT based on identified byte patterns"
        reports = "CSA-210321"
        version = "202104090915"
        last_modified = "2021-04-09"
        malware_family = "SempathyRAT"
    strings:
        $xor_loop_1 = { 83 c0 01 80 34 16 [1] 3d 4c 04 00 00 89 c2 75 f0 }
        $xor_loop_2 = { 83 f1 [1] 88 08 83 c0 01 0f b6 08 84 c9 75 f1 }
        $config_marker_bytes = { 3d e4 b8 27 }
        $basic_info_marker = { c7 [2-5] d3 1e 1f df }
        $alphabet_fragment = "pqrstuvwxyzabcdePQRST\x00"
    condition:
        uint32(0) == 0x464c457f and
        3 of them
}

rule CrowdStrike_CSA_210324_01 : lv ransomware revil sodinokibi unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects unpacked REvil ransomware samples which contain the LV variant public key."
        reports = "CSA-210324"
        version = "202105260909"
        last_modified = "2021-05-26"
        malware_family = "REvil"
    strings:
        $expand = "expand 32-byte kexpand 16-byte k" ascii
        $mutex = "\\BaseNamedObjects\\%S" wide fullword
        $op_api_hashing = { 8d 46 bf 8d 5b 02 66 83 f8 19 77 03 83 ce 20 69 d2 0f 01 00 00 0f b7 c6 0f b7 33 03 d0 66 85 f6 75 }
        $op_search_dll = { 8b 50 0c 83 c2 14 89 55 ?? 8b 0a 3b ca 74 (4?|5?) 8b 7d 08 }
        $op_rc4_01 = { 33 d2 8a 9c 3d ?? f? ff ff 8b c7 0f b6 cb f7 75 ?? 8b 45 ?? 0f b6 04 02 03 c6 03 c8 0f b6 f1 8a 84 35 ??f? ff ff 88 84 3d ?? f? ff ff 47 88 9c 35 ?? f? ff ff 81 ff 00 01 00 00 }
        $op_rc4_02 = { 40 0f b6 c8 89 4d ?? 8a 94 0d ?? f? ff ff 0f b6 c2 03 c6 0f b6 f0 8a 84 35 ?? f? ff ff 88 84 0d ?? f?ff ff 88 94 35 ?? f? ff ff 0f b6 8c 0d ?? f? ff ff 0f b6 c2 03 c8 8b 45 ?? 0f b6 c9 8a 8c 0d ?? f? ff ff 32 0c 07 88 08 40 89 45 ?? 8b 45 fc 83 eb 01 }
        $pub_key = { 79 2a 70 2b 57 dc 88 1a c2 }
    condition:
        (((($expand or $mutex) and 2 of ($op*)) or (3 of ($op*)))) and
        $pub_key
}

rule CrowdStrike_CSA_210331_02 : konni privilege_escalation uacbypass velvet_chollima 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects strings in Konni installer used for multiple UAC bypass methods"
        reports = "CSA-210331"
        version = "202104091329"
        last_modified = "2021-04-09"
        actor = "VELVET CHOLLIMA"
        malware_family = "KONNI"
    strings:
        $export = "EntryPoint"
        $elev = "Elevation:Administrator!new:" wide
        $clsid1 = "{3E5FC7F9-9A51-4367-9063-A120244FBEC7}" wide
        $clsid = "{D2E7041B-2927-42fb-8E9F-7CE93B6DC937}" wide
        $riid1 = { 74 6d dd 6e 07 c0 75 4e b7 6a e5 74 09 95 e2 4c }
        $riid2 = { 95 d1 16 0a 47 6f 64 49 92 87 9f 4b ab 6d 98 27 }
        $proc1 = "taskmgr.exe" wide
        $proc2 = "winver.exe" wide
    condition:
        all of them
}

rule CrowdStrike_CSA_210331_01 : konni rat velvet_chollima 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects stings in Konni updated HTTP variant including decoding routine"
        reports = "CSA-210331"
        version = "202104091329"
        last_modified = "2021-04-09"
        actor = "VELVET CHOLLIMA"
        malware_family = "KONNI"
    strings:
        $ = "success!"
        $ = "%ws %ws \"%ws"
        $ = { c0 e1 06 44 2a d8 41 8a c4 49 83 c5 04 }
    condition:
        all of them
}

rule CrowdStrike_Purehq_Webshell_ASPX_01 : chopper purehq webshell 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects the Pureqh Chopper-compatible webshell"
        version = "202104090915"
        last_modified = "2021-04-09"
    strings:
        $ = "\"unsa\""
        $ = "\"fe\""
        $ = "eval("
        $ = "Request.Form["
        $ = "<%@ Page Language=\"Jscript\""
    condition:
        all of them
}

rule CrowdStrike_Purehq_Webshell_PHP_01 : chopper php webshell 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects the Pureqh Chopper-compatible webshell"
        version = "202104090915"
        last_modified = "2021-04-09"
    strings:
        $str_vbits_shift = "$v &= ((1 << $vbits) - 1);"
        $str_b32_alph = "$BASE32_ALPHABET[$v >> $vbits];"
        $str_eval = "@eval(\"/*"
        $functions = /function [A-Z]{4}\(\$[A-Z]{4}\)\{/
    condition:
        (all of ($str*) or (1 of ($str*) and #functions == 2)) and
        filesize < 10KB
}

rule CrowdStrike_Expiro_02 : expiro infector infostealer 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects the x64 and x86 loader stub of some Expiro variants"
        version = "202104160926"
        last_modified = "2021-04-16"
        malware_family = "Expiro"
    strings:
        $x64 = { 44 8b 21 43 81 f4 [4] 4f ff cc 47 89 23 4b ff cd 49 ff cd 4d ff cd 4e ff c1 48 ff c1 48 ff c1 4e ff c1 4d 83 c3 04 49 ff cd 45 85 ed }
        $x86 = { 8b 3e 81 f7 [4] 4f 83 ff 00 74 ?? 01 cf 8b 07 03 c3 89 07 83 c6 04 }
    condition:
        any of them
}

rule CrowdStrike_CSA_210340_01 : android 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Infected Dalvik executable file contained in version 3.17.18 of the APKPure Android client."
        reports = "CSA-210340"
        version = "202104160926"
        last_modified = "2021-04-16"
    strings:
        $dex = { 64 65 78 0a ?? ?? ?? 00 }
        $key = "d4as56fads4f4" ascii wide
    condition:
        $dex at 0 and $key
}

rule CrowdStrike_CSA_210376_01 : bmpscriptrat rat silent_chollima 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects strings used in C2 status messages, uploads, and self-delete functionality."
        reports = "CSA-210376"
        version = "202106151607"
        last_modified = "2021-06-15"
        actor = "SILENT CHOLLIMA"
        malware_family = "BMPScriptRAT"
    strings:
        $bath_file_name = "edg89COA.bat" fullword
        $batch_file_0 = "@echo off\\r\\n:L1\\r\\ndel \\\"%s\\\"%s \\\"%s\\\" goto L1\\r\\ndel \\\"%s\\\"\\r"
        $key_0 = "MicrosoftCorporationValidation@#$%^&*()!US" fullword
        $upload_string_boundary = "-----------------------------6acdd8e40b3a"
        $status_string_0 = "1111%d Success!" fullword
        $status_string_1 = "8877 Success!" fullword
        $status_string_2 = "8888 Success!" fullword
        $status_string_3 = "1234 Success!" fullword
        $status_string_4 = "4444FAIL" fullword
    condition:
        uint16(0)== 0x5a4d and 4 of them
}

rule CrowdStrike_CSA_210376_02 : bmpscriptrat loader silent_chollima 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects byte sequences used in decoding sandbox dll names."
        reports = "CSA-210376"
        version = "202104261413"
        last_modified = "2021-04-26"
        actor = "SILENT CHOLLIMA"
        malware_family = "BMPScriptRAT"
    strings:
        $a = { 0f b6 44 15 e0 48 ff c2 42 32 44 05 d0 48 83 fa 0f 49 0f 44 d6 41 88 04 30 49 ff c0 49 83 f8 0d 7c de }
        $b = { 0f b6 44 0d f7 48 ff c1 32 44 15 e7 48 83 f9 0f 49 0f 44 ce 88 04 32 48 ff c2 48 83 fa 0b 7c e0 }
        $c = { 0f b6 44 15 d0 48 ff c1 32 44 0d df 48 83 f9 0f 49 0f 44 ce 88 04 32 48 ff c2 48 83 fa 0b 7c e0 }
        $d = { 0f b6 44 15 f7 48 ff c2 42 32 44 05 e7 48 83 fa 0f 49 0f 44 d6 41 88 04 30 49 ff c0 49 83 f8 0d 7c de }
    condition:
        uint16(0) == 0x5a4d and 1 of them
}

// WARNING: This rule will only work with YARA 3
import "pe"

rule CrowdStrike_CSA_210473_01 : dropper pingjsrat pingjsratdropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects dropper of PingJSRAT"
        reports = "CSA-210473"
        version = "202105280931"
        last_modified = "2021-05-28"
        malware_family = "PingJSRATDropper"
    strings:
        $ = "Software\\Microsoft\\Windows\\CurrentVersion\\App Paths" wide
        $ = "/c powershell -ExecutionPolicy ByPass -Command \"Stop-ScheduledTask -TaskName 'GoogleUpdateTaskMachineCore';Stop-ScheduledTask -TaskName 'GoogleUpdateTaskMachineUA';\"" wide
        $ = "/c TASKKILL /F /IM GoogleUpdate.exe" wide
        $ = "/c DEL /F \"%s\"" wide
        $ = "\\manifest.json"
        $ = "extension_can_script_all_urls"
        $ = "Software\\Policies\\Google\\Chrome\\ExtensionInstallWhitelist"
        $ = "/c REG ADD HKLM\\Software\\Policies\\Google\\Chrome\\ExtensionInstallWhitelist /v %d /t REG_SZ /d %S" wide
        $ = "zip_open"
        $ = "LockResource"
    condition:
        int16(0) == 0x5a4d and pe.number_of_resources > 1 and all of them and filesize < 5MB
}

rule CrowdStrike_CSA_210387_01 : campoloader ecrime loader unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects unpacked samples of CampoLoader"
        reports = "CSA-210387"
        version = "202104301008"
        last_modified = "2021-04-30"
        malware_family = "CampoLoader"
    strings:
        $str_exp = "DF1\x00"
        $str_ping = "ping"
        $str_path = "C:\\ProgramData\\"
        $str_url = "/campo/"
        $str_post = "POST %s HTTP/1.1\x0D\x0AHost: %s\x0D\x0APragma: no-cache\x0D\x0AContent-Length: %d\x0D\x0A\x0D\x0A%s"
        $asm_write = { 6a 00 68 80 00 00 00 6a 01 6a 00 6a 00 68 00 00 00 40 8b 45 ?? 50 }
        $asm_init = { c7 85 [3-5] 00 00 00 00 c7 85 [3-5] 70 17 00 00 c7 85 [3-5] 70 17 00 00 }
    condition:
        uint16(0) == 0x5a4d and
        5 of them and
        filesize < 200KB
}

rule CrowdStrike_CSA_210375_01 : downloader jeus labyrinth_chollima 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects multiple Jeus variants with a http cookie string and code associated with custom sleep function"
        reports = "CSA-210375"
        version = "202104232011"
        last_modified = "2021-04-23"
        actor = "LABYRINTH CHOLLIMA"
        malware_family = "Jeus"
    strings:
        $sleep = {48 8B 03 49 2B 06 49 63 DF 48 39 D8}
        $cookies = "setHTTPShouldHandleCookies:"
    condition:
        all of them and ( uint32(0) == 0xfeedface or uint32(0) == 0xcefaedfe or uint32(0) == 0xfeedfacf or uint32(0) == 0xcffaedfe or uint32(0) == 0xcafebabe or uint32(0) == 0xbebafeca )
}

rule CrowdStrike_SLIGHTPULSE_Webshell : pulse_secure slightpulse webshell 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule detects the SLIGHTPULSE webshell which was used against compromised Pulse Connect Secure devices"
        reports = "CSA-210405"
        version = "202105140846"
        last_modified = "2021-05-14"
        malware_family = "SLIGHTPULSE"
    strings:
        $ = "Content-Disposition: attachment; filename=tmp\\n\\n"
        $ = "my $n1=int(rand(256));"
        $ = "use MIME::Base64;use Crypt::RC4;"
        $ = "system(\"$na >/tmp/1 2>&1\");open("
        $ = "elsif(CGI::param('name') and CGI::param('img')"
        $ = "my $st=$_[0];my $k=r("
        $ = ";print \"Content-type: text/html\\n\\n\";"
        $ = "use%20MIME::Base64;use%20Crypt::RC4;"
        $ = "my%20\\$fi%20=%20CGI::param(%27cert%27);"
    condition:
        2 of them
}

rule CrowdStrike_CSIT_21112_01 : carbon_spider domenus domenusps powershell 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects encrypted CARBON SPIDER Domenus PowerShell payloads"
        reports = "CSIT-21112"
        version = "202105280931"
        last_modified = "2021-05-28"
        actor = "CARBON SPIDER"
        malware_family = "DomenusPS"
    strings:
        $encoding = "[System.Text.Encoding]::UTF8.GetString([System.Convert]::FromBase64String("
        $char_op = "+[char][int]([int][char]$"
        $exec = "iex $"
        $dll_load = "EPatch"
    condition:
        $encoding and $char_op and $exec and not $dll_load
}

rule CrowdStrike_Pulse_Secure_Injector_Tool : elf pulse_secure 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule matches against a tool identified during the April 2021 exploitation of a Pulse Secure Connect vulnerability. This tool is used to inject code into other processes on the Pulse Secure Connect appliance."
        version = "202105261550"
        last_modified = "2021-05-26"
        malware = "Pulse Secure Connect Injector"
    strings:
        $s_usage = "usage: %s [-n process-name] [-p pid] [library-to-inject]"
        $s_argv = "argv %d error!"
        $s_ok = "OK!" fullword
        $arg_check_e = { 8B 00 0F B6 00 3C 65 }
        $arg_check_E = { 8B 00 0F B6 00 3C 45 }
        $arg_check_u = { 8B 00 0F B6 00 3C 75 }
        $arg_check_U = { 8B 00 0F B6 00 3C 55 }
    condition:
        2 of ($s*) or (all of ($arg_*)) and filesize < 25KB and uint32(0) == 0x464c457f
}

rule CrowdStrike_Pulse_Secure_Do_Install_Bypass : absolutebypass pulse_secure 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule looks for a modified copy of an otherwise legitimate ELF binary which exists on a Pulse Secure Connect appliance. This modified copy will always a file /pkg/do-install to be executed."
        reports = "CSA-210405"
        version = "202105140838"
        last_modified = "2021-05-14"
        malware = "ABSOLUTEBYPASS"
    strings:
        $ = { 44 c1 89 44 24 0c 8d 83 51 ed ff ff 89 54 24 10 89 }
    condition:
        all of them
}

rule CrowdStrike_Pulse_Secure_InjectedShellcode : pulse_secure shellcode 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "This rule matches against shellcode injected into the dslogserver process on a Pulse Secure Connect appliance. "
        version = "202104232019"
        last_modified = "2021-04-23"
    strings:
        $ = { 5352 5751 56b8 0000 0000 fce8 0000 0000 5a8d 5ac0 8b54 2420 4089 c183 c109 3b4c }
    condition:
        all of them
}

rule CrowdStrike_CSIT_21086_01 : amadey amadeyloader downloader ecrime unpacked 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects string decryption opcodes and cleartext strings found in AmadeyLoader"
        reports = "CSIT-21086"
        version = "202105260910"
        last_modified = "2021-05-26"
        malware_family = "AmadeyLoader"
    strings:
        $str1 = "Microsoft Internet Explorer" wide fullword
        $str2 = "runas" ascii wide fullword
        $decrypt_strings_asm = { f7 f? 8a 84 3? [4] 2a 44 0? 01 88 8? [4] 4? 8b 45 f? 8d 5? 01 }
    condition:
        $decrypt_strings_asm and any of ($str*) and filesize < 1MB
}

rule CrowdStrike_CSA_210401_01 : angrydesk phishing 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects strings and code found in AngryDesk "
        reports = "CSA-210401"
        version = "202104301009"
        last_modified = "2021-04-30"
        malware_family = "AngryDesk"
    strings:
        $str1 = "fb7e538145d6e621aaa1993291ada8ca5bb70a45"
        $str2 = "2e44fb7ce6861e81ddc0d9aee00fb94b"
        $asm = { 69 d2 0d 66 19 00 81 c2 5f f3 6e 3c 8b c2 c1 e8 0c }
    condition:
        all of them
}

rule CrowdStrike_CSA_210401_02 : angrydesk powershell 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects strings found in a PowerShell loader dropped by AngryDesk "
        reports = "CSA-210401"
        version = "202104301010"
        last_modified = "2021-04-30"
        malware_family = "AngryDesk"
    strings:
        $ = "/en-us/usage/,/en-en/info-user/,/en-us/content"
        $ = "Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:78.0) Gecko/20100111 Firefox/78.0"
        $ = "[Environment]::UserDomainName+'|'+[Environment]::UserName+'|'+[Environment]::MachineName"
    condition:
        all of them
}

rule CrowdStrike_CSA_210389_01 : emotet mummy_spider 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects uninstallation binary deployed to Emotet victim machines"
        reports = "CSA-210389"
        version = "202104301010"
        last_modified = "2021-04-30"
        actor = "MUMMY SPIDER"
        malware_family = "Emotet"
    strings:
        $file_prefix = "UPD" wide fullword
        $dll_internal_name = "EmotetLoader.dll" fullword
        $registry_key = "SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run" wide fullword
        $exported_name_1 = "Control_RunDLL" fullword
        $exported_name_2 = "RunDLL" fullword
        $exported_name_3 = "ShowDialogA" fullword
        $code_pattern = { c7 05 ?? ?? ?? ?? 03 00 00 00 c7 05 ?? ?? ?? ?? 19 00 00 00 c7 05 ?? ?? ?? ?? 0c 00 00 00 c7 05 ?? ?? ?? ?? 00 00 00 00 }
    condition:
        uint16(0) == 0x5a4d and
        (($dll_internal_name or ($registry_key and $file_prefix and all of ($exported_name_*))) or ($registry_key and $file_prefix and $code_pattern))
}

rule CrowdStrike_CSA_210425_01 : crypter deathkitty ecrime ransomware 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects a crypter/packer for DeathKitty ransomware, payload is decrypted on execution with a key provided via cmd-line."
        reports = "CSA-210425"
        version = "202105260909"
        last_modified = "2021-05-26"
        malware_family = "DeathKitty"
    strings:
        $str_1 = "-key\x00" wide
        $str_2 = "Run\x00" ascii
        $asm_rdtsc = { 55 8b ec 51 0f 31 89 45 ?? 83 7d ?? 04 }
        $asm_cryptacq = {
        68 00 00 00 f0 6a 01 6a 00 6a 00 50
        c7 06 00 00 00 00 ff 15 [4]
        85 c0 75 ?? b8 c4 ff ff ff }
        $asm_consts = {
        c7 85 [3-4] 38 35 34 37 8d 7d ??
        c7 85 [3-4] 31 6b 61 79 8d 55 ??
        c7 85 [3-4] 65 63 61 78
        c7 85 [3-4] 61 75 62 76 }
        $asm_sizechks = {
        83 fa 08 72 ?? 8b 4c 24 ?? 8d 14 55 [4]
        8b c1 81 fa 00 10 00 00 72 ??
        8b 49 ?? 83 c2 23 2b c1 83 c0 fc 83 f8 1f }
        $asm_getmodcreat = {
        8d 85 [4] 68 00 04 00 00 50 56 03 d9
        ff 15 [4] 56 56 6a 03 56 6a 03
        68 00 00 00 80 8d 85 [4] 50 ff 15 }
    condition:
        filesize < 1MB and
        uint16(0) == 0x5a4d and
        4 of them
}

rule CrowdStrike_CSA_210422_01 : buer downloader ecrime loader rust wizard_spider 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects the Rust version of BuerLoader"
        reports = "CSA-210422"
        version = "202105140947"
        last_modified = "2021-05-14"
        actor = "WIZARD SPIDER"
        malware_family = "BuerLoader"
    strings:
        $key = "kpM5WOtfo"
        $op = { 3d 19 04 00 00 }
        $s1 = "litef"
        $s2 = "runneradmin"
        $s3 = "GETHEADPOSTPUTDELETE"
    condition:
        uint16(0) == 0x5a4d and ($key or ($op and all of ($s*)))
}

rule CrowdStrike_CSA_210474_01 : autordpenabler autordpenablerpinger 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects VBS Script used by AutoRDPEnabler to enable command line access to PuTTY possibly in an effort to establish a reverse SSH-tunnel to allow for RDP connections to computers behind Firewalls/NATs"
        reports = "CSA-210474"
        version = "202105280931"
        last_modified = "2021-05-28"
        malware_family = "AutoRDPEnabler"
    strings:
        $putty_download_link = "https://the.earth.li/~sgtatham/putty/latest/"
        $rdpwrapper_download_link = "https://github.com/stascorp/rdpwrap/releases/download/"
        $plink = "plink.exe"
    condition:
        all of them and filesize < 20KB
}

rule CrowdStrike_CSA_210425_03 : ecrime infostealer kolograbber stealer 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects KoloGrabber browser/information stealer based on PDB path artifacts."
        reports = "CSA-210425"
        version = "202105071643"
        last_modified = "2021-05-07"
        malware_family = "KoloGrabber"
    strings:
        // .NET identifiers
        $dn_sig = "BSJB"
        $dn_strings = "#Strings"
        $dn_blob = "#Blob"
        $dn_guid = "#GUID"
        // PDB artifacts
        $path_1 = "\\kolobko\\Source\\Repos\\" ascii
        $path_2 = "\\Source\\Repos\\grab" ascii
        $str_1 = "grabff" ascii
        $str_2 = "grabchrome" ascii
        $str_3 = "grbachrome.pdb" ascii
    condition:
        filesize < 500KB and
        all of ($dn_*) and
        1 of ($path_*) and 1 of ($str_*)
}

rule CrowdStrike_CSA_210457_01 : dnbackdoor 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects a small collection of distinctive method names that appear in dnbackdoor samples"
        reports = "CSA-210457"
        version = "202105211511"
        last_modified = "2021-05-21"
        malware_family = "dnbackdoor"
    strings:
        $1 = "ObjToStr"
        $2 = "MakeKey"
        // Full name is (P|p)arseDataset
        $3 = "arseDataset"
    condition:
        filesize<2MB and uint16(0)==0x5a4d and all of them
}

rule CrowdStrike_CSA_210459_01 : downloader kryptonite_panda 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects distinctive sequences in KRYPTONITE PANDA downloader"
        reports = "CSA-210459"
        version = "202105211458"
        last_modified = "2021-05-21"
        actor = "KRYPTONITE PANDA"
    strings:
        $decoder = { b9 13 00 00 00 bf 60 02 00 00 0f 10 04 02 66 0f ef c1 0f 11 00 }
        $http_bits = { 68 74 74 70 3a 2f 2f 25 73 00 00 00 47 45 54 00 30 }
    condition:
        filesize<1MB and uint16(0)==0x5a4d and any of them
}

rule CrowdStrike_BornSlippy_02 : bornslippy dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects a VBS-based malicious dropper with heavy VM detection"
        version = "202106251058"
        last_modified = "2021-06-25"
        malware_family = "BornSlippy"
    strings:
        $array = /\w+\s{0,3}=\s{0,3}Array\(\s{0,3}(\w{1,10},\s{0,3}){80}/
        $const = /const\s{1,3}\w{2,5}\s{0,3}=\s{0,3}\d{2,5}/
        $exe = "execute("
        $rnd1 = "Rnd"
        $rnd2 = "Randomize"
        $rnd3 = "999999,999999,999999,999999"
        $chr = "ChrW"
    condition:
        #array > 20 and
        #const > 3 and
        #chr == 2 and
        #exe > 10 and
        #rnd1 == 1 and
        #rnd2 == 1 and
        #rnd3 == 1
}

rule CrowdStrike_CSA_210474_02 : autordpenabler autordpenabler_adduser 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Matches on scripts used within the AutoRDPEnabler malware that establish a foothold by means of adding a user, open a port in the firewall, and enable RDP access"
        reports = "CSA-210474"
        version = "202105280931"
        last_modified = "2021-05-28"
        malware_family = "AutoRDPEnabler"
    strings:
        $add_user_to_logon = "reg add \"HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\SpecialAccounts\\UserList\" /v "
        $add_rdp_port = "reg add \"hklm\\SYSTEM\\CurrentControlSet\\Control\\Terminal Server\\WinStations\\RDP-Tcp\" /v \"PortNumber\" /t REG_DWORD /d "
        $open_port_in_firewall = "netsh advfirewall firewall add rule name=\""
    condition:
        all of them and filesize < 20KB
}

rule CrowdStrike_CSIT_21113_01 : artifact cozy_bear diplomaticorbiter lnk 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects metadata patterns from DiplomaticOrbiter files"
        reports = "CSIT-21113,CSIT-21125"
        version = "202106171251"
        last_modified = "2021-06-17"
        actor = "COZY BEAR"
    strings:
        $u1 = "desktop-h5i8od4" ascii
        $u2 = "desktop-sv61g9g" ascii
        $u3 = "desktop-ajk2cbn" ascii
        $u4 = "desktop-lcm5qsr" ascii
        $p3 = "C:\\Users\\test.SERVER\\Desktop\\" wide
        $t1 = { e7 dd ac d5 01 }
        $t2 = { fa dd ac d5 01 }
        $t3 = { c3 c5 4c d4 01 }
    condition:
        (
        any of ($u*) or
        $p3 or
        ($t1 in (0x18 .. 0x38) or $t2 in (0x18 .. 0x38) or $t3 in (0x18 .. 0x38))
        ) and filesize < 0x2000
}

rule CrowdStrike_CSA_210464_01 : direfate shredder 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects strings used to create DireFate's Shredder tool like function names and hard-coded log file"
        reports = "CSA-210464"
        version = "202105211459"
        last_modified = "2021-05-21"
        actor = "DireFate"
        malware_family = "Shredder"
    strings:
        $ = "/hack/tools/"
        $ = "shredder.log"
        $ = "main.walk"
        $ = "main.WriteLog"
        $ = "main.TakeOwnership"
        $ = "main.Remove"
    condition:
        all of them
}

rule CrowdStrike_CredentialHarvestingHTML_01 : credential_theft 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects the first stage of a credential harvesting HTML file sent as a spam attachment."
        version = "202105211501"
        last_modified = "2021-05-21"
    strings:
        $codepart = "%29%7b%7d%7d%73%63%72%69%70%74%33%34%73%73%64%5b%5f%30%78" ascii
        $unescape = "document.write(unescape('%"
        $jstag = "<script language=\"javascript\">"
    condition:
        all of them
        and @unescape < 38
        and @jstag < 5
        and filesize < 20KB
}

rule CrowdStrike_CSA_210467_01 : ecrime mountlocker ransomware 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects MountLocker ransomware version 5.0 samples"
        reports = "CSA-210467"
        version = "202105311622"
        last_modified = "2021-05-31"
        malware_family = "MountLocker"
    strings:
        $ = "RecoveryManual.html" ascii wide
        $ = "%CLIENT_ID%" ascii wide
        $ = "Ver %s x32" ascii wide
        $ = "Ver %s x64" ascii wide
        $ = "[ERROR] locker" ascii wide
        $ = "[WARN] locker" ascii wide
        $ = "[OK] locker" ascii wide
        $ = "/LOGIN=" ascii wide nocase
        $ = "/PASSWORD=" ascii wide nocase
        $ = "LDAP://" ascii wide nocase
        $ = "\\ADMIN$" ascii wide nocase
        $ = "(objectClass=computer)" ascii wide
    condition:
        filesize < 500KB
        and uint16(0) == 0x5a4d
        and 8 of them
}

rule CrowdStrike_CSIT_21108_01 : ecrime mespinoza pysa ransomware 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects strings associated with Pysa ransomware"
        reports = "CSIT-21108"
        version = "202106040914"
        last_modified = "2021-06-04"
        malware_family = "Pysa"
    strings:
        $ = "Pysa" fullword
        $ = ".pysa" fullword
        $ = "PYSA" fullword
        $ = "legalnoticecaption" fullword
        $ = "update.bat" fullword
        $ = "%s\\Readme.README" wide fullword
    condition:
        uint16(0) == 0x5a4d and
        4 of them
}

rule CrowdStrike_CSIR_21009_01 : android dex hotline primevalsentry rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects strings used for Hotline HTTP and SMS C2 channels"
        reports = "CSIR-21009"
        version = "202106221719"
        last_modified = "2021-06-22"
        actor = "PrimevalSentry"
        malware_family = "Hotline"
    strings:
        $ = "/SmsListener;"
        $ = "serverAddress"
        $ = "/App;"
        $ = "/CommandMonitor;"
        $ = "ZipBeforeSend"
        $ = "actionTextBox"
        $ = "deviceIdTextBox"
        $ = "/RemoteData."
        $ = "requestContent"
        $ = "setResponse"
    condition:
        all of them
}

rule CrowdStrike_CSA_210468_01 : ghahergo golang remix_kitten 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects Golang function names for GhaherGo"
        reports = "CSA-210468"
        version = "202105280932"
        last_modified = "2021-05-28"
        actor = "REMIX KITTEN"
        malware_family = "GhaherGo"
    strings:
        $ = "main.getCommand"
        $ = "main.getId" nocase
        $ = "main.loadConfig"
        $ = "main.runCommand"
        $ = "main.saveConfig"
        $ = "main.sendResult"
    condition:
        uint16(0) == 0x5a4d and all of them
}

rule CrowdStrike_CSIT_21113_02 : boombox cozy_bear diplomaticorbiter downloader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects BoomBox downloader used in the DiplomaticOrbiter campaign"
        reports = "CSIT-21113,CSIT-21125"
        version = "202106241130"
        last_modified = "2021-06-24"
        actor = "COZY BEAR"
        malware_family = "BoomBox"
    strings:
        $dotnet = "BSJB"
        $aes_key = "123do3y4r378o5t34onf7t3o573tfo73" wide
        $aes_iv = "1233t04p7jn3n4rg" wide
        $token_1 = "tD_R9HophMgAAAAAAAAAATpNJUOte2BfkEgYTbZqZMh4YUwoq_JzBBX9_yPK7JGf" wide
        $token_2 = "9h7tsusvXQAAAAAAAAAAAd167msnVK1xuas9zBXKQcXYXDsTGyw3PUDiQLlt6kt7" wide
    condition:
        ($dotnet and ($aes_key and $aes_iv)) or any of ($token_*)
}

rule CrowdStrike_CSIT_21113_03 : cozy_bear diplomaticorbiter dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects HTML droppers used during the DiplomaticOrbiter campaign"
        reports = "CSIT-21113,CSIT-21125"
        version = "202106171253"
        last_modified = "2021-06-17"
        actor = "COZY BEAR"
    strings:
        $html = "<html>"
        $head = "<meta http-equiv=\"X-UA-Compatible\" content=\"IE=11\">"
        $filesaver_js_f1 = "msSaveOrOpenBlob" nocase
        $filesaver_js_f2 = "_global.saveAs" nocase
        $filesaver_js_f3 = "isMacOSWebView" nocase
        $filesaver_js_f4 = "readAsDataURL" nocase
    condition:
        all of them
}

rule CrowdStrike_CSIT_21113_04 : cozy_bear diplomaticorbiter dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects HTML droppers used during the DiplomaticOrbiter campaign"
        reports = "CSIT-21113,CSIT-21125"
        version = "202106171254"
        last_modified = "2021-06-17"
        actor = "COZY BEAR"
    strings:
        $html = "<html>"
        $head = "<meta http-equiv=\"X-UA-Compatible\" content=\"IE=11\">"
        $filesaver_js_f1 = "msSaveOrOpenBlob" nocase
        $filesaver_js_f3 = "saveAs" nocase
        $filesaver_js_f4 = "createElementNS" nocase
        $filesaver_js_f5 = "RequestFileSystem" nocase
        $filesaver_js_f6 = "revokeObjectURL" nocase
    condition:
        all of them
}

rule CrowdStrike_CSA_210472_01 : autoit coscee stager 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects the Coscee stager bash script"
        reports = "CSA-210472"
        version = "202105280932"
        last_modified = "2021-05-28"
        malware_family = "Coscee"
    strings:
        $if = "if "
        $computername_actor = "DESKTOP-QO5QU33"
        $exit_cmd = " exit"
        $userdomain = "userdomain"
        $computername = "computername"
        $sleep_via_ping = "ping 127.0.0.1 -n"
    condition:
        $if and $computername_actor and $exit_cmd and $sleep_via_ping
        and (any of ($userdomain, $computername))
        and filesize < 10KB
}

rule CrowdStrike_CSIT_21113_06 : artifact cozy_bear diplomaticorbiter 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects SIDs found in DiplomaticOrbiter LNK files"
        reports = "CSIT-21113,CSIT-21125"
        version = "202106221154"
        last_modified = "2021-06-22"
        actor = "COZY BEAR"
    strings:
        $sid_1 = "S-1-5-21-2444159587-534963279-312257166-1001" wide
        $sid_2 = "S-1-5-21-3458061013-181308851-3514092929-5009" wide
        $sid_3 = "S-1-5-21-688568919-2278383986-2873076272-1001" wide
        $sid_4 = "S-1-5-21-8417294525-741976727-420522995-1001" wide
        $sid_5 = "S-1-5-21-9973329227-620844772-233108279-1001" wide
        $sid_6 = "S-1-5-21-1893026808-172627437-813038187-1001" wide
    condition:
        any of them
}

rule CrowdStrike_CSIT_21113_05 : artifact cozy_bear diplomaticorbiter 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects path strings found in DiplomaticOrbiter malware payloads"
        reports = "CSIT-21113,CSIT-21125"
        version = "202106171255"
        last_modified = "2021-06-17"
        actor = "COZY BEAR"
    strings:
        $ = "\\Visual Studio 2013\\Projects\\DLL_stageless\\Release\\DLL_stageless.pdb" nocase wide ascii
        $ = ":\\Users\\dev10vs\\Desktop\\Prog\\" nocase wide ascii
        $ = /\\BOOM\\BOOM\\(Debug|Release)\\BOOMStart.pdb/ nocase wide ascii
        $ = ":\\Users\\test.SERVER" nocase wide ascii
        $ = /\ \\Dll6\\x64\\(Debug|Release)\\Dll6.pdb/ nocase wide ascii
    condition:
        any of them
}

rule CrowdStrike_CSA_210547_01 : juego loader viceroy_tiger 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects Juego loader attributed to VICEROY TIGER"
        reports = "CSA-210547"
        version = "202106251058"
        last_modified = "2021-06-25"
        actor = "VICEROY TIGER"
        malware_family = "Juego"
    strings:
        $str1 = "SystemDrive" wide
        $hex1 = { 8b 45 08 03 45 f8 0f be 08 83 f1 03 8b 55 ec 03 55 f8 88 0a eb }
        $hex2 = { 8b 4d 08 03 4d fc 0f be 11 83 f2 03 8b 45 f8 03 45 fc 88 10 eb }
        $hex64bit = { 48 63 44 24 20 48 8b 4c 24 50 0f be 04 01 83 f0 03 48 63 4c 24 20 48 8b 54 24 28 88 04 0a eb 9c }
    condition:
        uint16(0) == 0x5a4d and
        $str1 and
        1 of ($hex*)
}

// WARNING: This rule will only work with YARA 3
import "pe"

rule CrowdStrike_CSA_210480_01 : cobaltstrike loader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects Cobalt Strike custom loader based on strings, constants and imports"
        reports = "CSA-210480"
        version = "202106110850"
        last_modified = "2021-06-11"
        actor = "WICKED PANDA"
        malware_family = "CobaltStrike"
    strings:
        $binary = "powerctl32"
        $sha1_1 = { 01 23 45 67 }
        $sha1_2 = { 89 ab cd ef }
        $sha1_3 = { fe dc ba 98 }
        $sha1_4 = { 76 54 32 10 }
        $sha1_5 = { f0 e1 d2 c3 }
    condition:
        uint16(0) == 0x5a4d and
        pe.imports("kernel32.dll", "GetComputerNameA") and
        pe.imports("kernel32.dll", "CheckRemoteDebuggerPresent") and
        all of them and
        filesize < 1MB
}

rule CrowdStrike_CSA_210480_02 : credential_dumper mimikatz 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects mimikatz variant based on debug strings"
        reports = "CSA-210480"
        version = "202106110850"
        last_modified = "2021-06-11"
        actor = "WICKED PANDA"
        malware_family = "Mimikatz"
    strings:
        $s1 = "Init Des key error"
        $s2 = "get iv error"
        $s3 = "Load lsasrv err"
        $s4 = "get module lsasrv.dll info error"
        $s5 = "ERROR INIT GetNtVersionNumbers Func"
        $s6 = "Init Iv_k3Des error"
        $s7 = "get module info wdigest.dll err"
        $s8 = "get module info tspkg.dll err"
    condition:
        uint16(0) == 0x5a4d and
        4 of them and
        filesize < 1MB
}

rule CrowdStrike_CSA_210486_01 : artifact boomfire cozy_bear diplomaticorbiter 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects BoomFire samples based on unique strings"
        reports = "CSA-210486,CSIT-21125"
        version = "202106171301"
        last_modified = "2021-06-17"
        actor = "COZY BEAR"
        malware_family = "BoomFire"
    strings:
        $key = "UlswcXJJWhtHIHrVqWJJ" ascii
        $identifier = "gyibvmt"
        $path = "C:\\dell.sdr" ascii
    condition:
        all of them and
        filesize < 1MB
}

rule CrowdStrike_CSA_210486_03 : artifact boomfire cozy_bear diplomaticorbiter 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects BoomFire based on format strings and Firebase domain"
        reports = "CSA-210486,CSIT-21125"
        version = "202106171303"
        last_modified = "2021-06-17"
        actor = "COZY BEAR"
        malware_family = "BoomFire"
    strings:
        $time = "root/time/%d/%s.json" ascii
        $data = "root/data/%d/%s.json" ascii
        $firebase = ".firebaseio.com" ascii
    condition:
        filesize < 1MB and all of them
}

rule CrowdStrike_CSA_210486_02 : artifact boomfire cozy_bear diplomaticorbiter 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects the MD5 and 3DES algorithms constants within a short instruction distance"
        reports = "CSA-210486,CSIT-21125"
        version = "202106171302"
        last_modified = "2021-06-17"
        actor = "COZY BEAR"
        malware_family = "BoomFire"
    strings:
        $des = { 4? ?? 00 00 a8 00 ?? 03 66 00 00 }
        $md5 = { 03 80 00 00 ff }
    condition:
        all of them and
        (@des < @md5 + 0x100) and
        filesize < 1MB
}

rule CrowdStrike_CSA_210488_01 : charming_kitten powerwindow rat 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects strings from CHARMING KITTEN PowerWindow RAT"
        reports = "CSA-210488"
        version = "202106040915"
        last_modified = "2021-06-04"
        actor = "CHARMING KITTEN"
        malware_family = "PowerWindow"
    strings:
        $ = ".Split(\"\");" wide ascii
        $ = ".Split(\"~\");"
        $ = "\"PowerWindows\"" wide ascii
        $ = "+ \";;\" +" wide ascii
        $ = "\"NoComm\"" wide ascii
    condition:
        all of them
}

rule CrowdStrike_CSIT_21120_01 : babuk babuklocker ecrime ransomware 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects strings and assembly patterns used in Babuk Locker"
        reports = "CSIT-21120"
        version = "202106181018"
        last_modified = "2021-06-18"
        malware_family = "BabukLocker"
    strings:
        $babuk1 = "babuk" ascii wide
        $babuk2 = "BABUK" ascii wide
        $note1 = "How To Restore Your Files.txt" fullword wide
        $asm_chacha1 = { 65 78 70 61 }
        $asm_chacha2 = { 6e 64 20 33 }
        $asm_chacha3 = { 32 2d 62 79 }
        $asm_chacha4 = { 74 65 20 6b }
        $asm_hc256_1 = { c1 e1 0f 0b c1 [10] c1 ea 13 [10] c1 e1 0d }
        $asm_hc256_2 = { 81 b8 80 10 00 00 00 02 00 00 [15] 83 c2 10 81 e2 ff 03 00 00 }
    condition:
        any of ($babuk*) and
        $note1 and
        (all of ($asm_chacha*) or any of ($asm_hc256_*))
}

rule CrowdStrike_CSA_210506_02 : acelog loader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Looks for bytes for a SHA256 hash of the string TermSrvClt.dll, as used in AceLog malware"
        reports = "CSA-210506"
        version = "202106110850"
        last_modified = "2021-06-11"
        malware_family = "AceLog"
    strings:
        $b = { f4 eb 56 52 af 4b 48 ee 08 ff 9d 44 89 4b d5 66 24 61 2a 15 1d 58 14 f9 6d 97 13 2c 6d 07 6f 86 }
    condition:
        $b
}

rule CrowdStrike_CSA_210506_01 : acelog dropper 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Looks for DOS header patterns characteristic of AceLog droppers"
        reports = "CSA-210506"
        version = "202106110850"
        last_modified = "2021-06-11"
        malware_family = "AceLogDropper"
    strings:
        $mz = {4D 5A 90 00}
        $mzb64 = "TVqQAA"
    condition:
        any of them and filesize < 10MB and uint32(0x1C) != 0 and uint32(0x20) != 0 and (
        uint32(uint32(0x1C)) == 0x00905a4d or uint32(uint32(0x1C)) == 0x51715654 or
        uint32(uint32(0x20)) == 0x00905a4d or uint32(uint32(0x20)) == 0x51715654
        )
}

rule CrowdStrike_CSA_210504_01 : dropper labyrinth_chollima stackeyflate 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects bytes of HC-256 algorithm implementation in Stackeyflate dropper, as well as plaintext names of imports, exports, and DLL."
        reports = "CSA-210504"
        version = "202106110850"
        last_modified = "2021-06-11"
        actor = "LABYRINTH CHOLLIMA"
        malware_family = "Stackeyflate"
    strings:
        $hc_256_loop = { 44 8b c0 41 81 e0 ff 03 00 00 41 8d 50 fd 45 8d 48 f6 45 8d 58 f4 41 8d 48 01 81 e2 ff 03 00 00 41 81 e1 ff 03 00 00 41 81 e3 ff 03 00 00 81 e1 ff 03 00 00 3d 00 04 00 00 }
        $export_name = "CAST_decrypt" fullword
        $dll_name = "SSLeay64.dll" fullword
        $import_createdirectory = "CreateDirectory"
        $import_createfile = "CreateFile"
        $import_createprocess = "CreateProcess"
        $import_writefile = "WriteFile"
    condition:
        uint16(0) == 0x5a4d and
        all of them and
        filesize < 2MB
}

rule CrowdStrike_CSA_210504_02 : downloader labyrinth_chollima openssldownloader 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects strings used to build beacon, status messages, and to specify arguments for MS crypto library."
        reports = "CSA-210504"
        version = "202106110850"
        last_modified = "2021-06-11"
        actor = "LABYRINTH CHOLLIMA"
        malware_family = "OpenSSLDownloader"
    strings:
        $format_string_0 = "%s=%s&%s=%s&%s=%s&%s=%d&%s=%d&%s=%s" fullword
        $format_string_1 = "%04d-%02d-%02d %02d:%02d:%02d" wide fullword
        $error_string_0 = "Dll Data Error|" wide fullword
        $error_string_1 = "Hash error!" wide fullword
        $ms_crypt_string = "Microsoft Base Cryptographic Provider v1.0" wide fullword
        $sleep_string = "Sleeping|" wide fullword
    condition:
        uint16(0) == 0x5a4d and
        all of them and
        filesize < 2MB
}

// WARNING: This rule will only work with YARA 3
import "pe"

rule CrowdStrike_CSA_210519_01 : dropper mailo smanager 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects Mail-O variant of Smanager based on embedded strings and unique DLL Export function"
        reports = "CSA-210519"
        version = "202106110851"
        last_modified = "2021-06-11"
        malware_family = "Mail-O"
    strings:
        $ = "client_id=cloud-win&"
        $ = "CloudDiskOWindows %s beta %s"
        $ = "%s/%s_%02d%02d%02d%02d%02d.dat"
        $ = "xsplit_"
        $ = "test/test.dat"
    condition:
        4 of them or
        (1 of them and pe.exports("Entery"))
}

rule CrowdStrike_CSA_210518_01 : android charming_kitten 
{
    meta:
        copyright = "(c) 2021 CrowdStrike Inc."
        description = "Detects a CHARMING KITTEN Android malware family"
        reports = "CSA-210518"
        version = "202106181018"
        last_modified = "2021-06-18"
        actor = "CHARMING KITTEN"
    strings:
        $dex = { 64 65 (78 | 79) 0A 30 33 ?? 00 }
        $a1 = "android.{0}.{1}.{2}"
        $a2 = "=Lcom/google/android/services/control/core/core/GSApplication;"
    condition:
        $dex at 0 and
        ($a1 or $a2)
}